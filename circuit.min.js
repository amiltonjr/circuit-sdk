(function (root, factory) {
  if (root === undefined && window !== undefined) root = window;
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module unless amdModuleId is set
    define([], function () {
      return (root['Circuit'] = factory());
    });
  } else if (typeof module === 'object' && module.exports) {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory();
  } else {
    root['Circuit'] = factory();
  }
}(this, function () {

/**
 *  Copyright 2019 Unify Software and Solutions GmbH & Co.KG.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  @version: 1.2.7604
 */

var Circuit = {}; Object.defineProperty(Circuit, 'version', { value: '1.2.7604'});


var global=Function("return this")(),window=global.window||global,navigator=global.navigator||window.navigator||{},document=window.document,WebSocket=global.WebSocket,XMLHttpRequest=global.XMLHttpRequest,Promise=global.Promise,Circuit=function(Pe){"use strict";var ye=Pe.Enums.ConnectionState,be=Pe.Enums.ConversationType,Ue=Pe.Constants,Le=Pe.logger,Me=Pe.PrivateData,we=Pe.Enums.Targets,Ge=Pe.Enums.VideoResolutionLevel,He=Pe.Utils,ke="tHuMbNaIl___",Ve="CALL_RECORDING,CALLS,MENTION_EVENT,READ_CONVERSATIONS,READ_USER,READ_USER_PROFILE,WRITE_CONVERSATIONS,WRITE_USER_PROFILE";!function(e,t){if(e.location.hash||e.location.search){var n=Object.assign({},He.parseQS(e.location.hash),He.parseQS(e.location.search));if(n.state)try{Object.assign(n,JSON.parse(n.state))}catch(e){Le.error("Could not decode state parameter")}if(n.display&&"popup"===n.display&&n.redirect_uri===e.location.origin+e.location.pathname&&e.document.addEventListener("DOMContentLoaded",function(){e.document.body.innerHTML="Redirecting, please wait..."}),n.callback){var i=n.callback;if(i in t)try{delete n.callback,t[i](n)}catch(e){}}n.display&&"popup"===n.display&&function(){if(window.frameElement&&window.parent)window.parent.document.body.removeChild(window.frameElement);else try{window.close()}catch(e){}}()}}(window,window.opener||window.parent);var t=He.getBrowserInfo();return Pe.ExtensionConnHandlerSingleton.getInstance(),Circuit.WebRTCAdapter.unifiedPlanEnabled=!(!t.safari&&!t.firefox),Pe.Client=function(e){Pe.BaseEventTarget.call(this,Pe.logger);var l=this,t=Pe.Enums.ConnectionState.Disconnected,c=He.shallowCopy(e)||{};c.domain=c.domain||"circuitsandbox.net",c.emoticonMode=c.emoticonMode||"standard",h(e);var s,d,n,i,r,o,a,u="node"===window.navigator.platform,E="iOS"===window.navigator.platform||"Android"===window.navigator.platform,C=/<image(?:\s|\s.*?\s)href="(https:\/\/[^"]+)"/,T=[],p=!1,S=null,I=new Pe.ClientApiHandler(c),A=new Pe.UserToUserHandler(I),R=Pe.RtcSessionController;l._clientApiHandler=I,l._userToUserHandler=A,l._rtcSessionController=R;var f=new Pe.SdkServices(I,A);function v(e,t,n,i){if(e===Ue.ReturnCode.NO_RESULT&&n)return!1;if(e){var r=I.getLastError();return i&&i(r),r&&delete r.errObj,t(r),!0}return!1}function _(e,t){return!!e&&(t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e)),!0)}function g(){return"https://"+l.domain+"/"}function N(e,t,n){var i,r={};return r.width=t,r.height=n,r.left=window.screenX+(window.outerWidth-t)/2,r.top=window.screenY+(window.outerHeight-n)/2,r.scrollbars="yes",i=Object.keys(r).map(function(e){return e+"="+r[e]}).join(", "),window.open(e,r.name,i)}function m(e){return 0<=c.scope.split(",").indexOf(e)||0<=c.scope.split(",").indexOf("ALL")}function h(e){e=e||{},c.client_id=e.client_id,c.client_secret=e.client_secret,c.redirect_uri=e.redirect_uri||window.location.origin+window.location.pathname,c.scope=(e.scope?e.scope.replace(/\s+/g,""):"")||Ve,m(Ue.OAuthScope.READ_USER_PROFILE)||(c.scope=Ue.OAuthScope.READ_USER_PROFILE+","+e.scope),m(Ue.OAuthScope.ALL)&&(c.scope=Ve)}function O(o){return new Promise(function(t,n){var e,i=u?new XMLHttpRequest(c):new XMLHttpRequest;if(i.open(o.type||o.dataType||"GET",o.url,!0),i.withCredentials=o.xhrFields&&o.xhrFields.withCredentials,!s||o.headers&&o.headers.Authorization||i.setRequestHeader("Authorization","Bearer "+s),o.headers)for(var r in o.headers)o.headers.hasOwnProperty(r)&&i.setRequestHeader(r,o.headers[r]);i.onload=function(){if(200===i.status)o.success&&o.success(i.responseText),t(i.responseText);else{var e=new Circuit.Error(i.status,i.responseText||i.statusText);o.error&&o.error(e),n(e)}},i.onerror=function(){var e=new Circuit.Error(Ue.ErrorCode.AUTHORIZATION_FAILED,"Network error or incorrect credentials");o.error&&o.error(e),n(e)},o.data&&(e=He.toQS(o.data),i.setRequestHeader("Content-type","application/x-www-form-urlencoded")),i.send(e)})}function D(n){return new Promise(function(e,t){O({type:"POST",url:"https://"+l.domain+"/sdklogin",data:{token:n.token||void 0,accessToken:n.accessToken||void 0},xhrFields:{withCredentials:!0},crossDomain:!0}).then(function(){n.accessToken&&(s=n.accessToken),e()}).catch(t)})}function P(){return O({url:"https://"+l.domain+"/validateSession",xhrFields:{withCredentials:!0},crossDomain:!0}).then(function(){})}function y(){return new Promise(function(e,t){S&&(window.clearInterval(S),S=null,I.disconnect()),I.setToken(s),I.setClientInfo({deviceType:Ue.DeviceType.SDK,deviceSubtype:function(){switch(window.navigator.platform){case"node":return"NODE_SDK";case"iOS":return"IOS_SDK";case"Android":return"ANDROID_SDK";default:return"JS_SDK"}}(),clientVersion:Pe.version}),I.connect(function(){Le.info("[SDK]: Successfully connected to access server."),S=window.setInterval(De,50),e()},function(e){Le.error("[SDK]: Failed to connect: ",e),I.disconnect(),t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))},l.domain)})}function b(){return new Promise(function(e,t){if(c.client_id)if(window.localStorage){var n=window.localStorage.getItem("oauth");try{n=JSON.parse(n)}catch(e){return window.localStorage.removeItem("oauth"),void t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}n&&"object"==typeof n||(n={}),n[c.client_id]={access_token:s,domain:l.domain,expires_at:d},window.localStorage.setItem("oauth",JSON.stringify(n)),Le.debug("[SDK]: Stored access_token for client_id: "+c.client_id),e()}else e();else t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"client_id missing in client object"))})}function U(){return new Promise(function(e,t){var n=window.localStorage.getItem("oauth");if(n){try{n=JSON.parse(n)}catch(e){return void t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}if("object"==typeof n){var i=n[c.client_id];i&&i.access_token?(s=i.access_token,d=i.expires_at,Le.debug("[SDK]: Retrieved access_token for client_id: "+c.client_id),e(s)):t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"client_id not found in localStorage"))}else t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"invalid data in localStorage"))}else t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"OAuth access token not found in localStorage"))})}function L(e){var t="_circuit_"+parseInt(1e12*Math.random(),10).toString(36);return window[t]=function(){try{e.apply(this,arguments)&&delete window[t]}catch(e){Le.error(e)}},t}function M(){return new Promise(function(n,i){var r=null;if(!c.client_id)return l.oauthwin&&(l.oauthwin.close(),l.oauthwin=null),void i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"client_id missing in client object"));s=void 0;var e=L(function(e){if(r&&window.clearInterval(r),!e||e.error){s=void 0;var t=e?e.error:"The authentication was not completed";i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,t))}else s=e.access_token,d=e.expires_in&&Date.now()+1e3*e.expires_in,b().catch(function(e){Le.error("[SDK]: Failed to store the OAuth access token.",e)}).then(function(){n({username:e.username,accessToken:e.access_token})})}),t={client_id:c.client_id,redirect_uri:c.redirect_uri,response_type:"token",scope:c.scope||""};t.state=JSON.stringify({callback:e,display:"popup",redirect_uri:t.redirect_uri});var o="https://"+c.domain+"/oauth/authorize?"+He.toQS(t),a=l.oauthwin||N(o,450,520);a?(l.oauthwin=null,window.setTimeout(function(){a.location.href=o},500),r=window.setInterval(function(){a&&!a.closed||(r&&window.clearInterval(r),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)):i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"OAuth popup blocked"))})}function w(){return new Promise(function(n,i){var r=null,e=L(function(e){if(r&&window.clearInterval(r),!e||e.error){var t=e?e.error:"The authentication was not completed";i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,t))}else n({username:e.username})}),t=JSON.stringify({callback:e,display:"popup",redirect_uri:c.redirect_uri}),o={return_to:c.redirect_uri+"#state="+t},a="https://"+c.domain+"/oauth/login?"+He.toQS(o),s=l.oauthwin||N(a,450,520);l.oauthwin=null,window.setTimeout(function(){s.location.href=a},500),r=window.setInterval(function(){s&&!s.closed||(r&&window.clearInterval(r),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)})}function G(e){return e=e||s,O({type:"GET",url:"https://"+l.domain+"/oauth/token/"+e,crossDomain:!0}).then(function(e){try{return JSON.parse(e)}catch(e){return Promise.reject(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid token returned"))}})}function H(){if(c.client_secret&&c.autoRenewToken&&d){n&&window.clearTimeout(n);var e=d-Date.now()-6e4;0<(e=Math.min(2147483647,e))&&(n=window.setTimeout(k,e))}}function k(){return new Promise(function(i,r){var e={type:"POST",url:"https://"+l.domain+"/oauth/token",data:{scope:c.scope,grant_type:"implicit"}};c.client_secret&&(e.headers={Authorization:"Basic "+window.btoa(c.client_id+":"+c.client_secret)},e.data.grant_type="client_credentials"),O(e).then(function(e){var t=JSON.parse(e);if(t&&t.access_token&&"Bearer"===t.token_type)s=t.access_token,I.setToken(s),d=t.expires_in&&Date.now()+1e3*t.expires_in,H(),Oe({type:"accessTokenRenewed"}),i(s);else{d=s=null;var n=new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Error renewing OAuth2 access token");Oe({type:"renewAccessTokenFailed",error:n}),r(n)}}).catch(r)})}function V(){return new Promise(function(n,i){var e=[Ue.GetStuffType.USER,Ue.GetStuffType.SUPPORT_CONVERSATION_ID,Ue.GetStuffType.TELEPHONY_CONVERSATION_ID,Ue.GetStuffType.ACCOUNTS,Ue.GetStuffType.PRESENCE_STATE,Ue.GetStuffType.TENANT];I.getStuff(e,function(e,t){v(e,i,!0)||(r=t.telephonyConvId,o=t.supportConvId,ve(t.user).then(function(e){e.secId=t.tenant.secId,l.loggedOnUser=e,f.SdkHelperSvc.setLocalUser(e),n()}).catch(i))})})}function F(){return m(Ue.OAuthScope.CALLS)?f.CallControlSvc.initActiveSessionsForSdk():Promise.resolve()}function B(){return m(Ue.OAuthScope.CALLS)&&c.enableTelephony&&f.AtcRegistrationSvc.initAtcForSdk(),Promise.resolve()}function x(){return new Promise(function(n,i){I.getUserData(function(e,t){v(e,i)||(R.processClientSettings(t.clientSettings),n(t))})}).then(V).then(F).then(B).then(function(){Oe({type:"connectionStateChanged",state:Pe.Enums.ConnectionState.Ready})})}function W(){return y().then(x).then(function(){return l.loggedOnUser})}function Y(){return new Promise(function(n,i){O({type:"POST",url:"https://"+l.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(c.client_id+":"+c.client_secret)},data:{grant_type:"client_credentials",scope:c.scope}}).then(function(e){var t=JSON.parse(e);t&&t.access_token&&"Bearer"===t.token_type?(s=t.access_token,d=t.expires_in&&Date.now()+1e3*t.expires_in,H(),n({accessToken:s})):(d=s=null,i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,t&&t.error_description||"Internal error with Client Credentials Grant authentication")))}).catch(i)})}function K(o){return new Promise(function(i,r){o&&o.filterConnector?(o.retrieveAction=o.retrieveAction||Circuit.Enums.RetrieveAction.CONVERSATIONS,o.retrieveAction!==Circuit.Enums.RetrieveAction.CONVERSATIONS&&o.retrieveAction!==Circuit.Enums.RetrieveAction.CONVERSATION_IDS&&r(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid retrieveAction")),I.getConversationsByFilter(o,function(e,t){if(!v(e,r,!0))if(o.retrieveAction===Circuit.Enums.RetrieveAction.CONVERSATIONS){var n=t&&t.conversations||[];Promise.all(n.map(me)).then(i).catch(r)}else o.retrieveAction===Circuit.Enums.RetrieveAction.CONVERSATION_IDS&&i(t.conversationIds||[])})):r(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"options.filterConnector"))})}function q(e){return new Promise(function(n,i){I.getConversationById(e,function(e,t){v(e,i)||me(t).then(n).catch(i)})})}function j(e){return new Promise(function(n,i){I.getUserByEmail(e,function(e,t){v(e,i,null,function(e){e&&e.code===Ue.ReturnCode.NO_RESULT&&(e.info="User does not exist")})||ve(t).then(n).catch(i)})})}function Q(){return new Promise(function(n,i){I.getDevices(function(e,t){v(e,i,!0)||n(t||[])})})}function X(){return new Promise(function(n,i){if(a)n(a);else{var e=[Ue.GetStuffType.SUPPORT_INFO];I.getStuff(e,function(e,t){v(e,i)||(a=t.supportInfo,n(a))})}})}function z(r){return"string"==typeof r&&(r={userId:r,createIfNotExists:!1}),new Promise(function(n,i){r.userId?I.getConversationByUser(r.userId,function(e,t){e?e===Ue.ReturnCode.NO_RESULT?r.createIfNotExists?$(r.userId).then(function(e){n(e&&e.conversation)}):n():v(e,i):me(t).then(n).catch(i)}):i(new Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"user ID is required"))})}function J(e,t){return"string"!=typeof e?Promise.reject(new Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"email or user ID is required")):e.match(He.EMAIL_ADDRESS_PATTERN)?j(e).then(function(e){return{userId:e.userId,createIfNotExists:t}}).then(z):z({userId:e,createIfNotExists:t})}function $(t){return new Promise(function(i,r){if(l.loggedOnUser.userId!==t){var e={type:Ue.ConversationType.DIRECT,participants:[{userId:t},{userId:l.loggedOnUser.userId}]};I.createConversation(e,function(e,t,n){v(e,r)||me(t).then(function(e){i({conversation:e,alreadyExists:n})})})}else r(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"userId is of logged on user"))})}function Z(e,i){return new Promise(function(t,n){e?I.updateGuestAccess(e,i,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function ee(e){var t={};return e&&e.forEach(function(e){switch(e.key){case Ue.UserSettingKey.HIDE_PROFILE_EXTERNAL_ENABLED:t.hideProfileExternal=e.booleanValue;break;case Ue.UserSettingKey.OPT_OUT_PRESENCE:t.presenceOptOut=e.booleanValue;break;case Ue.UserSettingKey.SHARE_LOCATION:t.shareLocation=e.booleanValue;break;case Ue.UserSettingKey.VOICEMAIL_ENABLED:t.voicemailEnabled=e.booleanValue;break;case Ue.UserSettingKey.VOICEMAIL_NO_RECORDING:t.voicemailNoRecording=e.booleanValue;break;case Ue.UserSettingKey.VOICEMAIL_TIMEOUT:t.voicemailTimeout=e.numberValue;break;case Ue.UserSettingKey.VOICEMAIL_CUSTOMGREETING_ENABLED:t.voicemailCustomGreetingEnabled=e.booleanValue;break;case Ue.UserSettingKey.VOICEMAIL_CUSTOMGREETING_URI:t.voicemailCustomGreetingUri=e.stringValue?g()+"fileapi?fileid="+e.stringValue:null;break;case Ue.UserSettingKey.SECOND_TELEPHONY_CALL_ROUTING:t.busySetting=e.stringValue}}),t}function te(e){return new Promise(function(t,n){e.userId=l.loggedOnUser.userId,I.setPresence(e,function(e){v(e,n)||t()})})}function ne(e,t){return new Promise(function(n,i){I.getPresence(e,t,function(e,t){v(e,i)||n(t)})})}function ie(){return new Promise(function(t,n){I.renewToken(function(e){v(e,n)?Oe({type:"renewSessionTokenFailed",error:e}):(Le.debug("[SDK]: Session token renewed"),Oe({type:"sessionTokenRenewed"}),t())})})}function re(t){return Q().then(function(e){return e.some(function(e){return t?e.clientId===t:e.clientId!==l.loggedOnUser.clientId&&(e.clientInfo.deviceType===Ue.DeviceType.WEB||e.clientInfo.deviceType===Ue.DeviceType.APPLICATION&&"DESKTOP_APP"===e.clientInfo.deviceSubtype)})})}function oe(t){return Q().then(function(e){return e.some(function(e){return e.clientId===t})})}function ae(e){var t=f.CallControlSvc.findCall(e);return t||((t=f.CallControlSvc.getActiveCall(e))||null)}function se(e){return e.pin=e.tenantPIN+e.sessionPIN,e.link&&(e.link="https://"+l.domain+e.link),delete e.tenantPIN,delete e.sessionPIN,delete e.conversationId,e}function ce(e){return new Promise(function(t,n){e?f.CallControlSvc.endCall(e,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function le(r,o){return new Promise(function(t,e){var n={VGA:"",HD:Ge.VIDEO_720,FHD:Ge.VIDEO_1080},i={audio:!1,video:Circuit.WebRTCAdapter.getVideoOptions({sourceId:r,videoResolution:n[o]})};Circuit.WebRTCAdapter.getUserMedia(i,function(e){Circuit.WebRTCAdapter.stopMediaStream(e),t(o)},e)})}function de(n,i){return function(e){var t=e&&e.name;return"ConstraintNotSatisfiedError"===t||"OverconstrainedError"===t?le(n,i):Promise.reject(e)}}function ue(i,r){return new Promise(function(t,n){if(i){var e=ae(i);if(e)if(e.hasLocalScreenShare())f.CallControlSvc.removeMediaStream(i,function(e){_(e,n)||t()});else{if(!r)return void n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Missing MediaStream"));f.CallControlSvc.addMediaStream(i,r,function(e){_(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function Ee(r){return new Promise(function(e,t){if(void 0!==r){var n=f.CallControlSvc.getActiveCall();if(n){var i=n.sessionCtrl.getLocalStream(r);i?e(i):t("No stream found with id "+r)}else t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))}else t(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"id is required"))})}function Ce(e){if(e&&e.xmlElement){var t=C.exec(e.xmlElement);if(t&&t[1]){var n=t[1],i=n.indexOf("/fileapi");-1!==i&&(n=He.getOrigin()+n.slice(i))!==t[1]&&(e.xmlElement=e.xmlElement.replace(t[1],n))}}}var Te="content/images/icon-general-default-avatar",pe="content/images/icon-general-default-group-avatar",Se=["-blue","-green","-orange","-yellow"];function Ie(e){var t=0;if(e)for(var n=0;n<e.length;n++)t+=e.charCodeAt(n);return Se[t%Se.length]}function Ae(e,t){if("function"==typeof e)try{var n=e(t);if(n&&"object"==typeof n)return"function"==typeof n.then?n:Promise.resolve(n)}catch(e){Le.error("[SDK]: Error applying injector. ",e)}return Promise.resolve(t)}var Re=["activeMediaType","callId","convId","convType","cstaCallId","direction","establishedTime","isMeetingPointInvited","isRemote","isTelephonyCall","isTestCall","locallyMuted","localMediaType","localVideoStream","localVideoUrl","localStreams","mediaType","participants","peerUser","remoteAudioDisabled","remoteAudioStream","remoteAudioUrl","remotelyMuted","remoteVideoDisabled","remoteVideoStreams","recording","ringAllAllowed","ringAllMaxNumber","whiteboardEnabled"];function fe(t){if(!t)return Promise.resolve();var n={};return Re.forEach(function(e){try{n[e]=t[e]}catch(e){}}),n.state=t.state.name,n.isEstablished=t.state.established,Ae(Circuit.Injectors.callInjector,n)}function ve(e){if(!e)return Promise.resolve();var t=g();if(e.smallImageUri&&e.largeImageUri)e.avatar=t+"fileapi/"+e.userId+"_s.jpg?fileid="+e.smallImageUri,e.avatarLarge=t+"fileapi/"+e.userId+"_b.jpg?fileid="+e.largeImageUri,e.hasAvatar=!0;else{var n=Ie(e.userId);e.avatar=t+Te+n+".png",e.avatarLarge=t+Te+n+"-XL.png",e.hasAvatar=!1}return delete e.smallImageUri,delete e.largeImageUri,delete e.tenantId,delete e.roles,delete e.accountTemplateType,delete e.associatedGTCUserId,delete e.reroutingPhoneNumber,delete e.assignedPhoneNumbers,e.accounts&&e.accounts.length&&(e.tenantId=e.accounts[0].tenantId),e.hasPermission=function(t){if(!this.accounts||!t)return!1;var e=this.accounts[0],n=e&&e.permissions;return!!n&&n.some(function(e){return e.systemPermission===t})},Ae(Circuit.Injectors.userInjector,e)}function _e(i){if(!i)return Promise.resolve();switch(i.type){case Ue.ConversationItemType.TEXT:i.text.state===Ue.TextItemState.DELETED?i.text.content="":(i.attachments=i.attachments||[],i.externalAttachments=i.externalAttachments||[],"standard"===c.emoticonMode&&(i.text.content=He.standardizeEmoticon(i.text.content)),Me.retrievePrivateDataFromContent(i),!i.conceptboards||i.text.conceptboards&&i.text.conceptboards.length||(i.text.conceptboards=i.conceptboards),delete i.conceptboards,c.removeMentionHtml&&(i.text.content=He.removeMentionHtml(i.text.content)));break;case Ue.ConversationItemType.SYSTEM:i.system.affectedParticipants&&(i.system.affectedParticipants=i.system.affectedParticipants.map(function(e){return e.userId}))}return i.attachments&&i.attachments.length&&(i.attachments=i.attachments.filter(function(e){if(e.url=g()+"fileapi/"+encodeURIComponent(e.fileName)+"?fileid="+e.fileId+"&itemid="+e.itemId,e.fileName.startsWith(ke)){var t=e.fileName.substring(ke.length),n=i.attachments.find(function(e){return e.fileName===t});if(n)return n.thumbnailUrl=e.url,!(n.isImage=!0)}return!0})),Ae(Circuit.Injectors.itemInjector,i)}function ge(n){return new Promise(function(t){n&&n.topLevelItem?(Le.debug("[SDK]: Publicize the topLevelItem. convId = ",n.convId),_e(n.topLevelItem).then(function(){Le.debug("[SDK]: Publicized topLevelItem. convId = ",n.convId),t(n)}).catch(function(e){Le.error("[SDK]: Failed to publicize topLevelItem. ",e),t(n)})):t(n)})}function Ne(n){return new Promise(function(t){if(n&&n.parentItem){Le.debug("[SDK]: Publicize the thread. itemId = ",n.parentItem.intemId),n.comments=n.comments||[];var e=n.comments.slice(0);e.unshift(n.parentItem),Promise.all(e.map(_e)).then(function(){t(n)}).catch(function(e){Le.error("[SDK]: Failed to publicize thread. ",e),t(n)})}else t(n)})}function me(e){if(!e)return Promise.resolve();if(Le.debug("[SDK]: Publicize conversation. convId = ",e.convId),e.participants=e.participants.map(function(e){return e.userId}),e.moderators=e.moderators&&e.moderators.map(function(e){return e.userId}),e.isTelephonyConversation=e.convId===r,e.isSupportConversation=e.convId===o,e.type!==Ue.ConversationType.DIRECT){var t=g();if(e.conversationAvatar&&e.conversationAvatar.smallPictureId&&e.conversationAvatar.largePictureId)e.avatar=t+"avatar?convId="+e.convId+"&type=small&fileid="+e.conversationAvatar.smallPictureId,e.avatarLarge=t+"avatar?convId="+e.convId+"&type=large&fileid="+e.conversationAvatar.largePictureId,e.hasConversationAvatar=!0;else{var n=e.isDraft?"":Ie(e.convId);e.avatar=t+pe+n+".png",e.avatarLarge=t+pe+n+"-XL.png",e.hasConversationAvatar=!1}e.type===Ue.ConversationType.OPEN&&(e.type=be.COMMUNITY)}return Ae(Circuit.Injectors.conversationInjector,e).then(ge)}function he(e){if(!e)return Promise.resolve();var t=g();if(e.smallImageUri&&e.largeImageUri)e.avatar=t+"fileapi/"+e.userId+"_s.jpg?fileid="+e.smallImageUri,e.avatarLarge=t+"fileapi/"+e.userId+"_b.jpg?fileid="+e.largeImageUri,e.hasAvatar=!0;else{var n=Ie(e.userId);e.avatar=t+Te+n+".png",e.avatarLarge=t+Te+n+"-XL.png",e.hasAvatar=!1}return delete e.smallImageUri,delete e.largeImageUri,Ae(Circuit.Injectors.participantInjector,e)}function Oe(e){Le.debug("[SDK]: Enqueue "+e.type),T.push(e)}function De(){if(!p&&T.length){p=!0;try{var t=T.shift();if(Le.debug("[SDK]: Dequeue "+t.type+". Events left in the queue: "+T.length),!l.hasEventListener(t.type))return void Le.debug("[SDK]: There is no listener for this event");var e=[];e.push(t.user?ve(t.user):void 0),e.push(t.item?_e(t.item):void 0),e.push(t.conversation?me(t.conversation):void 0),e.push(t.call?fe(t.call):void 0),Promise.all(e).then(function(e){e[0]&&(t.user=e[0]),e[1]&&(t.item=e[1]),e[2]&&(t.conversation=e[2]),e[3]&&(t.call=e[3]),Le.debug("[SDK]: Dispatch ",t.type),l.dispatch(t)})}catch(e){Le.error("[SDK]: Error processing event queue. ",e)}finally{p=!1}}}return Object.defineProperty(l,"domain",{get:function(){return c.domain},set:function(e){c.domain=e},enumerable:!0,configurable:!1}),Object.defineProperty(l,"accessToken",{get:function(){return s},set:function(e){s=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"expiresAt",{get:function(){return d},enumerable:!0,configurable:!0}),Object.defineProperty(l,"connectionState",{get:function(){return t},enumerable:!0,configurable:!0}),Object.defineProperty(l,"getAudioVideoStats",{get:function(){var e=f.CallControlSvc.getActiveCall();if(!e)return function(){return Promise.reject(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))};var t=e.sessionCtrl.getCurrentPeerConnection();return t&&t.getStats?t.origGetStats?t.origGetStats.bind(t):t.getStats.bind(t):function(){return Promise.reject(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No PeerConnection present"))}},enumerable:!1,configurable:!1}),l.setOauthConfig=h,l.logon=function(e){var t,n;if(e){if("object"!=typeof e)return t="OAuth2 is the only supported authentication menthod. Basic Auth is not supported anymore.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));if(c.client_id&&c.client_secret)return t="Circuit.Client is created with client_id and client_secret (Client Credentials Grant), so no token should be passed to the logon API.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));if(c.client_id&&e.token)return t="Circuit.Client is created with client_id, so no API token should be passed to the logon API.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));if(!c.client_id&&!e.token)return t="Circuit.Client was not created with client_id, so API token should be passed to the logon API.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t))}else if(!c.client_id)return t="Login with a session cookie has been disabled. OAuth2 or API token are the only supported authentication method.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));return c.client_id&&c.client_secret?Y().then(D).then(W):c.client_id&&e&&e.username&&e.password?function(e,t){return new Promise(function(n,i){O({type:"POST",url:"https://"+l.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(c.client_id)},data:{username:e,password:t,grant_type:"password",scope:c.scope}}).then(function(e){var t=JSON.parse(e);t&&t.access_token&&"Bearer"===t.token_type?(s=t.access_token,d=t.expires_in&&Date.now()+1e3*t.expires_in,H(),n({accessToken:s})):(d=s=null,i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Internal error with Client Credentials Grant authentication")))}).catch(i)})}(e.username,e.password).then(D).then(W):c.client_id&&e&&e.accessToken?u||E||e.skipTokenValidation?D(e).then(W):(e.prompt&&(n="https://"+c.domain+"/dist/oauthLoading.html",l.oauthwin=N(n,450,520)),s=e.accessToken,G().then(function(){return e.prompt?P().then(function(){l.oauthwin.close(),l.oauthwin=null}).catch(w).then(W):W()}).catch(function(e){return l.oauthwin&&l.oauthwin.close(),l.oauthwin=null,Promise.reject(e)})):c.client_id?l.logonChecked?W():e&&e.logonChecked?U().then(G).then(P).then(W):(n="https://"+c.domain+"/dist/oauthLoading.html",l.oauthwin=N(n,450,520),U().then(G).then(P).then(function(){l.oauthwin.close(),l.oauthwin=null}).catch(M).then(W)):e&&e.token?D(e).then(W):Promise.reject(new Circuit.Error(Ue.ErrorCode.MISSING_REQUIRED_PARAMETER,"Missing credentials"))},l.logonCheck=function(){return U().then(G).then(P).then(function(){l.logonChecked=!0,i&&window.clearTimeout(i),i=window.setTimeout(function(){i=null,l.logonChecked=!1},5e3)})},l.changePassword=function(){return new Promise(function(n,i){var r=null,e=L(function(e){if(r&&window.clearInterval(r),!e||e.error){var t=e?e.error:"The password change failed";i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,t))}else n()}),t={client_id:c.client_id,redirect_uri:c.redirect_uri,response_type:"token",scope:c.scope||""};t.state=JSON.stringify({callback:e,display:"popup",redirect_uri:t.redirect_uri});var o="https://"+c.domain+"/oauth/changePassword?"+He.toQS(t),a=l.oauthwin||N(o,450,520);l.oauthwin=null,window.setTimeout(function(){a.location.href=o},500),r=window.setInterval(function(){a&&!a.closed||(r&&window.clearInterval(r),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)})},l.logout=function(e){return e?new Promise(function(e){function t(){d=s=null,I.disconnect(),window.clearInterval(S),l.dispatch({type:"connectionStateChanged",state:ye.Disconnected}),e()}var n=window.setTimeout(function(){n=null,t()},2e3);I.logout(function(){n&&(window.clearTimeout(n),t())})}):(d=s=null,I.disconnect(),Promise.resolve())},l.revokeToken=function(e){return new Promise(function(t,n){e=e||s,d=s=null,b();var i=window.setTimeout(function(){i=null,t()},2e3);I.revokeAccessToken(e,function(e){i&&(window.clearTimeout(i),e!==Ue.ReturnCode.DISCONNECTED&&v(e,n)||t())})})},l.setCookie=function(e){c.cookie=e},l.getCookie=function(){return c.cookie},l.isAuthenticated=P,l.validateToken=G,l.getLoggedOnUser=function(){return new Promise(function(n,i){l.loggedOnUser?n(l.loggedOnUser):I.getLoggedOnUser(function(e,t){v(e,i)||ve(t.user).then(function(e){l.loggedOnUser=e,f.SdkHelperSvc.setLocalUser(e),n(e)})})})},l.getTelephonyConversationId=function(){return new Promise(function(n,i){I.getTelephonyConversationId(function(e,t){v(e,i)||n(t)})})},l.getSupportConversationId=function(){return new Promise(function(n,i){I.getSupportConversationId(function(e,t){v(e,i)||n(t)})})},l.getSupportConversation=function(){return new Promise(function(n,i){X().then(function(e){e.supportType===Ue.SupportType.CONVERSATION?I.getSupportConversation(function(e,t){v(e,i)||me(t).then(n).catch(i)}):i(new Error(Ue.ReturnCode.SDK_ERROR,"supportType is not CONVERSATION"))}).catch(i)})},l.getSupportInfo=X,l.getTenantUsers=function(e){return new Promise(function(n,i){(e=e||{}).pageSize=e.pageSize||25,e.sorting=e.sorting||Ue.GetAccountsSorting.BY_FIRST_NAME,I.getAccounts(e,function(e,t){v(e,i)||Promise.all(t.accounts.map(function(e){return ve(e.user)})).then(n).catch(i)})})},l.getAccounts=function(e){return new Promise(function(i,n){(e=e||{}).pageSize=e.pageSize||25,e.sorting=e.sorting||Ue.GetAccountsSorting.BY_FIRST_NAME,I.getAccounts(e,function(e,t){v(e,n)||Promise.all(t.accounts.map(function(e){return ve(e.user)})).then(function(n){var e=t.accounts.map(function(e,t){return{account:e.account,user:n[t]}});i({accounts:e,searchPointer:t.searchPointer,hasMore:t.hasMoreResults})}).catch(n)})})},l.subscribePresence=function(e){return new Promise(function(t,n){I.subscribePresence(e,function(e){v(e,n)||t()})})},l.unsubscribePresence=function(e){return new Promise(function(t,n){I.unsubscribePresence(e,function(e){v(e,n)||t()})})},l.subscribeTenantPresence=function(){return new Promise(function(t,n){c.client_secret?I.subscribeTenantPresence(l.loggedOnUser.tenantId,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"API only allowed for bots"))})},l.unsubscribeTenantPresence=function(){return new Promise(function(t,n){c.client_secret?I.unsubscribeTenantPresence(l.loggedOnUser.tenantId,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"API only allowed for bots"))})},l.subscribeTypingIndicator=function(e){return new Promise(function(t,n){e?I.subscribe(e,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"convId is required"))})},l.unsubscribeTypingIndicator=function(e){return new Promise(function(t,n){e?I.unsubscribe(e,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"convId is required"))})},l.typing=function(e,i,r){return new Promise(function(t,n){e&&void 0!==i?I.typing(e,i,r,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"missing parameter"))})},l.renewSessionToken=ie,l.renewToken=k,l.getUserById=function(e){return new Promise(function(n,i){e?I.getUser(e,function(e,t){v(e,i)||ve(t).then(n).catch(i)}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId is required"))})},l.getUsersById=function(e,t){return new Promise(function(n,i){e?e.length?(t?I.getPartialUsersByIds:I.getUsersByIds)(e,function(e,t){v(e,i)||Promise.all(t.map(ve)).then(n).catch(i)}):n([]):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"userIds is required"))})},l.getUserByEmail=j,l.getUsersByEmail=function(t){return new Promise(function(n,i){if(t)if(t.length){var e={emailAddresses:t};I.getUsersByEmails(e,function(e,t){v(e,i)||Promise.all(t.map(ve)).then(n).catch(i)})}else n([]);else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"email is required"))})},l.updateUser=function(e){return new Promise(function(t,n){I.updateUser(e,function(e){v(e,n)||t()})})},l.getPresence=ne,l.setPresence=te,l.setStatusMessage=function(i){return new Promise(function(t,n){i=i||"",I.setUserSettings({key:Ue.UserSettingKey.STATUS_MESSAGE_TEXT,dataType:Ue.UserSettingDataType.STRING,stringValue:i},function(e){v(e,n)||ne([l.loggedOnUser.userId]).then(function(e){return te({state:e.length&&e[0].state,statusMessage:i})}).then(t).catch(n)})})},l.getStatusMessage=function(){return new Promise(function(i,r){I.getUserSettings([Ue.UserSettingArea.ALL],function(e,t){if(!v(e,r)){var n=t&&t.find(function(e){return e.key===Ue.UserSettingKey.STATUS_MESSAGE_TEXT});i(n?n.stringValue:"")}})})},l.setCallForwarding=function(e){return new Promise(function(t,n){e&&"object"==typeof e&&"boolean"==typeof e.status?f.CstaSvc.setForwardingImmediate(!!e.status,e.number,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"settings object with a status and phone number is required"))})},l.setUserSettings=function(i){return new Promise(function(t,n){if(i){var e=[];void 0!==i.presenceOptOut&&e.push({key:Ue.UserSettingKey.OPT_OUT_PRESENCE,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.presenceOptOut}),void 0!==i.shareLocation&&e.push({key:Ue.UserSettingKey.SHARE_LOCATION,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.shareLocation}),void 0!==i.voicemailEnabled&&e.push({key:Ue.UserSettingKey.VOICEMAIL_ENABLED,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.voicemailEnabled}),void 0!==i.voicemailNoRecording&&e.push({key:Ue.UserSettingKey.VOICEMAIL_NO_RECORDING,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.voicemailNoRecording}),void 0!==i.voicemailTimeout&&e.push({key:Ue.UserSettingKey.VOICEMAIL_TIMEOUT,dataType:Ue.UserSettingDataType.NUMBER,numberValue:i.voicemailTimeout}),void 0!==i.voicemailCustomGreetingEnabled&&e.push({key:Ue.UserSettingKey.VOICEMAIL_CUSTOMGREETING_ENABLED,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.voicemailCustomGreetingEnabled}),void 0!==i.hideProfileExternal&&e.push({key:Ue.UserSettingKey.HIDE_PROFILE_EXTERNAL_ENABLED,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.hideProfileExternal}),void 0!==i.busySetting&&e.push({key:Ue.UserSettingKey.SECOND_TELEPHONY_CALL_ROUTING,dataType:Ue.UserSettingDataType.STRING,stringValue:i.busySetting}),I.setUserSettings(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"userSettings is required"))})},l.getUserSettings=function(){return new Promise(function(n,i){I.getUserSettings([Ue.UserSettingArea.ALL],function(e,t){v(e,i)||n(ee(t))})})},l.uploadCustomVoicemailGreeting=function(e){return new Promise(function(n,i){e?new Pe.FileUpload(c).uploadFiles([e],l.domain).then(function(e){if(e&&e.length){var t=[{key:Ue.UserSettingKey.VOICEMAIL_CUSTOMGREETING_URI,dataType:Ue.UserSettingDataType.STRING,stringValue:e[0].fileId}];I.setUserSettings(t,function(e){v(e,i)||n()})}else i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"error uploading file"))}).catch(function(e){Le.error("[SDK]: Fileupload error.",e),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"file is required"))})},l.getDevices=Q,l.getConversations=function(t){return new Promise(function(n,i){(t=t||{}).numberOfConversations=t.numberOfConversations||25;var e=t.direction!==Ue.SearchDirection.AFTER;I.getConversations(l.loggedOnUser.userId,t.timestamp,e,t.numberOfConversations,Ue.ConversationFilter.ALL,function(e,t){v(e,i)||Promise.all(t.map(me)).then(n).catch(i)})})},l.getConversationTopics=function(n,i){return new Promise(function(r,o){var e=(i=i||{}).maxNumberOfTopics||void 0,t=i.timestamp||void 0;I.getConversationTopics(n,t,e,function(e,t,n){if(!v(e,o)){var i=[];(t=t||[]).forEach(function(t){Object.keys(t).forEach(function(e){i.push(t[e])})}),Promise.all(i.map(_e)).then(function(){r({conversationTopics:t,hasOlderTopics:n})}).catch(o)}})})},l.getMarkedConversations=function(){return new Promise(function(n,i){I.getMarkedConversationsList(function(e,t){v(e,i,!0)||n(t||[])})})},l.getFavoriteConversationIds=function(){return new Promise(function(n,i){I.getFavoriteConversationIds(function(e,t){v(e,i,!0)||n(t||[])})})},l.favoriteConversation=function(e){return new Promise(function(t,n){e?I.markConversation({convId:e,markType:Ue.ConversationMarkFilter.FAVORITE},function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.unfavoriteConversation=function(e){return new Promise(function(t,n){e?I.unmarkConversation({convId:e,markType:Ue.ConversationMarkFilter.FAVORITE},function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.archiveConversation=function(e){return new Promise(function(t,n){e?I.markConversation({convId:e,markType:Ue.ConversationMarkFilter.MUTE},function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.unarchiveConversation=function(e){return new Promise(function(t,n){e?I.unmarkConversation({convId:e,markType:Ue.ConversationMarkFilter.MUTE},function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.addLabels=function(e){return new Promise(function(n,i){Array.isArray(e)?(e=e.map(function(e){return{value:e}}),I.addLabels(e,function(e,t){v(e,i,!0)||n(t&&t.labels||[])})):i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Parameter must be an array of label names."))})},l.assignLabels=function(e,t){return new Promise(function(n,i){Array.isArray(t)?I.assignLabels(e,t,function(e,t){v(e,i)||n(t||[])}):i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Parameter must be an array of label Ids."))})},l.editLabel=function(e){return new Promise(function(n,i){I.editLabel(e,function(e,t){v(e,i,!0)||n(t)})})},l.getAllLabels=function(){return new Promise(function(n,i){I.getAllLabels(function(e,t){v(e,i,!0)||n(t||[])})})},l.removeLabels=function(e){return new Promise(function(n,i){Array.isArray(e)?I.removeLabels(e,function(e,t){v(e,i,!0)||n(t||[])}):i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Parameter must be an array of label Ids."))})},l.unassignLabels=function(e,t){return new Promise(function(n,i){Array.isArray(t)?I.unassignLabels(e,t,function(e,t){v(e,i)||n(t||[])}):i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Parameter must be an array of label Ids."))})},l.getConversationsByFilter=K,l.getConversationsByLabel=function(e,t){return e?((t=t||{}).filterConnector={conditions:[{filterTarget:Ue.FilterTarget.LABEL_ID,expectedValue:[e]}]},t.retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,K(t)):Promise.reject(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"labelId"))},l.getConversationsByType=function(e,t){return e?((t=t||{}).retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,t.number=t.number||25,t.filterConnector={conditions:[{filterTarget:Ue.FilterTarget.CONVERSATION_TYPE,expectedValue:[e]}],connectors:[{boolConnector:Ue.FilterBoolConnector.OR,conditions:[{filterTarget:Ue.FilterTarget.LABEL_ID,filterTargetComparator:Ue.FilterTargetComparator.NOT,expectedValue:[Ue.SystemLabel.ARCHIVED]}]}],boolConnector:Ue.FilterBoolConnector.AND},K(t)):new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"conversationType is required.")},l.getArchivedConversations=function(e){return(e=e||{}).filterConnector={conditions:[{filterTarget:Ue.FilterTarget.LABEL_ID,expectedValue:[Ue.SystemLabel.ARCHIVED]}]},e.retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,K(e)},l.getConversationById=q,l.getConversationsByIds=function(e){return new Promise(function(n,i){I.getConversationsByIds(e,function(e,t){v(e,i)||Promise.all(t.map(me)).then(n).catch(i)})})},l.getConversationParticipants=function(e,t){return new Promise(function(n,i){t=t||{},I.getConversationParticipants(e,t,function(e,t){v(e,i)||Promise.all(t.participants.map(he)).then(function(e){t.participants=e,n(t)}).catch(i)})})},l.getItemById=function(e){return new Promise(function(n,i){I.getItemById(e,function(e,t){v(e,i)||_e(t).then(n).catch(i)})})},l.getItemsById=function(e){return new Promise(function(n,i){I.getItemsByIds(e,function(e,t){v(e,i)||Promise.all(t.map(_e)).then(n).catch(i)})})},l.getConversationItems=function(e,t){return new Promise(function(n,i){(t=t||{}).modificationDate=t.modificationDate||void 0,t.creationDate=t.creationDate||t.creationTime||void 0,t.direction=t.direction||Ue.SearchDirection.BEFORE,t.numberOfItems=t.numberOfItems||25,I.getConversationItems(e,t.modificationDate,t.creationDate,t.direction,t.numberOfItems,function(e,t){v(e,i)||Promise.all(t.map(_e)).then(n).catch(i)})})},l.getConversationFeed=function(e,t){return new Promise(function(i,r){t=t||{},I.getConversationFeed(e,t.timestamp,t.minTotalItems,t.maxTotalUnread,t.commentsPerThread,t.maxUnreadPerThread,function(e,t,n){v(e,r)||Promise.all(t.map(Ne)).then(function(e){i({threads:e,hasOlderThreads:n})}).catch(r)})})},l.getItemsByThread=function(n,o,a){return new Promise(function(i,r){var e=(a=a||{}).modificationDate||a.creationDate,t=a.modificationDate?Ue.TimestampFilter.MODIFICATION:Ue.TimestampFilter.CREATION;I.getThreadComments(n,o,e,t,a.direction,a.number||a.numberOfItems,function(e,t,n){v(e,r)||Promise.all(t.map(_e)).then(function(e){i({items:e,hasMore:n})}).catch(r)})})},l.addTextItem=function(e,o){return new Promise(function(n,i){function t(e){e.mentionedUsers=He.createMentionedUsersArray(e.content),I.addTextItem(e,function(e,t){v(e,i)||_e(t).then(n).catch(i)})}if(e)if(o)if("string"==typeof o)t({convId:e,content:o,contentType:"RICH"});else if("object"==typeof o){var r={convId:e,parentId:o.parentId,contentType:o.contentType||Ue.TextItemContentType.RICH,subject:o.subject,content:o.content,form:o.form,externalAttachmentMetaData:o.externalAttachments};if(o.attachments&&0<o.attachments.length)new Pe.FileUpload(c).uploadFiles(o.attachments,l.domain).then(function(e){r.attachmentMetaData=[],e.forEach(function(e){r.attachmentMetaData.push(e)}),t(r)}).catch(function(e){Le.error("[SDK]: Fileupload error.",e),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))});else t(r)}else i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid content"));else i(new Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"content is required"));else i(new Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.updateTextItem=function(r){return new Promise(function(n,i){function t(){r.mentionedUsers=He.createMentionedUsersArray(r.content),I.updateTextItem(r,function(e,t){v(e,i)||_e(t).then(n).catch(i)})}r?r.itemId?"object"==typeof r?r.attachments&&0<r.attachments.length?new Pe.FileUpload(c).uploadFiles(r.attachments,l.domain).then(function(e){r.attachmentMetaData=[],e.forEach(function(e){r.attachmentMetaData.push(e)}),t()}).catch(function(e){Le.error("[SDK]: Fileupload error.",e),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))}):t():i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid content")):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"item.itemId is required")):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"))})},l.getJournalEntries=function(t){return new Promise(function(n,i){if(t=t||{},r){var e={convId:r,timestamp:t.timestamp||void 0,direction:t.direction||Ue.SearchDirection.BEFORE,numberOfEntries:t.numberOfEntries||25,journalFilter:t.journalFilter||Ue.JournalFilter.ALL};I.getJournalEntries(e,function(e,t){v(e,i)||(t=t||[],Promise.all(t.map(_e)).then(n).catch(i))})}else i(new Error(Ue.ReturnCode.SDK_ERROR,"no telephony conversation found"))})},l.getDirectConversationWithUser=J,l.addParticipant=function(r,o,a){return new Promise(function(t,i){var e={convId:r,userId:o};I.addParticipant(e,function(e,n){v(e,i)||(me(n.conversation).then(t).catch(i),a&&f.SdkHelperSvc.getConversationPromise(r).then(function(e){if(e.call)if(n.conversation.convId===e.convId){var t=o.map(function(e){return{userId:e}});f.PubSubSvc.publish("/conversation/participants/add",[e.call,t])}else f.PubSubSvc.publish("/conversation/upgrade",[e,n.conversation])}))})})},l.removeParticipant=function(e,i){return new Promise(function(t,n){I.removeParticipant(e,i,function(e){v(e,n)||t()})})},l.getFlaggedItems=function(){return new Promise(function(n,i){I.getFlaggedItems(function(e,t){v(e,i,!0)||n(t||[])})})},l.flagItem=function(e,i){return new Promise(function(t,n){I.setFlagItem({convId:e,itemId:i},function(e){v(e,n)||t()})})},l.unflagItem=function(e,i){return new Promise(function(t,n){I.clearFlagItem(e,i,function(e){v(e,n)||t()})})},l.likeItem=function(e){return new Promise(function(t,n){I.likeTextItem(e,l.loggedOnUser.userId,function(e){v(e,n)||t()})})},l.unlikeItem=function(e){return new Promise(function(t,n){I.unlikeTextItem(e,l.loggedOnUser.userId,function(e){v(e,n)||t()})})},l.markItemsAsRead=function(e,i){return new Promise(function(t,n){i=i||Date.now(),I.setReadPointer(e,i,function(e){v(e,n)||t()})})},l.moderateConversation=function(e){return new Promise(function(n,i){e?I.moderateConversation(e,function(e,t){v(e,i)||(t&&"LOCK_OK"===t.moderateResult?n():i(t))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.unmoderateConversation=function(e){return new Promise(function(n,i){e?I.unmoderateConversation(e,function(e,t){v(e,i)||(t&&"UNLOCK_OK"===t.moderateResult?n():i(t))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.grantModeratorRights=function(e,t){return new Promise(function(n,i){e&&t?I.grantModeratorRights(e,t,function(e,t){v(e,i)||(t&&"GRANT_OK"===t.grantModeratorResult?n():i(t))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))})},l.dropModeratorRights=function(e,t){return new Promise(function(n,i){e&&t?I.dropModeratorRights(e,t,function(e,t){v(e,i)||(t&&"DROP_OK"===t.dropModeratorResult?n():i(t))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))})},l.enableGuestAccess=function(e){return Z(e,!1)},l.disableGuestAccess=function(e){return Z(e,!0)},l.createDirectConversation=function(e){return e&&"string"==typeof e?e.match(He.EMAIL_ADDRESS_PATTERN)?j(e).then(function(e){return e.userId}).then($):$(e):Promise.reject(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participant email or user ID is required"))},l.createGroupConversation=function(t,r){return new Promise(function(n,i){if(t)if(-1===t.indexOf(l.loggedOnUser.userId)&&t.unshift(l.loggedOnUser.userId),t.length<2)i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"At least one participant (other than self) is required"));else if(-1<t.indexOf("")||-1<t.indexOf(null))i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Participant cannot be empty"));else{t=t.map(function(e){return{userId:e}});var e={type:Ue.ConversationType.GROUP,participants:t,topic:r};I.createConversation(e,function(e,t){v(e,i)||me(t).then(n).catch(i)})}else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participants is required"))})},l.createConferenceBridge=function(t){return new Promise(function(n,i){if(t){var e={type:Ue.ConversationType.GROUP,participants:[{userId:l.loggedOnUser.userId}],topic:t};I.createConversation(e,function(e,t){v(e,i)||me(t).then(n).catch(i)})}else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Topic is required"))})},l.createCommunity=function(t,r,o){return new Promise(function(n,i){t&&t.length||(t=[l.loggedOnUser.userId]),t=t.map(function(e){return{userId:e}});var e={type:Ue.ConversationType.OPEN,participants:t,topic:r,description:o};I.createConversation(e,function(e,t){v(e,i)||me(t).then(n).catch(i)})})},l.joinCommunity=function(e){return new Promise(function(n,i){e?I.joinOpenConversation(e,function(e,t){v(e,i)||n(t)}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.updateConversation=function(t,r){return new Promise(function(n,i){var e={conversationId:t,topic:r.topic||void 0,description:r.description||void 0};I.updateConversation(e,function(e,t){v(e,i)||me(t).then(n).catch(i)})})},l.findCall=function(e){return Promise.resolve(fe(ae(e)))},l.getCalls=function(){return Promise.all(f.CallControlSvc.getCalls().map(fe))},l.getActiveCall=function(){return Promise.resolve(fe(f.CallControlSvc.getActiveCall()))},l.getActiveRemoteCalls=function(){return Promise.all(f.CallControlSvc.getActiveRemoteCall().map(fe))},l.getStartedCalls=function(){var e=f.CallControlSvc.getCalls().filter(function(e){return e.state.name===Circuit.Enums.CallState.Started.name}).map(fe);return Promise.all(e)},l.getConferenceInvitationText=function(e,t){return new Promise(function(n,i){I.getConferenceInvitationText(e,t,function(e,t){v(e,i)||n(t)})})},l.startConference=function(n,o,a){return q(n).then(function(e){return new Promise(function(i,r){e?a&&a!==l.loggedOnUser.clientId?oe(a).then(function(e){if(e){var t={content:{type:"START_CONFERENCE_REQUEST",mediaType:o.video?"video":"audio",convId:n,sdk:!0},destUserId:l.loggedOnUser.userId,destClientId:a};A.sendContactCardRequest(t,function(e,t){if(e)r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e));else{var n=t.response&&t.response.data;n?i(n):r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Invalid response for START_CONFERENCE_REQUEST"))}})}else r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No client found for clientId "+a))}):(f.SdkHelperSvc.addConversationToCache(e),f.CallControlSvc.startConference(e.convId,o,function(e,t,n){_(e,r)||fe(n).then(i).catch(r)})):r(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Conversation does not exist"))})})},l.getConversationDetails=function(e){return new Promise(function(n,i){I.getJoinDetails(e,!1,function(e,t){v(e,i)||n(se(t))})})},l.changeConversationPin=function(e){return new Promise(function(n,i){I.getJoinDetails(e,!0,function(e,t){v(e,i)||n(se(t))})})},l.joinConference=function(r,o,a){return new Promise(function(n,i){r?a&&a!==l.loggedOnUser.clientId?oe(a).then(function(e){if(e){var t={content:{type:"JOIN_CONFERENCE_REQUEST",callId:r,mediaType:o},destUserId:l.loggedOnUser.userId,destClientId:a};A.sendContactCardRequest(t,function(e,t){e?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t&&t.response?t.response.code&&"OK"!==t.response.code?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,t.response.code)):n():i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Invalid response for JOIN_CONFERENCE_REQUEST"))})}else i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No client found for clientId "+a))}):f.CallControlSvc.joinGroupCall(r,o,function(e){_(e,i)||n()}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.pullRemoteCall=function(e,i){return new Promise(function(t,n){e?f.CallControlSvc.pullRemoteCall(e,i,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.leaveConference=ce,l.endConference=function(e){return new Promise(function(t,n){e?f.CallControlSvc.endConference(e,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.setMediaDevices=function(i){return new Promise(function(t,e){if(i)if(i.playback||i.recording||i.video||i.ringing){i.playback&&(i.playback=Array.isArray(i.playback)?i.playback:[i.playback],R.playbackDevices=i.playback.map(function(e){return{id:e}})),i.recording&&(i.recording=Array.isArray(i.recording)?i.recording:[i.recording],R.recordingDevices=i.recording.map(function(e){return{id:e}})),i.video&&(i.video=Array.isArray(i.video)?i.video:[i.video],R.videoDevices=i.video.map(function(e){return{id:e}})),i.ringing&&(i.ringing=Array.isArray(i.ringing)?i.ringing:[i.ringing],R.ringingDevices=i.ringing.map(function(e){return{id:e}}));var n=f.CallControlSvc.getActiveCall();n?f.CallControlSvc.renegotiateMedia(n.callId,function(e){e&&Le.warn("[SDK]: Unable to renegotiate media.",e),t()}):t()}else e(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices must contain playback, recording, video or ringing attributes"));else e(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices is required"))})},l.makeCall=function(e,t,n){return J(e,n).then(function(e){return new Promise(function(i,r){e?((t&&t.videoResolution&&t.videoResolution===Circuit.Enums.VideoResolutionLevel.VIDEO_720||t.videoResolution===Circuit.Enums.VideoResolutionLevel.VIDEO_1080)&&(t.hdVideo=!0),f.SdkHelperSvc.addConversationToCache(e),f.CallControlSvc.makeCall(e.convId,t,function(e,t,n){_(e,r)||fe(n).then(i).catch(r)})):r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Conversation does not exist"))})})},l.endRemoteCall=function(e){return new Promise(function(t,n){e?f.CallControlSvc.endRemoteCall(e,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.dropParticipant=function(e,i){return new Promise(function(t,n){e?f.CallControlSvc.dropParticipant(e,{userId:i},function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.muteParticipant=function(e,i){return new Promise(function(t,n){e?f.CallControlSvc.muteParticipant(e,{userId:i},function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.muteRtcSession=function(e){return new Promise(function(t,n){e?f.CallControlSvc.muteRtcSession(e,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.getCallDevices=function(){return f.CallControlSvc.getCallDevices().map(function(e){return e.name})},l.getPushDevices=function(){return f.CallControlSvc.getPushDevices().map(function(e){return e.name})},l.getAnswerDevices=function(e){return f.CallControlSvc.getAnswerDevices(e).map(function(e){return e.name})},l.getAtcCalls=f.CallControlSvc.getAtcCalls,l.dialNumber=function(e,t){return new Promise(function(i,r){He.PHONE_PATTERN.test(e||null)?f.CallControlSvc.dialNumber(e,t,{audio:!0,video:!1},function(e,t,n){_(e||t,r)||fe(n).then(i).catch(r)}):r(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid number"))})},l.getTelephonyData=f.SdkHelperSvc.getTelephonyData,l.sendDigits=function(e,i){return new Promise(function(t,n){/^[\d#*,]+$/.exec(i)?f.CallControlSvc.sendDigits(e,i,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid DTMF digits (Allowed: 0-9,#,*)"))})},l.sendClickToCallRequest=function(a,s,n,c){return new Promise(function(i,r){if(a){s=s||"audio";var e=a.match(He.PHONE_DIAL_PATTERN),o=e&&e.length&&e[0];o&&(a=null),n?oe(n).then(function(e){e?t(n):r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No client found for clientId "+n))}):re().then(function(e){e?t():c?r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set.")):function(){var e,t=l.domain.startsWith("sdk.")?l.domain.substr(4):l.domain;e=o?"https://"+t+"/#/phone?number="+o:"https://"+t+"/#/call?user="+a+"&media="+s;var n=window.open(e,"_blank");n?(n.focus(),i({type:"CALL_VIA_URL",win:n})):r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Popup blocker prevented opening Circuit in new window"))}()})}else r(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"emailAddress is required"));function t(e){var t={content:{type:"CLICK_TO_CALL_REQUEST",mediaType:o?"telephony":s,contact:{email:a,phoneNumber:o},promptBeforeDial:!e,sdk:!0},destUserId:l.loggedOnUser.userId};e&&(t.destClientId=e),A.sendContactCardRequest(t,function(e){e?r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):i({type:"CALL_VIA_OTHER_CLIENT"})})}})},l.sendClickToAnswerRequest=function(r,o,a){return new Promise(function(n,i){function t(e){var t={content:{type:"CLICK_TO_ANSWER_REQUEST",mediaType:o,callId:r,promptBeforeAnswer:!e,sdk:!0},destUserId:l.loggedOnUser.userId};e&&(t.destClientId=e),A.sendContactCardRequest(t,function(e){e?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):n({type:"ANSWER_VIA_OTHER_CLIENT"})})}o=o||"audio",a?oe(a).then(function(e){e?t(a):i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No client found for clientId "+a))}):re().then(function(e){e?t():i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set."))})})},l.muteDevice=function(r,o,a){return new Promise(function(n,i){r?(void 0===(a=a||{}).mic&&(a.mic=!0),void 0===a.speaker&&(a.speaker=!0),re(o).then(function(e){if(e){var t={content:{type:"MUTE_DEVICE_REQUEST",callId:r,option:a},destUserId:l.loggedOnUser.userId,destClientId:o,sdk:!0};A.sendContactCardRequest(t,function(e,t){e?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t&&t.response?t.response.code&&"OK"!==t.response.code?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,t.response.code)):n():i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Invalid response for MUTE_DEVICE_REQUEST"))})}else i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Device not found"))})):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.addParticipantToCall=function(r,e){return new Promise(function(t,n){if(r)if(e)if(e.userId||e.email||e.number){var i={userId:e.userId||void 0,dialOutPhoneNumber:e.number||void 0,displayName:e.displayName||void 0};!e.userId&&e.email&&e.email.match(He.EMAIL_ADDRESS_PATTERN)?j(e.email).then(function(e){i.userId=e.userId,f.CallControlSvc.addParticipantToCall(r,i,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}).catch(n):f.CallControlSvc.addParticipantToCall(r,i,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.addParticipantToRtcSession=function(r,e){return new Promise(function(t,n){if(r)if(e)if(e.userId||e.email||e.number){var i={userId:e.userId||void 0,dialOutPhoneNumber:e.number||void 0,displayName:e.displayName||void 0};!e.userId&&e.email&&e.email.match(He.EMAIL_ADDRESS_PATTERN)?j(e.email).then(function(e){i.userId=e.userId,f.CallControlSvc.addParticipantToRtcSession(r,i,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}).catch(n):f.CallControlSvc.addParticipantToRtcSession(r,i,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.answerCall=function(e,i,r){return new Promise(function(t,n){e?f.CallControlSvc.answerCallOnDevice(e,i,r&&we[r],function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.endCall=ce,l.toggleVideo=function(e){return new Promise(function(t,n){e?f.CallControlSvc.toggleVideo(e,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.changeHDVideo=function(e,i,r){return new Promise(function(t,n){e?(i=!!i,f.CallControlSvc.changeHDVideo(e,i,function(e){_(e,n)||t()},r)):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.changeVideoResolution=function(e,i){return new Promise(function(t,n){e?i?f.CallControlSvc.changeVideoResolution(e,i,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"resolution is required")):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.getMaxVideoResolution=function(e){return e?le(e,Circuit.Enums.VideoResolution.FHD).catch(de(e,Circuit.Enums.VideoResolution.HD)).catch(de(e,Circuit.Enums.VideoResolution.VGA)).catch(function(){return Promise.reject("No video supported for deviceId: "+e)}):Promise.reject(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"deviceId is required"))},l.toggleRemoteAudio=function(i){return new Promise(function(e,t){if(i){var n=ae(i);n?(n.remoteAudioDisabled?f.CallControlSvc.enableRemoteAudio(i):f.CallControlSvc.disableRemoteAudio(i),e(i)):t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))}else t(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.toggleRemoteVideo=function(e){return new Promise(function(t,n){e?f.CallControlSvc.toggleRemoteVideo(e,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.toggleScreenShare=function(i){return new Promise(function(t,n){if(i){var e=ae(i);e?e.hasLocalScreenShare()?f.CallControlSvc.removeScreenShare(i,function(e){_(e,n)||t()}):f.CallControlSvc.addScreenShare(i,null,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.setScreenshareStream=ue,l.toggleMediaStream=ue,l.getLocalAudioVideoStream=Ee.bind(l,R.LOCAL_STREAMS.AUDIO_VIDEO),l.getLocalScreenshareStream=Ee.bind(l,R.LOCAL_STREAMS.DESKTOP),l.setAudioVideoStream=function(e,r,o){return new Promise(function(t,n){if(e)if(r){var i=ae(e);i?Circuit.WebRTCAdapter.origGetUserMedia?n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Already setting another audio/video stream")):(o=o||{audio:!!r.getAudioTracks().length,video:!!r.getVideoTracks().length},Circuit.WebRTCAdapter.origGetUserMedia=Circuit.WebRTCAdapter.getUserMedia,Circuit.WebRTCAdapter.getUserMedia=function(e,t){t&&t(r)},i.sessionCtrl.dontReuseAudioStream=!0,f.CallControlSvc.setMediaType(e,o,function(e){i.sessionCtrl.dontReuseAudioStream=!1,Circuit.WebRTCAdapter.getUserMedia=Circuit.WebRTCAdapter.origGetUserMedia,delete Circuit.WebRTCAdapter.origGetUserMedia,_(e,n)||t()})):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"stream is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.startRecording=function(i,r,o){return new Promise(function(t,n){if(i){var e=f.CallControlSvc.getActiveCall();e?i===e.callId?f.CallControlSvc.startRecording(function(e){_(e,n)||t()},r,o):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Call ID is not for active call")):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No active call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.stopRecording=function(i,r){return new Promise(function(t,n){if(i){var e=f.CallControlSvc.getActiveCall();e?i===e.callId?f.CallControlSvc.stopRecording(function(e){_(e,n)||t()},r):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Call ID is not for active call")):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No active call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.switchRecordingLayout=function(i,r){return new Promise(function(t,n){if(i){var e=f.CallControlSvc.getActiveCall();e?i===e.callId?f.CallControlSvc.switchRecordingLayout(r,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Call ID is not for active call")):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No active call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.deleteRecording=function(e){return new Promise(function(t,n){I.deleteRecording(e,function(e){v(e,n)||t()})})},l.mute=function(e){return new Promise(function(t,n){e?f.CallControlSvc.mute(e,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.unmute=function(e){return new Promise(function(t,n){e?f.CallControlSvc.unmute(e,function(e){_(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.getLastRtpStats=function(e){if(!e)throw new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var t=ae(e);return t&&t.sessionCtrl?t.savedRTPStats||[]:null},l.getRemoteStreams=function(e){if(!e)throw new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var t=ae(e);return t&&t.sessionCtrl?t.sessionCtrl.getRemoteStreams()||[]:null},l.enableWhiteboard=function(i,r){return new Promise(function(t,n){if(i)if(r){var e={rtcSessionId:i,viewbox:r};I.enableWhiteboard(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"viewbox is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.disableWhiteboard=function(i){return new Promise(function(t,n){if(i){var e={rtcSessionId:i};I.disableWhiteboard(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.addWhiteboardElement=function(i,r){return new Promise(function(t,n){if(i)if(r){var e={rtcSessionId:i,xmlElement:r};I.addWhiteboardElement(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.removeWhiteboardElement=function(i,r){return new Promise(function(t,n){if(i)if(r){var e={rtcSessionId:i,xmlId:r};I.removeWhiteboardElement(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.updateWhiteboardElement=function(i,r,o){return new Promise(function(t,n){if(i)if(r)if(o){var e={rtcSessionId:i,xmlId:r,xmlElement:o};I.updateWhiteboardElement(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.clearWhiteboard=function(i,r,o){return new Promise(function(t,n){if(i){var e={rtcSessionId:i,userId:r||void 0,preserveBackground:o||void 0};I.clearWhiteboard(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.getWhiteboard=function(t){return new Promise(function(n,i){if(t){var e={rtcSessionId:t};I.getWhiteboard(e,function(e,t){v(e,i)||(t.elements&&t.elements.forEach(Ce),t.callId=t.rtcSessionId,delete t.rtcSessionId,n(t))})}else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.setWhiteboardBackground=function(r,t){return new Promise(function(n,i){if(r)if(t)if("object"==typeof t)new Pe.FileUpload(c).uploadWhiteboardFile(t,r).then(function(e){var t={rtcSessionId:r,url:e.url};I.setWhiteboardBackground(t,function(e){v(e,i)||n()})}).catch(function(e){Le.error("[SDK]: File upload error. ",e),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))});else if("string"==typeof t){var e={rtcSessionId:r,url:t};I.setWhiteboardBackground(e,function(e){v(e,i)||n()})}else i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"file must be a File object or a string"));else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"file is required"));else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.clearWhiteboardBackground=function(i){return new Promise(function(t,n){if(i){var e={rtcSessionId:i};I.clearWhiteboardBackground(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.toggleWhiteboardOverlay=function(i){return new Promise(function(t,n){if(i){var e={rtcSessionId:i};I.toggleWhiteboardOverlay(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.undoWhiteboard=function(i,r,o){return new Promise(function(t,n){if(i){var e={rtcSessionId:i,steps:r,userId:o||void 0};I.undoWhiteboard(e,function(e){v(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.startUserSearch=function(e){return"string"==typeof e&&(e={query:e}),new Promise(function(n,i){I.startUserSearch(e,function(e,t){e?i(e):n(t)})})},l.startBasicSearch=function(e){var t;return t="string"==typeof e?{scope:Ue.SearchScope.ALL,searchTerm:e}:e,new Promise(function(n,i){I.startBasicSearch(t,null,function(e,t){e?i(e):n(t)})})},l.startAdvancedUserSearch=function(t){return new Promise(function(n,i){if(t)if("object"==typeof t&&t.query){var e={searchContext:t.searchContext||Circuit.Enums.SearchContext.USER,query:t.query,searchExactAssignedPhoneNumber:t.searchExactAssignedPhoneNumber||!1,resultSetLimit:0};I.startAdvancedUserSearch(e,function(e,t){v(e,i)||n(t)})}else i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"query needs to be an object containing the property to be queried"));else i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"missing parameter"))})},l.cancelSearch=function(e){return new Promise(function(t,n){I.cancelSearch(e,function(e){v(e,n)||t()})})},l.submitForm=function(e,i){return new Promise(function(t,n){I.submitFormData(e,i,function(e){v(e,n)||t()})})},l.createIncomingWebhook=function(e){return new Promise(function(n,i){e&&"object"==typeof e?e.conversationId?I.createIncomingWebhook(e,function(e,t){v(e,i)||n(t)}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Object must contain a conversation Id")):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"newWebhookData must be an object"))})},l.deleteIncomingWebhook=function(e){return new Promise(function(t,n){e&&"string"==typeof e?I.deleteIncomingWebhook(e,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be deleted"))})},l.getIncomingWebhook=function(e){return new Promise(function(n,i){e&&"string"==typeof e?I.getIncomingWebhook(e,function(e,t){v(e,i)||n(t)}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be retrieved"))})},l.getIncomingWebhooks=function(e){return new Promise(function(n,i){if(e&&"object"==typeof e){if(e.tenantId)e.filter=Ue.CPasSIncomingWebhookFilter.TENANT;else if(e.userId)e.filter=Ue.CPasSIncomingWebhookFilter.USER;else{if(!e.conversationId)return void i("Missing id for filtering");e.filter=Ue.CPasSIncomingWebhookFilter.CONVERSATION}I.getIncomingWebhooks(e,function(e,t){v(e,i)||n(t)})}else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"searchCondition must be an object"))})},l.suspendIncomingWebhook=function(e){return new Promise(function(t,n){e&&"string"==typeof e?I.suspendIncomingWebhook(e,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be suspended"))})},l.unsuspendIncomingWebhook=function(e){return new Promise(function(t,n){e&&"string"==typeof e?I.unsuspendIncomingWebhook(e,function(e){v(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be unsuspended"))})},l.updateIncomingWebhook=function(e){return new Promise(function(n,i){e&&"object"==typeof e?e.webhookId?I.updateIncomingWebhook(e,function(e,t){v(e,i)||n(t)}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Object must contain a webhook Id")):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"updateWebhookData must be an object"))})},l.sendAppMessageToUser=function(i,r,o){return new Promise(function(t,n){if(i&&"string"==typeof i)if(r&&"string"==typeof r)if(o&&"object"==typeof o){var e={content:{type:i,message:o},destUserId:r};A.sendSdkRequest(e,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId [string] is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"))})},l.sendAppMessageToClient=function(i,r,o){return new Promise(function(t,n){if(i&&"string"==typeof i)if(r&&"string"==typeof r)if(o&&"object"==typeof o){var e={content:{type:i,message:o},destUserId:l.loggedOnUser.userId,destClientId:r};A.sendSdkRequest(e,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"destClientId [string] is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"))})},l.addAppMessageListener=function(e,t){A.on("SDK."+e,t)},l.removeAppMessageListener=A.off,f.PubSubSvc.subscribe("/localUser/update",function(){Oe({type:"loggedOnUserUpdated",user:l.loggedOnUser})}),I.on("Conversation.ADD_ITEM",function(e){Oe({type:"itemAdded",item:e.item})}),I.on("Conversation.UPDATE_ITEM",function(e){Oe({type:"itemUpdated",item:e.item})}),I.on("Conversation.FLAG_ITEM",function(e){Oe({type:"itemFlagged",convId:e.convId,itemId:e.conversationItemId})}),I.on("Conversation.CLEAR_FLAGGED_ITEM",function(e){Oe({type:"itemUnflagged",convId:e.convId,itemId:e.conversationItemId})}),I.on("Conversation.CREATE",function(e){Oe({type:"conversationCreated",conversation:e.conversation})}),I.on("Conversation.UPDATE",function(e){Oe({type:"conversationUpdated",conversation:e.conversation})}),f.PubSubSvc.subscribe("/conversation/new",function(e){Oe({type:"conversationUpdated",conversation:e})}),I.on("Conversation.CONVERSATION_MARKED",function(e){switch(e.filter){case Ue.ConversationMarkFilter.MUTE:Oe({type:"conversationArchived",convId:e.convId});break;case Ue.ConversationMarkFilter.FAVORITE:Oe({type:"conversationFavorited",convId:e.convId})}}),I.on("Conversation.CONVERSATION_UNMARKED",function(e){switch(e.filter){case Ue.ConversationMarkFilter.MUTE:Oe({type:"conversationUnarchived",convId:e.convId});break;case Ue.ConversationMarkFilter.FAVORITE:Oe({type:"conversationUnfavorited",convId:e.convId})}}),I.on("ConversationUserData.LABELS_ADDED",function(e){Oe({type:"labelsAdded",labels:e.labelsAdded})}),I.on("ConversationUserData.LABEL_EDITED",function(e){Oe({type:"labelEdited",label:e.labelEdited})}),I.on("ConversationUserData.LABELS_REMOVED",function(e){Oe({type:"labelsRemoved",labelIds:e.labelsRemoved})}),I.on("Conversation.USER_DATA_CHANGED",function(e){Oe({type:"conversationUserDataChanged",data:e})}),I.on("Conversation.READ_ITEMS",function(e){Oe({type:"conversationReadItems",data:e})}),I.on("User.USER_PRESENCE_CHANGE",function(e){Oe({type:"userPresenceChanged",presenceState:e.newState})}),I.on("User.TENANT_PRESENCE_CHANGE",function(e){e.newState.forEach(function(e){Oe({type:"userPresenceChanged",presenceState:e})})}),I.on("Conversation.TYPING",function(e){Oe({type:"typing",data:e})}),I.on("User.USER_UPDATED",function(e){Oe({type:"userUpdated",user:e.user})}),I.addEventListener("connectionStateChange",function(e){t===ye.Reconnecting&&e.newState===ye.Connected&&x().catch(function(e){Le.error("Error initializing websocket on reconenct",e)}),t=e.newState,Oe({type:"connectionStateChanged",state:e.newState})}),I.addEventListener("reconnectFailed",function(){Oe({type:"reconnectFailed"}),c.client_secret&&Y().then(D).then(W).catch(function(e){Le.error("Error re-authenticating on auto-reconnect for client credentials grant",e)})}),I.on("User.SESSION_EXPIRES",function(){l.loggedOnUser&&ie()}),I.on("User.SESSION_EXPIRING",function(){Oe({type:"sessionExpiring"})}),I.on("User.SESSION_CLOSED",function(e){Oe({type:"sessionClosed",reason:e.reason})}),I.on("User.PASSWORD_CHANGED",function(){Oe({type:"passwordChanged"})}),I.on("User.USER_SETTING_UPDATED",function(e){var t=ee(e.settings);0<Object.keys(t).length&&Oe({type:"userSettingsChanged",userSettings:t})}),I.on("Search.BASIC_SEARCH_RESULT",function(e){Oe({type:"basicSearchResults",data:e})}),I.on("Search.SEARCH_STATUS",function(e){Oe({type:"searchStatus",data:e})}),I.on("System.MAINTENANCE",function(e){Oe({type:"systemMaintenance",data:e})}),I.on("User.USER_DELETED",function(e){Oe({type:"userDeleted",data:e})}),I.on("Conversation.DELETE",function(e){Oe({type:"conversationDeleted",convId:e.convId})}),I.on("RTCSession.WHITEBOARD_ENABLED",function(e){var t=ae(e.sessionId);t&&(Oe({type:"whiteboardEnabled",enabled:t.whiteboardEnabled=!0,whiteboard:e.whiteboard,data:{enabled:!0,whiteboard:e.whiteboard}}),Oe({type:"callStatus",call:t,reason:"whiteboardEnabled"}))}),I.on("RTCSession.WHITEBOARD_DISABLED",function(e){var t=ae(e.sessionId);t&&(Oe({type:"whiteboardEnabled",enabled:t.whiteboardEnabled=!1,data:{enabled:!1}}),Oe({type:"callStatus",call:t,reason:"whiteboardEnabled"}))}),I.on("RTCSession.WHITEBOARD_CLEARED",function(e){Oe({type:"whiteboardCleared",userId:e.userId,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_ELEMENT_ADDED",function(e){Ce(e.element),Oe({type:"whiteboardElement",action:"added",element:e.element,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_ELEMENT_REMOVED",function(e){Oe({type:"whiteboardElement",action:"removed",elementId:e.elementId,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_ELEMENT_UPDATED",function(e){Ce(e.element),Oe({type:"whiteboardElement",action:"updated",element:e.element,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_BACKGROUND_SET",function(e){Ce(e.element),Oe({type:"whiteboardBackground",action:"set",element:e.element,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_BACKGROUND_CLEARED",function(){Oe({type:"whiteboardBackground",action:"cleared"})}),I.on("RTCSession.WHITEBOARD_OVERLAY_TOGGLED",function(){Oe({type:"whiteboardOverlayToggled"})}),I.on("RTCSession.WHITEBOARD_SYNC",function(e){Oe({type:"whiteboardSync",whiteboard:e.whiteboard,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_CONVERSION_FAILED",function(e){Oe({type:"whiteboardConversionFailed",callId:e.sessionId,errorText:e.errorText,lastElements:e.lastElements})}),I.on("ActivityStream.ACTIVITY_CREATED",function(e){e.navigableItem&&e.navigableItem.mention&&Oe({type:"mention",mention:e.navigableItem.mention})}),I.on("CPAAS.SUBMIT_FORM_DATA",function(e){Oe({type:"formSubmission",itemId:e.itemId,form:e.form,submitterId:e.submitterId})}),f.PubSubSvc.subscribe("/call/incoming",function(e){Oe({type:"callIncoming",call:e})}),u&&f.PubSubSvc.subscribe("/call/warmupFailed",function(e,t){Oe({type:"callIncoming",call:t})}),f.PubSubSvc.subscribe("/call/state",function(e){Oe({type:"callStatus",call:e,reason:"callStateChanged"})}),f.PubSubSvc.subscribe("/call/remoteStreamUpdated",function(e){Oe({type:"callStatus",call:e,reason:"remoteStreamUpdated"})}),f.PubSubSvc.subscribe("/call/localStreamEnded",function(e){Oe({type:"callStatus",call:e,reason:"localStreamEnded"})}),f.PubSubSvc.subscribe("/call/muted",function(e){Oe({type:"callStatus",call:e,reason:"callMuted"})}),f.PubSubSvc.subscribe("/call/localUser/muted",function(e){Oe({type:"callStatus",call:ae(e),reason:"localUserMuted"})}),f.PubSubSvc.subscribe("/call/localUser/unmuted",function(e){Oe({type:"callStatus",call:ae(e),reason:"localUserUnmuted"})}),f.PubSubSvc.subscribe("/call/localUser/mutedSelf",function(e,t){var n=ae(e);Oe(t?{type:"callStatus",call:n,reason:"localUserSelfMuted"}:{type:"callStatus",call:n,reason:"localUserSelfUnmuted"})}),f.PubSubSvc.subscribe("/call/locked",function(e){Oe({type:"callStatus",call:e,reason:"callLocked"})}),f.PubSubSvc.subscribe("/call/moved",function(e,t){Oe({type:"callStatus",call:ae(t),reason:"callMoved"})}),f.PubSubSvc.subscribe("/call/participant/updated",function(e,t){Oe({type:"callStatus",call:ae(e),participant:t,reason:"participantUpdated"})}),f.PubSubSvc.subscribe("/call/participants/updated",function(e,t){Oe({type:"callStatus",call:ae(e),participants:t,reason:"participantsUpdated"})}),f.PubSubSvc.subscribe("/call/participant/added",function(e,t){Oe({type:"callStatus",call:ae(e),participant:t,reason:"participantAdded"})}),f.PubSubSvc.subscribe("/call/participants/added",function(e,t){Oe({type:"callStatus",call:ae(e),participants:t,reason:"participantsAdded"})}),f.PubSubSvc.subscribe("/call/participant/joined",function(e,t){Oe({type:"callStatus",call:e,participant:t,reason:"participantJoined"})}),f.PubSubSvc.subscribe("/call/participant/removed",function(e){Oe({type:"callStatus",call:ae(e),reason:"participantRemoved"})}),f.PubSubSvc.subscribe("/call/recording/info",function(e){Oe({type:"callStatus",call:e,reason:"callRecording"})}),f.PubSubSvc.subscribe("/call/droppedRemotely",function(e){Oe({type:"callStatus",call:e,reason:"droppedRemotely"})}),f.PubSubSvc.subscribe("/call/sdpConnected",function(e){Oe({type:"callStatus",call:e,reason:"sdpConnected"})}),f.PubSubSvc.subscribe("/call/participants/activeSpeakers",function(e,t){Oe({type:"callStatus",call:ae(e),reason:"activeSpeakerChanged",activeSpeakers:t})}),f.PubSubSvc.subscribe("/call/network/quality",function(e,t){Oe({type:"callNetworkQualityChanged",callId:e,data:t})}),f.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/detected",function(e){Oe({type:"callRtpThresholdReached",call:ae(e)})}),f.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/cleared",function(e){Oe({type:"callRtpThresholdCleared",call:ae(e)})}),f.PubSubSvc.subscribe("/call/ended",function(e,t){ae(e.callId)||Oe({type:"callEnded",call:e,replaced:t})}),l},Pe.Client.prototype.name="Client",Pe.isCompatible=function(){var e=parseInt(t.version,10);return t.chrome&&44<=e||t.firefox&&42<=e||t.edge},Pe.supportedFeatures=function(){return Pe.isCompatible()?{text:!0,rtc:t.chrome||t.firefox}:{text:!1,rtc:!1}},Object.defineProperty(Pe,"supportedEvents",{get:function(){return["accessTokenRenewed","renewAccessTokenFailed","loggedOnUserUpdated","itemAdded","itemUpdated","itemFlagged","itemUnflagged","conversationCreated","conversationUpdated","conversationArchived","conversationFavorited","conversationUnarchived","conversationUnfavorited","conversationUserDataChanged","conversationReadItems","userPresenceChanged","userUpdated","connectionStateChanged","sessionTokenRenewed","reconnectFailed","userSettingsChanged","basicSearchResults","searchStatus","systemMaintenance","whiteboardEnabled","whiteboardElement","whiteboardCleared","mention","formSubmission","callIncoming","callStatus","callNetworkQualityChanged","callRtpThresholdReached","callRtpThresholdCleared","callEnded","whiteboardBackground","whiteboardOverlayToggled","whiteboardSync","labelsAdded","labelEdited","labelsRemoved","typing"]},enumerable:!0,configurable:!0}),Pe}((Circuit=function(e){"use strict";return e.Injectors={},e}((Circuit=function(n){"use strict";var o=n.Constants,r=n.logger,a=n.PhoneNumberFormatter,s=n.Utils;function i(e,t){return window.setTimeout(e,t)}i.cancel=function(e){e&&window.clearTimeout(e)};function c(e,t,n){if(void 0===n)return window.setInterval(e,t);if(n<=0)return null;var i=0,r=null;return r=window.setInterval(function(){e(),n<=++i&&window.clearInterval(r)},t)}c.cancel=function(e){e&&window.clearInterval(e)};var l=null;n.ClientApiHandlerSingleton.getInstance=function(){return l};var d=null;return n.UserToUserHandlerSingleton.getInstance=function(){return d},n.SdkServices=function(e,t){l=e,d=t,this.rootScope={localUser:null,clientVersion:"",browser:s.getBrowserInfo(),circuitLabs:{},$$phase:!0,$apply:function(e){e&&e()},$digest:function(){},i18n:{localize:function(e){return e},map:{res_Unknown:"Unknown"}},localize:function(e){return e}},n.Conversation={extend:function(t,e){if(!t||!t.localUser)return r.warn("[sdk-services]: Cannot extend Conversation object without localUser"),null;if(!e||e.isExtended)return e;var n=Object.create(e);n.isExtended=!0,n.moderators=n.moderators||[];var i=e.participants.map(function(e){return"string"==typeof e?{userId:e}:e}).filter(function(e){return e.userId===t.localUser.userId&&(n.hasJoined=!0),e.userId!==t.localUser.userId});return n.peerUsers=i,e.type===o.ConversationType.DIRECT&&(n.peerUser=i[0]),n.userIsModerator=function(t){return!!t&&n.moderators.some(function(e){return e.userId===t.userId})},n}.bind(null,this.rootScope)},n.UserProfile={extend:function(e){if(!e||e.isExtended)return e;var t=Object.create(e);return t.isExtended=!0,t}.bind(null),syncTelephonyConfig:function(e){var t=e&&e.accounts&&e.accounts[0],n=t&&t.telephonyConfiguration;if(n){n.phoneNumber=a.format(n.phoneNumber)||"",n.callerId=a.format(n.callerId)||"",n.reroutingPhoneNumber=a.format(n.reroutingPhoneNumber)||"",e.reroutingPhoneNumber=n.reroutingPhoneNumber,e.ondSipAuthenticationHash=n.ondSipAuthenticationHash,e.onsSipAuthenticationHash=n.onsSipAuthenticationHash,e.associatedTelephonyUserID=n.associatedTelephonyUserID,e.associatedTelephonyUserType=n.associatedTelephonyUserType;var i=(n.previousAlternativeDevice||[]).map(s.cleanPhoneNumber).reduce(function(e,t){return t.startsWith("+")&&"+"!==t&&(e[t]=!0),e},{});if(e.previousAlternativeNumbers=Object.keys(i),e.reroutingPhoneNumber){var r=s.cleanPhoneNumber(e.reroutingPhoneNumber);e.previousAlternativeNumbers.includes(r)||e.previousAlternativeNumbers.unshift(r)}e.associatedTelephonyUserID?(e.isOsBizCTIEnabled=e.associatedTelephonyUserType===o.GtcTrunkType.OSBIZ_TRUNK_TYPE&&n.isOsBizCTIEnabled,e.isATC=e.isOsBizCTIEnabled||e.associatedTelephonyUserType===o.GtcTrunkType.ATC_TRUNK_TYPE,e.isSTC=e.associatedTelephonyUserType===o.GtcTrunkType.SUB_TRUNK_TYPE,(e.isATC||e.isSTC)&&(e.associatedGTCUserId=e.associatedTelephonyUserID)):(e.isOsBizCTIEnabled=!1,e.isATC=!1,e.isSTC=!1)}else delete e.associatedGTCUserId,delete e.reroutingPhoneNumber,delete e.ondSipAuthenticationHash,delete e.onsSipAuthenticationHash,delete e.associatedTelephonyUserID,delete e.associatedTelephonyUserType,delete e.isATC,delete e.isSTC}.bind(null)},this.PubSubSvc=new n.PubSubSvcImpl(r),this.ExtensionSvc=new n.ExtensionSvcImpl(this.rootScope,i,window,Promise,r,this.PubSubSvc,null),this.SdkHelperSvc=new n.SdkHelperSvcImpl(this.rootScope,Promise,r,this.PubSubSvc),this.AtcRegistrationSvc=new n.AtcRegistrationSvcImpl(this.rootScope,i,r,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.DeviceDiagnosticSvc=new n.DeviceDiagnosticSvcImpl(this.rootScope,i,r,this.PubSubSvc,null),this.CircuitCallControlSvc=new n.CircuitCallControlSvcImpl(this.rootScope,i,c,window,Promise,r,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc,null,this.SdkHelperSvc,this.DeviceDiagnosticSvc),this.CstaSvc=new n.CstaSvcImpl(this.rootScope,i,r,this.PubSubSvc,this.CircuitCallControlSvc,this.AtcRegistrationSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.CallControlSvc=new n.CallControlSvcImpl(this.rootScope,Promise,i,r,this.PubSubSvc,this.CircuitCallControlSvc,this.SdkHelperSvc,this.CstaSvc,null,null,this.SdkHelperSvc,this.SdkHelperSvc),n.Conversation=null,n.UserProfile=null,d=l=null},n}((Circuit=function(w){"use strict";var G=w.Enums.CallState,H=w.Enums.CstaCallState,k=w.Constants,V=w.Enums,F=w.Enums.ParticipantAction,B=w.Enums.ScreenDisplayAction,e=w.Enums.ScreenLayoutAction,x=w.Enums.Targets,W=w.Enums.TransferCallFailedCauses,Y=w.Utils,K=w.UserToUserHandlerSingleton;return w.CallControlSvcImpl=function(s,i,r,c,o,l,a,d,u,E,C,T){c.debug("New Service: CallControlSvc");var p,S=2e3,I=[],A=this,R=K.getInstance();function f(e,t,n){return n=n||function(){},e&&t&&t.userId?u?O(e)?!!t.isMeetingPointInvitee||(c.warn("[CallControlSvc]: Cannot invoke CMR action - Participant is not CMR invitee"),n("Not CMR invitee"),!1):(c.warn("[CallControlSvc]: Cannot invoke CMR action - There is no local call"),n("Call invalid"),!1):(c.error("[CallControlSvc]: Cannot invoke CMR action - MeetingPointSvc is not initialized"),n("MeetingPointSvc not initialized"),!1):(n("Invalid arguments"),!1)}function v(n){I.some(function(e,t){return!!n.sameAs(e)&&(I.splice(t,1),!0)})}function _(t){return I.find(function(e){return e.callId===t})||null}function g(){for(var e=null,t=0;t<I.length;t++){if(I[t].state===G.ActiveRemote)return I[t];I[t].checkCstaState(H.Conference)&&(e=I[t])}return e}function N(e){c.debug("[CallControlSvc]: Publish /call/state event. callId = "+e.callId+", state = "+e.state.name),o.publish("/call/state",[e])}function m(e){e.terminate()}function h(e){e&&(c.debug("[CallControlSvc]: Publish /conversation/update event. convId = ",e.convId),o.publish("/conversation/update",[e]))}function t(e){if(e)if(e.isAtcRemote){var t=a.getConversationFromCache(e.convId);if(t&&t.isTelephonyConv){if(!e.checkCstaState([H.Idle,H.Terminated])&&(function(e){for(var t=0;t<I.length;t++)if(e.sameAs(I[t]))return c.debug("[CallControlSvc]: Updating call with callId = "+e.callId),I[t]=e;I.push(e)}(e),!t.call||t.call.isHandoverInProgress&&!t.call.sameAs(e)||t.call.isAtcRemote&&(t.call.isHolding()||t.call.isHoldInProgress()))){if(t.call&&t.call.isHandoverInProgress){var n=t.call;n.clearAtcHandoverInProgress(),e.establishedTime=n.establishedTime,n.isAtcRemote?v(n):l.removeCallFromList(n),n.terminateReason=V.CallClientTerminatedReason.USER_ENDED,m(n),c.debug("[CallControlSvc]: Publish /call/ended event."),o.publish("/call/ended",[n,!1])}t.call=e}switch(e.getCstaState()){case H.Initiated:case H.Offered:case H.ExtendedRinging:e.setState(G.Started);break;case H.Delivered:e.setState(G.Delivered);break;case H.Busy:e.setState(G.Busy);break;case H.Ringing:e.checkState(G.Ringing)||(e.setState(G.Ringing),E&&E.show({type:w.Enums.NotificationType.INCOMING_VOICE_CALL,user:e.peerUser,extras:{conversation:t,call:e}}));break;case H.Idle:case H.TransferFailed:case H.Failed:e.setState(G.Idle);break;case H.Terminated:e.setState(G.Terminated);break;default:e.setState(G.ActiveRemote)}e.state!==G.Idle&&e.state!==G.Terminated&&e.state!==G.Started?(h(t),N(e),d.isPrimaryClient()&&e.state!==G.Ringing&&T.setPresenceWithLocation(k.PresenceState.BUSY)):e.state!==G.Idle&&e.state!==G.Terminated||(m(e),v(e),c.debug("[CallControlSvc]: Publish /call/ended event"),o.publish("/call/ended",[e,!1]),e.isHandoverInProgress||t.call&&t.call.sameAs(e)&&(t.call=g(),t.call||l.getActiveCall()||T.setPresenceWithLocation(k.PresenceState.AVAILABLE)),h(t))}else c.warn("[CallControlSvc]: Call in /atccall/info event is not for telephony conversation")}else N(e);else c.warn("[CallControlSvc]: Invalid call object in /atccall/info event")}function n(e){var t=function(){for(var e=0;e<I.length;e++)if(I[e].isHandoverInProgress)return I[e];return null}();if(t){t.atcCallInfo.transferCb&&(t.atcCallInfo.transferCb(null,null,e),delete t.atcCallInfo.transferCb);var n=a.getConversationFromCache(e.convId);e.establishedTime=t.establishedTime,m(t),v(t),n&&n.call&&(n.call=e,h(n))}}function O(e){var t=l.getActiveCall();return!!t&&e===t.callId}function D(e){c.debug("[CallControlSvc]: Publish /call/nativeDial event"),o.publish("/call/nativeDial",[e])}function P(){if(!s.localUser.isOsBizCTIEnabled)return null;var e=l.findOsBizFirstCall();if(!e)return null;var t=l.findOsBizSecondCall();if(!t)return null;var n=e.checkCstaState(V.CstaCallState.Holding);return{activeCall:n?t:e,heldCall:n?e:t}}function y(e,t,i){var r;"object"==typeof t&&(r=t);var n={content:{type:V.StcMessage.TRANSFER,phoneNumber:s.localUser.callerId,transferRequest:{sessionId:e.callId,target:{dn:r?r.peerUser.phoneNumber:t,sessionId:r?r.callId:void 0}}},destUserId:s.localUser.associatedTelephonyUserID};R.sendStcRequest(n,function(e,t){if(e||t&&t.error){var n=W.Unreachable.name;t&&W[t.error]&&(n=t.error),i&&i(W[n].ui)}else r&&r.isPresent()&&!r.state.established&&A.endCall(r.callId),i&&i()})}function b(e,t,n){if(c.buttonPressed("Toggle video for participant with userId: ",t.userId),t.isMeetingPointInvitee){t.toggleVideoInProgress=!0;var i=a.getConversationFromCache(e.convId);t.setActions(i,s.localUser),A.toggleVideoParticipant(e.callId,t,function(e){t.toggleVideoInProgress=!1,t.setActions(i,s.localUser),e&&(c.error("[CallControlSvc]: Cannot toggle video participant. ",e),n(e))})}else c.info("[CallControlSvc]: Cannot toggle video participant for ",t.userId)}function U(e){return e.muted&&(e.userId===s.localUser.userId||e.actions.includes(F.Unmute))}function L(e){return e&&(e.hasRemoteScreenShare()||e.hasLocalScreenShare())}function M(e,t,n){l.mergeCalls(e,t).then(function(){n()}).catch(function(e){c.warn("[CallControlSvc]: Merge call failed"),n(e)})}return o.subscribe("/atccall/info",function(e){c.debug("[CallControlSvc]: Received /atccall/info event"),t(e)}),o.subscribe("/atccall/replace",function(e){c.debug("[CallControlSvc]: Received /atccall/replace event"),n(e)}),o.subscribe("/call/ended",function(e){if(c.debug("[CallControlSvc]: Received /call/ended event"),e.sendDtmfTimer&&(r.cancel(e.sendDtmfTimer),e.sendDtmfTimer=null),delete e.dtmfDigits,e.isAtcRemote)e.clearAtcHandoverInProgress(),v(e);else{var t=a.getConversationFromCache(e.convId);t&&t.isTelephonyConv&&!t.call&&(t.call=g()||I.find(function(e){return e.state===G.Ringing})||null,t.call&&h(t)),e.isRemote||l.getActiveCall()||(d.isPrimaryClient()&&g()||T.setPresenceWithLocation(k.PresenceState.AVAILABLE),T.cancelAutoSnooze())}}),o.subscribe("/atccall/hangingcall",function(e){c.debug("[CallControlSvc]: Received /atccall/hangingcall event"),function(n){a.getTelephonyConversation(function(e,t){!e&&t&&t.call&&t.call.atcCallInfo.getCstaCallId()===n&&(t.call=null,h(t))})}(e)}),o.subscribe("/call/state",function(e){c.debug("[CallControlSvc]: Received /call/state event"),e&&e.state.established&&(e.isRemote||T.setPresenceWithLocation(k.PresenceState.BUSY),e.dtmfDigits&&function(e){var t=e.dtmfDigits;if(t){delete e.dtmfDigits;var n=t.match(/^,*/)[0].length,i=n*S+1e3;n&&(t=t.substr(n)),e.sendDtmfTimer=r(function(){e.sendDtmfTimer=null,e.isPresent()&&(c.debug("[CallControlSvc]: Send delayed DTMF digits "+t+" for call "+e.callId),A.sendDigits(e.callId,t))},i)}}(e))}),o.subscribe("/screenshare/started",function(){c.info("[CallControlSvc]: Received /screenshare/started event. Screenshare was started. Start Auto-Snooze."),T.startAutoSnooze()}),o.subscribe("/screenshare/ended",function(){c.info("[CallControlSvc]: Received /screenshare/ended event. Screenshare was ended. Resume from Auto-Snooze."),T.cancelAutoSnooze()}),Y.isMobile()&&R.on("MOBILE_BREAKOUT.DIAL",function(e){c.info("[CallControlSvc]: Received UserToUser MOBILE_BREAKOUT.DIAL event."),s.$apply(function(){!function(e){if(e&&e.phoneNumber){c.debug("[CallControlSvc]: Received MobileBreakout.DIAL event");var t={phoneNumber:e.phoneNumber,autoDial:e.autoDial,userName:e.userName},n=[];e.conversationId&&n.push(a.getConversationPromise(e.conversationId)),e.userId&&n.push(C.getUserPromise(e.userId)),n.length?i.all(n).then(function(e){e&&e.forEach(function(e){e.userId?t.user=e:t.conversation=e}),D(t)}):D(t)}}(e)})}),this.initActiveSessionsForSdk=l.initActiveSessionsForSdk,this.setDisableRemoteVideoByDefault=l.setDisableRemoteVideoByDefault,this.getDisableRemoteVideoByDefault=l.getDisableRemoteVideoByDefault,this.setClientDiagnosticsDisabled=l.setClientDiagnosticsDisabled,this.getCalls=l.getCalls,this.getPhoneCalls=l.getPhoneCalls,this.getActiveCall=l.getActiveCall,this.isConnectionInProgress=l.isConnectionInProgress,this.getIncomingCall=l.getIncomingCall,this.getActiveRemoteCall=l.getActiveRemoteCall,this.joinGroupCall=l.joinGroupCall,this.makeCall=l.makeCall,this.makeAtcCall=function(e,t,n){var i=Y.cleanPhoneNumber("object"==typeof t?t.dialedDn:t);"object"==typeof t?t.dialedDn=i:t={dialedDn:i},t.dtmfDigits&&(t.dtmfDigits=Y.cleanPhoneNumberDigitsWithPin(t.dtmfDigits));var r=function(t){return I.find(function(e){return e.atcCallInfo.getPosition()===t})||null}(e)||s.localUser.isOsBizCTIEnabled&&function(){var e=A.getActiveCall();return e&&e.isTelephonyCall?e:null}();d.startCall(r,e,t,n)},this.makeEchoTestCall=l.makeEchoTestCall,this.makeEchoTestCallWithOptions=l.makeEchoTestCallWithOptions,this.dialNumber=l.dialNumber,this.dialPhoneNumber=l.dialPhoneNumber,this.dialUsingDefaultDevice=function(i,r){r=r||function(){};var o=i&&i.dialedDn;o&&Y.PHONE_DIAL_PATTERN.test(o)?(c.debug("[CallControlSvc]: Calling "+o+" with name: "+i.toName),a.getTelephonyConversation(function(e,t){if(e||!t)return c.debug("[CallControlSvc]: Error on getTelephonyConversation. ",e),void r(e||"No telephony conversation");if(t.call&&t.call.consultation){var n=t.call.getPosition()||p;if(n&&n!==x.WebRTC||s.localUser.isOsBizCTIEnabled)return c.info("[CallControlSvc]: Start consultation from "+n.name+" to ",o),A.makeAtcCall(n,i,r),void(t.call.consultation=!1)}else if(p&&(p!==x.WebRTC||t.call&&s.localUser.isOsBizCTIEnabled))return c.info("[CallControlSvc]: Make call from "+p.name+" to ",o),void A.makeAtcCall(p,i,r);i.mediaType=i.mediaType||{audio:!0,video:!1,desktop:!1},A.dialPhoneNumber(i,r)})):r("Missing or wrong number")},this.setDefaultCallDevice=function(t){t&&t.name&&Object.keys(x).some(function(e){return t.name===x[e].name&&(p=x[e],c.debug("[CallControlSvc]: Set defaultCallDevice to ",p.name),!0)})},this.startConference=l.startConference,this.startConferenceWithOptions=l.startConferenceWithOptions,this.cannotHandleSecondCall=function(){var e=A.getIncomingCall();if(!e)return!1;var t=A.getActiveCall();return!!t&&(t.isTelephonyCall&&!e.isTelephonyCall||!t.isTelephonyCall&&t.checkState([G.Active,G.Waiting]))},this.answerCall=function(e,t,n){if(1<l.getEstablishedLocalPhoneCalls().length)return c.warn("[CallControlSvc]: answerCall - There are already 2 local phone calls"),void(n&&n("Can not answer the call"));var i=l.findCall(e);if(i)s.localUser.isOsBizCTIEnabled&&i.isTelephonyCall&&i.atcCallInfo&&i.isOsBizSecondCall?d.answerCstaCall(i.atcCallInfo.getCstaCallId(),n):l.answerCall(e,t,n);else{i=_(e);var r=l.getActiveCall(),o=l.getIncomingCall(),a=l.getCallToPickup();i?r&&!r.isTelephonyCall?l.endActiveCall(function(){d.pullRemoteCall(e,n)}):o&&!o.isTelephonyCall?l.endCallWithCauseCode(o.callId,k.InviteRejectCause.BUSY,function(){d.pullRemoteCall(e,n)}):d.pullRemoteCall(e,n):a&&a.callId===e?l.pickupTeamCall(e,t,n):(c.warn("[CallControlSvc]: answerCall - There is no alerting call"),n&&n("No alerting call"))}},this.answerCallOnDevice=function(e,t,n,i){if(i=i||function(){},n&&n!==x.WebRTC){var r=l.findCall(e);r?r.isTelephonyCall?s.localUser.isOsBizCTIEnabled&&n!==x.VM?d.answerCstaCall(r.atcCallInfo.getCstaCallId(),i):d.deflect(e,n,null,i):(c.warn("[CallControlSvc]: answerCallOnDevice - The active call is not a telephony call"),i("Not telephony call")):(r=_(e))?r.pickupNotification?d.pickupCall(e,n,i):r.getPosition()!==n?d.deflect(e,n,null,i):d.answer(e,i):(c.warn("[CallControlSvc]: answerCallOnDevice - There is no alerting call"),i("No alerting call"))}else A.answerCall(e,t,i)},this.endCall=function(e,t){A.endCallWithCauseCode(e,null,t)},this.endCallWithCauseCode=function(e,t,n){var i=l.findCall(e);if(i)if(i.isOsBizFirstCall){var r=l.findOsBizSecondCall();r&&r.direction===V.CallDirection.INCOMING&&r.checkState(G.Ringing)?d.endCstaCall(i.atcCallInfo.getCstaCallId()):d.reconnect(i,l.findOsBizSecondCall(),n)}else i.isOsBizSecondCall?d.reconnect(i,l.findOsBizFirstCall(),n):i.isRemote?l.endRemoteCall(e,n):t?l.endCallWithCauseCode(e,t,n):(s.localUser.isOsBizCTIEnabled&&i.isTelephonyCall&&i.checkState(G.Ringing)&&d.endCallOnRemoteDevices(i.atcCallInfo.getCstaCallId()),l.endCall(e,n));else(i=_(e))&&1<I.length&&A.reconnectCall(e,n)||(i?d.endRemoteCall(e,n):(c.warn("[CallControlSvc]: endCall invoked without a valid call. callId = ",e),n&&n("Call not found")))},this.endConference=l.endConference,this.startScreenShare=l.startScreenShare,this.addScreenShare=l.addScreenShare,this.selectMediaToShare=l.selectMediaToShare,this.removeScreenShare=l.removeScreenShare,this.requestScreenControl=l.requestScreenControl,this.offerScreenControl=l.offerScreenControl,this.rejectScreenControlRequest=l.rejectScreenControlRequest,this.stopScreenControl=l.stopScreenControl,this.addAudio=l.addAudio,this.removeAudio=l.removeAudio,this.enableRemoteAudio=l.enableRemoteAudio,this.disableRemoteAudio=l.disableRemoteAudio,this.addVideo=l.addVideo,this.removeVideo=l.removeVideo,this.addVideoStream=l.addVideoStream,this.toggleRemoteVideo=l.toggleRemoteVideo,this.disableRemoteVideoOnly=l.disableRemoteVideoOnly,this.enableRemoteVideo=l.enableRemoteVideo,this.toggleVideo=l.toggleVideo,this.changeHDVideo=l.changeHDVideo,this.changeVideoResolution=l.changeVideoResolution,this.renegotiateMedia=l.renegotiateMedia,this.setMediaType=l.setMediaType,this.addMediaStream=l.addMediaStream,this.removeMediaStream=l.removeMediaStream,this.pullRemoteCall=function(e,t,n){var i=l.findCall(e);if(i)l.pullRemoteCall(e,t,n);else if(i=_(e)){var r=l.getActiveCall();if(r)return r.isTelephonyCall?void l.holdCall(r.callId,function(){d.pullRemoteCall(e,n)}):void l.endActiveCall(function(){d.pullRemoteCall(e,n)});d.pullRemoteCall(e,n)}else c.warn("[CallControlSvc]: pullRemoteCall invoked without a valid call"),n&&n("No active remote call")},this.pushLocalCall=d.pushLocalCall,this.getAtcCalls=function(){return I},this.swapCall=function(t,e){e=e||function(){};var n=P();if(n)d.alternate(n.heldCall,n.activeCall,e);else{var i=l.findCall(t);if(i&&i.isTelephonyCall&&!i.isRemote)l.swapCall(t,e);else{if(1<I.length){var r=I.find(function(e){return e.isHolding()&&e.callId===t});if(r){var o=r.atcCallInfo.getPosition(),a=I.find(function(e){return e.checkCstaState([H.Active,H.Conference])&&e.atcCallInfo.getPosition()===o&&e.callId!==t});if(a)return void d.alternate(r,a,e)}}c.warn("[CallControlSvc]: swapCall possible only with 2 calls"),e("No calls to swap")}}},this.mergeCall=function(t,n){n=n||function(){};var i,r,e=l.getPhoneCalls(!0);if(I.length<=1&&e.length<=1)return c.warn("[CallControlSvc]: mergeCall possible only with 2 calls"),void n("No calls to merge");if(1<e.length&&(i=l.findActivePhoneCall(!0),r=l.findHeldPhoneCall(!0),i&&r))return s.localUser.isSTC?void(r.isDirectUpgradedToConf?l.retrieveCall(r.callId,function(e){e?(c.error("[CallControlSvc]: Error retrieving the hosted call"),n("Error in retrieving the hosted call")):M(i.callId,r.callId,n)}):M(r.callId,i.callId,n)):void(r.isAtcConferenceCall()&&!s.localUser.isOsBizCTIEnabled?A.swapCall(r.callId,function(e){e?(c.warn("[CallControlSvc]: Swap call failed. Cannot proceed with merge call."),n(e)):d.conference(i,r,n)}):d.conference(r,i,n));if(i=I.find(function(e){return e.checkCstaState([H.Active,H.Conference])&&e.callId===t})){var o=i.atcCallInfo.getPosition();if(r=I.find(function(e){return e.isHolding()&&e.atcCallInfo.getPosition()===o&&e.callId!==t}))return void d.conference(r,i,n)}c.warn("[CallControlSvc]: mergeCall possible only with 2 calls"),n("No calls to merge")},this.transferCall=function(t,e,n){n=n||function(){};var i=P();if(i)d.consultationTransfer(i.activeCall,i.heldCall,n);else{var r,o=l.findCall(t),a=l.getPhoneCalls(!0);if(e=Y.cleanPhoneNumber(e),o&&1===a.length)o.isTelephonyCall&&o.atcCallInfo?d.transfer(o,e,n):o.isSTC?y(o,e,n):(c.warn("[CallControlSvc]: The active call is not a telephony call"),n("The active call is not a telephony call"));else{if(o&&2===a.length)return r=l.findHeldPhoneCall(!0),void(o.isTelephonyCall&&o.atcCallInfo?d.consultationTransfer(o,r,n):o.isSTC?y(o.state.established?o:r,o.state.established?r:o,n):(c.warn("[CallControlSvc]: The active call is not a telephony call"),n("The active call is not a telephony call")));if(0<I.length){if(1===I.length&&!I[0].isHolding())return o=I[0],void d.transfer(o,e,n);if(o=I.find(function(e){return!e.isHolding()&&e.callId===t})){var s=o.atcCallInfo.getPosition();if(r=I.find(function(e){return e.isHolding()&&e.atcCallInfo.getPosition()===s&&e.callId!==t}))return void d.consultationTransfer(o,r,n)}}c.warn("[CallControlSvc]: transferCall possible only with 1 or 2 calls"),n("Not enough calls for the transfer")}}},this.holdCall=function(e,t){t=t||function(){};var n=l.findCall(e);n?n.isHolding()?(c.warn("[CallControlSvc]: Call is not in valid state"),t("Call is not in valid state")):s.localUser.isOsBizCTIEnabled&&n.isTelephonyCall?d.holdWithConsultationCall(n,t):l.holdCall(e,t):(n=_(e))?n.isHolding()?(c.warn("[CallControlSvc]: Call is not in valid state"),t("Call is not in valid state")):d.hold(n,t):(c.warn("[CallControlSvc]: holdCall invoked without a valid call"),t("Call not found"))},this.retrieveCall=function(e,t){t=t||function(){};var n=l.findCall(e);n?n.isHolding()?s.localUser.isOsBizCTIEnabled&&n.isTelephonyCall?d.retrieveWithReconnectCall(n,t):l.retrieveCall(e,t):(c.warn("[CallControlSvc]: Call is not in valid state"),t("Call is not in valid state")):(n=_(e))?n.isHolding()?d.retrieve(n,t):(c.warn("[CallControlSvc]: Call is not in valid state"),t("Call is not in valid state")):(c.warn("[CallControlSvc]: retrieveCall invoked without a valid call"),t("Call not found"))},this.reconnectCall=function(t,e){if(1<I.length){var n=I.find(function(e){return!e.isHolding()&&e.callId===t});if(n){var i=n.atcCallInfo.getPosition(),r=I.find(function(e){return e.isHolding()&&e.atcCallInfo.getPosition()===i&&e.callId!==t});if(r)return d.reconnect(n,r,e),!0}}return c.warn("[CallControlSvc]: reconnectCall possible only with 2 calls"),e("No calls to reconnect"),!1},this.ignoreCall=function(e,t){var n=_(e);if(n&&n.pickupNotification)d.ignoreCall(n,t);else{var i=l.getCallToPickup();!i||i.pickupSession!==e&&i.callId!==e?t&&t("No pickup call"):l.ignorePickupCall()}},this.hideRemoteCall=l.hideRemoteCall,this.dropParticipant=l.dropParticipant,this.addParticipantToCall=l.addParticipantToCall,this.addParticipantToRtcSession=l.addParticipantToRtcSession,this.mute=l.mute,this.unmuteLocally=l.unmuteLocally,this.unmute=l.unmute,this.toggleMute=l.toggleMute,this.muteParticipant=function(t,n,i){if(i=i||function(){},t&&n){if(!O(t))return c.warn("[CallControlSvc]: muteParticipant - There is no local call"),void i("Call invalid");if(n.isMeetingPointInvitee){if(!u)return c.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void i("res_MuteParticipantFailed");u.muteMeetingPoint(n.userId,function(e){e?(c.warn("[CircuitCallControlSvc]: Failed to mute Meeting Point locally"),i("res_MuteParticipantFailed")):l.muteParticipant(t,n,i)})}else l.muteParticipant(t,n,i)}else i("Missing callId or participant")},this.hasUnmutedParticipants=l.hasUnmutedParticipants,this.hasScreenControlFeature=l.hasScreenControlFeature,this.muteRtcSession=l.muteRtcSession,this.unmuteParticipant=function(e,t,n){if(n=n||function(){},e&&t){if(!O(e))return c.warn("[CallControlSvc]: unmuteParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!u)return c.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_UnmuteParticipantFailed");u.unmuteMeetingPoint(t.userId,function(e){e?(c.warn("[CircuitCallControlSvc]: Failed to unmute Meeting Point locally"),n("res_UnmuteParticipantFailed")):n()})}else l.unmuteParticipant(e,t,n)}else n("Missing callId or participant")},this.toggleMuteParticipant=function(e,t,n){e&&t?t.muted?A.unmuteParticipant(e,t,n):A.muteParticipant(e,t,n):n("Missing callId or participant")},this.toggleVideoParticipant=function(e,t,n){if(n=n||function(){},e&&t&&t.userId){if(!O(e))return c.warn("[CallControlSvc]: toggleVideoParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!u)return c.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_StartVideoParticipantFailed");u.toggleVideoMeetingPoint(t.userId,function(e){e?(c.warn("[CallControlSvc]: Failed to toggle video MeetingPoint participant"),n("res_ToggleVideoFailed")):n()})}else c.warn("[CallControlSvc]: Cannot toggle video MeetingPoint participant: ",t.userId),n("res_StartVideoParticipantFailed")}else n("Missing callId or participant")},this.toggleScreenSharing=function(e,t,n){f(e,t,n)&&(n=n||function(){},u.toggleScreenShareMeetingPoint(t.userId,function(e){e?(c.error("[CallControlSvc]: Failed to toggle screen share for Meeting Room invitee. ",e),n("Cannot toggle Screen Sharing")):(t.cmrData&&"boolean"!=typeof t.cmrData.isWhiteboardActive&&(t.cmrData.selectedFeature=B.ToggleScreenShare.name),c.debug("[CallControlSvc]: Screensharing is selected to show it on CMR"),n())}))},this.toggleConferencePoll=function(e,t,n){f(e,t,n)&&(n=n||function(){},u.toggleConferencePollMeetingPoint(t.userId,function(e){e?(c.error("[CallControlSvc]: Failed to toggle conference poll for Meeting Room invitee. ",e),n("Cannot toggle conference poll")):(c.debug("[CallControlSvc]: Conference poll is selected to show it on CMR"),n())}))},this.toggleWhiteboard=function(e,t,n){f(e,t,n)&&(n=n||function(){},u.toggleWhiteboardMeetingPoint(t.userId,function(e){e?(c.error("[CallControlSvc]: Failed to toggle whiteboard for Meeting Room invitee. ",e),n("Cannot toggle Whiteboard")):(t.cmrData&&"boolean"!=typeof t.cmrData.isWhiteboardActive&&(t.cmrData.selectedFeature=B.ToggleWhiteboard.name),c.debug("[CallControlSvc]: Whiteboard is selected to show it on CMR"),n())}))},this.toggleVideoFeature=function(e,t,n){f(e,t,n)&&(n=n||function(){},u.toggleVideoFeatureMeetingPoint(t.userId,function(e){e?(c.error("[CallControlSvc]: Failed to toggle video for Meeting Room invitee. ",e),n("Cannot toggle Video")):(t.cmrData&&"boolean"!=typeof t.cmrData.isWhiteboardActive&&(t.cmrData.selectedFeature=B.ToggleVideo.name),c.debug("[CallControlSvc]: Video is selected to show it on CMR"),n())}))},this.toggleLayout=function(i,e,r,o){f(i,r,o)&&(e?(o=o||function(){},u.toggleLayoutMeetingPoint(r.userId,e,function(e,t){if(e)c.error("[CallControlSvc]: Failed to toggle layout for Meeting Room invitee. ",e),o("Cannot toggle Layout");else{if(t&&t.primaryScreen&&(c.debug("[CallControlSvc]: Selected CMR layout is ",t.primaryScreen.currentLayout),r.cmrData&&(r.cmrData.primaryScreen=t.primaryScreen)),r.cmrData){var n=l.findCall(i);r.cmrData.selectedFeature=t.selectedMediaFeature||n&&n.screenEnabledFeature}o(null,t)}})):o("Missing layout action"))},this.swapDisplays=function(e,t,n){f(e,t,n)&&(n=n||function(){},u.swapDisplays(t.userId,function(e){e?(c.error("[CallControlSvc]: Failed to swap displays for Meeting Room invitee. ",e),n("Cannot swap displays")):n()}))},this.invokeParticipantAction=function(e,t){switch(e.action){case F.StartVideo:!function(e){return!(e.toggleVideoInProgress||!e.isMeetingPointInvitee)&&(e.mediaType&&!e.mediaType.video)}(e.participant)||b(e.call,e.participant,t);break;case F.StopVideo:!function(e){return!(e.toggleVideoInProgress||!e.isMeetingPointInvitee)&&(e.mediaType&&e.mediaType.video)}(e.participant)||b(e.call,e.participant,t);break;case F.Mute:A.checkAndMuteParticipant(e.call.callId,e.participant);break;case F.Unmute:A.checkAndUnmuteParticipant(e.call.callId,e.participant);break;case F.RemoveFromStage:A.checkAndRemoveParticipantFromStage(e.participant)}},this.canUnmuteParticipant=U,this.checkAndMuteParticipant=function(e,t){!function(e){return!e.muted&&(e.userId===s.localUser.userId||e.actions.includes(F.Mute))}(t)?c.info("[CallControlSvc]: Cannot mute remote participant"):(c.buttonPressed("Mute other participant with userId: ",t.userId),A.muteParticipant(e,t))},this.checkAndUnmuteParticipant=function(e,t){U(t)?(c.buttonPressed("Unmute other participant with userId: ",t.userId),A.unmuteParticipant(e,t)):c.info("[CallControlSvc]: Cannot unmute remote participant")},this.checkAndRemoveParticipantFromStage=function(e){e.actions.includes(F.RemoveFromStage)&&A.removeFromStage(e.userId)},this.fillScreenActions=function(t,n){if(n.isMeetingPointInvitee&&(n.screenDisplayActions=[],n.screenLayoutActions=[],n.cmrData)){var i=n.cmrData.isPollFeatureEnabled&&!!t.isPollStarted,r=t.whiteboardEnabled+L(t)+i,o=A.isAllowedToAddVideoFeature(n,r);r+=o,Object.values(B).forEach(function(e){if(2<=r)switch(e.name){case B.ToggleWhiteboard.name:t.whiteboardEnabled&&n.screenDisplayActions.push(e);break;case B.ToggleScreenShare.name:L(t)&&n.screenDisplayActions.push(e);break;case B.ToggleConferencePoll.name:i&&n.screenDisplayActions.push(e);break;case B.ToggleVideo.name:o&&n.screenDisplayActions.push(e)}e.name===B.SwapDisplays.name&&2===n.cmrData.displayCount&&n.screenDisplayActions.push(e)}),n.cmrData.isLayoutsEnabled&&n.cmrData.primaryScreen&&Object.values(e).forEach(function(e){e.name!==n.cmrData.primaryScreen.currentLayout&&!n.cmrData.primaryScreen.allowedLayouts.includes(e.name)||n.screenLayoutActions.push(e)})}},this.isScreenActionSelected=function(e,t){switch(t.type){case"screenEnabledFeature":return t.name===e.cmrData.selectedFeature;case"cmrLayout":return!(!e||!e.cmrData.primaryScreen||e.cmrData.primaryScreen.currentLayout!==t.name);default:return!1}},this.selectRemoteDisplayLayout=function(e,t){if(t=t||function(){},e.call&&e.action&&e.participant&&e.participant.isMeetingPointInvitee&&e.participant.screenLayoutActions&&e.participant.screenLayoutActions.includes(e.action))return A.isScreenActionSelected(e.participant,e.action)?(c.debug("[CallControlSvc]: Ignore action. CMR layout is already ",e.action.name),void t()):void A.toggleLayout(e.call.callId,e.action.name,e.participant,t);t("Not allowed")},this.selectRemoteDisplayFeature=function(e,t){if(t=t||function(){},e.call&&e.action&&e.participant&&e.participant.isMeetingPointInvitee&&e.participant.screenDisplayActions&&e.participant.screenDisplayActions.includes(e.action)){if(A.isScreenActionSelected(e.participant,e.action)&&e.action.name!==B.SwapDisplays.name)return c.debug("[CallControlSvc]: Ignore action. CMR display is already ",e.action.name),void t();e.participant.cmrData=e.participant.cmrData||{},e.participant.cmrData.pendingMediaFeatures=null;var n=e.call.callId;switch(e.action){case B.ToggleWhiteboard:A.toggleWhiteboard(n,e.participant,t);break;case B.ToggleScreenShare:A.toggleScreenSharing(n,e.participant,t);break;case B.ToggleConferencePoll:A.toggleConferencePoll(n,e.participant,t);break;case B.ToggleVideo:A.toggleVideoFeature(n,e.participant,t);break;case B.SwapDisplays:A.swapDisplays(n,e.participant,t)}}else t("Not allowed")},this.isAllowedToAddVideoFeature=function(e,t){return!!(e&&e.isMeetingPointInvitee&&e.cmrData)&&!(1!==e.cmrData.displayCount||!t||(e.cmrData.isLayoutsEnabled?!e.cmrData.primaryScreen:e.cmrData.primaryScreen))},this.stopRingingTone=l.stopRingingTone,this.endActiveCall=l.endActiveCall,this.startRecording=l.startRecording,this.stopRecording=l.stopRecording,this.startTranscription=l.startTranscription,this.stopTranscription=l.stopTranscription,this.switchRecordingLayout=l.switchRecordingLayout,this.startRecordingParticipant=l.startRecordingParticipant,this.submitCallQualityRating=l.submitCallQualityRating,this.raiseQuestion=l.raiseQuestion,this.inviteToStage=l.inviteToStage,this.inviteToStageAnswer=l.inviteToStageAnswer,this.inviteToStageCancel=l.inviteToStageCancel,this.removeFromStage=l.removeFromStage,this.getQuestions=l.getQuestions,this.updateQuestionState=l.updateQuestionState,this.openCurtain=l.openCurtain,this.closeCurtain=l.closeCurtain,this.getNodeState=l.getNodeState,this.canSendWebRTCDigits=l.canSendWebRTCDigits,this.sendDigits=function(e,t,n){if(n=n||function(){},!t)return c.warn("[CallControlSvc]: sendDigits invoked without any digit"),void n("No digits");var i=l.findCall(e);i?i.sessionCtrl.canSendDTMFDigits()?l.sendDigits(e,t,n):i.atcCallInfo?d.generateDigits(i,t,function(e){e?n("res_SendDtmfFailed"):n()}):n("res_SendDtmfFailed"):(i=_(e))?d.generateDigits(i,t,n):(c.warn("[CallControlSvc]: SendDigits invoked without a valid call"),n("Call not found"))},this.disableIncomingVideo=l.disableIncomingVideo,this.enableIncomingVideo=l.enableIncomingVideo,this.toggleParticipantPointer=l.toggleParticipantPointer,this.sendDataMessage=l.sendDataMessage,this.findCall=l.findCall,this.findConversationByCallId=function(e){var t=a.getConversationByRtcSession(e);if(t)return t;for(var n=0;n<I.length;n++)if(I[n].callId===e)return a.getConversationFromCache(I[n].convId);return null},this.sendParticipantPointer=l.sendParticipantPointer,this.getCallDevices=d.getCallDevices,this.getPushDevices=d.getPushDevices,this.getAnswerDevices=function(e){if(e&&"object"==typeof e)return d.getAnswerDevices(e);var t=l.findCall(e)||_(e);return d.getAnswerDevices(t)},this.updateActiveCallMediaDevices=l.updateActiveCallMediaDevices,this.addSimulatedParticipants=l.addSimulatedParticipants,this.canStartScreenShare=l.canStartScreenShare,this.canStartRecording=l.canStartRecording,this.canTakeScreenshot=l.canTakeScreenshot,this.addConferenceAsGuest=l.addConferenceAsGuest,this.removeConferenceAsGuest=l.removeConferenceAsGuest,this.testCandidatesCollection=l.testCandidatesCollection,this.findOsBizSecondCall=l.findOsBizSecondCall,this.getConferenceParticipants=l.getConferenceParticipants,this.changeInputDevices=l.changeInputDevices,this.setIncomingVideoStreams=l.setIncomingVideoStreams,this.getNetworkQualityInfo=l.getNetworkQualityInfo,this.isPinVideoSupported=l.isPinVideoSupported,this.isParticipantRecordingSupported=l.isParticipantRecordingSupported,this.isVideoPointerSupported=l.isVideoPointerSupported,this},w}((Circuit=function(st){"use strict";var ct=st.Enums.AgentState,lt=st.AtcCallInfo,dt=st.Enums.AtcMessage,ut=st.Enums.AtcRegistrationState,Et=st.AtcRemoteCall,Ct=st.BusyHandlingOptions,Tt=st.Enums.CallDirection,pt=st.Enums.CallState,St=st.ClientApiHandlerSingleton,It=st.Constants,At=st.Enums.CstaCallState,Rt=st.CstaParser,ft=st.Enums.JournalEntryTypes,vt=st.LocalCall,_t=st.Enums.MissedReasonTypes,gt=st.PhoneNumberFormatter,Nt=st.Enums.RedirectionTypes,mt=st.RoutingOptions,ht=st.Enums.Targets,Ot=st.UserToUserHandlerSingleton,Dt=st.Utils,Pt=st.Enums.TransferCallFailedCauses,yt=st.Enums.TeamPickupMessage,bt=st.Enums.TeamPickupFailedCauses;return st.CstaSvcImpl=function(E,d,C,T,u,o,c,t){C.debug("New Service: CstaSvc");var n=4e3,a=5e3,l=2e3,p=["connected","hold","queued"],S=["connected","hold"],s="02000000000000000000000000000000",I=/Forward/,i=3,r=6e4,A=2e3,R=2e3,f=this,v={forwardList:[]},_=Ot.getInstance(),g=St.getInstance(),N=new Rt,m=null,h=null,O=null,D=null,P={},y=null,b=[],U={},L={},M=!1,w=!0,G=!0,H={},k={},V=[],F=[],B=!1,x=null,W=null,Y=null,K=null,e=!1,q=null,j=null,Q=null,X=null,z=!1,J=0,$=0,Z=null,ee=null,te="Number not available",ne=null;function ie(n,i,r,o,a){if(r&&n.peerUser&&n.peerUser.fqnLookedUp===r)a&&a();else{if(n.setPeerUser(i,o),n.peerUser.userId||!r||!Dt.PHONE_PATTERN.test(r))return C.debug("[CstaSvc]: User already resolved or number is not fully qualified to do a reverse phone lookup"),void(a&&a());var s=d(function(){s=null,n.isPresent()&&(a&&a(),a=null)},l,!1);c.startReverseLookUp(r,function(e){var t;d.cancel(s),n.isPresent()&&(e&&(o=e.displayName,t=e.userId),n.setPeerUser(i,o,t,r),a&&a())})}}function re(t,n,i,e,r,o){if(!t.redirectingUser||!t.redirectingUser.redirectionType){if(t.setRedirectingUser(n,i,e,null,r),!i||!Dt.PHONE_PATTERN.test(i))return C.debug("[CstaSvc]: number is not fully qualified to do a reverse phone lookup"),void(o&&o());var a=d(function(){a=null,t.isPresent()&&(o&&o(),o=null)},l,!1);c.startReverseLookUp(i,function(e){d.cancel(a),t.isPresent()&&(e&&t.setRedirectingUser(n,i,e.displayName,e.userId,r),o&&o())})}}function oe(){if(F.length){var i=F.splice(0,1);c.startPhoneCallSearch(i[0].phoneNumber,function(){var e=c.getUserSearchList().slice(0),t=i[0].call;delete i[0].call;var n=null;(n=1===e.length?t.addParticipant({userId:e[0].userId||i[0].userId,phoneNumber:i[0].phoneNumber,displayName:e[0].displayName,participantId:i[0].participantId}):t.addParticipant(i[0]))&&m&&(C.debug("[CstaSvc]: Publish /atccall/participant/added"),T.publish("/atccall/participant/added",[t.callId,n])),d(oe,0)})}else B=!1}function ae(){E.localUser.isATC&&m&&(Object.assign(v,o.getAtcRegistrationData()),h=function(){var e=u.getActiveCall();if(!e||!e.isTelephonyCall)return null;var t=se(e);if(t)return t;var n=Object.create(e);return n.atcCallInfo=e.atcCallInfo||new lt,b.push(n),n}(),O=function(){var e=u.findHeldPhoneCall();if(!e)return null;var t=se(e);if(t)return t;var n=Object.create(e);return n.atcCallInfo=e.atcCallInfo||new lt,b.push(n),n}(),D=ce(),y=le(),0<b.length&&(b=b.filter(function(e){return!e.checkState(pt.Terminated)||(h===e&&(h=null),O===e&&(O=null),D===e&&(D=null),y===e&&(y=null),!1)})),h||D||O||y||Dt.emptyArray(b))}function se(e){for(var t=0;t<b.length;t++)if(b[t].callId===e.callId){var n=b[t].atcCallInfo;return e.peerUser.phoneNumber!==b[t].peerUser.phoneNumber&&n.clearServicesPermitted(),(b[t]=e).atcCallInfo&&e.atcCallInfo.cstaConn||(b[t].atcCallInfo=n),b[t]}return null}function ce(){var e=u.getIncomingCall();if(!e||!e.isTelephonyCall)return null;var t=se(e);if(t)return t;var n=Object.create(e);return n.atcCallInfo=e.atcCallInfo||new lt,b.push(n),n}function le(){var e=u.getActiveRemoteCall()[0];if(!e||!e.isTelephonyCall)return null;var t=se(e);return t||(e.atcCallInfo=e.atcCallInfo||new lt,b.push(e),e)}function de(e,t){if(P[e]){C.debug("[CstaSvc]: Remove remote call with Call Id = "+e);var n=P[e];t||ue(n),n.setCstaState(At.Idle),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[n]),delete P[e]}}function ue(e){if(!(E.localUser.noCallLog&&!E.localUser.isOS4K||e.pickupNotification))if(e){var t=e.atcCallInfo;if(!t.pickUp&&!t.getIgnoreCall()&&(e.isAtcRemote||e.isOsBizSecondCall||e.pulled)){if(!m)return void C.error("[CstaSvc]: No telephony conversation");if(!e.peerUser.phoneNumber&&e.peerUser.displayName===m.peerUser.displayName)return void C.warn("[CstaSvc]: This call has no peer display information.");var n=t.originalPartnerDisplay&&t.originalPartnerDisplay.fqn&&(t.originalPartnerDisplay.fqn!==t.peerFQN||!e.peerUser.displayName)&&!(e.pickedUp&&e.direction===Tt.INCOMING),i={phoneNumber:n?t.originalPartnerDisplay.dn:e.peerUser.phoneNumber,displayName:n?t.originalPartnerDisplay.name:e.peerUser.displayName,userId:!n&&e.peerUser.userId||m.peerUser.userId,resolvedUser:!!e.peerUser.userId&&!n,fqn:n?t.originalPartnerDisplay.fqn:t.peerFQN},r={convId:m.convId,starter:e.direction===Tt.INCOMING?i.userId:E.localUser.userId,source:e.direction===Tt.INCOMING?i.fqn:E.localUser.phoneNumber,destination:e.direction===Tt.OUTGOING?i.fqn:E.localUser.phoneNumber,startTime:e.creationTime,duration:e.establishedTime?Date.now()-e.establishedTime:0,type:0===e.establishedTime?ft.MISSED:ft.REGULAR,participants:[{userId:E.localUser.userId,type:"USER",phoneNumber:E.localUser.phoneNumber,displayName:E.localUser.displayName},{userId:i.userId,type:"TELEPHONY",phoneNumber:i.phoneNumber,displayName:i.displayName,resolvedUser:i.resolvedUser}]};if(r.type===ft.MISSED)switch(t.getMissedReason()){case _t.DEST_OUT_OF_ORDER:r.missedReason=It.RTCItemMissed.UNREACHABLE;break;case _t.REORDER_TONE:r.missedReason=It.RTCItemMissed.INVALID_NUMBER;break;case _t.BUSY:r.missedReason=It.RTCItemMissed.USER_BUSY;break;case _t.CANCELLED:r.missedReason=It.RTCItemMissed.CANCELED;break;case _t.DECLINED:r.missedReason=It.RTCItemMissed.DECLINED;break;case _t.TRANSFERRED:r.type=ft.REGULAR;break;default:r.missedReason=It.RTCItemMissed.TEMPORARILY_UNAVAILABLE}if(G)g.addJournalEntry(r);else{var o=1e3+1e3*Math.random();d(function(){!function(e){var n=e&&e.participants&&e.participants[1];if(n)return V.some(function(e,t){return Dt.cleanPhoneNumber(e.phoneNumber)===Dt.cleanPhoneNumber(n.phoneNumber)&&e.displayName===n.displayName&&(C.debug("[CstaSvc]: Call log entry already sent by another client"),V.splice(t,1),!0)});return!1}(r)&&g.addJournalEntry(r)},o,!1)}}}else C.error("[CstaSvc]: No remoteCall")}function Ee(){for(var e in P)P.hasOwnProperty(e)&&de(e,!0)}function Ce(t){return Object.values(P).find(function(e){return e.callId===t})||null}function Te(){return Object.values(P).find(function(e){return e.isHolding()})||null}function pe(e){if(E.localUser.isOsBizCTIEnabled){var t=Object.values(P).find(function(e){return e.atcCallInfo&&e.atcCallInfo.isQueuedIncomingCall()})||null;t&&(C.debug("[CstaSvc]: There is a call waiting. Allow it to ring"),t.atcCallInfo.setQueuedIncomingCall(!1),e===ht.WebRTC?Je(t):(C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[t])))}}function Se(e){if(!m)return null;var t=Object.create(m);return t.rtcSessionId=e,new Et(t)}function Ie(e){return E.localUser.isOsBizCTIEnabled&&E.circuitLabs.OSBIZ_EXTENDED_TELEPHONY&&e.networkCallingDevice?e.networkCallingDevice:e.callingDevice}function Ae(n){var i=n.endpoints,r=n.callingDevice,o=n.calledDevice,a=Re(r)?Tt.OUTGOING:Tt.INCOMING;if(!i||i.length<2)return null;var s=null,c=i[0].callIdentifier.cID,l=2<i.length?At.Conference:At.Active;return i.forEach(function(e){if(l&&Re(e.deviceOnCall)){if(-1===p.indexOf(e.localConnectionState))return void(l=null);var t=ve(e.deviceOnCall,n.epid);t===ht.WebRTC&&(h||y)?h?s=h:(s=y,t=ht.Other):s=Se(c),s.direction||(s.direction=a),s.atcCallInfo.setPosition(t),s.atcCallInfo.setCstaConnection(e.callIdentifier),Object.assign(n.servicesPermitted,e.servicesPermitted),"queued"===e.localConnectionState?l=At.Parked:"hold"===e.localConnectionState&&(l=2<i.length?At.ConferenceHolding:l===At.Held?At.HoldOnHold:At.Holding)}}),s&&2===i.length&&i.forEach(function(e){if(!Re(e.deviceOnCall)){if(-1===S.indexOf(e.localConnectionState))return void(l=null);var t=s.direction===Tt.OUTGOING?_e(o):_e(r);s.atcCallInfo.setPartnerDisplay(t),ie(s,s.atcCallInfo.peerDn,s.atcCallInfo.peerFQN,s.atcCallInfo.peerName),"hold"===e.localConnectionState&&(l=l===At.Holding?At.HoldOnHold:At.Held)}}),l?(s.atcCallInfo.setServicesPermitted(n.servicesPermitted),s.setCstaState(l),(P[c]=s).atcCallInfo.getPosition()===ht.WebRTC&&f.isPrimaryClient()?(function(t){C.info("[CstaSvc]: Found a hanging WebRTC call"),t.atcCallInfo.setPosition(ht.Other),t.atcCallInfo.isSeamlessHandoverAllowed()?(C.info("[CstaSvc]: Attempt to recover the hanging call by initiating a Seamless Handover"),Qe(t,ht[ht.WebRTC.name],null,function(e){e?(C.warn("[CstaSvc]: Failed to move the hanging call. ",e),f.hangupRemote(t)):C.info("[CstaSvc]: Hanging call has been successfully moved")})):(C.info("[CstaSvc]: Clear the hanging call"),f.hangupRemote(t))}(s),null):(C.debug("[CstaSvc]: Created new Remote Call object: ",s),s)):null}function Re(e){if(!e)return!1;var t=function(e){var t=e;if(E.localUser.isOsBizCTIEnabled){var n=fe(e);n&&n[1]&&(t=n[1])}return t}(e);return!!(t.includes(v.onsFQN)||v.osmoDeviceList&&v.osmoDeviceList.includes(t))&&(!t.includes("uid=")&&!function(e){return e.includes("keyId=")}(t))}function fe(e){return E.localUser.isOsBizCTIEnabled?v.osmoDeviceList&&/\/(\+?\**\d+)/.exec(e)||/<(\+?\**\d+)/.exec(e)||[e,e]:/ond=(\+?\d+)/.exec(e)}function ve(e,t){if(C.debug("[CstaSvc]: Get call position for "+e),!Re(e))return C.error("[CstaSvc]: Invalid device ID ("+e+"). Cannot determine position."),ht.Other;var n=ht.Other,i=fe(e);if(i&&i[1]){var r=i[1];r===v.osmoFQN?n=t&&t!==v.epid?ht.Other:ht.WebRTC:r===v.cell?n=ht.Cell:r===v.parkingDn?n=ht.Queue:v.osmoDeviceList&&v.osmoDeviceList.includes(r)&&(n=ht.Desk)}else n=ht.Desk;return C.debug("[CstaSvc]: Call position is:",n.name),n}function _e(e){var t={fqn:"",dn:te,name:""};if(e){var n=/N<([^>]*)>([^;]*)((?:[^;]*;)*(?:displayNumber=(\d*)))?(?:;.*)*/,i=n.exec(e);i?(E.localUser.isOsBizCTIEnabled&&i[1]&&(i[1]=i[1].replace(/\/.*/,"")),t.fqn=i[1]||"",t.name=i[2]||"",t.dn=i[4]||i[1]||te):(i=(n=/N([^;]*)/).exec(e))?(t.fqn=i[1]||"",t.dn=i[1]||te):(t.fqn=e,t.dn=e)}return C.debug("[CstaSvc]: Retrieved partner display: ",t),t}function ge(e){ae();for(var t=u.getPhoneCalls(),n=[],i=0;i<t.length;i++)if(t[i].atcCallInfo&&t[i].atcCallInfo.getCstaCallId()){if(t[i].atcCallInfo.getCstaCallId()===e)return h=t[i]}else{var r=t[i].getRedirectingUser();t[i].atcCallInfo=new lt,r&&(t[i].atcCallInfo.redirectingUser=r),n.push(t[i])}return D&&D.atcCallInfo.getCstaCallId()===e?D:(D&&!D.atcCallInfo.getCstaCallId()&&n.push(D),n[0])}function Ne(e){return"forwardImmediate"===e||E.localUser.isOsBizCTIEnabled&&("forwardImmInt"===e||"forwardImmExt"===e)}function me(e){return E.localUser.isOsBizCTIEnabled&&"preferredDevice"===e}function he(e){return"forwardNoAns"===e}function Oe(){var n=!0;Ee(),ae(),f.snapshotDevice(function(e,t){if(M=!0,e)-1<e.indexOf("deviceOutOfService")&&(w=!0,He());else if(t.hasOwnProperty("deskPhoneRegistered")?(w=!t.deskPhoneRegistered,n=!1):w=E.localUser.isOsBizCTIEnabled&&!v.osmoDeviceList,He(),n&&E.localUser.isOSV&&!w&&f.getLogicalDeviceInformation(),t.activeCalls)try{t.activeCalls.forEach(function(e){e.localCallState.length<2||(2!==e.localCallState.length||-1!==p.indexOf(e.localCallState[0])&&-1!==S.indexOf(e.localCallState[1]))&&f.snapshotCall(e.connectionId,function(e,t){if(!e&&t){var n=Ae(t);n&&(C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[n]))}})})}catch(e){C.error(e)}})}function De(){return E.localUser.isOsBizCTIEnabled&&E.circuitLabs.OSBIZ_EXTENDED_TELEPHONY&&E.localUser.pbxDNDSupported}function Pe(){Oe(),f.getForwarding(nt),E.localUser.isOsBizCTIEnabled?G&&(ot(e),De()&&f.getDoNotDisturb(tt)):(f.getDoNotDisturb(tt),f.getAgentState(it))}function ye(e,t,n,i){var r=E.localUser.isOsBizCTIEnabled?"":v.onsFQN+";ond=";switch(e){case ht.WebRTC:i&&1<v.osmoDeviceList.length?r="N<"+v.onsFQN+"/"+v.osmoDeviceList[1]+">":r+=n?v.osmoFQN:v.osmoFQN+";epid="+v.epid;break;case ht.Cell:if(!v.cell)return C.error("[CstaSvc]: Cell phone is not configured"),null;r+=v.cell;break;case ht.Desk:r+=v.onsFQN,i&&v.osmoDeviceList&&(r="N<"+r+"/"+v.osmoDeviceList[0]+">");break;case ht.VM:r=v.vm;break;case ht.Other:t?r+=t:r=v.vm;break;default:return C.error("[CstaSvc]: Invalid target: "+e),null}return r}function be(e,t,n){return!(!E.localUser.isOsBizCTIEnabled||"connected"!==e||ve(t)!==ht.Desk||ve(n)!==ht.WebRTC)&&(C.debug("[CstaSvc]: DSS call move from desk to client"),!0)}function Ue(e){return Object.assign(v,o.getAtcRegistrationData()),!(!{subscriber:E.localUser.cstaNumber}.subscriber||!v)||(e&&e("There is no registered user."),!1)}function Le(i,r,e){var t=N.genCstaRequest(i);if(!t)return C.error("[CstaSvc]: Failed to build CSTA request: "+i.request),void(r&&r("Failed to send the request"));if(Y===ut.Registered){var n={content:{type:dt.CSTA,phoneNumber:E.localUser.cstaNumber,CSTA:t},destUserId:E.localUser.associatedTelephonyUserID};e&&(n.keysToOmitFromLogging=e.map(function(e){return"content.CSTA."+e})),_.sendAtcRequest(n,function(t,n){E.$apply(function(){if(t)C.warn("[CstaSvc]: ",t),r&&r(t);else{var e=N.parseResponse(i.request,n.CSTA);e||""===e?e.error?("Operation Error"===e.errorCategory&&"invalidConnectionID"===e.errorValue&&"busy"!==i.reason&&"AcceptCall"!==i.request&&"DeflectCall"!==i.request&&Oe(),r&&r(e.errorCategory+" - "+e.errorValue)):r&&r(null,e):r&&r("Failed to parse response from server")}})})}else r&&r("Client is not registered with ATC")}function Me(e,t){t.transferredCall&&!t.seamlessHandover&&(L[e]={newCallId:t.transferredCall.cID,failedCallId:function(e){var t,n=(parseInt(e.substring(0,2),16)+2).toString(16).toUpperCase(),i=e.substring(2);return t=n.length<2?"0"+n+i:n+i,C.debug("[CstaSvc]: FailedCallId to be tracked: "+t),t}(t.transferredCall.cID),timeout:d(function(){delete L[e]},n)})}function we(e,t){return!(!e||!Ue())&&((t===ht.Other||e.atcCallInfo.position!==t)&&(!!function(){var e=$e();v&&v.vm&&e.push(ht.VM);return e.push(ht.Other),e}().includes(t)||(C.error("[CstaSvc]: isTargetAllowed invoked with invalid target: "+t),!1)))}function Ge(){E.localUser.isOsBizCTIEnabled||(C.debug("[CstaSvc]: Synchronize the selected routing option"),f.updateRoutingOption(E.localUser.selectedRoutingOption))}function He(){var e=!w,t=!(!v||!v.cell);C.debug("[CstaSvc]: Publish /csta/deviceChange event. desk="+e+", cell="+t),T.publish("/csta/deviceChange")}function ke(){return E.localUser.isOsBizCTIEnabled?v.onsFQN:E.localUser.isOSV?Dt.normalizeDn(E.localUser.cstaNumber):E.localUser.cstaNumber}function Ve(e){var t=u.findOsBizFirstCall(),n=u.findOsBizSecondCall();if(t&&n){if(t.atcCallInfo.getCstaCallId()===e)return C.debug("[CstaSvc]: First local call with callId: ",e),C.debug("[CstaSvc]: Second local call with callId: ",n.atcCallInfo.getCstaCallId()),u.moveOsBizCalls(t,n),!0;if(n.atcCallInfo.getCstaCallId()===e)return C.debug("[CstaSvc]: Second local call with callId: ",e),C.debug("[CstaSvc]: First local call with callId: ",t.atcCallInfo.getCstaCallId()),u.moveOsBizCalls(n,t),!0}else if(!t&&!n){var i=le();if(i&&i.atcCallInfo&&i.atcCallInfo.getCstaCallId()===e){C.debug("[CstaSvc]: Remote call with callId: ",e);var r=Te();if(r){C.debug("[CstaSvc]: Second remote call with callId: ",r.atcCallInfo.getCstaCallId());var o=i.atcCallInfo;return i.atcCallInfo=r.atcCallInfo,i.setPeerUser(i.atcCallInfo.peerDn,i.atcCallInfo.peerName),r.atcCallInfo=o,delete P[i.atcCallInfo.getCstaCallId()],de((P[o.getCstaCallId()]=r).atcCallInfo.getCstaCallId()),!0}}}return!1}function Fe(t,n){return Object.values(P).some(function(e){return e.atcCallInfo.pickUp&&(E.localUser.isOSV?e.atcCallInfo.peerFQN===t:e.atcCallInfo.peerName===n)})}function Be(e){C.debug("[CstaSvc]: New pickup call for: ",e.calledDisplay.displayName);var t=Se(e.callId);t.atcCallInfo.pickUp=!0,t.atcCallInfo.setPosition(ht.Other),t.atcCallInfo.setPartnerDisplay(e.callingDisplay),P[e.callId]=t,e.event?(t.atcCallInfo.setServicesPermitted(e.event.servicesPermitted),t.atcCallInfo.setCstaConnection(e.event.connection)):e.callingUserId&&(t.pickupSession=e.callId,t.peerGtcUserId=e.callingUserId,t.setRedirectingUser(e.calledDisplay.dn,e.calledDisplay.fqn,e.calledDisplay.name,e.calledUserId,Nt.CallPickupNotification)),t.setCstaState(At.Ringing),t.direction=Tt.INCOMING,t.atcCallInfo.setOriginalPartnerDisplay(e.calledDisplay),ie(t,t.atcCallInfo.peerDn,t.atcCallInfo.peerFQN,t.atcCallInfo.peerName,function(){e.callingUserId?rt(t):re(t,e.calledDisplay.dn,e.calledDisplay.fqn,e.calledDisplay.name,Nt.CallPickupNotification,function(){rt(t)})})}function xe(e){var t,n,i=ge(e.connection.cID);if(i)i.direction===Tt.OUTGOING&&I.test(e.cause)?(re(i,(t=_e(e.divertingDevice)).dn,t.fqn,t.name,Nt.CallForward),n=_e(e.newDestination),i.setPeerUser(n.dn,n.name),i.atcCallInfo.setOriginalPartnerDisplay(t)):E.localUser.isOsBizCTIEnabled&&i.direction===Tt.INCOMING&&i.isOsBizSecondCall&&Re(e.divertingDevice)&&Ve(e.connection.cID)&&C.debug("[CstaSvc]: Second call was diverted and released");else if("distributed"===e.cause&&Re(e.divertingDevice)&&ve(e.newDestination)===ht.Desk)C.debug("[CstaSvc]: Ignore Diverted event with cause = distributed and newDestination = desk");else{if(i=P[e.connection.cID]){if(i.atcCallInfo.masterParallelHgCall)return void C.debug("[CstaSvc]: Ignore Diverted event for master parallel hunt group")}else i=Se(e.connection.cID);if("null"===e.localConnectionInfo&&Re(e.divertingDevice)){if(Re(e.newDestination)){if(Re(e.newDestination)&&(ve(e.newDestination)===ht.WebRTC&&(H={cID:e.connection.cID,dID:e.newDestination}),i)){if(i.pickupNotification)return;if("redirected"===e.cause&&e.lastRedirectionDevice&&!Re(e.lastRedirectionDevice)){var r=_e(e.lastRedirectionDevice);re(i,r.dn,r.fqn,r.name,Nt.CallForward),P[e.connection.cID]=i}if(E.localUser.isOsBizCTIEnabled&&"park"===e.cause&&ve(e.newDestination)!==ve(e.divertingDevice))return i.setRedirectionType(Nt.Dss),void(P[e.connection.cID]=i);if(i.forwarded)return;if(i.checkCstaState(At.Ringing)&&ve(e.newDestination)===i.atcCallInfo.getPosition())return C.debug("[CstaSvc]: new destination has the same position as the current alerting position. Ignore event"),void(H={});i.atcCallInfo.setIgnoreCall(!0),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[i])}}else{if((function(e){return!!e&&_e(e).dn===v.vm}(e.newDestination)||ve(e.connection.dID)===ht.WebRTC||E.localUser.isOsBizCTIEnabled)&&i.atcCallInfo.setIgnoreCall(!0),i.setCstaState(At.Idle),i.direction=Tt.INCOMING,i.atcCallInfo.setMissedReason(_t.CANCELLED),I.test(e.cause)){P[e.connection.cID]=i;var o=_e(e.callingDevice);C.debug("[CstaSvc]: Update partner display to ",o),i.atcCallInfo.setPartnerDisplay(o),ie(i,i.atcCallInfo.peerDn,i.atcCallInfo.peerFQN,i.atcCallInfo.peerName)}C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[i])}i&&!i.isHandoverInProgress&&de(e.connection.cID)}else if(!Re(e.divertingDevice)&&i){var a=_e(e.divertingDevice);if(a&&i.atcCallInfo.setOriginalPartnerDisplay(a),i.direction===Tt.OUTGOING&&I.test(e.cause))return re(i,(t=_e(e.divertingDevice)).dn,t.fqn,t.name,Nt.CallForward),n=_e(e.newDestination),void i.setPeerUser(n.dn,n.name);i.atcCallInfo.setMissedReason(_t.CANCELLED),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[i])}}}function We(e,t){k&&k.newCallId===t&&(e.direction=k.direction,e.setRedirectingUser(k.redirectingUser.phoneNumber,k.redirectingUser.fqNumber,k.redirectingUser.displayName,k.redirectingUser.userId,k.redirectingUser.redirectionType),e.atcCallInfo.transferCb=k.transferCb,delete k.transferCb,k={})}function Ye(e){return E.localUser.isOsBizCTIEnabled?{cID:e.getCstaCallId(),dID:v.onsFQN}:e.getCstaConnection()}function Ke(e){var t,n,i,r,o;if(Re(e.queue)){t=e.queuedConnection,n=e.callingDevice,C.debug("[CstaSvc]: LocalConnection: ",t),C.debug("[CstaSvc]: Partner Device ID: ",n),i=ve(t.dID,e.epid);var a=_e(n);if(r=t.cID,!(o=P[r])){if("noAvailableAgents"===e.cause)return void C.debug("[CstaSvc]: Cause=noAvailableAgents. Ignore Queued event");if(E.localUser.isOsBizCTIEnabled&&(!E.localUser.pbxCampOnSupported||!E.circuitLabs.OSBIZ_EXTENDED_TELEPHONY)&&("multipleQueuing"===e.cause||"keyOperation"===e.cause||"campOn"===e.cause))return void C.debug("[CstaSvc]: CampOn is not supported. Ignore this event.");o=Se(r),P[r]=o,C.debug("[CstaSvc]: Created new Remote Call object for callID= ",r)}if(o.atcCallInfo.setPosition(i),o.atcCallInfo.setPartnerDisplay(a),ie(o,o.atcCallInfo.peerDn,o.atcCallInfo.peerFQN,o.atcCallInfo.peerName),o.setCstaState(At.Parked),o.atcCallInfo.setCstaConnection(t),E.localUser.isOsBizCTIEnabled&&E.circuitLabs.OSBIZ_EXTENDED_TELEPHONY&&E.localUser.pbxCampOnSupported&&("campOn"===e.cause||"keyOperation"===e.cause))if(h&&i===ht.WebRTC){if(C.debug("[CstaSvc]: Cause=campOn. A local call is established and user receives new incoming call"),i===ht.WebRTC)return void Je(o,e.servicesPermitted)}else Object.values(P).find(function(e){return e.isEstablished})&&i===ht.Desk?(C.debug("[CstaSvc]: Cause=campOn. A remote call is established and user receives new incoming call"),m.call=o,C.debug("[CstaSvc]: Publish /conversation/update event. convId = ",m.convId),T.publish("/conversation/update",[m]),C.debug("[CstaSvc]: Publish /call/remote/incoming event"),T.publish("/call/remote/incoming",[o]),o.direction=Tt.INCOMING,o.setCstaState(At.Ringing)):D&&(C.debug("[CstaSvc]: Cause=campOn. A call is ringing and user receives new incoming call. Do not display yet."),o.setCstaState(At.Ringing),o.direction=Tt.INCOMING,o.atcCallInfo.setQueuedIncomingCall(!0))}else{if(!E.localUser.isOsBizCTIEnabled||!Re(e.callingDevice)||"campOn"!==e.cause)return void C.debug("[CstaSvc]: ONS DN is not the queue device. Ignore Queued event.");if(i=ve(e.callingDevice),r=e.queuedConnection.cID,!(o=i===ht.WebRTC?ge(r):P[r]))return void C.debug("[CstaSvc]: Call not found for callID= ",r);o.atcCallInfo.setOutgoingCallCampedOn(),o.isRemote&&o.checkCstaState(At.Busy)&&o.setCstaState(At.Delivered)}o.atcCallInfo.setServicesPermitted(e.servicesPermitted),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[o])}function qe(e){var t,n,i,r=e.failedConnection.cID;if("fail"===e.localConnectionInfo&&Re(e.failingDevice)){if((t=P[r])&&t.atcCallInfo&&t.atcCallInfo.masterParallelHgCall)return void C.debug("[CstaSvc]: Ignore Failed event for master parallel hunt group");switch(Re(e.callingDevice)&&(n=_e(e.calledDevice)).dn!==te&&t&&!t.pickedUp&&n.fqn!==Dt.cleanPhoneNumber(t.atcCallInfo.peerFQN)&&(ie(t,n.dn,n.fqn,n.name),t.atcCallInfo.setPartnerDisplay(n)),e.cause){case"blocked":U[r]&&C.debug("[CstaSvc]: Received Failed event for transfer, waiting for ConnectionCleared event"),E.localUser.isOSV||(i=ve(e.failedConnection.dID),(t=i===ht.WebRTC?ge(r):P[r])&&t.isHandoverInProgress&&(C.debug("[CstaSvc]: Received Failed event from non OSV PBX while handover is in progress"),t.clearAtcHandoverInProgress(),C.debug("[CstaSvc]: Publish /atccall/moveFailed event"),T.publish("/atccall/moveFailed")),E.localUser.isOsBizCTIEnabled&&t&&t.isRemote&&t.atcCallInfo&&t.atcCallInfo.setServicesPermitted(e.servicesPermitted));break;case"doNotDisturb":(t=P[r])?(C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[t])):C.warn("[CstaSvc]: DND call does not exist. Ignore Failed event");break;case"reorderTone":(t=P[r])?(t.atcCallInfo.setMissedReason(_t.REORDER_TONE),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[t])):C.warn("[CstaSvc]: Outgoing call failed with reorder tone");break;case"busy":(t=P[r])?(t.atcCallInfo.setMissedReason(_t.BUSY),t.checkCstaState(At.Offered)&&t.setCstaState(At.Failed),t.atcCallInfo.clearOutgoingCallCampedOn(),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[t])):C.warn("[CstaSvc]: Busy call does not exist. Ignore Failed event");break;case"destNotObtainable":(t=ge(r)||P[r])&&d(function(){t.isPresent()&&function(e,t){var n=e.isOsBizSecondCall?u.findOsBizFirstCall():Te();if(e&&n&&Ue(t)){return Le({request:"ReconnectCall",heldCall:Ye(n.atcCallInfo),activeCall:Ye(e.atcCallInfo)},t)}t&&t()}(t)},R)}}else if("connected"===e.localConnectionInfo&&Re(e.callingDevice)){if((t=ge(r))&&t.atcCallInfo.getCstaCallId()===r||(t=P[r]),!t)return void C.warn("[CstaSvc]: Could not find call corresponding to handle FailedEvent Event.");switch(t.atcCallInfo.setServicesPermitted(e.servicesPermitted),(n=_e(e.failingDevice||e.calledDevice))&&(t.atcCallInfo.setPartnerDisplay(n),ie(t,t.atcCallInfo.peerDn,t.atcCallInfo.peerFQN,t.atcCallInfo.peerName)),e.cause){case"busy":t.isRemote&&(t.setCstaState(At.Busy),t.atcCallInfo.setMissedReason(_t.BUSY));break;case"reorderTone":t.atcCallInfo.setMissedReason(_t.REORDER_TONE);break;case"blocked":t.atcCallInfo.setMissedReason(_t.DECLINED);break;case"destOutOfOrder":t.atcCallInfo.setMissedReason(_t.DEST_OUT_OF_ORDER);break;default:t.atcCallInfo.setMissedReason(_t.DEFAULT)}C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[t])}}function je(e){if(Z)return C.warn("[CstaSvc]: Queue new forwarding request until loop detected timer expires"),void(ee=e);Date.now()-J<A?$++:$=0,J=Date.now(),C.debug("[CstaSvc]: Forward loop counter: "+$+" timestamp: "+J),i<$?(C.error("[CstaSvc]: Loop detected while trying to update forwarding data."),ee=e,Z=d(function(){C.debug("[CstaSvc]: Loop detection timeout has expired. Process queued request."),$=0,Z=null,ee&&ee(),ee=null},r,!1)):e&&e()}function Qe(n,t,e,i){if(Ue(i))if(n.atcCallInfo&&(n.checkCstaState([At.Active])||n.atcCallInfo.isHandoverAllowed()||n.atcCallInfo.isDeflectAllowed()))if(we(n,t)){var r=ye(t,e,E.localUser.isOsBizCTIEnabled,E.localUser.isOsBizCTIEnabled);if(r){var o={autoAnswer:t===ht.Desk||t===ht.WebRTC};n.checkCstaState([At.Ringing,At.Parked])?(o.request="DeflectCall",o.callToBeDiverted=Ye(n.atcCallInfo),o.newDestination=r,E.localUser.isOSV||(C.debug("[CstaSvc]: Publish /csta/handover event"),T.publish("/csta/handover",n.atcCallInfo.getCstaCallId())),n.setAtcHandoverInProgress(),Le(o,function(e){e?(i&&i("res_MoveCallFailed"),n.clearAtcHandoverInProgress(),E.localUser.isOSV||(C.debug("[CstaSvc]: Publish /atccall/moveFailed event"),T.publish("/atccall/moveFailed",[!0]))):(E.localUser.isOSV&&(C.debug("[CstaSvc]: Publish /csta/handover event"),T.publish("/csta/handover",n.atcCallInfo.getCstaCallId())),t===ht.WebRTC&&n.atcCallInfo.setIgnoreCall(!0),n.atcCallInfo.transferCb=i)})):(o.request="SingleStepTransferCall",o.activeCall=Ye(n.atcCallInfo),o.transferredTo=r,o.seamlessHandover=n.atcCallInfo.isSeamlessHandoverAllowed(),E.localUser.isOSV||(C.debug("[CstaSvc]: Publish /csta/handover event"),T.publish("/csta/handover",n.atcCallInfo.getCstaCallId())),n.setAtcHandoverInProgress(),Le(o,function(e,t){e||!t?(i&&i("res_MoveCallFailed"),n.clearAtcHandoverInProgress(),E.localUser.isOSV||(C.debug("[CstaSvc]: Publish /atccall/moveFailed event"),T.publish("/atccall/moveFailed",[!0]))):(Me(o.activeCall.cID,t),k={primaryCallId:o.activeCall.cID,newCallId:t.transferredCall.cID,direction:n.direction,redirectingUser:n.redirectingUser,transferCb:i},E.localUser.isOSV&&(C.debug("[CstaSvc]: Publish /csta/handover event"),T.publish("/csta/handover",n.atcCallInfo.getCstaCallId())),n.atcCallInfo.transferCb=i)}))}else i&&i("Failed to create new destination.")}else i&&i("The selected target is not available for this call.");else i&&i("res_MoveCallFailed")}function Xe(e,t){var n=Se(e.dialedDn);ie(n,e.dialedDn,e.dialedDn,e.toName),n.setCstaState(At.Delivered),n.direction=Tt.OUTGOING,n.atcCallInfo.setPosition(t);var i={dn:e.dialedDn,fqn:e.dialedDn,name:e.toName||""};if(n.atcCallInfo.setPartnerDisplay(i),n.atcCallInfo.setIgnoreCall(!0),P[e.dialedDn]=n,t===ht.WebRTC&&E.localUser.isOsBizCTIEnabled){var r={reuseSessionCtrl:h&&h.sessionCtrl},o=new vt(m,r);o.atcCallInfo=n.atcCallInfo,ie(o,n.peerUser.phoneNumber,null,n.peerUser.displayName),o.isOsBizSecondCall=!0,o.setState(pt.Initiated),o.direction=Tt.OUTGOING,de(e.dialedDn,!0),m.call=o,C.debug("[CstaSvc]: Publish /conversation/update event. convId = ",m.convId),T.publish("/conversation/update",[m]),u.addCallToList(o),C.debug("[CstaSvc]: Publish /call/state event. callId = "+o.callId+", state = "+o.state.name),T.publish("/call/state",[o])}else C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[n]),C.debug("[CstaSvc]: Created new Remote Call object: ",n)}function ze(e,t,n){var i=Ce(t.dialedDn);if(i)i.atcCallInfo.setCstaConnection(e),i.setCallIdForTelephony(e.cID),i.setCstaState(At.Delivered),i.atcCallInfo.setIgnoreCall(!1),t.dtmfDigits&&(i.dtmfDigits=t.dtmfDigits),delete P[t.dialedDn];else{ie(i=Se(e.cID),t.dialedDn,t.dialedDn,t.toName),i.setCstaState(At.Delivered),i.direction=Tt.OUTGOING,i.atcCallInfo.setCstaConnection(e),i.atcCallInfo.setPosition(n);var r={dn:t.dialedDn,fqn:t.dialedDn,name:t.toName||""};i.atcCallInfo.setPartnerDisplay(r)}P[e.cID]=i,C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[i]),C.debug("[CstaSvc]: Created new Remote Call object: ",i)}function Je(e,t){if(e&&h){C.debug("[CstaSvc]: Creating local waiting call"),e.direction=Tt.INCOMING,e.atcCallInfo.setPosition(ht.WebRTC),t&&e.atcCallInfo.setServicesPermitted(t),e.atcCallInfo.setIgnoreCall(!0);var n={reuseSessionCtrl:h&&h.sessionCtrl},i=new vt(m,n);i.atcCallInfo=e.atcCallInfo,ie(i,e.peerUser.phoneNumber,null,e.peerUser.displayName),i.isOsBizSecondCall=!0,h.isOsBizFirstCall=!0,i.direction=Tt.INCOMING,m.call=i,C.debug("[CstaSvc]: Publish /conversation/update event. convId = ",m.convId),T.publish("/conversation/update",[m]),i.setState(pt.Ringing),i.setCstaState(At.Ringing),u.addCallToList(i),C.debug("[CstaSvc]: Publish /call/incoming event"),T.publish("/call/incoming",[m.call])}}function $e(){var e=[];return st.WebRTCAdapter.enabled&&e.push(ht.WebRTC),w||e.push(ht.Desk),v&&v.cell&&e.push(ht.Cell),e}function Ze(n){var i=null;if(E.localUser.selectedBusyHandlingOption!==Ct.DefaultRouting.name){var r=n.atcCallInfo&&n.atcCallInfo.getCstaConnection()||H;if(r&&G){switch(E.localUser.selectedBusyHandlingOption){case Ct.SendToAlternativeNumber.name:i={request:"DeflectCall",callToBeDiverted:r,newDestination:ye(ht.Cell)};break;case Ct.BusySignal.name:i={request:"ClearConnection",connectionToBeCleared:r,reason:"busy"};break;case Ct.SendToVM.name:i={request:"DeflectCall",callToBeDiverted:r,newDestination:ye(ht.VM)};break;default:return}Le(i,function(e){if(!e&&"ClearConnection"===i.request)if(n.atcCallInfo)n.atcCallInfo.setMissedReason(_t.BUSY),n.checkCstaState(At.Offered)&&n.setCstaState(At.Failed);else if(o.isClearConnectionBusySupported()){var t=P[r.cID]||Se(r.cID);t.peerUser=n.peerUser,t.direction=Tt.INCOMING,t.creationTime=n.creationTime,t.atcCallInfo.setMissedReason(_t.BUSY),P[r.cID]=t,de(r.cID)}}),H={}}}else n.checkCstaState(At.Offered)&&(Le(i={request:"AcceptCall",callToBeAccepted:n.atcCallInfo.getCstaConnection()}),H={})}function et(e){E.localUser.userPresenceState.state!==It.PresenceState.DND&&e?(C.debug("[CstaSvc]: DND is enabled on the switch. Set snooze on Circuit."),t.snooze(-1)):E.localUser.userPresenceState.state!==It.PresenceState.DND||e||(C.debug("[CstaSvc]: DND is disabled on the switch. Resume snooze on Circuit."),t.resume())}function tt(e,t){E.localUser.isOsBizCTIEnabled?t&&et(t.doNotDisturbOn):E.localUser.doNotDisturbOn=t.doNotDisturbOn}function nt(e,t){!e&&t&&(E.localUser.callForwardingAvailable=!E.localUser.isOSV,t.forwardList&&0<t.forwardList.length&&t.forwardList.forEach(function(e){if(Ne(e.forwardingType))E.localUser.callForwardingAvailable=!0,e.forwardDN!==v.vm?(E.localUser.callForwardingNumber=gt.format(e.forwardDN),E.localUser.callForwardingEnabled=e.forwardStatus):(E.localUser.callForwardingToVMEnabled=e.forwardStatus,E.localUser.isOsBizCTIEnabled&&(E.localUser.callForwardingNumber=v.vm));else if(he(e.forwardingType)){if(E.localUser.isOsBizCTIEnabled){var t=fe(e.forwardDN);E.localUser.reroutingPhoneNumber=e.forwardStatus&&t&&t[1]||""}}else me(e.forwardingType)}),v.forwardList=t.forwardList||[],t.hasOwnProperty("voicemailActive")&&(E.localUser.voicemailPBXEnabled=!0,E.localUser.voicemailActive=t.voicemailActive,E.localUser.voicemailRingDuration=t.voicemailRingDuration,q=t.voicemailRingDuration),t.mainRingDuration&&(E.localUser.ringDurationEnabled=!0,E.localUser.mainRingDuration=t.mainRingDuration,E.localUser.clientRingDuration=t.clientRingDuration,E.localUser.cellRingDuration=t.cellRingDuration,j=t.mainRingDuration,Q=t.clientRingDuration,X=t.cellRingDuration,E.localUser.alternativeNumber=t.alternativeNumber||Dt.cleanPhoneNumber(E.localUser.reroutingPhoneNumber),E.localUser.routeToCell=t.routeToCell,E.localUser.ringDurationConfigurable=t.hasOwnProperty("overrideProfile")?t.overrideProfile:!E.localUser.isOSV),C.debug("[CstaSvc]: Publish /localUser/update event"),T.publish("/localUser/update",[E.localUser]),C.debug("[CstaSvc]: Publish /csta/getForwardingResponse"),T.publish("/csta/getForwardingResponse"),Ge())}function it(e,t){!e&&t&&(E.localUser.isAgent=t.loggedOnState,E.localUser.isAgent&&(E.localUser.agentStateReady=t.agentState===ct.Ready,E.localUser.isOSV&&(ne=t.huntGroupList),C.debug("[CstaSvc]: Publish /agent/state/ready event"),T.publish("/agent/state/ready",[E.localUser.agentStateReady])))}function rt(e){Dt.isMobile()||u.getActiveCall()||(e=e||Object.values(P).find(function(e){return e.pickupNotification}))&&e.isPresent()&&!e.pickupNotificationShown&&(C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[e]),C.debug("[CstaSvc]: Publish /call/pickupNotification event"),T.publish("/call/pickupNotification",[e]),e.pickupNotificationShown=!0)}function ot(e,t){Ue(t)&&Le({request:"SetBusy",device:ke(),busyState:e},t)}function at(e,t){e.isOsBizSecondCall&&(e.setState(t),C.debug("[CstaSvc]: Publish /conversation/update event. convId = ",m.convId),T.publish("/conversation/update",[m]))}return _.on("ATC.CSTA",function(e){e.type===dt.CSTA&&e.CSTA&&E.$apply(function(){!function(e){var t=N.parseEvent(e.CSTA);if(!t)return;switch(function(e,t){"DigitsGeneratedEvent"===e.name&&(t.CSTA=t.CSTA.replace(/"dGL":"[^"]*"/,'"dGL":"***"')),C.debug("[CstaSvc]: Received CSTA event: ",t)}(t,e),C.debug("[CstaSvc]: Parsed CSTA Event: ",t),delete t.keysToOmitFromLogging,t.category){case"CallControl":case"CallAssociatedFeature":f.handleCallEvent(t);break;case"LogicalDeviceFeature":f.handleLogicalDeviceEvent(t);break;case"PhysicalDeviceFeature":break;case"DeviceMaintenance":f.handleDeviceEvent(t);break;default:C.debug("[CstaSvc]: Unsupported CSTA Event category: "+t.category)}}(e)})}),_.on("ATC.PRIMARYCLIENT",function(e){C.info("[CstaSvc]: Received PRIMARYCLIENT event:",e),e.type===dt.PRIMARYCLIENT&&e.primaryClientId&&function(e){G=E.localUser.clientId!==e?(C.debug("[CstaSvc]: This is not the Primary ATC client"),!1):(C.debug("[CstaSvc]: This is the primary ATC client"),!0)}(e.primaryClientId)}),_.on("ATC.ADVANCING",function(e){if(e.type===dt.ADVANCING){C.debug("[CstaSvc]: Received UserToUser ATC.ADVANCING");var t=u.getIncomingCall(e.rtcSessionId);t&&(k={newCallId:t.atcCallInfo.getCstaCallId(),direction:t.direction,redirectingUser:t.redirectingUser})}}),g.on("Team.NOTIFY",function(n){E.circuitLabs.TEAMS?n.callingUser?m&&E.localUser.phoneNumber?E.localUser.callForwardingEnabled||E.localUser.doNotDisturbOn?C.debug("[CstaSvc]: Ignore team notification as the user has call forwarding immediate or DND enabled"):Fe(n.callingUser.fullyQualifiedNumber,n.callingUser.displayName)?C.debug("[CstaSvc]: There is already a pickup notification for this call. Ignore it."):(C.debug("[CstaSvc]: Handle the team notification for phone call"),E.$apply(function(){c.getUserById(n.calledUserId,function(e,t){!e&&t?t.userId!==E.localUser.userId?Be({callingDisplay:{dn:n.callingUser.phoneNumber,fqn:n.callingUser.fullyQualifiedNumber,name:n.callingUser.displayName},calledDisplay:{dn:t.phoneNumber,fqn:t.fullyQualifiedNumber,name:t.displayName},callId:n.rtcSessionId,callingUserId:n.callingUserId}):C.debug("[CstaSvc]: Ignore team notification when called user is the local user"):C.error("[CstaSvc]: Error getting called user")})})):C.error("[CstaSvc]: No telephony conversation or phoneNumber. Cannot handle team notification"):C.debug("[CstaSvc]: Ignore team notification for Circuit call"):C.debug("[CstaSvc]: Ignore team notification as the user has not enabled the feature")}),g.on("Team.NOTIFY_CANCEL",function(e){var t=P[e.rtcSessionId];t&&!t.isHandoverInProgress&&E.$apply(function(){de(e.rtcSessionId)})}),T.subscribe("/conversations/showTelephonyConversation",function(e,t){C.debug("[CstaSvc]: Received /conversations/showTelephonyConversation event. show = ",e),e&&(m=t)}),T.subscribe("/conversation/update",function(e){m&&m.convId===e.convId&&(m=e)}),T.subscribe("/atcRegistration/state",function(e){C.debug("[CstaSvc]: Received /atcRegistration/state event."),Y=e,E.localUser.isATC&&(!M&&e===ut.Registered&&z?Pe():M=!1,e!==ut.Registered&&Ee())}),T.subscribe("/activeSessions/received",function(){C.debug("[CstaSvc]: Received /activeSessions/received event"),z=!0,M||Y===ut.Registered&&Pe()}),T.subscribe("/registration/state",function(e){C.debug("[CstaSvc]: Received /registration/state event"),e!==RegistrationState.Registered&&(z=!1)}),T.subscribe("/call/incoming",function(e){e&&m&&e.convId===m.convId&&(C.debug("[CstaSvc]: Received /call/incoming event."),Object.keys(P).some(function(e){var t=P[e];return!(!t.checkCstaState(At.Ringing)||t.atcCallInfo.getPosition()!==ht.WebRTC)&&((D=ce())&&(C.debug("[CstaSvc]: Found a matching ATC remote call. Move call info to alerting call."),D.atcCallInfo=t.atcCallInfo,t.atcCallInfo=new lt,t.atcCallInfo.setIgnoreCall(!0),de(e)),!0)}))}),T.subscribe("/atccall/firstcall",function(e){C.debug("[CstaSvc]: Received /atccall/firstcall event"),function(e){var t=e.atcCallInfo&&e.atcCallInfo.getCstaConnection()||H;G&&Le({request:"DeflectCall",callToBeDiverted:t,newDestination:ye(ht.Desk)})}(e)}),T.subscribe("/atccall/secondcall",function(e){C.debug("[CstaSvc]: Received /atccall/secondcall event."),Ze(e)}),T.subscribe("/atccall/replace",function(e,t){C.debug("[CstaSvc]: Received /atccall/replace event");var n=P[t];n&&(e.establishedTime=n.establishedTime,de(t,!0))}),T.subscribe("/conversation/item/add",function(e){e&&m&&e.convId===m.convId&&e.rtc&&e.rtc.rtcParticipants&&2===e.rtc.rtcParticipants.length&&(V.unshift("TELEPHONY"===e.rtc.rtcParticipants[0].type?e.rtc.rtcParticipants[0]:e.rtc.rtcParticipants[1]),2<V.length&&V.pop())}),T.subscribe("/call/ended",function(e){e&&e.isTelephonyCall&&!e.isRemote&&(x=e,d.cancel(W),W=d(function(){W=x=null},2e3),(e.isOsBizSecondCall||e.pulled)&&ue(e)),e.pickupNotification||e.isRemote||rt(),ae()}),T.subscribe("/routing/alternativeNumber/changed",function(){C.debug("[CstaSvc]: Received /routing/alternativeNumber/changed event"),Ge()}),T.subscribe("/localUser/update",function(){E.localUser.isATC&&(C.debug("[CstaSvc]: Received /localUser/update event"),E.localUser.isOsBizCTIEnabled&&(e&&E.localUser.userPresenceState.state!==It.PresenceState.BUSY||!e&&E.localUser.userPresenceState.state===It.PresenceState.BUSY&&u.getCalls().some(function(e){return!e.isTelephonyCall}))&&(e=!e,G&&(C.debug("[CstaSvc]: Update busy state. New State: ",e),ot(e))),Ge())}),T.subscribe("/user/snooze/start",function(){De()&&G&&(C.info("[CstaSvc]: Received /user/snooze/start event"),f.setDoNotDisturb(!0))}),T.subscribe("/user/autoSnooze/start",function(){De()&&G&&(C.info("[CstaSvc]: Received /user/autoSnooze/start event"),f.setDoNotDisturb(!0))}),T.subscribe("/user/snooze/end",function(){De()&&G&&(C.info("[CstaSvc]: Received /user/snooze/end event"),f.setDoNotDisturb(!1))}),T.subscribe("/user/snooze/resume",function(){De()&&G&&(C.info("[CstaSvc]: Received /user/snooze/resume event."),f.setDoNotDisturb(!1))}),T.subscribe("/language/update",function(){te=E.i18n.map.res_NumberNotAvailable}),this.alternate=function(t,n,i){if(Ue(i))if(t&&n){t.setRetrieveInProgress(),n.setHoldInProgress();var e={request:"AlternateCall"};e.activeCall=Ye(n.atcCallInfo),e.heldCall=Ye(t.atcCallInfo),Le(e,function(e){e?(t.clearRetrieveInProgress(),n.clearHoldInProgress(),i&&i("res_RetrieveCallFailed")):(E.localUser.isOsBizCTIEnabled&&(m.call=t,C.debug("[CstaSvc]: Publish /conversation/update event. convId = ",m.convId),T.publish("/conversation/update",[m])),i&&i(null))})}else i&&i("Invalid calls to alternate")},this.conference=function(e,t,n){if(Ue(n))if(e&&t){var i={request:"ConferenceCall"};i.activeCall=Ye(t.atcCallInfo),i.heldCall=Ye(e.atcCallInfo),Le(i,function(e,t){!e&&t||n&&n("res_MergeCallFailed")})}else n&&n("Invalid calls to conference")},this.answer=function(t,e){if(Ue(e)){var n=Ce(t);if(!n){if(!D||!D.atcAdvancing)return void(e&&e("There is no call to be answered"));var i=Ye((n=D).atcCallInfo);i.dID=v.onsFQN,n.atcCallInfo.setCstaConnection(i)}var r=n.atcAdvancing?ht.Desk:n.atcCallInfo.getPosition(),o=Object.values(P).find(function(e){return e.callId!==t&&e.atcCallInfo.getPosition()===r});if(!o||E.localUser.isOsBizCTIEnabled)Le({request:"AnswerCall",callToBeAnswered:Ye(n.atcCallInfo)},e);else f.alternate(n,o,e)}},this.answerCstaCall=function(e,t){Ue(t)&&Le({request:"AnswerCall",callToBeAnswered:{cID:e,dID:v.onsFQN}},t)},this.pickupCall=function(t,e,n){n=n||function(){};var i=Ce(t);if(i&&i.pickupNotification){if(i.pickupSession)!function(e,n){var t={content:{type:yt.TEAM_PICKUP,teamPickupData:{pickupSessionId:e.pickupSession,divertTo:Dt.cleanPhoneNumber(E.localUser.isOsBizCTIEnabled?v.onsFQN:E.localUser.callerId)}},destUserId:e.peerGtcUserId};_.sendTeamPickupRequest(t,function(e,t){e||t&&t.error?t&&bt[t.error]?n&&n(bt[t.error].ui):n&&n("res_PickUpCallFailed"):n&&n()})}(i,function(e){if(e)return n(e),void de(t,!0);n()});else{if(!Ue(n))return;Le({request:"GroupPickupCall",newDestination:ye(e=e||ht.WebRTC)},function(e){if(e)return n("res_PickUpCallFailed"),void de(t,!0);n()})}C.debug("[CstaSvc]: Publish /atccall/pickUpInProgress"),T.publish("/atccall/pickUpInProgress",[i]),i.setAtcHandoverInProgress()}else n("There is no call to be picked up")},this.clearTransferredCall=function(e){L[e]&&(d.cancel(L[e].timeout),delete L[e])},this.consultationTransfer=function(e,t,n){Ue(n)&&Le({request:"TransferCall",heldCall:Ye(t.atcCallInfo),activeCall:Ye(e.atcCallInfo)},function(e,t){e||!t?n&&n(Pt.Unreachable.ui):n&&n(null)})},this.deflect=function(e,t,n,i){if(Ue(i)){var r=ge(e)||u.getIncomingCall()||Ce(e);if(r)if(we(r,t))if(r.atcAdvancing&&t===ht.Desk)f.answer(e,i);else{var o=ye(t,n);if(o)Le({request:"DeflectCall",callToBeDiverted:Ye(r.atcCallInfo),newDestination:o,autoAnswer:t===ht.Desk||t===ht.WebRTC},function(e){e?i&&i("res_MoveCallFailed"):t!==ht.VM&&r.setAtcHandoverInProgress()});else i&&i("Failed to create new destination.")}else i&&i("The selected target is not available for this call.");else i&&i("There is no call to be deflected")}},this.generateDigits=function(t,n,i){Ue(i)&&Le({request:"GenerateDigits",connectionToSendDigits:Ye(t.atcCallInfo),charactersToSend:n},function(e){i&&i(e),E.localUser.isOsBizCTIEnabled&&!e&&(C.info("[CstaSvc]: Number of DTMF digits played: ",n&&n.length),T.publish("/call/singleDigitSent",[t,n]))},["GD.cTS"])},this.getDoNotDisturb=function(e){Ue(e)&&Le({request:"GetDoNotDisturb",device:ke()},e)},this.getForwarding=function(e){Ue(e)&&Le({request:"GetForwarding",device:ke()},e)},this.getMessageWaiting=function(e){Ue(e)&&Le({request:"GetMessageWaitingIndicator",device:ke()},e)},this.getTransferredCall=function(e){return L[e]},this.pullRemoteCall=function(e,t){var n=Ce(e);n?n.pickupNotification?f.pickupCall(e,null,t):Qe(n,ht[ht.WebRTC.name],null,t):(C.warn("[CstaSvc]: pullRemoteCall invoked without a valid call"),t("No active remote call"))},this.pushLocalCall=function(e,t,n){var i;ae(),h&&h.callId===e?i=h:O&&O.callId===e&&(i=O),i?Qe(i,ht[t],null,n):(C.warn("[CstaSvc]: pushLocalCall invoked without a valid call"),n("No active local call"))},this.endRemoteCall=function(e,t){var n=Ce(e);n?this.hangupRemote(n,t):(C.warn("[CstaSvc]: endRemoteCall invoked without a valid call"),t&&t("No active remote call"))},this.endCallOnRemoteDevices=function(e){Ue()&&v.osmoDeviceList&&e&&Le({request:"ClearConnection",connectionToBeCleared:{cID:e,dID:v.onsFQN}})},this.endCstaCall=function(e){Ue()&&e&&Le({request:"ClearConnection",connectionToBeCleared:{cID:e,dID:v.onsFQN}})},this.hangupRemote=function(t,n){t.isRemote&&Ue(n)&&Le({request:"ClearConnection",connectionToBeCleared:Ye(t.atcCallInfo)},function(e){e?n&&n(e):(t.getCstaState().established||t.atcCallInfo.getMissedReason()||(t.direction===Tt.INCOMING?t.atcCallInfo.setMissedReason(_t.DECLINED):t.atcCallInfo.setMissedReason(_t.CANCELLED),de(t.atcCallInfo.getCstaCallId())),n&&n())})},this.hold=function(t,n){if(Ue(n)){var e={request:"HoldCall",callToBeHeld:Ye(t.atcCallInfo)};E.localUser.isOsBizCTIEnabled&&t.isRemote&&v.supportedFeatures&&v.supportedFeatures.includes("zhOs")&&(e.holdOptions="exclusiveHold"),t.setHoldInProgress(),Le(e,function(e){e?(t.clearHoldInProgress(),n&&n("res_HoldCallFailed")):n&&n(null)})}},this.holdWithConsultationCall=function(n,i){if(Ue(i)){var e={request:"ConsultationCall",existingCall:Ye(n.atcCallInfo)};n.setHoldInProgress(),Le(e,function(e,t){e?(n.clearHoldInProgress(),i&&i("res_HoldCallFailed")):(t&&t.iC&&t.iC.cID&&n.atcCallInfo.setCstaReconnectId({cID:t.iC.cID,dID:v.onsFQN}),i&&i(null))})}},this.reconnect=function(e,t,n){Ue(n)&&Le({request:"ReconnectCall",heldCall:Ye(t.atcCallInfo),activeCall:Ye(e.atcCallInfo)},n)},this.retrieve=function(t,n){if(Ue(n)){var e={request:"RetrieveCall",callToBeRetrieved:Ye(t.atcCallInfo)};t.setRetrieveInProgress(),Le(e,function(e){e?(t.clearRetrieveInProgress(),n&&n("res_RetrieveCallFailed")):n&&n(null)})}},this.retrieveWithReconnectCall=function(t,n){if(Ue(n)){var e={request:"ReconnectCall",heldCall:Ye(t.atcCallInfo),activeCall:t.atcCallInfo.getCstaReconnectId()};t.setRetrieveInProgress(),Le(e,function(e){e?(t.clearRetrieveInProgress(),t.atcCallInfo.setCstaReconnectId({}),n&&n("res_RetrieveCallFailed")):n&&n(null)})}},this.setDoNotDisturb=function(e,t){Ue(t)&&(C.debug("[CstaSvc]: Set DND to ",e),Le({request:"SetDoNotDisturb",device:ke(),doNotDisturbOn:e},t))},this.setForwarding=function(e,t){if(Ue(t)){var n={request:"SetForwarding",device:ke(),activateForward:e.activateForward,forwardDN:e.forwardDN||"",forwardingType:e.forwardingType,ringCount:e.ringCount};je(function(){Le(n,t)})}},this.snapshotCall=function(e,t){Ue(t)&&Le({request:"SnapshotCall",snapshotObject:e},t)},this.snapshotDevice=function(e){Ue(e)&&Le({request:"SnapshotDevice",snapshotObject:v.onsFQN,osmo:v.osmo},e)},this.getLogicalDeviceInformation=function(n){Ue(n=n||function(){})&&Le({request:"GetLogicalDeviceInformation",device:ke()},function(e,t){e||!t||t.hasPhysicalDeviceInformation||w||(w=!0,He()),n(e,t)})},this.transfer=function(e,t,n){if(Ue(n)){var i={};e.checkCstaState([At.Ringing,At.Parked])?(i.request="DeflectCall",i.callToBeDiverted=Ye(e.atcCallInfo),i.newDestination=t,Le(i,n)):(i.request="SingleStepTransferCall",i.activeCall=Ye(e.atcCallInfo),i.transferredTo=t,Le(i,function(e,t){if(e||!t){if(e&&-1!==e.indexOf("internalResourceBusy"))return Me(i.activeCall.cID,{transferredCall:{cID:"00000000000000000000000000000000"}}),void(n&&n(null));n&&n(Pt.Unreachable.ui)}else Me(i.activeCall.cID,t),n&&n(null)}))}},this.consultationCall=function(n,i,r){if(Ue(r)&&i){var e={request:"ConsultationCall"};e.consultedDevice=i.dialedDn,e.existingCall=Ye(n.atcCallInfo),Xe(i,n.atcCallInfo.getPosition());var o=P[i.dialedDn];Le(e,function(e,t){if(e||!t){if(r&&r("res_MakeCallFailed"),o){if(e.endsWith("invalidCalledDeviceID"))o.atcCallInfo.setMissedReason(_t.REORDER_TONE);else{if(e.endsWith("requestIncompatibleWithCallingDevice")||e.endsWith("invalidDeviceID"))return void de(i.dialedDn,!0);o.atcCallInfo.setMissedReason(_t.DEST_OUT_OF_ORDER)}o.atcCallInfo.setIgnoreCall(!1),de(i.dialedDn)}}else!n.isRemote&&E.localUser.isOsBizCTIEnabled?n.isOsBizFirstCall=!0:ze(t.iC,i,n.atcCallInfo.getPosition()),r&&r()})}},this.makeCall=function(n,i,r){if(Ue(r)&&i){var e={request:"MakeCall"};e.calledDirectoryNumber=i.dialedDn,e.callingDevice=ye(n),e.autoOriginate=n===ht.Desk||n===ht.WebRTC?"doNotPrompt":"prompt",Xe(i,n);var o=P[i.dialedDn];Le(e,function(e,t){if(e||!t){if(r&&r("res_MakeCallFailed"),e.endsWith("invalidCalledDeviceID"))o.atcCallInfo.setMissedReason(_t.REORDER_TONE);else{if(e.endsWith("requestIncompatibleWithCallingDevice")||e.endsWith("invalidDeviceID"))return void de(i.dialedDn,!0);o.atcCallInfo.setMissedReason(_t.DEST_OUT_OF_ORDER)}o.atcCallInfo.setIgnoreCall(!1),de(i.dialedDn)}else ze(t.caD,i,n),r&&r()})}},this.ignoreCall=function(e,t){de(e.callId),t&&t()},this.callBackCallRelated=function(e,t){Ue(t)&&Le({request:"CallBackCallRelated",callBackConnection:e.atcCallInfo.getCstaConnection()},t)},this.callBackNonCallRelated=function(e,t){Ue(t)&&Le({request:"CallBackNonCallRelated",orD:v.onsFQN,tD:e},t)},this.cancelCallBack=function(e,t){Ue(t)&&Le({request:"CancelCallBack",orD:v.onsFQN,td:e||void 0},t)},this.setMicrophoneMute=function(e,t){Ue(t)&&Le({request:"SetMicrophoneMute",device:ke(),mute:e},t)},this.getMicrophoneMute=function(e){Ue(e)&&Le({request:"GetMicrophoneMute",device:ke()},e)},this.callLogSnapShot=function(e){Ue(e)&&Le({request:"CallLogSnapShot",device:ke()},e)},this.snapshot=function(){Oe()},this.getAgentState=function(e){Ue(e)&&Le({request:"GetAgentState",device:ke()},e)},this.setAgentState=function(e,t){(e=!!e)!==E.localUser.agentStateReady&&Ue(t)&&Le({request:"SetAgentState",device:ke(),state:e?ct.Ready:ct.NotReady},t)},this.handleCallEvent=function(e){if(e)if(ae(),M)try{switch(e.name){case"CallInformationEvent":!function(e){var t=e.connection.cID,n=null;if(e.pickupNotificationEarly){if(Re(e.connection.dID))return C.debug("[CstaSvc]: The pickup notification is for a call to this user. Ignore it");if(Re(e.callingDevice))return C.debug("[CstaSvc]: The calling party of this pickup notification call is this user. Ignore it");n=P[t];var i=_e(e.connection.dID),r=_e(e.callingDevice);if(n)C.debug("[CstaSvc]: Existing pickup call for: ",i.dn),n.atcCallInfo.setCstaConnection(e.connection);else{if(Fe(r.fqn,r.name))return C.debug("[CstaSvc]: There is already a pickup notification for this call. Ignore it");Be({callingDisplay:r,calledDisplay:i,callId:t,evt:e})}}else{if(n=ve(e.connection.dID,e.epid)===ht.WebRTC?ge(t):P[t]){if(n.atcCallInfo.setCstaConnection(e.connection),e.callingDevice&&!Re(e.callingDevice)){var o=_e(e.callingDevice);n.atcCallInfo.setPartnerDisplay(o),ie(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName)}e.servicesPermitted&&(n.atcCallInfo.setServicesPermitted(e.servicesPermitted),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.sST&&(n.checkCstaState(At.ConferenceHolding)?n.setCstaState(At.Holding):n.checkCstaState(At.Conference)&&n.setCstaState(At.Active))),n.checkCstaState([At.Offered,At.ExtendedRinging,At.Idle])?C.debug("[CstaSvc]: Do not publish /atccall/info event at Offered state"):(C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[n]))}else C.warn("[CstaSvc]: Could not find call corresponding to CallInformation Event.")}}(e);break;case"ConferencedEvent":!function(e){e.secondaryOldCall&&(E.localUser.isOsBizCTIEnabled&&Ve(e.secondaryOldCall.cID)?C.debug("[CstaSvc]: Cleared secondary atc call with Call Id = ",e.secondaryOldCall.cID):de(e.secondaryOldCall.cID));var a=null,t=ve(e.primaryOldCall.dID,e.epid),s=E.localUser.isOSV||E.localUser.isOsBizCTIEnabled||t!==ht.WebRTC||!e.secondaryOldCall?e.primaryOldCall.cID:e.secondaryOldCall.cID;(a=t===ht.WebRTC?ge(s):P[s])?(e.conferenceConnections.forEach(function(e){if(e.endpoint&&Re(e.endpoint)||e.connection&&Re(e.connection.dID)){if(a.atcCallInfo.setCstaConnection(e.connection),a.isAtcRemote){var t=a.atcCallInfo,n=a.peerUser,i=a.participants,r=a.direction;a.setCstaState(At.Idle),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[a]),delete P[s],(a=Se(e.connection.cID)).atcCallInfo=t,a.peerUser=n,a.participants=i,a.direction=r,P[e.connection.cID]=a}C.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",e.connection)}else{var o=e.endpoint&&_e(e.endpoint)||_e(e.connection.dID);F.push({call:a,userId:e.connection.dID,participantId:e.connection.dID,phoneNumber:o.dn,displayName:o.name}),B||(B=!0,oe())}}),"hold"===e.localConnectionInfo?a.setCstaState(At.ConferenceHolding):(a.setCstaState(At.Conference),!a.isRemote&&E.localUser.isOsBizCTIEnabled&&a.setState(pt.Active)),a.atcCallInfo.setServicesPermitted(e.servicesPermitted),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[a])):C.debug("[CstaSvc]: Could not find a call with Call Id = "+s)}(e);break;case"ConnectionClearedEvent":!function(t){var e=t.droppedConnection.cID,n=ge(e)||P[e];if(H={},n){if(n.pickupNotification&&n.isHandoverInProgress)return;if(t.pickupNotificationTerminated&&(!t.droppedConnection.dID||Re(t.droppedConnection.dID)))return C.debug("[CstaSvc]: The pickup notification terminated event is for this user. Ignore it");if("null"!==t.localConnectionInfo){if(E.localUser.isOsBizCTIEnabled&&"multipleAlerting"===t.cause)return C.info("[CstaSvc]: Discarding ConnectionClearEvent due to parallel ringing");if(C.info("[CstaSvc]: Local connection info is not null.Update services permitted."),n.atcCallInfo.setServicesPermitted(t.servicesPermitted),1<n.participants.length&&(n.participants.some(function(e){return e.participantId===t.droppedConnection.dID&&(n.removeParticipant(e.userId),!0)}),1===n.participants.length&&n.isRemote||2===n.participants.length&&!n.isRemote)){var i=n.participants[n.isRemote?0:1];n.removeParticipant(i.userId),ie(n,i.phoneNumber,i.phoneNumber,i.displayName),n.checkCstaState(At.Conference)?n.setCstaState(At.Active):n.checkCstaState(At.ConferenceHolding)&&n.setCstaState(At.Holding)}return n.atcCallInfo.getMissedReason()||n.establishedTime||(n.direction===Tt.INCOMING?n.atcCallInfo.setMissedReason(Re(t.releasingDevice)?_t.DECLINED:_t.CANCELLED):n.atcCallInfo.setMissedReason(Re(t.releasingDevice)?_t.CANCELLED:_t.DECLINED)),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[n])}if(C.info("[CstaSvc]: Local connection info is null."),n.atcCallInfo.getMissedReason()||n.establishedTime||n.atcCallInfo.setMissedReason(n.direction===Tt.INCOMING&&"normalClearing"===t.cause?_t.DECLINED:_t.CANCELLED),n.clearAtcHandoverInProgress(),n.atcCallInfo.clearOutgoingCallCampedOn(),E.localUser.isOsBizCTIEnabled){if(n.atcCallInfo.getCstaReconnectId().cID)Le({request:"ClearConnection",connectionToBeCleared:n.atcCallInfo.getCstaReconnectId()}),n.atcCallInfo.setCstaReconnectId({});if(y&&y.checkState(pt.ActiveRemote)&&(y.pullBlocked=!1),Ve(e))return}if(C.info("[CstaSvc]: Update services permitted."),n.atcCallInfo.setServicesPermitted(t.servicesPermitted),n.checkCstaState(At.Busy)&&n.atcCallInfo.isCallBackAllowed()&&!E.localUser.isOsBizCTIEnabled)return d(function(){C.debug("[CstaSvc]: Callback presenting timer expired - terminate call"),de(n.atcCallInfo.getCstaCallId())},a)}var r=U[t.droppedConnection.cID]||U[s];r&&((n=Se(r)).atcCallInfo.setCstaConnection(t.droppedConnection),"normalClearing"!==t.cause&&(n.setCstaState(At.TransferFailed),n.atcCallInfo.setTransferCallFailedCause(t.cause)),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[n]),delete U[t.droppedConnection.cID],delete U[s]),de(t.droppedConnection.cID)}(e);break;case"DeliveredEvent":!function(e){var t,n,i,r,o,a=null;if(H={},Re(e.callingDevice)&&!be(e.localConnectionInfo,e.callingDevice,e.alertingDevice))r=At.Delivered,n=e.alertingDevice,i=e.calledDevice,t={cID:e.connection.cID,dID:e.callingDevice},o=Tt.OUTGOING;else{if(!Re(e.alertingDevice))return C.error("[CstaSvc]: ONS DN is neither in callingDevice nor in alertingDevice?!?");r=At.Ringing,n=Ie(e),t=e.connection,o=Tt.INCOMING}var s=ve(t.dID,e.epid),c=_e(n);if("enteringDistribution"===e.cause)return C.debug("[CstaSvc]: This event is for the master of the parallel hunt group"),(a=P[t.cID])||(a=Se(t.cID),P[t.cID]=a,C.debug("[CstaSvc]: Created new Remote Call object for callID= ",t.cID)),a.setCstaState(r),a.atcCallInfo.setPosition(s),a.atcCallInfo.setCstaConnection(t),a.atcCallInfo.setIgnoreCall(),a.atcCallInfo.masterParallelHgCall=!0;if(!E.localUser.isOsBizCTIEnabled||"keyOperation"!==e.cause&&"singleStepTransfer"!==e.cause||s!==ht.Desk||o!==Tt.INCOMING||P[t.cID]){if(s===ht.WebRTC){if(a=ge(t.cID)){if(a.atcCallInfo.setCstaConnection(t),a.atcCallInfo.setServicesPermitted(e.servicesPermitted),a.setCstaState(r),a.atcCallInfo.setQueuedIncomingCall(!1),at(a,pt.Delivered),s=a.isRemote?ht.Other:s,a.atcCallInfo.setPosition(s),c){C.debug("[CstaSvc]: Update partner display to ",c),a.atcCallInfo.setPartnerDisplay(c),ie(a,a.atcCallInfo.peerDn,a.atcCallInfo.peerFQN,a.atcCallInfo.peerName);var l=Ce(t.cID);l&&(l.forwarded&&re(a,l.redirectingUser.phoneNumber,l.redirectingUser.fqNumber,l.redirectingUser.displayName,l.redirectingUser.redirectionType),l.atcCallInfo.setIgnoreCall(!0),de(t.cID))}return C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[a])}if(x&&x.atcCallInfo&&x.atcCallInfo.getCstaCallId()===e.connection.cId)return C.warn("[CstaSvc]: The Delivered event is for a local call that was just terminated. Ignore it");C.warn("[CstaSvc]: There is no local call associated with the Delivered Event")}var d=t.cID;if((a=P[d])||(a=Se(d),P[d]=a,C.debug("[CstaSvc]: Created new Remote Call object for callID= ",d)),a.atcCallInfo.masterParallelHgCall)C.debug("[CstaSvc]: Ignore Delivered event for master parallel hunt group");else if(a.setCstaState(r),a.atcCallInfo.setServicesPermitted(e.servicesPermitted),a.atcCallInfo.setPosition(s),a.atcCallInfo.setCstaConnection(t),a.atcCallInfo.setQueuedIncomingCall(!1),a.clearAtcHandoverInProgress(),a.direction=o,a.receivedAlerting=!0,E.localUser.isOsBizCTIEnabled&&"recallNoAnswer"===e.cause&&s===ht.Desk&&o===Tt.INCOMING&&a.atcCallInfo.setRecalledCall(!0),c){if(a.atcCallInfo.setPartnerDisplay(c),i){var u=_e(i);u.fqn!==c.fqn?a.atcCallInfo.setOriginalPartnerDisplay(u):a.atcCallInfo.setOriginalPartnerDisplay(c)}ie(a,a.atcCallInfo.peerDn,a.atcCallInfo.peerFQN,a.atcCallInfo.peerName,function(){M&&(a.direction===Tt.INCOMING&&(C.debug("[CstaSvc]: Publish /call/remote/incoming event"),T.publish("/call/remote/incoming",[a])),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[a]))})}else a.direction===Tt.INCOMING&&(C.debug("[CstaSvc]: Publish /call/remote/incoming event"),T.publish("/call/remote/incoming",[a])),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[a])}else C.debug("[CstaSvc]: This event is received for parallel ringing on device.")}(e);break;case"DigitsGeneratedEvent":!function(e){var t=e.connection.cID,n=ge(t);n||(n=P[t]),n&&Re(e.connection.dID)&&(C.info("[CstaSvc]: Number of DTMF digits played: ",e.digitGeneratedList&&e.digitGeneratedList.length),T.publish("/call/singleDigitSent",[n,e.digitGeneratedList]))}(e);break;case"DivertedEvent":xe(e);break;case"EstablishedEvent":!function(e){var t,n,i,r,o;if(H={},Re(e.callingDevice)&&!be(e.localConnectionInfo,e.callingDevice,e.answeringDevice))t={cID:e.establishedConnection.cID,dID:e.callingDevice},n=e.answeringDevice,i=Tt.OUTGOING,o=_e(e.calledDevice);else{if(!Re(e.answeringDevice))return C.error("[CstaSvc]: ONS DN is neither in callingDevice nor in answeringDevice?!?");t=e.establishedConnection,n=Ie(e),i=Tt.INCOMING,o=_e(e.callingDevice)}C.debug("[CstaSvc]: LocalConnection: ",t),C.debug("[CstaSvc]: Partner Device ID: ",n);var a=_e(n),s=ve(t.dID,e.epid);if(s===ht.WebRTC){if(C.info("[CstaSvc]: The Established Event is for a local WebRTC call"),r=ge(t.cID)){r.atcCallInfo.setCstaConnection(t),C.info("[CstaSvc]: Set the CSTA connection ID for the active call: ",t),r.isRemote&&(C.warn("[CstaSvc]: There is no local call associated with the Established Event"),s=ht.Other),r.atcCallInfo.setServicesPermitted(e.servicesPermitted),"hold"===e.localConnectionInfo?r.setCstaState(At.Holding):r.setCstaState(At.Active),at(r,pt.Active),r.atcCallInfo.setPartnerDisplay(a),r.atcCallInfo.setPosition(s),r.clearAtcHandoverInProgress(),r.atcCallInfo.clearOutgoingCallCampedOn(),r.receivedAlerting=!0,r.atcCallInfo.setQueuedIncomingCall(!1),ie(r,r.atcCallInfo.peerDn,r.atcCallInfo.peerFQN,r.atcCallInfo.peerName),We(r,t.cID);var c=Ce(t.cID);return c&&(c.forwarded||c.pickupNotification)?(re(r,c.redirectingUser.phoneNumber,c.redirectingUser.fqNumber,c.redirectingUser.displayName,c.redirectingUser.redirectionType===Nt.CallForward?Nt.CallForward:Nt.CallPickedUp),c.atcCallInfo.setIgnoreCall(!0),de(t.cID)):"callPickup"===e.cause&&(r.pickupNotification?r.setRedirectionType(Nt.CallPickedUp):e.lastRedirectionDevice&&re(r,_e(e.lastRedirectionDevice).dn,_e(e.lastRedirectionDevice).fqn,_e(e.lastRedirectionDevice).name,Nt.CallPickedUp)),r.isRemote||r.isOsBizSecondCall||r.updateCallState(),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[r]),pe(s)}if("recall"===e.cause||"callPickup"===e.cause)return r=u.findActivePhoneCall(),C.info("[CstaSvc]: Original call callId:",r.atcCallInfo.getCstaCallId()),r.atcCallInfo.setCstaConnection(t),r.atcCallInfo.setServicesPermitted(e.servicesPermitted),"hold"===e.localConnectionInfo?r.setCstaState(At.Holding):r.setCstaState(At.Active),r.updateCallState(),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[r]);if(C.debug("[CstaSvc]: There is no local or remote call, change the position to Other"),s=ht.Other,Re(e.answeringDevice)&&!e.epid)return C.debug("[CstaSvc]: This is a call answered by VM. Ignore it");if(x&&x.atcCallInfo&&x.atcCallInfo.getCstaCallId()===t.cId)return C.warn("[CstaSvc]: The Established event is for a local call that was just terminated. Ignore it")}var l=!1;(r=P[t.cID])||(l=!0,We(r=Se(t.cID),t.cID)),r.atcCallInfo.masterParallelHgCall?C.debug("[CstaSvc]: Ignore Established event for master parallel hunt group"):(r.atcCallInfo.setPosition(s),r.atcCallInfo.setPartnerDisplay(a),r.atcCallInfo.setOriginalPartnerDisplay(o),ie(r,r.atcCallInfo.peerDn,r.atcCallInfo.peerFQN,r.atcCallInfo.peerName),r.atcCallInfo.setServicesPermitted(e.servicesPermitted),r.atcCallInfo.setCstaConnection(t),r.atcCallInfo.setRecalledCall(!1),r.direction=i,r.atcCallInfo.transferCb&&(r.atcCallInfo.transferCb&&r.atcCallInfo.transferCb(null,null,r),delete r.atcCallInfo.transferCb),r.clearAtcHandoverInProgress(),r.atcCallInfo.clearOutgoingCallCampedOn(),r.receivedAlerting=!0,r.atcCallInfo.setQueuedIncomingCall(!1),"hold"===e.localConnectionInfo?r.setCstaState(At.Holding):(r.setCstaState(At.Active),r.clearRetrieveInProgress()),"callPickup"===e.cause&&(r.pickupNotification?r.setRedirectionType(Nt.CallPickedUp):r.getRedirectionType()===Nt.Dss?r.setRedirectionType(null):e.lastRedirectionDevice&&re(r,_e(e.lastRedirectionDevice).dn,_e(e.lastRedirectionDevice).fqn,_e(e.lastRedirectionDevice).name,Nt.CallPickedUp)),l&&(C.debug("[CstaSvc]: Created new Remote Call object: ",r),P[t.cID]=r),E.localUser.isOsBizCTIEnabled&&y&&(y.pullBlocked=!0),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[r]),pe(s))}(e);break;case"FailedEvent":qe(e);break;case"HeldEvent":!function(e){var t=e.heldConnection.cID,n=ge(t);if(n||(n=P[t])){if(C.debug("[CstaSvc]: Current csta call state: ",n.getCstaState()),Re(e.holdingDevice)){switch(n.atcCallInfo.setCstaConnection(e.heldConnection),n.getCstaState()){case At.Held:n.setCstaState(At.HoldOnHold);break;case At.Conference:n.setCstaState(At.ConferenceHolding),E.localUser.isOsBizCTIEnabled&&!n.isRemote&&n.setState(pt.Holding);break;default:n.setCstaState(At.Holding),n.isRemote||n.setState(pt.Holding)}n.clearHoldInProgress()}else"hold"===e.localConnectionInfo?n.checkCstaState(At.ConferenceHolding)||n.setCstaState(At.HoldOnHold):n.checkCstaState(At.Conference)||n.setCstaState(At.Held);C.debug("[CstaSvc]: New csta call state: ",n.getCstaState()),n.atcCallInfo.setServicesPermitted(e.servicesPermitted),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[n])}else C.warn("[CstaSvc]: Could not find call corresponding to Held Event.")}(e);break;case"OfferedEvent":!function(e){var t,n;if(Re(e.offeredDevice)){if(t=e.offeredConnection,n=e.callingDevice,C.debug("[CstaSvc]: LocalConnection: ",t),C.debug("[CstaSvc]: Partner Device ID: ",n),E.localUser.callForwardingEnabled)return C.debug("[CstaSvc]: Immediate call forwarding is enabled. Accept call"),Le({request:"AcceptCall",callToBeAccepted:t});var i=_e(n),r=P[t.cID];if(!r||!r.pickupNotification){if((r=Se(t.cID)).atcCallInfo.setPosition(ht.Desk),r.atcCallInfo.setPartnerDisplay(i),ie(r,r.atcCallInfo.peerDn,r.atcCallInfo.peerFQN,r.atcCallInfo.peerName),r.atcCallInfo.setServicesPermitted(e.servicesPermitted),r.setCstaState(At.Offered),r.direction=Tt.INCOMING,r.atcCallInfo.setCstaConnection(t),I.test(e.cause)){var o=_e(e.lastRedirectionDevice);re(r,o.dn,o.fqn,o.name,Nt.CallForward)}C.debug("[CstaSvc]: Created new Remote Call object: ",r),P[t.cID]=r,H={cID:t.cID,dID:ye(ht.WebRTC,null,!0)},E.localUser.selectedRoutingOption!==mt.DeskPhone.name&&(u.isSecondCall()||m.call&&m.call.isAtcRemote&&!m.call.atcCallInfo.pickUp?Ze(r):(Le({request:"AcceptCall",callToBeAccepted:Ye(r.atcCallInfo)}),H={}))}}else C.debug("[CstaSvc]: ONS DN is not the offered device. Ignore Offered event.")}(e);break;case"QueuedEvent":Ke(e);break;case"RetrievedEvent":!function(e){var t=e.retrievedConnection.cID,n=ge(t);if(n||(n=P[t])){if(Re(e.retrievingDevice))n.atcCallInfo.setCstaConnection(e.retrievedConnection),n.checkCstaState(At.HoldOnHold)?(n.setCstaState(At.Held),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.zsiHo&&n.setCstaState(At.Active)):n.checkCstaState(At.ConferenceHolding)?(n.setCstaState(At.Conference),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.sST&&n.setCstaState(At.Active)):n.setCstaState(At.Active),n.isRemote||n.setState(pt.Active),n.clearRetrieveInProgress(),n.atcCallInfo.setCstaReconnectId({});else if(n.checkCstaState([At.ConferenceHolding,At.Conference]))"hold"===e.localConnectionInfo?n.setCstaState(At.ConferenceHolding):n.setCstaState(At.Conference);else if("hold"===e.localConnectionInfo?n.setCstaState(At.Holding):n.setCstaState(At.Active),n.isRemote){var i=_e(e.retrievingDevice);n.atcCallInfo.setPartnerDisplay(i),ie(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName)}n.atcCallInfo.setServicesPermitted(e.servicesPermitted),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[n])}else C.warn("[CstaSvc]: Could not find call corresponding to Retrieved Event.")}(e);break;case"ServiceCompletionFailureEvent":!function(e){var t=e.primaryCall.connectionID.cID,n=ve(e.primaryCall.connectionID.dID,v.epid)===ht.WebRTC?ge(t):P[t];if(!n)return C.debug("[CstaSvc]: Could not find a call with Call Id = "+t),C.debug("[CstaSvc]: Publish /atccall/hangingcall event"),T.publish("/atccall/hangingcall",t);if(C.debug("[CstaSvc]: Publish /atccall/moveFailed event"),T.publish("/atccall/moveFailed"),n.checkState([pt.Terminated,pt.Idle])){var i=n.atcCallInfo,r=n.peerUser,o=n.establishedTime,a=n.direction;delete P[t],(n=Se(t)).atcCallInfo=i,n.peerUser=r,n.establishedTime=o,n.direction=a,P[t]=n}n.clearAtcHandoverInProgress(),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[n])}(e);break;case"ServiceInitiatedEvent":!function(e){var t,n=ve(e.initiatingDevice,e.epid);if(n===ht.WebRTC&&(t=ge(e.initiatedConnection.cID)))if(t.atcCallInfo.setCstaConnection(e.initiatedConnection),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),!t.isRemote&&t.checkState([pt.Initiated,pt.Ringing,pt.Delivered]))C.info("[CstaSvc]: Set the CSTA connection ID for the call: ",e.initiatedConnection),t.setCstaState(At.Initiated),at(t,pt.Delivered),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[t]);else{if(t.isRemote)return C.info("[CstaSvc]: Set the CSTA connection ID for the remote call: ",e.initiatedConnection);C.error("[CstaSvc]: Call Initiated for WebRTC client has no active call or not in Initiated/Ringing state")}else(t=P[e.initiatedConnection.cID])||(t=Se(e.initiatedConnection.cID)).setCstaState(At.Initiated),t.atcCallInfo.setPosition(n),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),t.direction=Tt.OUTGOING,t.atcCallInfo.setCstaConnection(e.initiatedConnection),P[e.initiatedConnection.cID]=t,C.debug("[CstaSvc]: Created new Remote Call object: ",t)}(e);break;case"TransferredEvent":!function(a){if("null"!==a.localConnectionInfo){var s=null,c=a.primaryOldCall.cID,l=ge(c)||P[c];if(l){if(l.isAtcRemote&&a.secondaryOldCall&&a.secondaryOldCall.cID&&a.transferringDevice&&a.transferredToDevice&&be(a.localConnectionInfo,a.transferringDevice,a.transferredToDevice)){var e=ge(a.secondaryOldCall.cID);e&&(l.setCstaState(At.Idle),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[l]),delete P[c],(l=e).atcCallInfo.setCstaCallId(c))}if(a.transferredConnections.forEach(function(e){if(e.endpoint&&Re(e.endpoint)||e.connection&&Re(e.connection.dID))l.atcCallInfo.setCstaConnection(e.connection),C.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",e.connection),l.isAtcRemote&&(l.setCallIdForTelephony(e.connection.cID),delete P[c],P[l.callId]=l,C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[l]));else{if(l.isAtcRemote){var t=l.atcCallInfo;l.setCstaState(At.Idle);var n=l.peerUser,i=l.direction,r=l.establishedTime;C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[l]),delete P[c],(l=Se(e.connection.cID)).atcCallInfo=t,l.atcCallInfo.setCstaConnection(e.connection),l.setCstaState("alerting"===a.localConnectionInfo?At.Ringing:At.Active),C.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",e.connection),ie(l,n.phoneNumber,n.phoneNumber,n.displayName),l.direction=i,l.establishedTime=r;var o=_e(a.transferringDevice);l.atcCallInfo.setOriginalPartnerDisplay(o),P[l.callId]=l}s=e.endpoint&&_e(e.endpoint)||e.connection.dID&&_e(e.connection.dID)}}),!l.isRemote&&!l.isEstablished())return C.debug("[CstaSvc]: This is a WebRTC call that has not been answered. Update the display"),s&&(l.atcCallInfo.setPartnerDisplay(s),ie(l,l.atcCallInfo.peerDn,l.atcCallInfo.peerFQN,l.atcCallInfo.peerName,function(){M&&(C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[l]))}));switch(a.localConnectionInfo){case"hold":l.setCstaState(At.Holding);break;case"connected":l.setCstaState(At.Active);break;case"alerting":l.setCstaState(At.Ringing);break;default:C.debug("[CstaSvc]: Unexpected localConnectionInfo: ",a.localConnectionInfo)}l.atcCallInfo.setServicesPermitted(a.servicesPermitted),s&&(l.atcCallInfo.setPartnerDisplay(s),ie(l,l.atcCallInfo.peerDn,l.atcCallInfo.peerFQN,l.atcCallInfo.peerName,function(){M&&(C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[l]))})),C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[l])}else C.debug("[CstaSvc]: Could not find a call with Call Id = "+c)}else{if(a.secondaryOldCall){de(a.primaryOldCall.cID);var t=P[a.secondaryOldCall.cID];t&&t.atcCallInfo.setMissedReason(_t.TRANSFERRED),d(function(){de(a.secondaryOldCall.cID)},1e3)}else{if(Re(a.transferringDevice)&&Re(a.transferredToDevice)){var n=P[a.primaryOldCall.cID];n&&n.atcCallInfo.setIgnoreCall(!0);var i=ge(a.primaryOldCall.cID);i&&(i.pulled=ve(a.transferredToDevice)===ht.WebRTC,i.atcCallInfo.setIgnoreCall(!1),C.debug("[CstaSvc]: Set primaryCall.pulled to ",i.pulled))}de(a.primaryOldCall.cID)}if("singleStepTransfer"===a.cause){var r=f.getTransferredCall(a.primaryOldCall.cID);r&&(f.clearTransferredCall(a.primaryOldCall.cID),U[r.failedCallId]=a.primaryOldCall.cID)}else if("transfer"===a.cause){var o=Se(a.secondaryOldCall.cID);C.debug("[CstaSvc]: Publish /atccall/info event"),T.publish("/atccall/info",[o])}}}(e);break;default:C.debug("[CstaSvc]: Ignore CSTA Call Event ("+e.name+")")}}catch(e){C.error(e)}else C.debug("[CstaSvc]: Ignore any call event until snapshot is performed")},this.handleDeviceEvent=function(e){if(e)try{switch(e.name){case"BackInServiceEvent":w=!1,He();break;case"OutOfServiceEvent":w=!0,He();break;default:C.debug("[CstaSvc]: Ignore CSTA Device Event ("+e.name+")")}}catch(e){C.error(e)}},this.handleLogicalDeviceEvent=function(e){if(e)try{switch(e.name){case"ForwardingEvent":!function(t){t&&(v.forwardList.some(function(e){return!!(e.forwardingType===t.forwardingType||Ne(e.forwardingType)&&Ne(t.forwardingType))&&(e.forwardStatus=t.forwardStatus,e.forwardDN=t.forwardTo,!0)})||v.forwardList.push({forwardDN:t.forwardTo,forwardStatus:t.forwardStatus,forwardingType:t.forwardingType}),Ne(t.forwardingType)?(E.localUser.callForwardingAvailable=!0,t.forwardTo!==v.vm?(E.localUser.callForwardingNumber=gt.format(t.forwardTo),E.localUser.callForwardingEnabled=t.forwardStatus,E.localUser.callForwardingToVMEnabled=!1):(E.localUser.callForwardingToVMEnabled=t.forwardStatus,E.localUser.callForwardingEnabled=!1,E.localUser.isOsBizCTIEnabled&&(E.localUser.callForwardingNumber=v.vm))):he(t.forwardingType)?E.localUser.isOsBizCTIEnabled&&!t.forwardStatus&&(E.localUser.reroutingPhoneNumber=""):me(t.forwardingType),t.hasOwnProperty("staticOndActive")&&(t.staticOndActive?(K=t.staticOndDN,t.staticOndDN===Dt.cleanPhoneNumber(E.localUser.reroutingPhoneNumber)?E.localUser.selectedRoutingOption=mt.AlternativeNumber.name:(E.localUser.selectedRoutingOption=mt.Other.name,E.localUser.otherRoutingNumber=gt.format(t.staticOndDN))):(K="",E.localUser.selectedRoutingOption!==mt.AlternativeNumber.name&&E.localUser.selectedRoutingOption!==mt.Other.name||(E.localUser.selectedRoutingOption=mt.DefaultRouting.name))),t.hasOwnProperty("voicemailActive")&&(E.localUser.voicemailPBXEnabled=!0,E.localUser.voicemailActive=t.voicemailActive,E.localUser.voicemailRingDuration=t.voicemailRingDuration,q=t.voicemailRingDuration),t.hasOwnProperty("mainRingDuration")&&(E.localUser.ringDurationEnabled=!0,E.localUser.mainRingDuration=t.mainRingDuration,E.localUser.clientRingDuration=t.clientRingDuration,E.localUser.cellRingDuration=t.cellRingDuration,j=t.mainRingDuration,Q=t.clientRingDuration,X=t.cellRingDuration,E.localUser.alternativeNumber=t.alternativeNumber,E.localUser.routeToCell=t.routeToCell,E.localUser.ringDurationConfigurable=t.hasOwnProperty("overrideProfile")?t.overrideProfile:!E.localUser.isOSV),C.debug("[CstaSvc]: Publish /localUser/update event"),T.publish("/localUser/update",[E.localUser]),C.debug("[CstaSvc]: Publish /csta/forwardingEvent"),T.publish("/csta/forwardingEvent"))}(e);break;case"DoNotDisturbEvent":!function(e){De()&&e&&G?et(e.doNotDisturbOn):E.localUser.doNotDisturbOn=e.doNotDisturbOn}(e);break;case"AgentReadyEvent":case"AgentNotReadyEvent":case"AgentBusyEvent":case"AgentLoggedOffEvent":case"AgentLoggedOnEvent":!function(e){if(E.localUser){switch(e.name){case"AgentReadyEvent":E.localUser.agentStateReady=!0;break;case"AgentNotReadyEvent":case"AgentBusyEvent":case"AgentWorkingAfterCallEvent":E.localUser.agentStateReady=!1;break;case"AgentLoggedOffEvent":E.localUser.isAgent=!1,E.localUser.agentStateReady=!1;break;case"AgentLoggedOnEvent":E.localUser.isAgent=!0,E.localUser.agentStateReady=!1;break;default:return}E.localUser.isOSV&&(ne=e.huntGroupList),C.debug("[CstaSvc]: Publish /agent/state/ready event"),T.publish("/agent/state/ready",[E.localUser.agentStateReady])}}(e);break;default:C.debug("[CstaSvc]: Ignore CSTA Logical Device Event ("+e.name+")")}}catch(e){C.error(e)}},this.isPrimaryClient=function(){return G},this.getDisplayInfo=_e,this.getCallDevices=$e,this.getPushDevices=function(){var e=[];return w||e.push(ht.Desk),v&&v.cell&&e.push(ht.Cell),e},this.getAnswerDevices=function(e){var t=[];return e&&!e.pickupSession&&(w||e.isOsBizSecondCall||t.push(ht.Desk),v&&v.cell&&e.getPosition()!==ht.Cell&&t.push(ht.Cell),v&&v.vm&&(E.localUser.voicemailActive||E.localUser.isOsBizCTIEnabled)&&!e.pickupNotification&&t.push(ht.VM)),t},this.updateStaticOnd=function(e,t){if(Ue(t)){e=!!e,C.debug("[CstaSvc]: Update static OND status to ",e);var n={staticOndActive:e};if(e&&(n.staticOndDN=Dt.cleanPhoneNumber(E.localUser.reroutingPhoneNumber),!n.staticOndDN))return void(t&&t("Cannot activate static OND without the static OND DN"));if(e!==!!K||e&&n.staticOndDN!==K)Le({request:"SetForwarding",device:ke(),staticOndActive:n.staticOndActive,staticOndDN:n.staticOndDN},function(e){e?t&&t(e):(K=n.staticOndDN||"",t&&t(null))});else t&&t(null)}},this.updateRoutingOption=function(e,t){switch(e){case mt.AlternativeNumber.name:f.updateStaticOnd(!0,function(e){e?t&&t(e):f.setForwardingToVM(!1,t)});break;case mt.VM.name:f.setForwardingToVM(!0,function(e){e?t&&t(e):f.updateStaticOnd(!1,t)});break;default:f.setForwardingToVM(!1,function(e){e?t&&t(e):f.updateStaticOnd(!1,t)})}},this.setForwardingImmediate=function(e,t,n){t=t||E.localUser.callForwardingNumber;var i={activateForward:!!e,forwardDN:Dt.cleanPhoneNumber(t),forwardingType:"forwardImmediate"};f.setForwarding(i,n)},this.setForwardingToVM=function(e,t){if(f.getForwardingVMStatus()!==e){var n={activateForward:!!e,forwardDN:Dt.cleanPhoneNumber(v.vm),forwardingType:"forwardImmediate"};f.setForwarding(n,t)}else t&&t()},this.setForwardingNoAnswer=function(e,t){var n=!!(e=e||"");E.localUser.isOsBizCTIEnabled&&n&&(e="N<"+Dt.cleanPhoneNumber(e)+">PreferredDevice");var i={activateForward:n,forwardDN:e,forwardingType:"forwardNoAns"};f.setForwarding(i,t)},this.setRoutingOptionReroutingNumber=function(e,t){var n=!!(e=e||""),i={activateForward:n,forwardDN:e=n?"N<"+Dt.cleanPhoneNumber(e)+">PreferredDevice":"",forwardingType:"preferredDevice"};f.setForwarding(i,t)},this.getForwardingData=function(){return v.forwardList},this.getForwardingImmediate=function(){var e=v.forwardList.find(function(e){return Ne(e.forwardingType)&&e.forwardDN!==v.vm});return{status:!(!e||!e.forwardStatus),forwardDN:e&&e.forwardDN}},this.getForwardingVMStatus=function(){return v.forwardList.some(function(e){return Ne(e.forwardingType)&&e.forwardDN===v.vm&&e.forwardStatus})},this.setVoicemail=function(e,t,n){if(Ue(n))if(t=t||q,E.localUser.pbxCallForwardToVoiceMailSupported&&E.localUser.voicemailPBXEnabled)if(C.debug("[CstaSvc]: Set voice mail duration to: ",t),e!==E.localUser.voicemailActive||e&&q!==t){var i={request:"SetForwarding",device:ke(),voicemailActive:e,voicemailRingDuration:e?t:void 0};je(function(){Le(i,function(e){e?n&&n(e):(q=t,n&&n(null))})})}else n&&n(null);else n&&n("Cannot configure VM on PBX")},this.setRoutingTimers=function(t,n){if(Ue(n))if(E.localUser.ringDurationEnabled){if(C.debug("[CstaSvc]: Set routing timers to: ",t),j!==t.mainRingDuration||X!==t.cellRingDuration||Q!==t.clientRingDuration||!E.localUser.routeToCell){var e={request:"SetForwarding",device:ke(),mainRingDuration:t.mainRingDuration||void 0,clientRingDuration:t.clientRingDuration||void 0,cellRingDuration:t.cellRingDuration||void 0,routeToCell:!0};je(function(){Le(e,function(e){e?n&&n(e):(j=t.mainRingDuration||j,Q=t.clientRingDuration||Q,X=t.cellRingDuration||X,n&&n(null))})})}}else C.debug("[CstaSvc]: Cannot set routing timers"),n&&n("Cannot configure routing timers on PBX")},this.startCall=function(t,e,n,i){Ue(i)&&(t?E.localUser.isOsBizCTIEnabled&&t.isHolding()&&t.isRemote?v.supportedFeatures&&v.supportedFeatures.includes("zhOs")?(C.debug("[CstaSvc]: OSBiz supports exlussive hold for remote call. Send MakeCall"),f.makeCall(e,n,i)):f.retrieve(t,function(e){e?i&&i("res_MakeCallFailed"):f.consultationCall(t,n,i)}):f.consultationCall(t,n,i):f.makeCall(e,n,i))},this.getHuntGroupList=function(){return ne},this},st}((Circuit=function(vt){"use strict";var _t=vt.AtcCallInfo,gt=vt.Enums.AtcMessage,Nt=vt.BusyHandlingOptions,mt=vt.ClientApiHandlerSingleton,ht=vt.Constants,Ot=vt.DefaultAvatars,Dt=vt.Enums,Pt=vt.LocalCall,yt=vt.Proto,bt=vt.Enums.RedirectionTypes,Ut=vt.RemoteCall,Lt=vt.RoutingOptions,Mt=vt.RtcParticipant,wt=vt.RtcSessionController,Gt=vt.ScreenSharingController,Ht=vt.Enums.ScreenDisplayAction,kt=vt.Enums.ScreenFeaturesByPriority,Vt=vt.sdpParser,Ft=vt.UserToUserHandlerSingleton,Bt=vt.Utils,xt=vt.WebRTCAdapter,Wt=Object.values(vt.Enums.VideoResolutionLevel);return vt.CircuitCallControlSvcImpl=function(g,A,a,e,N,m,h,T,O,p,s,u){var c=vt.Conversation,l=vt.UserProfile;m.debug("New Service: CircuitCallControlSvc"),wt.isCMR=g.isCMR;var o=Bt.isMobile(),R=!!e.cordova,d=3200,t=6e4,E=2e3,C=5e3,S=500,f=this,D=mt.getInstance(),r=Ft.getInstance(),I=[],v=null,_=null,P=[],y=null,b=!1,U=!1,L={},M=[],w=null,n=!1,G=!1,H={},k=null,V=null,F=null,B=null,x=null,W=null;function Y(e){return O.getConversationAsGuestById(e)||O.getConversationFromCache(e)}function K(){if(V){var e=1e3*(V.ttl||0);e=Math.max(e-t,0),V.expirationTimestamp=Date.now()+e}}function q(e){if(e.audio=!!e.audio,e.video=!!e.video,e.desktop=!!e.desktop,g.isCMR)return e.hdVideo=e.video,e.minFrameRate=30,e.desktop=!1,void(e.hdDesktop=!1);if(e.video||(e.hdVideo=!1),e.desktop||(e.hdDesktop=!1),!vt.isSDK&&(e.video||e.hdDesktop)){var t=!(!o&&g.localUser.isICMixedUser&&!g.isICMode);e.video&&(e.hdVideo=!!(g.localUser.canUseHDVideo&&("boolean"==typeof e.hdVideo?e.hdVideo:t))),e.desktop&&(e.hdDesktop=!!(g.localUser.canUseHDScreenShare&&("boolean"==typeof e.hdDesktop?e.hdDesktop:t)))}}function j(o){return new N(function(n,i){var e=V&&V.expirationTimestamp||0;if(Date.now()<e){var t=new Date(e);return m.debug("[CircuitCallControlSvc]: Existing credentials are still valid. Expiration: "+t),void n(V)}m.debug("[CircuitCallControlSvc]: Get new TURN credentials");var r=u.createActionInfo(o,ht.RtcDiagnosticsAction.RENEW_TURN_CREDENTIALS);D.renewTurnCredentials(o.callId,function(e,t){g.$apply(function(){return r&&(r.data=JSON.stringify(t),u.finishActionInfo(o,r)),e?(m.error("[CircuitCallControlSvc]: Error renewing TURN credentials.",e),void i(e)):t&&t.length?(t=t[0],m.info("[CircuitCallControlSvc]: Received new TURN credentials=",t.turnServer),V=t,K(),void n(V)):(m.error("[CircuitCallControlSvc]: Error renewing TURN credentials. No server(s) available."),void i("No TURN server(s) available"))})})})}function Q(e){if(e){if(e.startsWith("res_"))return e;if(e===ht.ErrorCode.PERMISSION_DENIED)return"res_JoinRTCSessionFailedPermission";if(e===ht.SdpFailedCause.JOIN_FORBIDDEN)return"res_JoinRTCSessionFailedForbidden";if(e===ht.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE)return"res_JoinRTCSessionFailedMissingResources";if(e===ht.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)return e;if(e===ht.ReturnCode.DISCONNECTED||e===ht.ReturnCode.FAILED_TO_SEND)return"res_NotConnectedTryAgain"}return"res_JoinRTCSessionFailed"}function X(e){return e.some(function(e){return e.isMeetingPointInvitee})}function i(){return v&&v.isMocked&&!v.isDirect&&1<v.participants.length}function z(){!w&&i()&&(w=a(function(){m.debug("[CircuitCallControlSvc]: Active speaker simulation interval has fired"),i()?v.isEstablished()&&function(){if(Bt.randomBoolean()){var e=v.participants.filter(function(e){return e.pcState===Dt.ParticipantState.Active});if(!(e.length<2)){e.push(g.localUser);var t={sessionId:v.callId},n=["first","second","third"],i=Bt.randomNumber(0,3),r=Bt.randomArrayCopy(e,i);-1===r.indexOf(e[0])&&Bt.randomBoolean()&&(r.unshift(e[0]),i<3&&i++);for(var o=0;o<i;o++)t[n[o]]=r[o].userId;m.debug("[CircuitCallControlSvc]: Firing mocked ACTIVE_SPEAKER event: ",t),Je(t)}}}():(m.debug("[CircuitCallControlSvc]: Active speaker simulation is no longer needed. Stop interval."),a.cancel(w),w=null)},2e3,0,!1))}function J(e,t){if(!e.checkState(Dt.CallState.Ringing)||(M.push(e),!t)){for(var n=0;n<I.length;n++)if(e.sameAs(I[n]))return m.debug("[CircuitCallControlSvc]: Updating call with callId = "+e.callId),void(I[n]=e);I.push(e),e===v&&z(),g.localUser.isOsBizCTIEnabled&&e.isTelephonyCall&&!e.isRemote&&v&&e!==v&&(_=e),y=null}}function $(e){return!!e&&(g.localUser.remoteControlEnabled||g.isSessionGuest)}function Z(e){var t;for(t=0;t<I.length;t++)if(e.sameAs(I[t])){I.splice(t,1);break}for(t=0;t<M.length;t++)if(e.sameAs(M[t])&&!e.isHandoverInProgress){M.splice(t,1);break}for(t=0;t<P.length;t++)if(e.sameAs(P[t])){P.splice(t,1);break}e.isRemote?y=null:(b=e.sessionCtrl&&e.sessionCtrl.isMuted(),y=e,A(function(){y===e&&(y=null)},d))}function ee(e){e&&(m.debug("[CircuitCallControlSvc]: Publish /conversation/update event. convId = ",e.convId),h.publish("/conversation/update",[e]))}function te(e,t){e&&e.state!==Dt.CallState.Terminated&&(m.debug("[CircuitCallControlSvc]: Publish /call/state event. callId = "+e.callId+", state = "+e.state.name),h.publish("/call/state",t?[e,t]:[e]))}function ne(e,t){e&&(m.debug("[CircuitCallControlSvc]: Publish /call/rtp/iceConnectionState event. callId = "+e.callId+", iceState = "+t),h.publish("/call/rtp/iceConnectionState",[e.callId,t]))}function ie(e,t,n){if(e){m.info("[CircuitCallControlSvc]: Terminating call...");var i=function(e){if(v&&v.sameAs(e)){var t=f.getIncomingCall();return!!(t&&t.replaces&&t.replaces.sameAs(e))}return!!(v&&v.replaces&&v.replaces.sameAs(e))}(e);W&&W.callId===e.callId&&W.cancel(),lt(e),e.isRemote||(t&&function(e){switch(e){case Dt.CallClientTerminatedReason.DISCONNECTED:case Dt.CallClientTerminatedReason.FAILED_TO_SEND:case Dt.CallClientTerminatedReason.REQUEST_TIMEOUT:return!0;default:return!1}}(e.terminateReason=t)&&function(e){if(!e)return;var t="";switch(e.terminateReason){case Dt.CallClientTerminatedReason.DISCONNECTED:t=ht.RtcClientInfoReason.DISCONNECTED;break;case Dt.CallClientTerminatedReason.FAILED_TO_SEND:t=ht.RtcClientInfoReason.FAILED_TO_SEND;break;case Dt.CallClientTerminatedReason.REQUEST_TIMEOUT:t=ht.RtcClientInfoReason.REQUEST_TIMEOUT;break;default:return}var n={userId:g.localUser.userId,convId:e.convId,clientInfoType:ht.RtcClientInfoType.OFFLINE_JOIN_FAILURE,reason:t,timestamp:Date.now(),sessionId:e.callId},i=O.getConversationByRtcSession(e.callId);i&&i.call&&i.call.instanceId&&(n.instanceId=i.call.instanceId);m.info("[CircuitCallControlSvc]: Store new offline join failure. ",n),u.storeClientInfo(n)}(e),u.forceFinishDeviceDiagnostics(e)),e.screenShareEventHandler&&(Gt.unregEvtHandlers(e.screenShareEventHandler),e.screenShareEventHandler=null),e.rejectGetScreenPromise&&(e.rejectGetScreenPromise(ht.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED),e.rejectGetScreenPromise=null),e.isOsBizSecondCall||function(e){var t=e&&e.sessionCtrl;t&&(t.onIceCandidate=null,t.onSessionDescription=null,t.sessionClosed=null,t.onSdpConnected=null,t.onIceConnected=null,t.onIceDisconnected=null,t.onRemoteVideoAdded=null,t.onRemoteVideoRemoved=null,t.onRemoteStreamUpdated=null,t.onDTMFToneChange=null,t.onRtcError=null,t.onRtcWarning=null,t.onLocalStreamEnded=null,t.onStatsThresholdExceeded=null,t.onStatsNoOutgoingPackets=null,t.onNetworkQuality=null)}(e),Z(e),e.terminate(),g.closePopoutCallStage&&g.closePopoutCallStage(e),v&&v.sameAs(e)?(A.cancel(v.terminateTimer),v=_,_=null):_&&_.sameAs(e)&&(A.cancel(_.terminateTimer),_=null);var r=Y(e.convId);if(r&&r.call&&r.call.sameAs(e)&&!e.isHandoverInProgress){if(e.isTelephonyCall){var o=se()||ce();r.call=o||null}else r.call=null;(e.isDirect||e.establishedTime&&Date.now()-e.establishedTime>=C)&&O.updateLastCallTime(r),ee(r)}w&&!v&&(a.cancel(w),w=null),n||(m.debug("[CircuitCallControlSvc]: Publish /call/ended event. Replaced=",i),h.publish("/call/ended",[e,i]),e.ratingEvent&&Qe(e.ratingEvent))}}function re(e){return v&&v.callId===e?v:_&&_.callId===e?_:null}function oe(e){var t;for(t=0;t<I.length;t++)if(I[t].callId===e)return I[t];for(t=0;t<M.length;t++)if(M[t].callId===e)return M[t];var n=O.getConversationByRtcSession(e);return n&&n.call&&!n.call.isAtcRemote&&n.call.state.established&&n.call.callId===e?(I.push(n.call),n.call):re(e)}function ae(n,i){if(n.participantType===ht.RTCParticipantType.TELEPHONY&&n.phoneNumber){var e=v.getParticipant(n.userId);if(e&&e.phoneNumber&&e.phoneNumber===n.phoneNumber)return;T.startReverseLookUp(n.phoneNumber,function(e){if(i.isPresent()&&e){var t=v.getParticipant(n.userId);t&&(t.firstName=e.firstName,t.lastName=e.lastName,t.displayName=e.displayName,t.resolvedUserId=e.userId,m.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",t.userId),h.publish("/call/participant/updated",[v.callId,t]))}})}}function se(t){return I.find(function(e){return e.isTelephonyCall&&e.state.established&&!e.isHolding()&&(!t||!e.isRemote)})||null}function ce(t){return I.find(function(e){return e.isTelephonyCall&&e.state.established&&e.isHolding()&&(!t||!e.isRemote)})||null}function le(){return!g.localUser.selectedBusyHandlingOption||g.localUser.selectedBusyHandlingOption===Nt.DefaultRouting.name||g.localUser.isSTC}function de(t,n,i,e,r,o){if(t.atcCallInfo&&(!i&&t.atcCallInfo.peerFQN?i=t.atcCallInfo.peerFQN:i&&!t.atcCallInfo.peerFQN&&(t.atcCallInfo.peerFQN=i)),i&&t.peerUser&&t.peerUser.fqnLookedUp===i)o&&o();else if(t.setPeerUser(n,e,r),!r&&i){var a=null;o&&(a=A(function(){a=null,t.isPresent()&&(o(),o=null)},E)),T.startReverseLookUp(i,function(e){A.cancel(a),t.isPresent()&&(e?(t.setPeerUser(n,e.displayName,e.userId,i),o?o():te(t)):o&&o())})}else o&&o()}function ue(e,t){var n,i=!e.participantType||e.participantType===ht.RTCParticipantType.USER||e.participantType===ht.RTCParticipantType.MEETING_POINT;if(e.userId===g.localUser.userId?n=g.localUser:i&&(n=T.getUserFromCache(e.userId)),!n){e.userDisplayName=e.userDisplayName||e.phoneNumber||g.i18n.map.res_Unknown;var r=e.userDisplayName.split(" ");e.participantType===ht.RTCParticipantType.MEETING_POINT?(e.lastName=r[0],e.location=r.splice(1).join(" ").trim().slice(1,-1)):(e.firstName=r[0],e.lastName=r.splice(1).join(" ")),i?(n=l.extend({userId:e.userId,firstName:e.firstName,lastName:e.lastName,displayName:e.userDisplayName,location:e.location,userType:e.participantType===ht.RTCParticipantType.MEETING_POINT?ht.UserType.MEETING_POINT:ht.UserType.REGULAR}),e.isSimulated?n.isSimulated=!0:(n.noData=!0,T.addUsersToCache(n,!0,!1))):(e.participantType===ht.RTCParticipantType.SESSION_GUEST&&(e.userType=ht.UserType.SESSION_GUEST),n=l.extend(e))}var o=Mt.createFromUser(n,Dt.ParticipantState.Active);return o.apiDisplayName=e.userDisplayName||e.phoneNumber,o.streamId=e.videoStreamId||"",o.screenStreamId=e.screenStreamId||"",o.mediaType=yt.getMediaType(e.mediaTypes||t),o.muted=e.muted||!o.mediaType.audio,o.participantType=e.participantType||ht.RTCParticipantType.USER,o.screenSharePointerSupported=!!e.screenSharePointerSupported,o.isModerator=!!e.isModerator,o.isMeetingGuest=e.isMeetingGuest,o.rtcSupportedFeatures=e.rtcSupportedFeatures||[],o.flags=e.flags||[],o.videoPointerTo=e.videoPointerTo,o}function Ee(e,t){if(t&&t.length){var n=L[e];n?n.turnServers=t:L[e]={turnServers:t}}}function Ce(e){switch(e){case ht.ReturnCode.DISCONNECTED:return Dt.CallClientTerminatedReason.DISCONNECTED;case ht.ReturnCode.FAILED_TO_SEND:return Dt.CallClientTerminatedReason.FAILED_TO_SEND;case ht.ReturnCode.REQUEST_TIMEOUT:return Dt.CallClientTerminatedReason.REQUEST_TIMEOUT;default:return Dt.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED}}function Te(e,t){e&&(m.debug("[CircuitCallControlSvc]: New call has been terminated during call setup. Call Id:",e.callId),e.callState!==Dt.CallState.Terminated&&ie(e,Dt.CallClientTerminatedReason.USER_ENDED),t&&t("Call already terminated"))}function pe(e,t,n,i){if(!Ct(e,n,i))return!1;v&&(_=v);var r={clientId:D.clientId,isSessionGuest:g.isSessionGuest,midMappingEnabled:qe(),isSTC:g.localUser.isSTC&&e.isTelephonyConv,stcCapabilities:e.isTelephonyConv?g.localUser.stcCapabilities:[],canReceiveHdVideo:g.localUser.canUseHDVideo||g.localUser.canUseHDScreenShare};n.replaces&&t.desktop&&(r.reuseDesktopStreamFrom=n.replaces.sessionCtrl),(v=new Pt(e,r)).setState(Dt.CallState.Initiated),v.pickUpFromUser=n.pickUpFromUser,v.pickUpUserId=n.pickUpUserId,J(v);var o=e.call;if(o&&o.isRemote&&!o.isAtcRemote&&(m.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),n.handover&&(v.activeClient=o.activeClient,o.isTelephonyCall&&(o.atcCallInfo&&(v.atcCallInfo=o.atcCallInfo,v.atcCallInfo.setPosition(Dt.Targets.WebRTC)),de(v,o.peerUser.phoneNumber,null,o.peerUser.displayName),v.participants=o.participants),e.call=v),v.hadRemoteCall=!0,o.isTelephonyCall||ie(o)),v.setCallIdForTelephony(n.callId),v.setTransactionId(),(U||e.isTelephonyConv)&&(m.info("[CircuitCallControlSvc] Disabling remote video for outgoing call"),v.disableRemoteVideo()),v.direction=Dt.CallDirection.OUTGOING,v.mediaType=t,n.replaces){v.replaces=n.replaces;var a=n.replaces.sessionCtrl.getLocalStream(wt.LOCAL_STREAMS.DESKTOP);a&&(m.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",n.replaces.callId),v.sessionCtrl.setLocalStream(wt.LOCAL_STREAMS.DESKTOP,a),n.replaces.sessionCtrl.setLocalStream(wt.LOCAL_STREAMS.DESKTOP,null)),(a=n.replaces.sessionCtrl.getLocalStream(wt.LOCAL_STREAMS.AUDIO_VIDEO))&&(m.debug("[CircuitCallControlSvc] Reusing audio/video stream from call ID=",n.replaces.callId),v.sessionCtrl.setLocalStream(wt.LOCAL_STREAMS.AUDIO_VIDEO,a),n.replaces.sessionCtrl.setLocalStream(wt.LOCAL_STREAMS.AUDIO_VIDEO,null))}if(n.joiningGroupCall&&(v.isJoiningGroupCall=!0),n.callOut&&(v.setPeerUsersAsParticipants(),v.isCallOut=!0),v.isTelephonyCall)if(n.handover){var s=be(v.callId);s&&(v.atcCallInfo=s.atcCallInfo,s.isAtcConferenceCall()||de(v,s.peerUser.phoneNumber,null,s.peerUser.displayName),ie(s)),v.handover=!0}else de(v,n.dialedDn,null,n.toName,n.userId),n.dtmfDigits&&(v.dtmfDigits=n.dtmfDigits);return te(v),e.call&&e.call.isRemote&&n.handover||v.conferenceCall||(m.debug("[CircuitCallControlSvc]: Publish /call/outgoing event"),h.publish("/call/outgoing",[v])),v.isNewSession=!e.call||e.call!==v&&!n.handover,e.call=v,ee(e),!0}function Se(e,t){var n=qe()?[ht.RtcSupportedFeatures.MID_STREAM_MAPPING]:[];return e.isDirect&&n.push(ht.RtcSupportedFeatures.UPGRADE_TO_CONFERENCE),$(e)&&!Bt.isMobile()&&(t&&t.mediaType&&t.mediaType.desktop?t.screenShareOptions&&t.screenShareOptions.screenControlSupported&&n.push(ht.RtcSupportedFeatures.SCREEN_CONTROL):g.localUser.canStartScreenControl&&n.push(ht.RtcSupportedFeatures.SCREEN_CONTROLLER)),Ke(e)&&n.push(ht.RtcSupportedFeatures.SCREEN_SHARE_AND_ACTIVE_SPEAKER_VIDEO),e.isDirect&&e.checkState(Dt.CallState.Initiated)&&n.push(ht.RtcSupportedFeatures.CALL_PICKUP),n}function Ie(n,i,r,o){if(!v)return o(Q()),void m.error("[CircuitCallControlSvc]: joinSession failed because there's no local call");o=o||function(){},m.debug("[CircuitCallControlSvc]: joinSession - rtcSessionId=",r.callId||n.rtcSessionId);function a(e){if(d.onSessionDescription=null,d.onClosed=null,v===l){v.mediaType=d.getMediaConstraints();var t={convId:n.convId,rtcSessionId:v.callId||n.rtcSessionId,ownerId:n.creatorId,sdp:e.sdp,mediaType:v.mediaType,callOut:r.callOut,handover:r.handover,sendInviteCancel:!r.callOut,replaces:r.replaces&&r.replaces.callId,isTelephonyConversation:v.isTelephonyCall,displayName:g.localUser.displayName,transactionId:v.transactionId,screenSharePointerSupported:!(!v.pointer||!v.pointer.isEnabled),rtcSupportedFeatures:Se(v),pickUpSession:r.pickUpSession};v.isTelephonyCall&&(t.fromDn=Bt.cleanPhoneNumber(g.localUser.callerId),t.fromName=g.localUser.displayName,t.fromUserId=g.localUser.userId,t.dialedDn=Bt.cleanPhoneNumber(r.dialedDn),t.toName=r.toName,t.toUserId=r.userId,t.noCallLog=g.localUser.noCallLog),n.isTemporary&&n.guestToken&&(t.guestToken=n.guestToken),g.localUser.hasTelephonyRole&&(t.fromName="Gru",t.fromDn="+19998455246");var i=u.createActionInfo(v,ht.RtcDiagnosticsAction.JOIN);i&&(i.data=JSON.stringify(t.sdp)),D.joinRtcCall(t,function(n){g.$apply(function(){if(u.finishActionInfo(v,i),v===l)if(n){var e=v.replaces,t=Ce(n);v.hadRemoteCall?f.endCallWithCauseCode(v.callId,t):ie(v,t),e&&(v=e),o(Q(n))}else m.debug("[CircuitCallControlSvc]: Join RTC session call was successful"),v.conferenceCall&&(m.debug("[CircuitCallControlSvc]: Publish /conference/participant/joining event"),h.publish("/conference/participant/joining",[v])),o(null,r.warning,v);else Te(l,o)})})}else Te(l,o)}function s(e){if(v===l){var t=Ce(e);if(m.warn("[CircuitCallControlSvc]: Failed to initiate call. ",e),r.handover)ie(v,t);else if(v.setDisconnectCause(ht.DisconnectCause.CALL_SETUP_FAILED,e),v.hadRemoteCall)f.endCallWithCauseCode(v.callId,t);else{var n=v.isDirect?"terminateRtcCall":"leaveRtcCall";D[n](v.callId,v.disconnectCause,function(e){e&&m.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",e)}),ie(v,t)}o(Q(e))}else Te(l,o)}function c(){d.onClosed=null,d.onSessionDescription=null,l&&l.state===Dt.CallState.Initiated&&l.terminateReason===Dt.CallClientTerminatedReason.USER_ENDED?o&&o():o&&o(Q())}var l=v,d=v.sessionCtrl;(v.isNewSession?function(t,l,n){return new N(function(a,s){var e={convId:t.convId,rtcSessionId:l.callId,ownerId:t.creatorId,mediaNode:l.getMediaNode(),isTelephonyConversation:t.isTelephonyConv,replaces:n.replaces&&n.replaces.callId,desiredRegion:n.desiredRegion};u.startDiagnostics(l),l.isDirect||u.startJoinDelayTimer(l);var c=u.createActionInfo(l,ht.RtcDiagnosticsAction.PREPARE);D.prepareSession(e,function(i,r,o){g.$apply(function(){if(c&&(c.data=i?i.toString():JSON.stringify(r),u.finishActionInfo(l,c)),i)return i===ht.ErrorCode.RTC_CONCURRENT_INCOMING_CALL?m.debug("[CircuitCallControlSvc]: Concurrent incoming call, aborting own attempt."):i===ht.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE?m.error("[CircuitCallControlSvc]: No media nodes available, call not possible."):i===ht.ErrorCode.RTC_MEDIA_NODE_UNREACHABLE?m.error("[CircuitCallControlSvc]: Specified media node is not reachable, call not possible."):m.error("[CircuitCallControlSvc]: Error retrieving start session data. ",i),void s(i);if(!r||!r.length)return m.error("[CircuitCallControlSvc]: Error getting TURN credentials. No server(s) available."),void s("No TURN server(s) available");if(m.info("[CircuitCallControlSvc]: Received new TURN credentials"),r=r[0],V=r,K(),l.isTelephonyCall&&o&&o!==l.callId){var e=Y(l.convId);if(e&&(Bt.isMobile()||vt.isSDK)){l.setCallIdForTelephony(o);var t=new Pt(e,{clientId:l.clientId});(e.call=t).terminate(),m.debug("[CircuitCallControlSvc]: Publish /call/ended event"),h.publish("/call/ended",[t,!0]),e.call=l,ee(e),m.debug("[CircuitCallControlSvc]: Publish /call/moved event"),h.publish("/call/moved",[t.callId,l.callId]),te(l)}else{var n=l.callId;l.setCallIdForTelephony(o),te(l,n)}}a(V)})})})}(n,v,r):j(v)).then(function(e){e&&(Ee(n.rtcSessionId,e.turnServer),d.setTurnUris(e.turnServer),d.setTurnCredentials(e)),function t(){q(i),d.warmup(i,null,function(){v===l?g.$apply(function(){m.debug("[CircuitCallControlSvc]: The connection warmup was successful. Start the call."),d.onSessionDescription=a,d.onClosed=c,ze(v),d.start(i,null)}):Te(l,o)},function(e){if(i.audio&&(i.video||i.hdVideo))return m.info("[CircuitCallControlSvc]: Fetching audio and video media failed, trying again without video"),i.video=!1,i.hdVideo=!1,void t();g.$apply(s.bind(null,e))},r.screenShareOptions)}()}).catch(s)}function Ae(e){Ne(e,function(e){e?m.error("[CircuitCallControlSvc]: Failed to stop the screen control. ",e):m.debug("[CircuitCallControlSvc]: Successfully stopped screen control")})}function Re(n,t){m.info("[CircuitCallControlSvc]: changeMediaType - data: ",n);var i=re(n.callId);if(!i)return m.warn("[CircuitCallControlSvc]: changeMediaType - Cannot find local call"),void t("No active call");if(!i.isEstablished())return m.info("[CircuitCallControlSvc]: changeMediaType - The local call is not established"),void t("Call not established");var r=i.sessionCtrl;if(r.isConnStable()){var o=function(e){n.dontReuseAudioStream&&(r.dontReuseAudioStream=!1),h.publish("/call/changeMediaType/completed",[i,e]),t(e)};h.publish("/call/changeMediaType/started",[i,n]),r.dontReuseAudioStream=n.dontReuseAudioStream;var a=function(e){r.onSessionDescription=null,i.setTransactionId(n.transactionId);var t={rtcSessionId:i.callId,sdp:e.sdp,mediaType:n.mediaType,transactionId:i.transactionId,screenSharePointerSupported:!(!i.pointer||!i.pointer.isEnabled),hosted:n.hosted,replaces:n.replaces,rtcSupportedFeatures:Se(i,n),videoPointerTo:void 0===n.videoPointerTo?i.videoPointerTo:n.videoPointerTo};D.changeMediaType(t,function(e){g.$apply(function(){i.clearTransactionId(),e?(r.renegotiationFailed(e),o(e)):m.debug("[CircuitCallControlSvc]: changeMediaType was successful. Wait for SDP_ANSWER event")})})},s=i.localMediaType.desktop;j(i).then(function(e){if(r.setTurnUris(e.turnServer),r.setTurnCredentials(e),r.onSessionDescription=a,"boolean"==typeof n.hold){(n.hold?r.holdCall:r.retrieveCall)(function(e){e?(m.error("[CircuitCallControlSvc]: Error in hold/retrieve media"),r.onSessionDescription=null,r.renegotiationFailed(e),o("Error in hold/retrieve media")):o()})}else{i.lastMediaType=i.mediaType;var t={changeDesktopMedia:n.changeDesktopMedia,screenShareOptions:n.screenShareOptions,videoOptions:n.videoOptions,isDirectUpgradingToConf:!!(i.isDirect&&n.hosted&&n.replaces)};q(n.mediaType),r.changeMediaType(n.mediaType,t,function(t){g.$apply(function(){if(t)m.warn("[CircuitCallControlSvc]: changeMediaType failed - reason: ",t),r.onSessionDescription=null,r.renegotiationFailed(t),s&&!i.localMediaType.desktop&&r.updateScreenControlData(!1,!1),o(t||"Error changing media");else{var e=i.screenOwnerId===g.localUser.userId;s&&!i.localMediaType.desktop?(m.debug("[CircuitCallControlSvc]: Publish /screenshare/ended event"),h.publish("/screenshare/ended"),i.pointer.isSupported=i.pointer.isEnabled=!1,e&&Ae(i.callId)):!e||!n.screenShareOptions||n.screenShareOptions.screenIndex===x&&n.screenShareOptions.screenControlSupported||Ae(i.callId),x=n.screenShareOptions&&n.screenShareOptions.screenIndex||null,o()}})})}}).catch(function(e){o(Q(e))})}else t("Connection not stable")}function fe(t,n,i){i=i||function(){};var r=re(t);if(!r)return m.warn("[CircuitCallControlSvc]: offerScreenControl - There is no local call"),void i("No active call");if(!n)return m.warn("[CircuitCallControlSvc]: offerScreenControl - controllerId was not provided"),void i("Controller not specified");function o(e){m.warn("[CircuitCallControlSvc]: offerScreenControl - Failed to offer screen control. ",e),f.rejectScreenControlRequest(t,n),i(e)}if(r.isEstablished())if(r.hasLocalScreenShare()&&$(r)){var a=r.sessionCtrl;if(a.isConnStable()){a.onSessionDescription=function(e){if(a.onSessionDescription=null,e.sdp&&e.sdp.sdp&&e.sdp.sdp.includes("webrtc-datachannel")){r.screenOwnerId=g.localUser.userId,r.screenControllerId=n;var t={rtcSessionId:r.callId,sdp:e.sdp,controllerId:r.screenControllerId};D.offerScreenControl(t,function(e){g.$apply(function(){e?(m.debug("[CircuitCallControlSvc]: Failed to offer screen control. ",e),i(e)):(m.debug("[CircuitCallControlSvc]: offerScreenControl was successful. Wait for the SCREEN_CONTROL_ACCEPTED event."),i())})})}else r.screenOwnerId=null,r.screenControllerId=null,o("Failed to create data channel")},j(r).then(function(e){a.setTurnUris(e.turnServer),a.setTurnCredentials(e),a.updateScreenControlData(!0,!0),a.offerScreenControl(function(e){e&&g.$apply(function(){m.warn("[CircuitCallControlSvc]: offerScreenControl failed - reason: ",e),a.onSessionDescription=null,a.updateScreenControlData(!1,!1),o(e)})})}).catch(o)}else o("Connection not stable")}else o("Screen control not possible");else o("Call not established")}function ve(e,t){var n=f.getActiveCall();n&&n.callId===e&&n.sessionCtrl.adaptScreenShareForRemoteControl(t)}function _e(t,e,n,i){t.screenOwnerId=e,t.screenControllerId=n;var r=t.screenOwnerId===g.localUser.userId,o=r||t.screenControllerId===g.localUser.userId;t.screenOwner=null,t.screenController=null,r||n&&n!==g.localUser.userId?t.screenController=t.participants.find(function(e){return e.userId===t.screenControllerId}):o&&(t.screenOwner=t.participants.find(function(e){return e.userId===t.screenOwnerId})),g.remoteControlActive=o,t.remoteControlActive=o,e||n||(t.preventScreenControlRequestInConf=!1),t.sessionCtrl.updateScreenControlData(o,r),i&&(m.debug("[CircuitCallControlSvc]: Publish /screenControl/updated event"),h.publish("/screenControl/updated",[t])),r?ve(t.callId,!0):o||ve(t.callId,!1)}function ge(t,n){try{var i=re(t.sessionId);if(!i)return void m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!i.isEstablished())return void m.info("[CircuitCallControlSvc]: The local call is not established");if(t.clientID&&D.clientId!==t.clientID)return void m.debug("[CircuitCallControlSvc]: Event is not for this client: ",D.clientId);g.$apply(function(){if(t.sdp){var e=t.sdp.type,n=i.sessionCtrl;if("offer"===e){_e(i,t.ownerId,g.localUser.userId,!1);n.onSessionDescription=function(e){n.onSessionDescription=null;var t={rtcSessionId:i.callId,sdp:e.sdp,ownerId:i.screenOwnerId};D.acceptScreenControl(t,function(t){g.$apply(function(){if(t)m.error("[CircuitCallControlSvc]: acceptScreenControl failed. ",t),_e(i,null,null,!0);else{m.debug("[CircuitCallControlSvc]: acceptScreenControl was successful");var e=i.participants.find(function(e){return e.userId===i.screenOwnerId});m.debug("[CircuitCallControlSvc]: Publish /screenControl/accepted event"),h.publish("/screenControl/accepted",[i,e])}})})}}else _e(i,g.localUser.userId,i.screenControllerId,!1);j(i).then(function(e){n.setTurnUris(e.turnServer),n.setTurnCredentials(e),n.establishScreenControl(t.sdp,function(e){e?g.$apply(function(){m.warn("[CircuitCallControlSvc]: Screen control event could not be processed - reason: ",e),n.onSessionDescription=null}):m.debug("[CircuitCallControlSvc]: Screen control event was successfully processed.")})}).catch(function(e){m.error("[CircuitCallControlSvc]: getTurnCredentials error: ",e)})}else!function(t){D.rejectScreenControl({rtcSessionId:t.callId},function(e){g.$apply(function(){e?m.error("[CircuitCallControlSvc]: rejectScreenControl sending error"):(m.debug("[CircuitCallControlSvc]: rejectScreenControl was successful."),_e(t,null,null,!0))})})}(i)})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling "+n+" event. ",e)}}function Ne(e,t,n){t=t||function(){};var i=re(e);if(!i)return m.warn("[CircuitCallControlSvc]: stopScreenControl - There is no local call"),void t("No active call");if(!i.isEstablished())return m.info("[CircuitCallControlSvc]: stopScreenControl - The local call is not established"),void t("Call not established");var r=i.sessionCtrl;r&&r.stopScreenControl(function(e){e?g.$apply(function(){m.warn("[CircuitCallControlSvc]: stopScreenControl failed - reason: ",e),r.onSessionDescription=null,t(e)}):(_e(i,null,null,!0),n||D.stopScreenControl({rtcSessionId:i.callId},function(e){g.$apply(function(){e?t(e):(m.debug("[CircuitCallControlSvc]: stopScreenControl was successful."),t())})}))})}function me(e,t,n,i,r){if(!e)return null;if(e.isTemporary&&!t&&!e.guestToken)return m.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),h.publish("/conversation/temporary/ended",[e]),null;var o=new Ut(e);return o.setState(t?Dt.CallState.ActiveRemote:Dt.CallState.Started),n&&(n.instanceId&&o.setInstanceId(n.instanceId),o.screenOwnerId=n.screenOwnerId,o.screenControllerId=n.screenControllerId,n.hosted&&o.setDirectUpgradedToConf()),i&&o.setCallIdForTelephony(i),J(o),t&&(o.setActiveClient(t),Le(o),n&&(1===n.participants.length&&n.callOut&&(o.pullNotAllowed=!0),o.mediaType=yt.getMediaType(n.mediaTypes))),"function"==typeof r&&r(o),e.call=o,ee(e),te(o),o}function he(n){if(n.isGuestInvite){Z(n);var e=Y(n.convId);e&&e.isTemporary&&(m.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),h.publish("/conversation/temporary/ended",[e]))}else n.setState(Dt.CallState.Started),n.activeClient=null,te(n),P.some(function(e,t){return e.callId===n.callId&&(P.splice(t,1),!0)})}function Oe(e){D.declineRtcCall({convId:e.convId,rtcSessionId:e.sessionId,cause:ht.InviteRejectCause.BUSY,transactionId:e.transactionId})}function De(e,t,n){var i=new Pt(e,{clientId:D.clientId,midMappingEnabled:qe()});i.setInstanceId(t.instanceId),i.setTransactionId(t.transactionId),i.setState(Dt.CallState.Ringing),t.from&&de(i,t.from.phoneNumber,t.from.fullyQualifiedNumber,t.from.displayName,null,function(){m.debug("atccall/firstcall"),h.publish(n?"/atccall/firstcall":"/atccall/secondcall",[i])})}function Pe(e,t,n,i){if(i=i||function(){},Z(e=e||v),!e||e.state!==Dt.CallState.Ringing&&e.state!==Dt.CallState.Answering)return m.debug("[CircuitCallControlSvc]: call invalid to be declined"),void i("Call Invalid");m.debug("[CircuitCallControlSvc]: decline - rtcSessionId: ",e.callId);var r={convId:e.convId,rtcSessionId:e.callId,cause:t.type,transactionId:e.transactionId},o=[e];t.err&&o.push(t.err),D.declineRtcCall(r,function(e){g.$apply(function(){e?(m.warn("[CircuitCallControlSvc]: Error declining the RTC call. ",e),i(e)):i()})}),e.isDirect||me(Y(e.convId));m.debug("[CircuitCallControlSvc]: Publish /call/declining event"),h.publish("/call/declining",o),ie(e,t.type,n)}function ye(e,t,n,i,r){if(!(e=e||v))return m.debug("[CircuitCallControlSvc]: There is no local call"),void(r&&A(r));if(e.terminateTimer)return m.debug("[CircuitCallControlSvc]: Local call is already being terminated. Ignore leave request."),void(r&&A(r));if(r=r||function(){},e.checkState([Dt.CallState.Ringing,Dt.CallState.Answering]))Pe(e,{type:t||ht.InviteRejectCause.DECLINE},!1,r);else{var o;if(m.debug("[CircuitCallControlSvc]: leaveCall - rtcSessionId=",e.callId),e.clearAtcHandoverInProgress(),e.activeClient)return me(o=Y(e.convId),e.activeClient,null,null,function(e){v.isTelephonyCall&&(e.atcCallInfo=v.atcCallInfo,e.peerUser=v.peerUser)}),void ie(e,n);if(e.isDirect)D.terminateRtcCall(e.callId,e.disconnectCause,function(e){g.$apply(function(){e&&m.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",e),r&&r(e)})},e.pickUpUserId||e.pickUpFromUser&&e.pickUpFromUser.userId);else{if(!e.isTestCall&&(o=Y(e.convId))&&(e.participants.length||o.isTemporary||e.hadRemoteCall)){var a=me(o);e.isDirectUpgradedToConf&&a.setDirectUpgradedToConf()}g.localUser.userId===e.screenOwnerId&&Ae(e.callId),D.leaveRtcCall(e.callId,e.disconnectCause,function(e){g.$apply(function(){e&&m.warn("[CircuitCallControlSvc]: Error leaving the RTC call. ",e),r&&r(e)})})}n===Dt.CallClientTerminatedReason.PAGE_UNLOADED&&(e.terminateReason=n,e.qosSubmitted=!0,s.sendQOSData(e,e.mediaType,e.sessionCtrl.getLastSavedStats())),i||(e.directCall?(m.debug("[CircuitCallControlSvc]: Publish /call/terminating event"),h.publish("/call/terminating",[v])):e.conferenceCall?(m.debug("[CircuitCallControlSvc]: Publish /conference/leaving event"),h.publish("/conference/leaving",[e])):(m.debug("[CircuitCallControlSvc]: Publish /group/leaving event"),h.publish("/group/leaving",[e]))),e.outgoingFailed()?(e.terminateTimer=A(function(){e.terminateTimer=null,ie(e,n)},d),e.terminateReason=n):ie(e,n)}}function be(t){return P.find(function(e){return e.callId===t})||null}function Ue(t){return M.find(function(e){return e.callId===t})||null}function Le(n){P.some(function(e,t){return e===n||e.callId===n.callId&&(P[t]=n,!0)})||P.push(n)}function Me(t,n){n.streamId&&(t.isMocked||t.participants.forEach(function(e){e.streamId===n.streamId&&e.userId!==n.userId&&(e.streamId="",m.debug("[CircuitCallControlSvc]: The video stream has been re-assigned. Clear the streamId for previous participant. [userId, streamId] = ",[e.userId,n.streamId]),v.setParticipantRemoteVideoStream(e),m.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",e.userId),h.publish("/call/participant/updated",[t.callId,e]))}))}function we(e,t){var n=Y(e.convId);g.isSessionGuest||t.setActions(n,g.localUser)}function Ge(e,t){var n=0;t&&t.flags&&(t.flags.includes(ht.RTCSessionParticipantFlag.CPU_LOAD)?n=2:t.flags.includes(ht.RTCSessionParticipantFlag.CPU_LOAD_TRANSCODE)&&(n=1)),n>(e.vrsOverloadLevel||0)&&(e.vrsOverloadLevel=n,m.debug("[CircuitCallControlSvc]: Publish /call/vrsOverloadLevelChanged event. userId =",t.userId+", level = "+n),h.publish("/call/vrsOverloadLevelChanged",[e,t]))}function He(n,i,e,t){var r=n.addParticipant(i,e,t);return r&&(Me(n,r),we(n,r),Ge(n,r),i.noData&&!i.reqPending&&(m.debug("[CircuitCallControlSvc]: Get user data for added participant. userId: ",i.userId),T.getUserById(i.userId,function(e,t){t&&(m.debug("[CircuitCallControlSvc]: Successfully retrieved participant data. userId: ",i.userId),n.isPresent()&&n.hasParticipant(i.userId)&&(i.firstName=t.firstName,i.lastName=t.lastName,i.displayName=t.displayName,m.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",i.userId),h.publish("/call/participant/updated",[n.callId,i])))}))),r}function ke(e,t,n){var i=e.updateParticipant(t,n);return i&&(Me(e,i),we(e,i),Ge(e,i)),i}function Ve(e,t,n){var i=Dt.ParticipantState.Terminated;switch(n){case ht.RTCSessionParticipantLeftCause.CONNECTION_LOST:case ht.RTCSessionParticipantLeftCause.STREAM_LOST:i=Dt.ParticipantState.ConnectionLost;break;case ht.RTCSessionParticipantLeftCause.REMOVED:i=Dt.ParticipantState.Removed;break;case ht.RTCSessionParticipantLeftCause.USER_LEFT_STAGE:i=Dt.ParticipantState.OffStage}e.setParticipantState(t,i);var r=e.removeParticipant(t);if(!e.hasOtherParticipants()){if(!e.conferenceCall)return m.debug("[CircuitCallControlSvc]: Publish /group/terminated event"),h.publish("/group/terminated",[e]),void ye(e,null,Dt.CallClientTerminatedReason.NO_USERS_LEFT,!0);e.setState(Dt.CallState.Waiting)}if(r){e.updateMediaType(),!e.isRemote&&r.isCMP&&r.isMeetingPointInvitee&&!X(e.participants)&&(e.setMeetingPointInviteState(!1),f.enableRemoteAudio(e.callId)),e.conferenceCall&&(m.debug("[CircuitCallControlSvc]: Publish /conference/participant/left event"),h.publish("/conference/participant/left",[e,n]));var o=n?{leftCause:n}:null;m.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),h.publish("/call/participant/removed",[e.callId,r,o])}te(e)}function Fe(t,e){t&&e&&e.state&&e.state!==ht.RecordingInfoState.INITIAL&&(e.recordingMediaTypes&&e.recordingMediaTypes.includes(ht.RecordingMediaType.TEXT)&&(t.transcription.state=e.state,m.debug("[CircuitCallControlSvc]: Publish /call/transcription/info event"),h.publish("/call/transcription/info",[t])),e.recordingMediaTypes&&!e.recordingMediaTypes.includes(ht.RealtimeMediaType.AUDIO)&&!e.recordingMediaTypes.includes(ht.RealtimeMediaType.VIDEO)||(function(e,t){e.recordingMediaTypes=t.recordingMediaTypes,e.state!==t.state?(e.notifyByCurtain=t.state===ht.RecordingInfoState.START_PENDING||t.state===ht.RecordingInfoState.STARTED&&e.state===ht.RecordingInfoState.START_PENDING,e.notifyByUser=!e.notifyByCurtain||t.state===ht.RecordingInfoState.START_PENDING&&e.state!==ht.RecordingInfoState.STARTED):(e.notifyByCurtain=!1,e.notifyByUser=!1);e.state=t.state,e.duration=t.duration||e.duration,e.reason=t.reason,e.recordingUserId=null,e.recordingUser=null,t.state===ht.RecordingInfoState.STARTED&&(e.resumeTime=Date.now(),t.layout&&t.layout.layoutMapping&&t.layout.layoutMapping.length&&t.layout.layoutName===ht.RecordingVideoLayoutName.SINGLE_VIDEO&&(e.recordingUserId=t.layout.layoutMapping[0].tileContent));t.starter&&t.starter.userId&&t.starter.userId!==e.starter.userId&&(e.starter=t.starter,e.starter.userId===g.localUser.userId?e.starter.res="res_StartedRecording_You":(e.starter.name=e.starter.displayName,e.starter.res=e.starter.name?"res_StartedRecording_Other":"res_StartedRecording"))}(t.recording,e),t.recording.recordingUserId&&(t.recording.recordingUserId===g.localUser.userId?t.recording.recordingUser=g.localUser:t.participants.some(function(e){return e.userId===t.recording.recordingUserId&&(t.recording.recordingUser=e,!0)})),m.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),h.publish("/call/recording/info",[t])))}function Be(e){v&&void 0!==e&&v.attendeeCount!==e&&(v.attendeeCount=e,v.updateCallState(),m.debug("[CircuitCallControlSvc]: Publish /call/attendeeCountChanged"),h.publish("/call/attendeeCountChanged",[v.callId,v.attendeeCount]))}function xe(i,e){return new N(function(t,n){i&&!i.screenShareEventHandler?i.isVdi?t({}):(i.screenShareEventHandler=Gt.getScreen(function(e){A(function(){i.screenShareEventHandler=null,i.rejectGetScreenPromise=null,t(e||{})},0)},function(e){A(function(){i.screenShareEventHandler=null,i.rejectGetScreenPromise=null,e===ht.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?n(e):n("res_AccessToDesktopFailed")},0)},e),i.rejectGetScreenPromise=function(e){m.warn("[CircuitCallControlSvc]: Cancelling getScreen promise for call ID: ",i.callId),n(e)}):n("res_ErrorMsgInternal")})}function We(r){return new N(function(n,t){function i(){m.debug("[CircuitCallControlSvc]: Terminate ICE candidates collection test"),e.onSessionDescription=null,e.onRtcError=null,e.terminate()}var e=new wt({disableTrickleIce:!0,isDirectCall:!0,candidatesCollectionTest:!0});r&&(e.setTurnUris(r.turnServer),e.setTurnCredentials(r)),e.disableRemoteVideo(),e.onSessionDescription=function(e){var t=vt.sdpParser.getIceCandidates(e.sdp.sdp);m.debug("[CircuitCallControlSvc]: testIceCandidates - candidates: ",t),i(),n({turnServers:r&&r.turnServer||[],candidates:t})},e.onRtcError=function(e){m.error("[CircuitCallControlSvc]: Error collecting candidates. ",e.error),i(),t(e.error)},m.debug("[CircuitCallControlSvc]: testIceCandidates - Start collection"),e.start({audio:!1})})}function Ye(e,t){if(e&&e.replaces){var n=oe(e.replaces.callId);n&&(g.localUser.userId===n.screenOwnerId&&(e.restartScreenControlSession=!0,e.screenControllerId=n.screenControllerId),t&&ye(n,null,Dt.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV)),m.debug("[CircuitCallControlSvc]: Publish /call/moved event"),h.publish("/call/moved",[e.replaces.callId,e.callId]),e.replaces=null,te(e)}}function Ke(e){return!(!g.isCMR&&(e&&e.isDirect||Bt.isMobile()))}function qe(){return xt.unifiedPlanEnabled||"firefox"===xt.browser}function je(e){return!!Wt.includes(e)||(m.error("[CircuitCallControlSvc]: Invalid video resolution: ",e),!1)}function Qe(e){m.debug("[CircuitCallControlSvc]: Publish /call/showRatingDialog event"),h.publish("/call/showRatingDialog",[e])}function Xe(e,t){if(m.debug("[CircuitCallControlSvc]: handleRtcError: ",t.error),"res_RemoteControlSessionStopped"===t.error)return Ae(e.callId),void h.publish("/screenControl/terminated",[e]);(h.publish("/call/rtcError",[e,t.error]),e.checkState([Dt.CallState.Ringing,Dt.CallState.Answering]))?Pe(e,{type:!g.isCMR||"res_AccessToMediaInputDevicesFailed"!==t.error&&"res_AccessToAudioInputDeviceFailed"!==t.error?ht.InviteRejectCause.BUSY:ht.InviteRejectCause.TEMPORARILY_UNAVAILABLE}):e.sameAs(v)&&("res_CallMediaFailed"===t.error?(e.setDisconnectCause(ht.DisconnectCause.NEGOTIATION_FAILED),f.endCallWithCauseCode(e.callId,Dt.CallClientTerminatedReason.ICE_TIMED_OUT)):"res_CallMediaDisconnected"===t.error?(e.setDisconnectCause(ht.DisconnectCause.STREAM_LOST),f.endCallWithCauseCode(e.callId,Dt.CallClientTerminatedReason.LOST_MEDIA_STREAM),D.pingServer()):e.isEstablished()||f.endCall(e.callId))}function ze(e){var t=e&&e.sessionCtrl;t?(t.onIceCandidate=function(t,e){m.debug("[CircuitCallControlSvc]: RtcSessionController - onIceCandidate");var n={rtcSessionId:t.callId,userId:g.localUser.userId,origin:e.origin,candidates:e.candidates.map(JSON.stringify.bind(JSON))};e.isAudioVideo&&(t.sdpOrigin=e.origin);var i=u.createActionInfo(t,ht.RtcDiagnosticsAction.ICE_CANDIDATES);i&&(i.data=n.candidates,i.isEndOfCandidates=e.endOfCandidates);D.sendIceCandidates(n,function(e){u.finishActionInfo(t,i),e&&m.warn("Failed to send ICE candidate: ",e)})}.bind(null,e),t.onSdpConnected=function(t){m.debug("[CircuitCallControlSvc]: RtcSessionController - onSdpConnected"),g.$apply(function(){m.debug("[CircuitCallControlSvc]: Publish /call/sdpConnected event"),h.publish("/call/sdpConnected",[t]);var e=u.createActionInfo(t,ht.RtcDiagnosticsAction.SDP_CONNECTED);u.finishActionInfo(t,e),t.isTelephonyCall?(t.state.established||t.setState(Dt.CallState.Waiting),t.updateCallState()):t.setState(t.isDirect||t.hasOtherParticipants()?Dt.CallState.Active:Dt.CallState.Waiting),te(t),u.finishDeviceDiagnostics(t),u.sendCallConnected(t)})}.bind(null,e),t.onIceConnected=function(e,t){m.debug("[CircuitCallControlSvc]: RtcSessionController - onIceConnected. pcType:",t.pcType),g.$apply(function(){"audio/video"===t.pcType?(e.isEstablished()&&e.disconnectCause&&e.disconnectCause.cause===ht.DisconnectCause.STREAM_LOST&&(e.disconnectCause=null),ne(e,"connected")):"screen control"===t.pcType&&_e(e,e.screenOwnerId,e.screenControllerId,!0)})}.bind(null,e),t.onIceDisconnected=function(e,t){m.debug("[CircuitCallControlSvc]: RtcSessionController - onIceDisconnected. pcType:",t.pcType),g.$apply(function(){"audio/video"===t.pcType&&e.isEstablished()&&!e.isHeld()?(e.setDisconnectCause(ht.DisconnectCause.STREAM_LOST),ne(e,"disconnected")):"screen control"===t.pcType&&(Ne(e.callId),_e(e,null,null,!0))})}.bind(null,e),t.onRemoteVideoAdded=function(){m.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoAdded")}.bind(null,e),t.onRemoteVideoRemoved=function(){m.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoRemoved")}.bind(null,e),t.onRemoteStreamUpdated=function(e){m.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteStreamUpdated"),g.$apply(function(){m.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),h.publish("/call/remoteStreamUpdated",[e])})}.bind(null,e),t.onDTMFToneChange=function(e,t){m.debug("[CircuitCallControlSvc]: RtcSessionController - onDTMFToneChange"),g.$apply(function(){t.tone?(m.debug("[CircuitCallControlSvc]: Sent DTMF Digit"),h.publish("/call/singleDigitSent",[e,t.tone])):""===t.tone&&(m.info("[CircuitCallControlSvc]: Digits played completely"),h.publish("/call/digitsSent",[e]))})}.bind(null,e),t.onRtcError=function(e,t){g.$apply(function(){Xe(e,t)})}.bind(null,e),t.onRtcWarning=function(e,t){m.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcWarning"),g.$apply(function(){h.publish("/call/rtcWarning",[e,t.warning])})}.bind(null,e),t.onLocalStreamEnded=function(t,e){m.debug("[CircuitCallControlSvc]: RtcSessionController - onStreamEnded"),e.isDesktop&&v.hasLocalScreenShare()?(m.debug("[CircuitCallControlSvc]: Screenshare stream ended, remove screenshare or terminate the call"),v.isEstablished()?f.removeScreenShare(v.callId):f.endCall(v.callId)):f.renegotiateMedia(t.callId,function(e){e&&g.$apply(function(){m.debug("[CircuitCallControlSvc]: Publish /call/localStreamEnded event"),h.publish("/call/localStreamEnded",[t])})})}.bind(null,e),t.onQosAvailable=function(e,t){m.debug("[CircuitCallControlSvc]: RtcSessionController - onQosAvailable"),t.renegotiationInProgress&&(e.terminateReason=Dt.CallClientTerminatedReason.MEDIA_RENEGOTIATION);if(e.sessionCtrl){if(e.qosSubmitted)return void m.info("[CircuitCallControlSvc]: QoS already submitted for call Id:",e.callId);s.sendQOSData(e,e.lastMediaType,t.qos,t.lastSavedStats,t.streamQualityData)}t.renegotiationInProgress&&(e.terminateReason=null,e.updateMediaDevices())}.bind(null,e),t.onStatsThresholdExceeded=function(e,t){n||(m.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsThresholdExceeded. Cleared: ",!(!t||!t.cleared)),g.$apply(function(){t&&t.cleared?h.publish("/call/rtp/threshholdExceeded/cleared",[e.callId]):h.publish("/call/rtp/threshholdExceeded/detected",[e.callId])}))}.bind(null,e),t.onStatsNoOutgoingPackets=function(e){m.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsNoOutgoingPackets. Publish /call/rtp/noOutgoingPackets event"),g.$apply(function(){h.publish("/call/rtp/noOutgoingPackets",[e.callId])})}.bind(null,e),t.onNetworkQuality=function(n,i){if(!i||!i.quality)return;g.$apply(function(){var e=null;if(xt.unifiedPlanEnabled)e=i.quality.level,n.networkQuality=e,m.debug("[CircuitCallControlSvc]: Publish /call/network/quality event for quality=",e);else{var t=i.quality;e={userId:g.localUser.userId,audio:{qualityLevel:t.qualityLevel.value,currentPlSend:t.currentPlSend,currentPlReceive:t.currentPlReceive,firstTimeLowQuality:t.firstTimeLowQuality}},m.debug("[CircuitCallControlSvc]: Publish legacy /call/network/quality event for quality=",e.audio.qualityLevel)}h.publish("/call/network/quality",[n.callId,e])})}.bind(null,e),t.onGetUserMediaException=function(e,t){m.debug("[CircuitCallControlSvc]: RtcSessionController - onGetUserMediaException. Publish /call/getUserMediaException event"),g.$apply(function(){h.publish("/call/getUserMediaException",[e,t.info])})}.bind(null,e)):m.error("[CircuitCallControlSvc]: Failed to get RtcSessionController for given call. ",e)}function Je(e){try{m.debug("[CircuitCallControlSvc]: Received RTCSession.ACTIVE_SPEAKER");var t=re(e.sessionId);if(!t)return void m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(t.isDirect||t.participants.length<2)return void m.debug("[CircuitCallControlSvc]: Ignore RTC.ACTIVE_SPEAKER event for 1-2-1 calls");var n=[];if(e.first&&n.push(e.first),e.second&&n.push(e.second),e.third&&n.push(e.third),!t.setActiveSpeakers(n))return;m.debug("[CircuitCallControlSvc]: Publish /call/participants/activeSpeakers event"),h.publish("/call/participants/activeSpeakers",[t.callId,n])}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTC.ACTIVE_SPEAKER event. ",e)}}function $e(t){if(m.debug("[CircuitCallControlSvc]: Processing active session for convId = ",t.convId),t.participants&&0!==t.participants.length){var e=O.getConversationByRtcSession(t.rtcSessionId);if(e&&(e.hasJoined||e.isTemporary)&&(t.turnServers&&Ee(t.rtcSessionId,t.turnServers),!Ue(t.rtcSessionId))){var n,i=!1;if(t.participants.some(function(e){return e.userId===g.localUser.userId&&((n=e).clientId===D.clientId&&(i=!0),!0)}),e.call){var r=e.call;return r.isRemote&&e.isTemporary&&n?(e.call.setState(Dt.CallState.ActiveRemote),r.setActiveClient(n),Le(r),void(r.mediaType=yt.getMediaType(t.mediaTypes))):void m.debug("[CircuitCallControlSvc]: Conversation already has an associated call")}if(e.type!==ht.ConversationType.DIRECT||t.hosted||n){if(i){var o=function(e){e&&m.warn("[CircuitCallControlSvc] Lost session could not be terminated. Session Id=",t.rtcSessionId)},a={disconnectCause:ht.DisconnectCause.CONNECTION_LOST,disconnectReason:ht.DisconnectReason.CALL_LOST};if(e.type===ht.ConversationType.DIRECT)return void D.terminateRtcCall(t.rtcSessionId,a,o);D.leaveRtcCall(t.rtcSessionId,a,o)}me(e,n,t,t.rtcSessionId,function(e){n&&Ze(e,t)})}}}else m.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",t.rtcSessionId)}function Ze(t,e){t&&t.isTelephonyCall&&e&&e.participants&&e.participants.length<=2&&e.participants.some(function(e){return e.participantType===ht.RTCParticipantType.TELEPHONY&&(de(t,e.phoneNumber,null,e.userDisplayName),!0)})}function et(e){var t=!1;return re(e.rtcSessionId)&&e.participants&&(t=e.participants.some(function(e){return e.userId===g.localUser.userId&&e.clientId===D.clientId})),t}function tt(){return D.injectHasActiveCall(f.hasActiveCall),new N(function(s,c){G||g.isSessionGuest?(m.debug("[CircuitCallControlSvc]: Initialize active RTC sessions"),D.getActiveSessions(function(t,n){g.$apply(function(){t&&m.error("[CircuitCallControlSvc]: Error getting active sessions: ",t),n=n||[],Bt.emptyArray(P);for(var e=I.length-1;0<=e;e--)I[e].isRemote&&(I[e].guestToken?P.push(I[e]):ie(I[e]));var i=null,r=!1,o=!1,a=[];n.forEach(function(t){var n=re(t.rtcSessionId);if(n){if(et(t))return r=r||n===v,o=o||n===_,m.info("[CircuitCallControlSvc]: Found localCall in active sessions. Trigger media renegotiation."),void f.renegotiateMedia(n.callId,function(e){n.screenOwnerId===g.localUser.userId&&(e||t.screenOwnerId!==g.localUser.userId?(m.debug("[CircuitCallControlSvc]: There was a renegotiation error or remote control has been terminated on backend"),Ae(n.callId)):(m.debug("[CircuitCallControlSvc]: Starting a screen control session."),fe(n.callId,t.screenControllerId,function(e){e?m.error("[CircuitCallControlSvc]: Could not start the screen control session"):m.debug("[CircuitCallControlSvc]: Successfully started the screen control session.")}))),e?_e(n,null,null,!0):_e(n,t.screenOwnerId,t.screenControllerId,!0),h.publish("/call/sessionInitialized",[n])});ie(n,Dt.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}(i=O.getConversationByRtcSession(t.rtcSessionId))&&i.hasJoined?$e(t):t.invitedGuests&&t.invitedGuests.includes(g.localUser.userId)?(m.info("[CircuitCallControlSvc]: Local user is invited as guest to this session"),a.push(O.createConversationAsGuestFromSummary(t.convId))):i||(m.info("[CircuitCallControlSvc]: Conversation associated with session is not cached. Need to get it."),a.push(O.getConversationPromise(t.convId)))}),h.publish("/activeSessions/received"),_&&!o&&ie(_,Dt.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),v&&!r&&ie(v,Dt.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),0<a.length?function(e,i,t){m.info("[CircuitCallControlSvc]: Wait for get conversation promises to be resolved."),N.all(e).then(function(e){var n=e.map(function(e){return e.convId});m.debug("[CircuitCallControlSvc]: Retrieved the missing conversation(s): ",n),m.debug("[CircuitCallControlSvc]: Now that we have all the conversations, check if they still have active RTC sessions."),D.getActiveSessions(function(e,t){g.$apply(function(){e&&(m.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),t=[]),t.forEach(function(e){-1!==n.indexOf(e.convId)&&(et(e)||$e(e))}),i()})})}).catch(function(e){m.error("[CircuitCallControlSvc]: Failed to retrieve the conversation(s). ",e),t(e)})}(a,s,c):s()})})):c("Not ready to initialize active sessions")})}function nt(e,t){var n={rtcSessionId:e,transactionId:t};D.changeMediaReject(n,function(e){e?m.error("[CircuitCallControlSvc]: changeMediaReject sending error"):m.debug("[CircuitCallControlSvc]: changeMediaReject sent")})}function it(e,t,n){if(n||(m.debug("[CircuitCallControlSvc]: Publish /call/incoming event"),h.publish("/call/incoming",[e.call])),p){var i={type:e.call.isGuestInvite&&!e.call.pickupNotification?Dt.NotificationType.INCOMING_INVITATION_AS_GUEST:e.call.mediaType.video?Dt.NotificationType.INCOMING_VIDEO_CALL:Dt.NotificationType.INCOMING_VOICE_CALL,userId:t,extras:{conversation:e,call:e.call}};e.isTelephonyConv&&e.call.peerUser&&(i.userId=e.call.peerUser.userId,i.userId||(i.user=e.call.peerUser),i.extras.phoneNumber=e.call.peerUser.phoneNumber,i.extras.displayName=e.call.peerUser.displayName),p.show(i)}e.call.startRingingTimer(function(){Pe(e.call,{type:ht.InviteRejectCause.TIMEOUT},!1)})}function rt(e,t){if(t&&t.redirectingUser){var n=t.redirectingUser;!function(t,n,i,e,r){t.redirectingUser&&t.redirectingUser.redirectionType||(t.setRedirectingUser(n,i,e,null,r),i&&T.startReverseLookUp(i,function(e){e&&t.isPresent()&&(t.setRedirectingUser(n,i,e.displayName,e.userId,r),te(t))}))}(e,n.phoneNumber,n.fullyQualifiedNumber,n.displayName,bt.CallForward)}}function ot(r,t){if(r&&t){var n=null,e=!1,i=!1,o=!1,a=!1;if(r.replaces&&be(r.replaces))e=!0;else if(v)if(v.callId===r.replaces)i=v.sessionCtrl&&v.sessionCtrl.isMuted(),n=v;else if(v.terminateTimer){if(v.callId===r.sessionId)return m.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not terminated"),void Oe(r);ie(v)}else{if(v.callId===r.sessionId)return void(v.isDirect?(m.debug("[CircuitCallControlSvc]: INVITE for same local call. Reject it"),Oe(r)):m.warn("[CircuitCallControlSvc]: INVITE for same conversation as local call. Ignore it."));if(!v.isEstablished()&&(!r.pickUpSession||r.pickUpSession!==v.callId)&&(!t.isTelephonyConv||le()))return m.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not established"),void Oe(r)}if(t.isTelephonyConv?r.to&&r.to.displayName&&r.to.displayName.startsWith("handover-from")?(m.debug("[CircuitCallControlSvc]: Received handover call"),k?(o=!0,A.cancel(k),k=null):(m.warn("[CircuitCallControlSvc]: INVITE for handover call from another client. Ignore it."),e=!0)):F&&(o=!0,A.cancel(F),F=null):y&&y.callId===r.replaces&&(i=b,n=y,y=null),Ue(r.sessionId))m.warn("[CircuitCallControlSvc]: INVITE for existing ringing call. Ignore it.");else{if(!e&&!r.pickUpSession&&!n&&1<=M.length&&!o&&(!t.isTelephonyConv||le()))return m.debug("[CircuitCallControlSvc]: Reject second incoming call."),void Oe(r);if(t.isTelephonyConv&&!o&&!e){if(g.localUser.selectedRoutingOption===Lt.DeskPhone.name&&g.localUser.isATC)return void De(t,r,!0);if(!g.localUser.selectedBusyHandlingOption||g.localUser.selectedBusyHandlingOption===Nt.DefaultRouting.name||g.localUser.isSTC){if(v&&v.isPresent()&&_&&_.isPresent())return m.debug("[CircuitCallControlSvc]: Reject incoming call. We cannot handle more than 2 local phone calls"),void Oe(r)}else if(v||1<=M.length||!Bt.isEmptyArray(P)||t.call&&t.call.isAtcRemote&&!t.call.pickupNotification)return void De(t,r)}var s={isAtcPullCall:t.isTelephonyConv&&o&&"offer"===r.sdp.type&&!B&&!g.localUser.isOsBizCTIEnabled,clientId:D.clientId,midMappingEnabled:qe(),isSTC:g.localUser.isSTC&&t.isTelephonyConv,stcCapabilities:t.isTelephonyConv?g.localUser.stcCapabilities:[],canReceiveHdVideo:g.localUser.canUseHDVideo||g.localUser.canUseHDScreenShare};n&&n.localMediaType.desktop&&(s.reuseDesktopStreamFrom=n.sessionCtrl);var c=new Pt(t,s);if(c.setCallIdForTelephony(r.sessionId),c.setInstanceId(r.instanceId),c.setTransactionId(r.transactionId),v&&r.pickUpSession===v.callId&&((n=v).pickUpUserId=r.userId,c.pickUpFromUser=n.peerUser),n){var l=(c.replaces=n).sessionCtrl.getLocalStream(wt.LOCAL_STREAMS.DESKTOP);l&&(m.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",n.callId),c.sessionCtrl.setLocalStream(wt.LOCAL_STREAMS.DESKTOP,l),n.sessionCtrl.setLocalStream(wt.LOCAL_STREAMS.DESKTOP,null),g.localUser.userId===n.screenOwnerId&&(c.restartScreenControlSession=!0,c.screenControllerId=n.screenControllerId)),(l=n.sessionCtrl.getLocalStream(wt.LOCAL_STREAMS.AUDIO_VIDEO))&&(m.debug("[CircuitCallControlSvc] Reusing audio/video stream from call ID=",n.callId),c.sessionCtrl.setLocalStream(wt.LOCAL_STREAMS.AUDIO_VIDEO,l),n.sessionCtrl.setLocalStream(wt.LOCAL_STREAMS.AUDIO_VIDEO,null))}if(U&&(m.info("[CircuitCallControlSvc] Disabling remote video for incoming call"),c.disableRemoteVideo()),c.setState(Dt.CallState.Ringing),c.direction=Dt.CallDirection.INCOMING,g.localUser.isATC&&c.isTelephonyCall&&(c.atcCallInfo=new _t,r.atcAdvancing&&(m.debug("[CircuitCallControlSvc] This ATC call has already advanced to the desk phone"),c.atcAdvancing=!0,c.sessionCtrl.setIgnoreNextConnection(!0)),B)){c.atcCallInfo.setCstaConnection(B.atcCallInfo.getCstaConnection());var d=B.peerUser;c.setPeerUser(d.phoneNumber,d.displayName,d.userId);var u=B.getRedirectingUser();c.setRedirectingUser(u.phoneNumber,u.fullyQualifiedNumber,u.displayName,u.userId,bt.CallPickedUp),a=!(B=null)}var E=r.mediaType||["AUDIO"];He(c,ue({userId:r.userId},E),Dt.ParticipantState.Calling),c.ringingTimeout=r.ringingTimeout||c.ringingTimeout;var C=yt.getMediaType(E);if((c.mediaType=C).desktop&&m.debug("[CircuitCallControlSvc]: INVITE for a Screen Share"),e)J(c,!0);else{J(c);var T=function(){g.$apply(function(){if(c.state!==Dt.CallState.Terminated){ze(c),m.debug("[CircuitCallControlSvc]: New alerting call: ",c.callId),t.call&&!t.isTelephonyConv&&(m.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),ie(t.call));var e=null;if(t.call&&t.call.isAtcRemote&&(e=t.call.callId,t.call.pickupNotification&&o&&function(e,t){if(e&&t){var n=e.getRedirectingUser();t.atcCallInfo||(t.atcCallInfo=new _t,t.setCstaState(Dt.CstaCallState.Active)),t.setRedirectingUser(n.phoneNumber,n.fullyQualifiedNumber,n.displayName,n.userId,bt.CallPickedUp),t.pickUpFromUser=n}}(t.call,c)),t.call=c,t.isTelephonyConv&&o?(m.debug("[CircuitCallControlSvc]: Publish /atccall/replace event"),h.publish("/atccall/replace",[c,e])):ee(t),n)f.answerCall(c.callId,n.localMediaType,function(e){e||i&&v.sessionCtrl&&v.sessionCtrl.mute()});else{if(g.isCMR&&(C.video=!0,C.videoResolution=g.videoResolution,o=!!g.inviterUserId),o)return c.isTelephonyCall&&r.from&&!a&&de(c,r.from.phoneNumber,r.from.fullyQualifiedNumber,r.from.displayName,null,function(){rt(c,r.telephonyInfo)}),void f.answerCall(c.callId,C);D.sendProgress(c.callId,r.userId,g.localUser.userId,function(e){e&&m.error("[CircuitCallControlSvc]: sendProgress error",e)}),c.isTelephonyCall&&r.from?de(c,r.from.phoneNumber,r.from.fullyQualifiedNumber,r.from.displayName,null,function(){t.call===c&&it(t,r.userId),rt(c,r.telephonyInfo)}):it(t,r.userId)}}else m.debug("[CircuitCallControlSvc]: New alerting call has been terminated already")})},p=function(e){m.warn("[CircuitCallControlSvc]: Warmup failed. Ignore the incoming call: ",e),h.publish("/call/warmupFailed",[e,c]),ie(c,null,!0),t.isTemporary&&(m.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),h.publish("/conversation/temporary/ended",[t]))},S=c.sessionCtrl,I=function(e){var t=L[e];return t&&t.turnServers&&t.turnServers.length?t.turnServers:null}(t.rtcSessionId);if(!xt.enabled)return m.warn("[CircuitCallControlSvc]: Client does not support WebRTC."),void p("res_NoWebRTC");j(c).then(function(e){if(c.isPresent()){var t;if(I?(m.debug("[CircuitCallControlSvc]: Using TURN servers associated with session: ",I),S.setTurnUris(I)):(m.debug("[CircuitCallControlSvc]: Using retrieved TURN servers"),S.setTurnUris(e.turnServer)),S.setTurnCredentials(e),m.debug("[CircuitCallControlSvc]: Set TURN credentials"),c.replaces)t=c.replaces.localMediaType;else{var n="firefox"===xt.browser,i="android"===xt.browser;t={audio:!n&&!i&&!R,video:!1}}ct(t,function(e){S.warmup(e,r.sdp,T,p)})}else m.debug("[CircuitCallControlSvc]: There is no incoming call anymore")}).catch(p)}}}else m.error("[CircuitCallControlSvc]: processInvite called without evt or conversation")}function at(e,t){e&&t&&(e.hasJoined||e.isTemporary?t.some(function(t){var n;return e.rtcSessionId===t.rtcSessionId&&(m.debug("[CircuitCallControlSvc]: Processing active session for convId = ",e.convId),t.participants&&0!==t.participants.length?(t.participants.some(function(e){return e.userId===g.localUser.userId&&(n=e,!0)}),(e.type!==ht.ConversationType.DIRECT||t.hosted||n)&&(e.call?m.debug("[CircuitCallControlSvc]: Conversation already has an associated call"):me(e,n,t,null,function(e){n?Ze(e,t):e.conferenceCall&&(m.debug("[CircuitCallControlSvc]: Publish /conference/started event"),h.publish("/conference/started",[e]))})),!0):(m.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",t.rtcSessionId),!0))}):m.debug("[CircuitCallControlSvc]: User is not a conversation participant. Ignore active session."))}function st(n,e,i,r){e=Object.assign({},e),n.type===ht.ConversationType.LARGE&&g.isSessionGuest&&(e.audio=!1,m.debug("[CircuitCallControlSvc]: Set media type for large conference participant to ",e)),ct(e,function(e,t){if(t){if(n.isTelephonyConv)return m.warn("[CircuitCallControlSvc]: Phone calls are not possible without a microphone. Terminate local call."),ie(v),void r("res_MakeCallFailedNoMic");i.warning=t}Ie(n,e,i,r)})}function ct(n,i){return q(n),m.debug("[CircuitCallControlSvc]: Check media sources for mediaType = ",n),!g.browser.msie||g.isSessionGuest||g.localUser.hasPermission(ht.SystemPermission.IE_PLUGIN_SUPPORT)?(n=n?Bt.shallowCopy(n):{audio:!0,video:!1},o||R||!n.audio&&!n.video?(m.debug("[CircuitCallControlSvc]: Normalized mediaType = ",n),void i(n)):(m.debug("[CircuitCallControlSvc]: Get audio and video media sources"),void xt.getMediaSources(function(e,t){n.video&&(!t||t.length<1)&&(m.warn("[CircuitCallControlSvc]: No camera detected"),n.video=!1,r="res_AnswerWarnNoCamera"),n.audio&&(!e||e.length<1)&&(n.audio=!1,m.warn("[CircuitCallControlSvc]: No microphone detected"),r="res_AnswerWarnNoCamera"===r?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailedWarning"),m.debug("[CircuitCallControlSvc]: Normalized mediaType = ",n),i(n,r)}))):(m.debug("[CircuitCallControlSvc]: User does not have permission to use IE plugin. Publish /ieplugin/permissionDenied event."),void h.publish("/iePlugin/permissionDenied"));var r}function lt(e){e&&e.activeNotification&&!e.isHandoverInProgress&&(p&&p.dismiss(e.activeNotification),e.activeNotification=null)}function dt(e){f.mute(e),f.disableRemoteAudio(e)}function ut(r,e,o){if(o=o||function(){},!r||!e)return m.error("[CircuitCallControlSvc]: addParticipant - Invalid arguments"),void o("Invalid arguments");if(r.isDirect&&!r.upgradeToConfSupported)return m.error("[CircuitCallControlSvc]: addParticipant - Cannot upgrade call to conference"),void o("Cannot upgrade to conference");var a=e.cmrData;delete e.cmrData;var t=e.dialOutPhoneNumber,s=t?{userId:"gtc-callout-"+t.replace(/[+ ]+/g,""),phoneNumber:Bt.cleanPhoneNumber(t),displayName:e.displayName,resolvedUserId:e.userId,participantType:ht.RTCParticipantType.TELEPHONY,pstnDialIn:!1}:e;if(!s.userId)return m.warn("[CircuitCallControlSvc]: addParticipant - Participant missing userId"),void o("Missing userId");if(r.hasParticipant(s.userId)||s.resolvedUserId&&r.hasParticipant(s.resolvedUserId))return m.info("[CircuitCallControlSvc]: addParticipantTo - Participant is already in the call"),void o("Participant exists");m.debug("[CircuitCallControlSvc]: Adding participant to existing RTC session. userId =",s.userId);var n=Bt.shallowCopy(r.mediaType);n.audio=!0;var i={rtcSessionId:r.callId,userId:s.userId,mediaType:n};t&&(i.from={phoneNumber:Bt.cleanPhoneNumber(g.localUser.callerId),displayName:g.localUser.displayName},i.to={phoneNumber:s.phoneNumber,displayName:s.displayName,resolvedUserId:s.resolvedUserId}),D.addParticipantToRtcSession(i,function(i){g.$apply(function(){if(i){if(i===ht.ErrorCode.PERMISSION_DENIED)return m.info("[CircuitCallControlSvc]: Failed to add participant. Reached conference participants limit"),void o("res_MaxConversationParticipantsLimit");m.warn("[CircuitCallControlSvc]: Failed to add participant"),o("res_AddParticipantToRtcSessionFailed")}else{if(m.debug("[CircuitCallControlSvc]: Add participant request was successful"),r.direction=Dt.CallDirection.OUTGOING,!r.isRemote){var e=ue(s,["AUDIO"]),t=Dt.ParticipantState.Initiated,n=He(r,e,t);n&&(n.isCMP&&(n.isMeetingPointInvitee=!0,n.cmrData=a||{},r.setMeetingPointInviteState(!0),dt(r.callId)),m.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),h.publish("/call/participant/added",[r.callId,n]))}o()}})})}function Et(e,t){var n=t?e.getParticipant(t):null;m.debug("[CircuitCallControlSvc]: Publish /call/localUser/muted event"),h.publish("/call/localUser/muted",[e.callId,e.remotelyMuted,e.locallyMuted,n]),n&&e.remotelyMuted&&p&&p.show({type:Dt.NotificationType.HIGH_PRIORITY,user:g.localUser,extras:{title:g.i18n.map.res_Muted,text:g.i18n.localize("res_MutedByNotification",[n.displayName])}})}function Ct(e,t,n){if(n=n||function(){},1<=M.length)return n("res_CannotJoinMultipleSessions"),!1;if(v&&v.isPresent())if(v.isTelephonyCall){if(!e.isTelephonyConv||!g.localUser.isRegisterTC)return n("res_CannotJoinMultipleSessions"),!1;if(_)return n("res_CannotInitiateThirdPhoneCall"),!1}else if(!t.replaces)return n("res_CannotJoinMultipleSessions"),!1;for(var i=0;i<I.length;i++)if(!I[i].state.established&&I[i].isTelephonyCall)return m.error("[CircuitCallControlSvc]: Cannot initiate second phone call if existing call is not established"),n("res_JoinRTCSessionFailed"),!1;if(e.isTelephonyConv){if(!t.handover&&(t.dialedDn=t.dialedDn?t.dialedDn.trim():null,!t.dialedDn))return n("Missing Dialed DN"),!1;if(!g.localUser.callerId)return n("Missing Caller ID"),!1;if(g.localUser.isOsBizCTIEnabled&&!t.handover&&e.call)return n("res_CannotJoinMultipleSessions"),!1}return!0}function Tt(e,t){return e=e||{},t&&Object.assign(e,t),e.callOut=!!e.callOut,e.handover=!!e.handover,e}function pt(e,t,n,i){t=t||{},i=i||{};var r="[CircuitCallControlSvc]: "+(n=n||"addRemoveMedia")+": ",o=re(e),a=null,s={};if(o)s=o.localMediaType,"boolean"==typeof t.desktop&&o.videoPointerTo&&(t.video=!1,i.videoPointerTo=null);else{if(!(a=Ue(e))||a.callId!==e)return m.warn(r+"There is no local call"),N.reject("No active call");s=a.mediaType}m.debug(r,t);var c={callId:e,dontReuseAudioStream:!!i.dontReuseAudioStream,mediaType:Object.assign({},s,t),videoPointerTo:i.videoPointerTo||null};return"boolean"==typeof t.video&&"boolean"!=typeof t.hdVideo&&delete c.mediaType.hdVideo,"boolean"==typeof t.desktop&&"boolean"!=typeof t.hdDesktop&&delete c.mediaType.hdDesktop,Ke(o)||(t.video?c.mediaType.desktop=!1:t.desktop&&(c.mediaType.video=!1)),new N(function(t,n){a?ct(c.mediaType,function(e){a.sessionCtrl.replaceLocalStream(wt.LOCAL_STREAMS.AUDIO_VIDEO,null),a.sessionCtrl.warmup(e,null,function(){m.debug(r+"re-warmup succeeded"),t()},function(e){m.warn(r+"re-warmup failed - ",e),n(e)})}):Re(c,function(e){e?(m.warn(r+"failed - ",e),n(e)):t()})})}function St(n,i,r){if(n){var t={ToggleWhiteboard:n.whiteboardEnabled,ToggleScreenShare:n.hasRemoteScreenShare()||n.hasLocalScreenShare(),ToggleConferencePoll:!!n.isPollStarted},o=t.ToggleWhiteboard+t.ToggleScreenShare+t.ToggleConferencePoll;m.debug("[CircuitCallControlSvc]: Number of call features enabled for CMRs",o),r?2<=o&&n.previousScreenFeaturesState[i]!==t[i]&&(n.screenEnabledFeature=i,m.debug("[CircuitCallControlSvc]: Selected feature to show on invited CMR:",n.screenEnabledFeature)):o<2?(n.screenEnabledFeature=null,m.debug("[CircuitCallControlSvc]: There is nothing selected to show on invited CMR")):i===n.screenEnabledFeature&&kt.some(function(e){return!!t[e]&&(n.screenEnabledFeature=e,m.debug("[CircuitCallControlSvc]: Selected feature to show on invited CMR:",n.screenEnabledFeature),!0)}),n.previousScreenFeaturesState=t,n.isMeetingPointInvited&&n.participants.filter(function(e){if(!e.isMeetingPointInvitee)return!1;if("boolean"==typeof e.cmrData.isWhiteboardActive)return!1;if(i===Ht.ToggleConferencePoll.name)return!1;var t=o;return t&&n.isPollStarted&&(t-=1),r?e.cmrData.selectedFeature=2<=t?i:null:t<2?e.cmrData.selectedFeature=null:e.cmrData.selectedFeature===i&&(i===Ht.ToggleScreenShare.name?e.cmrData.selectedFeature=Ht.ToggleWhiteboard.name:e.cmrData.selectedFeature=Ht.ToggleScreenShare.name),!0})}}function It(i,e){var t=f.getActiveCall();if(!t||t.callId!==i)return N.reject("Call not found");if(!e||!e.length)return N.reject("Invalid configuration");if(W&&W.callId===i)W.configuration=e;else{W&&W.cancel();var r={callId:i,configuration:e};r.promise=new N(function(t,n){r.timeout=A(function(){if(W===r){W=null,m.debug("[CircuitCallControlSvc]: Set video receiver configuration to ",r.configuration);var e={rtcSessionId:i,configuration:r.configuration};D.setVideoReceiverConfiguration(e,function(e){g.$apply(function(){e?n(e):t()})})}},S,!1),r.cancel=function(){W===r&&(W=null,m.debug("[CircuitCallControlSvc] Canceling pending setVideoReceiverConfiguration request"),n("Cancelled"),A.cancel(r.timeout))}}),W=r}return W.promise}function At(r){return Array.isArray(r)?new N(function(n){var i={};r.forEach(function(e){!e.isAnonymous&&e.ownerUserId&&(i[e.ownerUserId]=!0)});var e=Object.keys(i);m.debug("[CircuitCallControlSvc] Get user(s) associated with question(s)"),T.getUsersByIds(e,function(e,t){i={},t&&t.forEach(function(e){i[e.userId]=e}),r.forEach(function(e){!e.isAnonymous&&e.ownerUserId&&(e.user=i[e.ownerUserId]),e.user||(e.user={userId:e.ownerUserId||"anonymous",isSessionGuest:!0,avatarColor:"grey",avatar:Ot.SESSION_GUEST.avatar,avatarLarge:Ot.SESSION_GUEST.avatarLarge,initials:e.isAnonymous?"?":Bt.displayNameToInitials(e.displayName)})}),n()})}):N.reject("questions is mandatory")}function Rt(e){try{var t=e.isGuestInvite&&!g.isCMR,n=Y(e.convId);if(!n){m.info("[CircuitCallControlSvc]: Could not find corresponding conversation. Save pending INVITE and retrieve conversation.");var i=e.sessionId;if(H[i]=e,t)O.createConversationAsGuestFromSummary(e.convId).then(function(e){H[i]&&(m.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),ot(H[i],e),delete H[i])}).catch(function(){m.warn("[CircuitCallControlSvc]: Could not create temporary conversation from summary."),delete H[i]});else{var r={randomLoaded:!0,sessionId:e.sessionId};O.getConversationById(e.convId,r,function(e,n){e?m.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):H[i]?(m.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),ot(H[i],n)):(m.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Check if there are any active sessions."),D.getActiveSessions(function(e,t){g.$apply(function(){e&&(m.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),t=[]),at(n,t)})})),delete H[i]})}return}if(t&&!n.isTemporary&&(n=O.createConversationAsGuest(n)),!n.hasJoined&&!t)return void m.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");g.$apply(function(){ot(e,n)})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE event. ",e)}}if(h.subscribe("/conversation/update",function(t,e){if(e){var n=re(t.rtcSessionId);n&&!n.isDirect&&(m.debug("[CircuitCallControlSvc]: Received /conversation/update event"),void 0!==e.isModerated&&n.participants.forEach(function(e){e.setActions(t,g.localUser)}))}}),h.subscribe("/conversation/upgrade",function(t,n){if(m.debug("[CircuitCallControlSvc]: Received /conversation/upgrade event. Old convId = "+t.convId+". New convId = ",n.convId),t.call&&n.convId!==t.convId&&(t.call.checkState(Dt.CallState.Active)||t.type!==ht.ConversationType.DIRECT&&t.call.checkState(Dt.CallState.Waiting)))if(m.debug("[CircuitCallControlSvc]: Move Session"),t.type===ht.ConversationType.DIRECT&&n.type===ht.ConversationType.GROUP){var e=Tt({callOut:!0,handover:!1,replaces:t.call});pe(n,t.call.localMediaType,e)&&Ie(n,t.call.localMediaType,e,function(e){e||t.call.sessionCtrl&&t.call.sessionCtrl.isMuted()&&n.call.sessionCtrl&&n.call.sessionCtrl.mute()})}else{var i={sessionId:t.rtcSessionId,conversationId:t.convId,newSessionId:n.rtcSessionId,newConversationId:n.convId};D.moveRtcSession(i,function(e){e&&m.warn("[CircuitCallControlSvc]: Error moving RTC Session. ",e)})}}),h.subscribe("/conversation/left",function(e){m.debug("[CircuitCallControlSvc]: Received /conversation/left event. convId = ",e.convId),e&&e.call&&f.hideRemoteCall(e.call.callId)}),h.subscribe("/conversation/participants/add",function(t,e){m.debug("[CircuitCallControlSvc]: Received /conversation/participants/add event."),t&&e&&e.forEach(function(e){ut(t,e)})}),h.subscribe("/csta/handover",function(){m.debug("[CircuitCallControlSvc]: Received /csta/handover event."),k=A(function(){k=null},6e3)}),h.subscribe("/atccall/moveFailed",function(){m.debug("[CircuitCallControlSvc]: Received /atccall/moveFailed event."),k&&(A.cancel(k),k=null)}),h.subscribe("/atccall/pickUpInProgress",function(e){m.debug("[CircuitCallControlSvc]: Received /atccall/pickUpInProgress event."),B=e,F=A(function(){B=F=null},4e3)}),h.subscribe("/conversations/loadComplete",function(){m.debug("[CircuitCallControlSvc]: Received /conversations/loadComplete event"),G=!0,tt()}),h.subscribe("/registration/state",function(e){m.debug("[CircuitCallControlSvc]: Received /registration/state event"),e!==RegistrationState.Registered?(v&&v.isTestCall&&ie(v,Dt.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),M.forEach(function(e){m.debug("[CircuitCallControlSvc]: Lost websocket connection, terminate local incoming call"),ie(e,Dt.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}),e!==RegistrationState.Disconnected&&e!==RegistrationState.Waiting||I.forEach(function(e){ie(e,Dt.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)})):g.isSessionGuest&&v&&tt()}),h.subscribe("/conversation/re-added",function(n){m.debug("[CircuitCallControlSvc]: Received /conversation/re-added event. convId = ",n.convId),D.getSession(n.rtcSessionId,function(e,t){e?m.warn("[CircuitCallControlSvc] Error retrieving session. Err: ",e):t.participants&&0<t.participants.length&&g.$apply(function(){at(n,[t])})})}),h.subscribe("/call/meetingPointInvitee",function(e){if(m.debug("[CircuitCallControlSvc]: Received /call/meetingPointInvitee event"),e){var t=re(e);t&&(t.setMeetingPointInviteState(!0),dt(e))}}),h.subscribe("/call/removeConferenceAsGuest",function(e){m.debug("CircuitCallControlSvc]: /call/removeConferenceAsGuest"),f.removeConferenceAsGuest(e)}),vt.isElectron){var ft=function(n,i,e){try{if(!v||!v.hasLocalScreenShare())return void m.debug("[CircuitCallControlSvc]: No local screen share. Ignore DESKTOP_APP event.");if(i.userId=e.srcUserId,!function(t){return!!v&&v.participants.some(function(e){return e.userId===t})}(i.userId))return void m.debug("[CircuitCallControlSvc]: Event sender is not a participant. Ignore DESKTOP_APP event.");T.getUserById(i.userId,function(e,t){!e&&v&&v.hasLocalScreenShare()&&(i.name=t.displayName,require("electron").ipcRenderer.send(n,i))})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP event.",e)}};r.on("DESKTOP_APP.PARTICIPANT_POINTER",function(e,t){m.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_POINTER"),ft("participant-pointer",e,t)})}return r.on("ATC.ADVANCING",function(e){try{if(e.type===gt.ADVANCING){m.debug("[CircuitCallControlSvc]: Received UserToUser ATC.ADVANCING");var t=Ue(e.rtcSessionId);t&&(t.atcAdvancing=!0,t.sessionCtrl.setIgnoreNextConnection(!0))}}catch(e){m.error("[CircuitCallControlSvc]: Exception handling UserToUser ATC.ADVANCING event. ",e)}}),D.on("RTCCall.SDP_ANSWER",function(e){try{m.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_ANSWER");var i=re(e.sessionId);if(!i)return void m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(D.clientId!==e.clientID)return void m.debug("[CircuitCallControlSvc]: Event is not for this client: ",D.clientId);i.isDirect&&u.startJoinDelayTimer(i),g.$apply(function(){var t=e.sdp;if(t){var n=u.createActionInfo(i,ht.RtcDiagnosticsAction.SDP_ANSWER);t.sdp&&"sdp"!==t.sdp&&"data"!==t.sdp||(t.sdp="sdp",m.debug("[CircuitCallControlSvc]: This is a mocked call"),i.setMockedCall()),i.setInstanceId(e.instanceId),i.sessionCtrl.setRemoteDescription(t,function(e){i.clearTransactionId(),e&&(i.setDisconnectCause(ht.DisconnectCause.REMOTE_SDP_FAILED,"type="+t.type+" origin="+Vt.getOrigin(t.sdp)),ye(i,null,Dt.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED),n&&(n.data=e)),u.finishActionInfo(i,n)})}e.localMute&&f.mute(i.callId,function(e){e&&m.warn("[CircuitCallControlSvc]: Error synchronizing client mute state. Error: ",e)})})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_ANSWER event. ",e)}}),D.on("RTCCall.ICE_CANDIDATES",function(e){try{m.debug("[CircuitCallControlSvc]: Received RTCCall.ICE_CANDIDATES");var t=re(e.sessionId);if(!t)return void m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(D.clientId!==e.clientId)return void m.debug("[CircuitCallControlSvc]: Event is not for this client: ",D.clientId);t.sessionCtrl.addIceCandidates(e.origin,e.candidates);var n=u.createActionInfo(t,ht.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES);n&&(n.data=e.candidates,u.finishActionInfo(t,n))}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCCall.ICE_CANDIDATES event. ",e)}}),D.on("RTCSession.SESSION_UPDATED",function(_){g.$apply(function(){try{m.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_UPDATED");var e,t,n=function(e){_.session.hosted&&e.isDirect?e.setDirectUpgradedToConf():e.isDirectUpgradedToConf&&!_.session.hosted&&e.clearDirectUpgradedToConf()},i=_.session.participants.find(function(e){return e.userId===g.localUser.userId}),l=re(_.sessionId);if(i){var r=be(_.sessionId);if(r)return m.debug("[CircuitCallControlSvc]: Event is for an existing active remote call"),r.mediaType=yt.getMediaType(_.session.mediaTypes),r.setActiveClient(i),n(r),void te(r);if(Ue(_.sessionId))return void m.debug("[CircuitCallControlSvc]: Event is for an existing active remote call");if(!l||l.callId!==_.sessionId&&!se(!0)){if(e=O.getConversationByRtcSession(_.sessionId))t=N.resolve(e);else{if(!i.isMeetingGuest)return void m.warn("[CircuitCallControlSvc]: Could not find corresponding conversation");m.debug("[CircuitCallControlSvc]: Local user is guest of this session"),t=O.createConversationAsGuestFromSummary(_.session.convId)}return i.clientId===D.clientId?void m.warn("[CircuitCallControlSvc]: Event is for a local call that has been terminated. Ignore event."):void t.then(function(e){me(e,i,_.session,_.sessionId,function(e){e.voicemailConnected=_.session.participants.some(function(e){return e.participantType===ht.RTCParticipantType.VOICE_MAIL}),Ze(e,_.session)})}).catch(function(e){m.warn("[CircuitCallControlSvc]: Could not retrieve guest conversation. Remote call will not be displayed.",e)})}if(i.clientId!==D.clientId){t=!(e=Y(l.convId))&&i.isMeetingGuest?O.createConversationAsGuestFromSummary(_.session.convId):N.resolve(e);var o=null,a=null,s=null;l.isTelephonyCall&&(o=l.peerUser.phoneNumber,a=l.peerUser.displayName,s=l.participants),_.session.screenControllerId&&g.localUser.userId===_.session.screenOwnerId&&Ae(_.sessionId);var c=l.atcCallInfo,d=l.pickUpFromUser,u=l.pickUpUserId;return ie(l,Dt.CallClientTerminatedReason.ANOTHER_CLIENT_PULLED_CALL),void t.then(function(e){me(e,i,_.session,_.sessionId,function(e){e.atcCallInfo=c,e.isTelephonyCall&&(de(e,o,null,a),e.participants=s),e.pickUpFromUser=d,e.pickUpUserId=u})}).catch(function(e){m.warn("[CircuitCallControlSvc]: Could not retrieve guest conversation. Remote call will not be displayed.",e)})}l.remotelyMuted!==i.muted&&(l.remotelyMuted=i.muted,Et(l))}else if(!l||!l.isLarge)return void m.info("[CircuitCallControlSvc]: Not a large conference and local user is not in the participants list. Ignore event. ");l.instanceId||l.setInstanceId(_.session.instanceId),_.session.muted!==l.sessionMuted&&(l.sessionMuted=_.session.muted,m.debug("[CircuitCallControlSvc]: Publish /call/muted event"),h.publish("/call/muted",[l])),_.session.locked!==l.sessionLocked&&(l.sessionLocked=_.session.locked,m.debug("[CircuitCallControlSvc]: Publish /call/locked event"),h.publish("/call/locked",[l])),_.stageAction&&(_.stageAction===ht.StageAction.USER_ENTERED_STAGE?l.raiseHandState.onStage=!0:_.stageAction===ht.StageAction.USER_LEFT_STAGE&&(l.raiseHandState.onStage=!1),m.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/stageAction event"),h.publish("/call/raiseHand/stageAction",[_.stageAction])),_.session.curtain&&(l.curtain=_.session.curtain,m.debug("[CircuitCallControlSvc]: Publish /call/curtain event (session updated)"),h.publish("/call/curtain",[l.curtain]),l.curtain.curtainClosed&&(g.isSessionGuest||l.isGuestInvite)&&(m.debug("[CircuitCallControlSvc]: Clear active speakers for guests while curtain is closed"),l.setActiveSpeakers([]),h.publish("/call/participants/activeSpeakers",[l.callId,[]]))),_.session.testMode&&!g.isSessionGuest&&(l.testMode=_.session.testMode,m.debug("[CircuitCallControlSvc]: Publish /call/testMode event (session updated)"),h.publish("/call/testMode",[l])),n(l);var E=!!_.session.whiteBoardEnabled;l.whiteboardEnabled!==E&&(l.whiteboardEnabled=E,h.publish("/call/whiteboard/update",[l]));var C=!!_.session.pollEnabled;l.pollEnabled!==C&&(l.pollEnabled=C,h.publish("/call/poll/update",[l])),l.screenControllerId=_.session.screenControllerId||null,l.screenOwnerId=_.session.screenOwnerId||null,l.preventScreenControlRequestInConf=l.screenControllerId&&l.screenControllerId!==g.localUser.userId&&l.screenOwnerId&&l.screenOwnerId!==g.localUser.userId,l.hadRemoteCall=!1;var T=i&&i.videoPointerTo||null;l.videoPointerTo!==T&&(l.videoPointerTo=T,m.debug("[CircuitCallControlSvc]: Set videoPointerTo to ",T||"null"),h.publish("/call/videoPointer/changed",[l]));var p,S=[],I=[],A=_.session.participants||[];if(g.isCMR||A.some(function(e,t){return e.userId===g.localUser.userId&&(A.splice(t,1),!0)}),l.isDirect||l.isAtcConferenceCall()||(p=l.participants.filter(function(e){return e.pcState!==Dt.ParticipantState.Initiated}).map(function(e){return e.userId})),0<A.length||l.conferenceCall){var R=yt.getMediaType(_.session.mediaTypes);if(R.audio=R.audio||l.localMediaType.audio,R.video=R.video||l.localMediaType.video,R.desktop=R.desktop||l.localMediaType.desktop,l.mediaType=R,l.activeClient=null,R.desktop!==l.previousScreenFeaturesState.ToggleScreenShare){var f=l.hasRemoteScreenShare()||l.hasLocalScreenShare();St(l,Ht.ToggleScreenShare.name,f)}Ye(l,0<A.length),l.isAtcConferenceCall()||A.forEach(function(e){var t=!1,n=ue(e),i=n.muted?Dt.ParticipantState.Muted:Dt.ParticipantState.Active,r=l.getParticipant(e.userId);if(ae(n,l),r){Bt.removeArrayElement(p,e.userId);var o=r.pcState,a=r.videoStream;r.streamId===n.streamId&&r.screenStreamId===n.screenStreamId&&r.hasSameMediaType(n)||(t=!0);var s=ke(l,n,i);s&&(t||s.pcState!==o||s.videoStream!==a)&&I.push(s)}else{var c=He(l,n,i);c&&S.push(c)}})}var v=l.state;Be(_.session.attendeeCount),(l.conferenceCall||l.checkState(Dt.CallState.Answering))&&(l.isEstablished()||l.setState(Dt.CallState.Waiting),l.updateCallState()),l.checkState(v)||te(l),e=g.isSessionGuest?null:Y(l.convId),l.conferenceCall&&!l.hasOtherParticipants()&&_.participantId===g.localUser.userId&&(m.debug("[CircuitCallControlSvc]: Publish /conference/starting event"),h.publish("/conference/starting",[l])),p&&0<p.length&&p.forEach(function(e){var t=l.removeParticipant(e);t&&(m.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event. userId = ",e),h.publish("/call/participant/removed",[l.callId,t]))}),0<I.length&&(m.debug("[CircuitCallControlSvc]: Publish /call/participants/updated event"),h.publish("/call/participants/updated",[l.callId,I])),0<S.length&&(m.debug("[CircuitCallControlSvc]: Publish /call/participants/added event"),h.publish("/call/participants/added",[l.callId,S])),l.isTestCall||(_.session.recordings?_.session.recordings.forEach(function(e){Fe(l,e)}):Fe(l,_.session.recordingInfo)),l.isJoiningGroupCall=!1,z(),_e(l,l.screenOwnerId,l.screenControllerId,!0)}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_UPDATED event. ",e)}})}),D.on("RTCSession.SESSION_STARTED",function(n){if(G)try{m.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_STARTED");var e=re(n.sessionId);if(e&&e.isTestCall)return void m.debug("[CircuitCallControlSvc]: Received SESSION_STARTED event for echo test call. Just ignore it.");n.session.turnServers&&Ee(n.sessionId,n.session.turnServers);var i=Y(n.convId);if(!i){m.info("[CircuitCallControlSvc]: Could not find corresponding conversation");var t=1===n.session.participants.length&&n.session.participants[0].userId;if(n.callOut&&t!==g.localUser.userId)return;return m.info("[CircuitCallControlSvc]: Get the conversation from the server"),void O.getConversationById(n.convId,{randomLoaded:!0},function(e,n){e?m.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):(m.info("[CircuitCallControlSvc]: Successfully retrieved the conversation. Check if there are any active sessions."),D.getActiveSessions(function(e,t){g.$apply(function(){e&&(m.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),t=[]),at(n,t)})}))})}if(!i.hasJoined)return void m.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");g.$apply(function(){if(e)m.debug("[CircuitCallControlSvc]: Found local call for SESSION_STARTED event"),m.info("[CircuitCallControlSvc]: Ignore SESSION_STARTED. State =",e.state.name);else if(n.callOut)B&&B.callId===n.sessionId&&(m.debug("[CircuitCallControlSvc]: The call was picked up by a remote client"),f.ignorePickupCall()),n.session.participants.some(function(e){return e.userId===g.localUser.userId&&e.clientId!==D.clientId&&(me(i,e,n.rtcSession,n.sessionId,function(e){e.pullNotAllowed=!0}),!0)});else if(i.type===ht.ConversationType.GROUP||i.type===ht.ConversationType.LARGE){var t=n.session.participants.find(function(e){return e.userId===g.localUser.userId&&e.clientId!==D.clientId});me(i,t,n.rtcSession,n.sessionId,function(e){t||(m.debug("[CircuitCallControlSvc]: Publish /conference/started event"),h.publish("/conference/started",[e]))})}Be(n.session.attendeeCount)})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_STARTED event: ",e)}else m.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the SESSION_STARTED event.")}),D.on("RTCSession.PARTICIPANT_JOINED",function(a){try{m.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_JOINED");var s=a.participant.userId;if(g.localUser.userId===s)return void m.debug("[CircuitCallControlSvc]: Ignore JOINED event for own user");var e=be(a.sessionId);if(e)return void g.$apply(function(){e.pullNotAllowed&&(e.pullNotAllowed=!1),e.isTelephonyCall&&!e.atcCallInfo&&de(e,a.participant.phoneNumber,null,a.participant.userDisplayName)});var c=re(a.sessionId);if(!c)return void m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!c.isEstablished()&&c.direction===Dt.CallDirection.INCOMING)return void m.info("[CircuitCallControlSvc]: Ignore JOINED event for incoming alerting calls");g.$apply(function(){a.participant.participantType===ht.RTCParticipantType.VOICE_MAIL&&c.sessionCtrl.setCallStatsOptions({sendOnlyStream:!0}),!c.isTelephonyCall||c.atcCallInfo&&c.peerUser||de(c,a.participant.phoneNumber,null,a.participant.userDisplayName),c.checkState([Dt.CallState.Delivered,Dt.CallState.Waiting])&&(c.checkState(Dt.CallState.Delivered)?c.setState(Dt.CallState.Waiting):c.conferenceCall&&c.sessionCtrl.isConnected()&&c.setState(Dt.CallState.Active),c.activeClient=null,Ye(c,!0));var e=ue(a.participant),t=e.muted?Dt.ParticipantState.Muted:Dt.ParticipantState.Active;if(c.isTelephonyCall||ae(e,c),c.hasParticipant(s)){var n=ke(c,e,t);n&&(m.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),h.publish("/call/participant/updated",[c.callId,n]))}else{var i=He(c,e,t);i&&(m.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),h.publish("/call/participant/added",[c.callId,i]))}var r=a.userEnteredStage?{userEnteredStage:a.userEnteredStage}:null,o=c.getParticipant(e.userId);m.debug("[CircuitCallControlSvc]: Publish /call/participant/joined event"),h.publish("/call/participant/joined",[c,o,r]),z(),c.updateMediaType(),c.isTestCall||c.recording.recordingUserId!==o.userId||(c.recording.recordingUser=o),te(c)})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTC.PARTICIPANT_JOINED event. ",e)}}),D.on("RTCSession.SESSION_MOVED",function(e){try{if(m.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_MOVED"),H[e.oldRtcSessionId])return m.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete H[e.oldRtcSessionId];var n=oe(e.oldRtcSessionId);if(!n)return void m.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");var i=Y(e.oldConversationId),r=Y(e.newConversationId);if(!i||!r)return void m.warn("[CircuitCallControlSvc]: Could not find corresponding conversations");g.$apply(function(){if(function(e,t,n){var i;i=n.isRemote?new Ut(t):new Pt(t,{clientId:n.clientId}),(t.call=i).terminate(),m.debug("[CircuitCallControlSvc]: Publish /call/ended event"),h.publish("/call/ended",[i,!0]),t.call=null,ee(t),n.updateCall(e),e.call=n,ee(e),m.debug("[CircuitCallControlSvc]: Publish /call/moved event"),h.publish("/call/moved",[i.callId,n.callId]),te(n)}(r,i,n),n.isRemote)m.debug("[CircuitCallControlSvc]: Session Moved for Remote Call");else if(r.creatorId===g.localUser.userId){var t={};i.participants.forEach(function(e){t[e.userId]=!0}),r.participants.forEach(function(e){t[e.userId]||ut(n,e)})}})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTC.SESSION_MOVED event. ",e)}}),D.on("RTCCall.INVITE",function(e){G?(m.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE"),g.isCMR?function(n){if(g.localUser.userPresenceState.state===ht.PresenceState.BUSY)return m.info("[CircuitCallControlSvc]: CMR is updating its software. Reject the INVITE with cause BUSY."),Oe(n);if(g.inviterUserId)g.inviterUserId===n.userId?Rt(n):(m.info("[CircuitCallControlSvc]: INVITE is not from controlling user. Reject the INVITE with cause BUSY."),Oe(n));else{if(!g.circuitLabs.CMR_CONTROL_PANEL)return m.info("[CircuitCallControlSvc]: Control panel feature disabled on CMR. Reject the INVITE with cause BUSY."),Oe(n);if(!g.displaysInfo||!g.displaysInfo.controller)return m.info("[CircuitCallControlSvc]: CMR does not have Control panel. Reject the INVITE with cause BUSY."),Oe(n);H[n.sessionId]=n,D.isAllowedToAddCmr(n.userId,function(e,t){H[n.sessionId]===n&&(delete H[n.sessionId],t?(g.cmrInviterUserId=n.userId,Rt(n)):(e?m.error("[CircuitCallControlSvc]: Failed to check IS_ALLOWED_TO_ADD_CMR. ",e):m.info("[CircuitCallControlSvc]: Inviter is not allowed to add CMR. Reject the INVITE with cause BUSY."),Oe(n)))})}}(e):Rt(e)):m.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the INVITE event.")}),D.on("RTCSession.PARTICIPANT_LEFT",function(C){g.$apply(function(){try{m.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_LEFT");var e=g.localUser.userId===C.userId,n=re(C.sessionId),t=[ht.RTCSessionParticipantLeftCause.TRANSPORT_NEGOTIATION_FAILED,ht.RTCSessionParticipantLeftCause.NEGOTIATION_FAILED,ht.RTCSessionParticipantLeftCause.SECURITY_NEGOTIATION_FAILED];if(e){if(n&&!n.isDirect&&!n.isEstablished()&&!t.includes(C.cause))return void m.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for non-established group calls");var i=n&&C.cause===ht.RTCSessionParticipantLeftCause.REMOVED&&C.requesterId?n.getParticipant(C.requesterId):null;m.debug("[CircuitCallControlSvc]: Publish /localUser/leftConference event"),h.publish("/localUser/leftConference",i?[C.sessionId,C.cause,i]:[C.sessionId,C.cause]),i&&p&&p.show({type:Dt.NotificationType.HIGH_PRIORITY,user:g.localUser,extras:{title:g.i18n.map.res_RemovedFromConferenceTitle,text:g.i18n.localize("res_RemovedFromConferenceBy",[i.displayName])}})}var r=be(C.sessionId);if(r)return m.info("[CircuitCallControlSvc]: Event is for active remote call."),void(e&&he(r));if(!n){var o=Ue(C.sessionId);if(o&&!o.isDirect&&o.hasParticipant(C.userId)){m.info("[CircuitCallControlSvc]: Event is for an incoming call. Caller has left the conversation."),Ve(o,C.userId,C.cause);var a=Y(o.convId);a&&(me(a),ie(o,Dt.CallClientTerminatedReason.CALLER_LEFT_CONFERENCE))}else m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");return}if(n.isTestCall)return void m.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for test calls");if(!e||C.userId!==n.screenOwnerId&&C.userId!==n.screenControllerId||Ae(n.callId),n.isDirect&&!n.isDirectUpgradedToConf)return void(e||C.cause!==ht.RTCSessionParticipantLeftCause.CONNECTION_LOST&&C.cause!==ht.RTCSessionParticipantLeftCause.STREAM_LOST?m.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for direct calls"):n.setParticipantState(C.userId,Dt.ParticipantState.ConnectionLost));var s=C.userId,c=Y(n.convId);if(e){if(me(c),C.cause===ht.RTCSessionParticipantLeftCause.REMOVED){var l=n.getParticipant(C.requesterId);h.publish("/call/droppedRemotely",[n,l])}else if(t.includes(C.cause))return void Xe(n,{error:"res_CallMediaFailed"});ie(n,Dt.CallServerTerminatedReason.SERVER_ENDED_PRFX+C.cause)}else{if(C.cause===ht.RTCSessionParticipantLeftCause.MAX_PARTICIPANTS_REACHED){var d=c.participants.some(function(e){return e.userId===s}),u=function(e,t){e||(m.debug("[CircuitCallControlSvc]: Publish /call/participant/rejected event"),h.publish("/call/participant/rejected",[n.callId,t]))};return void(d?T.getUserById(s,u):u())}Ve(n,s,C.cause);var E=n.hasRemoteScreenShare()||n.hasLocalScreenShare();E!==n.previousScreenFeaturesState.ToggleScreenShare&&St(n,Ht.ToggleScreenShare.name,E),n.isDirectUpgradedToConf&&0===n.participants.length&&ye(n,null,Dt.CallClientTerminatedReason.ENDED_BY_ANOTHER_USER)}n.screenControlSupported&&!n.hasRemoteScreenShare()&&(n.screenControlSupported=!1)}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_LEFT event. ",e)}})}),D.on("RTCCall.SDP_FAILED",function(e){try{m.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_FAILED with cause =",e.cause);var t=re(e.sessionId);if(!t)return void m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(D.clientId!==e.clientID)return void m.debug("[CircuitCallControlSvc]: Event is not for this client");if(t.instanceId||t.setInstanceId(e.instanceId),e.cause===ht.SdpFailedCause.SESSION_TERMINATED)return void m.debug("[CircuitCallControlSvc]: SDP_FAILED due to session terminated. Ignore");g.$apply(function(){t.isEstablished()?t.sessionCtrl.renegotiationFailed("SDP failed received"):e.cause===ht.SdpFailedCause.MAX_PARTICIPANTS_REACHED?Xe(t,{error:"res_JoinRTCSessionFailedPermission"}):t.isDirect&&t.isCallOut||(e.cause===ht.SdpFailedCause.SESSION_STARTED_FAILED?ie(t,Dt.CallServerTerminatedReason.SERVER_ENDED_PRFX+e.cause):ye(t,null,Dt.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED))})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_FAILED event. ",e)}}),D.on("RTCSession.SESSION_TERMINATED",function(n){try{if(m.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATED"),L[n.sessionId]&&delete L[n.sessionId],H[n.sessionId])return m.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete H[n.sessionId];var i=oe(n.sessionId);if(!i)return void m.warn("[CircuitCallControlSvc]: Could not find call with rtcSessionId =",n.sessionId);if(i.terminateTimer)return void m.info("[CircuitCallControlSvc]: Call is already being terminated. Ignore event");i.isTelephonyCall&&k&&(m.debug("[CircuitCallControlSvc]: Call is being moved to another device, keep showing"),i.setAtcHandoverInProgress(),A.cancel(k),k=null),g.$apply(function(){var e=n.cause;if(m.info("[CircuitCallControlSvc]: Publish /call/terminated. cause = ",e),h.publish("/call/terminated",[i,e]),ie(i,Dt.CallServerTerminatedReason.SERVER_ENDED_PRFX+e),g.localUser.isOsBizCTIEnabled){var t=i.isOsBizFirstCall?f.findOsBizSecondCall():f.findOsBizFirstCall();t&&!t.checkState(Dt.CallState.Terminated)&&(h.publish("/call/terminated",[t]),ie(t))}})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_TERMINATED event. ",e)}}),D.on("RTCCall.INVITE_CANCEL",function(o){try{if(D.clientId===o.clientID)return void m.debug("[CircuitCallControlSvc]: Ignore own INVITE_CANCEL");if(H[o.sessionId])return m.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete H[o.sessionId];g.$apply(function(){m.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_CANCEL with cause: ",o.cause);var t=Ue(o.sessionId);if(t){if(!t.isDirect||o.cause===ht.InviteCancelCause.ACCEPT){var e=Y(t.convId),n=o.cause===ht.InviteCancelCause.ACCEPT?{clientId:o.clientID}:null;me(e,n,null,o.sessionId,function(e){n&&e.isTelephonyCall&&de(e,t.peerUser.phoneNumber,null,t.peerUser.displayName)})}var i=Dt.CallClientTerminatedReason.ANOTHER_CLIENT_REJECTED;o.cause===ht.InviteCancelCause.ACCEPT?i=Dt.CallClientTerminatedReason.ANOTHER_CLIENT_ANSWERED:o.cause===ht.InviteCancelCause.REVOKED&&(i=Dt.CallClientTerminatedReason.ENDED_BY_ANOTHER_USER),ie(t,i)}else if(m.debug("[CircuitCallControlSvc]: There is no corresponding alerting call"),o.cause===ht.InviteCancelCause.ACCEPT){var r=oe(o.sessionId);r&&r.isRemote&&(m.debug("[CircuitCallControlSvc]: There is a remote call, probably ringing timeout or another client called in"),r.activeClient={clientId:o.clientID},r.setState(Dt.CallState.ActiveRemote),Le(r),te(r))}})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE_CANCEL event. ",e)}}),D.on("RTCCall.INVITE_FAILED",function(o){try{m.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_FAILED");var a=re(o.sessionId);if(!a)return void m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(!a.isDirect){var e=a.getParticipant(o.userId);if(o.to){e.displayName=o.to.displayName;var t=ke(a,e);t&&(m.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),h.publish("/call/participant/updated",[a.callId,t]))}if(e&&e.isActive())return void m.debug("[CircuitCallControlSvc]: Unexpected event. participant already connected: ",o.userId)}if(o.clientID&&D.clientId!==o.clientID)return void m.debug("[CircuitCallControlSvc]: Event is not for this client: ",D.clientId);a.isTelephonyCall&&o.to&&de(a,o.to.phoneNumber,o.to.fullyQualifiedNumber,o.to.displayName,o.to.userId),g.$apply(function(){var e,t=a,n=o.cause,i=o.userId;switch(n){case ht.InviteFailedCause.NOT_REACHABLE:e=Dt.ParticipantState.Offline,t.isDirect&&t.setState(Dt.CallState.Failed);break;case ht.InviteFailedCause.BUSY:e=Dt.ParticipantState.Busy,t.isDirect&&t.setState(Dt.CallState.Busy);break;case ht.InviteFailedCause.DECLINE:e=Dt.ParticipantState.Declined,t.isDirect&&t.setState(Dt.CallState.Declined);break;case ht.InviteFailedCause.TIMEOUT:e=Dt.ParticipantState.Timeout,t.isDirect&&t.setState(Dt.CallState.NotAnswered);break;case ht.InviteFailedCause.TEMPORARILY_UNAVAILABLE:case ht.InviteFailedCause.INVALID_NUMBER:e=Dt.ParticipantState.Busy,t.isDirect&&t.setState(Dt.CallState.Failed);break;case ht.InviteFailedCause.REVOKED:e=Dt.ParticipantState.Removed,t.isDirect&&t.setState(Dt.CallState.Failed);break;default:m.warn("[CircuitCallControlSvc]: Unexpected RTCCall.INVITE_FAILED cause =",o.cause),e=Dt.ParticipantState.Busy,t.isDirect&&t.setState(Dt.CallState.Failed)}if(t.isDirect)t.setParticipantState(i,e),te(t),t.hasVideo()&&t.removeParticipant(i),ye(t,null,Dt.CallServerTerminatedReason.SERVER_ENDED_PRFX+n,!0);else{t.setParticipantState(i,e);var r=t.removeParticipant(i);r&&(m.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),h.publish("/call/participant/removed",[t.callId,r]),Bt.isEmptyArray(t.participants)&&(t.conferenceCall?t.checkState(Dt.CallState.Waiting)||(t.setState(Dt.CallState.Waiting),te(t)):(t.setState(Dt.CallState.NotAnswered),te(t),ye(null,null,Dt.CallServerTerminatedReason.SERVER_ENDED_PRFX+n,!0))))}})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTC.INVITE_FAILED event. ",e)}}),D.on("RTCSession.ACTIVE_SPEAKER",Je),D.on("RTCSession.VIDEO_ACTIVE_SPEAKER",function(e){try{m.debug("[CircuitCallControlSvc]: Received RTCSession.VIDEO_ACTIVE_SPEAKER");var t=re(e.sessionId);if(!t)return void m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");var n=t.getParticipant(e.userId);if(!n)return void m.debug("[CircuitCallControlSvc]: Participant info not available. Ignoring VIDEO_ACTIVE_SPEAKER. userId=",e.userId);if(n.streamId===e.videoStreamId)return void m.debug("[CircuitCallControlSvc]: Participant is already assigned to the received videoStreamId. Ignoring VIDEO_ACTIVE_SPEAKER");g.$apply(function(){n.streamId=e.videoStreamId,Me(t,n),t.setParticipantRemoteVideoStream(n),t.checkForActiveRemoteVideo(),m.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",n.userId),h.publish("/call/participant/updated",[t.callId,n])})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.VIDEO_ACTIVE_SPEAKER event.",e)}}),D.on("RTCCall.CHANGE_MEDIA_TYPE_REQUESTED",function(i){try{if(m.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_REQUESTED"),Ue(i.sessionId))return void nt(i.sessionId,i.transactionId);var r=re(i.sessionId);if(!r||r.isRemote)return void m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(i.clientID&&D.clientId!==i.clientID)return void m.debug("[CircuitCallControlSvc]: Event is not for this client: ",D.clientId);if(r.activeClient)return void m.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(!r.isEstablished()&&r.direction===Dt.CallDirection.INCOMING||!r.isDirect)return void nt(r.callId,i.transactionId);g.$apply(function(){if(i.sdp){var n=r.sessionCtrl;if(!n.isConnStable())return void nt(r.callId,i.transactionId);r.setTransactionId(i.transactionId),r.isTelephonyCall&&r.atcAdvancing&&"nooffer"!==i.sdp.type&&r.sessionCtrl.setIgnoreTurnOnNextPC();var t=function(e){n.onSessionDescription=null;var t={rtcSessionId:r.callId,sdp:e.sdp,transactionId:r.transactionId};D.changeMediaAccept(t,function(e){g.$apply(function(){r.clearTransactionId(),e?m.error("[CircuitCallControlSvc]: changeMediaAccept sdp answer sending error"):m.debug("[CircuitCallControlSvc]: changeMediaAccept sdp answer sent")})})};r.atcAdvancing=!1,j(r).then(function(e){(n.setTurnCredentials(e),Vt.isNoOfferSdp(i.sdp))?Re({callId:r.callId,transactionId:r.transactionId,mediaType:r.localMediaType,hosted:i.hosted,replaces:i.replaces},function(e){e&&m.warn("[CircuitCallControlSvc]: Failed to renegotiate the media")}):(r.lastMediaType=r.mediaType,n.onSessionDescription=t,n.setRemoteDescription(i.sdp,function(e){e&&(n.onSessionDescription=null,r.transactionId===i.transactionId?nt(r.callId,i.transactionId):m.warn("[CircuitCallControlSvc]: TransactionId: "+i.transactionId+" has already been completed."))}))}).catch(function(){nt(r.callId,i.transactionId)})}else nt(r.callId,i.transactionId)})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_REQUESTED event. ",e)}}),D.on("RTCCall.CHANGE_MEDIA_TYPE_FORCED",function(i){try{m.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_FORCED");var r=re(i.sessionId);if(!r)return void m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(r.isDirect)return void m.debug("[CircuitCallControlSvc]: Event is not applicable for direct calls. Ignore it.");if(i.clientID&&D.clientId!==i.clientID)return void m.debug("[CircuitCallControlSvc]: Event is not for this client: ",D.clientId);if(r.activeClient)return void m.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(i.removeMediaTypes){var n=null;i.removeMediaTypes.includes(ht.RealtimeMediaType.AUDIO)&&(n={audio:!1}),i.removeMediaTypes.includes(ht.RealtimeMediaType.VIDEO)&&((n=n||{}).video=!1),r.localMediaType.desktop&&i.removeMediaTypes.includes(ht.RealtimeMediaType.DESKTOP_SHARING)&&((n=n||{}).desktop=!1),n&&g.$apply(function(){var t=null;if(void 0!==n.desktop){var e=i.removeMediaTypes.includes(ht.RealtimeMediaType.AUDIO);m.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/started event"),h.publish("/screenshare/forceStop/started",[i.userId,e]),t=function(e){if(m.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/ended event"),h.publish("/screenshare/forceStop/ended",[e]),!e){var t=i.userId&&r.getParticipant(i.userId),n=t&&t.displayName;p&&p.show({type:Dt.NotificationType.HIGH_PRIORITY,user:g.localUser,extras:{title:g.i18n.map.res_Screenshare,text:n?g.i18n.localize("res_ScreenShareRemotelyDisabledByUser",[n]):g.i18n.map.res_ScreenShareRemotelyDisabled}})}}}pt(r.callId,n,"changeMediaForced").then(function(){t&&t()}).catch(function(e){t&&t(e)})})}}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_TYPE_FORCED event. ",e)}}),D.on("RTCCall.RTC_QUALITY_RATING_EVENT",function(e){m.debug("[CircuitCallControlSvc]: Received RTCCall.RTC_QUALITY_RATING_EVENT");var t=v||_;if(t)return m.info("[CircuitCallControlSvc]: Postpone call quality rating during call"),void(t.ratingEvent=e);g.$apply(function(){Qe(e)})}),D.on("RTCCall.IFRAME_STATISTICS",function(e){m.debug("[CircuitCallControlSvc]: Received RTCCall.IFRAME_STATISTICS"),g.$apply(function(){p&&p.show({type:Dt.NotificationType.HIGH_PRIORITY,user:g.localUser,extras:{title:g.i18n.map.res_Screenshare,text:g.i18n.localize("res_ScreenShareIFrameDelay",[Math.round(e.receiveDuration/1e3)])}})})}),D.on("RTCSession.PARTICIPANT_UPDATED",function(u){try{m.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_UPDATED");var E=re(u.sessionId),e=be(u.sessionId)||E;if(e&&e.callId===u.sessionId&&e.isTelephonyCall&&!e.atcCallInfo&&g.localUser.userId!==u.participant.userId&&de(e,u.participant.phoneNumber,null,u.participant.userDisplayName),!E)return void m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");g.$apply(function(){var e=u.participant.userId,t=u.participant.muted;if(g.localUser.userId!==e)if(E.isEstablished()||E.direction!==Dt.CallDirection.INCOMING){var n=E.getParticipant(u.participant.userId);if(n){var i=!n.videoPointerTo&&u.participant.videoPointerTo&&g.localUser.userId===u.participant.videoPointerTo,r=ue(u.participant),o=r.muted?Dt.ParticipantState.Muted:Dt.ParticipantState.Active,a=n.muted!==r.muted,s=!n.hasSameMediaType(r)||n.streamId!==r.streamId,c=n.mediaType,l=ke(E,r,o);if(l){if(ae(l,E),s){if(E.updateMediaType(),E.previousScreenFeaturesState.ToggleScreenShare!==E.mediaType.desktop){var d=E.hasRemoteScreenShare()||E.hasLocalScreenShare();St(E,Ht.ToggleScreenShare.name,d)}E.screenOwnerId!==l.userId||l.mediaType.desktop||(m.warn("[CircuitCallControlSvc]: screenOwnerId is no longer sharing the screen. Stop remote control."),Ae(E.callId))}(s||a||i)&&(m.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),h.publish("/call/participant/updated",[E.callId,l,c]))}te(E)}else m.debug("[CircuitCallControlSvc]: Ignore UPDATED event, can not find participant to update for userId: ",e)}else m.debug("[CircuitCallControlSvc]: Ignore UPDATED event for incoming alerting calls");else E.remotelyMuted!==t&&(E.remotelyMuted=t,Et(E,u.mutedBy))})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_UPDATED event. ",e)}}),D.on("RTCSession.SESSION_RECORDING_INFO",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_INFO");var t=re(e.sessionId);t?g.$apply(function(){Fe(t,e.recordingInfo)}):m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),D.on("RTCSession.SESSION_TERMINATION_TIMER_STARTED",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_STARTED");var t=re(e.sessionId);t?g.$apply(function(){m.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (started)"),h.publish("/call/sessionTerminateTimerChanged",[t.callId,e.endTime])}):m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),D.on("RTCSession.SESSION_TERMINATION_TIMER_CANCELLED",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_CANCELLED");var t=re(e.sessionId);t?g.$apply(function(){m.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (cancelled)"),h.publish("/call/sessionTerminateTimerChanged",[t.callId,null])}):m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),D.on("RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT");var t=re(e.sessionId);if(t){var n=e.type||ht.SessionAttributesChangedEventType.EVENT_ATTENDEE_COUNT_CHANGED;n!==ht.SessionAttributesChangedEventType.EVENT_ATTENDEE_COUNT_CHANGED||void 0!==e.attendeeCount&&t.attendeeCount!==e.attendeeCount?g.$apply(function(){switch(n){case ht.SessionAttributesChangedEventType.EVENT_ATTENDEE_COUNT_CHANGED:Be(e.attendeeCount);break;case ht.SessionAttributesChangedEventType.SCREEN_CONTROL_REQUESTED:t.preventScreenControlRequestInConf=!0;break;case ht.SessionAttributesChangedEventType.SCREEN_CONTROL_REQUEST_CLEARED:t.preventScreenControlRequestInConf=!1;break;case ht.SessionAttributesChangedEventType.SCREEN_CONTROL_ESTABLISHED:_e(t,e.screenControl.screenOwnerId,e.screenControl.screenControllerId,!0);break;case ht.SessionAttributesChangedEventType.SCREEN_CONTROL_ENDED:_e(t,null,null,!0);break;default:m.warn("[CircuitCallControlSvc]: Unexpected SessionAttributesChangedEventType - ",n)}}):m.debug("[CircuitCallControlSvc]: No changes")}else m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),D.on("RTCCall.PROGRESS",function(t){m.debug("[CircuitCallControlSvc]: Received RTCCall.PROGRESS");var n=re(t.sessionId);if(n)if(n.isDirect&&(t.sdp||n.earlyMedia||t.progressType!==ht.RTCProgressType.ALERTING?t.sdp&&t.progressType!==ht.RTCProgressType.EARLY_CONNECT&&(n.earlyMedia=!0,n.receivedAlerting&&(m.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/stopped, call ID: ",n.callId),h.publish("/sound/call/alerting/stopped",[n]))):(n.isTelephonyCall&&(m.debug("[CircuitCallControlSvc]: Pre-allocate a new peer connection in case of immediate renegotiations"),n.sessionCtrl.prepareForRenegotiation()),n.receivedAlerting=!0,m.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/started, call ID: ",n.callId),h.publish("/sound/call/alerting/started",[n]))),n.checkState([Dt.CallState.Initiated,Dt.CallState.Delivered])){t.to&&n.isTelephonyCall&&!g.localUser.isATC&&de(n,t.to.phoneNumber,t.to.fullyQualifiedNumber,t.to.displayName,t.to.userId);try{g.$apply(function(){!t.sdp||"answer"!==t.sdp.type&&"pranswer"!==t.sdp.type||(t.sdp.type="pranswer",n.isPranswer=!0,n.sessionCtrl.setRemoteDescription(t.sdp,function(e){e&&(n.setDisconnectCause(ht.DisconnectCause.REMOTE_SDP_FAILED,"type="+t.sdp.type+" origin="+Vt.getOrigin(t.sdp.sdp)),ye(n,null,Dt.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED))})),n.setState(Dt.CallState.Delivered),te(n)})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCCall.PROGRESS event.",e)}}else m.info("[CircuitCallControlSvc]: Ignore PROGRESS. Call state =",n.state.name);else m.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.")}),D.on("RTCSession.INVITE_TO_STAGE_EVENT",function(t){m.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_EVENT");var e=re(t.sessionId);e?(e.raiseHandState.videoAllowed=t.allowedMediaTypes.includes(ht.RealtimeMediaType.VIDEO),e.raiseHandState.screenshareAllowed=t.allowedMediaTypes.includes(ht.RealtimeMediaType.DESKTOP_SHARING),g.$apply(function(){var e={invitedByUserId:t.invitedByUserId,allowedMediaTypes:t.allowedMediaTypes,expirationTime:Bt.delayOrTimestamp(t.expirationDelay,t.expirationTime)};m.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite, questionNumber: ",t.questionNumber),h.publish("/call/raiseHand/invite",[t.questionNumber,e])})):m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),D.on("RTCSession.INVITE_TO_STAGE_CANCEL_EVENT",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_CANCEL_EVENT"),re(e.sessionId)?g.$apply(function(){m.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite (cancel), questionNumber: ",e.questionNumber),h.publish("/call/raiseHand/invite",[e.questionNumber,null])}):m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),D.on("RTCSession.QUESTION_EVENT",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.QUESTION_EVENT"),re(e.sessionId)?g.$apply(function(){At([e.question]).then(function(){m.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/question, questionNumber: ",e.question.questionNumber),h.publish("/call/raiseHand/question",[e.question,e.subType])})}):m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),D.on("RTCSession.CURTAIN_EVENT",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.CURTAIN_EVENT"),re(e.sessionId)?g.$apply(function(){v.curtain=e.curtain,m.debug("[CircuitCallControlSvc]: Publish /call/curtain event"),h.publish("/call/curtain",[v.curtain])}):m.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),D.on("RTCSession.SCREEN_CONTROL_REQUESTED",function(t){m.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_REQUESTED");var n=re(t.sessionId);if(n){if(!n.hasLocalScreenShare()||!vt.isElectron||!$(n))return m.info("[CircuitCallControlSvc]: Screen control is not possible for local call. Reject it."),void f.rejectScreenControlRequest(n.callId,t.controllerId);var i=n.participants.find(function(e){return e.userId===t.controllerId});return i?i.isSessionGuest||!g.localUser.remoteControlExternalEnabled&&i.isExternal?(m.info("[CircuitCallControlSvc]: Externals and Guests are not allowed to control. Reject it."),void f.rejectScreenControlRequest(n.callId,t.controllerId)):void g.$apply(function(){if(m.debug("[CircuitCallControlSvc]: Publish /screenControl/requested event"),h.publish("/screenControl/requested",[n,i]),!n.activeNotification){var e={type:Dt.NotificationType.SCREEN_CONTROL_REQUESTED,userId:t.controllerId,extras:{call:n,controllerId:t.controllerId}};p.show(e)}}):(m.info("[CircuitCallControlSvc]: Cannot find controller in participants list. Reject it."),void f.rejectScreenControlRequest(n.callId,t.controllerId))}m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")}),D.on("RTCSession.SCREEN_CONTROL_OFFERED",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_OFFERED"),ge(e,"SCREEN_CONTROL_OFFERED")}),D.on("RTCSession.SCREEN_CONTROL_ACCEPTED",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_ACCEPTED"),ge(e,"SCREEN_CONTROL_ACCEPTED")}),D.on("RTCSession.SCREEN_CONTROL_REJECTED",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_REJECTED");var t=re(e.sessionId);t?g.$apply(function(){Ne(e.sessionId),m.debug("[CircuitCallControlSvc]: Publish /screenControl/rejected event"),h.publish("/screenControl/rejected",[t])}):m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")}),D.on("RTCSession.SCREEN_CONTROL_REQUEST_REJECTED",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_REJECTED");var t=re(e.sessionId);t?g.$apply(function(){m.debug("[CircuitCallControlSvc]: Publish /screenControl/requestRejected event"),h.publish("/screenControl/requestRejected",[t])}):m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")}),D.on("RTCSession.SCREEN_CONTROL_FAILED",function(e){m.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_FAILED");var t=re(e.sessionId);t?g.$apply(function(){m.debug("[CircuitCallControlSvc]: Publish /screenControl/failed event"),h.publish("/screenControl/failed",[t]),Ne(e.sessionId,null,!0)}):m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")}),D.on("RTCSession.HANDOVER_SCREEN_CONTROL",function(e){try{m.debug("[CircuitCallControlSvc]: Received RTCSession.HANDOVER_SCREEN_CONTROL");var t=re(e.sessionId);if(!t)return void m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!t.isEstablished())return void m.info("[CircuitCallControlSvc]: The local call is not established");if(e.clientID&&D.clientId!==e.clientID)return void m.debug("[CircuitCallControlSvc]: handoverScreenControl event is not for this client: ",D.clientId);fe(t.callId,t.screenControllerId,function(e){e?(m.error("[CircuitCallControlSvc]: Could not transfer the screen control to the active user client."),Ae(t.callId)):(t.restartScreenControlSession=!1,m.debug("[CircuitCallControlSvc]: Successfully transferred the screen control to the active user client."))})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.HANDOVER_SCREEN_CONTROL event. ",e)}}),D.on("RTCSession.SCREEN_CONTROL_TERMINATED",function(e){try{m.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_TERMINATED");var t=re(e.sessionId);if(!t)return void m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!t.isEstablished())return void m.info("[CircuitCallControlSvc]: The local call is not established");t.localMediaType.desktop&&(m.info("[CircuitCallControlSvc]: Stop screen control"),t.sessionCtrl.stopScreenControl(function(e){e?m.warn("[CircuitCallControlSvc]: stopScreenControl failed - reason: ",e):m.debug("[CircuitCallControlSvc]: stopScreenControl was successful.")})),g.$apply(function(){_e(t,null,null,!0)})}catch(e){m.error("[CircuitCallControlSvc]: Exception handling RTCSession.SCREEN_CONTROL_TERMINATED event. ",e)}}),D.on("RTCSession.LIVE_TRANSCRIPTION",function(i){m.debug("[CircuitCallControlSvc]: Received RTCSession.LIVE_TRANSCRIPTION");var e=re(i.sessionId);e?i.text&&g.$apply(function(){i.timestamp=Date.now(),i.user=i.userId===g.localUser.userId?g.localUser:e.getParticipant(i.userId);var n=e.transcription;i.intermediate?(m.info("[CircuitCallControlSvc]: Handle intermediate transcription from ",i.userId),i.text+=" ...",n.intermediate=n.intermediate||[],n.intermediate.some(function(e){return e.userId===i.userId&&(e.timestamp=i.timestamp,e.text=i.text,!0)})||n.intermediate.push(i)):(m.info("[CircuitCallControlSvc]: Handle final transcription from ",i.userId),n.intermediate&&n.intermediate.some(function(e,t){return e.userId===i.userId&&(n.intermediate.splice(t,1),!0)}),n.history=n.history||[],n.history.push(i),10<n.history.length&&n.history.shift());m.debug("[CircuitCallControlSvc]: Publish /call/liveTranscription event"),h.publish("/call/liveTranscription",[e,i])}):m.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")}),D.on("Team.NOTIFY",function(r){m.debug("[CircuitCallControlSvc]: Received Team.NOTIFY"),g.circuitLabs.TEAMS?r.callingUser?m.debug("[CircuitCallControlSvc]: This is a team notification for an incoming phone call. Let CstaSvc handle it."):f.getActiveCall()||f.getIncomingCall()?m.debug("[CircuitCallControlSvc]: Ignore event as the user has other calls"):r.callingUserId!==g.localUser.userId?B&&B.pickupSession===r.rtcSessionId?m.debug("[CircuitCallControlSvc]: Ignore event for call that is already notified"):g.$apply(function(){T.getUsersByIds([r.callingUserId,r.calledUserId],function(e,t){var n,i;e?m.error("[CircuitCallControlSvc]: Error getting users"):t&&t.length&&2===t.length?(t.forEach(function(e){e.userId===r.callingUserId?n=e:i=e}),O.getDirectConversation(n.userId,function(e,t){!e&&t||(t={rtcSessionId:r.rtcSessionId,convId:r.rtcSessionId,type:ht.ConversationType.DIRECT,participants:[{userId:n.userId}]},t=O.createConversationAsGuest(t)),(B=new Ut(t)).atcCallInfo=new _t,B.startRingingTimer=function(){},B.setState(Dt.CallState.Ringing),B.setRedirectingUser(null,null,i.displayName,i.userId,bt.CallPickupNotification),B.pickUpFromUser=i,B.pickupSession=r.rtcSessionId,t.call=B,ee(t),it(t,n.userId,!0)})):m.error("[CircuitCallControlSvc]: Unexpected result from getUsersByIds")})}):m.debug("[CircuitCallControlSvc]: Ignore event as the calling user is the local user"):m.debug("[CircuitCallControlSvc]: Ignore event as the user has not enabled the feature")}),D.on("Team.NOTIFY_CANCEL",function(e){m.debug("[CircuitCallControlSvc]: Received Team.NOTIFY_CANCEL"),B&&!B.isTelephonyCall&&e.rtcSessionId===B.pickupSession&&g.$apply(function(){f.ignorePickupCall()})}),this.simulateRtcSessionEvent=function(e,t){var n={type:ht.ContentType.RTC_SESSION,rtcSession:e};if(t){var i=f.getActiveCall();i&&(n.rtcSession.sessionId=i.callId)}D.simulateEvent(n)},this.initActiveSessionsForSdk=function(){return G=!0,tt()},this.initForUnitTests=function(){G=!0},this.setDisableRemoteVideoByDefault=function(e){m.info("[CircuitCallControlSvc] Setting _disableRemoteVideoByDefault to ",!!e),U=!!e},this.getDisableRemoteVideoByDefault=function(){return U},this.setClientDiagnosticsDisabled=function(e){n=e},this.getCalls=function(){return I},this.getPhoneCalls=function(t){return I.filter(function(e){return e.isTelephonyCall&&(!t||!e.isRemote)})},this.getEstablishedLocalPhoneCalls=function(){return I.filter(function(e){return e.isTelephonyCall&&e.state.established&&!e.isRemote})},this.getActiveCall=function(e){return e?re(e):v&&v.replaces?v.replaces:v||null},this.hasActiveCall=function(){return!!v},this.isConnectionInProgress=function(e){var t=f.getActiveCall(e);return!!t&&!t.sessionCtrl.isConnStable()},this.getIncomingCall=function(){return M[0]||null},this.getActiveRemoteCall=function(){return P},this.joinGroupCall=function(e,t,n){if(n=n||function(){},!e)return m.warn("[CircuitCallControlSvc]: joinGroupCall - Invalid Call Id"),void n("Missing callId");var i=oe(e);if(!i||!i.isRemote||i.state.name!==Dt.CallState.Started.name||i.activeClient)return m.warn("[CircuitCallControlSvc]: joinGroupCall invoked without a valid call"),void n("Invalid call");var r=Y(i.convId);if(!r||!r.call||r.call.callId!==i.callId)return m.warn("[CircuitCallControlSvc]: joinGroupCall - Cannot find valid conversation"),void n("Invalid conversation");i.isGuestInvite&&r.type===ht.ConversationType.LARGE&&(m.info("[CircuitCallControlSvc]: in-circuit guest is joining large conference without audio"),t.audio=!1);var o=Tt({callOut:!1,handover:!1,joiningGroupCall:!0});pe(r,t,o,n)&&st(r,t,o,n)},this.makeCall=function(e,t,n){if(n=n||function(){},!e)return m.warn("[CircuitCallControlSvc]: makeCall - Invalid Conversation Id"),void n("Missing convId");var i=Y(e);if(!i)return m.warn("[CircuitCallControlSvc]: makeCall - Cannot find conversation with id ",e),void n("Conversation not found");var r=Tt({callOut:!0,handover:!1});pe(i,t,r,n)&&st(i,t,r,n)},this.pickupTeamCall=function(e,n,i){if(i=i||function(){},B)if(B.callId===e){var r=function(e){var t=Tt({callOut:!0,handover:!1,pickUpSession:B.pickupSession,pickUpFromUser:B.pickUpFromUser});pe(e,n,t,i)&&st(e,n,t,i)},t=Y(B.convId);if(t){if(!t.isTemporary)return void r(t);m.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),h.publish("/conversation/temporary/ended",[t])}O.createConversation(ht.ConversationType.DIRECT,[{userId:B.peerUser.userId}],null,function(e,t){if(e||!t)return m.error("[CircuitCallControlSvc]: pickupTeamCall - Unable to create direct conversation. Err: ",e),void i("Failed to create conversation");r(t)})}else i("Invalid callId");else i("No call to be picked up")},this.ignorePickupCall=function(){if(B){m.info("[CircuitCallControlSvc]: Ignore pickup notification. callId = ",B.callId),lt(B);var e=Y(B.convId);e&&e.isTemporary&&(m.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),h.publish("/conversation/temporary/ended",[e])),ie(B),m.info("[CircuitCallControlSvc]: Publish /call/terminated"),h.publish("/call/terminated",[B]),B=null}},this.makeEchoTestCall=function(e,t,n){f.makeEchoTestCallWithOptions(e,null,t,n)},this.makeEchoTestCallWithOptions=function(t,n,e,i){e=e||function(){},i=i||function(){};var r=g.isSessionGuest&&g.localUser.conversationId||"echo_"+g.localUser.clientId,o={creatorId:g.localUser.userId,convId:r,rtcSessionId:"echo_"+g.localUser.clientId,participants:[{userId:g.localUser.userId}],testCall:!0};e((o=c.extend(o)).rtcSessionId),A(function(){var e=Tt({callOut:!1,handover:!1},n);pe(o,t,e,i)&&Ie(o,t,e,i)},200)},this.dialNumber=function(i,r,o,a){a=a||function(){},O.getTelephonyConversation(function(e,t){if(e||!t)a(e);else{var n=Tt({callOut:!0,handover:!1,dialedDn:i,toName:r});pe(t,o,n,a)&&st(t,o,n,a)}})},this.dialPhoneNumber=function(i,r){r=r||function(){},i=i||{},O.getTelephonyConversation(function(e,t){if(e||!t)r(e);else{var n=Tt({callOut:!0,handover:!1,dialedDn:i.dialedDn,toName:i.toName,userId:i.userId,dtmfDigits:i.dtmfDigits});if(!Ct(t,n,r))return;if(v&&v.isTelephonyCall&&!v.isHolding())return void f.holdCall(v.callId,function(e){e?r&&r(e):pe(t,i.mediaType,n,r)&&st(t,i.mediaType,n,r)});pe(t,i.mediaType,n,r)&&st(t,i.mediaType,n,r)}})},this.startConference=function(e,t,n){f.startConferenceWithOptions(e,t,null,n)},this.startConferenceWithOptions=function(e,t,n,i){if(t=t||{audio:!0,video:!1},i=i||function(){},!e)return m.warn("[CircuitCallControlSvc]: startConference - Invalid Conversation Id"),void i("Missing convId");var r=Y(e);if(!r)return m.warn("[CircuitCallControlSvc]: startConference - Cannot find conversation with id ",e),void i("Conversation not found");if(r.type!==ht.ConversationType.GROUP&&r.type!==ht.ConversationType.LARGE)return m.warn("[CircuitCallControlSvc]: startConference - Invalid conversation type"),void i("Invalid conversation type");var o=Tt({callOut:!1,handover:!1},n);pe(r,t,o,i)&&st(r,t,o,i)},this.answerCall=function(n,e,i){i=i||function(){};var r,o,a,s=null;if(M.some(function(e,t){return n===e.callId&&(s=e,r=t,!0)}),!s)return m.warn("[CircuitCallControlSvc]: answerCall - There is no alerting call"),void i("No alerting call");function c(){if(s.isPresent()){_=v,v=s,z(),M.splice(r,1),lt(v),v.stopRingingTimer(),v.setState(v.isATCCall?Dt.CallState.Waiting:Dt.CallState.Answering);var e=Y(v.convId);if(!e||!e.call||e.call.callId!==v.callId)return m.warn("[CircuitCallControlSvc]: joinCall - Cannot find valid conversation"),Pe(v,{type:ht.InviteRejectCause.BUSY},!1),void i("Conversation not found");te(v),function(i,r,o,a){if(v){var s=v,c=s.sessionCtrl;o=o||{};c.onSessionDescription=function(e){c.onSessionDescription=null;var t={convId:i.convId,rtcSessionId:s.callId||i.rtcSessionId,ownerId:i.creatorId,sdp:e.sdp,mediaType:r,callOut:!1,handover:!1,sendInviteCancel:!0,isTelephonyConversation:i.isTelephonyConv,displayName:g.localUser.displayName,transactionId:s.transactionId,rtcSupportedFeatures:Se(s)};function n(e){g.$apply(function(){s.clearTransactionId(),e?(ie(s,Ce(e)),a(Q(e))):(m.debug("[CircuitCallControlSvc]: Join/Answer RTC session was successful."),a(null,o.warning))})}t.sdp&&"offer"===t.sdp.type?D.joinRtcCall(t,n):(u.startJoinDelayTimer(s),D.answerRtcCall(t,n))},c.start(r,null)||(ie(s,Dt.CallClientTerminatedReason.RTC_SESSION_START_FAILED),a(Q()))}else m.warn("[CircuitCallControlSvc]: joinSessionCalled invoked without _primaryLocalCall")}(e,o,{warning:a},i)}else i("No call to answer")}function t(){ct(e,function(e,t){if(t){var n=O.getConversationFromCache(s.convId);if(n&&n.isTelephonyConv)return m.warn("[CircuitCallControlSvc]: Phone calls are not possible without a microphone. Do not answer call."),void i("res_AnswerCallFailedNoMic")}o=e,a=t,c()})}if(!v||!v.isPresent()||s.replaces||v.isTelephonyCall&&s.isTelephonyCall&&g.localUser.isRegisterTC){if(v&&v.isTelephonyCall&&g.localUser.isRegisterTC&&!v.isHolding())return void f.holdCall(v.callId,function(e){e?i(e):t()})}else ye(v,null,Dt.CallClientTerminatedReason.USER_ENDED),_&&ye(_,null,Dt.CallClientTerminatedReason.USER_ENDED);t()},this.endCall=function(e,t){var n=ht.InviteRejectCause.DECLINE,i=f.getActiveCall();i&&i.callId===e&&(!i.isEstablished()&&i.direction!==Dt.CallDirection.OUTGOING||(n=null)),f.endCallWithCauseCode(e,n,t)},this.endCallWithCauseCode=function(e,t,n){var i=Dt.CallClientTerminatedReason.USER_ENDED,r=ht.InviteRejectCause.DECLINE;t&&(i=t,ht.InviteRejectCause[t]&&(r=t));var o=re(e);if(o)o.replaces&&o.checkState(Dt.CallState.Answering)?n("Auto answer in progress"):o.terminateTimer?(ie(o,i),n&&A(n)):ye(o,r,i,!1,n);else if(v&&v.replaces&&v.replaces.callId===e)ye(v.replaces,r,i,!1,n);else{var a=oe(e);if(a)return void(a.terminateTimer?(ie(a),n&&A(n)):ye(a,r,i,!1,n));var s=Ue(e);if(s)Pe(s,{type:r},!1,n);else{m.warn("[CircuitCallControlSvc]: endCall - There is no local or alerting call");var c=O.getConversationByRtcSession(e);c&&c.call&&(c.call=null,ee(c)),n&&n("Call not found")}}},this.endConference=function(e,t){var n=oe(e);n?g.isSessionGuest||n.isGuestInvite?t&&t("Not allowed"):function(n,i){if(i=i||function(){},n.isDirect)return m.debug("[CircuitCallControlSvc]: Direct call. Ignore terminate conference request."),A(i);m.debug("[CircuitCallControlSvc]: terminateConference - rtcSessionId=",n.callId),D.terminateRtcCall(n.callId,n.disconnectCause,function(t){g.$apply(function(){if(t&&(m.warn("[CircuitCallControlSvc]: Error terminating the RTC call. ",t),n===v)){var e=Y(n.convId);e&&n.isEstablished()&&me(e)}i&&i(t)})}),n===v&&ie(n,Dt.CallClientTerminatedReason.USER_ENDED)}(n,t):t&&t("Call not found")},this.startScreenShare=function(e,t,n){if(n=n||function(){},!e)return m.warn("[CircuitCallControlSvc]: startScreenShare - Invalid Conversation Id"),void n("Invalid convId");var i=Y(e);if(!i)return m.warn("[CircuitCallControlSvc]: startScreenShare - Cannot find conversation with id ",e),void n("Conversation not found");var r={audio:!0,video:!1,desktop:!0};t&&"string"==typeof t&&(t={screenShareType:t});var o=Tt({callOut:!0,handover:!1,screenShareOptions:t});pe(i,r,o,n)&&Ie(i,r,o,function(e){e||(m.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),h.publish("/screenshare/started")),n(e)})},this.addScreenShare=function(n,i,r){r=r||function(){};var o=re(n);if(!o)return m.warn("[CircuitCallControlSvc]: addScreenShare - There is no local call"),void r("No active call");var a=Object.assign({},o.localMediaType);a.desktop=!0,Ke(o)||(a.video=!1),i&&"string"==typeof i&&(i={screenShareType:i}),x=null,xe(o,i).then(function(e){var t={callId:n,mediaType:a,screenShareOptions:{screenIndex:e.screenIndex,streamId:e.streamId,screenType:i&&i.screenShareType,pointer:e.pointer,screenControlSupported:e.screenControlSupported,mediaStream:e.mediaStream}};o.videoPointerTo&&(t.mediaType.video=!1,t.videoPointerTo=null),Re(t,function(e){if(e)return m.warn("[CircuitCallControlSvc]: AddScreenShare failed: ",e),void r(e);m.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),h.publish("/screenshare/started"),r()})}).catch(function(e){r(e)})},this.addMediaStream=function(e,t,n){n=n||function(){};var i=re(e);if(!i)return m.warn("[CircuitCallControlSvc]: addMediaStream - There is no local call"),void n("No active call");var r=Object.assign({},i.localMediaType);r.desktop=!0,Ke(i)||(r.video=!1),Re({callId:e,mediaType:r,screenShareOptions:{mediaStream:t}},function(e){e?(m.warn("[CircuitCallControlSvc]: addMediaStream failed: ",e),n("res_AddMediaStreamFailed")):n()})},this.addVideoStream=function(r,o,a){return new N(function(t,n){var e=re(r);if(!e)return m.warn("[CircuitCallControlSvc]: addVideoStream - There is no local call"),void n("No active call");if(!o)return m.warn("[CircuitCallControlSvc]: addVideoStream - There is stream to be added"),void n("No stream to be added");var i=Object.assign({},e.localMediaType);i.video=!0,Ke(e)||(i.desktop=!1),Re({callId:r,mediaType:i,videoPointerTo:a&&a.videoPointerTo||null,videoOptions:{mediaStream:o}},function(e){e?(m.warn("[CircuitCallControlSvc]: addVideoStream failed: ",e),n("res_AddVideoFailed")):t()})})},this.removeMediaStream=function(e,t){t=t||function(){},pt(e,{desktop:!1},"removeMediaStream").then(t).catch(function(){t("res_RemoveMediaStreamFailed")})},this.requestScreenControl=function(o){return new N(function(t,n){m.debug("[CircuitCallControlSvc]: requestScreenControl...");var i=re(o);if(!i)return m.warn("[CircuitCallControlSvc]: requestScreenControl - There is no local call"),void n("No active call");if(!i.hasRemoteScreenShare())return m.warn("[CircuitCallControlSvc]: requestScreenControl - Local call does not have remote screenshare"),void n("No screen share");if(!i.screenControlSupported)return m.warn("[CircuitCallControlSvc]: requestScreenControl - Screen control not supported by presenter"),void n("Not supported");var r=i.participants.find(function(e){return e.mediaType.desktop});if(!r)return m.warn("[CircuitCallControlSvc]: requestScreenControl - Could not find screenshare presenter"),void n("No presenter");var e={rtcSessionId:i.callId,ownerId:r.userId};D.requestScreenControl(e,function(e){g.$apply(function(){e?(m.error("[CircuitCallControlSvc]: Failed to request screen control. ",e),n(e)):(m.debug("[CircuitCallControlSvc]: requestScreenControl was successful. Wait for the SCREEN_CONTROL_OFFERED event."),t(),m.debug("[CircuitCallControlSvc]: Publish /screenControl/request event"),h.publish("/screenControl/request",[i,r]))})})})},this.offerScreenControl=function(e,i){return new N(function(t,n){m.debug("[CircuitCallControlSvc]: offerScreenControl..."),fe(e,i,function(e){e?n(e):t()})})},this.rejectScreenControlRequest=function(r,o){return new N(function(t,n){m.debug("[CircuitCallControlSvc]: rejectScreenControlRequest...");var i=re(r);if(!i)return m.warn("[CircuitCallControlSvc]: rejectScreenControlRequest - There is no local call"),void n("No active call");if(!o)return m.warn("[CircuitCallControlSvc]: rejectScreenControlRequest - controllerId was not provided"),void n("No active call");var e={rtcSessionId:r,controllerId:o};D.rejectScreenControlRequest(e,function(e){e?(m.error("[CircuitCallControlSvc]: Failed to reject screen control request. ",e),n(e)):(m.debug("[CircuitCallControlSvc]: rejectScreenControlRequest was successful."),_e(i,null,null,!0),t())})})},this.stopScreenControl=function(e){return new N(function(t,n){Ne(e,function(e){e?n(e):t()})})},this.sendDataMessage=function(e){m.debug("[CircuitCallControlSvc]: Sending WebRTC data");var t=f.getActiveCall();t&&t.sessionCtrl&&t.sessionCtrl.sendDataMessage(e)||m.error("[CircuitCallControlSvc]: Cannot send WebRTC data")},this.selectMediaToShare=function(t,n,i){i=i||function(){};var e=re(t);if(!e)return m.warn("[CircuitCallControlSvc]: selectMediaToShare - There is no local call"),void i("No active call");m.debug("[CircuitCallControlSvc]: selectMediaToShare...");var r=Object.assign({},e.localMediaType);r.desktop=!0,Ke(e)||(r.video=!1),n&&"string"==typeof n&&(n={screenShareType:n}),xe(e,n).then(function(e){Re({callId:t,mediaType:r,changeDesktopMedia:!0,screenShareOptions:{screenIndex:e.screenIndex,streamId:e.streamId,screenType:n&&n.screenShareType,pointer:e.pointer,screenControlSupported:e.screenControlSupported,mediaStream:e.mediaStream}},i)}).catch(function(e){i(e)}),h.publish("/screenshare/changed")},this.removeScreenShare=function(e,t){t=t||function(){},pt(e,{desktop:!1},"removeScreenShare").then(t).catch(function(){t("res_RemoveScreenShareFailed")})},this.addAudio=function(e,t){t=t||function(){},pt(e,{audio:!0},"addAudio").then(t).catch(function(){t("Renegotiate for receive-only media failed")})},this.removeAudio=function(e,t){t=t||function(){},pt(e,{audio:!1},"removeAudio").then(t).catch(function(){t("Renegotiate for receive-only media failed")})},this.enableRemoteAudio=function(e){var t=re(e);t?t.remoteAudioDisabled&&(t.enableRemoteAudio(),m.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),h.publish("/call/remoteStreamUpdated",[t])):m.warn("[CircuitCallControlSvc]: enableRemoteAudio - There is no local call")},this.disableRemoteAudio=function(e){var t=re(e);t?t.remoteAudioDisabled||(t.disableRemoteAudio(),m.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),h.publish("/call/remoteStreamUpdated",[t])):m.warn("[CircuitCallControlSvc]: disableRemoteAudio - There is no local call")},this.addVideo=function(e,t){t=t||function(){},pt(e,{video:!0},"addVideo").then(t).catch(function(){t("res_AddVideoFailed")})},this.removeVideo=function(e,t){t=t||function(){},pt(e,{video:!1},"removeVideo").then(t).catch(function(){t("res_RemoveVideoFailed")})},this.disableRemoteVideoOnly=function(e,t){t=t||function(){};var n=re(e);if(!n)return m.warn("[CircuitCallControlSvc]: toggleRemoteVideo - There is no local call"),void t("No active call");if(m.debug("[CircuitCallControlSvc]: toggleRemoteVideo..."),n.sessionCtrl.isConnStable())if(n.remoteVideoDisabled)t("Remote video and screen share are already disabled");else if(n.remoteVideoScreenOnlyAllowed)t("Remote video is already disabled");else{var i=function(e){n.disableRemoteVideoScreenOnly(),m.warn("[CircuitCallControlSvc]: disableRemoteVideoOnly failed: ",e),t("res_ToggleVideoFailed")},r=n.enableRemoteVideoScreenOnly();if(n.supportsVideoReceiverConfiguration())It(n.callId,r).then(function(){h.publish("/call/toggleRemoteVideo"),t()}).catch(i);else h.publish("/call/toggleRemoteVideo"),Re({callId:e,mediaType:n.localMediaType},function(e){e?i(e):t()})}else t("Connection not stable")},this.enableRemoteVideo=function(e,t){t=t||function(){};var n=re(e);if(!n)return m.warn("[CircuitCallControlSvc]: enableRemoteVideo - There is no local call"),void t("No active call");if(m.debug("[CircuitCallControlSvc]: enableRemoteVideo..."),n.sessionCtrl.isConnStable()){var i=n.enableRemoteVideo(),r=function(){t(),n.remoteVideoDisabled||h.publish("/call/toggleRemoteVideo")},o=function(e){n.enableRemoteVideoScreenOnly(),m.warn("[CircuitCallControlSvc]: enableRemoteVideo failed: ",e),t("res_ToggleVideoFailed")};if(n.supportsVideoReceiverConfiguration())It(n.callId,i).then(r).catch(o);else Re({callId:e,mediaType:n.localMediaType},function(e){e?o(e):r()})}else t("Connection not stable")},this.toggleRemoteVideo=function(e,t){t=t||function(){};var n=re(e);if(!n)return m.warn("[CircuitCallControlSvc]: toggleRemoteVideo - There is no local call"),void t("No active call");if(m.debug("[CircuitCallControlSvc]: toggleRemoteVideo..."),n.sessionCtrl.isConnStable()){var i;n.remoteVideoDisabled?i=n.enableRemoteVideo():(i=n.disableRemoteVideo(),h.publish("/call/toggleRemoteVideo"));var r=function(){t(),n.state&&n.state.established&&n.remoteControlActive&&!n.hasRemoteScreenShare()&&Ae(n.callId),n.remoteVideoDisabled||h.publish("/call/toggleRemoteVideo")},o=function(e){n.remoteVideoDisabled?n.enableRemoteVideo():n.disableRemoteVideo(),m.warn("[CircuitCallControlSvc]: toggleRemoteVideo failed: ",e),t("res_ToggleVideoFailed")};if(n.supportsVideoReceiverConfiguration())m.debug("New video receiver configuration: ",i),It(n.callId,i).then(r).catch(o);else Re({callId:e,mediaType:n.localMediaType},function(e){e?o(e):r()})}else t("Connection not stable")},this.changeHDVideo=function(e,t,n,i){n=n||function(){};var r=re(e);if(!r)return m.warn("[CircuitCallControlSvc]: changeHDVideo - There is no local call"),void n("No active call");if(!r.localMediaType.video)return m.warn("[CircuitCallControlSvc]: changeHDVideo - Local call has no video"),void n("No video");if(t=!!t,!vt.isSDK&&!g.localUser.canUseHDVideo)return m.warn("[CircuitCallControlSvc]: changeHDVideo - User does not have HD video permission"),void n("No HD permission");if(m.debug("[CircuitCallControlSvc]: changeHDVideo - hdVideo = ",t),r.localMediaType.hdVideo===t)return m.debug("[CircuitCallControlSvc]: changeHDVideo - No changes"),void n(null,null);je(i)||(i=null);var o=Object.assign({},r.localMediaType);o.hdVideo=t,o.videoResolution=i,Re({callId:e,mediaType:o},function(e){if(e)m.warn("[CircuitCallControlSvc]: changeHDVideo failed: ",e),n("res_ToggleVideoFailed");else{var t=null;i&&i!==r.localMediaType.videoResolution&&(t="res_ToggleVideoResolutionNotSupported"),n(null,t)}})},this.changeVideoResolution=function(e,t,n){n=n||function(){};var i=re(e);if(!i)return m.warn("[CircuitCallControlSvc]: changeVideoResolution - There is no local call"),void n("No active call");if(!i.localMediaType.video||!i.localMediaType.hdVideo)return m.warn("[CircuitCallControlSvc]: changeVideoResolution - Local call has no HD video"),void n("No HD video");if(m.debug("[CircuitCallControlSvc]: changeVideoResolution - newResolution = ",t),je(t)){if(i.localMediaType.videoResolution===t)return m.debug("[CircuitCallControlSvc]: changeVideoResolution - No changes"),void n(null,null);var r=Object.assign({},i.localMediaType);r.videoResolution=t,Re({callId:e,mediaType:r},function(e){e?(m.warn("[CircuitCallControlSvc]: changeVideoResolution failed: ",e),n("res_ToggleVideoFailed")):n(null,i.localMediaType.videoResolution!==t?"res_ToggleVideoResolutionNotSupported":null)})}else n("Invalid resolution")},this.toggleVideo=function(e,t){t=t||function(){};var n=re(e);if(!n)return m.warn("[CircuitCallControlSvc]: toggleVideo - There is no local call"),void t("No active call");pt(e,{video:!n.localMediaType.video},"toggleVideo").then(t).catch(function(){t("res_ToggleVideoFailed")})},this.renegotiateMedia=function(e,t,n){t=t||function(){},pt(e,{},"renegotiateMedia",n).then(t).catch(function(){t("Renegotiate media failed")})},this.setMediaType=function(e,t,n){if(n=n||function(){},!re(e))return m.warn("[CircuitCallControlSvc]: setMediaType - There is no local call"),void n("No active call");m.debug("[CircuitCallControlSvc]: setMediaType..."),Re({callId:e,mediaType:t},function(e){e?(m.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),n("Renegotiate media failed")):n()})},this.holdCall=function(e,t){t=t||function(){};var n=re(e);return n?n.isHolding()||n.isHoldInProgress()?(m.debug("[CircuitCallControlSvc]: holdCall - The call is already held"),void t()):(m.debug("[CircuitCallControlSvc]: holdCall..."),n.setHoldInProgress(),void Re({callId:e,mediaType:n.localMediaType,hold:!0},function(e){n.clearHoldInProgress(),e?(m.warn("[CircuitCallControlSvc]: Failed to hold the call"),t("res_HoldCallFailed")):t()})):(m.warn("[CircuitCallControlSvc]: holdCall - There is no call"),void t("No active call"))},this.retrieveCall=function(e,n){n=n||function(){};var i=re(e);if(!i.isHolding())return m.debug("[CircuitCallControlSvc]: retrieveCall - There is no held local call"),void n();m.debug("[CircuitCallControlSvc]: retrieveCall..."),i.setRetrieveInProgress(),Re({callId:e,mediaType:i.localMediaType,hold:!1},function(e){if(i.clearRetrieveInProgress(),e)m.warn("[CircuitCallControlSvc]: Failed to retrieve the call"),n("res_RetrieveCallFailed");else{i===_&&(_=v,v=i);var t=Y(v.convId);t.call=v,ee(t),n()}})},this.swapCall=function(e,t){if(t=t||function(){},!(_=1<f.getPhoneCalls(!0).length?ce(!0):null)||!v)return m.warn("[CircuitCallControlSvc]: swapCall - There are no held and active local calls"),void t("No calls to swap");if(_&&_.callId!==e)return m.warn("[CircuitCallControlSvc]: swapCall - Wrong callId of the held call"),void t("Wrong callId");var n=_.callId,i=v.callId;f.holdCall(i,function(e){e?t&&t(e):f.retrieveCall(n,t)})},this.pullRemoteCall=function(i,e,r){r=r||function(){};var o=be(i);if(!o)return m.warn("[CircuitCallControlSvc]: pullRemoteCall invoked without a valid call"),void r("No active remote call");if(o.pullNotAllowed)r("res_PullCallNotAllowed");else{var a=Y(o.convId);if(!a||!a.isTelephonyConv&&a.call.callId!==i)return m.warn("[CircuitCallControlSvc]: pullRemoteCall - Cannot find valid conversation"),void r("Conversation not found");!0,v&&v.isTelephonyCall?f.holdCall(v.callId,function(e){e?r&&r(e):t()}):t()}function t(){var e=o.activeClient||{},t={audio:!0,video:!(!e.mediaType||!e.mediaType.video)},n=Tt({callOut:t.video=!1,handover:!0,callId:i,pickUpFromUser:o.pickUpFromUser,pickUpUserId:o.pickUpUserId});pe(a,t,n,r)&&st(a,t,n,r)}},this.endRemoteCall=function(e,t){t=t||function(){};var n=be(e);if(!n)return m.warn("[CircuitCallControlSvc]: endRemoteCall invoked without a valid call"),void t("No active remote call");var i=Y(n.convId);if(!i||i.call.callId!==e)return m.warn("[CircuitCallControlSvc]: endRemoteCall - Cannot find valid conversation"),void t("Conversation not found");!function(e,t){m.debug("[CircuitCallControlSvc]: endRemoteCall - rtcSessionId=",e.callId),e.isDirect?D.terminateRtcCall(e.callId,e.disconnectCause,function(e){g.$apply(function(){e&&m.warn("[CircuitCallControlSvc]: Error terminating remote RTC call. ",e),t(e)})}):D.leaveRtcCall(e.callId,e.disconnectCause,function(e){g.$apply(function(){e&&m.warn("[CircuitCallControlSvc]: Error leaving remote RTC call. ",e),t(e)})})}(n,function(e){e?t("res_EndRemoteCallFailed"):(he(n),t())})},this.hideRemoteCall=function(e){var t=oe(e);t?ie(t):m.warn("[CircuitCallControlSvc]: hideRemoteCall invoked without a valid call")},this.dropParticipant=function(e,t,n){n=n||function(){};var i=re(e);return!i||i.isDirect?(m.warn("[CircuitCallControlSvc]: dropParticipant - invalid call"),void n("Call invalid")):t&&t.userId?(t.isCMP&&t.isMeetingPointInvitee&&!X(i.participants)&&(i.setMeetingPointInviteState(!1),f.enableRemoteAudio(e)),m.debug("[CircuitCallControlSvc]: Dropping participant in existing RTC session. userId =",t.userId),void function(e,t){if(t=t||function(){},v){var n=v.getParticipant(e);if(n)if(n.actions.includes(Dt.ParticipantAction.Drop)){var i={rtcSessionId:v.callId,userId:e};D.removeSessionParticipant(i,function(e){g.$apply(function(){e?(m.warn("[CircuitCallControlSvc]: Failed to remove participant"),t("res_RemoveParticipantFailed")):t()})})}else m.warn("[CircuitCallControlSvc]: remove call participant, unsupported pcState: ",n.pcState.name),t("Participant not active");else m.error("[CircuitCallControlSvc]: call participant not found: ",e),t("Participant not found")}else t("No active call")}(t.userId,n)):(m.warn("[CircuitCallControlSvc]: dropParticipant - Invalid participant"),void n("Participant invalid"))},this.addParticipantToCall=function(e,t,n){var i=re(e);i?ut(i,t,n):(m.warn("[CircuitCallControlSvc]: addParticipantToCall - There is no local call"),n&&n("Invalid callId"))},this.addParticipantToRtcSession=function(e,t,n){var i=oe(e);i?ut(i,t,n):(m.warn("[CircuitCallControlSvc]: addParticipantToRtcSession - Call not found"),n&&n("Invalid callId"))},this.mute=function(e,t){t=t||function(){};var n=re(e);if(!n||e!==n.callId)return m.warn("[CircuitCallControlSvc]: mute - There is no local call"),void t("Call not valid");n.locallyMuted?t("Call already muted"):(m.debug("[CircuitCallControlSvc]: Mute the local call"),n.mute(function(){g.$apply(function(){m.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),h.publish("/call/localUser/mutedSelf",[e,!0]),f.muteParticipant(n.callId,g.localUser,function(e){e&&m.warn("[CircuitCallControlSvc]: Error synchronizing local mute with backend.",e)}),t()})}))},this.unmuteLocally=function(t){t=t||function(){},v?v.locallyMuted?(m.debug("[CircuitCallControlSvc]: Unmute the local call"),v.unmute(function(e){g.$apply(function(){e||(m.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),h.publish("/call/localUser/mutedSelf",[v.callId,!1])),t(e)})})):t():t("Call not found")},this.unmute=function(e,t){t=t||function(){};var n=re(e);n?n.isMuted()?f.unmuteLocally(function(e){e?t(e):f.unmuteParticipant(n.callId,g.localUser,t)}):t("Call not muted"):m.warn("[CircuitCallControlSvc]: unmute - There is no local call")},this.toggleMute=function(e,t){t=t||function(){};var n=re(e);return n?n.isLocalMuteAllowed()?void(n.isMuted()?f.unmute(n.callId,t):f.mute(n.callId,t)):(m.warn("[CircuitCallControlSvc]: toggleMute - Local Mute is not allowed"),void t()):(m.warn("[CircuitCallControlSvc]: toggleMute - There is no local call"),void t("Call not valid"))},this.muteParticipant=function(e,t,n){n=n||function(){};var i=re(e);if(!i)return m.warn("[CircuitCallControlSvc]: muteParticipant - There is no local call"),void n("Call invalid");var r=t&&t.userId;if(!r)return m.warn("[CircuitCallControlSvc]: muteParticipant - Invalid participant ID"),void n("Participant invalid");m.debug("[CircuitCallControlSvc]: Mute participant in existing RTC session. participantId =",r);var o={rtcSessionId:i.callId,usersIds:[r],muted:!0};D.muteParticipant(o,function(e){g.$apply(function(){e?(m.warn("[CircuitCallControlSvc]: Failed to mute participant"),n("res_MuteParticipantFailed")):n()})})},this.hasUnmutedParticipants=function(e){var t=re(e);return t&&e===t.callId?t.hasUnmutedParticipants():(m.warn("[CircuitCallControlSvc]: hasUnmutedParticipants - There is no local call"),!1)},this.muteRtcSession=function(e,t){t=t||function(){};var n=re(e);if(!n||e!==n.callId)return m.warn("[CircuitCallControlSvc]: muteRtcSession - There is no local call"),void t("Call invalid");if(n.hasUnmutedParticipants()){m.debug("[CircuitCallControlSvc]: Mute RTC session (all other participants)");var i={rtcSessionId:n.callId,muted:!0,excludedUserIds:[g.localUser.userId]};D.muteRtcSession(i,function(e){g.$apply(function(){e?(m.warn("[CircuitCallControlSvc]: Failed to mute RTC session"),t("res_MuteAllOtherParticipantsFailed")):t()})})}},this.unmuteParticipant=function(e,t,n){n=n||function(){};var i=re(e);if(!i)return m.warn("[CircuitCallControlSvc]: unmuteParticipant - There is no local call"),void n("Call invalid");var r=t&&t.userId;if(!r)return m.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void n("Participant invalid");if(r!==g.localUser.userId)return m.warn("[CircuitCallControlSvc]: Cannot unmute remote participant"),void n("Cannot unmute others");m.debug("[CircuitCallControlSvc]: Unmute participant in existing RTC session. userId =",r);var o={rtcSessionId:i.callId,usersIds:[r],muted:!1};D.muteParticipant(o,function(e){g.$apply(function(){e?(m.warn("[CircuitCallControlSvc]: Failed to unmute participant"),n("res_UnmuteParticipantFailed")):(i.remotelyMuted=!1,Et(i),n())})})},this.toggleMuteParticipant=function(e,t,n){if(n=n||function(){},!re(e))return m.warn("[CircuitCallControlSvc]: toggleMuteParticipant - There is no local call"),void n("Call invalid");t&&t.userId?t.muted?f.unmuteParticipant(e,t,n):f.muteParticipant(e,t,n):(m.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),n("Participant invalid"))},this.stopRingingTone=function(e){var t=Ue(e);t?(t.ringToneStopped=!0,m.debug("[CircuitCallControlSvc]: stopRingingTone for call with callId = ",e),h.publish("/call/ringingTone/stop",[e])):m.warn("[CircuitCallControlSvc]: stopRingingTone - incoming call not found: ",e)},this.endActiveCall=function(e){e=e||function(){},v?f.endCall(v.callId,e):e("No active call")},this.startRecording=function(t,e,n){if(!v)return m.warn("[CircuitCallControlSvc]: startRecording - There is no local call"),void t("No active call");var i;i="boolean"==typeof e?{audio:!0,video:e,text:!1}:e instanceof Object?e:{audio:!0,video:!0,text:!1},n=n||{layoutName:ht.RecordingVideoLayoutName.SINGLE,layoutMapping:[]};var r={convId:v.convId,rtcSessionId:v.callId,recordingMediaTypes:i,videoLayout:n};D.startRecording(r,function(e){g.$apply(function(){t&&t(e)})})},this.stopRecording=function(t,e){if(!v)return m.warn("[CircuitCallControlSvc]: stopRecording - There is no local event call"),void t("No active call");var n={convId:v.convId,rtcSessionId:v.callId,recordingMediaTypes:e||{audio:!0,video:!0,text:!1}};D.stopRecording(n,function(e){g.$apply(function(){t&&t(e)})})},this.startTranscription=function(){return new N(function(t,n){f.startRecording(function(e){e?(m.error("[CircuitCallControlSvc]: Failed to start transcription. ",e),n(e)):t()},{text:!0})})},this.stopTranscription=function(){return new N(function(t,n){f.stopRecording(function(e){e?(m.error("[CircuitCallControlSvc]: Failed to stop transcription. ",e),n(e)):t()},{text:!0})})},this.switchRecordingLayout=function(e,t){if(!v)return m.warn("[CircuitCallControlSvc]: switchRecordingLayout - There is no local call"),void t("No active call");if(!e||!e.layoutName)return m.warn("[CircuitCallControlSvc]: switchRecordingLayout - Missing or invalid videoLayout"),void t("Invalid videoLayout");var n={rtcSessionId:v.callId,videoLayout:e};D.switchRecordingLayout(n,function(e){g.$apply(function(){t&&t(e)})})},this.startRecordingParticipant=function(i){return new N(function(t,n){if(D.isParticipantRecordingSupported()||n("Not supported"),!v)return m.warn("[CircuitCallControlSvc]: startRecordingParticipant - There is no local call"),void n("No active call");var e={layoutName:ht.RecordingVideoLayoutName.SINGLE_VIDEO,layoutMapping:[{tileId:"Video",tileContent:i}]};v.recording.isActive()?(m.info("[CircuitCallControlSvc]: startRecordingParticipant - Switch layout to record userId = ",i),f.switchRecordingLayout(e,function(e){e?n(e):t()})):(m.info("[CircuitCallControlSvc]: startRecordingParticipant - Start recording call with focus on userId = ",i),f.startRecording(function(e){e?n(e):t()},{audio:!0,video:!0,text:!1},e))})},this.submitCallQualityRating=function(e,t,n){if(!e||!e.hasOwnProperty("rating")||!t)return m.warn("[CircuitCallControlSvc]: submitCallQualityRating - Missing rating or call data"),void(n&&n("No rating data"));Object.assign(e,t),D.submitCallQualityRating([e],function(e){g.$apply(function(){n&&n(e),e||(m.debug("[CircuitCallControlSvc]: Publish /call/rated event"),h.publish("/call/rated"))})})},this.raiseQuestion=function(e,t,n){if(!v||!v.isLarge)return m.warn("[CircuitCallControlSvc]: raiseQuestion - There is no local event call"),void n("No active event");var i={convId:v.convId,rtcSessionId:v.callId,question:e,displayName:g.localUser.displayName,isAnonymous:!!t};D.raiseQuestion(i,function(e,t){g.$apply(function(){n&&n(e,t)})})},this.inviteToStage=function(e,t){if(!v||!v.isLarge)return m.warn("[CircuitCallControlSvc]: inviteToStage - There is no local event call"),void t("No active event");var n={convId:v.convId,rtcSessionId:v.callId,questionNumber:e,allowedMediaTypes:[ht.RealtimeMediaType.AUDIO,ht.RealtimeMediaType.VIDEO,ht.RealtimeMediaType.DESKTOP_SHARING]};D.inviteToStage(n,function(e){g.$apply(function(){t&&t(e)})})},this.inviteToStageAnswer=function(t,n,i){if(!v||!v.isLarge)return m.warn("[CircuitCallControlSvc]: inviteToStageAnswer - There is no local event call"),void i("No active event");var e={convId:v.convId,rtcSessionId:v.callId,questionNumber:t,isAccepted:!!n};n&&V&&(m.debug("[CircuitCallControlSvc]: inviteToStageAnswer - force renewal of turn credentials"),V.expirationTimestamp=0),D.inviteToStageAnswer(e,function(e){g.$apply(function(){!e&&n?f.addAudio(v.callId,function(e){e?(m.debug("[CircuitCallControlSvc]: inviteToStageAnswer - Unable to access a microphone, sending decline"),f.inviteToStageAnswer(t,!1),e="res_AccessToAudioInputDeviceFailed"):f.unmuteLocally(),i&&i(e)}):i&&i(e)})})},this.inviteToStageCancel=function(e,t){if(!v||!v.isLarge)return m.warn("[CircuitCallControlSvc]: inviteToStageCancel - There is no local event call"),void t("No active event");var n={convId:v.convId,rtcSessionId:v.callId,questionNumber:e};D.inviteToStageCancel(n,function(e){g.$apply(function(){t&&t(e)})})},this.removeFromStage=function(e,t){if(!v||!v.isLarge)return m.warn("[CircuitCallControlSvc]: removeFromStage - There is no local event call"),void t("No active event");var n={convId:v.convId,rtcSessionId:v.callId,userToRemoveId:e||g.localUser.userId};D.removeFromStage(n,function(e){g.$apply(function(){t&&t(e)})})},this.getQuestions=function(e,t,n){if(!v||!v.isLarge)return m.warn("[CircuitCallControlSvc]: getQuestions - There is no local event call"),void n("No active event");var i={convId:v.convId,rtcSessionId:v.callId,startQuestionNumber:e,numberOfQuestions:t};D.getQuestions(i,function(e,t){g.$apply(function(){e?n(e):At(t).then(function(){n(null,t)})})})},this.updateQuestionState=function(e,t,n){if(!v||!v.isLarge)return m.warn("[CircuitCallControlSvc]: updateQuestionState - There is no local event call"),void n("No active event");var i={convId:v.convId,rtcSessionId:v.callId,questionNumber:e,newQuestionState:t};D.updateQuestionState(i,function(e,t){g.$apply(function(){n&&n(e,t)})})},this.openCurtain=function(t){if(!v||!v.isLarge)return m.warn("[CircuitCallControlSvc]: openCurtain - There is no local event call"),void t("No active event");var e={convId:v.convId,rtcSessionId:v.callId};D.openCurtain(e,function(e){g.$apply(function(){t&&t(e)})})},this.closeCurtain=function(e,t,n,i){if(!v||!v.isLarge)return m.warn("[CircuitCallControlSvc]: closeCurtain - There is no local event call"),void i("No active event");var r={curtainState:e};t&&(r.message=t),n&&(r.pauseDuration=n);var o={convId:v.convId,rtcSessionId:v.callId,curtain:r};D.closeCurtain(o,function(e){g.$apply(function(){i&&i(e)})})},this.getNodeState=function(e,t,n){var i={convId:"noCall",nodeType:e,tenantId:t||""};D.getNodeState(i,function(e,t){g.$apply(function(){e&&m.error("[CircuitCallControlSvc]: Failed to get node(s). ",e),n&&n(e,t)})})},this.canSendWebRTCDigits=function(){return v&&v.sessionCtrl.canSendDTMFDigits()},this.sendDigits=function(e,t,n){return n=n||function(){},re(e)?t?/^[\d#*,]+$/.exec(t)?void function(e,t,n){var i=re(e);if(!i)return m.info("[CircuitCallControlSvc]: sendDTMFDigits - The given call ID does not match the local call"),n("Invalid callId");m.info("[CircuitCallControlSvc]: Sending DTMF Digits. Num of digits: ",t&&t.length),i.sessionCtrl.sendDTMFDigits(t)?n():(m.error("[CircuitCallControlSvc]: Cannot send DTMF digits"),n("res_CannotSendDTMF"))}(e,t,n):(m.error("[CircuitCallControlSvc]: Digits cannot be sent: "+t+" (Allowed: 0-9,#,*)"),void n("res_InvalidDtmf")):void n("res_InvalidDtmf"):(m.warn("[CircuitCallControlSvc]: sendDigits - There is no local call"),void n("Call not valid"))},this.disableIncomingVideo=function(e){v&&v.sameAs(e)&&(m.debug("[CircuitCallControlSvc]: Disabling remote incoming video. Call ID=",v.callId),v.sessionCtrl.disableIncomingVideo())},this.enableIncomingVideo=function(e){v&&v.sameAs(e)&&(m.debug("[CircuitCallControlSvc]: Enabling remote incoming video. Call ID=",v.callId),v.sessionCtrl.enableIncomingVideo())},this.toggleParticipantPointer=function(e){var t=re(e);t?t.pointer&&t.pointer.isSupported?(t.pointer.isEnabled=!t.pointer.isEnabled,Re({callId:t.callId,transactionId:t.transactionId,mediaType:t.localMediaType})):m.warn("[CircuitCallControlSvc]: toggleParticipantPointer - Local call does not support participant pointer"):m.warn("[CircuitCallControlSvc]: toggleParticipantPointer - There is no local call")},this.findCall=oe,this.findLocalCallByCallId=re,this.findActivePhoneCall=se,this.findHeldPhoneCall=ce,this.sendParticipantPointer=function(e,t,n){var i={content:{type:"PARTICIPANT_POINTER",x:t,y:n,userId:g.localUser.userId},destUserId:e};r.sendDesktopAppRequest(i,function(e){e?m.error("[CircuitCallControlSvc]: Error sending participant pointer coordinates: ",e):m.info("[CircuitCallControlSvc]: Successfully sent participant pointer coordinates.")})},this.removeCallFromList=Z,this.isSecondCall=function(){return v||1<=M.length||!Bt.isEmptyArray(P)},this.updateActiveCallMediaDevices=function(){v&&v.updateMediaDevices()},this.addSimulatedParticipants=function(){var r=f.getActiveCall();if(r&&!r.isDirect&&r.isMocked&&!(0<r.participants.length)){var o=function(){r.isPresent()&&0!==r.participants.length&&(Ve(r,r.participants[0].userId),0<r.participants.length&&A(o,2500))},a=function(e){var t,n=ue((t={isSimulated:!0,userId:(5e4+e).toString(),mediaTypes:[ht.RealtimeMediaType.AUDIO],muted:!1},0<e&&!(e%6)?(t.participantType=ht.RTCParticipantType.MEETING_POINT,t.userDisplayName="CMR ("+e+")"):(t.participantType=ht.RTCParticipantType.SESSION_GUEST,t.userDisplayName=[Math.floor(e/10),e%10].join(" "),e%9||t.mediaTypes.push(ht.RealtimeMediaType.VIDEO)),t));!r.isMeetingPointInvited&&n.isCMP&&(n.isMeetingPointInvitee=!0,n.cmrData={},r.setMeetingPointInviteState(!0),dt(r.callId));var i=He(r,n,Dt.ParticipantState.Active);h.publish("/call/participant/added",[r.callId,i]),h.publish("/call/participant/joined",[r,i]),z(),e<19?A(function(){r.isPresent()&&a(e+1)},2500):A(o,12e4)};a(0),r.setState(Dt.CallState.Active),te(r)}},this.hasScreenControlFeature=$,this.canStartScreenShare=function(e){var t=re(e);if(!t)return m.warn("[CircuitCallControlSvc]: canStartScreenShare - There is no local call"),!1;if(!t.hasRemoteScreenShare())return!0;if(!t.participants.some(function(e){return e.isModerator&&e.mediaType&&e.mediaType.desktop}))return!0;if(g.isSessionGuest||t.isGuestInvite)return!1;var n=O.getConversationFromCache(t.convId);return!!n&&n.userIsModerator(g.localUser)},this.canStartRecording=function(e){if(g.isSessionGuest)return!1;var t=re(e),n=O.getConversationFromCache(t.convId);return t&&n?!(t.isDirect||t.isGuestInvite||t.moderatorLeftNotifyTime||!t.checkState([Dt.CallState.Active,Dt.CallState.Waiting])||n.isModerated&&!n.userIsModerator(g.localUser)):(m.warn("[CircuitCallControlSvc]: canStartRecording - Cannot find active call or conversation"),!1)},this.canTakeScreenshot=function(e,t){if(g.browser.msie)return!1;var n=re(e);return!!n&&(t.mediaType&&t.mediaType.desktop?!!(n.isDirect&&t.streamId||t.streams&&t.streams.desktop):!(!g.localUser.isICMixedUser&&!g.localUser.isICOnlyUser)&&(t===g.localUser&&n.localStreams.video||!!t.hasVideoStream&&t.hasVideoStream()))},this.addConferenceAsGuest=function(e){var t=Y(e);if(t&&t.isTemporary&&t.guestToken){m.debug("[CircuitCallControlSvc]: Create placeholder remote call for temporary guest conversation with convId = ",t.convId);var n=new Ut(t);n.setState(Dt.CallState.NotStarted),n.guestToken=t.guestToken,J(n),t.call=n,ee(t),te(n)}else m.warn("[CircuitCallControlSvc]: addConferenceAsGuest - No temporary conversation or guest token is missing")},this.removeConferenceAsGuest=function(e){var t=oe(e);if(t)if(t.isRemote){var n=Y(t.convId);n&&n.isTemporary?(ie(t),m.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),h.publish("/conversation/temporary/ended",[n])):m.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - No temporary conversation")}else m.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - Cannot remove temporary conversation with active call");else m.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - Could not find call")},this.testCandidatesCollection=function(e){return e?(m.debug("[CircuitCallControlSvc]: Test ICE candidates collection with TURN..."),new N(function(i,r){var o="echo_"+g.localUser.clientId,e={convId:g.isSessionGuest&&g.localUser.conversationId||o,rtcSessionId:o,ownerId:g.localUser.userId,isTelephonyConversation:!1,mediaNode:wt.mediaNode};m.debug("[CircuitCallControlSvc]: testIceCandidates - Get TURN servers"),D.prepareSession(e,function(e,t){if(e)return m.error("[CircuitCallControlSvc]: Failed to prepare session data. ",e),void r(e);if(!t||!t.length)return D.terminateRtcCall(o,ht.DisconnectCause.HANGUP),m.error("[CircuitCallControlSvc]: Failed to prepare session data. No TURN servers."),void r("No TURN servers");var n=t[0];m.debug("[CircuitCallControlSvc]: testIceCandidates - TURN servers: ",n.turnServer),We(n).then(function(e){D.terminateRtcCall(o,ht.DisconnectCause.HANGUP,function(){i(e)})}).catch(function(e){D.terminateRtcCall(o,ht.DisconnectCause.HANGUP,function(){r(e)})})})})):(m.debug("[CircuitCallControlSvc]: Test ICE candidates collection without TURN..."),We())},this.addCallToList=J,this.moveOsBizCalls=function(e,t){if(m.debug("[CircuitCallControlSvc]: Move oldCall: "+e.callId+" to newCall: "+t.callId),e.isOsBizFirstCall){var n=t.atcCallInfo;e.atcCallInfo=n,e.setPeerUser(e.atcCallInfo.peerDn,e.atcCallInfo.peerName),e.setCstaState(Dt.CstaCallState.Active),e.setState(Dt.CallState.Active),e.isOsBizFirstCall=!1,ie(t)}else ie(e),t.isOsBizFirstCall=!1,t.isOsBizSecondCall=!1},this.findOsBizFirstCall=function(){return I.find(function(e){return e.isOsBizFirstCall})||null},this.findOsBizSecondCall=function(){return I.find(function(e){return e.isOsBizSecondCall})||null},this.getCallToPickup=function(){return B},this.getConferenceParticipants=function(t){return new N(function(r,o){m.debug("[CircuitCallControlSvc]: Get participants for call with callId = ",t);var e=oe(t);return e?e.isRemote?void D.getSession(t,function(n,i){g.$apply(function(){if(n||!i)m.warn("[CircuitCallControlSvc] Error retrieving RTC session. Err: ",n),o(n);else{var e=i.participants.map(function(e){return ue(e)}),t=e.filter(function(e){return e.noData}).map(function(e){return e.userId});T.getUsersByIds(t,function(){r(e)})}})}):(m.warn("[CircuitCallControlSvc]: This is a local call. Return local participants."),void r(e.participants)):(m.warn("[CircuitCallControlSvc]: Call does not exist"),void o("Call does not exist"))})},this.mergeCalls=function(r,o){return new N(function(t,n){m.debug("[CircuitCallControlSvc]: Merge calls ",[r,o]);var e=oe(r),i=oe(o);if(!e||!i)return m.warn("[CircuitCallControlSvc]: Call does not exist"),void n("Call does not exist");D.mergeRtcCalls(r,o,function(e){e?(m.warn("[CircuitCallControlSvc]: Error merging calls. Err: ",e),n(e)):t()})})},this.changeInputDevices=function(e,t){var n=f.getActiveCall();return n&&n.callId===e?t&&(t.audio||t.video)?t.video||n.isVdi?new N(function(t,n){f.renegotiateMedia(e,function(e){e?n(e):t()})}):n.sessionCtrl.changeInputDevices(t):N.resolve():N.reject("Call not found")},this.setIncomingVideoStreams=function(e,t){var n=f.getActiveCall();if(n&&n.callId===e){if(f.isPinVideoSupported(e)){m.debug("[CircuitCallControlSvc]: Set video receiver configuration: ",t||"DEFAULT");var i=n.setIncomingVideoStreams(t);return i&&i.length?It(e,i):N.resolve()}return N.reject("Not supported")}return N.reject("Call not found")},this.isTranscriptionSupported=D.isTranscriptionSupported,this.updateScreenEnabledFeature=St,this.getNetworkQualityInfo=function(e){var t=re(e);if(t&&t.sessionCtrl){var n=t.sessionCtrl.getLastSavedStats();if(n.quality)return n.quality}return null},this.isPinVideoSupported=function(e){var t=e&&f.getActiveCall(e);return D.isPinVideoSupported()&&xt.unifiedPlanEnabled&&(!t||t.supportsVideoReceiverConfiguration())},this.isParticipantRecordingSupported=D.isParticipantRecordingSupported,this.isVideoPointerSupported=D.isVideoPointerSupported,this},vt}((Circuit=function(e){"use strict";var R=e.ClientApiHandlerSingleton,f=e.Constants,v=e.Proto,_=e.Utils,g=e.WebRTCAdapter,N=e.RtcSessionController;return e.DeviceDiagnosticSvcImpl=function(s,n,c,e,o){c.debug("New Service: DeviceDiagnosticSvc");var i=3e3,t=6e4,a=5e4,l=R.getInstance(),d=[],u=!(!o||s.isSessionGuest);function r(){if(u)if(0!==d.length){var n=JSON.stringify(d);if(n.length>t){c.warn("[DeviceDiagnosticSvc]: Stored device diagnostics exceeded max size. Discard old data.");var i="",r=n.length-a;d.some(function(e,t){return(i+=JSON.stringify(e)).length>r&&(c.warn("[DeviceDiagnosticSvc]: Number of discarded records: ",t+1),d.splice(0,t+1),n=JSON.stringify(d),!0)})}o.setString(o.keys.RTC_CLIENT_INFOS,n)}else o.removeItem(o.keys.RTC_CLIENT_INFOS)}function E(e){e&&e.joinDelayTimer&&(n.cancel(e.joinDelayTimer),e.joinDelayTimer=null)}function C(e){return!(!e||!e.deviceDiagnostics)&&(e.deviceDiagnostics.data.actionInfo.some(function(e){return!e.complete})||!e.deviceDiagnostics.iceGatheringFinished)}function T(e){if(e&&e.deviceDiagnostics){c.debug("[DeviceDiagnosticSvc]: Force finish device diagnostics");var t=e.deviceDiagnostics;E(t),t.joinDelayed&&I(e),p(e)}}function p(e){e&&e.deviceDiagnostics&&(c.debug("[DeviceDiagnosticSvc]: Clear device diagnostics"),E(e.deviceDiagnostics),delete e.deviceDiagnostics)}function S(e){u&&(c.debug("[DeviceDiagnosticSvc]: Store device diagnostics to send when client reconnects"),d.push(e),r())}function I(e){if(e&&e.deviceDiagnostics){var t={sdpOrigin:e.sdpOrigin||null,userId:s.localUser.userId,convId:e.convId,clientInfoType:f.RtcClientInfoType.DEVICE_DIAGNOSTICS,reason:f.RtcClientInfoReason.JOIN_DELAY,timestamp:Date.now(),sessionId:e.callId,deviceDiagnostics:_.shallowCopy(e.deviceDiagnostics.data)};e.instanceId&&(t.instanceId=e.instanceId),p(e),c.debug("[DeviceDiagnosticSvc]: Sending device diagnostics..."),l.sendClientInfo([t],function(e){e&&(c.debug("[DeviceDiagnosticSvc]: Failed to send device diagnostics. ",e),v.isOfflineFailure(e)&&S(t))})}else c.debug("[DeviceDiagnosticSvc]: sendDeviceDiagnostics - Nothing to send")}function A(e){if(!e||!e.label||"string"!=typeof e.label)return"";var t=e.label;return t.startsWith("res_")?s.i18n.localize(t)||"":t}return u&&e.subscribe("/conversations/loadComplete",function(){c.debug("[DeviceDiagnosticSvc]: Received /conversations/loadComplete event"),function(){if(0<d.length){var t=d;d=[],o.removeItem(o.keys.RTC_CLIENT_INFOS),c.info("[DeviceDiagnosticSvc]: Send offline join failures to backend"),l.sendClientInfo(t,function(e){e?(c.error("[DeviceDiagnosticSvc]: Failed to send offline join failures. ",e),v.isOfflineFailure(e)&&(Array.prototype.unshift.apply(d,t),r())):c.debug("[DeviceDiagnosticSvc]: Sent offline join failures")})}}()}),this.startDiagnostics=function(e){e&&!e.isRemote&&(c.info("[DeviceDiagnosticSvc]: Start diagnostics collection for callId = ",e.callId),e.deviceDiagnostics=e.deviceDiagnostics||{data:{actionInfo:[]}})},this.startJoinDelayTimer=function(e){if(e&&e.deviceDiagnostics){c.debug("[DeviceDiagnosticSvc]: Start join delay timer for callId = ",e.callId);var t=e.deviceDiagnostics;E(t),t.joinDelayTimer=n(function(){t.joinDelayTimer=null,function(e){if(!e||!e.deviceDiagnostics)return;var t=e.deviceDiagnostics;if(c.debug("[DeviceDiagnosticSvc]: Join action delayed, preparing device diagnostics"),E(t),t.joinDelayed=!0,"undefined"!=typeof DeviceStatistics){var n=DeviceStatistics.getStatistics();c.info("[DeviceDiagnosticSvc]: Received native device diagnostics: ",n),t.data.usedRAMApp=n.usedRAMApp,t.data.availableRAMApp=n.availableRAMApp,t.data.usedRAMDevice=n.usedRAMDevice,t.data.availableRAMDevice=n.availableRAMDevice,t.data.virtualMemory=n.virtualMemory,t.data.usagePerCore=n.usagePerCore,t.data.numberOfCores=n.numberOfCores,t.data.networkType=n.networkType}}(e)},i),t.joinDelayed=!1,t.waitingToSend=!1,t.iceGatheringFinished=!1,e.deviceDiagnostics=t}},this.createActionInfo=function(e,t){if(c.debug("[DeviceDiagnosticSvc]: Create action info ",t),!e||!e.deviceDiagnostics||!t)return null;var n={actionType:t};switch(t){case f.RtcDiagnosticsAction.SDP_ANSWER:case f.RtcDiagnosticsAction.SDP_CONNECTED:case f.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES:n.type=f.RtcActionInfoType.EVENT,n.timestampEvent=Date.now();break;default:n.type=f.RtcActionInfoType.REQUEST_RESPONSE,n.timestampRequest=Date.now()}return e.deviceDiagnostics.data.actionInfo.push(n),n},this.finishActionInfo=function(e,t){t&&(c.debug("[DeviceDiagnosticSvc]: Finish action info ",t.actionType),t.complete=!0,t.type===f.RtcActionInfoType.REQUEST_RESPONSE&&(t.timestampResponse=Date.now()),e&&e.deviceDiagnostics&&(t.isEndOfCandidates&&(e.deviceDiagnostics.iceGatheringFinished=!0,c.debug("[DeviceDiagnosticSvc]: Ice gathering finished")),e.deviceDiagnostics.waitingToSend&&!C(e)&&T(e)))},this.finishDeviceDiagnostics=function(e){if(e&&e.deviceDiagnostics){c.debug("[DeviceDiagnosticSvc]: Finish device diagnostics");var t=e.deviceDiagnostics;E(t),t.joinDelayed?C(e)?(t.waitingToSend=!0,c.debug("[DeviceDiagnosticSvc]: Send device diagnostic delayed")):I(e):p(e)}},this.forceFinishDeviceDiagnostics=T,this.storeClientInfo=S,this.sendCallConnected=function(o){c.debug("[DeviceDiagnosticSvc]: Send call connected event to backend");var a=("undefined"!=typeof DeviceStatistics?DeviceStatistics.getStatistics():null)||{};g.getMediaSources(function(e,t,n){var i=_.selectMediaDevice(e,N.recordingDevices);a.recordingDevice=A(i),i=_.selectMediaDevice(n,N.playbackDevices),a.playbackDevice=A(i),a.negotiationInfos=[];var r={sdpOrigin:o.sdpOrigin||null,userId:s.localUser.userId,convId:o.convId,clientInfoType:f.RtcClientInfoType.CALL_CONNECTED,reason:f.RtcClientInfoReason.CALL_CONNECTED,timestamp:Date.now(),sessionId:o.callId,deviceDiagnostics:a};l.sendClientInfo([r],function(e){e&&c.debug("[DeviceDiagnosticSvc]: Failed to send call connected event. ",e)})})},u&&(d=o.getObjectSync(o.keys.RTC_CLIENT_INFOS)||[],Array.isArray(d)||(d=[]),r()),this},e}((Circuit=function(X){"use strict";var z=X.Enums.AtcInfoMessage,J=X.Enums.AtcMessage,$=X.Enums.AtcRegistrationState,Z=X.ClientApiHandlerSingleton,ee=X.Constants,te=X.DefaultAvatars,ne=X.PhoneNumberFormatter,ie=X.RoutingOptions,re=X.UserToUserHandlerSingleton,oe=X.Utils;return X.AtcRegistrationSvcImpl=function(i,n,r,t,o,a){r.debug("New Service: AtcRegistrationSvc");var s,c=128,l=8,d=16,u=18e4,E=3e4,C={state:ee.TrunkState.DOWN,telephonyAvailableForTenant:!1,telephonyAvailableForUser:!1,conferenceDialOutAvailable:!1,phoneCallsAvailable:!1},T={cFC1:"pbxCallForwardToVoiceMailSupported",dND:"pbxDNDSupported",zCaOC:"pbxCampOnSupported",zPrfD:"pbxCallRoutingOptionsSupported"},p=Z.getInstance(),S=re.getInstance(),I={},A=$.Disconnected,R=!1,f=null,v={},_=null,g=l,N=null,m=null,h=Object.assign({},C),O=null,D=!1,P=null,y=!1;s=oe.isMobile()?ee.DeviceType.MOBILE:X.isElectron?ee.DeviceType.APPLICATION:ee.DeviceType.WEB;var b=!1,U=!1;function L(){_&&(n.cancel(_),_=null)}function M(){m&&(n.cancel(m),m=null)}function w(e){e!==A&&(A=e,r.info("[AtcRegistrationSvc]: Publish /atcRegistration/state event. State = ",e),t.publish("/atcRegistration/state",[e]),i.localUser.isRegisterTC&&e!==$.Registering&&Y(h))}function G(){return!!i.localUser.telephonyAvailable!=!!i.localUser.callerId}function H(){L(),r.info("[AtcRegistrationSvc]: Retry ATC registration in "+g+" seconds"),_=n(function(){_=null,g<c&&(g=Math.min(2*g,c)),V()},1e3*g)}function k(e){(function(e){return!!e&&(e===ee.ReturnCode.FAILED_TO_SEND||e===ee.ReturnCode.REQUEST_TIMEOUT||503===e.code||480===e.code||408===e.code)})(e)&&o.isRegistered()&&A===$.Registering&&H(),w($.Unregistered)}function V(){var e={content:{type:J.REGISTER,phoneNumber:i.localUser.registerNumber,reroutingPhoneNumber:i.localUser.isOsBizCTIEnabled?"":oe.cleanPhoneNumber(i.localUser.reroutingPhoneNumber),onsHash:i.localUser.onsSipAuthenticationHash||void 0,ondHash:i.localUser.ondSipAuthenticationHash||void 0,routeToDesk:i.localUser.selectedRoutingOption===ie.DeskPhone.name&&!i.localUser.callForwardingEnabled,tcPool:i.localUser.associatedTelephonyTrunkGroupId,pbxCallLog:!0,deviceType:s,userId:i.localUser.userId,conversationId:O.convId,rtcSessionId:O.rtcSessionId,lastItemTime:O.lastItemModificationTime,renewRegistration:b||void 0,sTC:i.localUser.isSTC||void 0},destUserId:i.localUser.associatedTelephonyUserID,keysToOmitFromLogging:["content.onsHash","content.ondHash"]};L(),I.phoneNumber=i.localUser.registerNumber,I.associatedTelephonyUserID=i.localUser.associatedTelephonyUserID,I.associatedTelephonyTrunkGroupId=i.localUser.associatedTelephonyTrunkGroupId,I.reroutingPhoneNumber=oe.cleanPhoneNumber(i.localUser.reroutingPhoneNumber),I.onsSipAuthenticationHash=i.localUser.onsSipAuthenticationHash,I.ondSipAuthenticationHash=i.localUser.ondSipAuthenticationHash,P=i.localUser.selectedRoutingOption,y=i.localUser.callForwardingEnabled,i.localUser.noCallLog=!1,w($.Registering),r.info("[AtcRegistrationSvc]: Registering with ATC, phoneNumber: "+I.phoneNumber+", associatedTelephonyUserID: "+I.associatedTelephonyUserID),S.sendAtcRequest(e,function(e,t){i.$apply(function(){if(R&&!O.call)return r.info("[AtcRegistrationSvc]: There was a configuration update while registering. Need to register again"),R=!1,void(e||!t||t.err?V():(D=!0,F()));if(e||t&&t.err)return e=e||t.err,r.error("[AtcRegistrationSvc]: Register with ATC failed with error: ",e),void k(e);if(t&&t.configurationData){if(r.info("[AtcRegistrationSvc]: Received ATC configuration data: ",t.configurationData),r.debug("[AtcRegistrationSvc]: Registration refresh will be handled by access server"),b=!1,i.localUser.isSTC)return w($.Registered),B(ee.TrunkState.UP),void(i.localUser.stcCapabilities=t.capabilities);g=l,I.configurationData=t.configurationData,I.reroutingPhoneNumber=t.configurationData.cell,I.capabilities=t.capabilities,i.localUser.reroutingPhoneNumber=ne.format(t.configurationData.cell),i.localUser.vmNumber=t.configurationData.vm,i.localUser.isOSV="OSV"===t.configurationData.pbx,i.localUser.isOS4K="OS4K"===t.configurationData.pbx,i.localUser.PBXCallLogSupported=I.capabilities&&I.capabilities.includes(ee.AtcCapabilities.PBX_CALL_LOG),function(n){Object.keys(T).forEach(function(e){var t=T[e];i.localUser[t]=!!n&&n.includes(e)})}(t.configurationData.supportedFeatures),w($.Registered),i.localUser.PBXCallLogSupported&&!i.localUser.noCallLog&&(function(e){var t={content:{type:J.INFO,phoneNumber:i.localUser.cstaNumber,info:{type:z.ENABLE_PBX_CALL_LOG,status:e}},destUserId:i.localUser.associatedTelephonyUserID};S.sendAtcRequest(t)}(!0),i.localUser.noCallLog=i.localUser.isOSV),B(ee.TrunkState.UP)}else w($.Unregistered)})})}function F(){if(r.info("[AtcRegistrationSvc]: Unregister with ATC"),L(),A!==$.Unregistered&&A!==$.Disconnected){var e={content:{type:J.UNREGISTER,phoneNumber:I.phoneNumber},destUserId:I.associatedTelephonyUserID};b=i.localUser.associatedTelephonyUserID!==I.associatedTelephonyUserID,I.associatedTelephonyUserID="",S.sendAtcRequest(e,function(e){i.$apply(function(){e?r.error("[AtcRegistrationSvc]: Unregister with ATC failed with: ",e):r.info("[AtcRegistrationSvc]: Unregistered successfully with ATC"),D&&(V(),D=!1)})}),w($.Unregistered)}else r.debug("[AtcRegistrationSvc]: The client is not registered with ATC")}function B(e){e!==N&&(N=e,r.debug("[AtcRegistrationSvc]: Set trunk state to ",N),h.state===N&&i.localUser.isRegisterTC||i.$apply(function(){x(Object.assign({},h,{state:N}))}))}function x(e){if(e){if(i.localUser.isRegisterTC)if(e.state===ee.TrunkState.DOWN)F(),g=c+oe.randomNumber(0,d),H();else if(h.state===ee.TrunkState.DOWN&&e.state===ee.TrunkState.UP)return h=e,A===$.Registering?(r.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(R=!0)):void function(){L();var e=oe.randomNumber(0,d);r.info("[AtcRegistrationSvc]: Delay ATC registration by "+e+" seconds"),_=n(function(){_=null,r.info("[AtcRegistrationSvc]: Retry timer has expired"),A===$.Unregistered?(g=l,V()):r.info("[AtcRegistrationSvc]: State is not Unregistered, so cancel new registration")},1e3*e)}();Y(e)}}function W(){r.info("[AtcRegistrationSvc]: Publish /telephony/data event. data = ",h),t.publish("/telephony/data",[Object.assign({},h),O,A])}function Y(e){var t;e&&(h=e,t=i.localUser.isRegisterTC&&a.telephonyConvId?(h.state=A===$.Registered?ee.TrunkState.UP:ee.TrunkState.DOWN,h.defaultCallerId=null,h.isGTCEnabled=!0,A===$.Registered):(h.defaultCallerId=h.defaultCallerId||null,h.state!==ee.TrunkState.DOWN&&N!==ee.TrunkState.DOWN),h.telephonyAvailableForTenant=!!h.isGTCEnabled,h.telephonyAvailableForUser=!(!h.isGTCEnabled||i.localUser.isICOnlyUser||!i.localUser.callerId&&!h.defaultCallerId),h.conferenceDialOutAvailable=h.telephonyAvailableForTenant&&t,h.phoneCallsAvailable=h.telephonyAvailableForUser&&t,h.telephonyAvailableForUser?a.getTelephonyConversationPromise().then(function(e){e.avatar=t?te.TELEPHONY:te.TELEPHONY_DISABLED,O=e,W()}).catch(function(e){r.error("[AtcRegistrationSvc]: Failed to retrieve telephony conversation. ",e),h.telephonyAvailableForUser=!1,h.conferenceDialOutAvailable=!1,h.phoneCallsAvailable=!1,W()}):W())}function K(){a.telephonyConvId?(r.info("[AtcRegistrationSvc]: Getting telephony data"),p.getTelephonyData(function(e,t){i.$apply(function(){e?e!==ee.ReturnCode.NO_RESULT&&(r.error("[AtcRegistrationSvc]: Error getting telephony data: ",e),Y(h)):x(t)})})):(r.info("[AtcRegistrationSvc]: There is no telephony conversation. Set telephony state to DOWN."),Y({state:ee.TrunkState.DOWN}))}function q(e){if(f&&f!==i.localUser.associatedTelephonyUserID&&(r.debug("[AtcRegistrationSvc]: Unsubscribe from previously associated TC presence"),v[f]||p.unsubscribePresence([f]),b=!(N=f=null)),i.localUser.associatedTelephonyUserID?f!==i.localUser.associatedTelephonyUserID&&(f=i.localUser.associatedTelephonyUserID,M(),i.localUser.isRegisterTC&&v[f]||p.subscribePresence([i.localUser.associatedTelephonyUserID],function(e,t){if(e)return r.warn("[AtcRegistrationSvc]: Unable to subscribe to associated TC presence"),void(f=null);t&&0<t.length&&!i.localUser.isRegisterTC&&B(t[0].state===ee.PresenceState.AVAILABLE?ee.TrunkState.UP:ee.TrunkState.DOWN)})):N=null,!i.localUser.isRegisterTC||!i.localUser.registerNumber)return r.debug("[AtcRegistrationSvc]: User is not associated with ATC or STC"),A===$.Registered?(F(),K()):(e||G())&&K(),void w($.Disconnected);if(y!==i.localUser.callForwardingEnabled&&(y=i.localUser.callForwardingEnabled,i.localUser.selectedRoutingOption===ie.DeskPhone.name&&j()),i.localUser.associatedTelephonyUserID!==I.associatedTelephonyUserID||i.localUser.registerNumber!==I.phoneNumber||i.localUser.onsSipAuthenticationHash!==I.onsSipAuthenticationHash||i.localUser.ondSipAuthenticationHash!==I.ondSipAuthenticationHash||A!==$.Registered&&A!==$.Registering||!i.localUser.isOsBizCTIEnabled&&oe.cleanPhoneNumber(i.localUser.reroutingPhoneNumber)!==I.reroutingPhoneNumber){if(A===$.Registering)return r.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(R=!0);if(A===$.Registered){if(r.debug("[AtcRegistrationSvc]: Client is already registered and configuration has changed."),O.call)return r.debug("[AtcRegistrationSvc]: There is an active telephony call, wait..."),void(R=!0);D=!0,F()}if(!D){if(!O)return r.debug("[AtcRegistrationSvc]: Get telephony conversation before proceeding with ATC register"),a.getTelephonyConversationPromise().then(function(e){O=e,r.debug("[AtcRegistrationSvc]: Got telephony conversation. Proceed with ATC register."),q()}).catch(function(){r.error("[AtcRegistrationSvc]: Failed to retrieve telephony conversation. Cannot register with ATC."),Y({state:ee.TrunkState.DOWN})}),void(!e&&G()&&K());A!==$.ForcedUnregistered&&V()}}else r.debug("[AtcRegistrationSvc]: Client is already registered or registering with ATC and the associatedTelephonyUserID is the same")}function j(){if(A===$.Registered){var e=i.localUser.selectedRoutingOption===ie.DeskPhone.name&&!i.localUser.callForwardingEnabled;r.debug("[AtcRegistrationSvc]: Send SET_ROUTE_TO_DESK event to ATC. status = ",e);var t={content:{type:J.INFO,phoneNumber:i.localUser.cstaNumber,info:{type:z.SET_ROUTE_TO_DESK,status:e}},destUserId:i.localUser.associatedTelephonyUserID};S.sendAtcRequest(t)}}function Q(t,e){M(),i.localUser.associatedTelephonyTrunkGroupId?(e=e||oe.randomNumber(E,u),r.debug("[AtcRegistrationSvc]: Renew associated telephony connector in "+e+" miliseconds"),m=n(function(){m=null,r.debug("[AtcRegistrationSvc]: Renew associated telephony connector"),p.renewAssociatedTelephonyUser(i.localUser.associatedTelephonyUserID,function(e){e&&(r.error("[AtcRegistrationSvc]: Failed to renew associated telephony connector. ",e),t&&Q(!0,u))})},e)):r.debug("[AtcRegistrationSvc]: User is not associated to any pool. Ignore the TC reassignment request.")}function e(){A===$.Registered?O.call&&!O.call.isRemote?r.info("[AtcRegistrationSvc]: There is an active call, ignoring ATC re-register for now. If error persists on server another event will come later."):i.$apply(function(){r.info("[AtcRegistrationSvc]: New registration must be triggered."),D=!0,F()}):r.info("[AtcRegistrationSvc]: Client is not registered, ignoring failed refresh on server.")}return t.subscribe("/localUser/telephonyConfigUpdated",function(){o.isRegistered()&&a.isConversationsLoadComplete()&&(r.debug("[AtcRegistrationSvc]: Received /localUser/telephonyConfigUpdated event"),q())}),t.subscribe("/conversations/loadComplete",function(){r.debug("[AtcRegistrationSvc]: Received /conversations/loadComplete event"),q(!0)}),t.subscribe("/registration/state",function(e){a.isConversationsLoadComplete()&&(r.debug("[AtcRegistrationSvc]: Received /registration/state event"),e!==RegistrationState.LoggingOut&&e!==RegistrationState.Reconnecting&&e!==RegistrationState.Disconnected||(L(),M(),n(i.localUser.isRegisterTC?F:function(){h.state=ee.TrunkState.DOWN,N=f=null,v={},Y(h)})))}),t.subscribe("/conversation/update",function(e){if(e.isTelephonyConv){if(r.debug("[AtcRegistrationSvc]: Received /conversation/update event"),O=e,!R&&!U)return;if(e.call)r.debug("[AtcRegistrationSvc]: There is still an active telephony call, wait...");else if(A!==$.Registering){if(U)return w($.ForcedUnregistered),void(U=!1);D=!(R=!1),F()}}}),t.subscribe("/user/settings/update",function(){a.isConversationsLoadComplete()&&(r.debug("[AtcRegistrationSvc]: Received /user/settings/update event"),P!==i.localUser.selectedRoutingOption&&(P=i.localUser.selectedRoutingOption,j()))}),p.on("User.TELEPHONY_DATA",function(e){i.$apply(function(){try{r.debug("[AtcRegistrationSvc]: Received User.TELEPHONY_DATA with data: ",e.data),e.data&&(e.data.isGTCEnabled=!0,x(e.data))}catch(e){r.error("[AtcRegistrationSvc]: Exception handling User.TELEPHONY_DATA event.",e)}})}),p.on("User.USER_PRESENCE_CHANGE",function(e){if(e.userId){if(e.userId===f)r.debug("[AtcRegistrationSvc]: Received User.USER_PRESENCE_CHANGE for associated TC. newState = ",e.newState),B(e.newState.state===ee.PresenceState.AVAILABLE?ee.TrunkState.UP:ee.TrunkState.DOWN);v[e.userId]&&(r.info("[AtcRegistrationSvc]: Publish /trunk/update event. newState = ",e.newState),t.publish("/trunk/update",[e.newState]))}}),p.on("User.ATC_REFRESH_FAILED",function(){r.error("[AtcRegistrationSvc]: Received User.ATC_REFRESH_FAILED event."),e()}),S.on("ATC.REFRESH_FAILED",function(){r.error("[AtcRegistrationSvc]: Received UserToUser.ATC.REFRESH_FAILED event."),e()}),p.on("Account.TC_START_REASSIGNMENT",function(e){r.debug("[AtcRegistrationSvc]: Account.TC_START_REASSIGNMENT event");var t=Math.max(e&&e.maxThrottlingTime||u,E);Q(!0,E+oe.randomNumber(0,t))}),S.on("ATC.INFO",function(e){r.debug("[AtcRegistrationSvc]: Received ATC.INFO with data = ",e),i.localUser&&e.hasOwnProperty("pbxCallLogStatus")&&(i.localUser.noCallLog=!!e.pbxCallLogStatus)}),S.on("ATC.START_REASSIGNMENT",function(){r.debug("[AtcRegistrationSvc]: Received ATC.START_REASSIGNMENT event"),Q(!1)}),S.on("ATC.UNREGISTERED",function(){r.error("[AtcRegistrationSvc]: Received UserToUser.ATC.UNREGISTERED event."),A===$.Registered?O.call&&!O.call.isRemote?(r.info("[AtcRegistrationSvc]: There is an active call, ignoring ATC Unregistered event for now."),U=!0):i.$apply(function(){w($.ForcedUnregistered)}):r.info("[AtcRegistrationSvc]: Client is not registered, ignoring Unregistered event.")}),this.initAtcForSdk=function(){r.debug("[AtcRegistrationSvc]: initAtcForSdk"),s=ee.DeviceType.SDK,q(!0)},this.atcState=function(){return A},this.getAtcRegistrationData=function(){return I.configurationData},this.atcUnregister=F,this.getTelephonyData=function(e){if(e)return"function"==typeof e&&(A===$.Registering?e("ATC Registering"):e(null,Object.assign({},h))),null;var t=A===$.Registering?C:h;return Object.assign({},t)},this.isExtendedAlertingSupported=function(){return!(!I||!I.capabilities)&&I.capabilities.includes(ee.AtcCapabilities.EXTENDED_ALERTING)},this.isClearConnectionBusySupported=function(){return!(!I||!I.capabilities)&&I.capabilities.includes(ee.AtcCapabilities.CLEAR_CONNECTION_BUSY)},this.subscribeConnectorPresence=function(e,n){(e=e.filter(function(e){return!v[e]})).length&&(r.debug("[AtcRegistrationSvc]: Subscribe for connectors presence. ",e),p.subscribePresence(e,function(e,t){i.$apply(function(){e?(r.error("[AtcRegistrationSvc]: Failed to subscribe to connectors presence. ",e),n&&n(e)):t&&(r.debug("[AtcRegistrationSvc]: Successfully subscribed for connectors presence"),t.forEach(function(e){v[e.userId]=!0}),n&&n(null,t))})}))},this.unsubscribeConnectorPresence=function(e,t){e?e=e.filter(function(e){return!!v[e]&&(delete v[e],e!==f)}):(e=Object.keys(v).filter(function(e){return e!==f}),v={}),e.length&&(r.debug("[AtcRegistrationSvc]: Unsubscribe for connectors presence. ",e),p.unsubscribePresence(e,t))},this.isPBXCallLogSupported=function(){return!(!I||!I.capabilities)&&I.capabilities.includes(ee.AtcCapabilities.PBX_CALL_LOG)},this},X}((Circuit=function(D){"use strict";var P=D.ChromeExtension,y=D.ExtensionConnHandlerSingleton,b=D.ScreenSharingController,U=D.Utils;return D.ExtensionSvcImpl=function(i,r,o,e,a,s,c,n){a.debug("New Service: ExtensionSvc");var l="circuitsandbox.net",d="beta.circuit.com",u="tandi.circuitsandbox.net",E="teams.univergeblue.com",C="bluebeta.circuit.com",T="https://chrome.google.com/webstore/detail/",p="https://microsoftedge.microsoft.com/addons/category/Edge-Extensions",t="1.2.1600",S=U.convertVersionToNumber(t),I="electron",A=Object.freeze({UNSUPPORTED_BROWSER:"UNSUPPORTED_BROWSER",UNSUPPORTED_EXT_VERSION:"UNSUPPORTED_EXT_VERSION",USER_CANCELLED_INSTALL:"USER_CANCELLED_INSTALL",INTERNAL_ERROR:"INTERNAL_ERROR"}),R=this,f="object"==typeof y?y.getInstance():null,v="",_=!0,g=D.isElectron?require("electron").ipcRenderer:null;function N(){var e="edge"===i.browser.subType?p:T;if("edge"===i.browser.subType)return a.info("[ExtensionSvc]: Set URL to Edge extension webstore link"),e;if(i.siemensAGUser)return e+="siemens-circuit-by-unify/mnkbplodbhpkiphfeldjmaoickanlanc",a.info("[ExtensionSvc]: Set URL to Siemens AG Circuit extension webstore link"),e;var t=n.getChromeExtensionId();return t?a.info("[ExtensionSvc]: Set URL using Extension ID set in global properties: ",t):(t=function(){var e;switch(o.location.hostname){case d:e="jafbhekoolndfieffjkikfbmekjppnec",a.info("[ExtensionSvc]: Set extension ID to Beta-Circuit extension: ",e);break;case l:e="ogdfpjnhdggplglemglldmioiblhkadm",a.info("[ExtensionSvc]: Set extension ID to Sandbox-Circuit extension: ",e);break;case u:e="gdgfgnopapmocggkadgfkjekdlcohmdl",a.info("[ExtensionSvc]: Set extension ID to T&I-Circuit extension: ",e);break;case E:case C:e="jhpcobccapenojpdohnfmhmdmppngdad",a.info("[ExtensionSvc]: Set extension ID to UNIVERGE BLUE TC extension: ",e);break;default:e="mhkbaognlahkdimlfcfhbeihldmjofgg",a.info("[ExtensionSvc]: Set extension ID to Circuit extension: ",e)}return e}(),a.info("[ExtensionSvc]: Set URL using Extension ID from host name: ",t)),e+=t}function m(e,t,n){return a.debug("[ExtensionSvc]: Invoke ExtensionConnHandler API: ",e),f?f.isExtensionRunning()?(n&&(t=t||[]).push(function(e,t){i.$apply(function(){n(e,t)})}),f[e].apply(f,t)):(a.debug("[ExtensionSvc]: Chrome extension is not running"),void(n&&r(function(){n("Extension not running")},0))):(a.debug("[ExtensionSvc]: ExtensionConnHandler is not loaded"),void(n&&r(function(){n("No ExtensionConnHandler")},0)))}function h(e){return i.browser&&i.browser.chrome?_?null:(a.warn("[ExtensionSvc]: We are running an outdated extension:",v),e&&c&&c.error({message:"res_UnsupportedExtensionVersion"}),A.UNSUPPORTED_EXT_VERSION):A.UNSUPPORTED_BROWSER}if(b&&b.injectExtensionSvc(this,f),f){f.addEventListener("extensionInitialized",function(e){i.$apply(function(){v=e.data.version,a.info("[ExtensionSvc]: Validate the installed extension version: ",v),v!==I&&((_=U.convertVersionToNumber(v)>=S)||a.warn("[ExtensionSvc]: The installed extension version ("+v+") is not supported. Minimum version is "+t)),_&&(i.isBrowserExtRunning=!0,a.setExtensionVersion(v),a.debug("[ExtensionSvc]: Publish /chromeExt/initialized event"),s.publish("/chromeExt/initialized"))})}),f.addEventListener("extensionUnregistered",function(){i.$apply(function(){i.isBrowserExtRunning=!1,a.debug("[ExtensionSvc]: Publish /chromeExt/unregistered event"),s.publish("/chromeExt/unregistered")})});var O=function(t,n){i.$apply(function(){var e=n.data&&n.data.data;a.debug("[ExtensionSvc]: Publish "+t+" event: ",e),s.publish(t,[e])})};f.addEventListener("headsetAppLaunched",O.bind(null,"/chromeExt/headsetAppLaunched")),f.addEventListener("headsetAppUninstalled",O.bind(null,"/chromeExt/headsetAppUninstalled")),f.addEventListener("webRTCIPHandlingPolicyChanged",O.bind(null,"/chromeExt/webRTCIPHandlingPolicyChanged"))}return this.isExtensionRunning=function(){return f&&f.isExtensionRunning()&&_},this.getExtensionVersion=function(){return v},this.isExtensionVersionSupported=function(){return _},this.installExtension=function(i){return new e(function(e,t){if(R.isExtensionRunning())e();else{if(!c)return a.error("[ExtensionSvc]: installExtension API requires PopupSvc"),void t(A.INTERNAL_ERROR);var n=h(i);if(n)t(n);else{c.confirm({message:"res_ActionInstallExtensionText",title:"res_ActionInstallExtensionTitle",yesLabel:"res_ActionInstall",noLabel:"res_Close",backdrop:!0}).result.then(function(){R.inlineInstallation(i).then(e).catch(t)}).catch(function(){t(A.USER_CANCELLED_INSTALL)})}}})},this.inlineInstallation=function(r){return new e(function(e,t){var n=h(r);if(n)t(n);else{var i=N();a.debug("[ExtensionSvc]: Open store link for ",i),o.open(i),e()}})},this.addEventListener=function(e,t){f&&f.addEventListener(e,t)},this.exchangeGetConnectionStatus=function(e,t){return m("exchangeGetConnectionStatus",[e],t)},this.exchangeConnect=function(e,t){return m("exchangeConnect",[e],t)},this.exchangeSearchContacts=function(e,t,n,i){return m("exchangeSearchContacts",[e,t,n],i)},this.exchangeGetCapabilities=function(e){return m("exchangeGetCapabilities",[],e)},this.exchangeAutodiscoverGetServer=function(e,t){return m("exchangeAutodiscoverGetServer",[e],t)},this.exchangeResolveContact=function(e,t,n){return m("exchangeResolveContact",[e,t],n)},this.exchangeGetContact=function(e,t,n){return m("exchangeGetContact",[e,t],n)},this.exchangeDisconnect=function(e){return m("exchangeDisconnect",[],e)},this.exchangeOnRenewedToken=function(e,t,n,i){return m("exchangeOnRenewedToken",[e,t,n],i)},this.storeExchCredentials=function(e,t){return m("exchangeStoreCredentials",[e],t)},this.getStoredCredentials=function(e,t){return m("getStoredCredentials",[e],t)},this.getAllPersonalContacts=function(e,t){return m("getAllPersonalContacts",[e],t)},this.syncAllPersonalContacts=function(e,t,n){return m("syncAllPersonalContacts",[e,t],n)},this.exchangeCancelReqCallback=function(e){return m("exchangeCancelReqCallback",[e])},this.getAppointments=function(e,t,n,i,r){return m("getAppointments",[e,t,n,i],r)},this.supportsGetAppointments=function(){return!(!i.localUser||!i.localUser.msExchangeEnabled)&&(!!R.isExtensionRunning()||!(!i.browser||!i.browser.chrome))},this.supportsExchangeAutodiscover=function(){return R.isExtensionRunning()},this.supportsExchangeAutodiscoverSvc=function(){return R.isExtensionRunning()},this.supportsExchangeAutodiscoverGetServer=function(){return v===I||1023300<=U.convertVersionToNumber(v)},this.supportsOOO=function(){return v===I||1022800<=U.convertVersionToNumber(v)},this.supportsUserAvailability=function(){return v===I||1025800<=U.convertVersionToNumber(v)},this.getOooMsg=function(e,t,n,i){R.supportsOOO()||i&&i(null,{response:P.ExchangeConnResponse.UNSUPPORTED_METHOD}),m("getOooMsg",[e,t,n],i)},this.getUserAvailability=function(e,t,n){R.supportsUserAvailability()||n&&n(null,{response:P.ExchangeConnResponse.UNSUPPORTED_METHOD}),m("getUserAvailability",[e,t],n)},this.launchHeadsetIntegrationApp=function(e,t,n){return m("launchHeadsetIntegrationApp",[e,t],n)},this.getHeadsetIntegrationAppStatus=function(e,t){return m("getHeadsetIntegrationAppStatus",[e],t)},this.restartHeadsetApp=function(e,t){return m("restartHeadsetApp",[e],t)},this.supportsPolicySettings=function(){return v===I||1023300<=U.convertVersionToNumber(v)},this.setIPHandlingPolicy=function(e,t,n){D.isElectron?(g.send("set-ip-handling-policy",e),n&&n(null)):m("setIPHandlingPolicy",[e,t],n)},this.getIPHandlingPolicy=function(n){"function"==typeof n&&(D.isElectron?(g.send("get-ip-handling-policy"),g.once("get-ip-handling-policy-response",function(e,t){i.$apply(function(){n(null,{value:t||null})})})):m("getIPHandlingPolicy",[],n))},this.bringToFront=function(e){D.isElectron?g.send("focus-window"):m("bringToFront",[],e)},this.getFileFromExtension=function(e,t,n){return m("getFile",[e,t],n)},i.isBrowserExtRunning=R.isExtensionRunning(),this},D}((Circuit=function(e){"use strict";var u=e.BaseCall,E=e.Utils;return e.PubSubSvcImpl=function(n){n.debug("New Service: PubSubSvc");var i={},r={},o={},a=[];function s(e,t){try{null==t?t=[]:Array.isArray(t)||(t=[t]),e.apply(null,t)}catch(e){n.error(e)}}function c(e,t,n){e[t]&&e[t].slice(0).forEach(function(e){s(e,n)})}function l(e,t,n){e[t]?e[t].includes(n)||e[t].push(n):e[t]=[n]}function d(e,t,n){if(e[t]){var i=e[t].indexOf(n);0<=i&&e[t].splice(i,1)}}return this.publish=function(e,t){(i[e]||r[e]||o[e]||a.length)&&(n.debug("[PubSubSvc]: Publishing "+e+" event"),c(i,e,t),function(e,t){r[e]&&(null==t?t=[]:Array.isArray(t)||(t=[t]),t=t.map(function(e){if(e&&"object"==typeof e){if(e.isConversationObject)return E.trimConvForMobile(e);if(e instanceof u)return E.trimCallForMobile(e)}return e}),r[e].slice(0).forEach(function(e){s(e,t)}))}(e,t),c(o,e,t),function(e,t){(t=t?Array.prototype.slice.call(t):[]).unshift(e),a.slice(0).forEach(function(e){s(e,t)})}(e,t),delete o[e])},this.subscribe=function(e,t){l(i,e,t)},this.unsubscribe=function(e,t){d(i,e,t)},this.subscribeOnce=function(e,t){l(o,e,t)},this.unsubscribeOnce=function(e,t){d(o,e,t)},this.subscribeMobile=function(e,t){l(r,e,t)},this.unsubscribeMobile=function(e,t){d(r,e,t)},this.subscribeAll=function(e){!function(e){a.includes(e)||a.push(e)}(e)},this.unsubscribeAll=function(e){!function(e){var t=a.indexOf(e);0<=t&&a.splice(t,1)}(e)},this.resetSubscriptions=function(){i={},r={},o={},a=[]},this},e}((Circuit=function(e){"use strict";var t=e.Utils,n={ACCESSIBILITY:"125328",AGC:"89415",DEVICE_ACCESS:"48742",JABRA:"112718",LOGIN:"37428",MODERATION:"93154",PLANTRONICS:"115017",SHORTCUTS:t.isMacOs?"144499":"144490",TELEPHONY:"103733"};return e.UtilSvcImpl=function(n,i,r,o){o.debug("New Service: UtilSvc");var a=this;return this.promisify=function(t,r){return function(){var e=Array.prototype.slice.call(arguments);return new i(function(n,i){e.push(function(e){if(e)i(e);else{var t=Array.prototype.slice.call(arguments);switch(t.shift(),t.length){case 0:n();break;case 1:n(t[0]);break;default:n(t)}}}),t.apply(r,e)})}},this.getFaqUrl=function(e){if(n.localUser){if(n.localUser.faqUrl&&t.DEFAULT_FAQ_URL!==n.localUser.faqUrl)return n.localUser.faqUrl+(e||"");if(n.localUser.helpUrl&&t.DEFAULT_HELP_URL!==n.localUser.helpUrl)return n.localUser.helpUrl}return"HELP"===e?t.DEFAULT_HELP_URL:t.DEFAULT_FAQ_URL+(e?"?articleId="+e:"")},this.isPartnerAdmin=function(e){return!(!n.localUser||!n.localUser.isPartnerAdmin)||(o.debug("[UtilSvc]: Cannot invoke request. Local user is not a partner admin."),e&&r(function(){e("Not partner admin")}),!1)},this.isTenantAdmin=function(e,t){return!!n.localUser&&(t&&t.tenantId!==n.localUser.tenantId?a.isPartnerAdmin(e):!!n.localUser.isTenantAdmin||(o.warn("[UtilSvc]: Local user is not a tenant admin"),e&&r(function(){e("Not tenant admin")}),!1))},this.hasOAuthAppChangeRights=function(){return!!n.localUser&&(!!n.localUser.hasDeveloperConsoleAccess||(o.warn("[UtilSvc]: Local user does not have rights for accessing the developer console"),!1))},this.hasOAuthAppViewRights=function(){return!!n.localUser&&(!!n.localUser.canViewDeveloperConsole||(o.warn("[UtilSvc]: Local user does not have rights for viewing the developer console."),!1))},this},e.Enums=e.Enums||{},e.Enums.FaqArticle=n,e}((Circuit=function(R){"use strict";var f=Object.freeze({Idle:"Idle",Active:"Active"});return R.Enums=R.Enums||{},R.Enums.IdleState=f,R.SdkHelperSvcImpl=function(i,e,r,o){var a,t=R.Enums.ConnectionState,n=R.Constants,s=R.Conversation,c=R.UserProfile,l=R.Utils,d=this,u={},E=null,C=R.ClientApiHandlerSingleton.getInstance(),T=[];function p(){return null}function S(){if(!i.localUser||!i.localUser.accounts||!i.localUser.accounts[0])return!1;var e=i.localUser,t=i.localUser.accounts[0],n=e.callerId;return t.telephonyConfiguration?(e.phoneNumber=t.telephonyConfiguration.phoneNumber||null,e.isATC?(e.callerId=t.telephonyConfiguration.phoneNumber,e.cstaNumber=l.cleanPhoneNumber(t.telephonyConfiguration.phoneNumber),e.registerNumber=e.cstaNumber,e.isRegisterTC=!0):e.isSTC?(e.callerId=t.telephonyConfiguration.phoneNumber,e.registerNumber=l.cleanPhoneNumber(t.telephonyConfiguration.phoneNumber),e.cstaNumber=null,e.isRegisterTC=!0):(e.callerId=t.telephonyConfiguration.callerId||e.phoneNumber||E,e.cstaNumber=null,e.registerNumber=null,e.isRegisterTC=!1)):(e.phoneNumber=null,e.callerId=E,e.cstaNumber=null,e.registerNumber=null,e.isRegisterTC=!1),n!==e.callerId}function I(){return new Promise(function(n,i){C.getTelephonyData(function(e,t){e?i(e):(E=t.defaultCallerId||null,n(t))})})}function A(){return new Promise(function(n,i){C.getTelephonyConversationId(function(e,t){e||!t?i("Telephony conversation not found"):d.getConversationById(t,null,function(e,t){e||!t?i(e||"Error retrieving telephony conversation"):((a=t).isTelephonyConv=!0,n(t))})})})}return o.subscribe("/telephony/data",function(e){var t=!1;E!==e.defaultCallerId&&(E=e.defaultCallerId,l.updateTelephonyNumbers(i.localUser,e.defaultCallerId)&&(t=!0)),i.localUser.telephonyAvailable!==e.telephonyAvailableForUser&&(i.localUser.telephonyAvailable=e.telephonyAvailableForUser,t=!0),t&&o.publish("/localUser/update",[i.localUser])}),C.on("Account.TELEPHONY_CONFIGURATION_UPDATED",function(e){if(e.configuration&&i.localUser){var t=i.localUser.accounts&&i.localUser.accounts[0];t&&(t.telephonyConfiguration=e.configuration,d.telephonyConfigChanged(),o.publish("/localUser/update",[i.localUser]))}}),this.addConversationToCache=function(e){e&&e.convId&&(u[e.convId]=s.extend(e))},this.setLocalUser=function(e){e&&(e.canUseHDVideo=e.hasPermission(Circuit.Enums.SystemPermission.HD_VIDEO),e.canUseHDScreenShare=e.hasPermission(Circuit.Enums.SystemPermission.HD_SCREENSHARE),i.localUser=e,c.syncTelephonyConfig(e),S())},this.telephonyConfigChanged=function(){S(),c.syncTelephonyConfig(i.localUser)},this.getConversationPromise=function(t){return new Promise(function(n,i){if(t){var e=u[t];e?n(e):d.getConversationById(t,null,function(e,t){e||!t?i("Conversation not found"):n(t)})}else i()})},this.getConversationById=function(e,t,i){"function"==typeof i&&C.getConversationById(e,function(e,t){var n=s.extend(t);n&&(u[t.convId]=n),i(e,n)})},this.getConversationByRtcSession=function(e){for(var t in r.debug("[SdkHelperSvc]: getConversationByRtcSession - rtcSessionId = ",e),u)if(u.hasOwnProperty(t)&&u[t].rtcSessionId===e)return u[t];return null},this.getConversationFromCache=function(e){return r.debug("[SdkHelperSvc]: getConversationFromCache - convId = ",e),u[e]||null},this.getConversationAsGuestById=function(t){return T.find(function(e){return e.convId===t})},this.getTelephonyData=I,this.getTelephonyConversationPromise=function(){return a?Promise.resolve(a):A()},this.getTelephonyConversation=function(t){if("function"==typeof t){if(a)return void window.setTimeout(function(){t(null,a)});I().then(S).then(A).then(function(e){t(null,e)}).catch(t)}},this.getCachedTelephonyConversation=function(){return a},this.isConversationsLoadComplete=function(){return!!i.localUser},this.updateLastCallTime=function(){},this.createConversationAsGuest=function(n){var e=s.extend({convId:n.convId,type:n.type,topic:n.topic,rtcSessionId:n.rtcSessionId,creatorId:n.creatorId,participants:[{userId:i.localUser.userId}],creatorTenantId:n.creatorTenantId||i.localUser.tenantId,isTemporary:!0,creationTime:n.creationTime||Date.now()});return T.some(function(e,t){return e.convId===n.convId&&(T.splice(t,1),!0)}),T.push(e),r.debug("[SDK]: Created temporary (as guest) conversation for session:",e.rtcSessionId),setTimeout(function(){n.isExtended?(r.debug("[SDK]: Publish /conversation/navigate/reload event"),o.publish("/conversation/navigate/reload",[e])):(r.debug("[SDK]: Publish /conversation/new event"),o.publish("/conversation/new",[e]))}),e},this.createConversationAsGuestFromSummary=function(e){return new Promise(function(n,i){e?C.getConversationSummary(e,null,function(e,t){e?i("[SDK] getConversationSummary request failed"):n(d.createConversationAsGuest(t))}):i("convId is required")})},this.sendQOSData=function(e,t,n){r.debug("[SdkHelperSvc]: sendQOSData - call stats: ",n)},this.state=function(){switch(C.getConnState()){case t.Disconnected:return"Disconnected";case t.Connecting:return"Connecting";case t.Reconnecting:return"Reconnecting";case t.Connected:return"Registered";default:return""}},this.isRegistered=function(){return C.getConnState()===t.Connected},this.getSetting=function(){return null},this.getUserIdleState=function(){return f.Active},this.isAutoSnoozeOn=!1,this.setPresenceWithLocation=function(){},this.startAutoSnooze=function(){},this.cancelAutoSnooze=function(){},this.snooze=function(){},this.resume=function(){},this.getUserFromCache=p,this.getUser=p,this.getUserById=function(e,t){t&&t(n.ReturnCode.NO_RESULT)},this.addUsersToCache=function(){},this.startReverseLookUp=function(e,t){t&&t(null)},this},R}((Circuit=function(t){"use strict";return t.Enums.SystemPermission=t.Constants.SystemPermission,t.Enums.DeviceType=t.Constants.DeviceType,t.Enums.CallStateName={},Object.getOwnPropertyNames(t.Enums.CallState).forEach(function(e){t.Enums.CallStateName[e]=e}),t.Enums.ConversationItemType=t.Constants.ConversationItemType,t.Enums.ConversationType={DIRECT:"DIRECT",GROUP:"GROUP",LARGE:"LARGE",COMMUNITY:"COMMUNITY"},t.Enums.PresenceState=t.Constants.PresenceState,t.Enums.RTCItemType=t.Constants.RTCItemType,t.Enums.RTCParticipantType=t.Constants.RTCParticipantType,t.Enums.SystemItemType=t.Constants.SystemItemType,t.Enums.TextItemContentType=t.Constants.TextItemContentType,t.Enums.UserBusyHandlingOptions=t.Constants.UserBusyHandlingOptions,t.Enums.UserType=t.Constants.UserType,t.Enums.UserState=t.Constants.UserState,t.Enums.SearchDirection=t.Constants.SearchDirection,t.Enums.ParticipantCriteria=t.Constants.GetConversationParticipantCriteria,t.Enums.ConversationParticipantType=t.Constants.ConversationParticipantType,t.Enums.RetrieveAction=t.Constants.RetrieveAction,t.Enums.RecordingInfoState=t.Constants.RecordingInfoState,t.Enums.RecordingInfoState=t.Constants.RecordingInfoState,t.Enums.SearchScope=t.Constants.SearchScope,t.Enums.SearchStatusCode=t.Constants.SearchStatusCode,t.Enums.SessionClosedReason=t.Constants.SessionClosedReason,t.Enums.GetAccountsFilterCriteria=t.Constants.GetAccountsFilterCriteria,t.Enums.AccountStatus=t.Constants.AccountStatus,t.Enums.GetAccountsSorting=t.Constants.GetAccountsSorting,t.Enums.SortOrder=t.Constants.SortOrder,t.Enums.SearchContext=t.Constants.SearchContext,t.Enums.Locale=t.Constants.Locale,t.Enums.VideoResolution={VGA:"VGA",HD:"HD",FHD:"FHD",NONE:"NONE"},t.Enums.FormControlType=t.Constants.CPaaSFormMetaDataControlType,t.Enums.RecordingVideoLayoutName=t.Constants.RecordingVideoLayoutName,t.Enums.JournalFilter=t.Constants.JournalFilter,t}((Circuit=function(e){"use strict";var t;return e.ExtensionConnHandlerSingleton={getInstance:function(){return t||(t=new e.ExtensionConnHandler),t}},e}((Circuit=function(p){"use strict";var e=p.BaseEventTarget,S=p.ChromeExtension,I=p.logger,A=p.Utils;function R(){R.parent.constructor.call(this,I);var o,a,s=5e3,c=65e3,r=this,l={},d=0,n=!1,e=window.BgExchangeConnectorHandler;if(p.isElectron){if(e){a=e.getInstance();var u=function(e){e.data&&e.data.keysToOmitFromLogging&&(e.keysToOmitFromLogging=e.data.keysToOmitFromLogging.map(function(e){return"data."+e}),delete e.data.keysToOmitFromLogging),t(e)};o=Object.create(I,{sendResponse:{value:function(e,t,n){var i={type:S.BgMsgType.RESPONSE,reqId:e,suppressLog:!!n,data:t};u(i)}},sendInternalEvent:{value:function(e){I.error("[ExtensionConnHandler]: Unexpected internal event: ",e)}},sendExchangeConnEvent:{value:function(e,t){var n={type:S.BgMsgType.EVENT,target:S.BgTarget.EXCHANGE_CONNECTOR,suppressLog:!!t,data:e};u(n)}}});var i="exchange";window.chrome={storage:{local:{set:function(e,t){window.localStorage.setItem(i,JSON.stringify(e,function(e,t){if("string"!=typeof e||"$"!==e.charAt(0))return t})),t&&t()},get:function(e,t){t&&t(JSON.parse(window.localStorage.getItem(i)))},clear:function(e){window.localStorage.removeItem(i),e&&e()}}},runtime:{},windows:{create:function(){}},permissions:{contains:function(e,t){t(!0)}}}}setTimeout(function(){I.info("[ExtensionConnHandler]: Raise extensionInitialized"),n=!0;var e=r.createEvent("extensionInitialized");e.data={version:"electron"},r.dispatch(e)},1e3)}function E(e,t){I.info("[ExtensionConnHandler]: Dispatching event: ",e);var n=r.createEvent(e);n.data=t,r.dispatch(n)}function C(e,t,n,i){return e?r.isExtensionRunning()?function(e,t,n,i){e.type===S.BgMsgType.REQUEST&&(e.reqId=function(e,t){e=e||function(){};var n=++d,i=window.setTimeout(function(){l[n]&&(I.error("[ExtensionConnHandler]: Timeout waiting for response. reqId:",n),delete l[n],e(S.ResponseError.TIMEOUT))},t||s);return l[n]={cb:e,timer:i},n}(t,n));i||I.msgSend("[ExtensionConnHandler]: ",e);if(e.suppressLog=i,p.isElectron&&a&&e.type===S.BgMsgType.REQUEST&&e.target===S.BgTarget.EXCHANGE_CONNECTOR)return window.setTimeout(function(){a.onWebClientMsg(o,e,p.__server)},0),e.reqId;var r=new CustomEvent(S.DOMEvent.TO_EXTENSION,{detail:JSON.stringify(e)});try{document&&document.dispatchEvent(r)}catch(e){return I.warning("[ExtensionConnHandler]: Error sending message: "+r,e),!1}return e.reqId}(e,t,n,i):(I.info("[ExtensionConnHandler]: Chrome extension is not running"),t&&window.setTimeout(function(){t("Extension not running")},0),!1):(I.error("[ExtensionConnHandler]: Cannot send message. Invalid message."),t&&window.setTimeout(function(){t("Invalid message")},0),!1)}function T(){I.warning("[ExtensionConnHandler]: The content script has unregistered itself. Chrome extension is no longer running."),n=!1,I.info("[ExtensionConnHandler]: Dispatching event: extensionUnregistered");var e=r.createEvent("extensionUnregistered");r.dispatch(e)}function t(e){if(e.target!==S.BgTarget.LOG)switch(e.suppressLog||I.msgRcvd("[ExtensionConnHandler]: ",e),e.type){case S.BgMsgType.REQUEST:case S.BgMsgType.EVENT:!function(e){switch(e.target){case S.BgTarget.INTERNAL:switch(e.data.type){case S.BgInternalMsgType.INIT_MSG:I.info("[ExtensionConnHandler]: Received INIT_MSG. Send an INIT_MSG_ACK to the extension."),n=!0,C({target:S.BgTarget.INTERNAL,data:{type:S.BgInternalMsgType.INIT_MSG_ACK}}),E("extensionInitialized",e.data);break;case S.BgInternalMsgType.EXTENSION_DISCONNECTED:I.warning("[ExtensionConnHandler]: Received EXTENSION_DISCONNECTED from ansible-content"),T();break;default:I.warning("[ExtensionConnHandler]: Received unknown INTERNAL msg type:",e.data.type)}break;case S.BgTarget.HEADSET_APP:switch(e.data.type){case S.BgHeadsetAppMsgType.HEADSET_APP_LAUNCHED:E("headsetAppLaunched",e.data);break;case S.BgHeadsetAppMsgType.HEADSET_APP_UNINSTALLED:E("headsetAppUninstalled",e.data);break;default:I.warning("[ExtensionConnHandler]: Received unknown HEADSET_APP msg type:",e.data.type)}break;case S.BgTarget.PRIVACY_SETTINGS:e.data.type===S.BgPrivacySettingsMsgType.IP_HANDLING_POLICY_CHANGED?E("webRTCIPHandlingPolicyChanged",e.data):I.warning("[ExtensionConnHandler]: Received unknown PRIVACY_SETTINGS msg type:",e.data.type);break;default:e.suppressLog||I.info("[ExtensionConnHandler]: Dispatching event:",e.target);var t=r.createEvent(e.target);t.data=e.data,t.suppressLog=e.suppressLog,e.reqId&&e.type===S.BgMsgType.REQUEST&&(t.reqId=e.reqId),r.dispatch(t)}}(e);break;case S.BgMsgType.RESPONSE:!function(e){if(l[e.reqId]){var t=l[e.reqId];t.timer&&window.clearTimeout(t.timer),delete l[e.reqId],e.data&&e.data.error?(t.cb(e.data.error),e.data.error===S.ResponseError.UNREGISTERED&&T()):t.cb(null,e.data),e.suppressLog||I.debug("[ExtensionConnHandler]: Remaining callbacks pending:",Object.keys(l).length)}else I.info("[ExtensionConnHandler]: No registered callback for reqId =",e.reqId)}(e);break;default:I.msgRcvd("[ExtensionConnHandler]: Unexpected message type: ",e.type)}else I.logMsg(e.data.log.level,e.data.log.messages)}this.isExtensionRunning=function(){return n},this.getScreenShareUserMedia=function(e){C({target:S.BgTarget.SCREEN_SHARE,type:S.BgMsgType.REQUEST,data:{type:S.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA}},e)},this.exchangeConnect=function(e,t){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.CONNECT,object:{settings:e}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},t,18e4)},this.exchangeDisconnect=function(e){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.DISCONNECT,object:{}}},e,c)},this.exchangeGetConnectionStatus=function(e,t){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_CONNECTION_STATUS},keysToOmitFromLogging:["data.key"]},t,c)},this.exchangeGetCapabilities=function(e){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.GET_CAPABILITIES}},e,c)},this.exchangeAutodiscoverGetServer=function(e,t){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.AUTODISCOVER_GET_SERVER,object:{settings:e}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},t,c)},this.exchangeCancelReqCallback=function(e){return I.debug("[ExtensionConnHandler]: Unregistering callback for reqId:",e),function(e){return!(!e||!l[e])&&(delete l[e],!0)}(e)},this.exchangeSearchContacts=function(e,t,n,i){return C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.SEARCH_CONTACTS,object:{searchString:t,resultCount:n}},keysToOmitFromLogging:["data.key"]},i,c)},this.exchangeResolveContact=function(e,t,n){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.RESOLVE_CONTACT,object:t},keysToOmitFromLogging:["data.key"]},n,c)},this.exchangeGetContact=function(e,t,n){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_CONTACT,object:{email:t}},keysToOmitFromLogging:["data.key"]},n,c)},this.exchangeOnRenewedToken=function(e,t,n,i){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.RESPONSE,data:{key:e,method:S.BgExchangeMsgType.ON_RENEWED_TOKEN,object:{reqId:t,token:n}},keysToOmitFromLogging:["data.key","data.object.token"]},i,c)},this.exchangeStoreCredentials=function(e,t){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.STORE_EXCH_CREDENTIALS,object:e},keysToOmitFromLogging:["data.object"]},t,c)},this.getAllPersonalContacts=function(e,t){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_ALL_PERSONAL_CONTACTS},keysToOmitFromLogging:["data.key"]},t,c)},this.getAppointments=function(e,t,n,i,r){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_APPOINTMENTS,startDate:t,endDate:n,resCount:i},keysToOmitFromLogging:["data.key"]},r,c)},this.syncAllPersonalContacts=function(e,t,n){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.SYNC_ALL_PERSONAL_CONTACTS,syncState:t},keysToOmitFromLogging:["data.key","data.syncState"]},n,c)},this.getStoredCredentials=function(e,t){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_STORED_CREDENTIALS},keysToOmitFromLogging:["data.key"]},t,c)},this.getOooMsg=function(e,t,n,i){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_OOO_MSG,fromEmail:t,email:n},keysToOmitFromLogging:["data.key"]},i,c)},this.getUserAvailability=function(e,t,n){C({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_USER_AVAILABILITY,email:t},keysToOmitFromLogging:["data.key","data.email"]},n,c)},this.getHeadsetIntegrationAppStatus=function(e,t){"function"==typeof t&&(p.isElectron?window.setTimeout(function(){I.debug("[ExtensionConnHandler]: Return status INSTALLED for desktop app"),t(null,{status:S.HeadsetAppStatus.INSTALLED})},0):C({target:S.BgTarget.HEADSET_APP,type:S.BgMsgType.REQUEST,data:{type:S.BgHeadsetAppMsgType.GET_HEADSET_APP_STATUS,appId:e}},t))},this.launchHeadsetIntegrationApp=function(e,t,n){C({target:S.BgTarget.HEADSET_APP,type:S.BgMsgType.REQUEST,data:{type:S.BgHeadsetAppMsgType.LAUNCH_HEADSET_APP,appId:e,localizedStrings:t}},n,18e4)},this.restartHeadsetApp=function(e,t){C({target:S.BgTarget.HEADSET_APP,type:S.BgMsgType.REQUEST,data:{type:S.BgHeadsetAppMsgType.RESTART_HEADSET_APP,appId:e}},t)},this.setIPHandlingPolicy=function(e,t,n){C({target:S.BgTarget.PRIVACY_SETTINGS,type:S.BgMsgType.REQUEST,data:{type:S.BgPrivacySettingsMsgType.SET_IP_HANDLING_POLICY,policy:e,localizedStrings:t}},n,18e4)},this.getIPHandlingPolicy=function(e){C({target:S.BgTarget.PRIVACY_SETTINGS,type:S.BgMsgType.REQUEST,data:{type:S.BgPrivacySettingsMsgType.GET_IP_HANDLING_POLICY}},e)},this.bringToFront=function(e){C({target:S.BgTarget.INTERNAL,type:S.BgMsgType.REQUEST,data:{type:S.BgInternalMsgType.BRING_TO_FRONT}},e)},this.getFile=function(e,t,n){C({target:S.BgTarget.INTERNAL,type:S.BgMsgType.REQUEST,data:{type:S.BgInternalMsgType.GET_FILE,name:e,lang:t}},n)},A.getBrowserInfo().chrome&&document&&document.addEventListener(S.DOMEvent.FROM_EXTENSION,function(e){if(e&&e.detail)try{t(JSON.parse(e.detail))}catch(e){I.error("[ExtensionConnHandler]: Error parsing JSON object. ",e)}})}return A.inherit(R,e),R.prototype.name="ExtensionConnHandler",p.ExtensionConnHandler=R,p}((Circuit=function(e){"use strict";var l=Circuit.logger;return e.CstaParser=function(){function r(e){var t=null;return e&&e.extn&&e.extn.pDa&&e.extn.pDa.prvt&&(t=e.extn.pDa.prvt.zEpid),t}function n(t){t&&Object.keys(t).forEach(function(e){t[e]=""===t[e]||"true"===t[e]})}function o(e){if(!e)return{};var t={};return e.sP&&(t.rSP=e.sP,n(t.rSP.cCSs)),e.extn&&e.extn.pDa&&e.extn.pDa.prvt&&void 0!==e.extn.pDa.prvt.zxSP&&(t.eSP=e.extn.pDa.prvt.zxSP,n(t.eSP)),t}function i(e){return{forwardingType:e.fTe,forwardStatus:"true"===e.fS,forwardDN:e.fDNN}}function a(e){return{name:e.zgNM,pilotDn:e.zgDN,available:"false"===e.zMB}}function s(e){if(e.extn&&e.extn.pDa&&e.extn.pDa.prvt){var t=[];if(e.extn.pDa.prvt.zeMBSL)return Array.isArray(e.extn.pDa.prvt.zeMBSL.zeMBS)?e.extn.pDa.prvt.zeMBSL.zeMBS.forEach(function(e){t.push(a(e))}):t.push(a(e.extn.pDa.prvt.zeMBSL.zeMBS)),t}return null}function c(e){return{recordId:e.rID,callID:e.cID,recordType:e.rTp,createdTime:e.cTm,result:e.res,callDuration:e.cDr,callingDevice:e.clDv||"",calledDevice:e.cldDv||"",answeringDevice:e.aDv||""}}this.genCstaRequest=function(e){try{switch(e.request){case"AlternateCall":return function(e){return{ACl:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID,dID:e.activeCall.dID}}}}(e);case"ConferenceCall":return function(e){return{CoC:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID,dID:e.activeCall.dID}}}}(e);case"AnswerCall":return function(e){return{AnC:{cTBAd:{cID:e.callToBeAnswered.cID,dID:e.callToBeAnswered.dID}}}}(e);case"CallBackCallRelated":return function(e){return{CB:{cC:{cID:e.callBackConnection.cID,dID:e.callBackConnection.dID}}}}(e);case"CallBackNonCallRelated":return function(e){return{CBNC:{orD:e.orD,tD:e.tD}}}(e);case"CancelCallBack":return function(e){return{CCB:{orD:e.orD,tD:e.tD}}}(e);case"ClearConnection":return function(e){return{CCn:{coTBC:{cID:e.connectionToBeCleared.cID,dID:e.connectionToBeCleared.dID},rsn:e.reason}}}(e);case"ConsultationCall":return function(e){return{CnC:{cnD:e.consultedDevice||void 0,eCl:{cID:e.existingCall.cID,dID:e.existingCall.dID}}}}(e);case"DeflectCall":return function(e){var t={cTBD:{cID:e.callToBeDiverted.cID,dID:e.callToBeDiverted.dID},nD:e.newDestination};e.autoAnswer&&(t.extn={pDa:{prvt:{zdT:"Auto-Answer"}}});return{DCl:t}}(e);case"GenerateDigits":return function(e){return{GD:{cTSD:{cID:e.connectionToSendDigits.cID,dID:e.connectionToSendDigits.dID},cTS:e.charactersToSend}}}(e);case"GetDoNotDisturb":return function(e){return{GDND:{dvc:e.device}}}(e);case"GetForwarding":return function(e){return{GF:{dvc:e.device}}}(e);case"GetMessageWaitingIndicator":return function(e){return{GMWI:{dvc:e.device}}}(e);case"HoldCall":return function(e){var t={cTBH:{cID:e.callToBeHeld.cID,dID:e.callToBeHeld.dID}};e.holdOptions&&(t.extn={zhOs:e.holdOptions});return{HC:t}}(e);case"ReconnectCall":return function(e){return{RC:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID||void 0,dID:e.activeCall.dID||void 0}}}}(e);case"RetrieveCall":return function(e){return{RCl:{cTBRd:{cID:e.callToBeRetrieved.cID,dID:e.callToBeRetrieved.dID}}}}(e);case"SetBusy":return function(e){return{zSBN:{dvc:e.device,zbO:e.busyState}}}(e);case"SetDoNotDisturb":return function(e){return{SDND:{dvc:e.device,dNDO:e.doNotDisturbOn}}}(e);case"SetForwarding":return function(e){var t={SF:{dvc:e.device,aF:e.activateForward,fDNN:e.forwardDN,fTe:e.forwardingType,riC:e.ringCount}},n={};void 0!==e.staticOndActive?n={zsOA:!0===e.staticOndActive?"true":"false",zsOD:e.staticOndDN||""}:void 0!==e.voicemailActive||void 0!==e.voicemailRingDuration?n={zvMA:"boolean"==typeof e.voicemailActive?e.voicemailActive.toString():void 0,zvMRD:e.voicemailRingDuration?e.voicemailRingDuration.toString():void 0}:(void 0!==e.mainRingDuration&&(n.zmRD=e.mainRingDuration.toString()||""),void 0!==e.clientRingDuration&&(n.zcRD=e.clientRingDuration.toString()||""),void 0!==e.cellRingDuration&&(n.zcpRD=e.cellRingDuration.toString()||""),void 0!==e.alternativeNumber&&(n.zcPN=e.alternativeNumber),void 0!==e.routeToCell&&(n.zrTCN=e.routeToCell?"true":"false"));0<Object.keys(n).length&&(t.SF.extn={pDa:{prvt:n}});return t}(e);case"SingleStepTransferCall":return function(e){var t={atC:{cID:e.activeCall.cID,dID:e.activeCall.dID},tTo:e.transferredTo};if(e.autoAnswer||e.seamlessHandover){var n={};e.autoAnswer&&(n.ztTgt="Auto-Answer"),e.seamlessHandover&&(n.zseHo="true"),t.extn={pDa:{prvt:n}}}return{SSTC:t}}(e);case"SnapshotCall":return function(e){return{SC:{sO:{cID:e.snapshotObject.cID,dID:e.snapshotObject.dID}}}}(e);case"SnapshotDevice":return function(e){var t={sO:e.snapshotObject};e.osmo&&(t.extn={pDa:{prvt:{zxsm:e.osmo}}});return{SDe:t}}(e);case"TransferCall":return function(e){return{TC:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID,dID:e.activeCall.dID}}}}(e);case"GenGetConfiguration":return{zGCD:{zcCA:"Internet",zdMO:"Chrome",zdOS:"WebRTC"}};case"SetMicrophoneMute":return function(e){return{SMM:{dvc:e.device,mMO:e.mute}}}(e);case"GetMicrophoneMute":return function(e){return{GMM:{dvc:e.device}}}(e);case"MakeCall":return function(e){return{MC:{caD:e.callingDevice,cDN:e.calledDirectoryNumber,aOe:e.autoOriginate}}}(e);case"CallLogSnapShot":return function(e){return{CLS:{sub:e.device}}}(e);case"AcceptCall":return function(e){return{AC:{cTBA:{cID:e.callToBeAccepted.cID,dID:e.callToBeAccepted.dID}}}}(e);case"GetAgentState":return function(e){return{GAS:{dvc:e.device}}}(e);case"SetAgentState":return function(e){return{SAS:{dvc:e.device,rAS:e.state}}}(e);case"GroupPickupCall":return function(e){return{GPC:{nD:e.newDestination}}}(e);case"GetLogicalDeviceInformation":return function(e){return{GLDI:{dvc:e.device}}}(e)}l.error("CSTA: Unsupported CSTA request: "+e.request)}catch(e){l.error(e)}return null},this.parseEvent=function(e){try{if(!e)return l.error("[CstaParser]: Invalid event"),null;var t=JSON.parse(e);if(!t||t.parsererror)return l.error("[CstaParser]: Error parsing CSTA event: ",e),t&&t.parsererror.div&&l.error("[CstaParser]: "+t.parsererror.div),null;var n=Object.keys(t)[0];switch(n){case"CBE":return function(e){var t=e.CBE;return{category:"LogicalDeviceFeature",name:"CallBackEvent",originatingDevice:t.orD.dIr,targetDevice:t.tD.dIr,callBackSetCanceled:t.cBSC}}(t);case"CIE":return function(e){var t=e.CIE,n={category:"CallAssociatedFeature",name:"CallInformationEvent",connection:t.cnncn,device:t.dvc.dIr||"",callingDevice:t.caD&&t.caD.dIr||"",servicesPermitted:{}};return n.servicesPermitted=o(t),n.epid=r(t),n.pickupNotificationEarly=n.device&&n.device.includes("Pickup Group Number"),n}(t);case"CoE":return function(e){var t=e.CoE,n={category:"CallControl",name:"ConferencedEvent",primaryOldCall:t.pOC,secondaryOldCall:t.sOC,conferencingDevice:t.coD.dIr||"",addedParty:t.aPy.dIr||"",conferenceConnections:[],localConnectionInfo:t.lCI,cause:t.cs,servicesPermitted:{}};return t.cnC.cLI.forEach(function(e){var t={connection:e.nCn,endpoint:e.endp&&(e.endp.dID||e.endp.endp)};n.conferenceConnections.push(t)}),n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"CCEt":return function(e){var t=e.CCEt,n={category:"CallControl",name:"ConnectionClearedEvent",droppedConnection:t.drC,releasingDevice:t.rD.dIr||"",localConnectionInfo:t.lCI,cause:t.cs,servicesPermitted:{}};return n.servicesPermitted=o(t),n.epid=r(t),n.pickupNotificationTerminated=n.releasingDevice&&n.releasingDevice.includes("Pickup Group Number"),n}(t);case"DE":return function(e){var t=e.DE,n={category:"CallControl",name:"DeliveredEvent",connection:t.cnncn,alertingDevice:t.aDe.dIr||"",callingDevice:t.caD.dIr||"",networkCallingDevice:t.ntCD&&t.ntCD.dIr||"",calledDevice:t.cDe.dIr||"",localConnectionInfo:t.lCI,cause:t.cs};return n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"DGE":return function(e){var t=e.DGE;return{category:"CallAssociatedFeature",name:"DigitsGeneratedEvent",connection:t.cnncn,digitGeneratedList:t.dGL,keysToOmitFromLogging:["digitGeneratedList"]}}(t);case"DEt":return function(e){var t=e.DEt,n={category:"CallControl",name:"DivertedEvent",connection:t.cnncn,divertingDevice:t.dvD.dIr||"",newDestination:t.nD.dIr||"",callingDevice:t.caD&&t.caD.dIr||"",lastRedirectionDevice:t.lRD&&t.lRD.nDd||"",localConnectionInfo:t.lCI,cause:t.cs};return n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"DNDE":return function(e){var t=e.DNDE;return{category:"LogicalDeviceFeature",name:"DoNotDisturbEvent",device:t.dvc.dIr||"",doNotDisturbOn:"true"===t.dNDO}}(t);case"EEt":return function(e){var t=e.EEt,n={category:"CallControl",name:"EstablishedEvent",establishedConnection:t.eCn,answeringDevice:t.anD.dIr||"",callingDevice:t.caD.dIr||"",networkCallingDevice:t.ntCD&&t.ntCD.dIr||"",calledDevice:t.cDe.dIr||"",lastRedirectionDevice:t.lRD&&t.lRD.nDd||"",localConnectionInfo:t.lCI,cause:t.cs,servicesPermitted:{}};return n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"FE":return function(e){var t=e.FE,n={category:"CallControl",name:"FailedEvent",failedConnection:t.fC,failingDevice:t.fD.dIr||"",callingDevice:t.caD.dIr||"",localConnectionInfo:t.lCI,calledDevice:t.cDe.dIr,cause:t.cs,servicesPermitted:{}};return n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"FEt":return function(e){var t=e.FEt,n={category:"LogicalDeviceFeature",name:"ForwardingEvent",device:t.dvc.dIr||"",forwardingType:t.fTe,forwardStatus:"true"===t.fS,forwardTo:t.fTo};t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(t.extn.pDa.prvt.zsOD&&(n.staticOndDN=t.extn.pDa.prvt.zsOD,n.staticOndActive="true"===t.extn.pDa.prvt.zsOA),t.extn.pDa.prvt.zvMA&&(n.voicemailActive="true"===t.extn.pDa.prvt.zvMA),t.extn.pDa.prvt.zoP&&(n.overrideProfile="true"===t.extn.pDa.prvt.zoP),t.extn.pDa.prvt.zvMRD&&(n.voicemailRingDuration=parseInt(t.extn.pDa.prvt.zvMRD,10)),t.extn.pDa.prvt.zmRD&&(n.mainRingDuration=parseInt(t.extn.pDa.prvt.zmRD,10)),t.extn.pDa.prvt.zcRD&&(n.clientRingDuration=parseInt(t.extn.pDa.prvt.zcRD,10)),t.extn.pDa.prvt.zcpRD&&(n.cellRingDuration=parseInt(t.extn.pDa.prvt.zcpRD,10)),t.extn.pDa.prvt.hasOwnProperty("zcPN")&&(n.alternativeNumber=t.extn.pDa.prvt.zcPN),t.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(n.routeToCell="true"===t.extn.pDa.prvt.zrTCN));return n}(t);case"HE":return function(e){var t=e.HE,n={category:"CallControl",name:"HeldEvent",heldConnection:t.hCn,holdingDevice:t.hD.dIr||"",localConnectionInfo:t.lCI,servicesPermitted:{}};return n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"MWE":return function(e){var t=e.MWE;return{category:"PhysicalDeviceFeature",name:"MessageWaitingEvent",device:t.tD.dIr||"",messageWaitingOn:"true"===t.mWO}}(t);case"OE":return function(e){var t=e.OE,n={category:"CallControl",name:"OfferedEvent",offeredConnection:t.oCn,offeredDevice:t.oDe.dIr||"",callingDevice:t.caD.dIr||"",calledDevice:t.cDe.dIr||"",localConnectionInfo:t.lCI,lastRedirectionDevice:t.lRD&&t.lRD.nDd||"",cause:t.cs};return n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"QE":return function(e){var t=e.QE,n={category:"CallControl",name:"QueuedEvent",queuedConnection:t.qC,queue:t.q.dIr||"",callingDevice:t.caD.dIr||"",localConnectionInfo:t.lCI,cause:t.cs};return n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"ReE":return function(e){var t=e.ReE,n={category:"CallControl",name:"RetrievedEvent",retrievedConnection:t.rCn,retrievingDevice:t.reD.dIr||"",localConnectionInfo:t.lCI,servicesPermitted:{}};return n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"SCFE":return function(e){var t=e.SCFE,n={category:"CallAssociatedFeature",name:"ServiceCompletionFailureEvent",primaryCall:{connectionID:t.prC.cIDD,localConnectionState:t.prC.lCSe},cause:t.cs};t.sC&&(n.secondaryCall={connectionID:t.sC.cIDD,localConnectionState:t.sC.lCSe});return n}(t);case"SIE":return function(e){var t=e.SIE,n={category:"CallControl",name:"ServiceInitiatedEvent",initiatedConnection:t.iCn,initiatingDevice:t.iD.dIr||"",cause:t.cs};return n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"TE":return function(e){var t=e.TE,n={category:"CallControl",name:"TransferredEvent",primaryOldCall:t.pOC,secondaryOldCall:t.sOC,transferringDevice:t.tDe.dIr||"",transferredToDevice:t.tTDe.dIr||"",transferredConnections:[],localConnectionInfo:t.lCI,cause:t.cs,servicesPermitted:{}},i=t.tCs.cLI;Array.isArray(i)||(i=[i]);return n.transferredConnections=i.map(function(e){return{connection:e.nCn,endpoint:e.endp&&(e.endp.dID||e.endp.endp)}}),n.servicesPermitted=o(t),n.epid=r(t),n}(t);case"CLE":return function(e){var t=e.CLE,n={category:"LogicalDeviceFeature",name:"CallLogEvent",callLogList:[]};t.cLL&&t.cLL.cLE&&(t.cLL.cLE.rID?n.callLogList.push(c(t.cLL.cLE)):t.cLL.cLE.forEach(function(e){n.callLogList.push(c(e))}));return n}(t);case"BISE":return function(e){return{category:"DeviceMaintenance",name:"BackInServiceEvent",backInService:!0,device:e.BISE.dvc.dIr||""}}(t);case"OOSE":return function(e){return{category:"DeviceMaintenance",name:"OutOfServiceEvent",outOfService:!0,device:e.OOSE.dvc.dIr||""}}(t);case"ARE":return function(e){return{category:"LogicalDeviceFeature",name:"AgentReadyEvent",agentReady:!0,huntGroupList:s(e.ARE)}}(t);case"ANRE":return function(e){return{category:"LogicalDeviceFeature",name:"AgentNotReadyEvent",agentReady:!1,huntGroupList:s(e.ANRE)}}(t);case"ABE":return function(e){return{category:"LogicalDeviceFeature",name:"AgentBusyEvent",agentReady:!1,huntGroupList:s(e.ABE)}}(t);case"AWAC":return function(e){return{category:"LogicalDeviceFeature",name:"AgentWorkingAfterCallEvent",agentReady:!1,huntGroupList:s(e.AWAC)}}(t);case"DCCE":return function(e){var t=e.DCCE,n={category:"DeviceMaintenance"};t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&t.extn.pDa.prvt.zdP&&(n.name="true"===t.extn.pDa.prvt.zdP?"BackInServiceEvent":"OutOfServiceEvent");return n}(t);case"ALOE":return function(e){return{category:"LogicalDeviceFeature",name:"AgentLoggedOffEvent",huntGroupList:s(e.ALOE)}}(t);case"ALOEt":return function(e){return{category:"LogicalDeviceFeature",name:"AgentLoggedOnEvent",huntGroupList:s(e.ALOEt)}}(t)}l.info("[CstaParser]: Unsupported CSTA event: ",n)}catch(e){l.error("[CstaParser]: Error parsing CSTA event: ",e)}return null},this.parseResponse=function(e,t){try{if(!e||!t)return l.error("[CstaParser]: Invalid response"),null;var n=JSON.parse(t);if(!n||n.parsererror)return l.error("[CstaParser]: Error parsing CSTA response: ",t),n&&n.parsererror.div&&l.error("[CstaParser]: "+n.parsererror.div),null;if(n.CSTA&&(n.CSTAErrorCode=n.CSTA),n.CSTAErrorCode)return l.debug("[CstaParser]: Received error response for: ",e),function(e){if(!e.CSTAErrorCode)return l.error("[CstaParser]: The given response is not an error code: ",e),null;var t=null,n=Object.keys(e.CSTAErrorCode)[0];switch(n){case"oprt":case"operation":t="Operation Error";break;case"scrt":case"security":t="Security Error";break;case"sIy":case"stateIncompatibility":t="State Incompatibility Error";break;case"sRAy":case"systemResourceAvailability":t="System Resource Availability Error";break;case"sRA":case"subscribedResourceAvailability":t="Subscribed Resource Availability Error";break;case"pM":case"performanceManagement":t="Performance Management Error";break;case"pDa":case"privateDataInformation":t="Private Data Information Error"}return t?{error:!0,errorCategory:t,errorValue:e.CSTAErrorCode[n]}:(l.error("[CstaParser]: Unrecognized Error Category"),{error:!0,errorCategory:"Unknown",errorValue:"Unknown"})}(n);if(n.ISEC)return l.debug("[CstaParser]: Received internal service error response for: ",e),function(e){return e.ISEC?"code"===Object.keys(e.ISEC)[0]?{error:!0,errorCategory:"Code",errorValue:e.ISEC.code}:(l.error("[CstaParser]: Unrecognized Internal Service Error Category"),{error:!0,errorCategory:"Unknown",errorValue:"Unknown"}):(l.error("[CstaParser]: The given response is not an internal service error code: ",e),null)}(n);switch(e){case"AlternateCall":return function(e){return l.debug("[CstaParser]: Received CSTA Alternate Call response: ",e),e.ACRe}(n);case"ConferenceCall":return function(e){return l.debug("[CstaParser]: Received CSTA Conference Call response: ",e),{conferenceCall:e.CoCR.coC}}(n);case"AnswerCall":return function(e){return l.debug("[CstaParser]: Received CSTA Answer Call response: ",e),e.AnCR}(n);case"CallBackCallRelated":return function(e){return l.debug("[CstaParser]: Received CSTA Call Back call related response: ",e),e.CBR}(n);case"CallBackNonCallRelated":return function(e){return l.debug("[CstaParser]: Received CSTA Call Back non call related response: ",e),e.CBNCe}(n);case"CancelCallBack":return function(e){return l.debug("[CstaParser]: Received CSTA Cancel Call Back response: ",e),e.CCBR}(n);case"ClearConnection":return function(e){return l.debug("[CstaParser]: Received CSTA Clear Connection response: ",e),e.ClCR}(n);case"ConsultationCall":return function(e){return l.debug("[CstaParser]: Received CSTA Consultation Call response: ",e),e.CnCR}(n);case"DeflectCall":return function(e){return l.debug("[CstaParser]: Received CSTA Deflect Call response: ",e),e.DCRe}(n);case"GenerateDigits":return function(e){return l.debug("[CstaParser]: Received CSTA Generate Digits response: ",e),e.GDR}(n);case"GetDoNotDisturb":return function(e){return l.debug("[CstaParser]: Received CSTA Get Do Not Disturb response: ",e),{doNotDisturbOn:"true"===e.GDNDe.dNDO}}(n);case"GetForwarding":return function(e){if(l.debug("[CstaParser]: Received CSTA Get Forwarding response: ",e),e.GetForwardingResponse)return function(e){var t={forwardList:[]};e.forwardingList.forwardListItem.forwardStatus?(e.forwardingList.forwardListItem.forwardStatus="true"===e.forwardingList.forwardListItem.forwardStatus,t.forwardList.push(e.forwardingList.forwardListItem)):e.forwardingList.forwardListItem.forEach(function(e){e.forwardStatus="true"===e.forwardStatus,t.forwardList.push(e)});e.extensions&&e.extensions.privateData&&e.extensions.privateData.private&&(t.staticOndDN=e.extensions.privateData.private.staticOndDN,t.staticOndActive="true"===e.extensions.privateData.private.staticOndActive);return t}(e.GetForwardingResponse);var t=e.GFR,n={forwardList:[]};t.fL.fLI.fS?n.forwardList.push(i(t.fL.fLI)):t.fL.fLI.forEach(function(e){n.forwardList.push(i(e))});t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(n.staticOndDN=t.extn.pDa.prvt.zsOD,n.staticOndActive="true"===t.extn.pDa.prvt.zsOA,n.voicemailActive="true"===t.extn.pDa.prvt.zvMA,t.extn.pDa.prvt.zoP&&(n.overrideProfile="true"===t.extn.pDa.prvt.zoP),t.extn.pDa.prvt.zvMRD&&(n.voicemailRingDuration=parseInt(t.extn.pDa.prvt.zvMRD,10)),t.extn.pDa.prvt.zmRD&&(n.mainRingDuration=parseInt(t.extn.pDa.prvt.zmRD,10)),t.extn.pDa.prvt.zcRD&&(n.clientRingDuration=parseInt(t.extn.pDa.prvt.zcRD,10)),t.extn.pDa.prvt.zcpRD&&(n.cellRingDuration=parseInt(t.extn.pDa.prvt.zcpRD,10)),t.extn.pDa.prvt.hasOwnProperty("zcPN")&&(n.alternativeNumber=t.extn.pDa.prvt.zcPN),t.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(n.routeToCell="true"===t.extn.pDa.prvt.zrTCN));return n}(n);case"GetMessageWaitingIndicator":return function(e){return l.debug("[CstaParser]: Received CSTA Get Message Waiting response: ",e),{messageWaitingOn:"true"===e.GMWIe.mWO}}(n);case"HoldCall":return function(e){return l.debug("[CstaParser]: Received CSTA Hold Call response: ",e),e.HCR}(n);case"ReconnectCall":return function(e){return l.debug("[CstaParser]: Received CSTA Reconnect Call response: ",e),e.RCR}(n);case"RetrieveCall":return function(e){return l.debug("[CstaParser]: Received CSTA Retrieve Call response: ",e),e.RCRe}(n);case"SetBusy":return function(e){return l.debug("[CstaParser]: Received CSTA Set Busy response: ",e),e.zSBNe}(n);case"SetDoNotDisturb":return function(e){return l.debug("[CstaParser]: Received CSTA Set Do Not Disturb response: ",e),e.SDNDe}(n);case"SetForwarding":return function(e){return l.debug("[CstaParser]: Received CSTA Set Forwarding response: ",e),e.hasOwnProperty("SFR")?e.SFR:e.SetForwardingResponse}(n);case"SingleStepTransferCall":return function(e){l.debug("[CstaParser]: Received CSTA SST Call response: ",e);var t=e.SSTCe,n={transferredCall:t.trC};t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(n.seamlessHandover="true"===t.extn.pDa.prvt.zseHo);return n}(n);case"SnapshotCall":return function(e){l.debug("[CstaParser]: Received CSTA Snapshot Call response: ",e);function t(e){var t=function(e){return{deviceOnCall:e.dOC.dIr||"",callIdentifier:e.cI,localConnectionState:e.lCI,servicesPermitted:o(e)}}(e);i.endpoints.push(t),!i.callingDevice&&i.calledDevice&&t.deviceOnCall!==i.calledDevice&&(i.callingDevice=t.deviceOnCall)}var n=e.SCR,i={endpoints:[],callingDevice:n.caD&&n.caD.dIr||"",calledDevice:n.cDe&&n.cDe.dIr||"",servicesPermitted:{}};n.cRID.sDa.sCRIo&&(n.cRID.sDa.sCRIo.dOC?t(n.cRID.sDa.sCRIo):n.cRID.sDa.sCRIo.forEach(function(e){t(e)}));return i.servicesPermitted=o(n),i.epid=r(n),i}(n);case"SnapshotDevice":return function(e){l.debug("[CstaParser]: Received CSTA Snapshot Device response: ",e);var t=e.SnDR,n={activeCalls:[]};function i(e){var t=function(e){return{connectionId:e.cIr,localCallState:e.lCS&&e.lCS.cCSe&&e.lCS.cCSe.lCSe}}(e);t.connectionId&&t.connectionId.cID&&n.activeCalls.push(t)}t.cRID.sDa.sDRI&&(t.cRID.sDa.sDRI.cIr?i(t.cRID.sDa.sDRI):t.cRID.sDa.sDRI.forEach(function(e){i(e)}));t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(n.deskPhoneRegistered="true"===t.extn.pDa.prvt.zdP);return n}(n);case"TransferCall":return function(e){return l.debug("[CstaParser]: Received CSTA TransferCall response: ",e),{transferredCall:e.TCR.trC}}(n);case"SetMicrophoneMute":return function(e){return l.debug("[CstaParser]: Received CSTA SetMicrophoneMute response",e),{mute:"true"===e.SMMR.mML.mMI.mMO}}(n);case"GetMicrophoneMute":return function(e){return l.debug("[CstaParser]: Received CSTA GetMicrophoneMute response",e),{mute:"true"===e.GMMR.mML.mMI.mMO}}(n);case"MakeCall":return function(e){return l.debug("[CstaParser]: Received CSTA MakeCall response",e),e.MCR}(n);case"CallLogSnapShot":return function(e){return l.debug("[CstaParser]: Received CSTA Call Log Snap Shot response: ",e),e.CLSR}(n);case"AcceptCall":return function(e){return l.debug("[CstaParser]: Received CSTA Accept Call response: ",e),e.ACR}(n);case"GetAgentState":return function(e){l.debug("[CstaParser]: Received CSTA GetAgentState response",e);var t=e.GASR;return{loggedOnState:t.aSL&&t.aSL.aSE&&"true"===t.aSL.aSE.lOS,agentState:t.aSL&&t.aSL.aSE&&t.aSL.aSE.aIo&&"agentReady"===t.aSL.aSE.aIo.aII.aS?"ready":"notReady",huntGroupList:s(t)}}(n);case"SetAgentState":return function(e){return l.debug("[CstaParser]: Received CSTA SetAgentState response",e),e.SASR}(n);case"GroupPickupCall":return function(e){return l.debug("[CstaParser]: Received CSTA GroupPickupCall response",e),e.GPCR}(n);case"GetLogicalDeviceInformation":return function(e){return l.debug("[CstaParser]: Received CSTA Get Logical Device Information response: ",e),{hasPhysicalDeviceInformation:"true"===e.GLDIe.hPE}}(n)}l.error("CSTA: Unsupported CSTA response for request: ",e)}catch(e){l.error(e)}return null}},e}((Circuit=function(e){"use strict";var t;return e.UserToUserHandlerSingleton={getInstance:function(){return t||(t=new e.UserToUserHandler),t}},e}((Circuit=function(e){"use strict";var i=e.ClientApiHandlerSingleton,l=e.Constants,d=e.logger,u=e.Utils,t=Object.freeze({ADVANCING:"ADVANCING",CSTA:"CSTA",INFO:"INFO",PRIMARYCLIENT:"PRIMARYCLIENT",REGISTER:"REGISTER",REGISTER_RESPONSE:"REGISTER_RESPONSE",SETTINGS:"SETTINGS",START_REASSIGNMENT:"START_REASSIGNMENT",TALK:"TALK",UNREGISTER:"UNREGISTER",UNREGISTERED:"UNREGISTERED"}),n=Object.freeze({GET_GTC_VERSION_REQUEST:"GET_GTC_VERSION_REQUEST",SET_ROUTE_TO_DESK:"SET_ROUTE_TO_DESK",ENABLE_PBX_CALL_LOG:"ENABLE_PBX_CALL_LOG"}),r=Object.freeze({TRANSFER:"TRANSFER"}),o=Object.freeze({CLICK_TO_CALL_REQUEST:"CLICK_TO_CALL_REQUEST",CLICK_TO_CALL_RESPONSE:"CLICK_TO_CALL_RESPONSE",MUTE_DEVICE_REQUEST:"MUTE_DEVICE_REQUEST",MUTE_DEVICE_RESPONSE:"MUTE_DEVICE_RESPONSE",JOIN_CONFERENCE_REQUEST:"JOIN_CONFERENCE_REQUEST",JOIN_CONFERENCE_RESPONSE:"JOIN_CONFERENCE_RESPONSE",CONVERSATION_NAVIGATE_REQUEST:"CONVERSATION_NAVIGATE_REQUEST",CONVERSATION_NAVIGATE_RESPONSE:"CONVERSATION_NAVIGATE_RESPONSE",CLICK_TO_ANSWER_REQUEST:"CLICK_TO_ANSWER_REQUEST",CLICK_TO_ANSWER_RESPONSE:"CLICK_TO_ANSWER_RESPONSE",START_CONFERENCE_REQUEST:"START_CONFERENCE_REQUEST",START_CONFERENCE_RESPONSE:"START_CONFERENCE_RESPONSE",NAVIGATE_REQUEST:"NAVIGATE_REQUEST",NAVIGATE_REQUEST_RESPONSE:"NAVIGATE_REQUEST_RESPONSE"}),a=Object.freeze({OK:"OK",BUSY:"BUSY",TELEPHONY_NOT_AVAILABLE:"TELEPHONY_NOT_AVAILABLE",USER_NOT_FOUND:"USER_NOT_FOUND",CONVERSATION_NOT_FOUND:"CONVERSATION_NOT_FOUND",INVALID_CONVERSATION_TYPE:"INVALID_CONVERSATION_TYPE",CALL_DECLINED:"CALL_DECLINED",CALL_FAILED:"CALL_FAILED",CALL_NOT_FOUND:"CALL_NOT_FOUND",MUTE_DEVICE_FAILED:"MUTE_DEVICE_FAILED",CONVERSATION_NAVIGATE_FAILED:"CONVERSATION_NAVIGATE_FAILED",JOIN_CONFERENCE_FAILED:"JOIN_CONFERENCE_FAILED",START_CONFERENCE_FAILED:"START_CONFERENCE_FAILED",NAVIGATE_REQUEST_FAILED:"NAVIGATE_REQUEST_FAILED"}),s=Object.freeze({INVITE_REQUEST:"INVITE_REQUEST",INVITE_RESPONSE:"INVITE_RESPONSE",MUTE_REQUEST:"MUTE_REQUEST",MUTE_RESPONSE:"MUTE_RESPONSE",UNMUTE_REQUEST:"UNMUTE_REQUEST",UNMUTE_RESPONSE:"UNMUTE_RESPONSE",GET_MEETINGPOINT_INVITER_REQUEST:"GET_MEETINGPOINT_INVITER_REQUEST",GET_MEETINGPOINT_INVITER_RESPONSE:"GET_MEETINGPOINT_INVITER_RESPONSE",TOGGLE_VIDEO_REQUEST:"TOGGLE_VIDEO_REQUEST",TOGGLE_VIDEO_RESPONSE:"TOGGLE_VIDEO_RESPONSE",CHANGE_LAYOUT_REQUEST:"CHANGE_LAYOUT_REQUEST",CHANGE_LAYOUT_RESPONSE:"CHANGE_LAYOUT_RESPONSE",TOGGLE_WHITEBOARD:"TOGGLE_WHITEBOARD",TOGGLE_SCREENSHARING:"TOGGLE_SCREENSHARING",TOGGLE_CONFERENCEPOLL:"TOGGLE_CONFERENCEPOLL",TOGGLE_SHOW_VIDEO:"TOGGLE_SHOW_VIDEO",SWAP_DISPLAYS_REQUEST:"SWAP_DISPLAYS_REQUEST",SWAP_DISPLAYS_RESPONSE:"SWAP_DISPLAYS_RESPONSE",DOWNLOAD_SYSTEM_LOGS_REQUEST:"DOWNLOAD_SYSTEM_LOGS_REQUEST",DOWNLOAD_SYSTEM_LOGS_RESPONSE:"DOWNLOAD_SYSTEM_LOGS_RESPONSE",WHITEBOARD_STATUS_UPDATE_REQUEST:"WHITEBOARD_STATUS_UPDATE_REQUEST"}),c=Object.freeze({OK:"OK",FAILED:"FAILED",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",NOT_FOUND:"NOT_FOUND",NOT_CMP_USER:"NOT_CMP_USER",NOT_SUPPORTED:"NOT_SUPPORTED",INVITE_FAILED:"INVITE_FAILED",MUTE_FAILED:"MUTE_FAILED",UNMUTE_FAILED:"UNMUTE_FAILED",INVALID_PIN:"INVALID_PIN",MEETINGPOINT_BUSY:"MEETINGPOINT_BUSY",TOGGLE_VIDEO_FAILED:"START_VIDEO_FAILED",TOGGLE_SCREENSHARING_FAILED:"TOGGLE_SCREENSHARING_FAILED",TOGGLE_CONFERENCEPOLL_FAILED:"TOGGLE_CONFERENCEPOLL_FAILED",TOGGLE_WHITEBOARD_FAILED:"TOGGLE_WHITEBOARD_FAILED",TOGGLE_SHOW_VIDEO_FAILED:"TOGGLE_SHOW_VIDEO_FAILED",CHANGE_LAYOUT_FAILED:"CHANGE_LAYOUT_FAILED",SWAP_DISPLAYS_FAILED:"SWAP_DISPLAYS_FAILED"}),E=Object.freeze({DIAL:"DIAL"}),C=Object.freeze({TEAM_PICKUP:"TEAM_PICKUP"});function T(e){var r=2e4,a={},s={},c=e||i.getInstance();function o(e){e&&window.setTimeout(function(){e(l.ReturnCode.INVALID_MESSAGE)},0)}function n(t,n,i){return n&&n.content&&n.content.type?(d.debug("[UserToUserHandler]: Sending request "+t+"."+n.content.type),n.content.requestId=n.content.requestId||u.createTransactionId(),a[n.content.requestId]?(d.error("[UserToUserHandler]: UserToUser request has duplicate requestId"),void o(i)):void c.sendUserToUserRequest(t,n,function(e){if(e)return d.error("[UserToUserHandler]: Failed to send request: ",e),void(i&&i(e));t===l.UserRoutingMessageType.SDK?i&&i():function(e,t){if(t){var n=window.setTimeout(function(e){d.error("[UserToUserHandler]: Timeout waiting for response. RequestId:",e),a[e]&&(delete a[e],t(l.ReturnCode.REQUEST_TIMEOUT),d.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(a).length))},r,e);a[e]={cb:t,timer:n}}}(n.content.requestId,i)})):(d.error("[UserToUserHandler]: Invalid UserToUser request data - ",n),void o(i))}function t(e,t){try{if(t.routing&&t.routing.srcClientId===c.clientId)return void d.info("[UserToUserHandler]: Ignore own UserToUser event");var n;try{n=JSON.parse(t.data)}catch(e){return void d.error("[UserToUserHandler]: Event discarded (Cannot Parse)")}if(n.requestId){var i=a[n.requestId];if(i)return i.timer&&window.clearTimeout(i.timer),delete a[n.requestId],i.cb&&i.cb(null,n),void d.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(a).length)}var r=e+"."+n.type,o=s[r];o&&0!==o.length?(e===l.UserRoutingMessageType.SDK&&(n=n.message),o.forEach(function(e){e.cb(n,t.routing)})):d.info("[UserToUserHandler]: There is no registered event handler for ",r)}catch(e){d.error("[UserToUserHandler]: Exception handling UserToUser event. ",e)}}c.on("UserToUser.ATC",function(e){d.debug("[UserToUserHandler]: Received UserToUser.ATC event"),t(l.UserRoutingMessageType.ATC,e)}),c.on("UserToUser.DESKTOP_APP",function(e){d.debug("[UserToUserHandler]: Received UserToUser.DESKTOP_APP event: ",e.data),t(l.UserRoutingMessageType.DESKTOP_APP,e)}),c.on("UserToUser.CONTACT_CARD",function(e){d.debug("[UserToUserHandler]: Received UserToUser.CONTACT_CARD event: ",e.data),t(l.UserRoutingMessageType.CONTACT_CARD,e)}),c.on("UserToUser.CMP",function(e){d.debug("[UserToUserHandler]: Received UserToUser.CMP event: ",e.data),t(l.UserRoutingMessageType.CMP,e)}),c.on("UserToUser.MOBILE_BREAKOUT",function(e){d.debug("[UserToUserHandler]: Received UserToUser.MOBILE_BREAKOUT event: ",e.data),t(l.UserRoutingMessageType.MOBILE_BREAKOUT,e)}),c.on("UserToUser.SDK",function(e){d.debug("[UserToUserHandler]: Received UserToUser.SDK event: ",e.data),t(l.UserRoutingMessageType.SDK,e)}),c.on("UserToUser.STC",function(e){d.debug("[UserToUserHandler]: Received UserToUser.STC event: ",e.data),t(l.UserRoutingMessageType.STC,e)}),c.on("UserToUser.TEAM_PICKUP",function(e){d.debug("[UserToUserHandler]: Received UserToUser.TEAM_PICKUP event: ",e.data),t(l.UserRoutingMessageType.TEAM_PICKUP,e)}),this.cancelReqCallback=function(e){var t=a[e];t&&(t.cb=null)},this.sendAtcRequest=function(e,t){n(l.UserRoutingMessageType.ATC,e,t)},this.sendContactCardRequest=function(e,t){n(l.UserRoutingMessageType.CONTACT_CARD,e,t)},this.sendDesktopAppRequest=function(e,t){n(l.UserRoutingMessageType.DESKTOP_APP,e,t)},this.sendMeetingPointRequest=function(e,t){n(l.UserRoutingMessageType.CMP,e,t)},this.sendMobileBreakoutEvent=function(e,t){n(l.UserRoutingMessageType.MOBILE_BREAKOUT,e,t)},this.sendStcRequest=function(e,t){n(l.UserRoutingMessageType.STC,e,t)},this.sendSdkRequest=function(e,t){e&&e.content&&delete e.content.requestId,n(l.UserRoutingMessageType.SDK,e,t)},this.sendTeamPickupRequest=function(e,t){n(l.UserRoutingMessageType.TEAM_PICKUP,e,t)},this.on=function(e,t){e&&"function"==typeof t&&(s[e]=s[e]||[],s[e].some(function(e){return e.cb===t})||s[e].push({cb:t}))},this.off=function(e,n){if(e||n)if(n){if(e&&"function"==typeof n){var i=s[e];i&&i.some(function(e,t){return e.cb===n&&(i.splice(t,1),!0)})}}else delete s[e];else s={}}}return(T.prototype.constructor=T).prototype.name="UserToUserHandler",e.UserToUserHandler=T,e.Enums=e.Enums||{},e.Enums.AtcInfoMessage=n,e.Enums.AtcMessage=t,e.Enums.StcMessage=r,e.Enums.ContactCardMessage=o,e.Enums.ContactCardResponseCode=a,e.Enums.MeetingPointMessage=s,e.Enums.MeetingPointResponseCode=c,e.Enums.MobileBreakoutMessage=E,e.Enums.TeamPickupMessage=C,e}((Circuit=function(e){"use strict";var t;return e.ClientApiHandlerSingleton={getInstance:function(){return t||(t=new e.ClientApiHandler),t}},e}((Circuit=function(U){"use strict";var L=U.Constants,M=U.PrivateData,w=U.Proto,G=U.Utils;function e(e){var a,o,s,r,c=U.logger,t=2090184,l=2090192,d=function(){},u=15e4,E=["teaser","navigableItem.spacesAdd.spaceReference.name","navigableItem.spacesMention.itemReference.subject","navigableItem.spacesMention.spaceReference.name","navigableItem.spacesRequestAccept.spaceReference.name","navigableItem.spacesRequestToJoin.spaceReference.name","navigableItem.spacesTagAdd.itemReference.subject","navigableItem.spacesTagAdd.spaceReference.name","navigableItem.spacesTagAdd.tagReference.tag","navigableItem.spacesTagRemove.itemReference.subject","navigableItem.spacesTagRemove.spaceReference.name","navigableItem.spacesTagRemove.tagReference.tag","navigableItem.spaceUserMassImport.spaceReference.name","navigableItem.teamIBelongToHasBeenDeleted.teamReference.teamName","navigableItem.teamUserDeletedFromTeam.teamReference.teamName","navigableItem.teamUserInvitationAccepted.teamReference.teamName","navigableItem.teamUserInvitationDeclined.teamReference.teamName","navigableItem.teamUserInvitedToJoin.teamReference.teamName","navigableItem.teamUserLeftTeam.teamReference.teamName","systemStreamItem.removedFrom.convReference.topic","systemStreamItem.spacesRemove.spaceReference.name","systemStreamItem.spacesRequestDeclined.spaceReference.name"],C=this,T=new U.ConnectionHandler(e),p=!1,S=!1,I=0;function A(e,t,n,i,r,o,a){var s=w.Request(e,t,o);return p?r=null:i&&(s.keysToOmitFromLogging=i),T.sendMessage(s,function(e,t){try{n(e,t)}catch(e){c.error("[ClientApiHandler]: Exception: ",e)}},r||null,a),s.request.requestId}function R(e,t){Circuit.Error&&(a=new Circuit.Error(e),t&&(a.errObj=t,a.message=t.info))}function f(e,t,n,i){if(a=null,S=!1,e)return R(e),n(e),!1;if(t.sanitization&&(S=!0,c.info("[ClientApiHandler]: Sanitization stripped content: ",t.sanitization&&t.sanitization.sanitizedContent)),t.code===L.ReturnCode.NO_RESULT)return i?n(null,[]):(R(L.ReturnCode.NO_RESULT),n(L.ReturnCode.NO_RESULT)),!1;var r,o=t.code;switch(t.code){case L.ReturnCode.OK:case L.ReturnCode.ENTITY_ALREADY_EXISTS:return!0;case L.ReturnCode.CLOUD_TELEPHONY_EXCEPTION:case L.ReturnCode.SERVICE_EXCEPTION:t.errorInfo&&t.errorInfo.errorCode&&((o=t.errorInfo.errorCode)===L.ErrorCode.THIRDPARTY_ERROR&&t.errorInfo.thirdpartyError?o=t.errorInfo.thirdpartyError.type:o===L.ErrorCode.CIRCUIT_EXCEPTION&&t.errorInfo.circuitException&&(o=t.errorInfo.circuitException),r=t.errorInfo)}return R(o=o||L.ReturnCode.UNEXPECTED_RESPONSE,r),n(o),!1}function v(e,t,n){t&&R(t),e&&e!==d&&window.setTimeout(function(){e(t,n)},0)}function i(e){return"boolean"==typeof e?e:void 0}function _(e){var t=[];return e?(e.audio&&t.push(L.RealtimeMediaType.AUDIO),e.video&&t.push(L.RealtimeMediaType.VIDEO),e.desktop&&t.push(L.RealtimeMediaType.DESKTOP_SHARING)):t.push(L.RealtimeMediaType.AUDIO),t}function g(e){var t=[];return e?(e.audio&&t.push(L.RecordingMediaType.AUDIO),e.video&&t.push(L.RecordingMediaType.VIDEO),e.text&&t.push(L.RecordingMediaType.TEXT)):t.push(L.RealtimeMediaType.AUDIO),t}function n(e){return e&&{fileId:e.fileId,fileName:e.fileName,mimeType:e.mimeType,size:e.size,itemId:e.itemId}}function N(e){return e&&e.map(n)}function m(e){return e&&{attachment:n(e.attachment),type:e.type,downloadLocation:e.downloadLocation,previewLocation:e.previewLocation,shareLinkToken:e.shareLinkToken}}function h(e){return e&&e.map(m)}function O(e){return{convId:e.convId,rtcSessionId:e.rtcSessionId,ownerId:e.ownerId,sdp:e.sdp,mediaType:_(e.mediaType),callOut:!!e.callOut,handover:!!e.handover,sendInviteCancel:!!e.sendInviteCancel,peerUserId:e.peerUserId||void 0,replaces:e.replaces,from:e.fromDn||e.fromName?{phoneNumber:e.fromDn,displayName:e.fromName,resolvedUserId:e.fromUserId}:void 0,to:e.dialedDn?{phoneNumber:e.dialedDn,displayName:e.toName||void 0,resolvedUserId:e.toUserId||void 0}:void 0,isTelephonyConversation:!!e.isTelephonyConversation,displayName:e.displayName,transactionId:e.transactionId,screenSharePointerSupported:e.screenSharePointerSupported,asyncSupported:!0,noCallLog:e.noCallLog||void 0,guestToken:e.guestToken||void 0,rtcSupportedFeatures:e.rtcSupportedFeatures||void 0,pickUpSession:e.pickUpSession||void 0}}function D(i){i=i||d,c.debug("[ClientApiHandler]: getApiVersion...");var e={type:L.VersionActionType.GET_VERSION};A(L.ContentType.VERSION,e,function(e,t){if(e||t.code!==L.ReturnCode.OK)I=0;else{var n=t.version.getVersion.version;c.info("[ClientApiHandler]: Setting client API version to ",n),I=G.convertVersionToNumber(n)}i()})}function P(e){var t=e&&e.content||"";t=G.sanitize(t),t=G.sanitizeSymbols(t);return t=M.convertPrivateDataToContent(e,["conceptboards"])+t}function y(e){return!!C.isTeamSupported()||(c.warn("[ClientApiHandler]: Team requests are not supported by the backend"),v(e,L.ReturnCode.OPERATION_NOT_SUPPORTED),!1)}function b(e,t){return!!C.isSpacesPollingSupported()||(c.warn("[ClientApiHandler]: The "+e+" operation is not supported by the backend"),v(t,L.ReturnCode.OPERATION_NOT_SUPPORTED),!1)}Object.defineProperties(this,{clientId:{enumerable:!0,get:function(){return o},set:function(e){"simulatedDirect"===e&&(o=e)}},clientApiVersion:{enumerable:!0,get:function(){return I}},hasLastRequestBeenSanitized:{enumerable:!0,get:function(){return S}}}),this.getLastError=function(){return a},this.connect=function(e,t,n){n&&T.setTarget(n),T.connect(e,t)},this.getConnState=T.getState.bind(T),this.disconnect=T.disconnect.bind(T),this.reconnect=T.reconnect.bind(T),this.pingServer=T.pingServer.bind(T),this.setPingInterval=T.setPingInterval.bind(T),this.setTarget=T.setTarget.bind(T),this.setClientInfo=T.setClientInfo.bind(T),this.setToken=T.setToken.bind(T),this.setRelativeUrl=T.setRelativeUrl.bind(T),this.addEventListener=T.addEventListener.bind(T),this.removeEventListener=T.removeEventListener.bind(T),this.onMessage=T.onMessage.bind(T),this.injectHasActiveCall=T.injectHasActiveCall.bind(T),this.setDevelopmentMode=function(e){p=!!e,T.ommitKeysFromLog=!e},this.simulateEvent=function(e){var t={clientId:o,msgType:L.WSMessageType.EVENT,event:e};T.onMessage(t)},this.on=function(e,t){var n;switch(e){case"Account.TELEPHONY_CONFIGURATION_UPDATED":n=["event.account.telephonyConfigurationUpdated.configuration.onsSipAuthenticationHash","event.account.telephonyConfigurationUpdated.configuration.ondSipAuthenticationHash"];break;case"ActivityStream.ACTIVITY_CREATED":n=E.map(function(e){return"event.activity.create.item."+e});break;case"ActivityStream.ACTIVITY_DELETED":n=E.map(function(e){return"event.activity.delete.item."+e});break;case"Conversation.ADD_ITEM":n=["event.conversation.addItem.item.text","event.conversation.addItem.item.system.renamedConversation"];break;case"Conversation.UPDATE_ITEM":n=["event.conversation.updateItem.item.text"];break;case"Conversation.CREATE":n=["event.conversation.create.conversation.topic","event.conversation.create.conversation.description"];break;case"Conversation.UPDATE":n=["event.conversation.update.conversation","event.conversation.update.topic","event.conversation.update.description"];break;case"ConversationUserData.LABEL_EDITED":n=["event.conversationUserData.labelEdited.labelEdited.value"];break;case"ConversationUserData.LABELS_ADDED":n=["event.conversationUserData.labelsAdded.labelsAdded.[].value"];break;case"RTCSession.LIVE_TRANSCRIPTION":n=["event.rtcSession.liveTranscriptionEvent.text"];break;case"RTCSession.POLL_ENABLED":n=["event.rtcSession.pollEnabledEvent.poll.question","event.rtcSession.pollEnabledEvent.poll.choices.[].choiceText"];break;case"RTCSession.POLL_STARTED":n=["event.rtcSession.pollStartedEvent.poll.question","event.rtcSession.pollStartedEvent.poll.choices.[].choiceText"];break;case"RTCSession.POLL_STOPPED":n=["event.rtcSession.pollStoppedEvent.poll.question","event.rtcSession.pollStoppedEvent.poll.choices.[].choiceText"];break;case"RTCSession.POLL_UPDATED":n=["event.rtcSession.pollUpdatedEvent.poll.question","event.rtcSession.pollUpdatedEvent.poll.choices.[].choiceText"];break;case"RTCSession.QUESTION_EVENT":n=["event.rtcSession.questionEvent.question.questionText"];break;case"Search.BASIC_SEARCH_RESULT":n=["event.search.basicSearchResult.searchResults"];break;case"Space.BASIC_SEARCH_RESULT":n=["event.space.basicSearchResult.spaces"];break;case"Space.ITEM_CREATED":n=["event.space.itemCreated.item.topic.subject","event.space.itemCreated.item.content","event.space.itemCreated.item.attachments","event.space.itemCreated.item.contentTags","event.space.itemCreated.item.tags"];break;case"Space.ITEM_UPDATED":n=["event.space.itemUpdated.item.topic.subject","event.space.itemUpdated.item.content","event.space.itemUpdated.item.attachments","event.space.itemUpdated.item.contentTags","event.space.itemUpdated.item.tags"];break;case"Space.SPACE_UPDATED":n=["event.space.spaceUpated.space.name","event.space.spaceUpated.space.description","event.space.spaceUpated.space.tags"];break;case"Space.SPACE_DELETED":n=["event.space.spaceDeleted.spaceId"];break;case"System.BROADCAST":n=["event.system.systemNotificationEvent.broadcastText"];break;case"Team.TEAM_CREATED":n=["event.team.teamCreatedEvent.team.teamName"];break;case"Team.TEAM_UPDATED":n=["event.team.teamUpdatedEvent.team.teamName"];break;case"ThirdParty.CONNECTED_TO_THIRDPARTY":n=["event.thirdParty.oAuthData"];break;case"User.CMR_SETTINGS_UPDATED":n=["event.user.cmrSettingsUpdatedEvent.setting"];break;case"User.USER_PRESENCE_CHANGE":n="*";break;case"UserToUser.ATC":n=["event.userToUser.userToUser.data"]}T.on(e,t,n)},this.unsubscribeAll=T.unsubscribeAll,this.isHardPhoneOnlySupported=function(){return l<I},this.isSpacesFavoritesSupported=function(){return 2090182<I},this.isPinVideoSupported=function(){return t<I},this.isParticipantRecordingSupported=function(){return t<I},this.isTeamSupported=function(){return t<I},this.isGetOAuthDataSessionSupported=function(){return t<I},this.isUcaasPhoneLdapSettingsSupported=function(){return t<I},this.isSpacesNcaSupported=function(){return t<I},this.isVideoPointerSupported=function(){return t<I},this.isSpacesPollingSupported=function(){return 2090187<I},this.isSpaceLinkPreviewSupported=function(){return 2090187<I},this.isSpaceFlaggedItemsCountSupported=function(){return 2090189<I},this.isAAValidateTransferTargetSupported=function(){return 2090189<I},this.isSpaceLikeEventingSupported=function(){return 2090189<I},this.isSharepointSupported=function(){return 2090190<I},this.isSpacesQuestionsSupported=function(){return 2090190<I},this.isSpaceFlaggedItemsByIdsSupported=function(){return 2090190<I},this.isSpacesPagesSupported=function(){return l<I},this.isSpaceScopesSupported=function(){return l<I},this.getApiVersion=D,this.logout=function(n){n=n||d,c.debug("[ClientApiHandler]: logout...");var e={type:L.UserActionType.LOGOUT,logoff:{invalidate:!0}};A(L.ContentType.USER,e,function(e,t){f(e,t,n)&&n(null)})},this.getUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getUser...");var t={type:L.UserActionType.GET_USER_BY_ID,getById:{userId:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null,t.user.getById.user)})},this.updateUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateUser...");var t={type:L.UserActionType.UPDATE,update:e};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null,t.user.updateResult.user)})},this.getLoggedOnUser=function(r){r=r||d,c.debug("[ClientApiHandler]: getLoggedOnUser...");var e={type:L.UserActionType.GET_LOGGED_ON};A(L.ContentType.USER,e,function(e,t){var n,i;f(e,t,r)&&(n=(i=t.user.getLoggedOn).user,i.userPresenceState=i.userPresenceState||n.userPresenceState,n.userPresenceState=i.userPresenceState,n.accounts=i.accounts||[],I=G.convertVersionToNumber(n.apiVersion),o=n.clientId,s=n.userId,r(null,i))},null,["response.user.getLoggedOn.user.userPresenceState.longitude","response.user.getLoggedOn.user.userPresenceState.latitude","response.user.getLoggedOn.user.userPresenceState.locationText","response.user.getLoggedOn.user.userPresenceState.statusMessage","response.user.getLoggedOn.userPresenceState.longitude","response.user.getLoggedOn.userPresenceState.latitude","response.user.getLoggedOn.userPresenceState.locationText","response.user.getLoggedOn.userPresenceState.statusMessage"])},this.getStuff=function(e,t){D(function(i,r){r=r||d,c.debug("[ClientApiHandler]: getStuff..."),i&&i.length||(i=Object.keys(L.GetStuffType));var e=i.indexOf(L.GetStuffType.SPACES_NCA);if(-1===e||C.isSpacesNcaSupported()||(c.warn("[ClientApiHandler]: SPACES_NCA is not supported by the backend"),i.splice(e,1),0!==i.length)){var t={type:L.UserActionType.GET_STUFF,getStuff:{types:i}};A(L.ContentType.USER,t,function(e,t){if(f(e,t,r)){var n=t.user.getStuff;i.includes(L.GetStuffType.USER)&&(n.user.userPresenceState=n.userPresenceState,n.user.accounts=n.accounts||[],I=G.convertVersionToNumber(n.user.apiVersion),o=n.user.clientId,s=n.user.userId),r(null,n)}},null,["response.user.getStuff.accounts.[].telephonyConfiguration.onsSipAuthenticationHash","response.user.getStuff.accounts.[].telephonyConfiguration.ondSipAuthenticationHash","response.user.getStuff.pendingSystemNotifications.[].systemNotificationEvent.broadcastText","response.user.getStuff.recentSearches","response.user.getStuff.recentSpaceSearches","response.user.getStuff.userPresenceState.longitude","response.user.getStuff.userPresenceState.latitude","response.user.getStuff.userPresenceState.locationText","response.user.getStuff.userPresenceState.statusMessage"])}else v(r,L.ReturnCode.OPERATION_NOT_SUPPORTED)}.bind(this,e,t))},this.getSupportData=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: getSupportData..."),!e)return c.warn("[ClientApiHandler]: userId was not provided to getSupportData"),void v(n,L.ReturnCode.INVALID_MESSAGE);var t={type:L.UserActionType.GET_SUPPORT_DATA,getSupportData:{userId:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null,t.user.getSupportData)})},this.setPresence=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setPresence...");var t={type:L.UserActionType.SET_PRESENCE,presence:{state:e.state,inTransit:e.inTransit,longitude:e.longitude,latitude:e.latitude,locationText:e.locationText,isAccurate:e.isAccurate,timeZoneOffset:e.timeZoneOffset,mobile:e.mobile,dndUntil:e.dndUntil,statusMessage:e.statusMessage||""}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null,t.user.setPresence.state)},["request.user.presence.longitude","request.user.presence.latitude","request.user.presence.locationText","request.user.presence.statusMessage"],["response.user.setPresence.state.longitude","response.user.setPresence.state.latitude","response.user.setPresence.state.locationText","response.user.setPresence.state.statusMessage"])},this.getPresence=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getPresence...");var i={type:L.UserActionType.GET_PRESENCE,getPresence:{userIds:e,full:!!t}};A(L.ContentType.USER,i,function(e,t){f(e,t,n)&&n(null,t.user.getPresence.states)},null,["response.user.getPresence.states"])},this.subscribePresence=function(e,i){i=i||d,c.debug("[ClientApiHandler]: subscribePresence...");var t={type:L.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:e}};A(L.ContentType.USER,t,function(e,t){if(f(e,t,i)){var n=t.user&&t.user.subscribePresence&&t.user.subscribePresence.states;i(null,n)}},null,["response.user.subscribePresence.states"])},this.unsubscribePresence=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unsubscribePresence...");var t={type:L.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null)})},this.subscribeTenantPresence=function(e,n){n=n||d,c.debug("[ClientApiHandler]: subscribeTenantPresence...");var t={type:L.UserActionType.SUBSCRIBE_TENANT_PRESENCE,subscribeTenantPresence:{tenantId:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null)})},this.unsubscribeTenantPresence=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unsubscribeTenantPresence...");var t={type:L.UserActionType.UNSUBSCRIBE_TENANT_PRESENCE,unsubscribeTenantPresence:{tenantId:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null)})},this.updateStatusSubscription=function(e,t,n){var i;n=n||d,c.debug("[ClientApiHandler]: updateStatusSubscription - subscribe = ",t),i=t?{type:L.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:e,notificationSubscriptionType:L.NotificationSubscriptionType.ONLINE_STATUS}}:{type:L.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:e,notificationSubscriptionType:L.NotificationSubscriptionType.ONLINE_STATUS}},A(L.ContentType.USER,i,function(e,t){f(e,t,n)&&n(null)})},this.changePassword=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: changePassword...");var i={type:L.UserActionType.CHANGE_PASSWORD,changePassword:{oldPassword:e,newPassword:t}};A(L.ContentType.USER,i,function(e,t){f(e,t,n)&&n(null,t.user.changePasswordResult.changeResult)},["request.user.changePassword.oldPassword","request.user.changePassword.newPassword"])},this.subscribeDevices=function(i){i=i||d,c.debug("[ClientApiHandler]: subscribeDevices...");var e={type:L.UserActionType.SUBSCRIBE_DEVICES};A(L.ContentType.USER,e,function(e,t){if(f(e,t,i)){var n=t.user&&t.user.subscribeDevices&&t.user.subscribeDevices.devices;i(null,n)}})},this.unsubscribeDevices=function(n){n=n||d,c.debug("[ClientApiHandler]: unsubscribeDevices...");var e={type:L.UserActionType.UNSUBSCRIBE_DEVICES};A(L.ContentType.USER,e,function(e,t){f(e,t,n)&&n(null)})},this.requestEmailChange=function(e,t,n){c.debug("[ClientApiHandler]: requestEmailChange");var i={type:L.UserActionType.GENERATE_EMAIL_UPDATE_TOKEN,generateEmailUpdateToken:{userId:e,emailAddress:t}};A(L.ContentType.USER,i,function(e,t){f(e,t,n)&&n(null)})},this.getUsersByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getUsersByIds...");var t={type:L.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:e,complete:!0}};A(L.ContentType.USER,t,function(e,t){f(e,t,n,null)&&n(null,t.user.usersByIds.user)},null,["response.user.usersByIds.user"])},this.getPartialUsersByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getPartialUsersByIds...");var t={type:L.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:e,complete:!1}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null,t.user.usersByIds.user)})},this.renewToken=function(n){n=n||function(e){e?c.error("[ClientApiHandler]: Error renewing token. This client will be automatically logged out",e):c.debug("[ClientApiHandler]: Successfully renewed token.")},c.debug("[ClientApiHandler]: renewToken");var e={type:L.UserActionType.RENEW_TOKEN};A(L.ContentType.USER,e,function(e,t){f(e,t,n)&&n(null)})},this.getUserSettings=function(e,n){n=n||d,e=e||L.UserSettingArea.ALL,c.debug("[ClientApiHandler]: getUserSettings...");var t={type:L.UserActionType.GET_USER_SETTINGS,getUserSettings:{areas:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null,t.user.getUserSettings.settings)})},this.setUserSettings=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: setUserSettings..."),!e||Array.isArray(e)&&!e.length)return c.warn("[ClientApiHandler]: No settings were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);Array.isArray(e)||(e=[e]);var t={type:L.UserActionType.SET_USER_SETTINGS,setUserSettings:{settings:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null)})},this.getUserByEmail=function(e,n){n=n||d;var t={type:L.UserActionType.GET_USER_BY_MAIL,getUserByMail:{emailAddress:e,excludeRoles:[L.UserRole.SUPPORT,L.UserRole.SYSTEM_ADMIN]}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null,t.user.getUserByMail.user)})},this.getUsersByEmails=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getUsersByEmails...");var t={type:L.UserActionType.GET_USERS_BY_MAILS,getUsersByMails:{emailAddresses:e.emailAddresses,xmppLookup:!!e.xmppLookup,excludeRoles:[L.UserRole.SUPPORT,L.UserRole.SYSTEM_ADMIN]}};A(L.ContentType.USER,t,function(e,t){f(e,t,n,!0)&&n(null,t.user.getUsersByMails.users)})},this.changeUserEmail=function(e,t,n,i){n=n||d;var r={type:L.UserActionType.EMAIL_UPDATE,emailUpdate:{userId:e,emailAddress:t}};A(L.ContentType.USER,r,function(e,t){f(e,t,n)&&n(null,t.user.emailUpdate)},null,null,i)},this.goToSleep=function(e,n){n=n||d,c.debug("[ClientApiHandler]: goToSleep...");var t={type:L.UserActionType.GO_TO_SLEEP,userId:e};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null)})},this.wakeUp=function(n){n=n||d,c.debug("[ClientApiHandler]: wakeUp...");var e={type:L.UserActionType.WAKE_UP};A(L.ContentType.USER,e,function(e,t){f(e,t,n)&&n(null)})},this.getDevices=function(n){n=n||d,c.debug("[ClientApiHandler]: getDevices...");var e={type:L.UserActionType.GET_DEVICES};A(L.ContentType.USER,e,function(e,t){f(e,t,n)&&n(null,t.user.getDevices.devices)})},this.getTelephonyData=function(n){n=n||d,c.debug("[ClientApiHandler]: getTelephonyData...");var e={type:L.UserActionType.GET_TELEPHONY_DATA};A(L.ContentType.USER,e,function(e,t){f(e,t,n)&&n(null,t.user.getTelephonyData.data)})},this.getConnectedApps=function(n){n=n||d,c.debug("[ClientApiHandler]: getConnectedApps...");var e={type:L.UserActionType.OAUTH_GET_GRANTED_ACCESS_TOKENS};A(L.ContentType.USER,e,function(e,t){f(e,t,n,!0)&&n(null,t.user.oAuthGetGrantedAccessTokens.oAuthGrantedAccess)})},this.revokeAccessToken=function(e,n){n=n||d,c.debug("[ClientApiHandler]: revokeAccessToken...");var t={type:L.UserActionType.OAUTH_REVOKE_ACCESS_TOKEN,oAuthRevokeGrantedAccessToken:{tokenId:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null)})},this.revokeAllManagedDevices=function(n){n=n||d,c.debug("[ClientApiHandler]: revokeAllManagedDevices...");var e={type:L.UserActionType.REVOKE_MANAGED_DEVICES};A(L.ContentType.USER,e,function(e,t){f(e,t,n)&&n(null)})},this.getSecurityTokenInfo=function(n){n=n||d,c.debug("[ClientApiHandler]: getSecurityTokenInfo...");var e={type:L.UserActionType.GET_SECURITY_TOKEN_INFO};A(L.ContentType.USER,e,function(e,t){f(e,t,n,!0)&&n(null,t.user.getSecurityTokenInfoResult.securityTokenInfo)})},this.revokeSecurityToken=function(e,n){n=n||d,c.debug("[ClientApiHandler]: revokeSecurityToken...");var t={type:L.UserActionType.REVOKE_SECURITY_TOKEN,revokeSecurityToken:{tokenIdHash:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null)})},this.getUserTenantSettings=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getUserTenantSettings...");var t={type:L.UserActionType.GET_TENANT_SETTINGS};A(L.ContentType.USER,t,function(e,t){f(e,t,n,!0)&&n(null,t.user.getTenantSettings.tenantSettings)},null,null,e)},this.resetOpenScapeDevicePins=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: resetOpenScapeDevicePins...");var i={type:L.UserActionType.RESET_OPENSCAPE_DEVICE_PINS,resetOpenScapeDevicePins:{circuitUserId:e,directoryNumber:t}};A(L.ContentType.USER,i,function(e,t){f(e,t,n)&&n(null,t.user.resetOpenScapeDevicePins.openScapeDevicePins)},null,["response.user.resetOpenScapeDevicePins.openScapeDevicePins"])},this.setClientCapabilities=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setClientCapabilities...");var t={type:L.UserActionType.SET_CLIENT_CAPABILITIES,setClientCapabilities:{capabilities:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null)})},this.getTenantIdToNameMap=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getTenantIdToNameMap...");var i={type:L.UserActionType.GET_TENANT_ID_TO_NAME_MAP,getTenantIdToNameMap:{secIds:e}};A(L.ContentType.USER,i,function(e,t){f(e,t,n,!0)&&n(null,t.user.getTenantIdToNameMapResult.tenantIdToNameMap||[])},null,null,t)},this.getRecentUsedCMRs=function(n){n=n||d,c.debug("[ClientApiHandler]: getRecentUsedCMRs...");var e={type:L.UserActionType.GET_RECENT_USED_CMRS};A(L.ContentType.USER,e,function(e,t){f(e,t,n,!0)&&n(null,t.user.getRecentUsedCMRsResult.cmrUser||[])})},this.addRecentUsedCMR=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addRecentUsedCMR...");var t={type:L.UserActionType.ADD_RECENT_USED_CMR,addRecentUsedCMR:{cmrUserId:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null)})},this.isAllowedToAddCmr=function(e,n){n=n||d,c.debug("[ClientApiHandler]: isAllowedToAddCmr...");var t={type:L.UserActionType.IS_ALLOWED_TO_ADD_CMR,isAllowedToAddCMR:{inviterUserId:e}};A(L.ContentType.USER,t,function(e,t){f(e,t,n)&&n(null,!!t.user.isAllowedToAddCmrResult.isAllowed)})},this.startBasicSearch=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: startBasicSearch...");var i={type:L.SearchActionType.START_BASIC_SEARCH,startBasicSearch:{searchTerm:e,priorizedConvs:t||void 0,newSearch:!0}};A(L.ContentType.SEARCH,i,function(e,t){f(e,t,n)&&n(null,t.search.startSearchResult.searchId)})},this.startDetailSearch=function(e,t,n,i,r){r=r||d,c.debug("[ClientApiHandler]: startDetailSearch...");var o={type:L.SearchActionType.START_DETAIL_SEARCH,startDetailSearch:{searchTerm:e,convId:t,searchId:n||void 0,resultSetLimit:i||0}};A(L.ContentType.SEARCH,o,function(e,t){f(e,t,r)&&r(null,t.search.startSearchResult.searchId)})},this.cancelSearch=function(e,n){n=n||d,c.debug("[ClientApiHandler]: cancelSearch...");var t={type:L.SearchActionType.CANCEL_SEARCH,cancelSearch:{searchId:e}};A(L.ContentType.SEARCH,t,function(e,t){f(e,t,n)&&n(null)})},this.addRecentSearch=function(e,n){n=n||d;var t={type:L.SearchActionType.ADD_RECENT_SEARCH,addRecentSearch:{searchTerm:e}};A(L.ContentType.SEARCH,t,function(e,t){f(e,t,n)&&n(null)})},this.startUserSearch=function(e,n){n=n||d;var t={type:L.SearchActionType.START_USER_SEARCH,startUserSearch:{query:e.query,reversePhoneNumberLookup:!!e.reversePhoneNumberLookup}};A(L.ContentType.SEARCH,t,function(e,t){f(e,t,n)&&n(null,t.search.startSearchResult.searchId)})},this.startAdvancedUserSearch=function(e,n){n=n||d,c.debug("[ClientApiHandler]: startAdvancedUserSearch...");var t={type:L.SearchActionType.START_ADVANCED_USER_SEARCH,startAdvancedUserSearch:{searchContext:e.searchContext,query:e.query,searchExactAssignedPhoneNumber:e.searchExactAssignedPhoneNumber,resultSetLimit:e.resultSetLimit}};A(L.ContentType.SEARCH,t,function(e,t){f(e,t,n)&&n(null,t.search.startSearchResult.searchId)})},this.searchConversationParticipants=function(e,t,n){n=n||d;var i={type:L.SearchActionType.SEARCH_CONVERSATION_PARTICIPANTS,searchConversationParticipants:{displayName:e,convId:t}};A(L.ContentType.SEARCH,i,function(e,t){f(e,t,n,!0)&&n(null,t.search.searchConversationParticipantsResult.participants||[])})},this.createConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: createConversation...");var t=e.type;t||(t=2<e.participants.length?L.ConversationType.GROUP:L.ConversationType.DIRECT);var i={type:L.ConversationActionType.CREATE,create:{type:t,topic:e.topic,description:e.description||void 0,participants:e.participants,locale:e.locale,systemTags:e.systemTags||void 0,eventSize:e.eventSize||void 0}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.create.conversation,t.code===L.ReturnCode.ENTITY_ALREADY_EXISTS)},["request.conversation.create.topic","request.conversation.create.description"],["response.conversation.create.conversation.topic","response.conversation.create.conversation.description","response.conversation.create.conversation.topLevelItem"])},this.updateConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateConversation...");var t={type:L.ConversationActionType.UPDATE,update:{convId:e.conversationId,topic:e.topic,description:e.description}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.update.conversation)},["request.conversation.update.topic","request.conversation.update.description"],["response.conversation.update.conversation.participants","response.conversation.update.conversation.topic","response.conversation.update.conversation.description","response.conversation.update.conversation.topLevelItem"])},this.addTextItem=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addTextItem...");var t=P(e),i={type:L.ConversationActionType.ADD_TEXT_ITEM,addTextItem:{convId:e.convId,parentId:e.parentId,contentType:e.contentType,subject:e.subject,content:t,attachmentMetaData:N(e.attachmentMetaData),externalAttachmentMetaData:h(e.externalAttachmentMetaData),preview:e.preview,formMetaData:e.form,mentionedUsers:e.mentionedUsers,conceptboards:e.conceptboards,sharedItems:e.sharedItems}};i.addTextItem.preview&&i.addTextItem.preview.description&&(i.addTextItem.preview.description=i.addTextItem.preview.description.substr(0,255));A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.addTextItem.item)},["request.conversation.addTextItem.subject","request.conversation.addTextItem.content"],["response.conversation.addTextItem.item.text"])},this.updateTextItem=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateTextItem...");var t=P(e),i={itemId:e.itemId,convId:e.convId,parentId:e.parentId,contentType:L.TextItemContentType.RICH,subject:e.subject,content:t,attachmentMetaData:N(e.attachmentMetaData),preview:e.preview||{},formMetaData:e.form,clustered:e.clustered,externalAttachmentMetaData:h(e.externalAttachmentMetaData),mentionedUsers:e.mentionedUsers,conceptboards:e.conceptboards,sharedItems:e.sharedItems};i.preview.description&&(i.preview.description=i.preview.description.substr(0,255)),i.externalAttachmentMetaData&&0!==i.externalAttachmentMetaData.length||(i.externalAttachmentMetaData=[{type:"BOX",downloadLocation:"",previewLocation:"",attachment:{}}]),i.attachmentMetaData&&0!==i.attachmentMetaData.length||(i.attachmentMetaData=[{}]);var r={type:L.ConversationActionType.UPDATE_TEXT_ITEM,updateTextItem:i};A(L.ContentType.CONVERSATION,r,function(e,t){f(e,t,n)&&n(null,t.conversation.updateTextItem.item)},["request.conversation.updateTextItem.subject","request.conversation.updateTextItem.content"],["response.conversation.updateTextItem.item.text"])},this.deleteTextItem=function(e,n){if(n=n||d,!e||!e.itemId)return c.warn("[ClientApiHandler]: No request parameters were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);c.debug("[ClientApiHandler]: deleteTextItem...");var t={type:L.ConversationActionType.DELETE_TEXT_ITEM,deleteTextItem:{itemId:e.itemId}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.deleteTextItem.item)})},this.deleteRecording=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteRecording...");var t={type:L.ConversationActionType.DELETE_RECORDING,deleteRecording:{itemId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.deleteRecording.item)})},this.updateRtcItemAttachments=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: updateRtcItemAttachments...");var i={type:L.ConversationActionType.UPDATE_RTC_ITEM_ATTACHMENTS,updateRtcItemAttachments:{itemId:e,attachments:N(t)}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.updateRtcItemAttachmentsResult.item)})},this.getOpenConversations=function(e,t,i){i=i||d,c.debug("[ClientApiHandler]: getOpenConversations...");var n={type:L.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:e,numberOfItems:t}};A(L.ContentType.CONVERSATION,n,function(e,t){if(f(e,t,i,!0)){var n=t.conversation.getOpenConversations;i(null,n.conversations,n.lastItemIndex)}},null,["response.conversation.getOpenConversations.conversations"])},this.getAllOpenConversations=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: getAllOpenConversations...");var r={type:L.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:e,numberOfItems:t,ownIncluded:!0,sorting:n}};A(L.ContentType.CONVERSATION,r,function(e,t){if(f(e,t,i,!0)){var n=t.conversation.getOpenConversations;i(null,n.conversations,n.lastItemIndex)}},null,["response.conversation.getOpenConversations.conversations"])},this.joinOpenConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: JoinOpenConversation...");var t={type:L.ConversationActionType.JOIN_OPEN_CONVERSATION,joinOpenConversation:{convId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.joinOpenConversation.conv)})},this.getConversationFeed=function(e,t,n,i,r,o,a){a=a||d,c.debug("[ClientApiHandler]: getConversationFeed...");var s={type:L.ConversationActionType.GET_CONVERSATION_FEED,getConversationFeed:{convId:e,timestamp:t||void 0,minTotalItems:n||void 0,maxTotalUnread:i||void 0,commentsPerThread:r||void 0,maxUnreadPerThread:o||void 0}};A(L.ContentType.CONVERSATION,s,function(e,t){if(f(e,t,a,!0)){var n=t.conversation.getConversationFeedResult;a(null,n.conversationThreads,n.hasOlderThreads)}},null,["response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.attachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.rtc","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.text","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.system","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].attachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].text"])},this.getConversationTopics=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: getConversationTopics...");var r={type:L.ConversationActionType.GET_CONVERSATION_TOPICS,getConversationTopics:{convId:e,timestamp:t||void 0,maxNumberOfTopics:n||void 0}};A(L.ContentType.CONVERSATION,r,function(e,t){if(f(e,t,i,!0)){var n=t.conversation.getConversationTopicsResult;i(null,n.conversationTopics,n.hasOlderTopics)}},null,["response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.attachments","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.externalAttachments","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.rtc","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.text","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.system","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.attachments","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.externalAttachments","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.rtc","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.text","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.system"])},this.pinTopic=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: pinTopic..."),!e||!e.convId||!e.topicId)return c.warn("[ClientApiHandler]: No request parameters were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var t={type:L.ConversationActionType.PIN_TOPIC,pinTopic:{convId:e.convId,topicId:e.topicId}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.pinTopicResult.conversation)},null,["response.conversation.pinTopicResult.conversation"])},this.unpinTopic=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: unpinTopic..."),!e||!e.convId||!e.topicId)return c.warn("[ClientApiHandler]: No request parameters were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var t={type:L.ConversationActionType.UNPIN_TOPIC,unpinTopic:{convId:e.convId,topicId:e.topicId}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.unpinTopicResult.conversation)},null,["response.conversation.unpinTopicResult.conversation"])},this.getThreadComments=function(e,t,n,i,r,o,a){a=a||d,c.debug("[ClientApiHandler]: getThreadComments...");var s={type:L.ConversationActionType.GET_THREAD_COMMENTS,getThreadComments:{convId:e,threadId:t,timestamp:n||void 0,timestampFilter:i||L.TimestampFilter.CREATION,direction:r||void 0,totalComments:o||void 0}};A(L.ContentType.CONVERSATION,s,function(e,t){if(f(e,t,a,!0)){var n=t.conversation.getThreadCommentsResult;a(null,n.comments,n.hasMoreComments)}},null,["response.conversation.getThreadCommentsResult.comments.[].attachments","response.conversation.getThreadCommentsResult.comments.[].externalAttachments","response.conversation.getThreadCommentsResult.comments.[].text"])},this.getThreadsByItemIds=function(e,i){if(c.debug("[ClientApiHandler]: getThreadsByItemIds..."),i=i||d,!e)return c.warn("[ClientApiHandler]: No request parameters were provided"),void v(i,L.ReturnCode.INVALID_MESSAGE);if(!e.convId)return c.warn("[ClientApiHandler]: No conversation id was provided"),void v(i,L.ReturnCode.INVALID_MESSAGE);if(!e.threadParams)return c.warn("[ClientApiHandler]: No thread parameters were provided (item ids were not provided)"),void v(i,L.ReturnCode.INVALID_MESSAGE);var t={type:L.ConversationActionType.GET_THREADS_BY_ITEM_IDS,getThreadsByItemIds:{convId:e.convId,threadParams:e.threadParams,timestampFilter:e.timestampFilter||void 0,orderBy:e.orderBy||void 0}};A(L.ContentType.CONVERSATION,t,function(e,t){if(f(e,t,i,!0)){var n=t.conversation.getThreadsByItemIdsResult;i(null,n&&n.conversationThreadContext)}},null,["response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.rtc","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.system","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].text"])},this.getThreadsByIds=function(e,i){if(c.debug("[ClientApiHandler]: getThreadsByIds..."),i=i||d,!e)return c.warn("[ClientApiHandler]: No request parameters were provided"),void v(i,L.ReturnCode.INVALID_MESSAGE);if(!e.convId)return c.warn("[ClientApiHandler]: No conversation id was provided"),void v(i,L.ReturnCode.INVALID_MESSAGE);if(!(e.threadIds instanceof Array&&0<e.threadIds.length))return c.warn("[ClientApiHandler]: No thread parameters were provided (thread ids were not provided)"),void v(i,L.ReturnCode.INVALID_MESSAGE);var t={type:L.ConversationActionType.GET_THREADS_BY_IDS,getThreadsByIds:{convId:e.convId,threadIds:e.threadIds,orderBy:e.orderBy||L.SortingType.TIMESTAMP_ASC,commentsPerThread:e.commentsPerThread||void 0}};A(L.ContentType.CONVERSATION,t,function(e,t){if(f(e,t,i,!0)){var n=t.conversation.getThreadsByIdsResult;i(null,n&&n.conversationThreads)}},null,["response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.rtc","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.text","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.system","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].text"])},this.getConversations=function(e,t,n,i,r,o){o=o||d,c.debug("[ClientApiHandler]: getConversations...");var a=n?L.SearchDirection.BEFORE:L.SearchDirection.AFTER,s={type:L.ConversationActionType.GET_CONVERSATIONS,getConversations:{userId:e,modificationDate:t||void 0,direction:a,number:i||void 0,filter:r||L.ConversationFilter.ALL,sortByLastItem:!!n}};A(L.ContentType.CONVERSATION,s,function(e,t){f(e,t,o,!0)&&o(null,t.conversation.getConversations.conversations)},null,["response.conversation.getConversations.conversations"])},this.getSupportConversation=function(n){n=n||d,c.debug("[ClientApiHandler]: getSupportConversation...");var e={type:L.ConversationActionType.GET_SUPPORT_CONVERSATION};A(L.ContentType.CONVERSATION,e,function(e,t){f(e,t,n)&&n(null,t.conversation.getSupportConversation.conversation)},null,["response.conversation.getSupportConversation.conversation.topLevelItem"])},this.getSupportConversationId=function(n){n=n||d,c.debug("[ClientApiHandler]: getSupportConversationId...");var e={type:L.ConversationActionType.GET_SUPPORT_CONVERSATION_ID};A(L.ContentType.CONVERSATION,e,function(e,t){f(e,t,n)&&n(null,t.conversation.getSupportConversationId.conversationId)})},this.getTelephonyConversationId=function(n){n=n||d,c.debug("[ClientApiHandler]: getTelephonyConversationId...");var e={type:L.ConversationActionType.GET_TELEPHONY_CONVERSATION_ID};A(L.ContentType.CONVERSATION,e,function(e,t){f(e,t,n)&&n(null,t.conversation.getTelephonyConversationId.conversationId)})},this.getMarkedConversationsList=function(n){n=n||d,c.debug("[ClientApiHandler]: getMarkedConversationsList...");var e={type:L.ConversationActionType.GET_MARKED_CONVERSATIONS_LIST};A(L.ContentType.CONVERSATION,e,function(e,t){f(e,t,n)&&n(null,t.conversation.getMarkedConversationsList)})},this.getFavoriteConversationIds=function(n){n=n||d,c.debug("[ClientApiHandler]: getFavoriteConversationIds...");var e={type:L.ConversationActionType.GET_FAVORITE_CONVERSATION_IDS};A(L.ContentType.CONVERSATION,e,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getFavoriteConversationIdResult.favoriteConversationIds)})},this.markConversation=function(e,n){n=n||d;var t={type:L.ConversationActionType.MARK_CONVERSATION,markConversation:{convId:e.convId,filter:e.markType}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null)})},this.unmarkConversation=function(e,n){n=n||d;var t={type:L.ConversationActionType.UNMARK_CONVERSATION,unmarkConversation:{convId:e.convId,filter:e.markType}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null)})},this.getConversationUserData=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getConversationUserData..."),e instanceof Array||(e=[e]);var i={type:L.ConversationActionType.GET_CONVERSATION_USER_DATA,getConversationUserData:{conversationId:e,userDataToInclude:t||void 0}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.getConversationUserData.userData)})},this.getConversationItems=function(e,t,n,i,r,o){o=o||d,c.debug("[ClientApiHandler]: getConversationItems...");var a={type:L.ConversationActionType.GET_ITEMS_BY_CONVERSATION,getItemsByConversation:{convId:e,modificationDate:t||void 0,creationDate:n||void 0,direction:i||void 0,number:r||void 0}};A(L.ContentType.CONVERSATION,a,function(e,t){f(e,t,o,!0)&&o(null,t.conversation.getItemsByConversation.items)},null,["response.conversation.getItemsByConversation.items.[].attachments","response.conversation.getItemsByConversation.items.[].externalAttachments","response.conversation.getItemsByConversation.items.[].rtc","response.conversation.getItemsByConversation.items.[].text","response.conversation.getItemsByConversation.items.[].system"])},this.getConversationAttachments=function(e,t,r){r=r||d,c.debug("[ClientApiHandler]: getConversationAttachments...");var n={type:L.ConversationActionType.GET_ATTACHMENTS,getAttachments:{conversationId:e,startPage:t.page||void 0,pageSize:t.size||void 0,orderType:t.type||void 0,orderDirection:t.direction||void 0}};A(L.ContentType.CONVERSATION,n,function(e,t){if(f(e,t,r)){var n=t.conversation.getAttachments.attachments||[],i=t.conversation.getAttachments.nextPage.hasMoreAttachments?t.conversation.getAttachments.nextPage.lastIndex:null;r(null,n,i)}})},this.getItemsByConversationItemId=function(e,t,n,i,r,o){o=o||d,c.debug("[ClientApiHandler]: getItemsByConversationItemId...");var a={type:L.ConversationActionType.GET_ITEMS_BY_CONVERSATION_ITEM_ID,getItemsByConversationItemId:{convId:e,itemId:t,direction:n||void 0,number:i||void 0,orderType:r||void 0}};A(L.ContentType.CONVERSATION,a,function(e,t){f(e,t,o,!0)&&o(null,t.conversation.getItemsByConversationItemId.items)},null,["response.conversation.getItemsByConversationItemId.items.[].attachments","response.conversation.getItemsByConversationItemId.items.[].externalAttachments","response.conversation.getItemsByConversationItemId.items.[].rtc","response.conversation.getItemsByConversationItemId.items.[].text","response.conversation.getItemsByConversationItemId.items.[].system"])},this.getConversationById=function(e,i){i=i||d,c.debug("[ClientApiHandler]: getConversationById...");var t={type:L.ConversationActionType.GET_CONVERSATION_BY_ID,getConversationById:{convId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){if(f(e,t,i)){var n=t.conversation.getConversationById.conversation;n&&n.participants&&c.info("[ClientApiHandler]: Retrieved conversation has "+n.participants.length+" participant(s)"),i(null,n)}},null,["response.conversation.getConversationById.conversation.participants","response.conversation.getConversationById.conversation.topic","response.conversation.getConversationById.conversation.description","response.conversation.getConversationById.conversation.topLevelItem"])},this.getConversationsByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConversationsByIds...");var t={type:L.ConversationActionType.GET_CONVERSATIONS_BY_IDS,getConversationsByIds:{conversationId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getConversationsByIdsResult.conversations)},null,["response.conversation.getConversationsByIdsResult.conversations"])},this.getItemById=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getItemById...");var t={type:L.ConversationActionType.GET_ITEM_BY_ID,getItemById:{itemId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.getItemById.item)},null,["response.conversation.getItemById.item.attachments","response.conversation.getItemById.item.externalAttachments","response.conversation.getItemById.item.rtc","response.conversation.getItemById.item.text","response.conversation.getItemById.item.system"])},this.getItemsByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getItemsByIds...");var t={type:L.ConversationActionType.GET_ITEMS_BY_IDS,getItemsByIds:{itemIds:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getItemsByIds.items)},null,["response.conversation.getItemsByIds.items.[].attachments","response.conversation.getItemsByIds.items.[].externalAttachments","response.conversation.getItemsByIds.items.[].rtc","response.conversation.getItemsByIds.items.[].text","response.conversation.getItemsByIds.items.[].system"])},this.setReadPointer=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setReadPointer...");var i={type:L.ConversationActionType.SET_READ_POINTER,setReadPointer:{convId:e,lastReadTimestamp:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null)})},this.getConversationByUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConversationByUser...");var t={type:L.ConversationActionType.GET_CONVERSATION_BY_USER,getConversationByUser:{userId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.getConversationByUser.conversation)},null,["response.conversation.getConversationByUser.conversation.topic","response.conversation.getConversationByUser.conversation.description","response.conversation.getConversationByUser.conversation.topLevelItem"])},this.getConversationsByFilter=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConversationsByFilter...");var t={type:L.ConversationActionType.GET_CONVERSATIONS_BY_FILTER,getConversationsByFilter:{conversationsFilter:e.filterConnector,timestamp:e.timestamp||void 0,number:e.number,numberOfParticipants:e.numberOfParticipants,retrieveAction:e.retrieveAction||void 0}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.getConversationsByFilterResult||{})},null,["response.conversation.getConversationsByFilterResult.conversations"])},this.subscribe=function(e,n){n=n||d,c.debug("[ClientApiHandler]: subscribe...");var t={type:L.ConversationActionType.SUBSCRIBE,subscribe:{conversationId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null)})},this.unsubscribe=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unsubscribe...");var t={type:L.ConversationActionType.UNSUBSCRIBE,unsubscribe:{conversationId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null)})},this.typing=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: typing...");var r={type:L.ConversationActionType.TYPING,typing:{conversationId:e,isTyping:t,parentItemId:n}};A(L.ContentType.CONVERSATION,r,function(e,t){f(e,t,i)&&i(null)})},this.addParticipant=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addParticipant...");var t={type:L.ConversationActionType.ADD_PARTICIPANT,addParticipant:{convId:e.convId,userId:e.userId,locale:e.locale}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.addParticipant)})},this.removeParticipant=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: removeParticipant..."),!t||t instanceof Array||(t=[t]);var i={type:L.ConversationActionType.REMOVE_PARTICIPANT,removeParticipant:{convId:e,userId:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.removeParticipant.conversation)})},this.hardRemoveParticipant=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: hardRemoveParticipant..."),!t||t instanceof Array||(t=[t]);var i={type:L.ConversationActionType.REMOVE_PARTICIPANT,removeParticipant:{convId:e,userId:t,hardRemove:!0}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.removeParticipant.conversation)})},this.getConversationParticipants=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getConversationParticipants..."),t=t||{};var i={type:L.ConversationActionType.GET_CONVERSATION_PARTICIPANTS,getConversationParticipants:{convId:e,searchCriterias:t.searchCriterias||void 0,searchPointer:t.searchPointer||void 0,pageSize:t.pageSize||25,includePresence:!!t.includePresence}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.getConversationParticipantsResult)})},this.getConversationDetails=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConversationDetails...");var t={type:L.ConversationActionType.GET_CONVERSATION_DETAILS,getConversationDetails:{conversationId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.conversationDetails)},null,["response.conversation.conversationDetails.joinDetails.link","response.conversation.conversationDetails.joinDetails.tenantPIN","response.conversation.conversationDetails.joinDetails.sessionPIN"])},this.getConversationIdsRemovedFrom=function(e,n){c.debug("[ClientApiHandler]: getConversationIdsRemovedFrom...");var t={type:L.ConversationActionType.GET_CONVERSATION_IDS_REMOVED_FROM,getConversationIdsRemovedFrom:{timestamp:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.conversationIdsRemovedFrom.conversationIds)})},this.getJoinDetails=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getJoinDetails...");var i={type:L.ConversationActionType.GET_JOIN_DETAILS,getJoinDetails:{conversationId:e,recreate:!!t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.getJoinDetails)},null,["response.conversation.getJoinDetails.link","response.conversation.getJoinDetails.tenantPIN","response.conversation.getJoinDetails.sessionPIN"])},this.setFlagItem=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: setFlagItem..."),!e)return c.warn("[ClientApiHandler]: No request parameters were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var t={type:L.ConversationActionType.SET_FLAG_ITEM,setFlagItem:{conversationId:e.convId,conversationItemId:e.itemId,conversationItemCreationTime:e.creationTime,conversationParentId:e.parentId}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null)})},this.clearFlagItem=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: clearFlagItem...");var i={type:L.ConversationActionType.CLEAR_FLAG_ITEM,clearFlagItem:{conversationId:e,conversationItemId:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null)})},this.getFlaggedItems=function(n){n=n||d,c.debug("[ClientApiHandler]: getFlaggedItems...");var e={type:L.ConversationActionType.GET_FLAGGED_ITEMS};A(L.ContentType.CONVERSATION,e,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getFlaggedItem.flaggedItems)})},this.likeTextItem=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: likeTextItem...");var i={type:L.ConversationActionType.LIKE_TEXT_ITEM,likeTextItem:{conversationItemId:e,userId:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null)})},this.unlikeTextItem=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: unlikeTextItem...");var i={type:L.ConversationActionType.UNLIKE_TEXT_ITEM,unlikeTextItem:{conversationItemId:e,userId:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null)})},this.setConvAvatar=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setConvAvatar...");var i={type:L.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:e,imageS:t.s,imageL:t.b}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.setConversationAvatar.conversation)})},this.deleteConvAvatar=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteConvAvatar...");var t={type:L.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:e,imageS:"",imageL:""}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.setConversationAvatar.conversation)})},this.moderateConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: moderateConversation...");var t={type:L.ConversationActionType.MODERATE_CONVERSATION,moderateConversation:{convId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.moderateResult)})},this.unmoderateConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unmoderateConversation...");var t={type:L.ConversationActionType.UNMODERATE_CONVERSATION,unmoderateConversation:{convId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.moderateResult)})},this.setConversationRetentionPolicy=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setConversationRetentionPolicy...");var i={type:L.ConversationActionType.SET_CONVERSATION_RETENTION_POLICY,setConversationRetentionPolicy:{convId:e,disabled:!!t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null)})},this.updateGuestAccess=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: updateGuestAccess...");var i={type:L.ConversationActionType.UPDATE_GUEST_ACCESS,updateGuestAccess:{convId:e,guestAccessDisabled:!!t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.updateGuestAccessResult)})},this.getConversationSummary=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getConversationSummary...");var i={type:L.ConversationActionType.GET_CONVERSATION_SUMMARY,getConversationSummary:{convId:e}};t&&(i.getConversationSummary.inviteToken={token:t}),A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.getConversationSummary.conversationSummary)})},this.grantModeratorRights=function(e,t,n){n=n||d,t instanceof Array||(t=[t]),c.debug("[ClientApiHandler]: grantModeratorRights...");var i={type:L.ConversationActionType.GRANT_MODERATOR_RIGHTS,grantModeratorRights:{convId:e,userId:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.grantModeratorRightsResult)})},this.dropModeratorRights=function(e,t,n){n=n||d,t instanceof Array||(t=[t]),c.debug("[ClientApiHandler]: dropModeratorRights...");var i={type:L.ConversationActionType.DROP_MODERATOR_RIGHTS,dropModeratorRights:{convId:e,userId:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.dropModeratorRightsResult)})},this.takeModerationRight=function(e,n){n=n||d,c.debug("[ClientApiHandler]: takeModerationRight...");var t={type:L.ConversationActionType.TAKE_MODERATION_RIGHT,takeModerationRight:{convId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.takeModerationRightResult.moderationTakenResult)})},this.addJournalEntry=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addJournalEntry...");var t={type:L.ConversationActionType.ADD_JOURNAL_ENTRY,addJournalEntry:{convId:e.convId,starter:e.starter,source:e.source,destination:e.destination,startTime:e.startTime,duration:e.duration,type:e.type,participants:e.participants,missedReason:e.missedReason}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null)})},this.setFavoritePosition=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setFavoritePosition...");var i={type:L.ConversationActionType.SET_FAVORITE_POSITION,setFavoritePosition:{convId:e,position:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t)})},this.addLabels=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addLabels...");var t={type:L.ConversationActionType.ADD_LABELS,addLabels:{labels:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.addLabelsResult)},["request.conversation.addLabels.labels"],["response.conversation.addLabelsResult.labels.[].value"])},this.assignLabels=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: assignLabels...");var i={type:L.ConversationActionType.ASSIGN_LABELS,assignLabels:{convId:e,labelIds:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.assignLabelsResult.labelIds)})},this.unassignLabels=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: unassignLabels...");var i={type:L.ConversationActionType.UNASSIGN_LABELS,unassignLabels:{convId:e,labelIds:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.unassignLabelsResult.labelIds)})},this.getAllLabels=function(n){n=n||d,c.debug("[ClientApiHandler]: getAllLabels...");var e={type:L.ConversationActionType.GET_LABELS};A(L.ContentType.CONVERSATION,e,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getLabelsResult.labels)},null,["response.conversation.getLabelsResult.labels"])},this.removeLabels=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeLabels...");var t={type:L.ConversationActionType.REMOVE_LABELS,removeLabels:{labelIds:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.removeLabelsResult.labelIds)})},this.editLabel=function(e,n){n=n||d,c.debug("[ClientApiHandler]: editLabel...");var t={type:L.ConversationActionType.EDIT_LABEL,editLabel:{label:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.editLabelResult.label)},["request.conversation.editLabel.label.value"],["response.conversation.editLabelResult.label.value"])},this.addFilter=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: addFilter...");var i={type:L.ConversationActionType.ADD_FILTER,addFilter:{filterName:e,root:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.addFilterResult)})},this.removeFilter=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeFilters...");var t={type:L.ConversationActionType.REMOVE_FILTERS,removeFilters:{filterIds:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.removeFiltersResult.filterIds)})},this.getAllFilters=function(n){n=n||d,c.debug("[ClientApiHandler]: getAllFilters...");var e={type:L.ConversationActionType.GET_FILTERS,getFilters:{}};A(L.ContentType.CONVERSATION,e,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getFiltersResult.filters)})},this.editFilter=function(e,n){n=n||d,c.debug("[ClientApiHandler]: editFilter...");var t={type:L.ConversationActionType.EDIT_FILTER,editFilter:{filter:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.editFilterResult)})},this.getUserDataSince=function(e,i){i=i||d,c.debug("[ClientApiHandler]: getUserDataSince...");var t={type:L.ConversationActionType.GET_USER_DATA_SINCE,getUserDataSince:{sinceTime:e}};A(L.ContentType.CONVERSATION,t,function(e,t){if(f(e,t,i,!0)){var n=t.conversation.getUserDataSinceResult&&t.conversation.getUserDataSinceResult.changedUserData||[];i(null,n)}})},this.getConferenceInvitationText=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getConferenceInvitationText...");var i={type:L.ConversationActionType.GET_CONFERENCE_INVITATION_TEXT,getConferenceInvitationText:{conversationId:t,language:e}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.getConferenceInvitationResult.invitationMessage)},null,["response.conversation.getConferenceInvitationResult.invitationMessage"])},this.getConferenceInvitationExample=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getConferenceInvitationExample...");var i={type:L.ConversationActionType.GET_CONFERENCE_INVITATION_EXAMPLE,getConferenceInvitationExample:{language:e}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null,t.conversation.getConferenceInvitationResult.invitationMessage)},null,null,t)},this.deleteCallLog=function(e,n){var t={type:L.ConversationActionType.DELETE_JOURNAL_ENTRY,deleteJournalEntry:{journalEntryId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null)})},this.getJournalEntries=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getJournalEntries...");var t={type:L.ConversationActionType.GET_JOURNAL_ENTRIES,getJournalEntries:{telephonyConversationId:e.convId,timestamp:e.timestamp||void 0,direction:e.direction||void 0,numberOfEntries:e.numberOfEntries||void 0,journalFilter:e.journalFilter||void 0}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.conversation.getJournalEntriesResult.entries)},null,["response.conversation.getJournalEntriesResult.entries"])},this.setVoicemailAsHeard=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setVoicemailAsHeard...");var t={type:L.ConversationActionType.SET_VOICEMAIL_HEARD,setVoicemailHeard:{journalEntryId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null)})},this.getUnheardVoicemailsCount=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getUnheardVoicemailCount...");var t={type:L.ConversationActionType.GET_UNHEARD_VOICEMAILS_COUNT,getUnheardVoicemailsCount:{conversationId:e}};A(L.ContentType.CONVERSATION,t,function(e,t){f(e,t,n)&&n(null,t.conversation.getUnheardVoicemailsCountResult.unheardVoicemailsCount||0)})},this.setRecordingDeletionDelay=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setRecordingDeletionDelay...");var i={type:L.ConversationActionType.SET_RECORDING_DELETION_DELAY,setRecordingDeletionDelay:{itemId:e,extendedDelay:!!t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null)})},this.deleteAllCallLogs=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: deleteAllCallLogs...");var i={type:L.ConversationActionType.DELETE_ALL_JOURNAL_ENTRIES,deleteAllJournalEntries:{telephonyConversationId:e,journalFilter:t}};A(L.ContentType.CONVERSATION,i,function(e,t){f(e,t,n)&&n(null)})},this.joinRtcCall=function(e,n){n=n||d,c.debug("[ClientApiHandler]: joinRtcCall...");var t={type:L.RTCCallActionType.JOIN,join:O(e)};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null)})},this.answerRtcCall=function(e,n){n=n||d,c.debug("[ClientApiHandler]: answerRtcCall...");var t={type:L.RTCCallActionType.ANSWER,answer:O(e)};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null)})},this.sendIceCandidates=function(e,n){n=n||d,c.debug("[ClientApiHandler]: sendIceCandidates...");var t={type:L.RTCCallActionType.ICE_CANDIDATES,iceCandidates:{rtcSessionId:e.rtcSessionId,userId:e.userId,origin:e.origin,candidates:e.candidates}};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null)})},this.leaveRtcCall=function(e,t,n){t=t||{},n=n||d,c.debug("[ClientApiHandler]: leaveRtcCall...");var i={type:L.RTCCallActionType.LEAVE,leave:{rtcSessionId:e,disconnectCause:t.cause,disconnectReason:t.reason}};A(L.ContentType.RTC_CALL,i,function(e,t){f(e,t,n)&&n(null)})},this.terminateRtcCall=function(e,t,n,i){t=t||{},n=n||d,c.debug("[ClientApiHandler]: terminateRtcCall...");var r={type:L.RTCCallActionType.TERMINATE,terminate:{rtcSessionId:e,disconnectCause:t.cause,disconnectReason:t.reason,pickUpUser:i||void 0,cause:i?L.TerminateCause.PICKED_UP:void 0}};A(L.ContentType.RTC_CALL,r,function(e,t){f(e,t,n)&&n(null)})},this.declineRtcCall=function(e,n){n=n||d,c.debug("[ClientApiHandler]: declineRtcCall...");var t={type:L.RTCCallActionType.INVITE_REJECT,inviteReject:{convId:e.convId,rtcSessionId:e.rtcSessionId,cause:e.cause,transactionId:e.transactionId}};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null)})},this.changeMediaType=function(e,n){n=n||d,c.debug("[ClientApiHandler]: changeMediaType...");var t={type:L.RTCCallActionType.CHANGE_MEDIA_TYPE,changeMediaType:{rtcSessionId:e.rtcSessionId,sdp:e.sdp,mediaTypes:_(e.mediaType),transactionId:e.transactionId,screenSharePointerSupported:e.screenSharePointerSupported,hosted:e.hosted,replaces:e.replaces,rtcSupportedFeatures:e.rtcSupportedFeatures,videoPointerTo:e.videoPointerTo}};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null)})},this.changeMediaAccept=function(e,n){n=n||d,c.debug("[ClientApiHandler]: changeMediaAccept...");var t={type:L.RTCCallActionType.CHANGE_MEDIA_ACCEPT,changeMediaAccept:{rtcSessionId:e.rtcSessionId,sdp:e.sdp,transactionId:e.transactionId}};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null)})},this.changeMediaReject=function(e,n){n=n||d,c.debug("[ClientApiHandler]: changeMediaReject...");var t={type:L.RTCCallActionType.CHANGE_MEDIA_REJECT,changeMediaReject:{rtcSessionId:e.rtcSessionId,transactionId:e.transactionId}};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null)})},this.prepareSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: prepareSession... ");var t={type:L.RTCCallActionType.PREPARE,prepare:{convId:e.convId,rtcSessionId:e.rtcSessionId,ownerId:e.ownerId,mediaNode:e.mediaNode,desiredRegion:e.desiredRegion||"",isTelephonyConversation:e.isTelephonyConversation,replaces:e.replaces}};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null,t.rtcCall.prepare.servers,t.rtcCall.prepare.newRtcSessionId)},null,["response.rtcCall.prepare.servers.[].password"])},this.renewTurnCredentials=function(e,n){n=n||d,c.debug("[ClientApiHandler]: renewTurnCredentials... ");var t={type:L.RTCCallActionType.RENEW_TURN_CREDENTIALS,renewTurnCredentials:{rtcSessionId:e}};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null,t.rtcCall.renewTurnCredentials.servers)},null,["response.rtcCall.renewTurnCredentials.servers.[].password"])},this.sendProgress=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: sendProgress... ");var r={type:L.RTCCallActionType.SEND_PROGRESS,sendProgress:{rtcSessionId:e,userId:n,invitingUser:t||"",type:L.RTCProgressType.ALERTING}};A(L.ContentType.RTC_CALL,r,function(e,t){f(e,t,i)&&i(null)})},this.submitCallQualityRating=function(e,n){n=n||d,c.debug("[ClientApiHandler]: submitCallQualityRating...");var t={type:L.RTCCallActionType.SUBMIT_RTC_QUALITY_RATING,submitRtcQualityRating:{rating:e}};A(L.ContentType.RTC_CALL,t,function(e,t){f(e,t,n)&&n(null)})},this.mergeRtcCalls=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: mergeRtcCalls ...");var i={type:L.RTCCallActionType.MERGE,merge:{sourceRtcSessionId:e,targetRtcSessionId:t}};A(L.ContentType.RTC_CALL,i,function(e,t){f(e,t,n)&&n(null)})},this.lockRtcSession=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: lockRtcSession...");var i={type:L.RTCSessionActionType.LOCK,lock:{rtcSessionId:e,locked:!!t}};A(L.ContentType.RTC_SESSION,i,function(e,t){f(e,t,n)&&n(null)})},this.muteRtcSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: muteRtcSession...");var t={type:L.RTCSessionActionType.MUTE_SESSION,muteSession:{rtcSessionId:e.rtcSessionId,muted:!!e.muted,excludedUserIds:e.excludedUserIds||void 0}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.muteParticipant=function(e,n){n=n||d,c.debug("[ClientApiHandler]: muteParticipant...");var t={type:L.RTCSessionActionType.MUTE,mute:{rtcSessionId:e.rtcSessionId,muted:!!e.muted,userIds:e.usersIds||void 0}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.addParticipantToRtcSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addParticipantToRtcCall...");var t={type:L.RTCSessionActionType.ADD_PARTICIPANT,addParticipant:{rtcSessionId:e.rtcSessionId,userId:e.userId,from:e.from,to:e.to,mediaType:_(e.mediaType)}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.removeSessionParticipant=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeSessionParticipant...");var t={type:L.RTCSessionActionType.REMOVE_PARTICIPANT,removeParticipant:{rtcSessionId:e.rtcSessionId,userId:e.userId}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.getActiveSessions=function(n){n=n||d,c.debug("[ClientApiHandler]: getActiveSessions...");var e={type:L.RTCSessionActionType.GET_ACTIVE_SESSIONS};A(L.ContentType.RTC_SESSION,e,function(e,t){f(e,t,n,!0)&&n(null,t.rtcSession.activeSessions.session)})},this.getSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getSession...");var t={type:L.RTCSessionActionType.GET_SESSION,getSession:{rtcSessionId:e}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null,t.rtcSession.getSession.session)})},this.moveRtcSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: moveRtcSession...");var t={type:L.RTCSessionActionType.MOVE,move:{oldRtcSessionId:e.sessionId,oldConversationId:e.conversationId,newConversationId:e.newConversationId,newRtcSessionId:e.newSessionId}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.startRecording=function(e,n){n=n||d,c.debug("[ClientApiHandler]: startRecording...");var t={type:L.RTCSessionActionType.START_RECORDING,startRecording:{convId:e.convId,rtcSessionId:e.rtcSessionId,recordingMediaTypes:g(e.recordingMediaTypes)}};e.videoLayout&&(t.startRecording.layout=e.videoLayout),A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.stopRecording=function(e,n){n=n||d,c.debug("[ClientApiHandler]: stopRecording...");var t={type:L.RTCSessionActionType.STOP_RECORDING,stopRecording:{convId:e.convId,rtcSessionId:e.rtcSessionId,recordingMediaTypes:g(e.recordingMediaTypes)}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.switchRecordingLayout=function(e,n){n=n||d,c.debug("[ClientApiHandler]: switchRecordingLayout...");var t={type:L.RTCSessionActionType.SWITCH_RECORDING_LAYOUT,switchRecordingLayout:{rtcSessionId:e.rtcSessionId,layout:e.videoLayout}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.requestScreenControl=function(e,n){n=n||d,c.debug("[ClientApiHandler]: requestScreenControl ...");var t={type:L.RTCSessionActionType.REQUEST_SCREEN_CONTROL,requestScreenControl:{rtcSessionId:e.rtcSessionId,ownerId:e.ownerId}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.offerScreenControl=function(e,n){n=n||d,c.debug("[ClientApiHandler]: offerScreenControl ...");var t={type:L.RTCSessionActionType.OFFER_SCREEN_CONTROL,offerScreenControl:{sdp:e.sdp,rtcSessionId:e.rtcSessionId,controllerId:e.controllerId||void 0}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.acceptScreenControl=function(e,n){n=n||d,c.debug("[ClientApiHandler]: acceptScreenControl ...");var t={type:L.RTCSessionActionType.ACCEPT_SCREEN_CONTROL,acceptScreenControl:{sdp:e.sdp,rtcSessionId:e.rtcSessionId}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.rejectScreenControl=function(e,n){n=n||d,c.debug("[ClientApiHandler]: rejectScreenControl ...");var t={type:L.RTCSessionActionType.REJECT_SCREEN_CONTROL,rejectScreenControl:{rtcSessionId:e.rtcSessionId}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.rejectScreenControlRequest=function(e,n){n=n||d,c.debug("[ClientApiHandler]: rejectScreenControlRequest ...");var t={type:L.RTCSessionActionType.REJECT_SCREEN_CONTROL_REQUEST,rejectScreenControlRequest:{rtcSessionId:e.rtcSessionId,controllerId:e.controllerId}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.stopScreenControl=function(e,n){n=n||d,c.debug("[ClientApiHandler]: stopScreenControl ...");var t={type:L.RTCSessionActionType.STOP_SCREEN_CONTROL,stopScreenControl:{rtcSessionId:e.rtcSessionId}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.setVideoReceiverConfiguration=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setVideoReceiverConfiguration ...");var t={type:L.RTCSessionActionType.SET_VIDEO_RECEIVER_CONFIGURATION,setVideoReceiverConfiguration:{rtcSessionId:e.rtcSessionId,configuration:e.configuration}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.raiseQuestion=function(e,n){n=n||d,c.debug("[ClientApiHandler]: raiseQuestion...");var t={type:L.RTCSessionActionType.RAISE_QUESTION,raiseQuestion:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null,t.rtcSession.raiseQuestion.questionNumber)},["request.rtcSession.raiseQuestion.question"])},this.inviteToStage=function(e,n){n=n||d,c.debug("[ClientApiHandler]: inviteToStage..."),e.allowedMediaTypes=e.allowedMediaTypes||_();var t={type:L.RTCSessionActionType.INVITE_TO_STAGE,inviteToStage:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.inviteToStageAnswer=function(e,n){n=n||d,c.debug("[ClientApiHandler]: inviteToStageAnswer...");var t={type:L.RTCSessionActionType.INVITE_TO_STAGE_ANSWER,inviteToStageAnswer:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.inviteToStageCancel=function(e,n){n=n||d,c.debug("[ClientApiHandler]: inviteToStageCancel...");var t={type:L.RTCSessionActionType.INVITE_TO_STAGE_CANCEL,inviteToStageCancel:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.removeFromStage=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeFromStage...");var t={type:L.RTCSessionActionType.REMOVE_FROM_STAGE,removeFromStage:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.getQuestions=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getQuestions...");var t={type:L.RTCSessionActionType.GET_QUESTIONS,getQuestions:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n,!0)&&n(null,t.rtcSession.getQuestions.questions||[])})},this.updateQuestionState=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateQuestionState...");var t={type:L.RTCSessionActionType.UPDATE_QUESTION_STATE,updateQuestionState:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.openCurtain=function(e,n){n=n||d,c.debug("[ClientApiHandler]: openCurtain...");var t={type:L.RTCSessionActionType.OPEN_CURTAIN,openCurtain:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.closeCurtain=function(e,n){n=n||d,c.debug("[ClientApiHandler]: closeCurtain...");var t={type:L.RTCSessionActionType.CLOSE_CURTAIN,closeCurtain:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.getNodeState=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getNodeState...");var t={type:L.RTCSessionActionType.GET_NODE_STATE,getNodeState:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n,!0)&&n(null,t.rtcSession.getNodeState.nodeData)})},this.enableWhiteboard=function(e,n){n=n||d,c.debug("[ClientApiHandler]: enableWhiteboard...");var t={type:L.RTCSessionActionType.ENABLE_WHITEBOARD,enableWhiteboard:{rtcSessionId:e.rtcSessionId,viewbox:e.viewbox}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n,!0)&&n(null)})},this.disableWhiteboard=function(e,n){n=n||d,c.debug("[ClientApiHandler]: disableWhiteboard...");var t={type:L.RTCSessionActionType.DISABLE_WHITEBOARD,disableWhiteboard:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n,!0)&&n(null)})},this.addWhiteboardElement=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addWhiteboardElement...");var t={type:L.RTCSessionActionType.ADD_WHITEBOARD_ELEMENT,addWhiteboardElement:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n,!0)&&n(null)})},this.removeWhiteboardElement=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeWhiteboardElement...");var t={type:L.RTCSessionActionType.REMOVE_WHITEBOARD_ELEMENT,removeWhiteboardElement:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n,!0)&&n(null)})},this.updateWhiteboardElement=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateWhiteboardElement...");var t={type:L.RTCSessionActionType.UPDATE_WHITEBOARD_ELEMENT,updateWhiteboardElement:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n,!0)&&n(null)})},this.clearWhiteboard=function(e,n){n=n||d,c.debug("[ClientApiHandler]: clearWhiteboard...");var t={type:L.RTCSessionActionType.CLEAR_WHITEBOARD,clearWhiteboard:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n,!0)&&n(null)})},this.getWhiteboard=function(e,i){i=i||d,c.debug("[ClientApiHandler]: getWhiteboard...");var t={type:L.RTCSessionActionType.GET_WHITEBOARD,getWhiteboard:e};A(L.ContentType.RTC_SESSION,t,function(e,t){if(f(e,t,i)){var n=t.rtcSession.getWhiteboard.whiteboard;w.normalizeWhiteboard(n,I),i(null,n)}})},this.setWhiteboardBackground=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setWhiteboardBackground...");var t={type:L.RTCSessionActionType.SET_WHITEBOARD_BACKGROUND,setWhiteboardBackground:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.clearWhiteboardBackground=function(e,n){n=n||d,c.debug("[ClientApiHandler]: clearWhiteboardBackground...");var t={type:L.RTCSessionActionType.CLEAR_WHITEBOARD_BACKGROUND,clearWhiteboardBackground:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.toggleWhiteboardOverlay=function(e,n){n=n||d,c.debug("[ClientApiHandler]: toggleWhiteboardOverlay...");var t={type:L.RTCSessionActionType.TOGGLE_WHITEBOARD_OVERLAY,toggleWhiteboardOverlay:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.undoWhiteboard=function(e,n){n=n||d,c.debug("[ClientApiHandler]: undoWhiteboard...");var t={type:L.RTCSessionActionType.UNDO_WHITEBOARD,undoWhiteboard:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.sendClientInfo=function(e,n){n=n||d,c.debug("[ClientApiHandler]: sendClientInfo...");var t={type:L.RTCSessionActionType.SEND_CLIENT_INFO,sendClientInfo:{clientInfo:e}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.enableConferencePoll=function(e,n){n=n||d,c.debug("[ClientApiHandler]: enableConferencePoll...");var t={type:L.RTCSessionActionType.ENABLE_POLL,enablePoll:{rtcSessionId:e}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.closeConferencePoll=function(e,n){n=n||d,c.debug("[ClientApiHandler]: closeConferencePoll...");var t={type:L.RTCSessionActionType.CLOSE_POLL,closePoll:{rtcSessionId:e}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.disableConferencePoll=function(e,n){n=n||d,c.debug("[ClientApiHandler]: disableConferencePoll...");var t={type:L.RTCSessionActionType.DISABLE_POLL,disablePoll:{rtcSessionId:e}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.getConferencePoll=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConferencePoll...");var t={type:L.RTCSessionActionType.GET_POLL,getPoll:{rtcSessionId:e}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null,t.rtcSession.getPoll.poll)},null,["response.rtcSession.getPoll.poll.question","response.rtcSession.getPoll.poll.choices.[].choiceText"])},this.makePollResultsVisible=function(e,n){n=n||d,c.debug("[ClientApiHandler]: makePollResultsVisible...");var t={type:L.RTCSessionActionType.MAKE_POLL_RESULTS_VISIBLE,makePollResultsVisible:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.startConferencePoll=function(e,n){n=n||d,c.debug("[ClientApiHandler]: startConferencePoll...");var t={type:L.RTCSessionActionType.START_POLL,startPoll:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)},["request.rtcSession.startPoll.question","request.rtcSession.startPoll.choices"])},this.resumeConferencePoll=function(e,n){n=n||d,c.debug("[ClientApiHandler]: resumeConferencePoll...");var t={type:L.RTCSessionActionType.RESUME_POLL,resumePoll:{rtcSessionId:e}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.stopConferencePoll=function(e,n){n=n||d,c.debug("[ClientApiHandler]: stopConferencePoll...");var t={type:L.RTCSessionActionType.STOP_POLL,stopPoll:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null,t.rtcSession.stopPoll.poll)},null,["response.rtcSession.stopPoll.poll.question","response.rtcSession.stopPoll.poll.choices.[].choiceText"])},this.voteConferencePoll=function(e,n){n=n||d,c.debug("[ClientApiHandler]: voteConferencePoll...");var t={type:L.RTCSessionActionType.VOTE_POLL,votePoll:e};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.exportConferencePoll=function(e,n){n=n||d,c.debug("[ClientApiHandler]: exportConferencePoll...");var t={type:L.RTCSessionActionType.EXPORT_POLL,exportPoll:{rtcSessionId:e}};A(L.ContentType.RTC_SESSION,t,function(e,t){f(e,t,n)&&n(null)})},this.submitClientData=function(e,i){i=i||d,c.debug("[ClientApiHandler]: submitClientData...");var t={type:L.InstrumentationActionType.SUBMIT_CLIENT_DATA,submitClientData:{instrumentationData:e}};A(L.ContentType.INSTRUMENTATION,t,function(e,t){if(f(e,t,i)){var n=t.instrumentation&&t.instrumentation.submitClientData&&t.instrumentation.submitClientData.submitDataResult;i(null,n||L.SubmitDataResult.OK)}})},this.submitQOSData=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: submitQOSData...");var i={type:L.InstrumentationActionType.SUBMIT_QOS_DATA,submitQOSData:{clientTime:Date.now(),dataSets:e}};t&&l<I&&(i.submitQOSData.clientStreamQuality=t),A(L.ContentType.INSTRUMENTATION,i,function(e,t){f(e,t,n)&&n(null)})},this.getNotifications=function(e,t,i){i=i||d,c.debug("[ClientApiHandler]: getNotifications...");var n={type:L.ActivityStreamActionType.GET_ACTIVITIES_BY_USER,getActivitiesByUser:{timestamp:e,numberOfItems:t}},r=E.map(function(e){return"response.activityStream.getActivitiesByUserResult.activityItems.[]."+e});A(L.ContentType.ACTIVITYSTREAM,n,function(e,t){if(f(e,t,i,!0)){var n=t.activityStream.getActivitiesByUserResult;i(null,n)}},null,r)},this.toggleReadUnread=function(e,t,i){i=i||d,c.debug("[ClientApiHandler]: toggleReadUnread...");var n={type:L.ActivityStreamActionType.UPDATE_ACTIVITY_READ,updateActivityReadState:{activityId:e,read:t}};A(L.ContentType.ACTIVITYSTREAM,n,function(e,t){if(f(e,t,i)){var n=t.activityStream.updateResult;i(null,n.updatedItem)}})},this.markAllNotificationsAsRead=function(i){i=i||d,c.debug("[ClientApiHandler]: markAllNotificationsAsRead...");var e={type:L.ActivityStreamActionType.MARK_ALL_READ};A(L.ContentType.ACTIVITYSTREAM,e,function(e,t){if(f(e,t,i)){var n=t.activityStream.markAllReadResult;i(null,n)}})},this.getTenant=function(n){n=n||d,c.debug("[ClientApiHandler]: getTenant...");var e={type:L.AdministrationActionType.GET_TENANT};A(L.ContentType.ADMINISTRATION,e,function(e,t){f(e,t,n)&&n(null,t.administration.getTenant.tenant)})},this.addUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addUser...");var t={type:L.AdministrationActionType.ADD_USER,addUser:{userAttributes:{emailAddress:e.emailAddress,lastName:e.lastName,firstName:e.firstName,locale:e.locale},password:e.password,packageId:e.packageId,accountTemplateId:e.accountTemplateId}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.addUserResult.user)},["request.administration.addUser.password"])},this.addMeetingPointV2=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: addMeetingPointV2...");var i={type:L.AdministrationActionType.ADD_MEETING_POINT_V2,addMeetingPoint:{userAttributes:{emailAddress:e.emailAddress,lastName:e.lastName,firstName:e.firstName,locale:e.locale,location:e.location,registrationCodeTtl:e.timeout||void 0},packageId:e.packageId}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.addMeetingPointV2Result)},null,["response.administration.addMeetingPointV2Result.registrationCode"],t)},this.updateMeetingPointV2=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: updateMeetingPointV2...");var i={type:L.AdministrationActionType.UPDATE_MEETING_POINT_V2,updateMeetingPoint:{userId:e.id,registrationCodeTtl:e.timeout||void 0}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.updateMeetingPointV2Result.registrationCode)},null,["response.administration.updateMeetingPointV2Result.registrationCode"],t)},this.regenerateApiKey=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: regenerateApiKey...");var i={type:L.AdministrationActionType.REGENERATE_API_KEY,regenerateApiKey:{userId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.regenerateApiKey.apiKey)},null,["response.administration.regenerateApiKey.apiKey"],t)},this.addPhoneOnlyUser=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: AddPhoneOnlyUser...");var i={type:L.AdministrationActionType.ADD_PHONE_ONLY_USER,addPhoneOnlyUser:{emailAddress:e.emailAddress||void 0,lastName:e.lastName,firstName:e.firstName,locale:e.locale,packageId:e.packageId}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.addPhoneOnlyUserResult.user)},null,null,t)},this.addSharedDevice=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: addSharedDevice...");var i={type:L.AdministrationActionType.ADD_SHARED_DEVICE,addSharedDevice:{name:e.name,location:e.location||void 0,locale:e.locale||void 0,packageId:e.packageId}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.addSharedDeviceResult.user)},null,null,t)},this.deleteUser=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: deleteUser...");var i={type:L.AdministrationActionType.DELETE_USER,deleteUser:{userId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.inviteUser=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: inviteUser...");var i={type:L.AdministrationActionType.INVITE_USER,inviteUser:{userAttributes:{emailAddress:e.userAttributes.emailAddress,lastName:e.userAttributes.lastName,firstName:e.userAttributes.firstName},packageId:e.packageId,accountTemplateId:e.accountTemplateId}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.inviteUser.resultType)},null,null,t)},this.inviteMultipleUsers=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: inviteMultipleUsers...");var i={type:L.AdministrationActionType.INVITE_MULTIPLE_USERS,inviteMultipleUsers:e};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.invitePartnerUsers=function(e,n){n=n||d,c.debug("[ClientApiHandler]: invitePartnerUsers...");var t={type:L.AdministrationActionType.INVITE_MULTIPLE_PARTNER_USERS,inviteMultiplePartnerUsers:{userAttributes:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null)})},this.resendInvite=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: resendInvite...");var i={type:L.AdministrationActionType.RESEND_USER_INVITATION,resendUserInvitation:{userId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.resendUserInvitation.resultType)},null,null,t)},this.checkInvalidTenant=function(e,n){n=n||d,c.debug("[ClientApiHandler]: checkInvalidTenant...");var t={type:L.AdministrationActionType.CHECK_INVALID_TENANTS,checkInvalidTenants:{tenantIds:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.checkInvalidTenants.tenantIds)})},this.setTelephonyTrunkData=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: setTelephonyTrunkData...");var i={type:L.AdministrationActionType.SET_TELEPHONY_TRUNK_DATA,setTelephonyTrunkData:{defaultCallerId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n()},null,null,t)},this.getTelephonyTrunkStatus=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getTelephonyTrunkStatus...");var t={type:L.AdministrationActionType.GET_TELEPHONY_TRUNK_STATUS};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.getTelephonyTrunkStatus)},null,null,e)},this.getTelephonyTrunkGroups=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getTelephonyTrunkGroups..."),!e)return c.warn("[ClientApiHandler]: No query data provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUPS,getTelephonyTrunkGroups:{pageSize:e.pageSize,pagePointer:e.pagePointer||void 0,includeSharedTrunkGroups:e.includeSharedTrunkGroups||void 0}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getTelephonyTrunkGroupsResult)},null,null,t)},this.getTelephonyTrunkGroup=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: getTelephonyTrunkGroup..."),!e)return c.warn("[ClientApiHandler]: No trunk group id provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var t={type:L.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUP,getTelephonyTrunkGroup:{telephonyTrunkGroupId:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.getTelephonyTrunkGroupResult)})},this.addTelephonyTrunkGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: addTelephonyTrunkGroup..."),!e)return c.warn("[ClientApiHandler]: No trunk group data provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.ADD_TELEPHONY_TRUNK_GROUP,addTelephonyTrunkGroup:{telephonyTrunkGroupName:e.telephonyTrunkGroupName,telephonyTrunkId:e.telephonyTrunkIds}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.addTelephonyTrunkGroupResult)},null,null,t)},this.removeTelephonyTrunkGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: removeTelephonyTrunkGroup..."),!e)return c.warn("[ClientApiHandler]: No trunk group id provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.REMOVE_TELEPHONY_TRUNK_GROUP,removeTelephonyTrunkGroup:{telephonyTrunkGroupId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.removeTelephonyTrunkGroupResult.responseCode)},null,null,t)},this.updateTelephonyTrunkGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateTelephonyTrunkGroup..."),!e)return c.warn("[ClientApiHandler]: No trunk group data provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.UPDATE_TELEPHONY_TRUNK_GROUP,updateTelephonyTrunkGroup:{telephonyTrunkGroupId:e.telephonyTrunkGroupId,telephonyTrunkGroupName:e.telephonyTrunkGroupName,telephonyTrunkId:e.telephonyTrunkIds}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.updateTelephonyTrunkGroupResult)},null,null,t)},this.getTenantBridgeNumbers=function(i,e){i=i||d,c.debug("[ClientApiHandler]: getTenantBridgeNumbers...");var t={type:L.AdministrationActionType.GET_TENANT_BRIDGE_NUMBERS};A(L.ContentType.ADMINISTRATION,t,function(e,t){if(f(e,t,i)){var n=t.administration.getTenantBridgeNumbers;i(null,n&&n.bridgeNumbers||[])}},null,null,e)},this.setTenantBridgeNumbers=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: setTenantBridgeNumbers...");var i={type:L.AdministrationActionType.SET_TENANT_BRIDGE_NUMBERS,setTenantBridgeNumbers:{bridgeNumbers:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n()},null,null,t)},this.getTenantVoicemailNumbers=function(i,e){i=i||d,c.debug("[ClientApiHandler]: getTenantVoicemailNumbers...");var t={type:L.AdministrationActionType.GET_TENANT_VOICEMAIL_NUMBERS};A(L.ContentType.ADMINISTRATION,t,function(e,t){if(f(e,t,i,!0)){var n=t.administration.getTenantVoicemailNumbersResult;i(null,n&&n.voicemailNumber||[])}},null,null,e)},this.setTenantVoicemailNumbers=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: setTenantVoicemailNumbers...");var i={type:L.AdministrationActionType.SET_TENANT_VOICEMAIL_NUMBERS,setTenantVoicemailNumbers:{voicemailNumber:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n()},null,null,t)},this.addAutoConfigurableTrunk=function(n,e){n=n||d,c.debug("[ClientApiHandler]: addAutoConfigurableTrunk...");var t={type:L.AdministrationActionType.ADD_TRUNK_WITHOUT_PARAMETERS};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.addTrunk.configuration)},null,null,e)},this.getTenantTelephonyConfiguration=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getTenantTelephonyConfiguration...");var t={type:L.AdministrationActionType.GET_TENANT_TELEPHONY_CONFIGURATION};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.getTenantTelephonyConfiguration.configuration)},null,["response.administration.getTenantTelephonyConfiguration.configuration.apiKey"],e)},this.getTelephonyRoutingRules=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getTelephonyRoutingRules...");var i={type:L.AdministrationActionType.GET_TELEPHONY_ROUTING_RULES,getTelephonyRoutingRules:{pageSize:e.pageSize,pagePointer:e.pagePointer}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getTelephonyRoutingRulesResult)},null,null,t)},this.addTelephonyRoutingRule=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: addTelephonyRoutingRule...");var i={type:L.AdministrationActionType.ADD_TELEPHONY_ROUTING_RULE,addTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:e.routePosition,condition1:e.condition1,gtcUserId:e.gtcUserId,gtcUserGroupId:e.gtcUserGroupId,operator:e.operator||void 0,condition2:e.condition2||void 0,application:e.application||void 0}}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.updateTelephonyRoutingRule=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: updateTelephonyRoutingRule...");var i={type:L.AdministrationActionType.UPDATE_TELEPHONY_ROUTING_RULE,updateTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:e.routePosition,condition1:e.condition1,gtcUserId:e.gtcUserId,gtcUserGroupId:e.gtcUserGroupId,routeId:e.routeId||void 0,operator:e.operator||void 0,condition2:e.condition2||void 0,application:e.application||void 0}}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.removeTelephonyRoutingRule=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: removeTelephonyRoutingRule...");var i={type:L.AdministrationActionType.REMOVE_TELEPHONY_ROUTING_RULE,removeTelephonyRoutingRule:{telephonyRoutingRuleId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.testTelephonyRoutingRules=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: testTelephonyRoutingRule...");var i={type:L.AdministrationActionType.TEST_TELEPHONY_ROUTING_RULES,testTelephonyRoutingRules:{destination:e.destination,origin:e.origin||void 0,application:e.application||void 0,considerTelephonyConnectorsStates:!!e.considerTelephonyConnectorsStates}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.testTelephonyRoutingRulesResult)},null,null,t)},this.updateTenantTelephonyConfiguration=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: updateTenantTelephonyConfiguration...");var i={type:L.AdministrationActionType.UPDATE_TENANT_TELEPHONY_CONFIGURATION,updateTenantTelephonyConfiguration:{defaultRouting:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.setTrunkPassword=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setTrunkPassword...");var i={type:L.AdministrationActionType.SET_TRUNK_PASSWORD,setTrunkPassword:{trunkId:e,password:t}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},["request.administration.setTrunkPassword.password"])},this.updateTrunk=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateTrunk...");var t={type:L.AdministrationActionType.UPDATE_TRUNK,updateTrunk:{trunkId:e.gtcUserId,displayName:e.gtcTrunkName,defaultCallerId:e.defaultCallerId}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null)})},this.startTrunkSoftSuspension=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: startTrunkSoftSuspension...");var i={type:L.AdministrationActionType.START_TRUNK_SOFT_SUSPENSION,startTrunkSoftSuspension:{trunkId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.cancelTrunkSoftSuspension=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: cancelTrunkSoftSuspension...");var i={type:L.AdministrationActionType.CANCEL_TRUNK_SOFT_SUSPENSION,cancelTrunkSoftSuspension:{trunkId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.getTrunkRemainingCalls=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getTrunkRemainingCalls...");var i={type:L.AdministrationActionType.GET_TRUNK_ACTIVE_CALLS,getTrunkActiveCalls:{trunkId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getTrunkActiveCallsResult.numberOfActiveCalls)},null,null,t)},this.shareTrunkGroup=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: shareTrunkGroup...");var r={type:L.AdministrationActionType.SHARE_TRUNK_GROUP,shareTrunkGroup:{trunkGroupId:e,secTenantId:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null)},null,null,i)},this.unshareTrunkGroup=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: unshareTrunkGroup...");var r={type:L.AdministrationActionType.UNSHARE_TRUNK_GROUP,unshareTrunkGroup:{trunkGroupId:e,secTenantId:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null)},null,null,i)},this.setTenantSettings=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: setTenantSettings...");var i={type:L.AdministrationActionType.SET_TENANT_SETTINGS,setTenantSettings:{tenantSettings:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.updateTenantName=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateTenantName...");var t={type:L.AdministrationActionType.UPDATE_TENANT,updateTenant:{companyName:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null)})},this.getTenantLoginProviders=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getTenantLoginProviders...");var t={type:L.AdministrationActionType.GET_ALL_TENANT_LOGIN_PROVIDERS,getAllTenantLoginProviders:{tenantId:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getAllTenantLoginProvidersResult.tenantLoginProvidersList||[])})},this.addTenantLoginProvider=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addTenantLoginProvider...");var t={type:L.AdministrationActionType.SAVE_TENANT_LOGIN_PROVIDER,saveTenantLoginProvider:{loginProvider:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.saveTenantLoginProviderResult.storedProvider)})},this.updateTenantLoginProvider=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateTenantLoginProvider...");var t={type:L.AdministrationActionType.UPDATE_TENANT_LOGIN_PROVIDER,updateTenantLoginProvider:{loginProvider:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.updateTenantLoginProviderResult.updatedLoginProvider)})},this.deleteTenantLoginProvider=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteTenantLoginProvider...");var t={type:L.AdministrationActionType.DELETE_TENANT_LOGIN_PROVIDER,deleteTenantLoginProvider:{providerId:e.providerId,tenantId:e.tenantId}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.deleteTenantLoginProviderResult)})},this.getOpenScapeUser=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getOpenScapeUser..."),!e)return c.warn("[ClientApiHandler]: No dn was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.GET_OPENSCAPE_USER,getOpenScapeUser:{directoryNumber:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getOpenScapeUserResult)},null,["response.administration.getOpenScapeUserResult.user.cloudPin","response.administration.getOpenScapeUserResult.user.securityPin"],t)},this.getOpenScapeUserV2=function(e,t,n,i){if(n=n||d,c.debug("[ClientApiHandler]: getOpenScapeUserV2..."),!e)return c.warn("[ClientApiHandler]: No dn was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);if(!t)return c.warn("[ClientApiHandler]: No circuitUserId was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var r={type:L.AdministrationActionType.GET_OPENSCAPE_USER_V2,getV2OpenScapeUser:{directoryNumber:e,circuitUserId:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null,t.administration.getOpenScapeUserResult)},null,["response.administration.getOpenScapeUserResult.user.cloudPin","response.administration.getOpenScapeUserResult.user.securityPin"],i)},this.getThirdPartyDeviceData=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getThirdPartyDeviceData...");var i={type:L.AdministrationActionType.GET_THIRD_PARTY_DEVICE_INFO,getThirdPartyDeviceInfo:{directoryNumber:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getThirdPartyDeviceInfoResult.thirdPartyDeviceInfo)},null,["response.administration.getThirdPartyDeviceInfoResult.thirdPartyDeviceInfo.authenticationPassword","response.administration.getThirdPartyDeviceInfoResult.thirdPartyDeviceInfo.certContent"],t)},this.getVacantHomeDirectoryNumbers=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getVacantHomeDirectoryNumbers...");var t={type:L.AdministrationActionType.GET_VACANT_HOME_DIRECTORY_NUMBERS,getVacantHomeDirectoryNumbers:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.getVacantHomeDirectoryNumbersResult.directoryNumbers)},null,null,e)},this.getVacantHomeDirectoryNumbersOfSite=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getVacantHomeDirectoryNumbersOfSite..."),!e)return c.warn("[ClientApiHandler]: No siteId was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.GET_VACANT_HOME_DIRECTORY_NUMBERS_OF_SITE,getVacantHomeDirectoryNumbersOfSite:{siteId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getVacantHomeDirectoryNumbersOfSiteResult.directoryNumbers)},null,null,t)},this.createOpenScapeUser=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createOpenScapeUser..."),!e)return c.warn("[ClientApiHandler]: No user data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.CREATE_OPENSCAPE_USER,createOpenScapeUser:e};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.createOpenScapeUserResult.user)},null,null,t)},this.updateOpenScapeUser=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateOpenScapeUser..."),!e)return c.warn("[ClientApiHandler]: No user data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.UPDATE_OPENSCAPE_USER,updateOpenScapeUser:e};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.updateOpenScapeUserResult.user)},null,null,t)},this.deleteOpenScapeUser=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: deleteOpenScapeUser..."),!e||!e.userId||!e.dn)return c.warn("[ClientApiHandler]: User id or dn was not provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.DELETE_OPENSCAPE_USER,deleteOpenScapeUser:{userId:e.userId,directoryNumber:e.dn}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.deleteOpenScapeUserResult)},null,null,t)},this.createOpenScapeSite=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createOpenScapeSite..."),!e)return c.warn("[ClientApiHandler]: No site data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.CREATE_OPENSCAPE_SITE,createOpenScapeSite:{site:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.createOpenScapeSiteResult.site)},null,null,t)},this.getOpenScapeSite=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getOpenScapeSite..."),!e)return c.warn("[ClientApiHandler]: No siteId was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.GET_OPENSCAPE_SITE,getOpenScapeSite:{siteId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getOpenScapeSiteResult.site)},null,null,t)},this.updateOpenScapeSite=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateOpenScapeSite..."),!e)return c.warn("[ClientApiHandler]: No site data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.UPDATE_OPENSCAPE_SITE,updateOpenScapeSite:{site:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.updateOpenScapeSiteResult.site)},null,null,t,3e5)},this.deleteOpenScapeSites=function(e,i,t){i=i||d,c.debug("[ClientApiHandler]: deleteOpenScapeSites...");var n={type:L.AdministrationActionType.DELETE_OPENSCAPE_SITES,deleteOpenScapeSites:{sites:e}};A(L.ContentType.ADMINISTRATION,n,function(e,t){if(f(e,t,i)){var n=t.administration&&t.administration.deleteOpenScapeSitesResult&&t.administration.deleteOpenScapeSitesResult.failedToBeDeleted||[];i(null,n)}},null,null,t)},this.deleteOpenScapePublicRange=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: deleteOpenScapePublicRange...");var r={type:L.AdministrationActionType.DELETE_PUBLIC_NUMBER_RANGE,deletePublicNumberRange:{siteId:e,rangeId:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null)},null,null,i,3e5)},this.deleteSinglePublicNumber=function(e,t,n,i){if(n=n||d,c.debug("[ClientApiHandler]: deleteSinglePublicNumber..."),!e)return c.warn("[ClientApiHandler]: No siteId was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);if(!t)return c.warn("[ClientApiHandler]: No msnId was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var r={type:L.AdministrationActionType.DELETE_OPENSCAPE_MSN_NUMBER,deleteOpenScapeMSNnumber:{siteId:e,msnId:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null)},null,null,i)},this.deleteOpenScapePrivateRange=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: deleteOpenScapePrivateRange...");var r={type:L.AdministrationActionType.DELETE_PRIVATE_NUMBER_RANGE,deletePrivateNumberRange:{siteId:e,rangeId:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null)},null,null,i,3e5)},this.getOpenScapeTenant=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getOpenScapeTenant...");var t={type:L.AdministrationActionType.GET_OPENSCAPE_TENANT,getOpenScapeTenant:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.getOpenScapeTenantResult.tenant)},null,null,e)},this.getManageableTenants=function(n){n=n||d,c.debug("[ClientApiHandler]: getManageableTenants...");var e={type:L.AdministrationActionType.GET_PARTNER_MANAGEABLE_TENANTS};A(L.ContentType.ADMINISTRATION,e,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getPartnerManageableTenantResult.tenants)})},this.getCMRSettings=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getCMRSettings...");var t={type:L.AdministrationActionType.GET_CMR_SETTINGS,getCMRSettings:{userId:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(e,t.administration.getCMRSettingsResult.settings)})},this.setCMRSettings=function(e,t,n){if(n=n||d,c.debug("[ClientApiHandler]: setCMRSettings..."),t&&t.length){var i={type:L.AdministrationActionType.SET_CMR_SETTINGS,setCMRSettings:{userId:e,settings:t}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)})}else v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED)},this.sendCMRCommand=function(e,t,n){if(n=n||d,c.debug("[ClientApiHandler]: sendCMRCommand..."),L.CMRCommand[e]&&t){var i={type:L.AdministrationActionType.SEND_CMR_COMMAND,sendCMRCommand:{command:e,cmrId:t}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)})}else v(n,L.ReturnCode.INVALID_MESSAGE)},this.getCMRInfoById=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getCMRInfoById...");var t={type:L.AdministrationActionType.GET_CMR_INFO_BY_ID,getCMRInfoById:{userId:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(e,t.administration.getCMRInfoByIdResult.cmrInfo)},null,["response.administration.getCMRInfoByIdResult.cmrInfo.adminManagedSetting"])},this.getCMRInfoByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getCMRInfoByIds...");var t={type:L.AdministrationActionType.GET_CMR_INFO_BY_IDS,getCMRInfoByIds:{userId:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(e,t.administration.getCMRInfoByIdsResult.cmrInfo)})},this.setAdminManagedCMRSettings=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setAdminManagedCMRSettings...");var i={type:L.AdministrationActionType.SET_ADMIN_MANAGED_CMR_SETTINGS,setAdminManagedCMRSettings:{userId:e,setting:t}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},["request.administration.setAdminManagedCMRSettings.setting"])},this.setAdminManagedCMRSettingsByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setAdminManagedCMRSettingsByIds...");var t={type:L.AdministrationActionType.SET_ADMIN_MANAGED_CMR_SETTINGS_BY_IDS,setAdminManagedCMRSettingsByIds:{settings:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null)})},this.shareCMR=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: shareCMR...");var r={type:L.AdministrationActionType.SHARE_CMR,shareCMR:{cmrUserId:e,secIds:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null)},null,null,i)},this.unshareCMR=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: unshareCMR...");var r={type:L.AdministrationActionType.UNSHARE_CMR,unshareCMR:{cmrUserId:e,secIds:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null)},null,null,i)},this.getCMRSharedTenantInfo=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getCMRSharedTenantInfo...");var i={type:L.AdministrationActionType.GET_CMR_SHARED_TENANT_INFO,getCMRSharedTenantInfo:{cmrUserId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getCMRSharedTenantInfoResult.tenantIdToName||[])},null,null,t)},this.getHuntGroups=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getHuntGroups...");var t={type:L.AdministrationActionType.GET_TENANT_HUNT_GROUPS,getTenantHuntGroups:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getTenantHuntGroupsResult.queryHuntGroupResponse||[])},null,null,e)},this.createHuntGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createHuntGroup..."),!e)return c.warn("[ClientApiHandler]: No hunt group data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.CREATE_HUNT_GROUP,createHuntGroup:{huntGroup:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.createHuntGroupResult.huntGroup)},null,null,t)},this.deleteHuntGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: deleteHuntGroup..."),!e||!e.length)return c.warn("[ClientApiHandler]: No hunt group pilot DNs were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.DELETE_HUNT_GROUP,deleteHuntGroup:{huntGroupPilots:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.getHuntGroupPilotDNs=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getHuntGroupPilotDNs...");var t={type:L.AdministrationActionType.GET_HUNT_GROUP_PILOT_CANDIDATES,getHuntGroupPilotCandidates:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getHuntGroupPilotCandidatesResult.huntGroupUsers||[])},null,null,e)},this.getHuntGroupMemberDNs=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getHuntGroupMemberDNs...");var t={type:L.AdministrationActionType.GET_HUNT_GROUP_MEMBER_CANDIDATES,getHuntGroupMemberCandidates:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getHuntGroupMemberCandidatesResult.huntGroupUsers||[])},null,null,e)},this.getHuntGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getHuntGroup..."),!e)return c.warn("[ClientApiHandler]: Hunt group pilot DN was not provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.GET_HUNT_GROUP,getHuntGroup:{pilotDn:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getHuntGroupResult.huntGroup)},null,null,t)},this.updateHuntGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateHuntGroup..."),!e)return c.warn("[ClientApiHandler]: No hunt group data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.UPDATE_HUNT_GROUP,updateHuntGroup:{updatedHuntGroup:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.updateHuntGroupResult.huntGroup)},null,null,t)},this.updateHuntGroupList=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateHuntGroupList..."),!e)return c.warn("[ClientApiHandler]: No hunt group list data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.UPDATE_HUNT_GROUP_LIST,updateHuntGroupList:{pilotsDns:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.getITSPtemplates=function(r,e){r=r||d,c.debug("[ClientApiHandler]: getITSPtemplates...");var t={type:L.AdministrationActionType.GET_OPENSCAPE_ITSP_TEMPLATES,getOpenscapeITSPTemplates:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){if(f(e,t,r)){var n,i=t.administration.getOpenscapeITSPTemplatesResult.itspTemplates;if(i)try{n=JSON.parse(i)}catch(e){return c.error("[ClientApiHandler]: Error while parsing response in getITSPtemplates"),void r(L.ReturnCode.SERVICE_EXCEPTION)}r(null,n&&n.content)}},null,null,e)},this.createITSP=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createITSP..."),!e)return c.warn("[ClientApiHandler]: No ITSP data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.CREATE_OPENSCAPE_ITSP,createOpenscapeITSP:{itsp:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.createOpenscapeITSPResult.provider)},["request.administration.createOpenscapeITSP.itsp.username","request.administration.createOpenscapeITSP.itsp.password"],["response.administration.createOpenscapeITSPResult.provider.username","response.administration.createOpenscapeITSPResult.provider.password"],t,u)},this.getITSP=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getITSP..."),!e)return c.warn("[ClientApiHandler]: No ITSP id was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.GET_OPENSCAPE_ITSP,getOpenscapeITSP:{id:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getOpenscapeITSPResult.provider)},null,null,t)},this.getITSPs=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getITSPs...");var t={type:L.AdministrationActionType.GET_OPENSCAPE_ITSPS,getOpenscapeITSPs:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getOpenscapeITSPsResult.providers)},null,null,e)},this.updateITSP=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateITSP..."),!e)return c.warn("[ClientApiHandler]: No ITSP data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.UPDATE_OPENSCAPE_ITSP,updateOpenscapeITSP:{itsp:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},["request.administration.updateOpenscapeITSP.itsp.username","request.administration.updateOpenscapeITSP.itsp.password"],["response.administration.updateOpenscapeITSPResult.provider.username","response.administration.updateOpenscapeITSPResult.provider.password"],t,u)},this.deleteITSPs=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: deleteITSP..."),!e)return c.warn("[ClientApiHandler]: No ITSP ids were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.DELETE_OPENSCAPE_ITSP,deleteOpenscapeITSP:{itspIds:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.deleteOpenscapeITSPResult.providers)},null,null,t,u)},this.assignITSPToSite=function(e,t,n,i,r){if(i=i||d,c.debug("[ClientApiHandler]: assignITSPToSite..."),!e)return c.warn("[ClientApiHandler]: No ITSP id was provided"),void v(i,L.ReturnCode.INVALID_MESSAGE);if(!t)return c.warn("[ClientApiHandler]: No site id was provided"),void v(i,L.ReturnCode.INVALID_MESSAGE);var o={type:L.AdministrationActionType.ASSIGN_OPENSCAPE_ITSP_TO_SITE,assignOpenscapeITSPToSite:{itspid:e,siteid:t,defaultHomeDN:n}};A(L.ContentType.ADMINISTRATION,o,function(e,t){f(e,t,i)&&i(null)},null,null,r)},this.unassignITSPFromSite=function(e,t,n,i){if(n=n||d,c.debug("[ClientApiHandler]: unassignITSPFromSite..."),!e)return c.warn("[ClientApiHandler]: No ITSP id was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);if(!t)return c.warn("[ClientApiHandler]: No site id was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var r={type:L.AdministrationActionType.UNASSIGN_OPENSCAPE_ITSP_TO_SITE,unassignOpenscapeITSPFromSite:{itspid:e,siteid:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null)},null,null,i)},this.findOpenscapeSitesByITSP=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: findOpenscapeSitesByITSP..."),!e)return c.warn("[ClientApiHandler]: No ITSP id was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.FIND_OPENSCAPE_SITES_BY_ITSP,findOpenscapeSitesByITSP:{itspid:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.findOpenscapeSitesByITSPResult.siteList||[])},null,null,t)},this.getPickupGroupMemberDNs=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getPickupGroupMemberDNs...");var t={type:L.AdministrationActionType.GET_PICKUP_GROUP_MEMBER_CANDIDATES,getPickupGroupMemberCandidates:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getPickupGroupMemberCandidatesResult.pickupGroupUsers||[])},null,null,e)},this.createPickupGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createPickupGroup..."),!e)return c.warn("[ClientApiHandler]: No pickup group data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.CREATE_PICKUP_GROUP,createPickupGroup:{pickupGroup:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.createPickupGroupResult.pickupGroupResponse)},null,null,t)},this.getPickupGroupList=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getPickupGroupList...");var t={type:L.AdministrationActionType.GET_TENANT_PICKUP_GROUPS,getTenantPickupGroups:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getTenantPickupGroupsResult.queryPickupGroupResponse||[])},null,null,e)},this.deletePickupGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: deletePickupGroup..."),!e||!e.length)return c.warn("[ClientApiHandler]: No pickup group ids were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.DELETE_PICKUP_GROUPS,deletePickupGroups:{pickupGroupId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.getPickupGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getPickupGroup..."),!e)return c.warn("[ClientApiHandler]: Pickup group id was not provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.GET_PICKUP_GROUP,getPickupGroup:{pickupGroupId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getPickupGroupResult.pickupGroup)},null,null,t)},this.updatePickupGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updatePickupGroup..."),!e)return c.warn("[ClientApiHandler]: No pickup group data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.UPDATE_PICKUP_GROUP,updatePickupGroup:{pickupGroup:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration)},null,null,t)},this.getExecutiveAssistantGroupList=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getExecutiveAssistantGroupList...");var t={type:L.AdministrationActionType.GET_TENANT_EXECUTIVE_ASSISTANT_GROUPS,getTenantExecutiveAssistantGroups:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getTenantExecutiveAssistantGroupsResult.queryExecutiveAssistantGroupResponse||[])},null,null,e)},this.getExecutiveAssistantGroupMemberCandidates=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getExecutiveAssistantGroupMemberCandidates...");var t={type:L.AdministrationActionType.GET_EXECUTIVE_ASSISTANT_GROUP_MEMBER_CANDIDATES,getExecutiveAssistantGroupMemberCandidates:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getExecutiveAssistantGroupMemberCandidatesResult.executiveAssistantGroupUsers||[])},null,null,e)},this.createExecutiveAssistantGroup=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: createExecutiveAssistantGroup...");var i={type:L.AdministrationActionType.CREATE_EXECUTIVE_ASSISTANT_GROUP_ASYNC,createExecutiveAssistantGroupAsync:{executiveAssistantGroup:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t,u)},this.getExecutiveAssistantGroup=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getExecutiveAssistantGroup...");var i={type:L.AdministrationActionType.GET_EXECUTIVE_ASSISTANT_GROUP,getExecutiveAssistantGroup:{eaGroupName:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getExecutiveAssistantGroupResult.executiveAssistantGroup||{})},null,null,t)},this.deleteExecutiveAssistantGroups=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: deleteExecutiveAssistantGroup..."),!e||!e.length)return c.warn("[ClientApiHandler]: No Executive-Assistant group names were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.DELETE_EXECUTIVE_ASSISTANT_GROUPS,deleteExecutiveAssistantGroups:{executiveAssistantGroupName:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t,u)},this.validateTransferTarget=function(e,t,n,i){if(n=n||d,c.debug("[ClientApiHandler]: validateTransferTarget..."),!C.isAAValidateTransferTargetSupported())return c.warn("[ClientApiHandler]: The validateTransferTarget operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);if(!t||!e)return c.warn("[ClientApiHandler]: No siteId or transferTarget was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var r={type:L.AdministrationActionType.VALIDATE_TRANSFER_TARGET,validateTransferTarget:{siteId:e,transferTarget:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null,t.administration.validateTransferTargetResult.number)},null,null,i)},this.createAutomatedAttendantConfiguration=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createAutomatedAttendantConfiguration..."),!e)return c.warn("[ClientApiHandler]: No Automated Attendant configuration was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.CREATE_AUTOMATED_ATTENDANT_CONFIGURATION,createAutomatedAttendantConfiguration:{automatedAttendantConfiguration:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t,u)},this.getAutomatedAttendantConfigurations=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getAutomatedAttendantConfigurations...");var t={type:L.AdministrationActionType.GET_AUTOMATED_ATTENDANT_CONFIGURATIONS,getAutomatedAttendantConfigurations:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getAutomatedAttendantConfigurationsResult.automatedAttendantConfigurations||[])},null,null,e)},this.getAutomatedAttendantConfiguration=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getAutomatedAttendantConfiguration..."),!e)return c.warn("[ClientApiHandler]: No Automated Attendant access number was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.GET_AUTOMATED_ATTENDANT_CONFIGURATION,getAutomatedAttendantConfiguration:{automatedAttendantNumber:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getAutomatedAttendantConfigurationResult.automatedAttendantConfiguration)},null,null,t)},this.updateAutomatedAttendantConfiguration=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateAutomatedAttendantConfiguration..."),!e)return c.warn("[ClientApiHandler]: No Automated Attendant configuration was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.UPDATE_AUTOMATED_ATTENDANT_CONFIGURATION,updateAutomatedAttendantConfiguration:{updatedAutoAttendant:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration)},null,null,t,u)},this.deleteAutomatedAttendantConfigurations=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: deleteAutomatedAttendantConfigurations..."),!e)return c.warn("[ClientApiHandler]: No Automated Attendant access numbers were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.DELETE_AUTOMATED_ATTENDANT_CONFIGURATIONS,deleteAutomatedAttendantConfigurations:{autoAttendants:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t,u)},this.getUcaasPhoneLdapSettings=function(n,e){if(n=n||d,c.debug("[ClientApiHandler]: getUcaasPhoneLdapSettings..."),!C.isUcaasPhoneLdapSettingsSupported())return c.warn("[ClientApiHandler]: The getUcaasPhoneLdapSettings operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:L.AdministrationActionType.GET_LDAP_CONFIGURATION_FOR_PHONE,getLDAPConfigurationForPhone:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.getLDAPConfigurationForPhoneResult.ldapConfigurationForPhone)},null,["response.administration.getLDAPConfigurationForPhoneResult.ldapConfigurationForPhone.password"],e)},this.saveUcaasPhoneLdapSettings=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: saveUcaasPhoneLdapSettings..."),!C.isUcaasPhoneLdapSettingsSupported())return c.warn("[ClientApiHandler]: The saveUcaasPhoneLdapSettings operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);var i={type:L.AdministrationActionType.ADD_LDAP_CONFIGURATION_FOR_PHONE,addLDAPConfigurationForPhone:{ldapConfigurationForPhone:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},["request.administration.addLDAPConfigurationForPhone.ldapConfigurationForPhone.password"],null,t)},this.createApplicationFrameworkConfiguration=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createApplicationFrameworkConfiguration..."),!e)return c.warn("[ClientApiHandler]: No Application Framework configuration was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.CREATE_APPLICATION_FRAMEWORK_CONFIGURATION,createApplicationFrameworkConfiguration:{applicationFrameworkConfiguration:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.createApplicationFrameworkConfigurationResult.applicationFrameworkConfiguration)},null,null,t,u)},this.getApplicationFrameworkConfigurations=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getApplicationFrameworkConfigurations...");var t={type:L.AdministrationActionType.GET_APPLICATION_FRAMEWORK_CONFIGURATIONS,getApplicationFrameworkConfigurations:{}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getApplicationFrameworkConfigurationsResult.applicationFrameworkConfigurations||[])},null,null,e)},this.getApplicationFrameworkConfiguration=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getApplicationFrameworkConfiguration..."),!e)return c.warn("[ClientApiHandler]: No Application Framework access number was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.GET_APPLICATION_FRAMEWORK_CONFIGURATION,getApplicationFrameworkConfiguration:{accessNumber:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.getApplicationFrameworkConfigurationResult.applicationFrameworkConfiguration)},null,null,t)},this.updateApplicationFrameworkConfiguration=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateApplicationFrameworkConfiguration..."),!e)return c.warn("[ClientApiHandler]: No Application Framework configuration was provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.UPDATE_APPLICATION_FRAMEWORK_CONFIGURATION,updateApplicationFrameworkConfiguration:{applicationFrameworkConfiguration:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.updateApplicationFrameworkConfigurationResult.applicationFrameworkConfiguration)},null,null,t,u)},this.deleteApplicationFrameworkConfigurations=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: deleteApplicationFrameworkConfigurations..."),!e)return c.warn("[ClientApiHandler]: No Application Framework access numbers were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.DELETE_APPLICATION_FRAMEWORK_CONFIGURATIONS,deleteApplicationFrameworkConfigurations:{ids:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t,u)},this.hasSomeSinglePublicNumberReserved=function(e,n,t){if(n=n||d,!(e&&e.msnNumbers&&e.customerId&&e.sitePrefix))return c.warn("[ClientApiHandler]: Missing mandatory data"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.IS_MSN_RESERVED,isMSNReserved:{msnNumbers:e.msnNumbers,customerId:e.customerId,sitePrefix:e.sitePrefix}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.isMSNReservedResult.isMSNReserved)},null,null,t)},this.hasReservedDNsInSiteRanges=function(e,n,t){if(n=n||d,!(e&&e.siteId&&e.modifiedDidNumberRanges&&e.modifiedPrivateNumberRanges))return c.warn("[ClientApiHandler]: Missing mandatory data"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.AdministrationActionType.HAS_RESERVED_DNS_IN_SITE_RANGES,hasReservedDNsInSiteRanges:{siteId:e.siteId,publicRanges:e.modifiedDidNumberRanges,privateRanges:e.modifiedPrivateNumberRanges}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.hasReservedDNsInSiteRangesResult.hasReservedDNs)},null,null,t)},this.getSystemNotifications=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getSystemNotifications...");var i={type:L.AdministrationActionType.GET_SYSTEM_NOTIFICATIONS,getSystemNotifications:{systemNotificationType:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n,!0)&&n(null,t.administration.getSystemNotificationsResult.systemNotifications||[])},null,["response.administration.getSystemNotificationsResult.systemNotifications.[].broadcastText"],t)},this.addSystemNotification=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: addSystemNotification...");var i={type:L.AdministrationActionType.ADD_SYSTEM_NOTIFICATION,addSystemNotification:{type:e.type,startTime:e.startTime,endTime:e.endTime,broadcastText:e.broadcastText}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.addSystemNotificationResult.systemNotification)},["request.administration.addSystemNotification.broadcastText"],["response.administration.addSystemNotificationResult.systemNotification.broadcastText"],t)},this.removeSystemNotification=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: removeSystemNotification...");var i={type:L.AdministrationActionType.REMOVE_SYSTEM_NOTIFICATION,removeSystemNotification:{id:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.updateSystemNotification=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: updateSystemNotification...");var i={type:L.AdministrationActionType.UPDATE_SYSTEM_NOTIFICATION,updateSystemNotification:{id:e.id,startTime:e.startTime,endTime:e.endTime,broadcastText:e.broadcastText}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null,t.administration.updateSystemNotificationResult.systemNotification)},["request.administration.updateSystemNotification.broadcastText"],["response.administration.updateSystemNotificationResult.systemNotification.broadcastText"],t)},this.enablePartnerAdministration=function(n,e){n=n||d,c.debug("[ClientApiHandler]: enablePartnerAdministration...");var t={type:L.AdministrationActionType.ENABLE_PARTNER_ADMINISTRATION};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null)},null,null,e)},this.disablePartnerAdministration=function(n,e){n=n||d,c.debug("[ClientApiHandler]: disablePartnerAdministration...");var t={type:L.AdministrationActionType.DISABLE_PARTNER_ADMINISTRATION};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null)},null,null,e)},this.getResellerInfo=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getResellerInfo...");var t={type:L.AdministrationActionType.GET_RESELLER_INFO,getResellerInfo:{partnerId:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null,t.administration.getResellerInfoResult.resellerInfo)})},this.setSupportType=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setSupportType...");var t={type:L.AdministrationActionType.SET_SUPPORT_TYPE,setSupportType:{supportType:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null)})},this.setSupportEmail=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setSupportEmail...");var t={type:L.AdministrationActionType.SET_SUPPORT_EMAIL_ADDRESS,setSupportEmailaddress:{supportEmailaddress:e}};A(L.ContentType.ADMINISTRATION,t,function(e,t){f(e,t,n)&&n(null)})},this.exportUserData=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: exportUserData...");var r={type:L.AdministrationActionType.EXPORT_DATA_USER,exportDataUser:{data:e,userId:t}};A(L.ContentType.ADMINISTRATION,r,function(e,t){f(e,t,n)&&n(null)},null,null,i)},this.exportDomainData=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: exportDomainData...");var i={type:L.AdministrationActionType.EXPORT_DATA_TENANT,exportDataTenant:{data:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.getApplicationsList=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getApplicationsList...");var i={type:L.CPaaSActionType.GET_OAUTH_APPLICATIONS};A(L.ContentType.CPAAS,i,function(e,t){e||t.code!==L.ReturnCode.NO_RESULT?f(e,t,n)&&n(null,t.cpaas.getOauthApplicationsResult):n(null,{applications:[]})},null,null,t)},this.getApplicationDetails=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getApplicationsDetails...");var i={type:L.CPaaSActionType.GET_OAUTH_APPLICATION,getOauthApplication:{clientId:e}};A(L.ContentType.CPAAS,i,function(e,t){f(e,t,n)&&n(null,t.cpaas.getOauthApplicationResult.application)},null,null,t)},this.suspendApplication=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: suspendApplication ...");var i={type:L.CPaaSActionType.SUSPEND_OAUTH_APPLICATION,suspendOAuthApplication:{clientId:e}};A(L.ContentType.CPAAS,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.unsuspendApplication=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: unsuspendApplication ...");var i={type:L.CPaaSActionType.UNSUSPEND_OAUTH_APPLICATION,unsuspendOAuthApplication:{clientId:e}};A(L.ContentType.CPAAS,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.recreateClientSecret=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: recreateClientSecret...");var i={type:L.CPaaSActionType.RECREATE_CLIENT_SECRET,recreateClientSecret:{clientId:e}};A(L.ContentType.CPAAS,i,function(e,t){f(e,t,n)&&n(null,t.cpaas.recreateClientSecretResult.clientSecret)},null,null,t)},this.deleteApplication=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: deleteApplication...");var i={type:L.CPaaSActionType.DELETE_OAUTH_APPLICATION,deleteOAuthApplication:{clientId:e}};A(L.ContentType.CPAAS,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.createOAuthApplication=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createOAuthApplication..."),!e)return c.warn("[ClientApiHandler]: No application data were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var i={type:L.CPaaSActionType.CREATE_OAUTH_APPLICATION,createOAuthApplication:e};A(L.ContentType.CPAAS,i,function(e,t){f(e,t,n)&&n(null,t.cpaas.createOAuthApplicationResult)},null,null,t)},this.updateApplication=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: updateApplication...");var i={type:L.CPaaSActionType.UPDATE_OAUTH_APPLICATION,updateOAuthApplication:e};A(L.ContentType.CPAAS,i,function(e,t){f(e,t,n)&&n(null,t.cpaas.updateOAuthApplicationResult.application)},null,null,t)},this.createIncomingWebhook=function(e,n){n=n||d,c.debug("[ClientApiHandler]: createIncomingWebhook...");var t={type:L.CPaaSActionType.CREATE_INCOMING_WEBHOOK,createIncomingWebhook:e};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null,t.cpaas.createIncomingWebhookResult.webhook)})},this.deleteIncomingWebhook=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteIncomingWebhook...");var t={type:L.CPaaSActionType.DELETE_INCOMING_WEBHOOK,deleteIncomingWebhook:{webhookId:e}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null)})},this.getIncomingWebhook=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getIncomingWebhook...");var t={type:L.CPaaSActionType.GET_INCOMING_WEBHOOK,getIncomingWebhook:{webhookId:e}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null,t.cpaas.getIncomingWebhookResult.webhook)})},this.getTenantBots=function(n){n=n||d,c.debug("[ClientApiHandler]: getTenantBots...");var e={type:L.CPaaSActionType.GET_TENANT_BOTS};A(L.ContentType.CPAAS,e,function(e,t){f(e,t,n)&&n(null,t.cpaas.getTenantBotsResult.tenantBots)})},this.getIncomingWebhooks=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getIncomingWebhooks...");var t={type:L.CPaaSActionType.GET_INCOMING_WEBHOOKS,getIncomingWebhooks:e};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&(t.cpaas.getIncomingWebhooksResult.webhook=t.cpaas.getIncomingWebhooksResult.webhook||[],n(null,t.cpaas.getIncomingWebhooksResult))})},this.suspendIncomingWebhook=function(e,n){n=n||d,c.debug("[ClientApiHandler]: suspendIncomingWebhook...");var t={type:L.CPaaSActionType.SUSPEND_INCOMING_WEBHOOK,suspendIncomingWebhook:{webhookId:e}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null)})},this.unsuspendIncomingWebhook=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unsuspendIncomingWebhook...");var t={type:L.CPaaSActionType.UNSUSPEND_INCOMING_WEBHOOK,unsuspendIncomingWebhook:{webhookId:e}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null)})},this.updateIncomingWebhook=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateIncomingWebhook...");var t={type:L.CPaaSActionType.UPDATE_INCOMING_WEBHOOK,updateIncomingWebhook:e};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null,t.cpaas.updateIncomingWebhookResult.webhook)})},this.getExchangeSettings=function(n){n=n||d,c.debug("[ClientApiHandler]: getExchangeSettings...");var e={type:L.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:L.ThirdPartyConnectorType.EXCHANGE_CONNECTOR}};A(L.ContentType.THIRDPARTYCONNECTORS,e,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.getSettings.exchange)},null,["response.thirdpartyconnectors.getSettings.exchange"])},this.saveExchangeSettings=function(e,n){n=n||d,c.debug("[ClientApiHandler]: saveExchangeSettings..."),p&&(e.encryptionKey=String(Date.now()));var t={type:L.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:L.ThirdPartyConnectorType.EXCHANGE_CONNECTOR,exchange:e}};A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.saveSettings.exchange)},["request.thirdpartyconnectors.saveSettings.exchange"],["response.thirdpartyconnectors.saveSettings.exchange"])},this.saveOpenXchangeSettings=function(e,n){n=n||d,c.debug("[ClientApiHandler]: saveOpenXchangeSettings...");var t={type:L.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:L.ThirdPartyConnectorType.OPEN_XCHANGE,openXchange:e}};A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.saveSettings.openXchange)},["request.thirdpartyconnectors.saveSettings.openXchange"],["response.thirdpartyconnectors.saveSettings.openXchange"])},this.getThirdpartyProviderSettings=function(e,n){if(n=n||d,e=e||{},c.debug("[ClientApiHandler]: getThirdpartyProviderSettings..."),p)v(n,null,{encryptionKey:e.emailAddress});else{var t={type:L.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:L.ThirdPartyConnectorType.CLIENT_THIRDPARTY}};A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.getSettings.clientThirdparty)},null,["response.thirdpartyconnectors.getSettings.clientThirdparty"])}},this.saveThirdpartyProviderSettings=function(e,n){if(n=n||d,e=e||{},c.debug("[ClientApiHandler]: saveThirdpartyProviderSettings..."),p)v(n,null,{encryptionKey:e.emailAddress});else{var t={type:L.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:L.ThirdPartyConnectorType.CLIENT_THIRDPARTY,clientThirdparty:{encryptionKey:""}}};A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.saveSettings.clientThirdparty)},["request.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"],["response.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"])}},this.connectToThirdParty=function(e,n){var t;switch(n=n||d,c.debug("[ClientApiHandler]: connectToThirdParty "+e+"..."),e){case L.ThirdPartyConnectorType.BOX:case L.ThirdPartyConnectorType.ZAPIER:case L.ThirdPartyConnectorType.SYNCPLICITY:case L.ThirdPartyConnectorType.GOOGLE_CONTACTS:case L.ThirdPartyConnectorType.GOOGLE_DRIVE:case L.ThirdPartyConnectorType.ONE_DRIVE:case L.ThirdPartyConnectorType.CONCEPTBOARD:case L.ThirdPartyConnectorType.MEISTERTASK:case L.ThirdPartyConnectorType.MS_SHAREPOINT:t={type:L.ThirdPartyConnectorsActionType.CONNECT,connect:{type:e}};break;default:return void v(n,L.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&(t.thirdpartyconnectors.connect?n(null,t.thirdpartyconnectors.connect.authorizeUrl):n(L.ThirdPartyError.UNSUPPORTED_PROVIDER))},null,["response.thirdpartyconnectors.connect.authorizeUrl"])},this.refreshConnectionToThirdParty=function(e,t,n){var i;switch(n=n||d,c.debug("[ClientApiHandler]: refreshConnectionToThirdParty "+e+"..."),e){case L.ThirdPartyConnectorType.SYNCPLICITY:case L.ThirdPartyConnectorType.GOOGLE_CONTACTS:i={type:L.ThirdPartyConnectorsActionType.REFRESH_CONNECTION,refreshConnection:{type:e,refreshToken:t}};break;default:return void v(n,L.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(L.ContentType.THIRDPARTYCONNECTORS,i,function(e,t){f(e,t,n)&&(t.thirdpartyconnectors.refreshConnectionResult?n(null,t.thirdpartyconnectors.refreshConnectionResult):n(L.ThirdPartyError.UNSUPPORTED_PROVIDER))},["request.thirdpartyconnectors.refreshConnection.refreshToken"],["response.thirdpartyconnectors.refreshConnectionResult"])},this.getFolderItems=function(n,i){if(i=i||d,c.debug("[ClientApiHandler]: getFolderItems for ",n.provider),n.provider===L.ThirdPartyConnectorType.MS_SHAREPOINT&&!C.isSharepointSupported())return c.warn("[ClientApiHandler]: The getFolderItems operation for Sharepoint is not supported by the backend"),void v(i,L.ReturnCode.OPERATION_NOT_SUPPORTED);var e;switch(n.provider){case L.ThirdPartyConnectorType.BOX:case L.ThirdPartyConnectorType.OPEN_XCHANGE:e={type:L.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS,getFolderItems:{type:n.provider,id:n.folderId,index:n.indexCursor,pageSize:n.pageSize}};break;case L.ThirdPartyConnectorType.GOOGLE_DRIVE:case L.ThirdPartyConnectorType.ONE_DRIVE:case L.ThirdPartyConnectorType.SYNCPLICITY:case L.ThirdPartyConnectorType.MS_SHAREPOINT:e={type:L.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS_WITH_CURSOR,getFolderItemsWithCursor:{type:n.provider,syncpointId:n.syncpointId||void 0,id:n.folderId,siteId:n.siteId||void 0,folderType:n.folderType||void 0,contentType:n.contentType||void 0,cursor:n.indexCursor,pageSize:n.pageSize,accessToken:n.accessToken||void 0}};break;default:return void v(i,L.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(L.ContentType.THIRDPARTYCONNECTORS,e,function(e,t){f(e,t,i)&&i(null,{folder:n.folderId,items:t.thirdpartyconnectors.getFolderItemsResult})},["request.thirdpartyconnectors.getFolderItemsWithCursor.accessToken"])},this.getConnectionStatus=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConnectionStatus "+e+"...");var t={type:L.ThirdPartyConnectorsActionType.GET_CONNECTION_STATUS,getConnectionStatus:{type:e}};A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.getConnectionStatus.connected)})},this.disconnectFromThirdParty=function(e,t,n){var i;switch(n=n||d,c.debug("[ClientApiHandler]: disconnectFromThirdParty "+e+"..."),e){case L.ThirdPartyConnectorType.BOX:case L.ThirdPartyConnectorType.ZAPIER:case L.ThirdPartyConnectorType.OPEN_XCHANGE:case L.ThirdPartyConnectorType.SYNCPLICITY:case L.ThirdPartyConnectorType.GOOGLE_CONTACTS:case L.ThirdPartyConnectorType.GOOGLE_DRIVE:case L.ThirdPartyConnectorType.ONE_DRIVE:case L.ThirdPartyConnectorType.MEISTERTASK:case L.ThirdPartyConnectorType.MS_SHAREPOINT:i={type:L.ThirdPartyConnectorsActionType.DISCONNECT,disconnect:{type:e,accessToken:t||void 0}};break;default:return void v(n,L.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(L.ContentType.THIRDPARTYCONNECTORS,i,function(e,t){f(e,t,n)&&n(null)},["request.thirdpartyconnectors.disconnect.accessToken"])},this.shareFolderItems=function(e,n){if(n=n||d,e){var t,i=e.provider,r=e.itemsData;if(c.debug("[ClientApiHandler]: shareFolderItems "+i+"..."),i===L.ThirdPartyConnectorType.MS_SHAREPOINT&&!C.isSharepointSupported())return c.warn("[ClientApiHandler]: The shareFolderItems operation for Sharepoint is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);switch(i){case L.ThirdPartyConnectorType.BOX:case L.ThirdPartyConnectorType.ZAPIER:case L.ThirdPartyConnectorType.OPEN_XCHANGE:case L.ThirdPartyConnectorType.GOOGLE_DRIVE:case L.ThirdPartyConnectorType.ONE_DRIVE:case L.ThirdPartyConnectorType.SYNCPLICITY:case L.ThirdPartyConnectorType.MS_SHAREPOINT:t={type:L.ThirdPartyConnectorsActionType.SHARE_FOLDER_ITEMS,shareFolderItems:{type:i,shareItems:r,conversationId:e.convId,accessToken:e.accessToken||void 0}};break;default:return void v(n,L.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.shareFolderItems)},["request.thirdpartyconnectors.shareFolderItems.accessToken"],["response.thirdpartyconnectors.shareFolderItems.items.[].shareLinkPassword","response.thirdpartyconnectors.shareFolderItems.items.[].downloadUrl","response.thirdpartyconnectors.shareFolderItems.items.[].previewUrl","response.thirdpartyconnectors.shareFolderItems.appKey","response.thirdpartyconnectors.shareFolderItems.accessToken"])}else v(n,L.ReturnCode.MISSING_REQUIRED_PARAMETER)},this.unshareItems=function(e,n){var t;switch(n=n||d,c.debug("[ClientApiHandler]: ushareItems "+e.provider+"..."),e.provider){case L.ThirdPartyConnectorType.OPEN_XCHANGE:case L.ThirdPartyConnectorType.SYNCPLICITY:t={type:L.ThirdPartyConnectorsActionType.UNSHARE_FOLDER_ITEMS,unshareFolderItems:{type:e.provider,fileId:e.itemIds,accessToken:e.accessToken||void 0}};break;default:return void v(n,L.ThirdPartyError.UNSUPPORTED_PROVIDER)}A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&n(null)},["request.thirdpartyconnectors.unshareFolderItems.accessToken"])},this.getEditUrl=function(e,n){var t;c.debug("[ClientApiHandler]: getEditUrl "+e.provider),e.provider===L.ThirdPartyConnectorType.OPEN_XCHANGE?(t={type:L.ThirdPartyConnectorsActionType.GET_EDIT_URL,getEditUrl:{externalAttachment:{type:e.provider,downloadLocation:e.uri,previewLocation:e.uri,attachment:{fileId:e.fileId,fileName:e.fileName,size:e.size,mimeType:e.mimeType}}}},A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.getEditUrlResult.url)})):v(n,L.ThirdPartyError.UNSUPPORTED_PROVIDER)},this.getStorageAuthenticationData=function(e,t,n){if(n=n||d,c.debug("[ClientApiHandler]: getStorageAuthenticationData..."),e===L.ThirdPartyConnectorType.SYNCPLICITY){var i={type:L.ThirdPartyConnectorsActionType.CONNECT_STORAGE,connectStorage:{type:L.ThirdPartyConnectorType.SYNCPLICITY,endpointUrls:t}};A(L.ContentType.THIRDPARTYCONNECTORS,i,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.connectStorageResult.storageAuthenticationData)})}else v(n,L.ThirdPartyError.UNSUPPORTED_PROVIDER)},this.getOAuthDataSession=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: getOAuthDataSession..."),!C.isGetOAuthDataSessionSupported())return c.warn("[ClientApiHandler]: The getOAuthDataSession operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:L.ThirdPartyConnectorsActionType.GET_OAUTH_DATA_SESSION,getOAuthDataSession:{provider:e}};A(L.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){f(e,t,n)&&n(null,t.thirdpartyconnectors.getOAuthDataSessionResult)},null,["response.thirdpartyconnectors.getOAuthDataSessionResult"])},this.getGlobalProperty=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getGlobalProperty...");var t={type:L.SystemActionType.GET_GLOBAL_PROPERTY,getGlobalProperty:{globalPropertyName:e}};A(L.ContentType.SYSTEM,t,function(e,t){f(e,t,n)&&n(null,t.system.getGlobalPropertyResult.property)})},this.getGlobalProperties=function(e,n){n=n||d,e instanceof Array||(e=[e]),c.debug("[ClientApiHandler]: getGlobalProperties...");var t={type:L.SystemActionType.GET_GLOBAL_PROPERTIES,getGlobalProperties:{globalPropertyNames:e}};A(L.ContentType.SYSTEM,t,function(e,t){f(e,t,n)&&n(null,t.system.getGlobalPropertiesResult.property)})},this.validateSessionInvite=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: validateSessionInvite...");var i={type:L.GuestActionType.VALIDATE_SESSION_INVITE_TOKEN,validateSessionInviteToken:{token:{token:e},configurableTextsLanguage:t||void 0}};A(L.ContentType.GUEST,i,function(e,t){f(e,t,n)&&n(null,t.guest.validateSessionInviteToken)},null,["response.guest.validateSessionInviteToken.convTopic"])},this.validateSessionPin=function(e,n){n=n||d,c.debug("[ClientApiHandler]: validateSessionPin...");var t={type:L.GuestActionType.VALIDATE_SESSION_PIN,validateSessionPIN:{pin:e}};A(L.ContentType.GUEST,t,function(e,t){f(e,t,n)&&n(null,t.guest.validateSessionInviteToken)},["request.guest.validateSessionPIN.pin"],["response.guest.validateSessionInviteToken.convTopic"])},this.getRegions=function(e,t){D(function(e,n){n=n||d,c.debug("[ClientApiHandler]: getRegions ...");var t={type:L.GuestActionType.GET_REGIONS,getRegions:{token:{token:e}}};A(L.ContentType.GUEST,t,function(e,t){f(e,t,n)&&n(null,t.guest.getRegions)},null,["response.guest.getRegions.convTopic"])}.bind(this,e,t))},this.getJoiningInstructions=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getJoiningInstructions ...");var i={type:L.GuestActionType.GET_JOINING_INSTRUCTIONS,getJoiningInstructions:{token:{token:e},language:t}};A(L.ContentType.GUEST,i,function(e,t){f(e,t,n)&&n(null,t.guest.getJoiningInstructionsResult)},null,["response.guest.getJoiningInstructionsResult"])},this.registerSessionGuest=function(e,i){i=i||d,c.debug("[ClientApiHandler]: registerSessionGuest...");var t={type:L.GuestActionType.REGISTER_SESSION_GUEST,registerSessionGuest:{token:{token:e.token},firstName:e.firstName,lastName:e.lastName,forTestCall:e.testCall,locale:e.locale,userId:s||void 0,oldClientId:o||void 0,previousServer:r||void 0}};A(L.ContentType.GUEST,t,function(e,t){if(f(e,t,i)){var n=t.guest.registerSessionGuestResult;I=G.convertVersionToNumber(n.apiVersion),r=n.connectedBackend,o=n.clientId,s=n.userId,i(null,n)}},null,["response.guest.registerSessionGuestResult.guestContext"])},this.sendUserToUserRequest=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: sendUserToUserRequest, type: "+e+", data: ",t);var i={type:L.ContentType.USER_TO_USER,userToUser:{type:e,routing:{destUserId:t.destUserId,srcUserId:s,destClientId:t.destClientId,srcClientId:o},data:JSON.stringify(t.content)}};A(L.ContentType.USER_TO_USER,i,function(e,t){f(e,t,n)&&n(null,t.userToUser)},["request.userToUser.userToUser.data"])},this.getPackages=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getPackages...");var t={type:L.AccountActionType.GET_ASSIGNED_PACKAGES};A(L.ContentType.ACCOUNT,t,function(e,t){f(e,t,n)&&n(null,t.account.getAssignedPackages.packages||[])},null,null,e)},this.getAccounts=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getAccounts...");var i={type:L.AccountActionType.GET_ACCOUNTS,getAccounts:{searchCriterias:e.searchCriterias,sorting:e.sorting,ordering:e.ordering,searchPointer:e.searchPointer,pageSize:e.pageSize,excludedTags:e.excludedTags}};A(L.ContentType.ACCOUNT,i,function(e,t){f(e,t,n)&&n(null,t.account.getAccounts)},null,["response.account.getAccounts.accounts"],t)},this.getAccountByUserId=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getAccountByUserId...");var t={type:L.AccountActionType.GET_ACCOUNT_BY_USER_ID,getAccountByUserId:{userId:e}};A(L.ContentType.ACCOUNT,t,function(e,t){f(e,t,n)&&n(null,t.account.getAccountByUserId.account)})},this.migrateAccount=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: migrateAccount...");var i={type:L.AccountActionType.MIGRATE_ACCOUNT,migrateAccount:{accountId:e.accountId,accountTemplateId:e.accountTemplateId}};A(L.ContentType.ACCOUNT,i,function(e,t){f(e,t,n)&&n(null,t.account.migrateAccount)},null,null,t)},this.migrateMultipleUsers=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: migrateMultipleUsers...");var i={type:L.AccountActionType.MIGRATE_MULTIPLE_USERS,migrateMultipleUsers:{accountIds:e.accountIds,accountTemplateId:e.accountTemplateId}};A(L.ContentType.ACCOUNT,i,function(e,t){f(e,t,n)&&n(null,t)},null,null,t)},this.suspendAccount=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: suspendAccount...");var i={type:L.AccountActionType.SUSPEND_ACCOUNT,suspendAccount:{accountId:e}};A(L.ContentType.ACCOUNT,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.unsuspendAccount=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: unsuspendAccount...");var i={type:L.AccountActionType.UNSUSPEND_ACCOUNT,unsuspendAccount:{accountId:e}};A(L.ContentType.ACCOUNT,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.suspendUser=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: suspendUser...");var i={type:L.AdministrationActionType.SUSPEND_USER,suspendUser:{userId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.unsuspendUser=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: unsuspendUser...");var i={type:L.AdministrationActionType.UNSUSPEND_USER,unsuspendUser:{userId:e}};A(L.ContentType.ADMINISTRATION,i,function(e,t){f(e,t,n)&&n(null)},null,null,t)},this.assignTelephonyConfiguration=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: assignTelephonyConfiguration...");var r={type:L.AccountActionType.ASSIGN_TELEPHONY_CONFIGURATION,assignTelephonyConfiguration:{accountId:e,configuration:{phoneNumber:G.cleanPhoneNumber(t.phoneNumber),callerId:G.cleanPhoneNumber(t.callerId),reroutingPhoneNumber:G.cleanPhoneNumber(t.reroutingPhoneNumber),onsSipAuthenticationHash:t.onsSipAuthenticationHash||"",ondSipAuthenticationHash:t.ondSipAuthenticationHash||"",associatedTelephonyUserID:t.associatedTelephonyUserID||"",associatedTelephonyTrunkGroupId:t.associatedTelephonyTrunkGroupId||"",associatedTelephonyUserType:t.associatedTelephonyUserType||void 0}}};A(L.ContentType.ACCOUNT,r,function(e,t){f(e,t,n)&&n(null)},["request.account.assignTelephonyConfiguration.configuration.onsSipAuthenticationHash","request.account.assignTelephonyConfiguration.configuration.ondSipAuthenticationHash"],null,i)},this.renewAssociatedTelephonyUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: renewAssociatedTelephonyUser...");var t={type:L.AccountActionType.RENEW_ASSOCIATED_TELEPHONY_USER,renewAssociatedTelephonyUser:{currentAssociatedTelephonyUserId:e}};A(L.ContentType.ACCOUNT,t,function(e,t){f(e,t,n)&&n(null)})},this.getTechnicalAdminUserId=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getTechnicalAdminUserId...");var t={type:L.AccountActionType.GET_TECHNICAL_ADMIN_USER_ID};A(L.ContentType.ACCOUNT,t,function(e,t){f(e,t,n)&&n(null,t.account.getTechnicalAdminUserIdResult.technicalAdminUserId)},null,null,e)},this.addAccountPermission=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: addAccountPermission...");var i={type:L.AccountActionType.ADD_ACCOUNT_PERMISSION,addAccountPermission:{accountId:e,permissionName:t}};A(L.ContentType.ACCOUNT,i,function(e,t){f(e,t,n)&&n(null)})},this.removeAccountPermission=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: removeAccountPermission...");var i={type:L.AccountActionType.REMOVE_ACCOUNT_PERMISSION,removeAccountPermission:{accountId:e,permissionName:t}};A(L.ContentType.ACCOUNT,i,function(e,t){f(e,t,n)&&n(null)})},this.submitFormData=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: submitFormData...");var i={type:L.CPaaSActionType.SUBMIT_FORM_DATA,submitFormData:{itemId:e,form:t}};A(L.ContentType.CPAAS,i,function(e,t){f(e,t,n)&&n(null)})},this.getUserData=function(n){n=n||d,c.debug("[ClientApiHandler]: getUserData...");var e={type:L.UserDataActionType.GET_USER_DATA};A(L.ContentType.USER_DATA,e,function(e,t){f(e,t,n)&&n(null,t.userData.getUserData)})},this.getTenantIntegrations=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getTenantIntegrations...");var t={type:L.CPaaSActionType.GET_TENANT_INTEGRATIONS,getTenantIntegrations:{state:e.state,pageSize:e.pageSize,searchPointer:e.searchPointer}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n,!0)&&n(null,t.cpaas.getTenantIntegrationsResult.integrations||[])})},this.getConversationIntegrations=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConversationIntegrations...");var t={type:L.CPaaSActionType.GET_CONVERSATION_INTEGRATIONS,getConversationIntegrations:{convId:e.convId,pageSize:e.pageSize,searchPointer:e.searchPointer}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n,!0)&&n(null,t.cpaas.getConversationIntegrationsResult.integrations||[])})},this.getIntegrationData=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getIntegrationData...");var t={type:L.CPaaSActionType.GET_INTEGRATION_DATA,getIntegrationData:{key:e.key,type:e.type,payload:JSON.stringify({convId:e.convId})}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null,t.cpaas.getIntegrationDataResult)})},this.enableConversationIntegration=function(e,n){n=n||d,c.debug("[ClientApiHandler]: enableConversationIntegration...");var t={type:L.CPaaSActionType.ENABLE_CONVERSATION_INTEGRATION,enableConversationIntegration:{key:e.key,convId:e.convId,convIntegrationId:e.convIntegrationId,configMap:e.configMap}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null)})},this.updateConversationIntegration=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateConversationIntegration...");var t={type:L.CPaaSActionType.UPDATE_CONVERSATION_INTEGRATION,updateConversationIntegration:{key:e.key,convId:e.convId,convIntegrationId:e.convIntegrationId,oldConvIntegrationId:e.oldConvIntegrationId,configMap:e.configMap}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null)})},this.disableConversationIntegration=function(e,n){n=n||d,c.debug("[ClientApiHandler]: disableConversationIntegration...");var t={type:L.CPaaSActionType.DISABLE_CONVERSATION_INTEGRATION,disableConversationIntegration:{key:e.key,convId:e.convId,convIntegrationId:e.convIntegrationId}};A(L.ContentType.CPAAS,t,function(e,t){f(e,t,n)&&n(null)})},this.createSpace=function(e,n){n=n||d,c.debug("[ClientApiHandler]: createSpace...");var t={type:L.SpaceActionType.CREATE,create:{name:e.name,type:e.type,accessModeType:e.accessModeType,status:e.status,description:e.description,smallPictureBase64:e.smallPictureBase64,largePictureBase64:e.largePictureBase64,tags:e.tags}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.createResult.space)},["request.space.create.name","request.space.create.description","request.space.create.tags"],["response.space.createResult.space.name","response.space.createResult.space.description","response.space.createResult.space.tags"])},this.updateSpace=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateSpace...");var t={type:L.SpaceActionType.UPDATE,update:{spaceId:e.spaceId,name:e.name||void 0,type:e.type,accessModeType:e.accessModeType,status:e.status,description:e.description,smallPictureBase64:e.smallPictureBase64,largePictureBase64:e.largePictureBase64,tags:e.tags,ownerId:e.ownerId,defaultRole:e.defaultRole,permissionAddParticipant:e.permissionAddParticipant}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.updateResult.space)},["request.space.update.name","request.space.update.description","request.space.update.tags"],["response.space.updateResult.space.name","response.space.updateResult.space.description","response.space.updateResult.space.tags"])},this.deleteSpace=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteSpace...");var t={type:L.SpaceActionType.DELETE,delete:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.subscribeForSpace=function(e,n){n=n||d,c.debug("[ClientApiHandler]: subscribeForSpace...");var t={type:L.SpaceActionType.SUBSCRIBE,subscribe:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.unsubscribeForSpace=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unsubscribeForSpace...");var t={type:L.SpaceActionType.UNSUBSCRIBE,unsubscribe:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.clearNCA=function(n){n=n||d,c.debug("[ClientApiHandler]: clearNCA...");var e={type:L.SpaceActionType.CLEAR_NCA};A(L.ContentType.SPACE,e,function(e,t){f(e,t,n)&&n(null)})},this.getNCAData=function(e,t,n,i){if(i=i||d,c.debug("[ClientApiHandler]: getNCAData..."),!e)return c.warn("[ClientApiHandler]: Missing timestamp"),void v(i,L.ReturnCode.INVALID_MESSAGE);var r={type:L.SpaceActionType.GET_NCA_DATA,getNCAData:{timestamp:e,spaceId:t||void 0,topicId:n||void 0}};A(L.ContentType.SPACE,r,function(e,t){f(e,t,i)&&i(null,t.space.getNCADataResult)},null,["response.space.getNCADataResult.getTopicWithRepliesResult.topic.topic.subject","response.space.getNCADataResult.getTopicWithRepliesResult.topic.content","response.space.getNCADataResult.getTopicWithRepliesResult.topic.contentTags","response.space.getNCADataResult.getTopicWithRepliesResult.topic.tags","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].content","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].attachments","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].contentTags","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].sharedItems.[].containerName","response.space.getNCADataResult.getTopicWithRepliesResult.replies.[].sharedItems.[].topicSubject"])},this.existsSpaceName=function(e,n){n=n||d,c.debug("[ClientApiHandler]: existsSpaceName...");var t={type:L.SpaceActionType.EXISTS_SPACE_NAME,existsSpaceName:{spaceName:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.existsSpaceNameResult.exists)},["request.space.existsSpaceName.spaceName"])},this.setGlobalSpacesConfiguration=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: setGlobalSpacesConfiguration..."),!e)return c.warn("[ClientApiHandler]: No settings were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);var t={type:L.SpaceActionType.SET_GLOBAL_CONFIGURATION,setGlobalConfiguration:{globalSpaceCreationEnabled:!!e.globalSpaceCreationEnabled,allowExternalSpaceMembers:!!e.allowExternalSpaceMembers,defaultSpaceType:e.defaultSpaceType||L.SpaceType.SECRET}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.getGlobalSpacesConfiguration=function(n){n=n||d,c.debug("[ClientApiHandler]: getGlobalSpacesConfiguration...");var e={type:L.SpaceActionType.GET_GLOBAL_CONFIGURATION};A(L.ContentType.SPACE,e,function(e,t){f(e,t,n)&&n(null,t.space.getGlobalConfigurationResult)})},this.favoriteSpace=function(e,t,n){if(n=n||d,c.debug("[ClientApiHandler]: favoriteSpace..."),!C.isSpacesFavoritesSupported())return c.warn("[ClientApiHandler]: The favoriteSpace operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);var i={type:L.SpaceActionType.SET_FAVORITE_SPACE,setFavoriteSpace:{spaceId:e,position:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null)})},this.unfavoriteSpace=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: unfavoriteSpace..."),!C.isSpacesFavoritesSupported())return c.warn("[ClientApiHandler]: The unfavoriteSpace operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:L.SpaceActionType.REMOVE_FAVORITE_SPACE_MARKER,removeFavoriteSpaceMarker:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.getFavoriteSpaces=function(n){if(n=n||d,c.debug("[ClientApiHandler]: getFavoriteSpaces..."),!C.isSpacesFavoritesSupported())return c.warn("[ClientApiHandler]: The getFavoriteSpaces operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);var e={type:L.SpaceActionType.GET_FAVORITE_SPACES};A(L.ContentType.SPACE,e,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?n(null,{favoriteSpaces:[],maxFavoriteSpaces:0}):f(e,t,n)&&n(null,t.space.getFavoriteSpacesResult)},null,["response.space.getFavoriteSpacesResult.favoriteSpaces.[].space.name","response.space.getFavoriteSpacesResult.favoriteSpaces.[].space.description","response.space.getFavoriteSpacesResult.favoriteSpaces.[].space.tags"])},this.getSpaces=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: getSpaces...");var r={type:L.SpaceActionType.GET_SPACES,getSpaces:{number:e||void 0,timestamp:t||void 0,labelIds:n||void 0}};A(L.ContentType.SPACE,r,function(e,t){f(e,t,i,!0)&&i(null,t.space.getSpacesResult.space||[])},null,["response.space.getSpacesResult.space.[].name","response.space.getSpacesResult.space.[].description","response.space.getSpacesResult.space.[].tags"])},this.getSpacesByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getSpacesByIds...");var t={type:L.SpaceActionType.GET_SPACES_BY_IDS,getSpacesByIds:{spaceIds:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n,!0)&&n(null,t.space.getSpacesByIdsResult.space||[])},null,["response.space.getSpacesByIdsResult.space.[].name","response.space.getSpacesByIdsResult.space.[].description","response.space.getSpacesByIdsResult.space.[].tags"])},this.searchSpaceTags=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: searchSpaceSuggestedTags...");var i={type:L.SpaceActionType.SEARCH_TAGS,searchTags:{queryTag:e,numberOfResults:t||void 0}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n,!0)&&n(null,t.space.searchTagsResult.tags||[])},null,["response.space.searchTagsResult.tags"])},this.getSpacesDirectory=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getSpacesDirectory...");var t={type:L.SpaceActionType.GET_DIRECTORY,getDirectory:{sortBy:e.sortBy,sortOrder:e.sortOrder,filter:e.filter||void 0,query:e.query||void 0,numberOfResults:e.numberOfResults||void 0,pagePointer:e.pagePointer||void 0}};A(L.ContentType.SPACE,t,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?n(null,{space:[],hasMore:!1}):f(e,t,n)&&n(null,t.space.getDirectoryResult)},null,["response.space.getDirectoryResult.space.[].name","response.space.getDirectoryResult.space.[].description","response.space.getDirectoryResult.space.[].tags"])},this.getSpacesAdminDirectory=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getSpacesAdminDirectory...");var t={type:L.SpaceActionType.GET_ADMIN_DIRECTORY,getAdminDirectory:{sortBy:e.sortBy,sortOrder:e.sortOrder,filter:e.filter||void 0,query:e.query||void 0,numberOfResults:e.numberOfResults||void 0,pagePointer:e.pagePointer||void 0}};A(L.ContentType.SPACE,t,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?n(null,{space:[],hasMore:!1}):f(e,t,n)&&n(null,t.space.getAdminDirectoryResult)},null,["response.space.getAdminDirectoryResult.space.[].name","response.space.getAdminDirectoryResult.space.[].description","response.space.getAdminDirectoryResult.space.[].tags"])},this.selectSpace=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: selectSpace...");var i={type:L.SpaceActionType.SELECT_SPACE,selectSpace:{spaceId:e,numberOfResults:t||void 0}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null,t.space.selectSpaceResult)},null,["response.space.selectSpaceResult.space.name","response.space.selectSpaceResult.space.description","response.space.selectSpaceResult.space.tags","response.space.selectSpaceResult.welcomeBox","response.space.selectSpaceResult.items.[].topic.subject","response.space.selectSpaceResult.items.[].content","response.space.selectSpaceResult.items.[].attachments","response.space.selectSpaceResult.items.[].contentTags","response.space.selectSpaceResult.items.[].tags","response.space.selectSpaceResult.pinnedTopics.[].subject"])},this.getParticipantsImportData=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getParticipantsImportData...");var t={type:L.SpaceActionType.GET_PARTICIPANTS_IMPORT_DATA,getParticipantsImportData:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.getParticipantsImportDataResult)})},this.getSpacePreviewData=function(e,t,n){if(n=n||d,c.debug("[ClientApiHandler]: getSpacePreviewData..."),!C.isSpaceLinkPreviewSupported())return c.warn("[ClientApiHandler]: The getSpacePreviewData operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);var i={type:L.SpaceActionType.GET_SPACE_PREVIEW_DATA,getSpacePreviewData:{spaceId:e,itemId:t||void 0}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null,t.space.getSpacePreviewDataResult)},null,["response.space.getSpacePreviewDataResult.space.name","response.space.getSpacePreviewDataResult.space.description","response.space.getSpacePreviewDataResult.space.tags","response.space.getSpacePreviewDataResult.parentItem.topic.subject","response.space.getSpacePreviewDataResult.parentItem.content","response.space.getSpacePreviewDataResult.parentItem.contentTags","response.space.getSpacePreviewDataResult.parentItem.attachments","response.space.getSpacePreviewDataResult.parentItem.tags","response.space.getSpacePreviewDataResult.reply.content","response.space.getSpacePreviewDataResult.reply.attachments","response.space.getSpacePreviewDataResult.reply.contentTags"])},this.addSpaceParticipants=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: addSpaceParticipants...");var i={type:L.SpaceActionType.ADD_PARTICIPANTS,addParticipants:{spaceId:e,participants:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null,t.space.addParticipantsResult)})},this.addSpaceParticipantsSearch=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: addSpaceParticipantsSearch...");var i={type:L.SpaceActionType.ADD_PARTICIPANTS_SEARCH,addParticipantsSearch:{spaceId:e,query:t}};A(L.ContentType.SPACE,i,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?n(null,{participants:[],hasMore:!1}):f(e,t,n)&&n(null,t.space.addParticipantsSearchResult)})},this.updateSpaceParticipant=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: updateSpaceParticipant...");var i={type:L.SpaceActionType.UPDATE_PARTICIPANT,updateParticipant:{spaceId:e,userId:t.userId,role:t.role}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null)})},this.removeSpaceParticipants=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: removeSpaceParticipants...");var i={type:L.SpaceActionType.REMOVE_PARTICIPANTS,removeParticipants:{spaceId:e,userIds:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null)})},this.importSpaceParticipants=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: importSpaceParticipants...");var i={type:L.SpaceActionType.IMPORT_PARTICIPANTS,importParticipants:{spaceId:e,fileId:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null)})},this.getSpaceParticipants=function(e,t,i){i=i||d,c.debug("[ClientApiHandler]: getSpaceParticipants..."),t=t||{};var n={type:L.SpaceActionType.GET_PARTICIPANTS,getParticipants:{spaceId:e,sortBy:t.sortBy,sortOrder:t.sortOrder,filter:t.filter||void 0,query:t.query||"",pagePointer:t.pagePointer||void 0,numberOfResults:t.numberOfResults||void 0}};A(L.ContentType.SPACE,n,function(e,t){if(t&&t.code===L.ReturnCode.NO_RESULT)i(null,{participants:[],hasMore:!1});else if(f(e,t,i)){var n=t.space.getParticipantsResult;n.participants=n.participants||[],i(null,n)}})},this.getSpacePendingParticipants=function(e,t,i){i=i||d,c.debug("[ClientApiHandler]: getSpacePendingParticipants...");var n={type:L.SpaceActionType.GET_PENDING_PARTICIPANTS,getPendingParticipants:{spaceId:e,pagePointer:t&&t.pagePointer||void 0,numberOfResults:t&&t.numberOfResults||void 0}};A(L.ContentType.SPACE,n,function(e,t){if(t&&t.code===L.ReturnCode.NO_RESULT)i(null,{participants:[],hasMore:!1});else if(f(e,t,i)){var n=t.space.getPendingParticipantsResult;n.participants=n.participants||[],i(null,n)}})},this.searchSpaceParticipants=function(e,t,i){i=i||d,c.debug("[ClientApiHandler]: searchSpaceParticipants...");var n={type:L.SpaceActionType.SEARCH_SPACE_PARTICIPANTS,searchSpaceParticipants:{spaceId:e,query:t}};A(L.ContentType.SPACE,n,function(e,t){if(t&&t.code===L.ReturnCode.NO_RESULT)i(null,{participants:[],hasMore:!1});else if(f(e,t,i)){var n=t.space.searchSpaceParticipantsResult;n.participants=n.participants||[],i(null,n)}})},this.joinSpace=function(e,n){n=n||d,c.debug("[ClientApiHandler]: joinSpace...");var t={type:L.SpaceActionType.JOIN,join:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.joinResult.space)},null,["response.space.joinResult.space.name","response.space.joinResult.space.description","response.space.joinResult.space.tags"])},this.leaveSpace=function(e,n){n=n||d,c.debug("[ClientApiHandler]: leaveSpace...");var t={type:L.SpaceActionType.LEAVE,leave:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.requestSpaceAccess=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: requestSpaceAccess...");var i={type:L.SpaceActionType.REQUEST_ACCESS,requestAccess:{spaceId:e,reason:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null)},["request.space.requestAccess.reason"])},this.grantSpaceAccess=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: grantSpaceAccess...");var i={type:L.SpaceActionType.GRANT_ACCESS,grantAccess:{spaceId:e,userId:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null)})},this.denySpaceAccess=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: denySpaceAccess...");var r={type:L.SpaceActionType.DENY_ACCESS,denyAccess:{spaceId:e,userId:t,reason:n}};A(L.ContentType.SPACE,r,function(e,t){f(e,t,i)&&i(null)},["request.space.denyAccess.reason"])},this.isExternalParticipantInSpace=function(e,n){n=n||d,c.debug("[ClientApiHandler]: isExternalParticipantInSpace...");var t={type:L.SpaceActionType.IS_EXTERNAL_PARTICIPANT_IN_SPACE,isExternalParticipantInSpace:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.isExternalParticipantInSpaceResult.atLeastOneExternalParticipant)})},this.updateSpaceReadTimestamp=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: updateSpaceReadTimestamp...");var i={type:L.SpaceActionType.UPDATE_READ_TIMESTAMP,updateReadTimestamp:{spaceId:e,timestamp:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null)})},this.assignSpaceLabels=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: assignSpaceLabels...");var i={type:L.SpaceActionType.ASSIGN_LABELS,assignLabels:{spaceId:e,labelIds:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n,!0)&&n(null,t.space.assignLabelsResult.labelIds||[])})},this.unassignSpaceLabels=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: unassignSpaceLabels...");var i={type:L.SpaceActionType.UNASSIGN_LABELS,unassignLabels:{spaceId:e,labelIds:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n,!0)&&n(null,t.space.unassignLabelsResult.labelIds||[])})},this.getSpaceTopics=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: getSpaceTopics...");var r={type:L.SpaceActionType.GET_TOPICS,getTopics:{spaceId:e,number:t||void 0,timestamp:n||void 0}};A(L.ContentType.SPACE,r,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?i(null,{items:[],hasMore:!1}):f(e,t,i)&&i(null,t.space.getTopicsResult)},null,["response.space.getTopicsResult.items.[].topic.subject","response.space.getTopicsResult.items.[].content","response.space.getTopicsResult.items.[].attachments","response.space.getTopicsResult.items.[].contentTags","response.space.getTopicsResult.items.[].tags","response.space.getTopicsResult.items.[].sharedItems.[].containerName","response.space.getTopicsResult.items.[].sharedItems.[].topicSubject"])},this.getSpaceTopicWithReplies=function(e,t,n,i,r,o){o=o||d,c.debug("[ClientApiHandler]: getSpaceTopicWithReplies...");var a={type:L.SpaceActionType.GET_TOPIC_WITH_REPLIES,getTopicWithReplies:{topicId:e,timestamp:t||void 0,minResults:n||void 0,maxResults:i||void 0,matchingItemIds:r||void 0}};A(L.ContentType.SPACE,a,function(e,t){f(e,t,o)&&o(null,t.space.getTopicWithRepliesResult)},null,["response.space.getTopicWithRepliesResult.topic.topic.subject","response.space.getTopicWithRepliesResult.topic.content","response.space.getTopicWithRepliesResult.topic.contentTags","response.space.getTopicWithRepliesResult.topic.tags","response.space.getTopicWithRepliesResult.topic.poll.options.[].text","response.space.getTopicWithRepliesResult.replies.[].content","response.space.getTopicWithRepliesResult.replies.[].attachments","response.space.getTopicWithRepliesResult.replies.[].contentTags","response.space.getTopicWithRepliesResult.replies.[].sharedItems.[].containerName","response.space.getTopicWithRepliesResult.replies.[].sharedItems.[].topicSubject","response.space.getTopicWithRepliesResult.additionalReplies.[].reply.content","response.space.getTopicWithRepliesResult.additionalReplies.[].reply.attachments","response.space.getTopicWithRepliesResult.additionalReplies.[].reply.contentTags","response.space.getTopicWithRepliesResult.additionalReplies.[].sharedItems.[].containerName","response.space.getTopicWithRepliesResult.additionalReplies.[].sharedItems.[].topicSubject"])},this.getOpenSpacePolls=function(e,t,n,i){if(i=i||d,c.debug("[ClientApiHandler]: getOpenSpacePolls..."),b("getOpenSpacePolls",i)){var r={type:L.SpaceActionType.GET_OPEN_POLLS,getOpenPolls:{spaceId:e,searchPointer:t||void 0,numberOfResults:n||void 0}};A(L.ContentType.SPACE,r,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?i(null,{openPolls:[],hasMore:!1}):f(e,t,i)&&i(null,t.space.getOpenPollsResult)},null,["response.space.getOpenPollsResult.openPolls.[].subject"])}},this.getSpaceReplies=function(e,t,n,i,r){r=r||d,c.debug("[ClientApiHandler]: getSpaceReplies...");var o={type:L.SpaceActionType.GET_REPLIES,getReplies:{topicId:e,timestamp:t||void 0,numberOfResults:n||void 0,direction:i||void 0}};A(L.ContentType.SPACE,o,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?r(null,{items:[],hasMore:!1}):f(e,t,r)&&r(null,t.space.getRepliesResult)},null,["response.space.getRepliesResult.items.[].content","response.space.getRepliesResult.items.[].attachments","response.space.getRepliesResult.items.[].contentTags","response.space.getRepliesResult.items.[].tags","response.space.getRepliesResult.items.[].sharedItems.[].containerName","response.space.getRepliesResult.items.[].sharedItems.[].topicSubject"])},this.getSpaceMatchingReplies=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getSpaceMatchingReplies...");var i={type:L.SpaceActionType.GET_MATCHING_REPLIES,getMatchingReplies:{topic:e,itemIds:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n,!0)&&n(null,t.space.getMatchingRepliesResult.linkedReplies||[])},null,["response.space.getMatchingRepliesResult.linkedReplies.[].reply.content","response.space.getMatchingRepliesResult.linkedReplies.[].reply.attachments","response.space.getMatchingRepliesResult.linkedReplies.[].reply.contentTags","response.space.getMatchingRepliesResult.linkedReplies.[].sharedItems.[].containerName","response.space.getMatchingRepliesResult.linkedReplies.[].sharedItems.[].topicSubject"])},this.getSpaceItemsByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getSpaceItemsByIds...");var t={type:L.SpaceActionType.GET_ITEMS_BY_IDS,getItemsByIds:{itemIds:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n,!0)&&n(null,t.space.getItemsByIdsResult.items)},null,["response.space.getItemsByIdsResult.items.[].topic.subject","response.space.getItemsByIdsResult.items.[].content","response.space.getItemsByIdsResult.items.[].attachments","response.space.getItemsByIdsResult.items.[].contentTags","response.space.getItemsByIdsResult.items.[].tags","response.space.getItemsByIdsResult.items.[].sharedItems.[].containerName","response.space.getItemsByIdsResult.items.[].sharedItems.[].topicSubject"])},this.createSpaceTopic=function(e,n){n=n||d,c.debug("[ClientApiHandler]: createSpaceTopic...");var t={type:L.SpaceActionType.CREATE_TOPIC,createTopic:{spaceId:e.spaceId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:i(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&(t.space.createTopicResult.item.sanitized=S,n(null,t.space.createTopicResult.item))},["request.space.createTopic.subject","request.space.createTopic.content","request.space.createTopic.attachments.[].fileName","request.space.createTopic.contentTags","request.space.createTopic.tags"],["response.space.createTopicResult.item.topic.subject","response.space.createTopicResult.item.content","response.space.createTopicResult.item.attachments","response.space.createTopicResult.item.contentTags","response.space.createTopicResult.item.tags"])},this.createSpacePoll=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: createSpacePoll..."),b("createSpacePoll",n)){var t={type:L.SpaceActionType.CREATE_POLL,createPoll:{spaceId:e.spaceId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:i(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0,options:e.options||void 0,voteMultipleOptions:i(e.voteMultipleOptions),hideVoterIdentity:i(e.hideVoterIdentity),hideOpenVoteResults:i(e.hideOpenVoteResults),duration:e.duration||void 0,status:e.status}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&(t.space.createPollResult.item.sanitized=S,n(null,t.space.createPollResult.item))},["request.space.createPoll.subject","request.space.createPoll.content","request.space.createPoll.attachments.[].fileName","request.space.createPoll.contentTags","request.space.createPoll.tags","request.space.createPoll.options"],["response.space.createPollResult.item.subject","response.space.createPollResult.item.content","response.space.createPollResult.item.attachments","response.space.createPollResult.item.contentTags","response.space.createPollResult.item.tags","response.space.createPollResult.item.poll.options.[].text"])}},this.createSpaceReply=function(e,n){n=n||d,c.debug("[ClientApiHandler]: createSpaceReply...");var t={type:L.SpaceActionType.CREATE_REPLY,createReply:{topicId:e.topicId,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:i(e.complex),contentTags:e.contentTags||void 0,sharedItems:e.sharedItems||void 0}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&(t.space.createReplyResult.item.sanitized=S,n(null,t.space.createReplyResult.item))},["request.space.createReply.content","request.space.createReply.attachments.[].fileName","request.space.createReply.contentTags"],["response.space.createReplyResult.item.content","response.space.createReplyResult.item.attachments","response.space.createReplyResult.item.contentTags","response.space.createReplyResult.item.sharedItems.[].containerName","response.space.createReplyResult.item.sharedItems.[].topicSubject"])},this.updateSpaceTopic=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateSpaceTopic...");var t={type:L.SpaceActionType.UPDATE_TOPIC,updateTopic:{topicId:e.topicId,subject:e.subject,content:e.content,mentionedUsers:e.mentionedUsers,attachments:e.attachments,externalAttachments:e.externalAttachments,formMetaData:e.formMetaData,preview:e.preview,complex:i(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&(t.space.updateTopicResult.item.sanitized=S,n(null,t.space.updateTopicResult.item))},["request.space.updateTopic.subject","request.space.updateTopic.content","request.space.updateTopic.attachments.[].fileName","request.space.updateTopic.contentTags","request.space.updateTopic.tags"],["response.space.updateTopicResult.item.topic.subject","response.space.updateTopicResult.item.content","response.space.updateTopicResult.item.attachments","response.space.updateTopicResult.item.contentTags","response.space.updateTopicResult.item.tags"])},this.updateSpacePoll=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: updateSpacePoll..."),b("updateSpacePoll",n)){var t={type:L.SpaceActionType.UPDATE_POLL,updatePoll:{itemId:e.itemId,subject:e.subject,content:e.content||void 0,mentionedUsers:e.mentionedUsers||void 0,attachments:e.attachments||void 0,externalAttachments:e.externalAttachments||void 0,formMetaData:e.formMetaData||void 0,preview:e.preview||void 0,complex:i(e.complex),contentTags:e.contentTags||void 0,tags:e.tags||void 0,options:e.options||void 0,voteMultipleOptions:i(e.voteMultipleOptions),hideVoterIdentity:i(e.hideVoterIdentity),hideOpenVoteResults:i(e.hideOpenVoteResults),duration:e.duration||void 0,status:e.status}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&(t.space.updatePollResult.item.sanitized=S,n(null,t.space.updatePollResult.item))},["request.space.updatePoll.subject","request.space.updatePoll.content","request.space.updatePoll.attachments.[].fileName","request.space.updatePoll.contentTags","request.space.updatePoll.tags","request.space.updatePoll.options.[].text"],["response.space.updatePollResult.item.subject","response.space.updatePollResult.item.content","response.space.updatePollResult.item.attachments","response.space.updatePollResult.item.contentTags","response.space.updatePollResult.item.tags","response.space.updatePollResult.item.poll.options.[].text"])}},this.updateSpaceReply=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateSpaceReply...");var t={type:L.SpaceActionType.UPDATE_REPLY,updateReply:{replyId:e.replyId,content:e.content,mentionedUsers:e.mentionedUsers,attachments:e.attachments,externalAttachments:e.externalAttachments,formMetaData:e.formMetaData,preview:e.preview,complex:i(e.complex),contentTags:e.contentTags||void 0,sharedItems:e.sharedItems||void 0}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&(t.space.updateReplyResult.item.sanitized=S,n(null,t.space.updateReplyResult.item))},["request.space.updateReply.content","request.space.updateReply.attachments.[].fileName","request.space.updateReply.contentTags"],["response.space.updateReplyResult.item.content","response.space.updateReplyResult.item.attachments","response.space.updateReplyResult.item.contentTags","response.space.updateReplyResult.item.sharedItems.[].containerName","response.space.updateReplyResult.item.sharedItems.[].topicSubject"])},this.deleteSpaceItem=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteSpaceItem...");var t={type:L.SpaceActionType.DELETE_ITEM,deleteItem:{itemId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.closeSpacePoll=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: closeSpacePoll..."),b("closeSpacePoll",n)){var t={type:L.SpaceActionType.CLOSE_POLL,closePoll:{itemId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&(t.space.closePollResult.item.sanitized=S,n(null,t.space.closePollResult.item))},null,["response.space.closePollResult.item.content","response.space.closePollResult.item.attachments","response.space.closePollResult.item.contentTags","response.space.closePollResult.item.sharedItems.[].containerName","response.space.closePollResult.item.sharedItems.[].topicSubject","response.space.closePollResult.item.poll.options.[].text"])}},this.voteSpacePoll=function(e,t,n){if(n=n||d,c.debug("[ClientApiHandler]: voteSpacePoll..."),b("voteSpacePoll",n)){var i={type:L.SpaceActionType.VOTE_POLL_OPTIONS,votePollOptions:{itemId:e,optionIds:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&(t.space.votePollOptionsResult.item.sanitized=S,n(null,t.space.votePollOptionsResult.item))},null,["response.space.votePollOptionsResult.item.content","response.space.votePollOptionsResult.item.attachments","response.space.votePollOptionsResult.item.contentTags","response.space.votePollOptionsResult.item.sharedItems.[].containerName","response.space.votePollOptionsResult.item.sharedItems.[].topicSubject","response.space.votePollOptionsResult.item.poll.options.[].text"])}},this.getSpacePollOptionVoters=function(e,t,n,i){if(i=i||d,c.debug("[ClientApiHandler]: getSpacePollOptionVoters..."),b("getSpacePollOptionVoters",i)){var r={type:L.SpaceActionType.GET_POLL_OPTION_VOTERS,getPollOptionVoters:{itemId:e,optionId:t,searchPointer:n&&n.searchPointer||void 0,numberOfResults:n&&n.numberOfResults||void 0}};A(L.ContentType.SPACE,r,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?i(null,{participants:[],hasMore:!1}):f(e,t,i)&&i(null,t.space.getPollOptionVotersResult)})}},this.getSpaceLikes=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: getSpaceLikes...");var r={type:L.SpaceActionType.GET_LIKES,getLikes:{itemId:e,searchPointer:t||void 0,numberOfResults:n||void 0}};A(L.ContentType.SPACE,r,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?i(null,{participants:[],hasMore:!1}):f(e,t,i)&&i(null,t.space.getLikesResult)})},this.likeSpaceItem=function(e,n){n=n||d,c.debug("[ClientApiHandler]: likeSpaceItem...");var t={type:L.SpaceActionType.LIKE,like:{itemId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.unlikeSpaceItem=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unlikeSpaceItem...");var t={type:L.SpaceActionType.UNLIKE,unlike:{itemId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.getFlaggedSpaceItemsCount=function(n){if(n=n||d,c.debug("[ClientApiHandler]: getFlaggedSpaceItemsCount..."),!C.isSpaceFlaggedItemsCountSupported())return c.warn("[ClientApiHandler]: The getFlaggedSpaceItemsCount operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);var e={type:L.SpaceActionType.GET_FLAGGED_ITEMS_COUNT};A(L.ContentType.SPACE,e,function(e,t){f(e,t,n)&&n(null,t.space.getFlaggedItemsCountResult.flaggedItemsCount)})},this.getFlaggedSpaceItems=function(e,t,n,i,r){r=r||d,c.debug("[ClientApiHandler]: getFlaggedSpaceItems...");var o={type:L.SpaceActionType.GET_FLAGGED_ITEMS,getFlaggedItems:{timestamp:e||void 0,direction:t||void 0,searchPointer:n||void 0,numberOfResults:i||void 0}};A(L.ContentType.SPACE,o,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?r(null,{items:[],hasMore:!1}):f(e,t,r)&&r(null,t.space.getFlaggedItemsResult)},null,["response.space.getFlaggedItemsResult.items.[].space.name","response.space.getFlaggedItemsResult.items.[].space.description","response.space.getFlaggedItemsResult.items.[].space.tags","response.space.getFlaggedItemsResult.items.[].parentTopic.topic.subject","response.space.getFlaggedItemsResult.items.[].parentTopic.content","response.space.getFlaggedItemsResult.items.[].parentTopic.poll.subject","response.space.getFlaggedItemsResult.items.[].item.poll.subject","response.space.getFlaggedItemsResult.items.[].item.topic.subject","response.space.getFlaggedItemsResult.items.[].item.topic.content","response.space.getFlaggedItemsResult.items.[].item.content","response.space.getFlaggedItemsResult.items.[].item.attachments","response.space.getFlaggedItemsResult.items.[].item.contentTags","response.space.getFlaggedItemsResult.items.[].item.tags","response.space.getFlaggedItemsResult.items.[].item.sharedItems.[].containerName","response.space.getFlaggedItemsResult.items.[].item.sharedItems.[].topicSubject"])},this.getFlaggedSpaceItemsByIds=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: getFlaggedSpaceItemsByIds..."),!C.isSpaceFlaggedItemsByIdsSupported())return c.warn("[ClientApiHandler]: The getFlaggedSpaceItemsByIds operation is not supported by the backend"),void v(n,L.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:L.SpaceActionType.GET_SPACE_ITEMS_BY_IDS_WITH_TOPIC_AND_SPACE_ID,getSpaceItemsByIdsWithTopicAndSpaceId:{itemIds:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n,!0)&&n(null,t.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult)},null,["response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].space.name","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].space.description","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].space.tags","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].parentTopic.topic.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].parentTopic.content","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].parentTopic.poll.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.poll.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.topic.subject","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.topic.content","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.content","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.attachments","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.contentTags","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.tags","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.sharedItems.[].containerName","response.space.getSpaceItemsByIdsWithTopicAndSpaceIdResult.items.[].item.sharedItems.[].topicSubject"])},this.flagSpaceItem=function(e,n){n=n||d,c.debug("[ClientApiHandler]: flagSpaceItem...");var t={type:L.SpaceActionType.FLAG,flag:{itemId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.unflagSpaceItem=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unflagSpaceItem...");var t={type:L.SpaceActionType.UNFLAG,unflag:{itemId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.pinSpaceTopic=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: pinSpaceTopic...");var i={type:L.SpaceActionType.PIN_TOPIC,pinTopic:{topicId:e,position:t}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null)})},this.unpinSpaceTopic=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unpinSpaceTopic...");var t={type:L.SpaceActionType.UNPIN_TOPIC,unpinTopic:{topicId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.getPinnedSpaceTopics=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getPinnedSpaceTopics...");var t={type:L.SpaceActionType.GET_PINNED_TOPICS,getPinnedTopics:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?n(null,{topics:[],maxPinnedTopics:0}):f(e,t,n)&&n(null,t.space.getPinnedTopicsResult)},null,["response.space.getPinnedTopicsResult.topics.[].subject"])},this.setSpaceWelcomeBox=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setSpaceWelcomeBox...");var t={type:L.SpaceActionType.SET_WELCOME_BOX,setWelcomeBox:{spaceId:e.spaceId,content:e.content||void 0,attachments:e.attachments||void 0,formMetaData:e.formMetaData||void 0,complex:i(e.complex),displayWelcomeBox:i(e.displayWelcomeBox)}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.setWelcomeBoxResult.item)},["request.space.setWelcomeBox.content","request.space.setWelcomeBox.attachments.[].fileName"],["response.space.setWelcomeBoxResult.item.content","response.space.setWelcomeBoxResult.item.attachments"])},this.getSpaceWelcomeBox=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getSpaceWelcomeBox...");var t={type:L.SpaceActionType.GET_WELCOME_BOX,getWelcomeBox:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.getWelcomeBoxResult.item)},null,["response.space.getWelcomeBoxResult.item.content","response.space.getWelcomeBoxResult.item.attachments"])},this.deleteSpaceWelcomeBox=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteSpaceWelcomeBox...");var t={type:L.SpaceActionType.DELETE_WELCOME_BOX,deleteWelcomeBox:{spaceId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.getSpaceFiles=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getSpaceFiles...");var i={type:L.SpaceActionType.GET_SPACE_FILES,getSpaceFiles:{spaceId:e,sortedBy:t.sortBy,sortOrder:t.sortOrder,query:t.query||void 0,pagePointer:t.searchPointer||void 0,numberOfResults:t.numberOfResults||void 0}};A(L.ContentType.SPACE,i,function(e,t){t&&t.code===L.ReturnCode.NO_RESULT?n(null,{documents:[],hasMore:!1}):f(e,t,n)&&n(null,t.space.getSpaceFilesResult)})},this.updateSpaceTopicTags=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: updateSpaceTopicTags...");var i={type:L.SpaceActionType.UPDATE_TOPIC_TAGS,updateTopicTags:{topicId:e,tags:t||void 0}};A(L.ContentType.SPACE,i,function(e,t){f(e,t,n)&&n(null,t.space.updateTopicTagsResult.item)},["request.space.updateTopicTags.tags"],["response.space.updateTopicTagsResult.item.topic.subject","response.space.updateTopicTagsResult.item.content","response.space.updateTopicTagsResult.item.attachments","response.space.updateTopicTagsResult.item.contentTags","response.space.updateTopicTagsResult.item.tags"])},this.startBasicSpaceSearch=function(e,n){n=n||d,c.debug("[ClientApiHandler]: startBasicSpaceSearch...");var t={type:L.SpaceActionType.START_BASIC_SEARCH,startBasicSearch:{searchTerm:e.searchTerms,prioritySpaces:e.prioritySpaces||void 0,resultSetLimit:e.resultSetLimit||0,searchId:e.searchId||void 0}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.startBasicSearchResult.searchId)})},this.startDetailSpaceSearch=function(e,n){n=n||d,c.debug("[ClientApiHandler]: startDetailSpaceSearch...");var t={type:L.SpaceActionType.START_DETAILED_SEARCH,startDetailedSearch:{searchTerm:e.searchTerm,spaceId:e.spaceId,resultSetLimit:e.resultSetLimit||0,searchId:e.searchId||void 0}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null,t.space.startDetailedSearchResult.searchId)})},this.cancelSpaceSearch=function(e,n){n=n||d,c.debug("[ClientApiHandler]: cancelSpaceSearch...");var t={type:L.SpaceActionType.CANCEL_SEARCH,cancelSearch:{searchId:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.addRecentSpaceSearch=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addRecentSpaceSearch...");var t={type:L.SpaceActionType.ADD_RECENT_SEARCH,addRecentSearch:{searchTerm:e}};A(L.ContentType.SPACE,t,function(e,t){f(e,t,n)&&n(null)})},this.createTeam=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: createTeam..."),y(n)){var t={type:L.TeamActionType.CREATE_TEAM,create:{teamName:e.teamName,notificationTimerSeconds:e.notificationTimerSeconds}};A(L.ContentType.TEAM,t,function(e,t){f(e,t,n)&&n(null,t.team.createResult.team)},["request.team.create.teamName"],["response.team.createResult.team.teamName"])}},this.updateTeam=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: updateTeam..."),y(n)){var t={type:L.TeamActionType.UPDATE_TEAM,update:{teamId:e.teamId,teamName:e.teamName||void 0,notificationTimerSeconds:e.notificationTimerSeconds}};A(L.ContentType.TEAM,t,function(e,t){f(e,t,n)&&n(null,t.team.updateResult.team)},["request.team.update.teamName"],["response.team.updateResult.team.teamName"])}},this.deleteTeam=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: deleteTeam..."),y(n)){var t={type:L.TeamActionType.DELETE_TEAM,delete:{teamId:e}};A(L.ContentType.TEAM,t,function(e,t){f(e,t,n)&&n(null)})}},this.inviteMember=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: inviteMember..."),y(n)){var t=e.userIds;if(!t||Array.isArray(t)&&!t.length)return c.warn("[ClientApiHandler]: No userIds were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);Array.isArray(t)||(t=[t]);var i={type:L.TeamActionType.INVITE_MEMBER,inviteMember:{teamId:e.teamId,userId:t}};A(L.ContentType.TEAM,i,function(e,t){f(e,t,n)&&n(null,t.team.inviteMemberResult)},null,["response.team.inviteMemberResult.team.teamName"])}},this.removeMember=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: removeMember..."),y(n)){var t=e.userIds;if(!t||Array.isArray(t)&&!t.length)return c.warn("[ClientApiHandler]: No userIds were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);Array.isArray(t)||(t=[t]);var i={type:L.TeamActionType.REMOVE_MEMBER,removeMember:{teamId:e.teamId,userId:t}};A(L.ContentType.TEAM,i,function(e,t){f(e,t,n)&&n(null,t.team.removeMemberResult)},null,["response.team.removeMemberResult.team.teamName"])}},this.acceptInvitation=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: acceptInvitation..."),y(n)){var t={type:L.TeamActionType.ACCEPT_INVITATION,acceptInvitation:{teamId:e}};A(L.ContentType.TEAM,t,function(e,t){f(e,t,n)&&n(null,t.team.acceptInvitationResult)},null,["response.team.acceptInvitationResult.team.teamName"])}},this.declineInvitation=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: declineInvitation..."),y(n)){var t={type:L.TeamActionType.DECLINE_INVITATION,declineInvitation:{teamId:e}};A(L.ContentType.TEAM,t,function(e,t){f(e,t,n)&&n(null,t.team.declineInvitationResult)},null,["response.team.declineInvitationResult.team.teamName"])}},this.leaveTeam=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: leaveTeam..."),y(n)){var t={type:L.TeamActionType.LEAVE_TEAM,leaveTeam:{teamId:e}};A(L.ContentType.TEAM,t,function(e,t){f(e,t,n)&&n(null)})}},this.changeMemberRole=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: changeMemberRole..."),y(n)){var t={type:L.TeamActionType.CHANGE_MEMBER_ROLE,changeMemberRole:e};A(L.ContentType.TEAM,t,function(e,t){f(e,t,n)&&n(null,t.team.changeMemberRoleResult)},null,["response.team.changeMemberRoleResult.team.teamName"])}},this.getTeams=function(n){if(n=n||d,c.debug("[ClientApiHandler]: getTeams..."),y(n)){var e={type:L.TeamActionType.GET_TEAMS};A(L.ContentType.TEAM,e,function(e,t){f(e,t,n)&&n(null,t.team.getTeamsResult)},null,["response.team.getTeamsResult.team.[].teamName"])}},this.getTeamsByIds=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: getTeamsByIds..."),y(n)){if(!e||Array.isArray(e)&&!e.length)return c.warn("[ClientApiHandler]: No teamsIds were provided"),void v(n,L.ReturnCode.INVALID_MESSAGE);Array.isArray(e)||(e=[e]);var t={type:L.TeamActionType.GET_TEAMS_BY_IDS,getTeamsByIds:{teamId:e}};A(L.ContentType.TEAM,t,function(e,t){f(e,t,n)&&n(null,t.team.getTeamsByIdsResult)},null,["response.team.getTeamsByIdsResult.team.[].teamName"])}}}return(e.prototype.constructor=e).prototype.name="ClientApiHandler",U.ClientApiHandler=e,U}((Circuit=function(_){"use strict";var e=_.BaseEventTarget,g=_.Enums.ConnectionState,N=_.Constants,m=_.Proto,h=_.Utils;function O(e){var o=_.logger;e=e||{},O.parent.constructor.call(this,o);var i=500,a=this,r={},s={},c=[],t="/api",n=window.location.host,l=null,d=null,u=Object.keys(N.DeviceType),E={deviceType:!0,deviceSubtype:!0,manufacturer:!0,osVersion:!0,clientVersion:!0,hardwareModel:!0,capabilities:!0},C=0,T=e.disablePing||h.isMobile()?-1:3e5,p=null,S=!1,I=new _.ConnectionController(e);function A(){var e={};return l&&(e.accessToken=l),d?Object.assign(e,d):"undefined"!=typeof __clientVersion&&(e.clientVersion=__clientVersion),"wss://"+n+t+(Object.keys(e).length?"?"+h.toQS(e):"")}function R(t){o.debug("[ConnectionHandler]: Raising event",t.name),t.cbList.forEach(function(e){try{e(t.data)}catch(e){o.error("[ConnectionHandler]: Error raising event. ",e)}})}function f(){0<c.length&&(o.debug("[ConnectionHandler]: Raise all delayed events"),c.forEach(function(e){window.clearTimeout(e.timeoutId),R(e)}),c=[])}function v(e){!C&&e.apiVersion&&(C=h.convertVersionToNumber(e.apiVersion));var t=function(e){var t;switch(e.msgType){case N.WSMessageType.RESPONSE:if(!e.response||!e.response.code)return null;var n;if(e.response.user)"GET_STUFF"===e.response.user.type?n=e.response.user.getStuff.user:"GET_LOGGED_ON"===e.response.user.type&&(n=e.response.user.getLoggedOn.user),n&&(n.clientId=e.clientId,n.apiVersion=e.apiVersion);if(s[e.response.requestId])return t=s[e.response.requestId],delete s[e.response.requestId],t.timer&&window.clearTimeout(t.timer),t.keysToOmitFromResponse&&(e.keysToOmitFromLogging=t.keysToOmitFromResponse),{type:"ack",cb:t.cb,data:e.response};o.debug("[ConnectionHandler]: No callback for response with requestId=",e.response.requestId);break;case N.WSMessageType.EVENT:var i=m.ParseEvent(e.event,e.apiVersion);if(i&&i.name){if(r[i.name])return t=r[i.name],o.debug("[ConnectionHandler]: Parsed event: ",i.name),a.ommitKeysFromLog&&t.keysToOmitFromEvent&&(e.keysToOmitFromLogging=t.keysToOmitFromEvent),{type:"evt",cbList:t.cbList,name:i.name,data:i.data,suppressLog:t.suppressLog};o.debug("[ConnectionHandler]: No registered callback for event ",i.name)}else o.error("[ConnectionHandler]: Failed to parse event: ",e.event);break;default:o.error("[ConnectionHandler]: Unexpected message type: ",e.msgType)}return null}(e);if(t)if(t.suppressLog||o.msgRcvd("[ConnectionHandler]: ",e),"evt"===t.type)0<Object.keys(s).length&&/^(?:User|Conversation|Search|Space)\./.test(t.name)?(o.debug("[ConnectionHandler]: Delay event:",t.name),t.timeoutId=window.setTimeout(function(){R(t);var e=c.indexOf(t);-1!==e&&c.splice(e,1)},i),c.push(t)):R(t);else{var n=Object.keys(s).length;o.debug("[ConnectionHandler]: Remaining callbacks pending: ",n),t.cb(null,t.data),0===n&&f()}}I.onStateChange=function(e){if(o.debug("[ConnectionHandler]: WebSocket connection state changed to ",e.newState),o.debug("[ConnectionHandler]: Raising connectionStateChange event"),e.newState===g.Connected)C=0,!p&&0<T&&(p=window.setInterval(function(){a.pingServer()},T));else if(p&&(window.clearInterval(p),p=null),Object.keys(s).length){var n=s;s={},window.setTimeout(function(){Object.keys(n).forEach(function(e){var t=n[e];t.timer&&window.clearTimeout(t.timer),t.cb(N.ReturnCode.DISCONNECTED)}),f()},0)}var t=a.createEvent("connectionStateChange");t.newState=e.newState,t.oldState=e.oldState,a.dispatch(t)},I.onReconnectFailed=function(){o.debug("[ConnectionHandler]: WebSocket failed to reconnect. Raising reconnectFailed event");var e=a.createEvent("reconnectFailed");a.dispatch(e)},I.onMessage=v,this.ommitKeysFromLog=!0,this.onMessage=v,this.setRelativeUrl=function(e){t=e,o.debug("[ConnectionHandler]: Set relative URL to ",t)},this.setTarget=function(e){n=e||window.location.host,o.debug("[ConnectionHandler]: Set target to ",n)},this.setClientInfo=function(t){if(t){if(!t.deviceSubtype||-1===u.indexOf(t.deviceType))return void o.warn("[ConnectionHandler]: Attempted to set invalid clientInfo: ",t);d={},Object.keys(t).forEach(function(e){E[e]&&(d[e]=t[e])}),o.debug("[ConnectionHandler]: Set clientInfo to ",d)}else o.debug("[ConnectionHandler]: Clear clientInfo"),d=null},this.setToken=function(e){l=e},this.getUrl=A,this.getState=function(){return I.getState()},this.connect=function(e,t){o.debug("[ConnectionHandler]: Connect WebSocket to Access Server"),I.connect(A(),e,t)},this.disconnect=function(){o.debug("[ConnectionHandler]: Disconnect WebSocket from Access Server"),I.disconnect()},this.reconnect=function(e){o.debug("[ConnectionHandler]: Reconnect WebSocket to Access Server."),I.reconnect(A(),e)},this.sendMessage=function(e,t,n,i){return e&&e.request&&e.request.requestId?(o.debug("[ConnectionHandler]: Sending "+e.request.type+" request"),I.sendMessage(e)?(t&&function(e,n,t,i){if(n){var r=window.setTimeout(function(e){if(o.error("[ConnectionHandler]: Timeout waiting for response. RequestId:",e),s[e]){delete s[e],n(N.ReturnCode.REQUEST_TIMEOUT);var t=Object.keys(s).length;o.debug("[ConnectionHandler]: Remaining callbacks pending: ",t),0===t&&f(),a.pingServer()}},i,e);Array.isArray(t)||(t=null),s[e]={cb:n,timer:r,keysToOmitFromResponse:t}}}(e.request.requestId,t,n,i||6e4),!0):(o.error("[ConnectionHandler]: Failed to send message"),t&&window.setTimeout(function(){t(N.ReturnCode.FAILED_TO_SEND)},0),!1)):(o.error("[ConnectionHandler]: Cannot send message. Invalid message: ",e),t&&window.setTimeout(function(){t(N.ReturnCode.INVALID_MESSAGE)},0),!1)},this.pingServer=function(){if(I.isConnected()&&!S){var e,t="PING";if(h.isMobile()||(t+="|"+(e=++m.requestNr)),I.sendMessage(t),e){S=!0;var n=window.setTimeout(function(){S=!1,o.error("[ConnectionHandler]: Timed out waiting for ping response. RequestId:",e),delete s[e],I.reconnect(A())},1e4);s[e]={cb:function(){S=!1},timer:n}}}},this.setPingInterval=function(e){"number"==typeof e&&(e=e<0?-1:Math.max(Math.floor(e),3e4),T!==e&&(T=e,p&&(window.clearInterval(p),p=null),T<0?o.info("[ConnectionHandler]: Disable ping"):(o.info("[ConnectionHandler]: Set ping interval time to ",T),I.isConnected()&&(o.info("[ConnectionHandler]: Restart ping interval"),p=window.setInterval(function(){a.pingServer()},T)))))},this.on=function(e,t,n){if(e&&t){var i=r[e]||{cbList:[]};i.cbList.push(t),n&&(Array.isArray(n)?i.keysToOmitFromEvent=n:"*"===n&&(i.suppressLog=!0)),r[e]=i}},this.unsubscribeAll=function(){r={},s={},c=[],a.removeAllListeners()},this.injectHasActiveCall=I.injectHasActiveCall.bind(I)}return h.inherit(O,e),O.prototype.name="ConnectionHandler",_.ConnectionHandler=O,_}((Circuit=function(e){"use strict";function t(i){var r={};this.dispatch=function(t){var e=t&&t.type;e?r[e]?r[e].forEach(function(e){try{e(t)}catch(e){i&&i.error(e)}}):i&&i.debug("[BaseEventTarget]: There is no listener for "+e):i&&i.error("[BaseEventTarget]: Attempted to dispatch a bad event")},this.addEventListener=function(e,t){e&&"function"==typeof t?(r[e]||(r[e]=[]),0<=r[e].indexOf(t)?i&&i.warning("[BaseEventTarget]: Attempted to add duplicate event listener"):(r[e].push(t),i&&i.debug("[BaseEventTarget]: Added event listener for "+this.name+", type = "+e+", count = "+r[e].length))):i&&i.error("[BaseEventTarget]: addEventListener invoked with invalid arguments")},this.removeEventListener=function(e,t){if(r[e]){var n=r[e].indexOf(t);0<=n&&r[e].splice(n,1),i&&i.debug("[BaseEventTarget]: Removed event listener for "+this.name+", type = "+e+", count = "+r[e].length)}},this.hasEventListener=function(e){return!!r[e]&&0<r[e].length},this.removeAllListeners=function(){r={}}}return(t.prototype.constructor=t).prototype.createEvent=function(e){return{type:e}},t.prototype.dispatchEvent=function(e){var t=this.createEvent(e);this.dispatch(t)},e.BaseEventTarget=t,e}((Circuit=function(e){"use strict";var T,p=e.Utils,u="#f0f0f0",o=312,a=484,S="tHuMbNaIl___";function s(e,t,n,i,r,o,a,s,c){var l=document.createElement("canvas"),d=l.getContext("2d");return l.width=s,l.height=c,d.fillStyle=u,d.fillRect(0,0,l.width,l.height),d.drawImage(e,t,n,i,r,o,a,s,c),l.toDataURL("image/jpeg")}function c(e,t){for(var n=atob(e.split(",")[1]),i=[],r=0;r<n.length;r++)i.push(n.charCodeAt(r));return new Blob([new Uint8Array(i)],{type:t||"image/jpeg"})}function I(i,r){return r=r||{},new T(function(n){var e=new FileReader;e.onload=function(e){var t=new Image;t.onload=function(){var e=c(function(e,t,n){var i,r;return(n=n||o)/(t=t||a)<(r=e.height)/(i=e.width)?e.height>n&&(i=i*n/r,r=n):t<i&&(r=r*t/i,i=t),s(e,0,0,e.width,e.height,0,0,i,r)}(this,r.width,r.height));e.name=(r.prefix||"")+(i.modifiedName||i.name),e.lastModified=Math.round(Date.now()/1e3),n(e)},t.src=e.target.result},e.readAsDataURL(i)})}function t(e){var d=e?e.domain:null,u=1,E={};function C(r,o,a,s,c){function l(){E[r]&&(E[r].xhr=null)}return new T(function(e,t){var n=o.modifiedName||o.name,i=new XMLHttpRequest;i.withCredentials=!0,i.open("POST",a,!0),i.setRequestHeader("Content-Type",o.type),i.setRequestHeader("Content-Disposition",'attachment; filename="'+encodeURIComponent(n)+'"'),c&&(c.convId&&i.setRequestHeader("x-conversation",c.convId),c.rtcSessionId&&i.setRequestHeader("x-rtcsession",c.rtcSessionId),c.token&&i.setRequestHeader("authorization","SecToken "+c.token)),"function"==typeof s&&(i.upload.onprogress=function(e){0<e.total&&s(e.loaded,e.total,n)}),i.onload=function(){l(),200===i.status?e(i.response):t({filename:n,status:i.status,statusText:i.statusText,response:i.response,responseText:i.responseText})},i.onerror=function(){l(),t({filename:n,status:500,statusText:"Connection Failed"})},i.onabort=function(){l(),t({filename:n,status:0,statusText:"abort"})},(E[r].xhr=i).send(o)})}function i(o,e,t){if(t=t||null,!T)throw new Error("Promise support is required to use FileUpload");var a=(d?"https://"+d:"")+"/fileapi",s=u;u++,E[s]={xhr:null,deleteUrls:[]};var n=C(s,o,a,t,e).then(function(e){var t=JSON.parse(e)[0],n=t.fileId||t.id,i=a+"?fileid="+n,r={fileId:n,fileName:o.modifiedName||o.name,mimeType:t.mimeType||o.type,size:o.size,url:i,deleteUrl:i};return delete E[s],T.resolve(r)}).catch(function(e){return delete E[s],T.reject(e)});return n.__uploadId=s,n}this.uploadFiles=function(t,e,o,n,i){if(!T)throw new Error("Promise support is required to use FileUpload");if(10<t.length)return T.reject("Exceeded maximum of 10 files per message");var a=(e=e||d)?"https://"+e:"",s=[],c=u;u++,E[c]={xhr:null,deleteUrls:[]};var r=[];i||t.forEach(function(e){p.isSupportedImage&&p.isSupportedImage(e.type)&&r.push(I(e,{prefix:S}))});var l=T.all(r).then(function(e){return Array.prototype.push.apply(t,e),o=o||null,t.reduce(function(e,r){return e.then(function(){return C(c,r,a+"/fileapi?itemid="+(o||"NULL"),n).then(function(e){var t=JSON.parse(e)[0];o=o||t.id;var n=t.fileid[t.fileid.length-1],i={fileId:n,fileName:r.modifiedName||r.name,itemId:o,mimeType:t.mimeType||r.type,size:r.size,url:a+"/fileapi?fileid="+n+"&itemid="+o,deleteUrl:a+"/fileapi?fileid="+n+"&itemid="+o};return s.push(i),E[c].deleteUrls.push(i.deleteUrl),s})})},T.resolve())}).then(function(e){return delete E[c],T.resolve(e)}).catch(function(e){return delete E[c],T.reject(e)});return l.__uploadId=c,l},this.uploadWhiteboardFile=function(e,t,n){return i(e,{rtcSessionId:t,token:n})},this.uploadCMRLogs=function(e){return i(e)},this.uploadMassImportFile=function(e,t){return i(e,null,t)},this.abort=function(e){if(e&&e.__uploadId&&E[e.__uploadId]){var t=E[e.__uploadId];delete E[e.__uploadId],t.xhr&&t.xhr.abort(),function(e){e&&e.forEach(function(e){var t=new XMLHttpRequest;t.withCredentials=!0,t.open("DELETE",e),t.send()})}(t.deleteUrls)}}}return void 0!==Promise&&(T=Promise),t.COMPRESSED_IMG_PREFIX=S,t.dataURItoBlob=c,t.drawCanvasImage=s,t.overridePromise=function(e){T=e},e.FileUpload=t,e}((Circuit=function(e){"use strict";var t=e.AtcCallInfo,n=e.BaseCall,i=e.Enums.CallState,r=e.Enums.CstaCallState,o=e.logger;function a(e){if(!e||!e.rtcSessionId)throw new Error("Cannot create AtcRemoteCall object without a valid conversation");a.parent.constructor.call(this,e,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return this.atcCallInfo.isHandoverAllowed()&&this.atcCallInfo.cstaState!==r.Ringing},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return this.checkState(i.ActiveRemote)&&this.checkCstaState(r.Active)},enumerable:!0,configurable:!1}}),this.isAtcRemote=!0,this.atcCallInfo=new t,e=null,o.info("[AtcRemoteCall]: Created new ATC remote call with callID = ",this.callId)}return e.Utils.inherit(a,n),a.prototype.isPresent=function(){return!this.checkState([i.Idle,i.Terminated])||!this.checkCstaState([r.Idle,r.Failed,r.TransferFailed,r.Terminated])},e.AtcRemoteCall=a,e}((Circuit=function(Qt){"use strict";var Xt,zt=Qt.Constants,Jt=Qt.IceCandidate,$t=Qt.logger,Zt=Qt.ScreenSharingController,en=Qt.sdpParser,tn=Qt.Utils,e=Qt.Enums.VideoCodecs,t=Qt.Enums.VideoResolutionLevel;void 0!==window.Promise&&(Xt=window.Promise);var nn=Object.freeze({None:"None",AnswerPending:"Answer-Pending",AnswerSent:"Answer-Sent",AnswerApplied:"Answer-Applied",OfferPending:"Offer-Pending",OfferSent:"Offer-Sent",OfferReceived:"Offer-Received",Connected:"Connected",PrAnswerReceived:"PrAnswer-Received",AnswerReceived:"Answer-Received",Disconnected:"Disconnected"}),rn=2e3,on=200,an="ConstraintNotSatisfiedError",sn="OverconstrainedError",cn="TrackStartError",ln="NotReadableError",dn=["PermissionDeniedError","SecurityError","NotAllowedError"],un=5e3,En=1e3,Cn=e.VP8,i=Object.freeze({BALANCED:"balanced",MAINTAIN_RESOLUTION:"maintain-resolution",MAINTAIN_FRAMERATE:"maintain-framerate"}),r=Object.freeze({audio:{maxplaybackrate:24e3,"sprop-maxcapturerate":24e3,maxaveragebitrate:16e3,usedtx:1},lowVideo:{maxBw:100,maxWidth:320},video:{maxBw:512},hdVideo:{"1080p":{maxBw:2e3},"720p":{maxBw:1500},"480p":{maxBw:512},maxBw:2e3},screenShare:{maxBw:300,minFrameRate:3,maxFrameRate:5},hdScreenShare:{maxBw:2e3,minFrameRate:3,maxFrameRate:7},rcScreenShare:{maxBw:300,minFrameRate:5,maxFrameRate:15},receiveVideo:{maxBwMobile:512,maxBw:2e3},rtcpMuxPolicy:"require",preferredVideoCodec:Cn}),o=Object.freeze({video:{minBitRate:60},hdVideo:{"1080p":{minBitRate:1200,maxBitRate:2e3},"720p":{minBitRate:750,maxBitRate:1500},"480p":{minBitRate:500,maxBitRate:512},startBitRate:500,minBitRate:1e3,maxBitRate:2e3,maxQuantization:56},screenShare:{},hdScreenShare:{minBitRate:1e3,maxBitRate:2e3,maxQuantization:40}}),n=Object.freeze({AUDIO_VIDEO:0,DESKTOP:1}),Tn=Object.values(t),pn=3,Sn=3;function In(e){return!(e={audio:!!(e=e||{}).audio,video:!!e.video,hdVideo:!!e.hdVideo,videoResolution:e.videoResolution||null,desktop:!!e.desktop,hdDesktop:!!e.hdDesktop,screenControl:!!e.screenControl,minFrameRate:e.minFrameRate||null,remoteControlEnabled:!1}).videoResolution||e.hdVideo&&Tn.includes(e.videoResolution)||(e.videoResolution=null),e}function An(){var n={};return{add:function(e,t){n[e]=t},get:function(e){return n[e]},remove:function(e){delete n[e]},getAll:function(){return n},removeAll:function(){n={}}}}function Rn(v){var _=Qt.WebRTCAdapter;v=v||{};var S=12e4,i=15e3,r=1e3,n=3e4,g=0,u=1,N={audio:0,video:1,screen:2},R=tn.isMobile()?2e3:1e4,m=this,o=v.callId||"",h=!!v.isDirectCall,f=!!v.isTelephonyCall,O=!!v.midMappingEnabled,D=tn.isMobile(),s=0,P=[null,null],y=null,c=null,b=null,d=[y,b],a={main:{sdpStatus:nn.None,trickleIceForOffer:!f&&!Rn.disableTrickleIce&&!v.disableTrickleIce,trickleIceForAnswer:!1,candidatesTimer:null,connectedTimer:null,localOrigin:null,sentIceCandidates:[],disabledRemoteOfferMLines:new An,nextPcLocalSdpSetAt:0},screenControl:{trickleIceForOffer:!Rn.disableTrickleIce&&!v.disableTrickleIce,trickleIceForAnswer:!1,sdpStatus:nn.None,candidatesTimer:null,connectedTimer:null,localOrigin:null,sentIceCandidates:[]}},l=null,E=[],C={},I=!1,A=!1,T=!1,p=null,U=null,L=null,M=null,t=null,w=null,G=[],H=null,k={audio:!1,video:!1},V=null,F=!1,B=!1,x=!1,W=!1,Y=!1,K=In(),q=null,j=null,Q=!1,X=null,z=!1,J=!1,$=!1,Z=[],ee=!1,te=!1,ne=null,ie=!!v.isLargeConference,re=!!v.isSessionGuest,oe=!!v.isAtcPullCall,ae=null,se=null,ce=!1,le=null,de=!1,ue=!!v.candidatesCollectionTest,Ee=tn.getBrowserInfo(),Ce={},Te=!1,pe=!1,Se="",Ie=!1,Ae={},Re=!!v.supportsVideoReceiverConfiguration;function fe(e,t){z||P[t?u:g]===e&&($t.warn("[RtcSessionController]: Local "+(t?"Desktop":"Audio/Video")+" Media Stream has ended unexpectedly"),function(e){$t.debug("[RtcSessionController]: send LocalStreamEnded event"),we(m.onLocalStreamEnded,{isDesktop:e})}(t))}function ve(e,t){function n(){Et(e,u),t()}var i=Oe();e.getVideoTracks()[0].applyConstraints(i).then(n).catch(n)}function _e(t,n,i){if((i=i||{}).mediaStream){var e=i.mediaStream;e.oninactive=fe.bind(null,e,!0),ve(e,t)}else i.streamId||i.screenType?me(t,n,i):(i.isScreenControlSupported=K.screenControl,le=Zt.getScreen(function(e){if(e)if(e.streamId)i.streamId=e.streamId;else if(e.mediaStream)return void ve(e.mediaStream,t);me(t,n,i)},n,i))}function ge(e,t,n){$t.debug("[RtcSessionController]: Get User Media for ",K),n=n||{},K.audio||K.video?Ne(function(){K.desktop&&!Rn.disableDesktopPc?P[u]?(n.mediaStream=P[u],_e(e,t,n)):I&&q.desktop&&!T?(Et(U[u],u),e()):(_e(e,t,n),T=!1):(Et(null,u),e())},t):K.desktop?(I&&q.desktop&&!T&&(n.mediaStream=U[u]),_e(e,t,n)):window.setTimeout(e,0)}function Ne(d,u,E){$t.debug("[RtcSessionController]: getUserMediaAudioVideo()");var C=null;try{var T,e=function(){if(E&&P[g])return m.setLocalStream(g,null),null;if(P[g]){var e=P[g];return e.oninactive=fe.bind(null,e,!1),P[g]=null,e}var t=!A||Ee.msie||Ee.firefox&&!K.desktop&&q.desktop;return I&&t&&"android"!==_.browser&&K.audio===q.audio&&K.video===q.video&&K.hdVideo===q.hdVideo&&K.videoResolution===q.videoResolution?U[g]:null}();if(e)return $t.debug("[RtcSessionController]: getUserMediaAudioVideo(): Reusing audio/video stream ID: ",_.getStreamId(e)),Et(e,g),void d();var p={audio:!1,video:!1};_.getMediaSources(function(e,t){var n,i;if($t.debug("[RtcSessionController]: Retrieved media sources"),K.audio){var r={newInputDevice:E&&E.audio};!(n=function(e,t){var n=tn.selectMediaDevice(e,Rn.recordingDevices),i={enableAudioAGC:Rn.enableAudioAGC,sourceId:t.newInputDevice||n&&n.id};if(!pe&&I&&(Ee.firefox||Ee.chrome)&&K.audio===q.audio&&Ce.enableAudioAGC===i.enableAudioAGC&&Ce.sourceId===i.sourceId){var r=U[g],o=r&&r.getAudioTracks()[0];if(o&&"ended"!==o.readyState)return t.oldAudioTrack=o,null}return $t.debug("[RtcSessionController]: Input device selected: ",n),i}(e,r))&&r.oldAudioTrack?($t.debug("[RtcSessionController]: Reusing audio track"),T=r.oldAudioTrack.clone()):p.audio=_.getAudioOptions(n)}var o={},a=[];if(K.video){if(K.hdVideo){var s=K.videoResolution?Tn.indexOf(K.videoResolution):0;a=Tn.slice(s),o.videoResolution=a.shift(),he(o.videoResolution)}o.minFrameRate=K.minFrameRate,i=tn.selectMediaDevice(t,Rn.videoDevices),o.sourceId=i&&i.id,p.video=_.getVideoOptions(o)}if(I&&K.video&&q.video&&(K.hdVideo!==q.hdVideo||K.videoResolution!==q.videoResolution)&&_.stopLocalVideoTrack(U[g]),T&&!p.audio&&!p.video){var c=new _.MediaStream([T]);return c.oninactive=fe.bind(null,c,!1),Et(c,g),void d()}C=window.setTimeout(function(){C=null,$t.warn("[RtcSessionController]: Failed to access local media: device unresponsive"),u("res_MediaInputDevicesUnresponsive")},S);var l=function(){$t.info("[RtcSessionController]: Calling getUserMedia - constraints = ",p),_.getUserMedia(p,function(e,t){if(n&&(Ce=n),$t.info("[RtcSessionController]: User has granted access to local media"),$t.debug("[RtcSessionController]: Local MediaStream: ",_.getStreamId(e)),!C)return $t.info("[RtcSessionController]: GUM time out already fired"),void lt(e);if(window.clearTimeout(C),C=null,ce)return $t.info("[RtcSessionController]: Session already terminated. Stop audio/video MediaStream: ",_.getStreamId(e)),void lt(e);if(K.video&&!e.getVideoTracks().length){if(I&&!q.video)return void u("res_CameraAccessRestricted");K.video=!1,$t.info("[RtcSessionController]: Failed to get access to video stream. Fallback to audio-only."),function(e){"function"==typeof m.onRtcWarning&&window.setTimeout(function(){!function(e){$t.debug("[RtcSessionController]: send Warning event"),we(m.onRtcWarning,{warning:e})}(e)},0)}("res_AddVideoFailed"),$t.info("[RtcSessionController]: New getUserMedia - constraints = ",K)}T&&e.addTrack(T),Et(e,g),e.oninactive=fe.bind(null,e,!1),d(),t&&($t.warn("[RtcSessionController]: Get user media succeeded. But we had an exception: ",t.name||"<unknown>"),we(m.onGetUserMediaException,{info:t}))},function(e){var t,n=e&&e.name||"Unspecified";if(o.videoResolution&&(n===an||n===sn))return $t.warn("[RtcSessionController]: Failed to access local media with HD constraints: ",p.video),o.videoResolution=a.shift(),he(o.videoResolution),p.video=_.getVideoOptions(o),void l();$t.warn("[RtcSessionController]: Failed to access local media: ",n),C&&(window.clearTimeout(C),C=null),t=dn.includes(n)?K.video?"res_AccessToMediaInputDevicesFailedPermissionDenied":"res_AccessToAudioInputDeviceFailedPermissionDenied":n===cn||n===ln?K.video?"res_AccessToMediaInputDevicesFailedInUse":"res_AccessToAudioInputDeviceFailedInUse":K.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed",u(t)})};l(),$t.debug("[RtcSessionController]: Requested access to Local Media")})}catch(e){$t.error("[RtcSessionController]: Exception while handling getUserMedia: ",e),C&&(window.clearTimeout(C),C=null),u(K.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed")}}function me(t,n,i){$t.debug("[RtcSessionController]: getUserMediaDesktop()");try{var e={audio:!1},r=Oe();e.video=_.getDesktopOptions(i.streamId||i.screenType,r),$t.info("[RtcSessionController]: Calling getUserMedia - constraints = ",e),_.getUserMedia(e,function(e){if($t.info("[RtcSessionController]: User has granted access for screen capture. Stream Id:",_.getStreamId(e)),ce)return $t.info("[RtcSessionController]: Session already terminated. Stop desktop MediaStream: ",_.getStreamId(e)),void lt(e);i&&(ee=i.isScreenControlled,te=ee,function(e){$t.debug("[RtcSessionController]: send ScreenSharePointerStatus event"),we(m.onScreenSharePointerStatus,{isSupported:!(!e||!e.isSupported),isEnabled:!(!e||!e.isEnabled)})}(i.pointer),ne=i),e.oninactive=fe.bind(null,e,!0),Et(e,u),t()},function(e){var t=e&&e.name||"Unspecified";$t.warn("[RtcSessionController]: Failed to access local media: ",t),dn.includes(t)?n(zt.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED):n("res_AccessToDesktopFailed")}),$t.debug("[RtcSessionController]: Requested access for screen capture")}catch(e){$t.error("[RtcSessionController]: Exception while handling getUserMedia: ",e),n("res_AccessToDesktopFailed")}}function he(e){e||(K.hdVideo=!1),K.videoResolution=e}function Oe(){var e=K.hdDesktop?"hdScreenShare":"screenShare",t={frameRate:{min:Rn.sdpParameters[e].minFrameRate,max:Rn.sdpParameters[e].maxFrameRate}};return K.remoteControlEnabled&&(t.frameRate.min=Math.max(t.frameRate.min,Rn.sdpParameters.rcScreenShare.minFrameRate),t.frameRate.max=Math.max(t.frameRate.max,Rn.sdpParameters.rcScreenShare.maxFrameRate)),t}function De(e){if(e){if(c)return!0}else if(y)return!0;var t={};f&&(t.rtcpMuxPolicy=Rn.sdpParameters.rtcpMuxPolicy),E.length&&!oe?(t.iceServers=[{urls:E,credential:C.password,username:C.username}],Rn.allowOnlyRelayCandidates&&(t.iceTransportPolicy="relay")):(oe||$t.warn("[RtcSessionController]: No TURN server(s) provided."),t.iceServers=[]);var n=!!oe;oe=!1,Rn.webRTCIPHandlingPolicy&&$t.info("[RtcSessionController]: webRTCIPHandlingPolicy is set to ",Rn.webRTCIPHandlingPolicy),$t.debug("[RtcSessionController]: Creating RtcPeerConnections. config: ",t);var i={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googDscp:!0}]};$t.debug("[RtcSessionController]: Creating peer connections. constraints:",i),h?($t.debug("[RtcSessionController]: Set number of extra video channels for direct calls to 0"),s=0):D?($t.debug("[RtcSessionController]: Set number of extra video channels for mobile clients to 0"),s=0):ie&&re?($t.debug("[RtcSessionController]: Set number of extra video channels for guests in large conference to 0."),s=0):Re||!J&&!$?(s="number"==typeof Rn.maxVideoExtraChannels?(s=Math.max(Rn.maxVideoExtraChannels,0),Math.min(s,pn)):Sn,$t.info("[RtcSessionController]: Set number of extra video channels to ",s)):($t.debug("[RtcSessionController]: Remote video is disabled. Set number of extra video channels to 0."),s=0);var r=s;K.video&&$&&_.unifiedPlanEnabled&&!Re&&($t.debug("[RtcSessionController]: Local video is enabled and we only allow remote screenshare. We need to setup an extra sendonly video channel."),r=1);var o,a={extraVideoChannels:r,createDesktopPc:!Rn.disableDesktopPc&&!h&&(!J||K.desktop||$),onlyRemoteScreenShare:$};$t.debug("[RtcSessionController]: Creating peer connections. options:",a);try{e||(Z=[]),(o=_.unifiedPlanEnabled?new Qt.RtcPeerConnectionsUnified(t,a):new Qt.RtcPeerConnections(t,i,a)).connectionBypassed=n,$t.debug("[RtcSessionController]: Created audio/video peer connections. Connection bypassed: ",n)}catch(e){return $t.error("[RtcSessionController]: Failed to create peer connections.",e),!1}return e?c=o:(d=[y=o,b],l=be([y]),Pe(y,l)),!0}function Pe(e,t){e&&(e.onicecandidate=function(e,t){if(!e||!d.includes(e))return void $e("Received icecandidate event for old PC");var n,i=je(e,"sdpStatus");if(t.candidate){if(!t.candidate.candidate)return void Je("Ignore empty candidate for mid "+t.candidate.sdpMid);var r=new Jt(t.candidate.candidate);if("udp"!==r.transport)return void Je("Ignore non UDP candidate");if(e===y&&"relay"===r.typ&&(e.hasRelayCandidates=!0),Je("New ICE candidate: ",t.candidate),et(e)){if(n=e.localDescription,!et(e,n.type))return;var o={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!function(e,t){var n=Ke(e=e||y);if(!n)return!1;if(Rn.allowAllIceCandidatesScreenShare||t.sdpMid!==y.getScreenShareMediaId()||n.hasRelayRtpCandidate||n.sendAllCandidates)return!0;var i=new Jt(t.candidate);if(i.isTcpTlsRelay())return i.isRtp()&&($t.info("[RtcSessionController]: Found local relay candidate for TURN over TCP/TLS. Remove queued candidates."),n.hasRelayRtpCandidate=!0,delete n.queuedCandidates,n.relayRtpCandidateTimeout&&(window.clearTimeout(n.relayRtpCandidateTimeout),delete n.relayRtpCandidateTimeout)),!0;"udp"===i.transport&&(n.queuedCandidates||(n.queuedCandidates=[],$t.debug("[RtcSessionController]: Start timer to wait for relay candidate for TURN over TCP/TLS."),n.relayRtpCandidateTimeout=window.setTimeout(function(){$t.info("[RtcSessionController]: Timer expired. Stop waiting for relay candidate for TURN over TCP/TLS and send all pending candidates."),delete n.relayRtpCandidateTimeout,n.queuedCandidates&&(Ge(n.queuedCandidates,e),delete n.queuedCandidates),n.sendAllCandidates=!0},un)),n.queuedCandidates.push(t),$t.debug("[RtcSessionController]: Queue candidate in case there is no TURN over TCP/TLS relay candidate"));return!1}(e,o)||(i!==nn.None&&i!==nn.OfferPending&&i!==nn.AnswerPending?function(e,t){var n=Ke(t);if(!n)return;n.pendingCandidates||(n.pendingCandidates=[],$t.debug("[RtcSessionController]: Start timer to collect candidates before send."),n.collectCandidatesTimeout=window.setTimeout(function(){$t.debug("[RtcSessionController]: Timer expired. Send all pending candidates."),delete n.collectCandidatesTimeout,n.pendingCandidates&&(Ge(n.pendingCandidates,t),delete n.pendingCandidates)},on));n.pendingCandidates.push(e)}(o,e):Je("Ignore ICE candidate in state ",i))}}else if(Je("End of candidates. PC: ",Ue(e)),e.endOfCandidates=!0,e!==b&&it()){if(!(n=e.localDescription))return void Ze("End of candidates, but cannot access pc.localDescription");et(e,n.type)&&i!==nn.None&&i!==nn.OfferPending&&i!==nn.AnswerPending?function(e){var t=Ke(e);if(!t)return;var n=[];t.pendingCandidates&&($t.info("[RtcSessionController]: Send all pending candidates."),n=t.pendingCandidates);t.queuedCandidates&&($t.info("[RtcSessionController]: There was no relay candidate for TURN over TCP/TLS. Send all queued candidates."),Array.prototype.push.apply(n,t.queuedCandidates));n.push({candidate:"a=end-of-candidates\r\n"}),ze(e),Ge(n,e)}(e):ke(e,n)}je(e,"candidatesTimer")&&et(e)&&(i===nn.OfferPending||i===nn.AnswerPending)&&(n=e.localDescription,ke(e,n))}.bind(null,e),e.oniceconnectionstatechange=Le.bind(null,e),e.onaddstream=function(e,t){if(Je("Added Remote Stream"),I)return void Je("Renegotiation is in progress. Ignore AddStream event.");Tt([t.stream]),Fe()}.bind(null,e),e.onremovestream=function(e,t){$e("Removed Remote Stream"),function(e){if(!e)return;var n=!1,i=O?_.getVideoTrackId(e):_.getVideoStreamTrackId(e);i&&G.some(function(e,t){return e.streamId===i&&(G.splice(t,1),n=!0)});var t=O?_.getAudioTrackId(e):_.getAudioStreamTrackId(e);H&&H.streamId===t&&(n=!(H=null));n&&Ye()}(t.stream),Fe()}.bind(null,e)),t&&(t.onThresholdExceeded=function(e){we(m.onStatsThresholdExceeded,{cleared:e})},t.onNoOutgoingPackets=function(){we(m.onStatsNoOutgoingPackets,{})},t.onNetworkQuality=function(e){we(m.onNetworkQuality,{quality:e})})}function ye(e,t){e&&(e.onicecandidate=null,e.oniceconnectionstatechange=null,e.onaddstream=null,e.onremovestream=null),t&&(t.onThresholdExceeded=null,t.onNoOutgoingPackets=null,t.onNetworkQuality=null)}function be(e){return _.unifiedPlanEnabled&&Qt.CallStatsHandlerUnified?new Qt.CallStatsHandlerUnified(e,h):new Qt.CallStatsHandler(e)}function Ue(e){return e===y?"audio/video":"screen control"}function Le(e){if(e&&d.includes(e)){var t=Ue(e);switch(Je("Connection state change ("+t+"): ",e.iceConnectionState),!E.length||e!==y||e.connectionBypassed||"completed"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||e.hasRelayCandidates||$e("[RtcSessionController]: No relay candidates were collected, please check connectivity to the TURN servers"),je(e,"sdpStatus")){case nn.Connected:switch(e.iceConnectionState){case"connected":case"completed":He(e,t);break;case"disconnected":e.connectionBypassed||function(e,t){if(e.iceDisconnectTimeout)return;e.iceDisconnectTimeout=window.setTimeout(function(){delete e.iceDisconnectTimeout,"disconnected"===e.iceConnectionState&&($t.debug("[RtcSessionController]: send IceDisconnected event pcType:",t),we(m.onIceDisconnected,{pcType:t}))},En)}(e,t);break;case"failed":e.connectionBypassed||(gt(nn.Disconnected,e),Ze("[RtcSessionController]: ICE connection has failed"),e!==b&&vt("res_CallMediaDisconnected"))}break;case nn.AnswerReceived:case nn.PrAnswerReceived:case nn.AnswerApplied:case nn.AnswerSent:switch(e.iceConnectionState){case"connected":case"completed":e.connected=!0,nt(e)&&(Xe(e),gt(nn.Connected,e),He(e,t));break;case"failed":Xe(e),ft(e)}}}else $e("Received iceconnectionstatechange event for old PC")}function Me(e,t){Je("RTCDTMFSender - ontonechange",t.tone?"":": finished"),function(e){$t.debug("[RtcSessionController]: send DTMFToneChanged event"),we(m.onDTMFToneChange,{tone:e})}(t.tone)}function we(e,t){if("function"==typeof e)try{e(t||{})}catch(e){$t.error(e)}}function Ge(e,t){var n=Ke(t);if(n&&e){var i=n.sentIceCandidates,r=!1;if(0<(e=e.filter(function(e){if(e.candidate.startsWith("a=end-of-candidates"))return r=!0;var t=e.candidate,n=i.some(function(e){return e.equals(t)});return n?$e("Ignore duplicate ICE candidate: ",e.candidate):i.push(new Jt(t)),!n})).length){$t.debug("[RtcSessionController]: Send IceCandidate event");var o={origin:function(e){if(!e)return"";var t=je(e,"localOrigin");if(!t){var n=e.localDescription;n&&(t=en.getOrigin(n.sdp),qe(e,"localOrigin",t))}return t}(t),candidates:e,endOfCandidates:r,isAudioVideo:"audio/video"===Ue(t)};we(m.onIceCandidate,o),rt(t)}}}function He(e,t){e.iceDisconnectTimeout&&(window.clearTimeout(e.iceDisconnectTimeout),delete e.iceDisconnectTimeout),$t.debug("[RtcSessionController]: send IceConnected event pcType:",t),we(m.onIceConnected,{pcType:t})}function ke(e,t){if(e){Qe(e);var n=je(e,"sdpStatus");"offer"===t.type?n===nn.OfferPending&&Ve(e,nn.OfferSent):n===nn.AnswerPending&&Ve(e,nn.AnswerSent)}else $e("Cannot send local description for non existing pc.")}function Ve(e,t){if(e){var n;if($t.info("[RtcSessionController]: sendSessionDescription - PC: ",Ue(e)),e===b){var i=b.localDescription;n={type:i.type,parsedSdp:en.parse(i.sdp)}}else{var r=e.localDescription,o=en.parse(r.sdp);if("answer"===r.type){$t.info("[RtcSessionController]: sendSessionDescription - Processing answer SDP");var a=je(y,"disabledRemoteOfferMLines");!y.desktopPeerConnection&&a.get(N.video)&&(o.m.splice(N.video,0,a.get(N.video)),a.remove(N.video))}if(e.desktopPeerConnection){$t.info("[RtcSessionController]: sendSessionDescription - Adjust screenshare m-line");var s=en.findMediaLineIndex(o,e.getScreenShareMediaId());if(0<=s){var c=o.m[s];if(c){c={m:[c]};var l=!h&&!Rn.allowAllIceCandidatesScreenShare;$t.info("[RtcSessionController]: Remove UDP video candidates for screenshare: ",l);var d=et(y,r.type)&&!y.endOfCandidates;en.validateIceCandidates(c,l,d)}}else $t.warn("[RtcSessionController]: Could not find screenshare m-line: no ICE validation was made.")}n={type:r.type,parsedSdp:o}}var u=et(e,n.type),E=n.parsedSdp;E=en.removeAudioLevelAttr(E),E=en.fixTrickleIceOption(E,u),u?it()&&(E=en.addEndOfCandidatesLine(E)):E=en.removeEndOfCandidatesLine(E),y.restoreAudioConnectionMode&&en.setConnectionMode(E,"audio",y.restoreAudioConnectionMode);var C=!D||v.canReceiveHdVideo?"maxBw":"maxBwMobile";(C=Rn.sdpParameters.receiveVideo[C])&&en.setVideoBandwidth(E,C,!0);var T=de||ue;if(0!==en.iceTotalCandidatesCount(E)||T)if(en.validateIceCandidates(E,!1,Ie)||u&&!it()||de){if(u&&!it()){var p=Ke(e);p&&(p.sentIceCandidates=en.getIceCandidates(E))}var S={type:n.type,sdp:en.stringify(E)};if(e===y&&e.desktopPeerConnection&&(S.screen=y.getScreenShareMediaId(),P[g])){var I=function(e){var t,n=P[e];n&&n.getVideoTracks().length&&(t=_.getVideoStreamTrackId(n));return t}(g);$t.info("[RtcSessionController]: Video streamId is ",I);var A=null;O&&I&&(A=_.unifiedPlanEnabled?function(e){var t,n=P[e];if(n){var i=n.getVideoTracks()[0];i&&(t=y&&y.getMediaId(i))}return t}(g):en.getMediaIds(E)[I]),S.video=A||I,qt()&&(S.videoSenderConfiguration=y.getAvailableVideoSenders(Ae))}$t.debug("[RtcSessionController]: send SessionDescription event"),de=!1,we(m.onSessionDescription,{sdp:S}),gt(t,e)}else $t.error("[RtcSessionController]: Failure: SDP contains at least one m line without IceCandidates"),vt();else if(u){var R=Ot();$t.debug("[RtcSessionController]: No ICE candidates collected yet. Waiting "+R+" more milliseconds.");var f=window.setTimeout(function(){qe(e,"candidatesTimer",null),vt("res_RestartBrowser")},R);qe(e,"candidatesTimer",f)}else vt("res_RestartBrowser")}else $e("Cannot send Session Description for non existing pc.")}function Fe(){$t.debug("[RtcSessionController]: send RemoteStreamUpdated event"),we(m.onRemoteStreamUpdated,{})}function Be(e){$t.debug("[RtcSessionController]: send Error event"),we(m.onRtcError,{error:e})}function xe(e){"function"==typeof m.onRtcError&&window.setTimeout(function(){Be(e)},0)}function We(){$t.debug("[RtcSessionController]: send MediaUpdate event"),we(m.onMediaUpdate,{})}function Ye(){$t.debug("[RtcSessionController]: send RemoteStreams event"),we(m.onRemoteStreams,{audio:H,video:G})}function Ke(e){return e?e===y?a.main:e===b?a.screenControl:null:null}function qe(e,t,n){e&&(e===y?a.main[t]=n:a.screenControl[t]=n)}function je(e,t){return e?e===y?a.main[t]:a.screenControl[t]:null}function Qe(e){var t=je(e,"candidatesTimer");t&&(window.clearTimeout(t),qe(e,"candidatesTimer",null))}function Xe(e){var t=je(e,"connectedTimer");t&&(window.clearTimeout(t),qe(e,"connectedTimer",null))}function ze(e){var t=Ke(e);t&&(t.collectCandidatesTimeout&&(window.clearTimeout(t.collectCandidatesTimeout),delete t.collectCandidatesTimeout),t.relayRtpCandidateTimeout&&(window.clearTimeout(t.relayRtpCandidateTimeout),delete t.relayRtpCandidateTimeout),t.sentIceCandidates=[],t.pendingCandidates&&delete t.pendingCandidates,t.queuedCandidates&&delete t.queuedCandidates,t.hasRelayRtpCandidate=!1,t.sendAllCandidates=!1)}function Je(e,t){$t.debug("[RtcSessionController]["+o+"]: "+e,t)}function $e(e,t){$t.warn("[RtcSessionController]["+o+"]: "+e,t)}function Ze(e,t){$t.error("[RtcSessionController]["+o+"]: "+e,t)}function et(e,t){return!!e&&(t?"offer"===t&&je(e,"trickleIceForOffer")||"answer"===t&&je(e,"trickleIceForAnswer"):je(e,"trickleIceForOffer")||je(e,"trickleIceForAnswer"))}function tt(e,t){var n=t&&en.isTrickleIceOption(t);return n&&$t.debug("[RtcSessionController]: SDP "+e+" indicates support for Trickle-ICE."),!!n}function nt(e){return e&&e===b?b.connected:!y||y.connected}function it(){return(!y||y.endOfCandidates)&&(!b||b.endOfCandidates)}function rt(t){if(t=t||y)if(Xe(t),nt(t))gt(nn.Connected,t);else{var e=z?r:i;$t.debug("[RtcSessionController]: Starting ICE CONNECTED timer");var n=window.setTimeout(function(){qe(t,"connectedTimer",null);var e=je(t,"sdpStatus");if("connected"===t.iceConnectionState||"completed"===t.iceConnectionState)return $t.debug("[RtcSessionController]: Missed iceConnectionState=connected event but media is connected"),t.connected=!0,gt(nn.Connected,t),void He(t,Ue(t));e!==nn.AnswerSent&&e!==nn.AnswerReceived&&e!==nn.AnswerApplied||nt(t)||(z?gt(nn.Connected,t):($t.warn("[RtcSessionController]: Timed out waiting for connected state."),ft(t)))},e);qe(t,"connectedTimer",n)}else $e("Terminating waitConnectedState for non existing pc.")}function ot(){c&&($t.debug("[RtcSessionController]: Closing the pre-allocated peer connection"),qe(y,"nextPcLocalSdpSetAt",0),at(c),c=null)}function at(e,t){ye(e,t),e&&(e.iceDisconnectTimeout&&(window.clearTimeout(e.iceDisconnectTimeout),delete e.iceDisconnectTimeout),_.closePc(e))}function st(e){if(!e)return!1;var t=e.getLocalStreams();if(!tn.isEmptyArray(t))return!0;$t.debug("[RtcSessionController]: Add local streams to "+(e===y?"existing":"next")+" peer connection");try{P[g]&&e.addStream(P[g],bt(),Ae),$t.debug("[RtcSessionController]: Added local audio/video stream"),P[u]&&(P[u].isScreen=!0,e.addStream(P[u],bt(),Ae),$t.debug("[RtcSessionController]: Added local screenshare stream"))}catch(e){return $t.error("[RtcSessionController]: Failed to add Local Streams ",e),!1}return!0}function ct(){$t.debug("[RtcSessionController]: Remove local streams from existing PeerConnections");try{[y].forEach(function(n){n&&n.getLocalStreams().forEach(function(e,t){e&&(n.removeStream(e),$t.debug("[RtcSessionController]: Removed PeerConnection Stream  #",t))})})}catch(e){return $t.error("[RtcSessionController]: Failed to remove Local Streams ",e),!1}return!0}function lt(e){e&&(e.oninactive=null,0<e.getVideoTracks().length&&e.getVideoTracks().forEach(function(e){var t=_.getTrackId(e);t&&delete Ae[t]}),_.stopMediaStream(e))}function dt(e){var t=e===U?P:U;e&&e.forEach(function(e){t&&-1!==t.indexOf(e)||lt(e)})}function ut(e){var n=[null,null];e&&e.forEach(function(e,t){e&&0<e.getVideoTracks().length&&(n[t]=e)}),t===n[0]&&w===n[1]||(t=n[0],$t.debug("[RtcSessionController]: Set local video stream to ",_.getStreamId(t)||"<null>"),w=n[1],$t.debug("[RtcSessionController]: Set local desktop stream to ",_.getStreamId(w)||"<null>"),$t.debug("[RtcSessionController]: send LocalVideoStream event"),we(m.onLocalVideoStream,{stream:w||t,videoStream:t,desktopStream:w}),We())}function Et(e,t){if(t===g||t===u){if(P[t]!==e){var n,i,r;if(P[t]&&lt(P[t]),P[t]=e,t===g&&K.video){if(K.hdVideo){if(K.videoResolution){var o=Rn.sdpParameters.hdVideo[K.videoResolution];n=o&&o.maxBw}i="hdVideo",r=zt.VideoQuality.HIGH}else i="video",r=zt.VideoQuality.NORMAL;n||(n=Rn.sdpParameters[i].maxBw)}else t===u&&K.desktop&&(i=K.hdDesktop?"hdScreenShare":"screenShare",n=Rn.sdpParameters[i].maxBw,K.remoteControlEnabled&&(n=Math.max(n,Rn.sdpParameters.rcScreenShare.maxBw)));if(e&&0<e.getVideoTracks().length){var a=e.getVideoTracks()[0];if(a){var s={};if(n&&(s.maxBitrate=1e3*n),t===g&&(r&&(s.quality=r),!K.hdVideo||Rn.isCMR||D||(s.degradationPreference=Rn.degradationPreference),qt()&&e.getVideoTracks().length<2)){var c=a.getSettings().width/Rn.sdpParameters.lowVideo.maxWidth,l=a.clone(),d={quality:zt.VideoQuality.LOW,maxBitrate:1e3*Rn.sdpParameters.lowVideo.maxBw,scaleResolutionDownBy:c,direction:D?"sendonly":"sendrecv"};Ae[_.getTrackId(l)]=d,e.addTrack(l)}Ae[_.getTrackId(a)]=s}}ut(P)}}else $t.error("[RtcSessionController]: setLocalStream invoked with invalid index:",t)}function Ct(e){return!!e&&(_.unifiedPlanEnabled?function(t){var n=!1;return t.getVideoTracks().length?G.some(function(e){return e.streamId===t.mid&&($t.debug("[RtcSessionController]: Updated remote video streamId="+t.mid),e.stream=t,n=!0)})||($t.debug("[RtcSessionController]: New remote video streamId="+t.mid),G.push({streamId:t.mid,stream:t}),n=!0):t.getAudioTracks().length&&((H&&H.streamId)===t.mid?H.stream!==t&&(H.stream=t,n=!0):(H={streamId:t.mid,stream:t},n=!0)),n}(e):function(t){var n=!1;if(0<t.getVideoTracks().length){var i=O?_.getVideoTrackId(t):_.getVideoStreamTrackId(t);$t.debug("[RtcSessionController]: Remote video trackId="+i),G.some(function(e){return e.streamId===i&&(e.stream!==t&&(e.stream=t,n=!0),!0)})||(G.push({streamId:i,stream:t}),n=!0),n&&$t.debug("[RtcSessionController]: Updated Remote Video streams:",G)}if(0<t.getAudioTracks().length){var e=O?_.getAudioTrackId(t):_.getAudioStreamTrackId(t);$t.debug("[RtcSessionController]: Remote audio trackId="+e),H&&H.streamId===e?H.stream!==t&&(H.stream=t,n=!0):(H={streamId:e,stream:t},n=!0),n&&$t.debug("[RtcSessionController]: Updated Remote Audio stream:",H.streamId)}return n}(e))}function Tt(e,t){if(e){e instanceof Array||(e=[e]);var n=!1;t&&(H||G.length)&&(n=!0,H=null,G=[]),e.forEach(function(e){Z.push(e),Ct(e)&&(n=!0)}),n&&Ye()}}function pt(e){var t=!1;return P[g]&&(t=_.toggleAudio(P[g],e)),Y=!t||!e,U&&U[g]&&_.toggleAudio(U[g],e),t}function St(e,t){if(I){var n=a.main.sdpStatus;$t.debug("[RtcSessionController]: There's a renegotiation in progress, fail or succeed it based on current SdpStatus:",n),n===nn.AnswerReceived||n===nn.AnswerApplied||n===nn.AnswerSent?At():Rt("Renegotiation already in progress")}y&&y.iceDisconnectTimeout&&($t.info("[RtcSessionController]: Ignore previous ICE disconnection"),window.clearTimeout(y.iceDisconnectTimeout),delete y.iceDisconnectTimeout),I=!0,A=!!e,p=t||null,M=l,ze(L=y),ye(L,M),c?e&&y.localDescription?($t.debug("[RtcSessionController]: Using pre-allocated peer connection"),Z=[],y=c,c=null,d=[y,b],l=be([y]),Pe(y,l)):(ot(),y=null):y=null,U=P,P=[null,null],q=tn.shallowCopy(K),V=tn.shallowCopy(k),se=ae=null,a.main.sdpStatus=nn.None,a.main.localOrigin=null}function It(e){if(p){try{!e||e===zt.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED||"string"==typeof e&&e.startsWith("res_")||(e="res_ChangeMediaFailed"),p(e)}catch(e){$t.error(e)}p=null}}function At(){$t.info("[RtcSessionController]: The media renegotiation was successful");var e=M,t=L;Kt(e,!(L=M=null),!t.connectionBypassed).catch(function(){$t.warn("[RtcSessionController]: Failed to stop stats for old RTCPeerConnection")}).then(function(){$t.info("[RtcSessionController]: Closing the old RTCPeerConnection"),at(t,e)}),Ee.msie&&(at(t),t=null),$t.info("[RtcSessionController]: Stopping the old MediaStream"),x?B=!0:W&&(B=!1),_.unifiedPlanEnabled||B||F||st(y),dt(U),V=q=U=null,ut(P),Tt(y.getRemoteStreams(),!0),pt(!Y),Te=I=W=x=!1,j=null,We(),It()}function Rt(e){$t.info("[RtcSessionController]: The media renegotiation has failed: ",e),ze(y),at(y,l),a.main.sdpStatus=nn.Connected,l=M,Pe(y=L),M=L=null,dt(P),P=U,U=null,ut(P),K=tn.shallowCopy(q),k=tn.shallowCopy(V),V=q=null,x?B=!1:W&&(B=!0),I=W=x=!1,Te&&(Te=!(h=!0)),We(),It(e||"res_ChangeMediaFailed")}function ft(e){vt(e&&e===b?"res_RemoteControlSessionStopped":"res_CallMediaFailed")}function vt(e,t){e===zt.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?$t.info("[RtcSessionController]: User cancelled the screen share request"):"res_RestartBrowser"===e?$t.error("[RtcSessionController]: Failure: No ICE candidates collected. Browser needs to be restarted"):(e=e||"res_RTCError",$t.warn("[RtcSessionController]: There was an internal failure. Send error event: ",e)),I?Rt(e):t?t(e):Be(e)}function _t(){se?($t.info("[RtcSessionController]: Process the pending changeMedia"),Gt(se.mediaType,se.cb,se.options),se=null):ae&&($t.info("[RtcSessionController]: Process the pending remote description"),m.setRemoteDescription(ae.sdp,ae.cb),ae=null)}function gt(e,t){if(t=t||y){var n=je(t,"sdpStatus");if(n!==nn.PrAnswerReceived||e!==nn.Connected){if(n!==e){if($t.debug("[RtcSessionController]: Changed SDP status from "+n+" to "+e),qe(t,"sdpStatus",e),t===y)switch(e){case nn.AnswerApplied:_t();break;case nn.Connected:t.setMaxBitrate(Ae),I&&At(),$t.debug("[RtcSessionController]: send SdpConnected event"),we(m.onSdpConnected,{}),_t(),l.start();break;case nn.AnswerSent:rt(t)}Le(t)}}else $t.debug("[RtcSessionController]: Cannot change SDP status to "+e+" without final SDP answer.")}else $e("Could not set SDP status for non existing pc.")}function Nt(e,t){if(!e)return $e("Cannot update local description for non existing pc."),null;$t.debug("[RtcSessionController]: updateLocalDescription with mediaConstraints=",K);var n=!1,i=en.parse(t.sdp);if(Ie?$t.debug("[RtcSessionController]: Media multiplex enabled!"):en.disableMultiplex(i),f&&(en.removeAudioMediaProtocols(i,["UDP","TLS"]),e.connectionBypassed&&D&&(e.restoreAudioConnectionMode=en.getConnectionMode(i,{mediaType:"audio"}),en.setConnectionMode(i,"audio","inactive")),"offer"===t.type)){var r=i.m[0];r&&"audio"===r.media&&r.a.some(function(e){return"mid"===e.field&&(Se=e.value,!0)})}if(B?_.unifiedPlanEnabled||(en.setConnectionMode(i,"both","inactive"),$t.info("[RtcSessionController]: updateLocalDescription with Connection Mode Inactive")):K.video||K.desktop?n=en.hasVideo(i):"answer"===t.type&&(n=en.hasVideo(i))&&J&&(en.removeVideo(i),n=!1),n){if(K.video){var o=mt(K.hdVideo?"hdVideo":"video",K.videoResolution);en.setXGoogle(i,o),l.setTransmitVideoParams({mediaConstraints:K,trackConstraints:Ae,bitRates:o})}K.desktop&&en.setXGoogle(i,mt(K.hdDesktop?"hdScreenShare":"screenShare"),i.m.length-1)}en.setOpusParameters(i,Rn.sdpParameters.audio),Rn.sdpParameters.preferredVideoCodec!==Cn&&"offer"===t.type&&en.setPreferredVideoCodec(i,Rn.sdpParameters.preferredVideoCodec),"answer"!==t.type&&(k={audio:!0,video:n});var a=new _.SessionDescription({type:t.type,sdp:en.stringify(i)});return $t.debug("[RtcSessionController]: Finished modifying local SDP"),a}function mt(e,t){var n=tn.shallowCopy(Rn.xGoogle[e]);if(n&&"hdVideo"===e&&t){var i=Rn.xGoogle.hdVideo[t];i&&Object.assign(n,i)}return n}function ht(e,t,n,i){if(!e)return $e("Cannot update remote description for non existing pc."),null;if($t.debug("[RtcSessionController]: updateRemoteDescription with mediaConstraints=",K),"offer"===n&&e===y){var r=je(e,"disabledRemoteOfferMLines");if(r.removeAll(),h&&!e.desktopPeerConnection&&i){var o=t.m[N.video];o.port=0,en.setConnectionMode({m:[o]},"video","inactive"),r.add(N.video,o),t.m[N.video]=i.sdp,$t.debug("[RtcSessionController]: Disabled and replaced video m-line with screenshare m-line")}}var a=!1,s=en.hasVideo(t);if(s){var c,l,d=en.getVideoConnectionModes(t);if($t.info("[RtcSessionController]: Remote description has video modes set to ",d),s=!(a=d.every(function(e){return"recvonly"===e})),K.desktop&&!e.desktopPeerConnection)l=K.hdDesktop?"hdScreenShare":"screenShare";else if(K.hdVideo){if(K.videoResolution){var u=Rn.sdpParameters.hdVideo[K.videoResolution];c=u&&u.maxBw}l="hdVideo"}else l="video";var E=_.unifiedPlanEnabled&&(Ee.chrome||D);E?c=R:c||(c=Rn.sdpParameters[l].maxBw),t=en.setVideoBandwidth(t,c,!0);var C,T,p=mt(l,K.videoResolution);if(y.desktopPeerConnection){var S=K.hdDesktop?"hdScreenShare":"screenShare";c=E?R:Rn.sdpParameters[S].maxBw,T=Rn.xGoogle[S],C=i&&i.index,t=en.setVideoBandwidth(t,c,!0,C),_.unifiedPlanEnabled&&(T.minBitRate||0)>(p.minBitRate||0)&&(p=T,$t.debug("[RtcSessionController]: Using X-Google parameters from screenshare: ",p))}en.setXGoogle(t,p),C&&T&&!_.unifiedPlanEnabled&&en.setXGoogle(t,T,C)}if(en.setOpusParameters(t,Rn.sdpParameters.audio),F!==(F=!!en.isHold(t)&&("offer"===n||!B&&K.audio))&&(F?$t.info("[RtcSessionController]: The client has been held"):$t.info("[RtcSessionController]: The client has been retrieved")),f){var I=t.m[0];if(I&&"audio"===I.media)I.a.some(function(e){return"mid"===e.field})||(Se=Se||"audio",$t.debug("[RtcSessionController]: Adding a=mid:"+Se+" to SBC's answer SDP"),I.a.push({field:"mid",value:Se}))}var A=je(e,"sdpStatus");return"offer"!==n||A!==nn.Connected||B||F||(G.length&&!s?($t.debug("[RtcSessionController]: send RemoteVideoRemoved event"),we(m.onRemoteVideoRemoved,{})):!G.length&&s&&($t.debug("[RtcSessionController]: send RemoteVideoAdded event"),we(m.onRemoteVideoAdded,{}))),B||"answer"===n&&a||(k={audio:!0,video:s}),Ie=h&&"offer"===n&&en.isMultiplexEnabled(t),t}function Ot(){var e=Rn.candidatesTimeout||rn;return 0<s&&(e+=e*(_.iceTimeoutSafetyFactor||0)),$t.debug("[RtcSessionController]: getCandidatesTimeout:",e),e}function Dt(e,t){if(e){var n,i,r,o,a=Ue(e);if($t.debug("[RtcSessionController]: Local SDP set for the "+a+" connection."),o="offer"===t?(i=je(e,"trickleIceForOffer"),r=nn.OfferPending,nn.OfferSent):(i=je(e,"trickleIceForAnswer"),r=nn.AnswerPending,nn.AnswerSent),gt(r,e),i)0<(n=function(){var e=Rn.trickleIceTimeout||on;return $t.debug("[RtcSessionController]: getTrickleIceTimeout:",e),e}())?($t.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending the "+a+" SDP Offer ("+n+"ms)."),window.setTimeout(function(){je(e,"sdpStatus")===r&&($t.debug("[RtcSessionController]: Trickle ICE timer expired. Send the "+a+" SDP Offer."),Ve(e,o))},n)):($t.debug("[RtcSessionController]: Trickle ICE is enabled. Send the "+a+" SDP Offer."),Ve(e,o));else{n=Ot();var s=je(y,"nextPcLocalSdpSetAt");if(s){var c=Date.now()-s;c<n?n-=c:n=0,qe(y,"nextPcLocalSdpSetAt",0)}$t.debug("[RtcSessionController]: Waiting for "+a+" ICE candidates ("+n+"ms).");var l=window.setTimeout(function(){$t.debug("[RtcSessionController]: Timed out waiting for "+a+" candidates."),qe(e,"candidatesTimer",null),d.includes(e)?je(e,"sdpStatus")===r&&($t.debug("[RtcSessionController]: Send the "+a+" session description."),Ve(e,o)):$t.warn("[RtcSessionController]: RTCPeerConnection instance for "+a+" connection no longer exists.")},n);qe(e,"candidatesTimer",l)}}else $e("Terminating localSdpSetAndSend for non existing pc.")}function Pt(i,r){$t.debug("[RtcSessionController]: Successfully created local audio/video description:",i),r&&$t.debug("[RtcSessionController]: Successfully created local screenshare description:",r),!_.unifiedPlanEnabled&&I&&ct(),Qe(y);function t(e,t){if(t?($t.error("[RtcSessionController]: Failed to apply Local "+e+" description:",t.message||t),vt()):$t.debug("[RtcSessionController]: Local description was successfully applied. PC=",e),y&&de)return Ve(y,nn.Connected),void(y&&(y.connectionBypassed=!0,ye(y,l)));I||We();var n=i&&i.type||r&&r.type;Dt(y,n)}try{if(y&&i){var e=t.bind(null,"audio/video");i=Nt(y,i),y.setLocalDescription(i,e,e),y.startTime=Date.now()}}catch(e){t("unknown",e||"error")}}function yt(){x||B&&!W?(y.oniceconnectionstatechange=null,$t.debug("[RtcSessionController]: Call is already held or is being put on hold. Stop monitoring iceConnectionState changes"),gt(nn.Connected,y)):je(y,"sdpStatus")===nn.AnswerReceived&&gt(nn.AnswerApplied,y)}function bt(){return!J&&!f}function Ut(e,t,n){if(e)switch(t){case"offer":var i=!Rn.disableTrickleIce&&tt(t,n);qe(e,"trickleIceForAnswer",i),i?$t.info("[RtcSessionController]: Enabled Trickle-ICE for answer."):$t.info("[RtcSessionController]: Disabled Trickle-ICE for answer.");break;case"pranswer":case"answer":gt("pranswer"===t?nn.PrAnswerReceived:nn.AnswerReceived,e),je(e,"trickleIceForOffer")&&(tt(t,n)||(qe(e,"trickleIceForOffer",!1),$t.warn("[RtcSessionController]: Disabled Trickle-ICE for offer.")))}else $e("Terminating updateTrickleIceAndStatus for non existing pc.")}function Lt(i){$t.debug("[RtcSessionController]: setRemoteDescription()");try{if(!De())return void vt();var e,t,r=y.getLocalStreams(),n=en.parse(i.sdp);if(i.screen){var o=en.findMediaLineIndex(n,i.screen);-1!==o&&(e={sdp:n.m[o],index:o,mid:i.screen},t=en.getSsrcList(e.sdp))}Ut(y,i.type,n);if(y){n=ht(y,n,i.type,e);var a=new _.SessionDescription({type:i.type,sdp:en.stringify(n)});a.screen=e&&e.sdp,$t.debug("[RtcSessionController]: Modified remote audio/video SDP:",a);var s=function(e,t){switch(t?($t.error("[RtcSessionController]: Failed to apply Remote "+e+" description:",t.message||t),vt()):$t.debug("[RtcSessionController]: Remote description was successfully applied. PC=",e),$t.debug("[RtcSessionController]: Remote Descriptions were successfully applied."),I||We(),i.type){case"offer":B||F?0<r.length?(ct(),$t.debug("[RtcSessionController]: Removed Local Stream (hold)")):$t.debug("[RtcSessionController]: Local Stream has not been set (hold)"):st(y),$t.debug("[RtcSessionController]: Creating Local Description Answer...");var n={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:bt()}};y.createAnswer(function(e){Pt(e)},function(e){e=e||"Unspecified",$t.error("[RtcSessionController]: Failed to create Local Description: ",e.message||e),vt()},n,{audioInactive:B});break;case"pranswer":$t.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),yt(),rt(y);break;case"answer":yt(),rt(y);break;default:$t.error("[RtcSessionController]: Invalid SDP Type = ",i.type),vt()}}.bind(null,"audio/video");y.setRemoteDescription(a,s,s),y.desktopRemoteSsrc=t,y.remoteOrigin=en.getOrigin(n).trim(),y.startTime=Date.now()}}catch(e){$t.error(e),vt()}}function Mt(){qe(y,"nextPcLocalSdpSetAt",0),at(y),y=null}function wt(){if($t.debug("[RtcSessionController]: renegotiateMedia()"),De()){B?$t.debug("[RtcSessionController]: Local Stream has not been set (holding)"):st(y),$t.debug("[RtcSessionController]: Creating Local Descriptions...");var e={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:bt()}};try{Ie=!1;var t=y.localDescription;if(t)if(B){if(_.unifiedPlanEnabled)return Mt(),void wt();t=Nt(y,t),y.setLocalDescription(t,function(){qe(y,"nextPcLocalSdpSetAt",Date.now()),$t.debug("[RtcSessionController]:[Pre-allocated PC]: Call on hold. Local description was successfully re-applied"),Dt(y,t.type)},function(e){$t.warn("[RtcSessionController]:[Pre-allocated PC]: Call on hold. Error re-setting local description. Creating new peer connection: ",e),Mt(),wt()})}else Dt(y,t.type);else y.createOffer(function(e){Pt(e)},function(e){e=e||"Unspecified",$t.error("[RtcSessionController]: Failed to create audio/video Local Description: ",e.message||e),vt()},e,{audioInactive:B})}catch(e){$t.error(e),vt()}}else vt()}function Gt(e,t,n){if(y&&je(y,"sdpStatus")===nn.AnswerReceived)return $t.warn("[RtcSessionController]: Still processing the previous answer remote description. Queue the changeMedia"),void(se={mediaType:e,cb:t,options:n});if(Ft()){T=!!(n=n||{}).changeDesktopMedia,n.isDirectUpgradingToConf&&(Te=!(h=!1));var i=tn.shallowCopy(K);"boolean"==typeof e.audio&&(i.audio=e.audio),"boolean"==typeof e.video&&(i.video=e.video),"boolean"==typeof e.hdVideo&&(i.hdVideo=e.hdVideo),e.videoResolution&&(i.videoResolution=e.videoResolution),"boolean"==typeof e.desktop&&(i.desktop=e.desktop),"boolean"==typeof e.hdDesktop&&(i.hdDesktop=e.hdDesktop),"boolean"==typeof e.screenControl&&(i.screenControl=e.screenControl),e.minFrameRate&&(i.minFrameRate=e.minFrameRate),i=In(i),!c||!pe&&function(t,n){return!(!t||!n)&&Object.keys(t).every(function(e){return t[e]===n[e]})}(K,i)||($t.info("[RtcSessionController]: Media constraints are changing. Discard pre-allocated connection."),ot()),St(!0,t),K=i,y?(P=U,wt()):(n.videoOptions&&n.videoOptions.mediaStream&&function(e,t){if(U[g]){if(t.audio)if(!e.getAudioTracks().length){var n=U[g].getAudioTracks()[0];n&&e.addTrack(n.clone())}m.setLocalStream(g,e)}}(n.videoOptions.mediaStream,i),ge(wt,vt,n.screenShareOptions))}else Bt(t,"Connection not stable")}function Ht(){L&&($t.debug("[RtcSessionController]: Closing the old audio/video RTCPeerConnection"),at(L,M),L=null),y&&($t.debug("[RtcSessionController]: Closing the RTCPeerConnection"),at(y,l),y=null),b&&($t.debug("[RtcSessionController]: Closing the screen control peer connection"),at(b),b=null),ot()}function e(){$t.debug("[RtcSessionController]: Closing the RTC session controller"),k={audio:!1,video:!1},le&&Zt.unregEvtHandlers(le),d.forEach(function(e){gt(nn.None,e),Qe(e),Xe(e),ze(e)});var e=M||l;if(e){var t=L||y;Kt(e,!1,!!t&&!t.connectionBypassed).catch(function(){$t.warn("[RtcSessionController]: Failed to stop stats collection")}).then(function(){$t.info("[RtcSessionController]: Closing all RTCPeerConnection instances"),Ht()})}else Ht();U&&($t.debug("[RtcSessionController]: Stopping the old MediaStream"),dt(U),U=null),a.main.localOrigin=null,a.screenControl.localOrigin=null,te=ee=Y=F=B=W=x=I=!1,Et(ne=j=null,g),Et(null,u),(H||G.length)&&(H=null,G=[],Ye()),$t.debug("[RtcSessionController]: send Closed event"),we(m.onClosed,{}),ce=!0,function(t){t=t||[],jt.forEach(function(e){t.includes(e)||(m[e]=null)})}(["onQosAvailable"])}function kt(){if(!y)return $t.error("[RtcSessionController]: PeerConnection not setup"),!1;if(j)return $t.debug("[RtcSessionController]: DTMF Sender already enabled"),!0;var e=y.getLocalStreams();if(!(0<e.length))return $t.error("[RtcSessionController]: No Local Stream to create DTMF Sender"),!1;var t=e[g].getAudioTracks();return 0<t.length?!!(j=y.createDTMFSender(t[0]))&&(j.ontonechange=Me.bind(null,y),$t.info("[RtcSessionController]: Created DTMF Sender using remote audio track: "+t[0].label),!0):($t.error("[RtcSessionController]: No Audio Track to create DTMF Sender"),!1)}function Vt(e){if($t.debug("[RtcSessionController]: startConn()"),e)Lt(e);else{st(y),$t.debug("[RtcSessionController]: Creating Local Description...");var t={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:bt()}};Ie=!1,y.createOffer(function(e){Pt(e)},function(e){e=e||"Unspecified",$t.error("[RtcSessionController]: Failed to create Local Description: ",e.message||e),vt()},t,{audioInactive:B})}}function Ft(e){if(!(e=e||y))return $t.debug("[RtcSessionController]: isConnStable: There is no connection"),!1;var t=je(e,"sdpStatus");return t===nn.AnswerReceived||t===nn.AnswerApplied?($t.debug("[RtcSessionController]: isConnStable: Processing remote answer SDP, the connection is considered stable"),!0):t===nn.AnswerSent?($t.debug("[RtcSessionController]: isConnStable: Answer SDP sent, the connection is considered stable"),!0):I?($t.warn("[RtcSessionController]: isConnStable: There is a pending media renegotiation"),!1):!("stable"!==e.signalingState&&!e.connectionBypassed&&($t.warn("[RtcSessionController]: isConnStable: The connection is not established. signalingState =",e.signalingState),!z))}function Bt(e,t){"function"==typeof e&&window.setTimeout(function(){e(t)},0)}function xt(){b&&($t.debug("[RtcSessionController]: Closing the old screen control peer connection"),at(b),b=null,a.screenControl.localOrigin=null);var e={};E.length&&(e.iceServers=[{urls:E,credential:C.password,username:C.username}]),$t.debug("[RtcSessionController]: Creating RtcPeerConnection for the screen control session. config: ",e);var t={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googDscp:!0}]};$t.debug("[RtcSessionController]: Creating peer connection for the screen control session. constraints:",t);var n={offerToReceiveAudio:0,offerToReceiveVideo:0,isScreenControlled:ee,isScreenOwner:te,screenControlChannelName:"SCREEN_CONTROL"};$t.debug("[RtcSessionController]: Creating peer connection for the screen control session. options:",n);try{b=new _.PeerConnection(e,t,n),d=[y,b],a.screenControl.sdpStatus=nn.None,$t.debug("[RtcSessionController]: Created a peer connection for the screen control session.")}catch(e){return b=null,$t.error("[RtcSessionController]: Failed to create a peer connection for the screen control session.",e),!1}return Pe(b),!0}function Wt(i,t){$t.debug("[RtcSessionController]: Successfully created local screen control description: ",i);try{if(b&&i){var e=function(e,t){if(t)$t.error("[RtcSessionController]: Failed to apply Local "+e+" description: ",t.message||t);else{$t.debug("[RtcSessionController]: Local description for the screen control session was successfully applied. PC=",e);var n=i&&i.type;Dt(b,n)}}.bind(null,"screen control");b.setLocalDescription(i,e,e),b.startTime=Date.now()}}catch(e){t&&t(e)}}function Yt(n,i){var e=en.parse(n.sdp);Ut(b,n.type,e);if(b){var t=function(e,t){switch(t?$t.error("[RtcSessionController]: Failed to apply Remote "+e+" description:",t.message||t):$t.debug("[RtcSessionController]: Remote description was successfully applied. PC=",e),n.type){case"offer":$t.debug("[RtcSessionController]: Creating Local Description Answer...");b.createAnswer(function(e){Wt(e,i)},function(e){e=e||"Unspecified",$t.error("[RtcSessionController]: Failed to create a Local Description for the screen control peer connection: ",e.message||e)},{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},{audioInactive:B});break;case"pranswer":$t.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),a.screenControl.sdpStatus===nn.AnswerReceived&&gt(nn.AnswerApplied,b),rt(b);break;case"answer":$t.debug("[RtcSessionController]: Received answer, applying media SDP"),a.screenControl.sdpStatus===nn.AnswerReceived&&gt(nn.AnswerApplied,b),rt(b);break;default:$t.error("[RtcSessionController]: Invalid SDP Type = ",n.type)}}.bind(null,"screen control");b.setRemoteDescription(n,t,t),b.remoteOrigin=en.getOrigin(e).trim(),b.startTime=Date.now()}}function Kt(t,n,i){if(t){var r=function(e){var t=L||y,n=je(t,"sdpStatus");return e||!!t&&(n===nn.AnswerReceived||n===nn.PrAnswerReceived||n===nn.AnswerApplied||n===nn.AnswerSent||n===nn.Connected||n===nn.None)}(n);return t.stop().then(function(e){i&&r&&e&&function(e,t,n,i){$t.debug("[RtcSessionController]: send QosAvailable event"),we(m.onQosAvailable,{qos:e,renegotiationInProgress:t,lastSavedStats:n,streamQualityData:i})}(e,n,t.getLastSavedStats(),t.getStreamQualityData()),n||(m.onQosAvailable=null)})}return n||(m.onQosAvailable=null),Xt.resolve()}function qt(){return!h&&!ie&&Rn.addAdditionalLowVideoStream&&_.unifiedPlanEnabled}var jt=["onIceCandidate","onSessionDescription","onSdpConnected","onIceConnected","onIceDisconnected","onRemoteVideoAdded","onRemoteVideoRemoved","onRemoteStreamUpdated","onDTMFToneChange","onClosed","onRtcError","onRtcWarning","onLocalStreamEnded","onScreenSharePointerStatus","onMediaUpdate","onLocalVideoStream","onRemoteStreams","onGetUserMediaException","onQosAvailable","onStatsNoOutgoingPackets","onStatsThresholdExceeded","onNetworkQuality"];jt.forEach(function(e){m[e]=null}),Object.defineProperty(this,"dontReuseAudioStream",{get:function(){return pe},set:function(e){$t.debug("[RtcSessionController]: Setting dontReuseAudioStream to:",!!e),pe=!!e},enumerable:!0,configurable:!1}),this.setTurnCredentials=function(e){C=e||{}},this.setTurnUris=function(e){e&&e.length&&(E=Rn.customTurnServers.length?($t.debug("[RtcSessionController]: Adding custom TURN servers to this session:",Rn.customTurnServers),Rn.customTurnServers.concat(e)):e,Ee.firefox&&(E=E.filter(function(e){return!/turns:\d{1,3}(\.\d{1,3}){3}/.test(e)})))},this.getLocalVideoStream=function(){return w||t},this.getLocalDesktopStream=function(){return w},this.getRemoteAudioStream=function(){return H},this.getRemoteVideoStreams=function(){return G},this.getSdpStatus=function(){return a.main.sdpStatus},this.getWarmedUpSdp=function(){return X},this.isHolding=function(){return B&&!x||W},this.isHoldInProgress=function(){return x},this.isRetrieveInProgress=function(){return W},this.isHeld=function(){return F},this.getActiveMediaType=function(){return tn.shallowCopy(k)},this.getMediaConstraints=function(){return tn.shallowCopy(K)},this.getLocalMediaType=function(){return{audio:K.audio&&k.audio,video:K.video&&k.video,desktop:K.desktop&&k.video}},this.hasScreenShare=function(){return!!w},this.isScreenControlled=function(){return!!ee},this.warmup=function(e,t,n,i,r){return n=n||function(){},i=i||function(){},ce?($t.error("[RtcSessionController]: Warmup Connection failed: Session already terminated"),void Bt(i,"res_UnexpectedError")):(en.isNoOfferSdp(t)&&(t=null),e=In(e),$t.info("[RtcSessionController]: Warming up the connection - mediaType = ",e),_.enabled?y&&a.main.sdpStatus!==nn.None?($t.error("[RtcSessionController]: The connection has already been started"),void Bt(i,"res_UnexpectedError")):((K=e).audio||(Y=!0),void ge(function(){t&&(X=t),Q=!0,De(),n()},function(e){vt(e,i)},r)):($t.warn("[RtcSessionController]: WebRTC not supported by browser"),void Bt(i,"res_NoWebRTC")))},this.start=function(e,t){if(ce)return $t.error("[RtcSessionController]: Start Connection failed: Session already terminated"),!1;if(e=In(e),$t.info("[RtcSessionController]: Start Connection - mediaType =",e),!_.enabled)return $t.warn("[RtcSessionController]: WebRTC not supported by browser"),xe("res_NoWebRTC"),!1;if(y&&a.main.sdpStatus!==nn.None)return $t.error("[RtcSessionController]: The connection has already been started"),xe("res_UnexpectedError"),!1;if($t.debug("[RtcSessionController]: Creating Peer Connection..."),Q){if(t=X,X=null,Y=!e.audio,!De())return xe("res_RTCError"),!1;if(e.audio===K.audio&&e.video===K.video&&e.hdVideo===K.hdVideo&&e.desktop===K.desktop)return Vt(t),!0;Et(null,g)}return De()?(K=e,ge(function(){Vt(t)},vt),!0):(xe("res_RTCError"),!1)},this.addIceCandidates=function(t,e){$t.info("[RtcSessionController]: Add remote ICE candidates");var n=t?null:y;n?t!==n.remoteOrigin?n=null:($t.warn("[RtcSessionController]: Ignoring remote ICE candidate - origin does not match."),$t.debug("[RtcSessionController]: ICE candidate origin: ",t),$t.debug("[RtcSessionController]: SDP origin: ",n.remoteOrigin)):d.forEach(function(e){e&&t===e.remoteOrigin&&(n=e)}),n?(e.forEach(function(e){(e=JSON.parse(e)).candidate&&(e.candidate=e.candidate.replace(/(a=)*([^\r]+)(\r\n)*/i,"$2")),$t.debug("[RtcSessionController]: Remote ICE candidate",e),e.candidate&&"end-of-candidates"!==e.candidate?n.addIceCandidate(e):$t.debug("[RtcSessionController]: Ignoring end-of-remote-candidates indication.")}),rt(n)):$t.warn("[RtcSessionController]: Ignoring remote ICE candidate - no valid peer connection found.")},this.setRemoteDescription=function(e,t){if($t.info("[RtcSessionController]: Set Remote Description - type: ",e.type),X=null,y&&a.main.sdpStatus===nn.AnswerReceived)return $t.warn("[RtcSessionController]: Still processing the previous answer remote description. Queue the new one"),void(ae={sdp:e,cb:t});if(y&&a.main.sdpStatus===nn.PrAnswerReceived)return"answer"===e.type&&(gt(nn.AnswerReceived,y),rt(y)),$t.info("[RtcSessionController]: SDP already applied. Ignoring any later remote SDPs"),void Bt(t);if("offer"===e.type){if(!Ft())return void Bt(t,"Connection not stable");St(!1,t),ge(function(){Lt(e)},vt)}else"sdp"===e.sdp?(gt(nn.AnswerReceived,y),I&&At(),rt(y)):Lt(e),Bt(t)},this.renegotiateMedia=function(e){$t.info("[RtcSessionController]: Start Media Renegotiation from client"),Ft()||Bt(e,"Connection not stable"),St(!0,e),ge(wt,vt)},this.enableRemoteVideo=function(){J&&($t.info("[RtcSessionController]: Enable receiving remote video"),J=!1)},this.disableRemoteVideo=function(){J||($t.info("[RtcSessionController]: Disable receiving remote video"),J=!0)},this.enableRemoteVideoScreenOnly=function(){$||($t.info("[RtcSessionController]: Allow receiving only remote screen share"),$=!0)},this.disableRemoteVideoScreenOnly=function(){$&&($t.info("[RtcSessionController]: Disable receiving only remote screen share"),$=!1)},this.addAudio=function(e){$t.info("[RtcSessionController]: Add Audio"),Gt({audio:!0},e)},this.removeAudio=function(e){$t.info("[RtcSessionController]: Remove Audio"),Gt({audio:!1},e)},this.addVideo=function(e){$t.info("[RtcSessionController]: Add Video"),Gt({video:!0},e)},this.removeVideo=function(e){$t.info("[RtcSessionController]: Remove Video"),Gt({video:!1},e)},this.addDesktop=function(e){$t.info("[RtcSessionController]: Add Desktop (screen sharing)"),Gt({desktop:!0},e)},this.removeDesktop=function(e){$t.info("[RtcSessionController]: Remove Desktop (screen sharing)"),Gt({desktop:!1},e)},this.changeMediaType=function(e,t,n){if($t.info("[RtcSessionController]: Change media type: ",e),t&&$t.info("[RtcSessionController]: Change media options: ",t),!e)return $t.warn("[RtcSessionController]: Invalid media type"),void Bt(n,"Invalid media type");Gt(e,n,t)},this.holdCall=function(e){if($t.info("[RtcSessionController]: Hold Call"),Ft()){if(B)return $t.warn("[RtcSessionController]: The call is already held"),void Bt(e);St(x=B=!0,e),ge(wt,vt)}else Bt(e,"Connection not stable")},this.retrieveCall=function(e){if($t.info("[RtcSessionController]: Retrieve Call"),Ft()){if(!B)return $t.warn("[RtcSessionController]: The call is not held"),void Bt(e);St(W=!(B=!1),e),ge(wt,vt)}else Bt(e,"Connection not stable")},this.getScreenControlData=function(){return{isScreenControlled:ee,isScreenOwner:te,hasScreenControlPc:!!b}},this.updateScreenControlData=function(e,t){ee=!!e,te=!!t,t&&Zt.setControllingScreen()},this.offerScreenControl=function(t){if(ee){if(xt()){Qe(b);try{b.createOffer(function(e){Wt(e,t)},function(e){e=e||"Unspecified",$t.error("[RtcSessionController]: Failed to create the Local Description for the screen control peer connection: ",e.message||e),t&&t(e)},{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})}catch(e){$t.error(e),t&&t(e)}}}else $t.error("Local variables are out of date. The screen control session cannot be initiated.")},this.establishScreenControl=function(e,t){"offer"===e.type?xt()&&Yt(e,t):(Yt(e,t),Bt(t))},this.stopScreenControl=function(t){if(t=t||function(){},te=ee=!1,b)try{$t.debug("[RtcSessionController]: Closing the screen control peer connection."),a.screenControl.localOrigin=null,at(b),b=null,t()}catch(e){$t.error(e),t(e)}else $t.warn("[RtcSessionController]: There is no active screen control peer connection to close."),t()},this.renegotiationFailed=function(e){I&&(p||Be("res_RTCError"),Rt(e))},this.mute=function(e){$t.info("[RtcSessionController]: Mute Call"),pt(!1),Bt(e)},this.unmute=function(e){var t;$t.info("[RtcSessionController]: Unmute Call"),pt(!0)||(t="res_UnmuteFailedNoMic"),Bt(e,t)},this.isMuted=function(){return Y},this.isLocalMuteAllowed=function(){return Y||P[g]&&P[g].getAudioTracks().length},this.setCallStatsOptions=function(e){l&&e&&($t.debug("[RtcSessionController]: Setting call stats options: ",e),l.setOptions(e))},this.terminate=function(){$t.info("[RtcSessionController]: Terminate the RTC session controller"),e()},this.canSendDTMFDigits=function(){return!(!j&&!kt())&&(j&&j.canInsertDTMF)},this.sendDTMFDigits=function(e){if($t.info("[RtcSessionController]: Send DTMF Digits - num of digits: ",e&&e.length),!Ft())return!1;if(!j&&!kt())return!1;if(!j.canInsertDTMF)return $t.error("[RtcSessionController]: DTMF Sender cannot insert DTMF digits"),!1;try{j.insertDTMF(e,200,50)}catch(e){return $t.error("[RtcSessionController]: Send DTMF Digits exception:",e.message),!1}return!0},this.sendDataMessage=function(e){var t=!1;return b&&b.sendDataMessage&&(t=b.sendDataMessage(e)),t},this.setMockedCall=function(){z=!0},this.getCurrentPeerConnection=function(){return y&&y.mainPeerConnection},this.getNumberOfExtraVideoChannels=function(){return s},this.isConnStable=function(){return Ft()},this.isConnected=function(){return a.main.sdpStatus===nn.Connected||I},this.disableIncomingVideo=function(){Z.forEach(function(e){0<e.getVideoTracks().length&&(e.getVideoTracks()[0].enabled=!1)})},this.enableIncomingVideo=function(){Z.forEach(function(e){0<e.getVideoTracks().length&&(e.getVideoTracks()[0].enabled=!0)})},this.getLocalStream=function(e){return P[e]},this.setLocalStream=function(e,t){P[e]=t},this.replaceLocalStream=function(e,t){P[e]&&P[e]!==t&&lt(P[e]),P[e]=t},this.getRemoteStreams=function(){return Z},this.setIgnoreTurnOnNextPC=function(){$t.debug("[RtcSessionController]: setIgnoreTurnOnNextPC..."),oe=!0},this.setIgnoreNextConnection=function(){$t.debug("[RtcSessionController]: setIgnoreNextConnection..."),de=!0},this.getLastSavedStats=function(){var e=M||l;return e?e.getLastSavedStats():null},this.prepareForRenegotiation=function(){h&&!et(y,"offer")&&function(){if(!c)if($t.debug("[RtcSessionController]: Pre-allocate the next peer connection"),De(!0)){var t=c;if(t.onicecandidate=function(e){$t.debug("[RtcSessionController]:[Pre-allocated PC]: New ICE candidate: ",e.candidate)},st(t)){var e={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:bt()}};t.createOffer(function(e){$t.debug("[RtcSessionController]:[Pre-allocated PC]: Local description was successfully created"),e=Nt(t,e),t.setLocalDescription(e,function(){qe(y,"nextPcLocalSdpSetAt",Date.now()),$t.debug("[RtcSessionController]:[Pre-allocated PC]: Local description was successfully applied")},function(e){$t.warn("[RtcSessionController]:[Pre-allocated PC]: Error setting local description: ",e),ot()}),$t.debug("[RtcSessionController]:[Pre-allocated PC]: Created local offer")},function(e){$t.warn("[RtcSessionController]:[Pre-allocated PC]: Error creating local offer: ",e),ot()},e),window.setTimeout(function(){t===c&&ot()},n)}else $t.warn("[RtcSessionController]:[Pre-allocated PC]: Local streams could not be added. Closing peer connection."),ot()}else $t.warn("[RtcSessionController]:[Pre-allocated PC]: Peer connection could not be created.")}()},this.changeInputDevices=function(o){return $t.info("[RtcSessionController]: Change input devices to ",o),o&&(o.audio||o.video)?new Xt(function(e,t){function n(e){$t.error("[RtcSessionController]: Could not change input devices: ",e),t(e)}function i(){$t.info("[RtcSessionController]: Successfully changed input devices"),e()}if(_.unifiedPlanEnabled&&!o.video){Ee.firefox&&m.replaceLocalStream(g,null),$t.debug("[RtcSessionController]: Attempting to change input devices: ",o);var r=P[g];Ne(function(){var e=P[g];y.replaceTrack(r.getAudioTracks()[0],e.getAudioTracks()[0]).then(i).catch(n)},n,o)}else m.changeMediaType(K,function(e){e?n(e):i()})}):Xt.reject("No new input devices specified")},this.adaptScreenShareForRemoteControl=function(t){var n;if(K.desktop&&ne&&(t=!!t,K.remoteControlEnabled!==t)){var e=P[u];e&&0<e.getVideoTracks().length?($t.debug("[RtcSessionController]: Calling adaptScreenShareForRemoteControl with remoteControlEnabled = ",t),n=e.getVideoTracks()[0],K.remoteControlEnabled=t,lt(e),me(function(){var e=m.getLocalStream(u);e&&0<e.getVideoTracks().length?y.replaceTrack(n,e.getVideoTracks()[0]):i("Missing new stream")},i,ne)):$t.warn("[RtcSessionController]: Cannot adapt screen share for remote control as there is no screen share stream")}function i(e){$t.warn("[RtcSessionController]: Could not fetch new desktop stream with remoteControlEnabled="+t+". ",e),t&&m.adaptScreenShareForRemoteControl(!1)}},this.getAvailableVideoReceivers=function(e){return y&&y.getAvailableVideoReceivers(e)||[]},$t.debug("[RtcSessionController]: Created new RtcSessionController instance")}return Rn.DEFAULT_CANDIDATES_TIMEOUT=rn,Rn.DEFAULT_TRICKLE_ICE_TIMEOUT=on,Rn.DEFAULT_ENABLE_AUDIO_AGC=!0,Rn.DEFAULT_UPSCALE_FACTOR=1.5,Rn.LOCAL_STREAMS=n,Rn.DEGRADATION_MODE=i,Rn.candidatesTimeout=rn,Rn.trickleIceTimeout=on,Rn.enableAudioAGC=!0,Rn.screenshareUpscaleFactor=1.5,Rn.cmrScreenshareUpscaleFactor=1.5,Rn.allowAllIceCandidatesScreenShare=!0,Rn.disableTrickleIce=!1,Rn.allowOnlyRelayCandidates=!1,Rn.mediaNode=null,Rn.playbackDevices=[],Rn.recordingDevices=[],Rn.ringingDevices=[],Rn.videoDevices=[],Rn.sdpParameters=JSON.parse(JSON.stringify(r)),Rn.xGoogle=JSON.parse(JSON.stringify(o)),Rn.customTurnServers=[],Rn.maxVideoExtraChannels=null,Rn.degradationPreference=i.MAINTAIN_RESOLUTION,Rn.addAdditionalLowVideoStream=!tn.isMobile(),Rn.disableDesktopPc=!1,Rn.webRTCIPHandlingPolicy=null,Rn.isCMR=!1,Rn.processClientSettings=function(e){try{Rn.allowAllIceCandidatesScreenShare=void 0===(e=e||{}).allowAllIceCandidatesScreenShare||!!e.allowAllIceCandidatesScreenShare,Rn.disableTrickleIce=void 0!==e.disableTrickleIce&&!!e.disableTrickleIce,Rn.screenshareUpscaleFactor=parseFloat(e.screenshareUpscaleFactor,10)||Rn.DEFAULT_UPSCALE_FACTOR,Rn.cmrScreenshareUpscaleFactor=parseFloat(e.cmrScreenshareUpscaleFactor,10)||Rn.DEFAULT_UPSCALE_FACTOR;var t=e.xGoogle||{};Object.keys(o).forEach(function(e){Rn.xGoogle[e]=void 0!==t[e]?t[e]:JSON.parse(JSON.stringify(o[e]))});var n=e.sdpParameters||{};Object.keys(r).forEach(function(e){Rn.sdpParameters[e]=void 0!==n[e]?n[e]:JSON.parse(JSON.stringify(r[e]))}),Rn.degradationPreference=void 0!==e.degradationPreference?e.degradationPreference:i.MAINTAIN_RESOLUTION,Rn.addAdditionalLowVideoStream=void 0!==e.addAdditionalLowVideoStream?e.addAdditionalLowVideoStream:!tn.isMobile(),Qt.WebRTCAdapter.useReducedAudioConstraints=void 0===e.useReducedAudioConstraints||!!e.useReducedAudioConstraints,$t.info("[RtcSessionController]: Updated RtcSessionController values: ",{allowAllIceCandidatesScreenShare:Rn.allowAllIceCandidatesScreenShare,disableTrickleIce:Rn.disableTrickleIce,screenshareUpscaleFactor:Rn.screenshareUpscaleFactor,cmrScreenshareUpscaleFactor:Rn.cmrScreenshareUpscaleFactor,xGoogle:Rn.xGoogle,sdpParameters:Rn.sdpParameters,useReducedAudioConstraints:Qt.WebRTCAdapter.useReducedAudioConstraints})}catch(e){$t.error("[RtcSessionController]: Error processing client settings. ",e)}},Rn.overridePromise=function(e){void 0===Xt&&(Xt=e)},Qt.RtcSessionController=Rn,Qt.Enums=Qt.Enums||{},Qt.Enums.SdpStatus=nn,Qt}((Circuit=function(Y){"use strict";var K,q=Y.Constants,j=Y.logger,Q=Y.Enums.RtpQualityLevel,X=Y.RtpStatsConfig,z=Y.Utils,J=Y.Enums.VideoResolutionLevel,e=z.isMobile(),$=Object.freeze({MAX:"MAX",MIN:"MIN"}),Z=Object.freeze({GOOG_JITTER_RECEIVED:{id:q.AudioQualityParam.JITTER,StatName:"jr",StatText:"googJitterReceived",Threshold:[50,300,500],ThresholdType:$.MAX,RecurrenceThreshold:e?2:3,StreamQualityThreshold:25,reportIssues:!0},GOOG_RTT:{id:q.AudioQualityParam.RTT,StatName:"rtt",StatText:"googRtt",Threshold:[300,600,800],ThresholdType:$.MAX,RecurrenceThreshold:e?2:3,StreamQualityThreshold:25,reportIssues:!0},PACKET_LOSS_RECV:{id:q.AudioQualityParam.PL_RECV,StatName:"plr",StatText:"packetLossRecv",Threshold:[.05,.2,.3],ThresholdType:$.MAX,RecurrenceThreshold:e?2:3,StreamQualityThreshold:3,reportIssues:!0},PACKET_LOSS_SEND:{id:q.AudioQualityParam.PL_SEND,StatName:"pll",StatText:"packetLossSend",Threshold:[.05,.2,.3],ThresholdType:$.MAX,RecurrenceThreshold:e?0:3,reportIssues:!0},NO_PACKETS_RECV:{id:q.AudioQualityParam.NO_PACKETS_RECV,StatName:"npr",StatText:"noPacketsReceived",Threshold:[0],RecurrenceThreshold:e?2:3,reportIssues:!0},NO_PACKETS_SEND:{id:q.AudioQualityParam.NO_PACKETS_SENT,StatName:"nps",StatText:"noPacketsSent",Threshold:[0],RecurrenceThreshold:2,reportIssues:!0},ECHO_LIKELIHOOD:{id:q.AudioQualityParam.ECHO,StatName:"ecmax",StatText:"googResidualEchoLikelihoodRecentMax",Threshold:[.5],ThresholdType:$.MAX,RecurrenceThreshold:e?2:3,reportIssues:!1}}),ee=Object.freeze({GOOG_RTT:{id:q.VideoQualityParam.RTT,StatName:"rtt",StatText:"googRtt",Threshold:[300,600,800],ThresholdType:$.MAX,RecurrenceThreshold:e?2:3},PACKET_LOSS_RECV:{id:q.VideoQualityParam.PL_RECV,StatName:"plr",StatText:"packetLossRecv",Threshold:[.05,.2,.3],ThresholdType:$.MAX,StreamQualityThreshold:.1,RecurrenceThreshold:e?2:3},PACKET_LOSS_SEND:{id:q.VideoQualityParam.PL_SEND,StatName:"pll",StatText:"packetLossSend",Threshold:[.05,.2,.3],ThresholdType:$.MAX,RecurrenceThreshold:e?0:3}}),te=JSON.stringify({FRAME_HEIGHT_SENT:{id:q.VideoQualityParam.FRAME_HEIGHT_SENT,StatName:"fhs",StatText:"googFrameHeightSent",Threshold:[],ThresholdType:$.MIN,RecurrenceThreshold:e?2:3},FRAME_WIDTH_SENT:{id:q.VideoQualityParam.FRAME_WIDTH_SENT,StatName:"fws",StatText:"googFrameWidthSent",Threshold:[],ThresholdType:$.MIN,RecurrenceThreshold:e?2:3},FRAME_RATE_SENT:{id:q.VideoQualityParam.FRAME_RATE_SENT,StatName:"frs",StatText:"googFrameRateSent",Threshold:[],ThresholdType:$.MIN,RecurrenceThreshold:e?2:3},AVAIL_SEND_BW:{id:q.VideoQualityParam.BW_SEND,StatName:"abw",StatText:"googAvailableSendBandwidth",Threshold:[],ThresholdType:$.MIN,RecurrenceThreshold:e?2:3},TRANSMIT_BIT_RATE:{id:q.VideoQualityParam.TRX_BITRATE,StatName:"tbr",StatText:"googTransmitBitrate",Threshold:[],ThresholdType:$.MIN,RecurrenceThreshold:e?2:3}}),ne=Object.freeze({AUDIO:"audio",VIDEO:"video",SCREEN:"screen"}),ie=Object.freeze({audioOutputLevel:"aol",bytesReceived:"or",bytesSent:"os",googAvailableSendBandwidth:"abw",googResidualEchoLikelihoodRecentMax:"ecmax",googFrameHeightReceived:"fhr",googFrameHeightSent:"fhs",googFrameWidthReceived:"fwr",googFrameWidthSent:"fws",googFrameRateDecoded:"frd",googFrameRateSent:"frs",googFrameRateReceived:"frr",googJitterReceived:"jr",googRtt:"rtt",googTransmitBitrate:"tbr",packetsLost:"pl",packetsReceived:"pr",packetsSent:"ps"});void 0!==window.Promise&&(K=window.Promise);var re=z.getBrowserInfo();function t(e,t){if(!Array.isArray(e))throw new Error("peerConnections must be an array");var n=6,u=20,i=6,r=e.filter(function(e){return e});if(!e.length)throw new Error("Cannot create CallStatsHandler object without at least one peer connection");var o,d=Y.WebRTCAdapter.getNetmaskMap(),a=!!t,c={},s=null,l=null,E=0,C={},T={},p={},S={},I={},A=!1,R={},f=null,v={audio:null},_=[Z.GOOG_JITTER_RECEIVED,Z.PACKET_LOSS_RECV,Z.GOOG_RTT],g=JSON.parse(te),N=this;function m(e){switch(e){case"local":return"host";case"stun":case"serverreflexive":return"srflx";case"peerreflexive":return"prflx";case"relayed":return"relay";default:return e}}function h(e,n,i){var r;return e.a.some(function(e){if("candidate"===e.field&&e.value){var t=new Y.IceCandidate(e.value);if(t.typ===i&&t["network-id"]===n["network-id"])return r=t.address,!0}return!1}),r}function O(e,t,n,i){var r=e.stat("googChannelId"),o={channelId:r},a=parseInt(e.stat("googRtt"),10);o.rtt=isNaN(a)?-1:a,i&&(o.candidates={local:e.stat("localCandidateId"),remote:e.stat("remoteCandidateId")},re.firefox||re.safari?n.remote=e.stat("remoteCandidateId"):function(e,t){var n=z.parseIpWithPort(t.stat("googLocalAddress"))||{},i=z.parseIpWithPort(t.stat("googRemoteAddress"))||{};e.ipl=n.ipAddress,e.ptl=n.port,e.ipr=i.ipAddress,e.ptr=i.port,e.lct=m(t.stat("googLocalCandidateType")),e.rct=m(t.stat("googRemoteCandidateType")),e.tt=t.stat("googTransportType")}(o,e)),t.channelInfo[r]=o}function D(e,t,o,n,i){if(!t||!o)return null;var a,s={startTime:e,pcType:n,audio:{transmit:{},receive:{}},video:{transmit:{},receive:{}},channelInfo:{},quality:{audio:{},video:{}}},r={audio:{},video:{}},c={},l=t.result?t.result():t;if(!Array.isArray(l))return null;l.forEach(function(t){if(t){var n=null;switch(t.type){case"ssrc":n=function(e,t,n){var i=null,r=e.stat("ssrc"),o={id:e.id,ssrc:r,content:e.stat("googContentType"),channelId:e.stat("transportId"),trackId:e.stat("googTrackId")};return e.stat("audioInputLevel")?(t.audio.transmit[r]||(t.audio.transmit[r]=o),(i=t.audio.transmit[r]).content=ne.AUDIO):e.stat("audioOutputLevel")?(t.audio.receive[r]||(t.audio.receive[r]=o),(i=t.audio.receive[r]).content=ne.AUDIO):e.stat("googFrameHeightSent")?(t.video.transmit[r]||(t.video.transmit[r]=o),re.firefox?o.content=e.stat("mid")===n.getScreenShareMediaId()?ne.SCREEN:ne.VIDEO:o.content!==ne.SCREEN&&(o.content=ne.VIDEO),i=t.video.transmit[r]):e.stat("googFrameHeightReceived")&&(t.video.receive[r]||(t.video.receive[r]=o),o.content=n.desktopRemoteSsrc.includes(o.ssrc)?ne.SCREEN:ne.VIDEO,i=t.video.receive[r]),i}(t,s,o);break;case"VideoBwe":s.video.bw||(s.video.bw={id:t.id}),n=s.video.bw;break;case"localcandidate":case"remotecandidate":c[t.id]=t}if(t.names&&n)(t.names()||[]).forEach(function(e){ie[e]&&(n[ie[e]]=parseFloat(t.stat(e)))}),n.en=t.stat("googCodecName")}}),l.forEach(function(e){e&&"googCandidatePair"===e.type&&"true"===e.stat("googActiveConnection")&&O(e,s,r,i)}),i&&Object.keys(s.channelInfo).forEach(function(t){var e=s.channelInfo[t];if(e){var n=c[e.candidates.local];if(n){if(re.firefox||re.safari)!function(e,t,n){e.ipl=t&&t.stat("ipAddress"),e.ptl=t&&t.stat("portNumber"),e.ipr=n&&n.stat("ipAddress"),e.ptr=n&&n.stat("portNumber"),e.lct=t&&m(t.stat("candidateType")),e.rct=n&&m(n.stat("candidateType")),e.tt=t&&t.stat("protocol")}(e,n,c[e.candidates.remote]);e.ni=n.stat("networkType"),a=a||Y.sdpParser.parse(o.localDescription&&o.localDescription.sdp),e.candidate=function(i,e){var r,o,a={};if(!i||!e)return a;var s=m(i.stat("candidateType"));return"prflx"===s?o=i.stat("ipAddress"):r=String(i.stat("portNumber")),("string"==typeof e?Y.sdpParser.parse(e):e).m.some(function(n){return n.a.some(function(e){if("candidate"!==e.field)return!1;if(e.value){var t;if(r&&0<=e.value.indexOf(r)&&(t=new Y.IceCandidate(e.value),String(t.port)===r&&s===t.typ))return a.value=e.value,"host"===s?(a.hAddr=i.stat("ipAddress"),a.sAddr=h(n,t,"srflx")):(a.sAddr="srflx"===s?t.address:t.raddr,a.hAddr=h(n,t,"host"),"relay"===s&&(a.tt=t.getRelayClientTransportType())),!0;if(o&&0<=e.value.indexOf("srflx")&&"srflx"===(t=t||new Y.IceCandidate(e.value)).typ&&String(t.address)===o)return a.sAddr=o,a.hAddr=h(n,t,"host"),!0}return!1}),!1}),a.netmask=d[a.hAddr],a}(n,a)}var i=s.audio.receive;e.isAudioChannel=e.isAudioChannel||Object.values(i).some(function(e){return e.channelId===t});var r=s.video.transmit;e.isVideoSendChannel=e.isVideoSendChannel||Object.values(r).some(function(e){return e.channelId===t&&e.content===ne.VIDEO&&!R[e.trackId]})}});return s}function P(t){var e=!o;o=o||e;var n=r.find(function(e){return!!e&&(t||"completed"===e.iceConnectionState||"connected"===e.iceConnectionState?e.mainPeerConnection:(j.warn("[CallStatsHandlerUnified]: Do not collect stats. pc.iceConnectionState = ",e.iceConnectionState),!1))});return n?function(t,n,i,r){return t.getStats?t.getStats().catch(function(e){j.warn("[CallStatsHandlerUnified]: getStats["+n+"] failed with err = ",e)}).then(function(e){return e?e=D(i,e,t,n,r):j.warn("[CallStatsHandlerUnified]: getStats["+n+"] did not return a response"),e}):K.resolve()}(n,"AUDIO/VIDEO/SCREEN",n.startTime,e).then(function(r){return r&&[ne.AUDIO,ne.VIDEO].forEach(function(i){r[i]&&["transmit","receive"].forEach(function(n){Object.keys(r[i][n]).forEach(function(e){var t=r[i][n][e];t.channelInfo||(t.channelInfo=T[t.channelId]||r.channelInfo[t.channelId])})})}),r}):K.resolve()}function y(e,t){var n=0,i=0;t&&(n=t.pl||0,i=t.ps||0);var r=(e.pl-n)/(e.ps-i||1);return Math.round(100*r)/100}function b(e,t){var n=0,i=0;t&&(n=t.pl||0,i=t.pr||0);var r=(e.pl-n)/(e.pr-i+e.pl-n||1);return Math.round(100*r)/100}function U(e,t,n){var i=n+"Sum",r=n+"Count",o=n+"Max";t?(void 0!==t[i]?(e[i]=t[i]+(e[n]||0),++t[r],e[r]=t[r]):(e[i]=e[n]||0,e[r]=1),void 0!==t[o]?e[o]=Math.max(t[o],e[n]||0):e[o]=e[n]||0):(e[i]=e[o]=e[n]||0,e[r]=1)}function L(e,t,n,i,r,o){var a;t.reportIssues?a=e[t.StatText]||{}:a={counter:(e[t.StatText]||{}).counter};var s=t.StatText+"LastViStart",c=t.StatText+"Violations",l=t.StatText+"ViCounter";if(r[s]=o&&o[s],r[c]=o&&o[c],r[l]=o&&o[l]||0,-1===n){if(r[s]){var d=r[c];d=d?d+",":"",r[c]=d+"("+r[s]+","+parseInt((Date.now()-i)/1e3,10)+")",r[l]++,delete r[s],o&&delete o[s]}a.reported?a.counter++:a.counter&&(delete e[t.StatText],j.debug("[CallStatsHandlerUnified]: issueCounter cleared=",t.StatText))}else a.reported?(a.counter=0,a.value=n):a.counter?(a.counter++,a.value=n):(e[t.StatText]={statObj:t,counter:1,value:n},r[l]<u&&(r[s]=parseInt((Date.now()-i)/1e3,10)))}function M(e,t,n){return n===$.MAX?t<=e:e<=t}function w(e,t,n,i){if(0<=i){e.quality.level=e.quality.level||Q.RTP_QUALITY_HIGH;var r=0<t.Threshold.length?function(e,t){return M(e.Threshold[0],t,e.ThresholdType)?Q.RTP_QUALITY_HIGH:M(e.Threshold[1],t,e.ThresholdType)?Q.RTP_QUALITY_MEDIUM:M(e.Threshold[2],t,e.ThresholdType)?Q.RTP_QUALITY_LOW:Q.RTP_QUALITY_POOR}(t,i):Q.RTP_QUALITY_HIGH;e.quality[n][t.id]={qualityLevel:r,value:i},e.quality[r.value]=e.quality[r.value]||[],e.quality[r.value].push(t),r.value<e.quality.level.value&&(e.quality.level=r)}}function G(e){e&&e.audio&&(function(c){Object.keys(c.audio.transmit).forEach(function(e){var t=C[e]||{},n=p[e]||{},i=c.audio.transmit[e];if(i){i.media=ne.AUDIO;var r=Z.PACKET_LOSS_SEND,o=y(i,t);i.pl&&i.ps&&L(n,r,o>=r.Threshold[0]?o:-1,c.startTime,i,t),w(c,r,ne.AUDIO,o);var a=(i.ps||0)-(t.ps||0);L(n,Z.NO_PACKETS_SEND,!(0<a)||-1,c.startTime,i,t),r=Z.ECHO_LIKELIHOOD,U(i,t,Z.ECHO_LIKELIHOOD.StatName);var s=i[r.StatName]||0;L(n,r,s&&s>=r.Threshold[0]?s:-1,c.startTime,i,t)}C[e]=i,p[e]=n})}(e),function(s){Object.keys(s.audio.receive).forEach(function(e){var t=C[e]||{},n=p[e]||{},i=s.audio.receive[e],r=Z.PACKET_LOSS_RECV;if(i){i.media=ne.AUDIO;var o,a=b(i,t);i.pl&&i.pr&&L(n,r,a>=r.Threshold[0]?a:-1,s.startTime,i,t),w(s,r,ne.AUDIO,a),c.sendOnlyStream||L(n,Z.NO_PACKETS_RECV,!(i.pr>t.pr)||-1,s.startTime,i,t),r=Z.GOOG_JITTER_RECEIVED,U(i,t,Z.GOOG_JITTER_RECEIVED.StatName),o=i[r.StatName],w(s,r,ne.AUDIO,o),L(n,r,o&&o>=r.Threshold[0]?o:-1,s.startTime,i,t),s.quality.audio.trackId=e}C[e]=i,p[e]=n})}(e))}function H(c){Object.keys(c.video.transmit).forEach(function(e){var t=C[e]||{},n=S[e]||{},i=c.video.transmit[e];i.media=ne.VIDEO;var r=ee.PACKET_LOSS_SEND;if(i&&!R[i.trackId]){var o=y(i,t);if(i.pl&&i.ps&&L(n,r,o>=r.Threshold[0]?o:-1,c.startTime,i,t),i.content===ne.VIDEO){w(c,r,ne.VIDEO,o);var a=Math.max(i.fws,i.fhs)||i.fws,s=Math.min(i.fws,i.fhs)||i.fhs;w(c,g.FRAME_HEIGHT_SENT,ne.VIDEO,s),w(c,g.FRAME_WIDTH_SENT,ne.VIDEO,a),w(c,g.FRAME_RATE_SENT,ne.VIDEO,i.frs),c.video.bw&&(w(c,g.TRANSMIT_BIT_RATE,ne.VIDEO,c.video.bw.tbr),w(c,g.AVAIL_SEND_BW,ne.VIDEO,c.video.bw.abw)),function(e,t,n){var i={};if(0<=t&&0<=n)switch(i.resolution={height:t,width:n},Math.min(t,n)){case 1080:i.hdVideo=J.VIDEO_1080;break;case 720:i.hdVideo=J.VIDEO_720;break;case 480:i.hdVideo=J.VIDEO_480}e.quality.videoInfo=i}(c,i.fhs,i.fws)}}C[e]=i,S[e]=n})}function k(e){e&&e.video&&(C.bw=e.video.bw||{},C.bw.media=ne.VIDEO,H(e),function(a){Object.keys(a.video.receive).forEach(function(e){var t=C[e]||{},n=S[e]||{},i=a.video.receive[e];i.media=ne.VIDEO;var r=ee.PACKET_LOSS_RECV;if(i&&i.pr){var o=b(i,t);i.pl&&L(n,r,o>=r.Threshold[0]?o:-1,a.startTime,i,t)}C[e]=i,S[e]=n})}(e))}function V(e){!function(i){i.quality.level=Q.RTP_QUALITY_HIGH;var r=0,o=-1;Object.keys(Q).some(function(e){var t=Q[e];if(t!==Q.RTP_QUALITY_HIGH){var n=i.quality[t.value]||[];if(0<n.length){if(n.some(function(e){return"PL_SEND"===e.id||"PL_RECV"===e.id})||1<n.length)return i.quality.level=t,!0;r++,o+=t.value+1}}return!1}),i.quality.level===Q.RTP_QUALITY_HIGH&&(2<r?i.quality.level=Q.RTP_QUALITY_LOW:1<r?i.quality.level=2<o?Q.RTP_QUALITY_MEDIUM:Q.RTP_QUALITY_LOW:1===r&&0===o&&(i.quality.level=Q.RTP_QUALITY_MEDIUM));var e=C.quality&&C.quality.level;if(C.quality={level:i.quality.level,audio:i.quality.audio,video:i.quality.video},i.quality.videoInfo&&(C.quality.videoInfo=i.quality.videoInfo),i.quality.level!==e){var n="[CallStatsHandlerUnified]: calculateOverallQuality:";[ne.AUDIO,ne.VIDEO].forEach(function(e){n+="\n"+e+":";var t=i.quality[e];Object.keys(t).forEach(function(e){"trackId"!==e&&(n+=" "+e+"="+t[e].qualityLevel.levelName+"["+t[e].value+"]")})}),n+="\nOverall: "+i.quality.level.levelName,j.debug(n),N.onNetworkQuality&&N.onNetworkQuality(i.quality)}}(e);var t=!1,n=x(p),i=x(S),r=x(I);if((n||i||r)&&(t=!0,!A))if(i=i||"none",r=r||"none",A=!0,(n=n||"none").noPacketsReceived||n.noPacketsSent){var o=n.noPacketsSent?"sent to":"received from";j.warn("[CallStatsHandlerUnified]: processRTPStats - No packets "+o+" remote peer"),n.noPacketsSent&&N.onNoOutgoingPackets&&N.onNoOutgoingPackets()}else j.warn("[CallStatsHandlerUnified]: processRTPStats - Quality issues detected. ",[{audio:n},{video:i},{channel:r}]),N.onThresholdExceeded&&N.onThresholdExceeded();return t}function F(e){if(e){var t;G(e),k(e),function(o){Object.keys(o.channelInfo).forEach(function(e){var t=T[e],n=o.channelInfo[e];U(n,t,ee.GOOG_RTT.StatName);var i=Z.GOOG_RTT,r=I[e]||{};L(r,i,n.rtt>=i.Threshold[0]?n.rtt:-1,o.startTime,n,t),(t=t||n).isAudioChannel?(i=Z.GOOG_RTT,w(o,i,ne.AUDIO,n.rtt)):t.isVideoSendChannel&&(i=ee.GOOG_RTT,w(o,i,ne.VIDEO,n.rtt)),I[e]=r})}(e),t=V(e),function(n){Object.keys(n.channelInfo).forEach(function(e){var t=T[e]||{};T[e]=Object.assign(t,n.channelInfo[e])})}(e),function(e,t){if(!a)return;(f=f||{})[t]=f[t]||{qualityData:[]},f[t].trackId=e[t].trackId,v[t]&&v[t].count>=i?W(t):function(n,i){var r=v[i];r||(r={count:0},_.forEach(function(e){r[e.StatName]=0}),v[i]=r);_.forEach(function(e){var t=n[i][e.id]&&n[i][e.id].value||0;r[e.StatName]+=t}),r.count++,0===f[i].qualityData.length&&W(i)}(e,t)}(e.quality,ne.AUDIO),!t&&A&&(j.debug("[CallStatsHandlerUnified]: processRTPStats - No quality issues detected. Clear threshold exceeded error."),A=!1,N.onThresholdExceeded&&N.onThresholdExceeded(!0)),!A&&E%n!=0||function(i){var r,o;function a(e){return void 0===e||e<0?"n/a":e}Object.keys(i.channelInfo).forEach(function(n){var e=i.channelInfo[n];r="[CallStatsHandlerUnified]: statsReport: channelRtt="+(0<=e.rtt?e.rtt:"n/a"),Object.keys(i.audio.receive).forEach(function(e){var t=i.audio.receive[e];t.channelId===n&&(r+="\n audioReceive:  id="+t.id+" pl="+a(t.pl)+" pr="+a(t.pr)+" or="+a(t.or)+" jr="+a(t.jr))}),Object.keys(i.audio.transmit).forEach(function(e){var t=i.audio.transmit[e];t.channelId===n&&(r+="\n audioTransmit: id="+t.id+" pl="+a(t.pl)+" ps="+a(t.ps)+" os="+a(t.os))}),Object.keys(i.video.receive).forEach(function(e){var t=i.video.receive[e];t.channelId===n&&(r+="\n videoReceive:  id="+t.id+" pl="+a(t.pl)+" pr="+a(t.pr)+" or="+a(t.or)+" fwr="+t.fwr+" fhr="+t.fhr+" frd="+t.frd+" frr="+t.frr)}),Object.keys(i.video.transmit).forEach(function(e){var t=i.video.transmit[e];t.channelId===n&&(r+="\n videoTransmit: id="+t.id+" pl="+a(t.pl)+" ps="+a(t.ps)+" os="+a(t.os)+" fws="+t.fws+" fhs="+t.fhs+" frs="+t.frs+" abw="+(i.video.bw&&i.video.bw.abw||"N/A"))}),j.debug(r)}),r="[CallStatsHandlerUnified]: statsReport:\n",[p,S,I].forEach(function(n,e){switch(0<e&&(r+="\n"),n){case p:r+=" Audio issues =";break;case S:r+=" Video issues =";break;case I:r+=" Channel issues =";break;default:r+=" Unknown ="}var i;Object.keys(n).forEach(function(t){var e=Object.keys(n[t]);e.length&&(i=o=!0,e.forEach(function(e){r+=" "+e+"="+n[t][e].value+" count="+n[t][e].counter}))}),i||(r+=" none")}),o&&j.info(r)}(e),E++}}function B(){Y.isElectron&&j.debug("[CallStatsHandlerUnified]: Get RTP stats for local call(s)"),P().then(function(e){e?(Y.isElectron&&j.debug("[CallStatsHandlerUnified]: Process RTP stats for local call(s)"),F(e)):Y.isElectron&&j.debug("[CallStatsHandlerUnified]: No RTP stats collected")})}function x(i){var r=null;return Object.keys(i).forEach(function(e){var t=Object.keys(i[e]),n=i[e]||{};t.forEach(function(e){var t=n[e];t.counter>=t.statObj.RecurrenceThreshold?t.reported?(delete n[e],j.debug("[CallStatsHandlerUnified]: issueCounter cleared=",e)):(t.reported=!0,t.counter=0,(r=r||{})[e]=!0):t.reported&&((r=r||{})[e]=!0)})}),r}function W(r){var o=function(e){var n=v[e];if(v[e]=null,!n||!n.count)return null;var i=n.count;return delete n.count,_.forEach(function(e){var t=n[e.StatName];e.StatName===Z.PACKET_LOSS_RECV.StatName&&(t*=100),n[e.StatName]=Math.round(t/i)}),n.timestamp=Date.now(),n}(r);o&&_.some(function(e){var t=e.StreamQualityThreshold,n=o[e.StatName]||0,i=function(e,t){var n=f[e].qualityData;return n&&n.length&&n[n.length-1][t.StatName]||0}(r,e);return(0===f[r].qualityData.length||Math.abs(i-n)>t)&&(j.debug("[CallStatsHandlerUnified]: Writing into clientStreamQualityData - ",o),f[r].qualityData.push(o),!0)})}this.start=function(){s||l||(j.debug("[CallStatsHandlerUnified]: Waiting to start collecting RTPstats"),s=window.setTimeout(function(){j.info("[CallStatsHandlerUnified]: Start collecting RTPStats"),s=null,E=0,B(),l=window.setInterval(function(){B()},X.COLLECTION_INTERVAL)},X.DELAY_UPON_ANSWER))},this.stop=function(){return function(){j.debug("[CallStatsHandlerUnified]: stopCollectingRTPStats ",f);var e=P(!0);return W(ne.AUDIO),s?(j.debug("[CallStatsHandlerUnified]: Cancel collecting RTP stats "),window.clearTimeout(s),s=null):l&&(j.debug("[CallStatsHandlerUnified]: Stop collecting RTP stats"),window.clearInterval(l),l=null,C&&j.debug("[CallStatsHandlerUnified]: savedRTPStats =",C),N.onThresholdExceeded&&N.onThresholdExceeded(!0),A=!1),e}()},this.onThresholdExceeded=null,this.onNoOutgoingPackets=null,this.onNetworkQuality=null,this.setOptions=function(e){e&&(c=e)},this.getLastSavedStats=function(){return C.channelInfo=T,C},this.getStreamQualityData=function(){return f},this.setTransmitVideoParams=function(t){if(t){if(t.mediaConstraints&&t.mediaConstraints.hdVideo){var e,n;switch(t.mediaConstraints.videoResolution||J.VIDEO_1080){case J.VIDEO_1080:e=1080,n=1920;break;case J.VIDEO_720:e=720,n=1280;break;default:e=480,n=853}g.FRAME_RATE_SENT.Threshold=[20,8,3],g.FRAME_HEIGHT_SENT.Threshold=[.9*e,.75*e,.5*e],g.FRAME_WIDTH_SENT.Threshold=[.9*n,.75*n,.5*n];var i=1e3*(t.bitRates.maxBitRate||0),r=1e3*(t.bitRates.minBitRate||0),o=.75*i;o<r&&(o=i),g.AVAIL_SEND_BW.Threshold=[o,r,.5*r],g.TRANSMIT_BIT_RATE.Threshold=g.AVAIL_SEND_BW.Threshold}t.trackConstraints&&Object.keys(t.trackConstraints).forEach(function(e){t.trackConstraints[e].quality===q.VideoQuality.LOW&&(R[e]=!0)})}}}return t.overridePromise=function(e){void 0===K&&(K=e)},Y.CallStatsHandlerUnified=t,Y}((Circuit=function(P){"use strict";var l,y=P.logger,b=P.Enums.RtpQualityLevel,U=P.RtpStatsConfig,i=P.Utils,e=i.isMobile(),L=Object.freeze({GOOG_JITTER_RECEIVED:{StatName:"jr",StatText:"googJitterReceived",Threshold:50,RecurrenceThreshold:e?2:3,reportIssues:!0},GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:e?2:3,reportIssues:!0},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:e?2:3,reportIssues:!0},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:e?0:3,reportIssues:!0},NO_PACKETS_RECV:{StatName:"",StatText:"noPacketsReceived",Threshold:0,RecurrenceThreshold:e?2:3,reportIssues:!0},ECHO_LIKELIHOOD:{StatName:"ecmax",StatText:"googResidualEchoLikelihoodRecentMax",Threshold:.5,RecurrenceThreshold:e?2:3,reportIssues:!1}}),M=Object.freeze({GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:e?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:e?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:e?0:3}}),d=Object.freeze({audioOutputLevel:"aol",bytesReceived:"or",bytesSent:"os",googAvailableSendBandwidth:"abw",googResidualEchoLikelihoodRecentMax:"ecmax",googFrameHeightReceived:"fhr",googFrameHeightSent:"fhs",googFrameWidthReceived:"fwr",googFrameWidthSent:"fws",googFrameRateDecoded:"frd",googFrameRateSent:"frs",googFrameRateReceived:"frr",googJitterReceived:"jr",googRtt:"rtt",googTransmitBitrate:"tbr",packetsLost:"pl",packetsReceived:"pr",packetsSent:"ps"});void 0!==window.Promise&&(l=window.Promise);var u=i.getBrowserInfo();function E(e){switch(e){case"local":return"host";case"stun":case"serverreflexive":return"srflx";case"peerreflexive":return"prflx";case"relayed":return"relay";default:return e}}function C(e,n,i){var r;return e.a.some(function(e){if("candidate"===e.field&&e.value){var t=new P.IceCandidate(e.value);if(t.typ===i&&t["network-id"]===n["network-id"])return r=t.address,!0}return!1}),r}function T(e){var t=i.parseIpWithPort(e.stat("googLocalAddress"))||{},n=i.parseIpWithPort(e.stat("googRemoteAddress"))||{};return{ipl:t.ipAddress,ptl:t.port,ipr:n.ipAddress,ptr:n.port,lct:E(e.stat("googLocalCandidateType")),rct:E(e.stat("googRemoteCandidateType")),tt:e.stat("googTransportType")}}function o(e,t,r,n,i){if(!t||!r)return null;var o={startTime:e,pcType:n,audio:{},video:{}},a={audio:{},video:{}},s={},c=t.result?t.result():t;if(!Array.isArray(c))return null;if(c.forEach(function(t){if(t){var n=null;switch(t.type){case"googCandidatePair":"true"===t.stat("googActiveConnection")&&function(e,t,n,i){"Channel-audio-1"===e.stat("googChannelId")?(t.audio.rtt=parseInt(e.stat("googRtt"),10),i&&(n.audio.local=e.stat("localCandidateId"),u.firefox?n.audio.remote=e.stat("remoteCandidateId"):t.audio.channelInfo=T(e))):(t.video.rtt=parseInt(e.stat("googRtt"),10),i&&(n.video.local=e.stat("localCandidateId"),u.firefox?n.video.remote=e.stat("remoteCandidateId"):t.video.channelInfo=T(e)))}(t,o,a,i);break;case"ssrc":n=function(e,t){var n=null,i={id:e.id,ssrc:e.stat("ssrc"),timestamp:e.timestamp};return e.stat("audioInputLevel")?(t.audio.transmit||(t.audio.transmit=i),n=t.audio.transmit):e.stat("audioOutputLevel")?(t.audio.receive||(t.audio.receive=i),n=t.audio.receive):e.stat("googFrameHeightSent")?(t.video.transmit||(t.video.transmit=i),n=t.video.transmit):e.stat("googFrameHeightReceived")&&(t.video.receive||(t.video.receive=i),n=t.video.receive),n}(t,o);break;case"VideoBwe":o.video.bw||(o.video.bw={id:t.id}),n=o.video.bw;break;case"localcandidate":case"remotecandidate":s[t.id]=t}if(t.names&&n)(t.names()||[]).forEach(function(e){d[e]&&(n[d[e]]=parseFloat(t.stat(e)))}),n.en=t.stat("googCodecName")}}),i){var l;["audio","video"].forEach(function(e){var t=o[e]||{},n=s[a[e].local];if(n){if(!t.channelInfo){var i=s[a[e].remote];t.channelInfo=function(e,t){return{ipl:e&&e.stat("ipAddress"),ptl:e&&e.stat("portNumber"),ipr:t&&t.stat("ipAddress"),ptr:t&&t.stat("portNumber"),lct:e&&E(e.stat("candidateType")),rct:t&&E(t.stat("candidateType")),tt:e&&e.stat("transport")}}(n,i)}t.channelInfo.ni=n.stat("networkType"),l=l||P.sdpParser.parse(r.localDescription&&r.localDescription.sdp),t.channelInfo.candidate=function(i,e,t){var r,o,a={};if(!i||!e||!t)return a;var s=E(i.stat("candidateType"));return"prflx"===s?o=i.stat("ipAddress"):r=String(i.stat("portNumber")),("string"==typeof e?P.sdpParser.parse(e):e).m.some(function(n){return n.media===t&&(n.a.some(function(e){if("candidate"!==e.field)return!1;if(e.value){var t;if(r&&0<=e.value.indexOf(r)&&(t=new P.IceCandidate(e.value),String(t.port)===r&&s===t.typ))return a.value=e.value,"host"===s?(a.hAddr=i.stat("ipAddress"),a.sAddr=C(n,t,"srflx")):(a.sAddr="srflx"===s?t.address:t.raddr,a.hAddr=C(n,t,"host"),"relay"===s&&(a.tt=t.getRelayClientTransportType())),!0;if(o&&0<=e.value.indexOf("srflx")&&"srflx"===(t=t||new P.IceCandidate(e.value)).typ&&String(t.address)===o)return a.sAddr=o,a.hAddr=C(n,t,"host"),!0}return!1}),!0)}),a}(n,l,e)}})}return o}function w(t,n,i,r){return t.getStats?t.getStats().catch(function(e){y.warn("[CallStatsHandler]: getStats["+n+"] failed with err = ",e)}).then(function(e){return e?e=o(i,e,t,n,r):y.warn("[CallStatsHandler]: getStats["+n+"] did not return a response"),e}):l.resolve()}function t(e){if(!Array.isArray(e))throw new Error("peerConnections must be an array");var t=6,u=20,r=e.filter(function(e){return e});if(!e.length)throw new Error("Cannot create CallStatsHandler object without at least one peer connection");var d,E,C,T,p,o,S={},n=null,i=null,I=0,A=[],R=[],f=[],v=[],_=[],g=this;function a(e){var n=[],i=!o;return o=o||i,r.forEach(function(t){t&&(e||"completed"===t.iceConnectionState||"connected"===t.iceConnectionState?(t.mainPeerConnection&&(n.push(w(t.mainPeerConnection,"AUDIO/VIDEO",t.startTime,i)),t.groupPeerConnections.forEach(function(e){n.push(w(e,"AUX_VIDEO",t.startTime,i))})),t.desktopPeerConnection&&n.push(w(t.desktopPeerConnection,"SCREEN_SHARE",t.startTime,i))):y.warn("[CallStatsHandler]: Do not collect stats. pc.iceConnectionState = ",t.iceConnectionState))}),new l(function(t){l.all(n).then(function(e){(e=e&&e.filter(function(e,t){return e&&(e.audio&&!e.audio.channelInfo&&R[t]&&(e.audio.channelInfo=R[t]),e.video&&!e.video.channelInfo&&f[t]&&(e.video.channelInfo=f[t])),e}))&&e.length?t(e):t()})})}function N(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.ps||0),(e.pl-n)/(e.ps-i||-1)}function m(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.pr||0),(e.pl-n)/(e.pr-i+e.pl-n||-1)}function h(e,t,n){var i=n+"Sum",r=n+"Count",o=n+"Max";t?(void 0!==t[i]?(e[i]=t[i]+(e[n]||0),++t[r],e[r]=t[r]):(e[i]=e[n]||0,e[r]=1),void 0!==t[o]?e[o]=Math.max(t[o],e[n]||0):e[o]=e[n]||0):(e[i]=e[o]=e[n]||0,e[r]=1)}function O(e,t,n,i,r,o){var a;t.reportIssues?a=e[t.StatText]||{}:a={counter:(e[t.StatText]||{}).counter};var s=t.StatText+"LastViStart",c=t.StatText+"Violations",l=t.StatText+"ViCounter";if(r[s]=o&&o[s],r[c]=o&&o[c],r[l]=o&&o[l]||0,-1===n){if(r[s]){var d=r[c];d=d?d+",":"",r[c]=d+"("+r[s]+","+parseInt((Date.now()-i)/1e3,10)+")",r[l]++,delete r[s]}a.reported?a.counter++:a.counter&&(delete e[t.StatText],y.debug("[CallStatsHandler]: issueCounter cleared=",t.StatText))}else a.reported?(a.counter=0,a.value=n):a.counter?(a.counter++,a.value=n):(e[t.StatText]={statObj:t,counter:1,value:n},r[l]<u&&(r[s]=parseInt((Date.now()-i)/1e3,10)))}function s(e){if(e&&e.length){var E=!1;e.forEach(function(e,t){var n,i=e.audio&&e.audio.transmit,r=e.audio&&e.audio.receive,o=v[t]||{},a=_[t]||{},s=A[t]||{};r&&s.audio&&s.audio.receive&&!S.sendOnlyStream&&O(o,L.NO_PACKETS_RECV,!(r.pr>s.audio.receive.pr)||-1,e.startTime,e.audio,s.audio);var c,l=L.GOOG_JITTER_RECEIVED;r&&(h(r,s.audio&&s.audio.receive,L.GOOG_JITTER_RECEIVED.StatName),O(o,l,(c=r[l.StatName])&&c>=l.Threshold?c:-1,e.startTime,e.audio,s.audio)),l=L.PACKET_LOSS_SEND,i&&i.pl&&i.ps&&O(o,l,(n=N(i,s.audio&&s.audio.transmit))>=l.Threshold?n:-1,e.startTime,e.audio,s.audio),l=L.PACKET_LOSS_RECV,r&&r.pl&&r.pr&&O(o,l,(n=m(r,s.audio&&s.audio.receive))>=l.Threshold?n:-1,e.startTime,e.audio,s.audio),e.audio&&I>U.DELAY_RTT_PROCESSING&&(h(e.audio,s.audio,L.GOOG_RTT.StatName),O(o,l=L.GOOG_RTT,e.audio.rtt>=l.Threshold?e.audio.rtt:-1,e.startTime,e.audio,s.audio)),l=L.ECHO_LIKELIHOOD,i&&(h(i,s.audio&&s.audio.transmit,L.ECHO_LIKELIHOOD.StatName),O(o,l,(c=i[l.StatName])&&c>=l.Threshold?c:-1,e.startTime,e.audio,s.audio)),i=e.video&&e.video.transmit,r=e.video&&e.video.receive,l=M.PACKET_LOSS_SEND,i&&i.pl&&i.ps&&O(a,l,(n=N(i,s.video&&s.video.transmit))>=l.Threshold?n:-1,e.startTime,e.video,s.video),l=M.PACKET_LOSS_RECV,r&&r.pl&&r.pr&&O(a,l,(n=m(r,s.video&&s.video.receive))>=l.Threshold?n:-1,e.startTime,e.video,s.video),(i||r)&&I>U.DELAY_RTT_PROCESSING&&(h(e.video,s.video,M.GOOG_RTT.StatName),O(a,l=M.GOOG_RTT,e.video&&e.video.rtt>=l.Threshold?e.video.rtt:-1,e.startTime,e.video,s.video)),e.audio&&e.audio.channelInfo&&(R[t]=e.audio.channelInfo),e.video&&e.video.channelInfo&&(f[t]=e.video.channelInfo),A[t]=e,v[t]=o,_[t]=a;var d=D(o),u=D(a);(d||u)&&(E=!0,p||(u=u||"none",p=!0,(d=d||"none").noPacketsReceived?y.warn("[CallStatsHandler]: processRTPStats - No packets received from remote peer"):(y.warn("[CallStatsHandler]: processRTPStats - Quality issues detected",[{audio:d},{video:u}]),g.onThresholdExceeded&&g.onThresholdExceeded())))}),!E&&p&&(y.debug("[CallStatsHandler]: processRTPStats - No quality issues detected. Clear threshold exceeded error."),p=!1,g.onThresholdExceeded&&g.onThresholdExceeded(!0)),!p&&I%t!=0||A.forEach(function(e,t){!function(e,t){var i,n,r;function o(e){return void 0===e||e<0?"n/a":e}e&&(e.audio||e.video)&&(i="[CallStatsHandler]: statsReport: audioRtt="+(e.audio&&e.audio.rtt||"n/a")+" videoRtt="+((e.video.receive||e.video.transmit)&&e.video&&e.video.rtt||"n/a"),e.audio&&((n=e.audio.receive)&&n.id&&(i+="\n audioReceive:  id="+n.id+" pl="+o(n.pl)+" pr="+o(n.pr)+" or="+o(n.or)+" jr="+o(n.jr)),(n=e.audio.transmit)&&n.id&&(i+="\n audioTransmit: id="+n.id+" pl="+o(n.pl)+" ps="+o(n.ps)+" os="+o(n.os))),e.video&&((n=e.video.receive)&&n.id&&(i+="\n videoReceive:  id="+n.id+" pl="+o(n.pl)+" pr="+o(n.pr)+" or="+o(n.or)+" fwr="+n.fwr+" fhr="+n.fhr+" frd="+n.frd+" frr="+n.frr),(n=e.video.transmit)&&n.id&&(i+="\n videoTransmit: id="+n.id+" pl="+o(n.pl)+" ps="+o(n.ps)+" os="+o(n.os)+" fws="+n.fws+" fhs="+n.fhs+" frs="+n.frs+" abw="+n.abw)),y.debug(i)),t&&t.length&&(i="[CallStatsHandler]: statsReport:\n",t.forEach(function(t,e){i+=0===e?" Audio issues=":"\n Video issues=";var n=Object.keys(t);n.length?(r=!0,n.forEach(function(e){i+=" "+e+"="+t[e].value+" count="+t[e].counter})):i+=" none"}),r&&y.info(i))}(e,[v[t],_[t]])}),I++}}function c(){P.isElectron&&y.debug("[CallStatsHandler]: Get RTP stats for local call(s)"),a().then(function(e){e?(P.isElectron&&y.debug("[CallStatsHandler]: Process RTP stats for local call(s)"),s(e),function(e){if(!e||!e.length)return y.debug("[CallStatsHandler]: processNetworkIndication - No stats for network indication.");C||(C=[],E=b.RTP_QUALITY_HIGH,T=!(d={noPacketsSeq:0,qualityLevelSeq:0}));e.forEach(function(e,t){var n=0,i=0,r=e.audio&&e.audio.transmit,o=e.audio&&e.audio.receive,a=!0,s=!0,c=C[t]||{};!r||isNaN(r.pl)||isNaN(r.ps)||(n=N(r,c.audio&&c.audio.transmit)||0,c.audio&&c.audio.transmit&&c.audio.transmit.ps&&(a=r.ps!==c.audio.transmit.ps),a||y.warn("[CallStatsHandler]: processNetworkIndication - No packets sent to remote peer")),!o||isNaN(o.pl)||isNaN(o.pr)||(i=m(o,c.audio&&c.audio.receive)||0,c.audio&&c.audio.receive&&c.audio.receive.pr&&(s=o.pr!==c.audio.receive.pr),s||S.sendOnlyStream||y.warn("[CallStatsHandler]: processNetworkIndication - No packets received from remote peer"));var l={currentPlSend:n,currentPlReceive:i};a?(d.noPacketsSeq=0,l.qualityLevel=b.getLevel(Math.max(n,i))):(d.noPacketsSeq++,1<d.noPacketsSeq?(l.qualityLevel=b.RTP_QUALITY_LOW,g.onNoOutgoingPackets&&g.onNoOutgoingPackets()):l.qualityLevel=b.RTP_QUALITY_HIGH),function(e){var t=d;t.qualityLevel=e.qualityLevel,t.currentPlSend=e.currentPlSend,t.currentPlReceive=e.currentPlReceive;var n=E;n!==t.qualityLevel.value&&y.debug("[CallStatsHandler]: setQualityEstimation - estimation="+t.qualityLevel.value+" seq="+t.qualityLevelSeq+" current="+n);n<t.qualityLevel.value?(t.qualityLevelSeq++,1<t.qualityLevelSeq&&(E=t.qualityLevel.value,t.qualityLevelSeq=0)):(E=t.qualityLevel.value,t.qualityLevelSeq=0);if(n!==E){var i=1===n&&!T;i&&(t.firstTimeLowQuality=i,T=i),g.onNetworkQuality&&g.onNetworkQuality(t)}}(l),C[t]=e})}(e)):P.isElectron&&y.debug("[CallStatsHandler]: No RTP stats collected")})}function D(n){var i=null;return Object.keys(n).forEach(function(e){var t=n[e];t.counter>=t.statObj.RecurrenceThreshold?t.reported?(delete n[e],y.debug("[CallStatsHandler]: issueCounter cleared=",e)):(t.reported=!0,t.counter=0,(i=i||{})[e]=!0):t.reported&&((i=i||{})[e]=!0)}),i}this.start=function(){n||i?(y.debug("[CallStatsHandler]: Restart collecting RTPStats"),C=E=d=null,T=!1):(y.debug("[CallStatsHandler]: Waiting to start collecting RTPstats"),n=window.setTimeout(function(){y.info("[CallStatsHandler]: Start collecting RTPStats"),n=null,I=0,c(),i=window.setInterval(function(){c()},U.COLLECTION_INTERVAL)},U.DELAY_UPON_ANSWER))},this.stop=function(){return new l(function(t){a(!0).then(function(e){t(e)}),n?(y.debug("[CallStatsHandler]: cancel collecting RTPStats "),window.clearTimeout(n),n=null):i&&(y.debug("[CallStatsHandler]: stop collecting RTPStats"),window.clearInterval(i),C=E=d=i=null,T=!1,A&&y.debug("[CallStatsHandler]: savedRTPStats =",A),g.onThresholdExceeded&&g.onThresholdExceeded(!0),p=!1)})},this.onThresholdExceeded=null,this.onNoOutgoingPackets=null,this.onNetworkQuality=null,this.setOptions=function(e){e&&(S=e)},this.getLastSavedStats=function(){return A},this.getStreamQualityData=function(){return null},this.setTransmitVideoParams=function(){}}return t.overridePromise=function(e){void 0===l&&(l=e)},P.CallStats=d,P.CallStatsHandler=t,P}((Circuit=function(d){"use strict";var u=d.AppMessagingHandlerSingleton,E=d.ChromeExtension,C=d.Constants,T=d.logger,p=d.Utils,S=d.TemasysAdapter,e=function(){var i=u?u.getInstance():null,e={getScreen:function(e,t){t&&t("NOT_SUPPORTED")},setControllingScreen:function(e,t){t&&t("NOT_SUPPORTED")},unregEvtHandlers:function(){},isScreensharingAvailable:function(){return!1},isFirefoxLegacy:function(){return!1},installExtension:function(){},injectExtensionSvc:function(){},injectTemasysSvc:function(){}},t=p.getBrowserInfo();function n(t,n){navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(e){t({mediaStream:e})}).catch(function(e){"NotAllowedError"!==e.name||e.message&&"permission denied by system"===e.message.toLowerCase()?n(e):n(C.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)})}if(d.isElectron)e.getScreen=function(i,r,e){var t=require("electron").ipcRenderer;t.once("screenshare-chooser",function(e,t,n){"share"===t?(T.info("[ScreenSharingController]: Got screen share stream. Stream id: ",n.display.streamId),i&&i({screenIndex:n.display.screenIndex,streamId:n.display.streamId,pointer:n.pointer,screenControlSupported:n.screenControlSupported})):"cancel"===t&&(T.info("[ScreenSharingController]: User canceled screen share"),r&&r(C.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED))}),T.info("[ScreenSharingController]: Request screen in Electron"),t.send("screenshare-chooser","open",e)},e.isScreensharingAvailable=function(){return!0},e.setControllingScreen=function(){require("electron").ipcRenderer.send("screenshare-chooser","setControllingScreen")};else if(d.isVdiApp)e.getScreen=function(t,n){i.sendInternalMessage({method:"showwindow"}),window.setTimeout(function(){chrome.desktopCapture.chooseDesktopMedia(["screen"],null,function(e){i.sendInternalMessage({method:"minimizewindow"}),e?t&&t({streamId:e}):n&&n(C.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)})},0)},e.isScreensharingAvailable=function(){return!0};else if(t.chrome)if(navigator.mediaDevices.getDisplayMedia)e.getScreen=n,e.isScreensharingAvailable=function(){return!0};else{var r,o,a,s=function(e){e&&e===o&&r&&o&&(r.removeEventListener(E.BgTarget.SCREEN_SHARE,o),o=null)},c=function(e,t){return r?(s(o),o=function(e,t,n){var i=n.data;switch(n.suppressLog||T.info("[ScreenSharingController]: Received screenshare event from extension - ",i.type),i.type){case E.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_DONE:T.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA done. Stream Id:",i.streamId),s(o),e&&e({streamId:i.streamId});break;case E.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_CANCELLED:T.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA cancelled"),s(o),t(C.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)}}.bind(null,e,t),r.addEventListener(E.BgTarget.SCREEN_SHARE,o),o):null};e.getScreen=function(e,t){var n=null;return a&&a.isExtensionRunning()?(n=c(e,t),r.getScreenShareUserMedia(function(e){e&&(T.warn("[ScreenSharingController]: Error starting screen share using chrome extension: ",e),s(n),t("res_AccessToExtensionFailed"))})):t("res_AccessToExtensionFailed"),n},e.isScreensharingAvailable=function(){return!!a&&a.isExtensionRunning()},e.installExtension=function(){a&&(T.debug("[ScreenSharingController]: Install Chrome extension"),a.installExtension(!0).then(function(){T.info("[ScreenSharingController]: Chrome extension was successfully installed")}).catch(function(e){T.warn("[ScreenSharingController]: Failed to install Chrome extension. ",e)}))},e.injectExtensionSvc=function(e,t){a=e,r=t},e.unregEvtHandlers=s}else if(t.msie){var l;e.getScreen=function(e,t){S&&S.isScreensharingAvailable()?e&&e():t&&t("NOT_AVAILABLE")},e.isScreensharingAvailable=function(){return!!S&&S.isScreensharingAvailable()},e.installExtension=function(){l&&l.showPopup()},e.injectTemasysSvc=function(e){l=e}}else t.firefox?(navigator.mediaDevices.getDisplayMedia?e.getScreen=n:(e.getScreen=function(e){e&&e()},e.isFirefoxLegacy=function(){return!0}),e.isScreensharingAvailable=function(){return!0}):"Android"!==window.navigator.platform&&"iOS"!==window.navigator.platform||(e.getScreen=function(e){e&&e()},e.isScreensharingAvailable=function(){return!0});return e}();return d.ScreenSharingController=e,d}((Circuit=function(w){"use strict";var G=w.logger,e=w.BaseCall,H=w.Enums.CallState,k=w.Constants,t=w.Enums.CstaCallState,V=w.Constants.IncomingVideoContentType,n=w.Enums.ParticipantState,F=w.Constants.RealtimeMediaType,B=w.Utils,i=Object.freeze({SERVER_ENDED_PRFX:"SERVER_ENDED:"}),r=Object.freeze({CLIENT_ENDED_PRFX:"CLIENT_ENDED:",ANOTHER_CLIENT_ANSWERED:"ANOTHER_CLIENT_ANSWERED",ANOTHER_CLIENT_REJECTED:"ANOTHER_CLIENT_REJECTED",ANOTHER_CLIENT_PULLED_CALL:"ANOTHER_CLIENT_PULLED_CALL",CALL_MOVED_TO_ANOTHER_CONV:"CALL_MOVED_TO_ANOTHER_CONV",CALLER_LEFT_CONFERENCE:"CALLER_LEFT_CONFERENCE",ENDED_BY_ANOTHER_USER:"ENDED_BY_ANOTHER_USER",LOST_WEBSOCKET_CONNECTION:"LOST_WEBSOCKET_CONNECTION",NO_USERS_LEFT:"NO_USERS_LEFT",REQUEST_TO_SERVER_FAILED:"REQUEST_TO_SERVER_FAILED",RTC_SESSION_START_FAILED:"RTC_SESSION_START_FAILED",SET_REMOTE_SDP_FAILED:"SET_REMOTE_SDP_FAILED",USER_ENDED:"USER_ENDED",LOST_MEDIA_STREAM:"LOST_MEDIA_STREAM",ICE_TIMED_OUT:"ICE_TIMED_OUT",USER_LOGGED_OUT:"USER_LOGGED_OUT",PAGE_UNLOADED:"PAGE_UNLOADED",DISCONNECTED:"WS_DISCONNECTED",FAILED_TO_SEND:"WS_FAILED_TO_SEND",REQUEST_TIMEOUT:"WS_REQUEST_TIMEOUT",MEDIA_RENEGOTIATION:"MEDIA_RENEGOTIATION"}),x=B.isMobile();function W(e,t){var o=w.WebRTCAdapter;t=t||{};var a=w.RtcSessionController;if(!e||!e.rtcSessionId)throw new Error("Cannot create LocalCall object without a valid conversation");W.parent.constructor.call(this,e,!1);var s=this,r=null,n=!1,i=null,c=!1,l=!1,d=!1,u=!1,E=!1,C=!1,T=!1,p=!1,S=null,I=null,A=null,R=null,f=!1,v=[],_=[],g=[],N="",m="",h=!1,O={},D=null;function P(){r?(G.debug("[LocalCall]: RtcSessionController - onMediaUpdate: callId =",s.callId),s.activeMediaType=r.getActiveMediaType(),G.debug("[LocalCall]: Set active media type to ",s.activeMediaType),s.localMediaType=r.getMediaConstraints(),G.debug("[LocalCall]: Set local media type to ",s.localMediaType),s.updateMediaType(),s.updateCallState(),L(F.VIDEO),L(F.DESKTOP_SHARING)):G.debug("[LocalCall]: session controller not available - onMediaUpdate: callId =",s.callId)}function y(e){G.debug("[LocalCall]: RtcSessionController - onLocalVideoStream: callId =",s.callId),s.localVideoStream=e.stream,s.localStreams.desktop=e.desktopStream,s.localStreams.video=e.videoStream,N="",G.debug("[LocalCall]: Set local video stream to ",e.videoStream&&e.videoStream.id||"<null>"),G.debug("[LocalCall]: Set local desktop stream to ",e.desktopStream&&e.desktopStream.id||"<null>")}function b(e){G.debug("[LocalCall]: RtcSessionController - onScreenSharePointerStatus",e),s.pointer={isSupported:e.isSupported,isEnabled:e.isEnabled}}function U(e){G.debug("[LocalCall]: RtcSessionController - onRemoteStreams: callId =",s.callId),s.remoteAudioStream=e.audio&&e.audio.stream||null,m="",G.debug("[LocalCall]: Set remote audio stream to",s.remoteAudioStream&&s.remoteAudioStream.id||"<empty>"),s.remoteVideoStreams=e.video||[],G.debug("[LocalCall]: Set remote video streams to",e.video||"<empty>"),s.participants.forEach(function(e){s.setParticipantRemoteVideoStream(e)}),s.checkForActiveRemoteVideo()}function L(e){var t=r.getAvailableVideoReceivers(e),n=[],i=O[e]||[];t.forEach(function(t){var e=i.find(function(e){return e.id===t.id});e||((e=t).pinnedUser=null,e.quality=k.VideoQuality.NORMAL,e.disabled=!1),n.push(e)}),O[e]=n,G.debug("[LocalCall] Updated video receiver configuration for media type "+e+" is ",n)}function M(){var n=[];return Object.keys(O).forEach(function(e){var t=O[e];t&&((d||e===F.VIDEO&&u)&&(t=JSON.parse(JSON.stringify(t))).forEach(function(e){e.disabled=!0}),Array.prototype.push.apply(n,t))}),n}Object.defineProperties(this,{sessionCtrl:{get:function(){return r},enumerable:!0,configurable:!1},isVdi:{get:function(){return!(!r||!r.isRemoteController)},enumerable:!0,configurable:!1},locallyMuted:{get:function(){return!(!r||!r.isMuted())},enumerable:!0,configurable:!1},remoteVideoDisabled:{get:function(){return d},enumerable:!0,configurable:!1},remoteVideoScreenOnlyAllowed:{get:function(){return u},enumerable:!0,configurable:!1},remoteAudioDisabled:{get:function(){return E},enumerable:!0,configurable:!1},isMocked:{get:function(){return T},enumerable:!0,configurable:!1},isMeetingPointInvited:{get:function(){return p},enumerable:!0,configurable:!1},hasActiveRemoteScreenShareOnly:{get:function(){return l},enumerable:!0,configurable:!1},ringAllAllowed:{get:function(){return!!(this.peerUsers&&0<this.peerUsers.length&&this.peerUsers.length<=9)},enumerable:!0,configurable:!1},ringAllMaxNumber:{get:function(){return 9},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return h||this.state===H.Ringing},set:function(e){h=e},enumerable:!0,configurable:!1},curtain:{get:function(){return S||{}},set:function(e){!function(e){e&&e.curtainState&&(S&&(e.lastCurtainState=S.curtainState),(S=e).curtainClosed=e.curtainState!==k.CurtainState.OPEN)}(e)},enumerable:!0,configurable:!1},playbackDevice:{get:function(){return I},enumerable:!0,configurable:!1},recordingDevice:{get:function(){return A},enumerable:!0,configurable:!1},videoDevice:{get:function(){return R},enumerable:!0,configurable:!1},playbackDeviceList:{get:function(){return v},enumerable:!0,configurable:!1},recordingDeviceList:{get:function(){return _},enumerable:!0,configurable:!1},videoDeviceList:{get:function(){return g},enumerable:!0,configurable:!1},atcAdvancing:{get:function(){return f},set:function(e){f=!!e},enumerable:!0,configurable:!1},savedRTPStats:{get:function(){if(this.sessionCtrl){var i=this.sessionCtrl.getLastSavedStats();if(o.unifiedPlanEnabled&&i){var r={};return Object.keys(i).forEach(function(e){var t=i[e],n=t.media;n&&(r[n]||(r[n]={}),r[n][e]=t)}),r}return i}return null},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return!(!this.checkState([H.Active,H.Delivered])&&!this.isOsBizFirstCall)&&(!(this.sessionCtrl&&!this.sessionCtrl.canSendDTMFDigits())||!!this.checkState(H.Active)&&!!this.atcCallInfo)},enumerable:!0,configurable:!1},networkQuality:{get:function(){return D},set:function(e){G.debug("[LocalCall]: Network quality level set to: ",e),D=e},enumerable:!0,configurable:!1}}),x&&Object.defineProperties(this,{localVideoUrl:{get:function(){return N=s.localVideoStream?N||o.createObjectURL(s.localVideoStream):""},enumerable:!0,configurable:!1},remoteAudioUrl:{get:function(){return m=s.remoteAudioStream?m||o.createObjectURL(s.remoteAudioStream):""},enumerable:!0,configurable:!1},remoteVideoUrlStreams:{get:function(){return s.remoteVideoStreams.map(function(e){return e.url||(e.url=o.createObjectURL(e.stream)),{streamId:e.streamId,url:e.url}})},enumerable:!0,configurable:!1}}),this.localVideoStream=null,this.localStreams={},this.remoteAudioStream=null,this.remoteVideoStreams=[],this.activeMediaType={audio:!1,video:!1,desktop:!1},this.ringingTimeout=15e3,this.whiteboardEnabled=!1,this.whiteboard=null,this.screenEnabledFeature=null,this.previousScreenFeaturesState={ToggleWhiteboard:!1,ToggleScreenShare:!1,ToggleConferencePoll:!1},this.pollEnabled=!1,this.poll=null,this.pointer={isSupported:!1,isEnabled:!1},this.screenControllerId=null,this.screenOwnerId=null,this.screenOwner=null,this.screenController=null,this.preventScreenControlRequestInConf=!1,this.badQualityNotification={detected:!1,acted:!1,dismissed:!1},this.clientId=t.clientId,this.isOsBizFirstCall=!1,this.isOsBizSecondCall=!1,this.raiseHandState={},this.holdInProgress=!1,this.retrieveInProgress=!1,this.isSTC=t.isSTC,this.stcCapabilities=t.stcCapabilities,this.terminate=function(){n||(G.debug("[LocalCall]: Terminating call with callId =",this.callId),this.isOsBizSecondCall?r=null:r&&(r&&(r.onMediaUpdate=null,r.onLocalVideo=null,r.onRemoteStreams=null,r.onScreenSharePointerStatus=null),r.terminate()),m=N="",this.localVideoStream=null,this.localStreams={},this.remoteAudioStream=null,this.remoteVideoStreams=[],W.prototype.terminate.call(this),this.stopRingingTimer(),n=!0)},this.setMockedCall=function(){G.debug("[LocalCall]: Setting call as mocked"),T=!0,r&&r.setMockedCall(),this.participants.forEach(function(e){e.streamId=e.mediaType.video?"mock":"",e.screenStreamId=e.mediaType.desktop?"mock":""}),window.setTimeout(function(){this.state!==H.Terminated&&(G.debug("[LocalCall]: Initialize remote mocked streams"),U({audio:null,video:[{streamId:"mock",stream:"content/images/mock/trailer.mp4"}]}),r&&(r.onRemoteStreams=null))},100)},this.startRingingTimer=function(e){"function"==typeof e&&(G.info("[LocalCall]: Starting ringing timer for callId =",s.callId),i=window.setTimeout(function(){G.info("[LocalCall]: Ringing timeout for callId =",s.callId),i=null,e()},this.ringingTimeout))},this.stopRingingTimer=function(){i&&(G.info("[LocalCall]: Cancelling ringing timer for callId =",s.callId),window.clearTimeout(i),i=null)},this.hasRemoteVideo=function(){return c},this.checkForActiveRemoteVideo=function(){l=d?c=!1:!!(c=this.participants.some(function(e){return!!e.videoStream}))&&!this.participants.some(function(e){return e.mediaType.video}),G.debug("[LocalCall]: Set hasActiveRemoteVideo to ",c)},this.enableRemoteVideoScreenOnly=function(){return d?null:(u=!0,this.checkForActiveRemoteVideo(),this.participants.forEach(function(e){e.videoStream=null,e.streams={},s.isDirect&&(e.streamId="")}),this.sessionCtrl&&this.sessionCtrl.enableRemoteVideoScreenOnly(),G.debug("[LocalCall]: Enabled receiving remote screen share only"),M())},this.disableRemoteVideoScreenOnly=function(){return u=!1,this.sessionCtrl&&this.sessionCtrl.disableRemoteVideoScreenOnly(),G.debug("[LocalCall]: Disabled receiving remote screen share only"),M()},this.enableRemoteVideo=function(){return d||u?(d=!1,this.disableRemoteVideoScreenOnly(),this.checkForActiveRemoteVideo(),this.sessionCtrl&&this.sessionCtrl.enableRemoteVideo(),G.debug("[LocalCall]: Enabled remote video"),M()):null},this.disableRemoteVideo=function(){return d?null:(c=!(d=!0),this.disableRemoteVideoScreenOnly(),this.participants.forEach(function(e){e.videoStream=null,e.streams={},s.isDirect&&(e.streamId="")}),this.sessionCtrl&&this.sessionCtrl.disableRemoteVideo(),G.debug("[LocalCall]: Disabled remote video"),M())},this.enableRemoteAudio=function(){E&&(E=!1,G.debug("[LocalCall]: Enabled remote audio."))},this.disableRemoteAudio=function(){E||(E=!0,G.debug("[LocalCall]: Disabled remote audio."))},this.setMeetingPointInviteState=function(e){p=!!e,G.debug("[LocalCall]: Set Circuit Meeting Point state to ",e)},this.setHasUnmutedParticipants=function(){C=this.participants.some(function(e){return!e.muted})},this.hasUnmutedParticipants=function(){return C},this.getUnmutedParticipantIds=function(){var t=[];return this.participants.forEach(function(e){e.muted||t.push(e.userId)}),t},this.getMediaNode=function(){return this.isTestCall?a.mediaNode:null},this.updateMediaDevices=function(){function r(e){return e?e.filter(function(e){return"default"!==e.id&&"communications"!==e.id&&e.label}).map(function(e){return e.label}):[]}o.getMediaSources(function(e,t,n){if(o.getMediaSourcesSupported){var i=B.selectMediaDevice(n,a.playbackDevices);I=i&&i.label,v=r(n),i=B.selectMediaDevice(e,a.recordingDevices),A=i&&i.label,_=r(e),i=B.selectMediaDevice(t,a.videoDevices),R=i&&i.label,g=r(t)}else I=Audio.getPlaybackDevice&&Audio.getPlaybackDevice(),A=Audio.getRecordingDevice&&Audio.getRecordingDevice(),R=Audio.getVideoDevice&&Audio.getVideoDevice();G.debug("[LocalCall]: Updated media devices ",{callId:s.callId,recording:A,playback:I,video:R})})},this.setIncomingVideoStreams=function(e){var t=O[F.VIDEO],n=O[F.DESKTOP_SHARING],r=[],o=[],a=!1,i=!0;return e?e.forEach(function(e){switch(e.contentType){case V.VIDEO:var t,n=e.userId,i=n&&s.participants.find(function(e){return e.userId===n});i&&i.streams.video&&(t=i.streams.video.mid,r.push(t)),o.push({id:t,quality:e.quality||k.VideoQuality.NORMAL,pinnedUser:n||null});break;case V.SCREEN:a=!0}}):a=!(i=!1),t&&(t.forEach(function(e){e.pinnedUser=null,e.quality=k.VideoQuality.NORMAL,e.disabled=i}),o.forEach(function(n){var i=n.id;t.some(function(e){var t=e.id;return!!(i&&t===i||!i&&-1===r.indexOf(t))&&(e.pinnedUser=n.pinnedUser,e.quality=n.quality,e.disabled=!1,i||r.push(t),!0)})})),n&&n.forEach(function(e){e.quality=k.VideoQuality.NORMAL,e.disabled=!a}),M()},this.supportsVideoReceiverConfiguration=function(){return!s.isDirect&&!(s.isLarge&&(t.isSessionGuest||s.isGuestInvite))&&o.unifiedPlanEnabled},r||(t.reuseSessionCtrl?r=t.reuseSessionCtrl:((r=new a({callId:s.callId,isDirectCall:s.isDirect,isTelephonyCall:s.isTelephonyCall,isLargeConference:s.isLarge,isAtcPullCall:t.isAtcPullCall,reuseDesktopStreamFrom:t.reuseDesktopStreamFrom,isSessionGuest:t.isSessionGuest||s.isGuestInvite,midMappingEnabled:t.midMappingEnabled,canReceiveHdVideo:t.canReceiveHdVideo,supportsVideoReceiverConfiguration:s.supportsVideoReceiverConfiguration()})).onMediaUpdate=P,r.onLocalVideoStream=y,r.onRemoteStreams=U,r.onScreenSharePointerStatus=b)),e=null,s.updateMediaDevices(),G.info("[LocalCall]: Created new WebRTC call with callID = ",this.callId)}function o(e,t){t.streamId="",t.screenStreamId="",t.mediaType.desktop&&(t.screenStreamId="mock"),t.mediaType.video&&(t.streamId="mock")}return B.inherit(W,e),W.prototype.hasRemoteMedia=function(){return!(!this.remoteAudioStream&&!this.remoteVideoStreams.length)},W.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.remoteVideoDisabled&&(!this.localMediaType.desktop||this.isDirect&&this.participants[0].mediaType.desktop)},W.prototype.addParticipant=function(e){this.isMocked&&e&&e.mediaType&&o(0,e);var t=W.parent.addParticipant.apply(this,arguments);return t&&(this.setParticipantRemoteVideoStream(t),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),t},W.prototype.updateParticipant=function(e){this.isMocked&&e&&e.mediaType&&o(0,e);var t=W.parent.updateParticipant.apply(this,arguments);return t&&(this.setParticipantRemoteVideoStream(t),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),t},W.prototype.removeParticipant=function(){var e=W.parent.removeParticipant.apply(this,arguments);return e&&(this.setHasUnmutedParticipants(),this.checkForActiveRemoteVideo()),e},W.prototype.setParticipantRemoteVideoStream=function(t){if(t.videoStream=null,t.streams={},this.isDirect&&(t.streamId=""),!this.remoteVideoDisabled)if(!t.mediaType||t.mediaType.video||t.mediaType.desktop){if(this.isDirect){if(this.remoteVideoStreams&&this.remoteVideoStreams.length){var e=this.remoteVideoStreams[this.remoteVideoStreams.length-1];t.streamId=e.streamId,t.videoStream=e.stream}}else{if(!t.streamId&&!t.screenStreamId)return void G.info("[LocalCall]: The participant does not have a video streamId. userId = ",t.userId);this.remoteVideoStreams&&this.remoteVideoStreams.length&&(this.remoteVideoStreams.forEach(function(e){e.streamId===t.streamId?t.streams.video=e.stream:e.streamId===t.screenStreamId&&(t.streams.desktop=e.stream)}),t.videoStream=t.streams.desktop||t.streams.video||null)}t.videoStream?(t.pcState=t.muted?n.Muted:n.Active,G.debug("[LocalCall]: Set remote video stream for participant: ",t)):G.debug("[LocalCall]: We still do not have a video stream for the participant. ",t)}else G.debug("[LocalCall]: The participant does not have video or screen-share. Do not set video stream. userId = ",t.userId)},W.prototype.hasLocalScreenShare=function(){return this.sessionCtrl&&this.sessionCtrl.hasScreenShare()},W.prototype.isMuted=function(){return this.remotelyMuted||this.locallyMuted},W.prototype.mute=function(e){return this.checkState(H.Terminated)?(G.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(G.debug("[LocalCall]: Mute call with callId =",this.callId),this.sessionCtrl&&this.sessionCtrl.mute(e))},W.prototype.unmute=function(e){return this.checkState(H.Terminated)?(G.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(G.debug("[LocalCall]: Unmute call with callId =",this.callId),this.sessionCtrl&&this.sessionCtrl.unmute(e))},W.prototype.isLocalMuteAllowed=function(){return this.sessionCtrl&&this.sessionCtrl.isLocalMuteAllowed()},W.prototype.toggleMute=function(){return this.sessionCtrl&&this.sessionCtrl.isMuted()?this.unmute():this.mute()},W.prototype.setActiveSpeakers=function(n){if(!n)return!1;n instanceof Array||(n=[n]);var i=!1;return this.participants.forEach(function(e){var t=-1!==n.indexOf(e.userId);e.activeSpeaker!==t&&(e.activeSpeaker=t,i=!0)}),i},W.prototype.updateCallState=function(){var e;this.state.established&&this.sessionCtrl&&(e=!this.sessionCtrl.isConnected()||!this.isDirect&&!this.hasOtherParticipants()||this.isATCCall&&!this.getCstaState().established&&!this.checkCstaState(t.Initiated)?H.Waiting:this.sessionCtrl.isHolding()||this.checkCstaState(t.Holding)?H.Holding:this.sessionCtrl.isHeld()?H.Held:H.Active,this.setState(e))},W.prototype.isHolding=function(){return this.atcCallInfo?W.parent.isHolding.apply(this,arguments):this.checkState([H.Holding,H.HoldOnHold])},W.prototype.isConsultAllowed=function(){return!this.atcCallInfo||this.atcCallInfo.isConsultAllowed()},W.prototype.isHoldInProgress=function(){return this.atcCallInfo?this.atcCallInfo.isHoldInProgress():this.holdInProgress},W.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress(),this.holdInProgress=!0},W.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress(),this.holdInProgress=!1},W.prototype.isRetrieveInProgress=function(){return this.atcCallInfo?this.atcCallInfo.isRetrieveInProgress():this.retrieveInProgress},W.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress(),this.retrieveInProgress=!0},W.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress(),this.retrieveInProgress=!1},W.prototype.isTransferCallAllowed=function(){return this.atcCallInfo?this.atcCallInfo.isTransferCallAllowed():!!this.stcCapabilities&&this.stcCapabilities.includes(k.StcCapabilities.STC_TRANSFER)&&this.checkState([H.Active,H.Delivered])},W.prototype.isTransferAllowed=function(){return this.atcCallInfo?this.atcCallInfo.isTransferAllowed():!!this.stcCapabilities&&this.stcCapabilities.includes(k.StcCapabilities.STC_TRANSFER)&&this.state.established&&!this.isDirectUpgradedToConf},W.prototype.isConferenceCallAllowed=function(){return this.atcCallInfo?this.atcCallInfo.isConferenceCallAllowed():!!this.stcCapabilities&&this.stcCapabilities.includes(k.StcCapabilities.STC_MERGE)&&this.state.established},w.LocalCall=W,w.Enums.CallServerTerminatedReason=i,w.Enums.CallClientTerminatedReason=r,w}((Circuit=function(e){"use strict";var t=Object.freeze({Disconnected:"Disconnected",Unregistered:"Unregistered",Registering:"Registering",Registered:"Registered",ForcedUnregistered:"ForcedUnregistered"});return e.Enums=e.Enums||{},e.Enums.AtcRegistrationState=t,e}((Circuit=function(e){"use strict";var t=e.BaseCall,n=e.Enums.CallState,i=e.Proto;function r(e){var t=Circuit.logger;if(!e||!e.rtcSessionId)throw new Error("Cannot create RemoteCall object without a valid conversation");r.parent.constructor.call(this,e,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return!this.pullNotAllowed&&this.state===n.ActiveRemote&&!this.pullBlocked},enumerable:!0,configurable:!1}}),e=this.activeClient=null,this.isTelephonyCall&&(this.peerUser.displayName=""),t.info("[RemoteCall]: Created new remote call with callID = ",this.callId)}return e.Utils.inherit(r,t),r.prototype.setActiveClient=function(e){e&&(e.userId?(this.activeClient={clientId:e.clientId,clientDisplayName:e.clientDisplayName,mediaType:i.getMediaType(e.mediaTypes)},this.pullNotAllowed=!1===e.pullCall):this.activeClient=e)},e.RemoteCall=r,e}((Circuit=function(e){"use strict";var R=e.Constants,f=e.Enums.CstaCallState,v=e.DefaultAvatars,_=e.logger,i=e.Enums.ParticipantState,t=e.RtcParticipant,g=e.UserProfile,N=e.Utils,m=Object.freeze({INCOMING:"incoming",OUTGOING:"outgoing",NONE:""}),h=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",ui:"res_Calling",established:!1,css:"outgoing"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},Delivered:{name:"Delivered",ui:"res_Calling",established:!1,css:"outgoing"},Busy:{name:"Busy",ui:"res_BusyCall",established:!1,css:"busy"},Failed:{name:"Failed",ui:"res_FailedCall",established:!1,css:"failed"},Declined:{name:"Declined",ui:"res_CallDeclined",established:!1,css:"declined"},NotAnswered:{name:"NotAnswered",ui:"res_CallNotAnswered",established:!1,css:"not-answered"},Ringing:{name:"Ringing",ui:"res_IncomingCall",established:!1,css:"incoming"},Answering:{name:"Answering",ui:"res_IncomingCall",established:!1,css:"answering"},Active:{name:"Active",ui:"",established:!0,css:"active-call"},Held:{name:"Held",ui:"res_OnHold",established:!0,css:"active-call"},Holding:{name:"Holding",ui:"res_Holding",established:!0,css:"holding-call"},HoldOnHold:{name:"HoldOnHold",ui:"res_Holding",established:!0,css:"holding-call"},Waiting:{name:"Waiting",ui:"res_Waiting",established:!0,css:"waiting"},Started:{name:"Started",ui:"res_InProgress",established:!1,css:"started"},NotStarted:{name:"NotStarted",ui:"",established:!1,css:"not-started"},ActiveRemote:{name:"ActiveRemote",ui:"res_RemoteCall",established:!0,css:"active-call-remote"},Terminated:{name:"Terminated",ui:"res_Terminated",established:!1,css:"declined"}}),n={ToggleWhiteboard:{name:"ToggleWhiteboard",type:"screenEnabledFeature",localize:"res_Whiteboard"},ToggleScreenShare:{name:"ToggleScreenShare",type:"screenEnabledFeature",localize:"res_Screenshare"},ToggleConferencePoll:{name:"ToggleConferencePoll",type:"screenEnabledFeature",localize:"res_Poll"},ToggleVideo:{name:"ToggleVideo",type:"screenEnabledFeature",localize:"res_Video"},SwapDisplays:{name:"SwapDisplays",type:"displays",icon:"",localize:"res_SwapDisplays"}},r=[n.ToggleScreenShare.name,n.ToggleWhiteboard.name,n.ToggleConferencePoll.name];function o(e,n){if(!e)throw new Error("Cannot create BaseCall object without a conversation");n=!!n;var t=this,i=null,r=null,o=null,a=null,s=null,c=null,l=null,d=null,u=!1,E=!1,C=!1,T=!1,p=h.Idle,S=null,I=!1;function A(e){i=e.rtcSessionId,o=e.convId,a=e.type,s=e.topic||e.participantFirstNames||null,c=e.topicEscaped||e.participantFirstNamesEscaped||null,l=e.creatorId,u=e.type===R.ConversationType.DIRECT,E=e.type===R.ConversationType.LARGE,C=!!e.isTelephonyConv,T=!!e.testCall,u?t.peerUser=e.peerUser:delete t.peerUser,t.peerUsers=e.peerUsers,t.numConvParticipants=e.participants.length,t.defaultAvatarColor=e.defaultAvatarColor,t.avatar=e.avatar,t.isGuestInvite=!!e.isTemporary}Object.defineProperties(this,{isRemote:{value:n,writable:!1,enumerable:!0,configurable:!1},callId:{get:function(){return i},enumerable:!0,configurable:!1},cstaCallId:{get:function(){return this.atcCallInfo?this.atcCallInfo.getCstaCallId():null},enumerable:!0,configurable:!1},instanceId:{get:function(){return r},enumerable:!0,configurable:!1},transactionId:{get:function(){return d},enumerable:!0,configurable:!1},state:{get:function(){return p},enumerable:!0,configurable:!1},convId:{get:function(){return o},enumerable:!0,configurable:!1},convType:{get:function(){return a},enumerable:!0,configurable:!1},convTitle:{get:function(){return s||(u?this.peerUser.displayName:"")},enumerable:!0,configurable:!1},convTitleEscaped:{get:function(){return c||(u?this.peerUser.displayNameEscaped:"")},enumerable:!0,configurable:!1},containsExternals:{get:function(){return this.participants.some(function(e){return e.participantType===R.RTCParticipantType.SESSION_GUEST||e.participantType===R.RTCParticipantType.EXTERNAL})},enumerable:!1,configurable:!1},ownerId:{get:function(){return l},enumerable:!0,configurable:!1},isDirect:{get:function(){return u&&!I||C},enumerable:!0,configurable:!1},isLarge:{get:function(){return E},enumerable:!0,configurable:!1},conferenceCall:{get:function(){return!u||I},enumerable:!0,configurable:!1},isGroupCallStarted:{get:function(){return!(this.isDirect||this.state!==h.Started)},enumerable:!0,configurable:!1},isGroupCallInitiated:{get:function(){return!(this.isDirect||this.state!==h.Initiated)},enumerable:!0,configurable:!1},isGroupCallActive:{get:function(){return!(this.isDirect||this.state!==h.Active)},enumerable:!0,configurable:!1},isTelephonyCall:{get:function(){return C},enumerable:!0,configurable:!1},isTestCall:{get:function(){return T},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return!0},enumerable:!0,configurable:!0},isPullAllowed:{value:!1,enumerable:!0,configurable:!0},isHandoverAllowed:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverAllowed()},enumerable:!0,configurable:!0},isHandoverInProgress:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverInProgress()},enumerable:!0,configurable:!0},redirectingUser:{get:function(){return this.getRedirectingUser()},enumerable:!0,configurable:!0},forwarded:{get:function(){return this.isForwarded()},enumerable:!0,configurable:!0},pickupNotification:{get:function(){return this.isPickupNotification()},enumerable:!0,configurable:!0},pickedUp:{get:function(){return this.isPickedUp()},enumerable:!0,configurable:!0},disconnectCause:{get:function(){return S},set:function(e){S=e},enumerable:!0,configurable:!1},transferCallFailedCause:{get:function(){return this.atcCallInfo?this.atcCallInfo.getTransferCallFailedCause():null},enumerable:!0,configurable:!1},isOutgoingCallCampedOn:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isOutgoingCallCampedOn()},enumerable:!0,configurable:!0},isATCCall:{get:function(){return!!this.atcCallInfo},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return!1},enumerable:!0,configurable:!0},isDirectUpgradedToConf:{get:function(){return I},enumerable:!0,configurable:!1}}),this.localMediaType={audio:!1,video:!1,desktop:!1},this.mediaType={audio:!1,video:!1,desktop:!1},this.lastMediaType=this.mediaType,this.direction=m.NONE,this.secureCall=!1,this.establishedTime=0,this.creationTime=Date.now(),this.peerUsers=null,this.peerUser=null,this.numConvParticipants=0,this.avatar=null,this.activeNotification=null,this.activeRTPStatsWarning=null,this.participants=[],this.participantsHashTable={},this.attendeeCount=0,this.remotelyMuted=!1,this.sessionMuted=!1,this.sessionLocked=!1,this.recording={state:R.RecordingInfoState.INITIAL,notifyByCurtain:!1,notifyByUser:!1,duration:0,starter:{userId:""},reason:R.RecordingInfoReason.NONE,resumeTime:0,wasStarted:function(){return this.state!==R.RecordingInfoState.INITIAL},isActive:function(){return this.state===R.RecordingInfoState.STARTED||this.state===R.RecordingInfoState.START_PENDING},isPaused:function(){return this.state===R.RecordingInfoState.START_PENDING},isFailed:function(){return this.reason!==R.RecordingInfoReason.NONE&&this.reason!==R.RecordingInfoReason.STOPPED_MANUALLY&&this.reason!==R.RecordingInfoReason.STOPPED_AUTOMATICALLY&&(this.state===R.RecordingInfoState.INITIAL||this.state===R.RecordingInfoState.STOPPED)}},this.transcription={state:R.RecordingInfoState.INITIAL,wasStarted:function(){return this.state!==R.RecordingInfoState.INITIAL},isActive:function(){return this.state===R.RecordingInfoState.STARTED||this.state===R.RecordingInfoState.START_PENDING}},this.upgradeToConfSupported=!1,this.screenControlSupported=!1,this.setState=function(e,t){!n&&e!==h.Terminated&&this.checkCstaState(f.Holding)&&(e=h.Holding),e&&e!==p&&(p!==h.Terminated?(_.debug("[BaseCall]: Changing call state from "+p.name+" to "+e.name),this.establishedTime||!e.established||this.atcCallInfo&&!this.atcCallInfo.cstaState.established&&this.atcCallInfo.cstaState!==f.Initiated||(this.establishedTime=Date.now()),p=e,this.isTelephonyCall&&(this.avatar=e===h.Holding?v.TELEPHONY_HOLD:v.TELEPHONY),p!==h.Terminated||t||this.terminate()):_.error("[BaseCall]: The call has already been terminated. Cannot set state to ",e.name))},this.checkState=function(e){return Array.isArray(e)?e.some(function(e){return e===p}):e===p},this.updateCall=function(e){return!!e&&(A(e),this.participants.forEach(function(t){t.isMeetingGuest&&!t.isSessionGuest&&(t.isMeetingGuest=e.participants.every(function(e){return e.userId!==t.userId}))}),!0)},this.setPeerUser=function(e,t,n,i){(this.peerUser.hasTelephonyRole||!this.peerUser.userId||n&&n!==this.peerUser.userId||N.cleanPhoneNumber(e)!==N.cleanPhoneNumber(this.peerUser.phoneNumber))&&(this.peerUser={userId:n||"",firstName:null,lastName:null,displayName:t,phoneNumber:e,fqnLookedUp:i},g&&g.extend&&(this.peerUser=g.extend(this.peerUser)),c=(s=t||e||null)?N.textToHtmlEscaped(s):null)},this.setTransactionId=function(e){d=e||N.createTransactionId()},this.clearTransactionId=function(){d=null},this.setInstanceId=function(e){r=e},this.setCallIdForTelephony=function(e){t.isTelephonyCall&&e&&e!==i&&(_.debug("[BaseCall]: Changing callId from "+i+" to "+e),i=e)},this.setDirectUpgradedToConf=function(){u&&(I=!0)},this.clearDirectUpgradedToConf=function(){u&&(I=!1)},A(e),e=null}function a(e,t){var n=e.rtcSupportedFeatures||[];t.isDirect&&(n.includes(R.RtcSupportedFeatures.UPGRADE_TO_CONFERENCE)?(_.debug("[BaseCall]: Upgrade to conference is supported by peer client"),t.upgradeToConfSupported=!0):(_.debug("[BaseCall]: Upgrade to conference is not supported by peer client"),t.upgradeToConfSupported=!1)),e.mediaType&&e.mediaType.desktop&&(n.includes(R.RtcSupportedFeatures.SCREEN_CONTROL)?(_.debug("[BaseCall]: Screen control supported by presenter"),t.screenControlSupported=!0):(_.debug("[BaseCall]: Screen control not supported by presenter"),t.screenControlSupported=!1))}return o.prototype.sameAs=function(e){return!!e&&this.callId===e.callId&&this.isRemote===e.isRemote},o.prototype.terminate=function(){_.debug("[BaseCall]: Terminating call with callId = ",this.callId),this.lastMediaType=this.mediaType,this.mediaType={audio:!1,video:!1,desktop:!1},this.setState(h.Terminated,!0)},o.prototype.isEstablished=function(){return this.state.established},o.prototype.isOutgoingState=function(){return this.state===h.Initiated||this.state===h.Connecting||this.state===h.Delivered||this.state===h.Busy},o.prototype.isPresent=function(){return this.state!==h.Idle&&this.state!==h.Terminated},o.prototype.isHeld=function(){return this.state===h.Held},o.prototype.hasRemoteMedia=function(){return!1},o.prototype.isCallingOut=function(){return this.state===h.Waiting&&0<this.participants.length&&this.participants.every(function(e){return e.pcState===i.Initiated})},o.prototype.hasVideo=function(){return!(!this.mediaType.video&&!this.mediaType.desktop)},o.prototype.updateSecurityStatus=function(e){!0!==e&&!1!==e||(this.secureCall=e)},o.prototype.canToggleVideo=function(){return!this.isRemote&&this.checkState([h.Active,h.Waiting])},o.prototype.hasRemoteVideo=function(){return!1},o.prototype.hasLocalVideo=function(){return this.localMediaType.video||this.localMediaType.desktop},o.prototype.hasLocalScreenShare=function(){return this.localMediaType.desktop},o.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.localMediaType.desktop},o.prototype.isMuted=function(){return!1},o.prototype.mute=function(){return _.warning("[BaseCall]: Mute is not implemented in base object"),!1},o.prototype.unmute=function(){return _.warning("[BaseCall]: Unmute is not implemented in base object"),!1},o.prototype.toggleMute=function(){return _.warning("[BaseCall]: toggleMute is not implemented in base object"),!1},o.prototype.outgoingFailed=function(){return!this.isRemote&&this.direction===m.OUTGOING&&this.checkState([h.Declined,h.Busy,h.NotAnswered,h.Failed])},o.prototype.setPeerUsersAsParticipants=function(){if(this.direction===m.OUTGOING&&this.peerUsers){this.participants=this.peerUsers.map(function(e){return t.createFromUser(e,i.Initiated)});for(var e=0;e<this.participants.length;e++)this.participantsHashTable[this.participants[e].userId]=this.participants[e];_.debug("[BaseCall]: Initialized participants: ",this.participants)}},o.prototype.hasParticipant=function(t){return this.participants.some(function(e){return e.userId===t})},o.prototype.getParticipant=function(e){for(var t=0;t<this.participants.length;t++)if(this.participants[t].userId===e)return this.participants[t];return null},o.prototype.addParticipant=function(e,t,n){return e&&e.userId?(_.debug("[BaseCall]: Add participant with userId =",e.userId),this.hasParticipant(e.userId)?n?this.updateParticipant(e,t):(_.warning("[BaseCall]: addParticipant called with existing participant. userId =",e.userId),null):(t&&(e.pcState=t),this.participants.push(e),a(this.participantsHashTable[e.userId]=e,this),_.debug("[BaseCall]: Added participant to call: ",e.userId),e)):(_.warning("[BaseCall]: addParticipant called with invalid participant"),null)},o.prototype.updateParticipant=function(e,t){if(!e||!e.userId)return _.warning("[BaseCall]: updateParticipant called with invalid participant"),null;_.debug("[BaseCall]: Update participant with userId =",e.userId);var n=this.getParticipant(e.userId);return n?(t=t||e.pcState,n.isMeetingPointInvitee&&n.locallyMuted?(n.muted=!0,n.pcState=t!==i.Active?t:i.Muted):(n.muted=e.muted,n.pcState=t),n.mediaType.desktop&&!e.mediaType.desktop&&(this.screenControlSupported=!1),n.streamId=e.streamId,n.screenStreamId=e.screenStreamId,n.mediaType=e.mediaType,n.screenSharePointerSupported=e.screenSharePointerSupported,n.isModerator=e.isModerator,n.isMeetingGuest=e.isMeetingGuest,n.rtcSupportedFeatures=e.rtcSupportedFeatures,n.flags=e.flags,n.videoPointerTo=e.videoPointerTo,e.participantType===R.RTCParticipantType.TELEPHONY&&(n.displayName=e.displayName,n.firstName=e.firstName,n.lastName=e.lastName,n.phoneNumber=e.phoneNumber),a(n,this),_.debug("[BaseCall]: Updated participant data for ",n.userId),n):(_.warning("[BaseCall]: The given participant is not part of the call"),null)},o.prototype.removeParticipant=function(e){delete this.participantsHashTable[e];for(var t=0;t<this.participants.length;t++)if(this.participants[t].userId===e){var n=this.participants.splice(t,1)[0];return n.videoStream=null,n.mediaType={audio:!1,video:!1,desktop:!1},_.debug("[BaseCall]: Removed participant from call: ",n.userId),n}return null},o.prototype.setParticipantState=function(t,n){n&&this.participants.some(function(e){return e.userId===t&&(e.pcState=n,_.debug("[BaseCall]: Set participant state to "+n.name+", userId =",e.userId),!0)})},o.prototype.hasOtherParticipants=function(){return 0<this.participants.length||0<this.attendeeCount},o.prototype.updateMediaType=function(){var t={audio:this.localMediaType.audio,video:this.localMediaType.video,desktop:this.localMediaType.desktop};this.participants.forEach(function(e){e.mediaType&&(e.mediaType.audio&&(t.audio=!0),e.mediaType.video&&(t.video=!0),e.mediaType.desktop&&(t.desktop=!0))}),_.debug("[BaseCall]: Updating call media type to ",t),this.mediaType=t},o.prototype.callTypeCss=function(){if(this.isDirect)return this.hasVideo()?"webrtc-video":"webrtc-audio";if(this.isRemote)return"remote";switch(this.state.css){case"outgoing":return"ongoing";case"incoming":return"incoming";case"answering":return"answering";case"active-call":return"active";default:return""}},o.prototype.toString=function(){return JSON.stringify(this,null,3)},o.prototype.getCstaState=function(){return this.atcCallInfo?this.atcCallInfo.cstaState:null},o.prototype.setCstaState=function(e){this.atcCallInfo&&(_.debug("[BaseCall]: Set csta state to ",e),this.atcCallInfo.cstaState=e,this.isAtcRemote&&(this.avatar=e===f.Holding?v.TELEPHONY_HOLD:v.TELEPHONY),this.consultation=this.consultation&&!this.isHolding())},o.prototype.checkCstaState=function(e){if(!this.atcCallInfo)return!1;if(!Array.isArray(e))return e===this.atcCallInfo.cstaState;var t=this;return e.some(function(e){return e===t.atcCallInfo.cstaState})},o.prototype.isHolding=function(){return this.checkCstaState([f.Holding,f.HoldOnHold,f.ConferenceHolding])},o.prototype.isHoldAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldAllowed()},o.prototype.isConsultAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConsultAllowed()},o.prototype.isReconnectAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isReconnectAllowed()},o.prototype.isConferenceCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCallAllowed()},o.prototype.isMakeCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isMakeCallAllowed()},o.prototype.isRetrieveAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveAllowed()},o.prototype.isTransferCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferCallAllowed()},o.prototype.isTransferAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferAllowed()},o.prototype.getPosition=function(){return this.atcCallInfo?this.atcCallInfo.getPosition():null},o.prototype.setAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHandoverInProgress()},o.prototype.clearAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHandoverInProgress()},o.prototype.isHoldInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldInProgress()},o.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress()},o.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress()},o.prototype.isRetrieveInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveInProgress()},o.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress()},o.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress()},o.prototype.isAtcConferenceCall=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCall()},o.prototype.setRedirectingUser=function(e,t,n,i,r){this.atcCallInfo&&this.atcCallInfo.setRedirectingUser(e,t,n,i,r)},o.prototype.getRedirectingUser=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectingUser():null},o.prototype.setRedirectionType=function(e){this.atcCallInfo&&this.atcCallInfo.setRedirectionType(e)},o.prototype.getRedirectionType=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectionType():null},o.prototype.isForwarded=function(){return!!this.atcCallInfo&&this.atcCallInfo.isForwarded()},o.prototype.isPickupNotification=function(){return!!this.atcCallInfo&&this.atcCallInfo.isPickupNotification()},o.prototype.isPickedUp=function(){return!!this.atcCallInfo&&this.atcCallInfo.isPickedUp()},o.prototype.setDisconnectCause=function(e,t){this._disconnectCause||(this.disconnectCause={cause:e,reason:t})},e.BaseCall=o,e.Enums=e.Enums||{},e.Enums.CallDirection=m,e.Enums.CallState=h,e.Enums.ScreenDisplayAction=n,e.Enums.ScreenLayoutAction={ToggleFocusLayout:{name:"ToggleFocusLayout",type:"cmrLayout",localize:"res_FocusLayout"},ToggleSplitLayout:{name:"ToggleSplitLayout",type:"cmrLayout",localize:"res_SplitLayout"},ToggleLargeLayout:{name:"ToggleLargeLayout",type:"cmrLayout",localize:"res_LargeLayout"}},e.Enums.ScreenFeaturesByPriority=r,e}((Circuit=function(e){"use strict";var n=e.logger,i=e.Utils,r={WebRTC:{name:"WebRTC",ui:"res_CircuitClient",css:"circuit"},Cell:{name:"Cell",ui:"res_AlternativeNumber",css:"mobile"},Desk:{name:"Desk",ui:"res_Deskphone",css:"desk"},VM:{name:"VM",ui:"res_Voicemail",css:"vm"},Other:{name:"Other",ui:"res_CallAtOther",css:""}},o=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",established:!1},Connecting:{name:"Connecting",established:!1},Delivered:{name:"Delivered",established:!1},Busy:{name:"Busy",established:!1},Offered:{name:"Offered",established:!1},Failed:{name:"Failed",established:!1},TransferFailed:{name:"TransferFailed",established:!1},Ringing:{name:"Ringing",established:!1},ExtendedRinging:{name:"ExtendedRinging",established:!1},Active:{name:"Active",established:!0},Held:{name:"Held",established:!0},Holding:{name:"Holding",established:!0},HoldOnHold:{name:"HoldOnHold",established:!0},Parked:{name:"Parked",established:!0},Conference:{name:"Conference",established:!0},ConferenceHolding:{name:"ConferenceHolding",established:!0},Terminated:{name:"Terminated",established:!1}}),t=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting"},BusySignal:{name:"BusySignal",ui:"res_BusyHandling_BusySignal"},SendToAlternativeNumber:{name:"SendToAlternativeNumber",ui:"res_BusyHandling_AlternativeNumber"},SendToVM:{name:"SendToVM",ui:"res_BusyHandling_Voicemail"}}),a=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting",desc:"res_DefaultRoutingDescription",newDesc:"res_DefaultRoutingDescriptionTimersPBXConfigurable"},DeskPhone:{name:"DeskPhone",ui:"res_Deskphone",desc:"res_DeskphoneRoutingDescription"},AlternativeNumber:{name:"AlternativeNumber",ui:"res_BusyHandling_AlternativeNumber",desc:"res_AlternativeNumberRoutingDescription"},VM:{name:"VoiceMail",ui:"res_Voicemail",desc:"res_VoicemailRoutingDescription"},Other:{name:"Other",ui:"res_Other",desc:""}}),s=Object.freeze({REGULAR:"REGULAR",MISSED:"MISSED"}),c=Object.freeze({DEFAULT:"DEFAULT",DEST_OUT_OF_ORDER:"DEST_OUT_OF_ORDER",REORDER_TONE:"REORDER_TONE",BUSY:"BUSY",CANCELLED:"CANCELLED",DECLINED:"DECLINED",TRANSFERRED:"TRANSFERRED"}),l=Object.freeze({Busy:{name:"Busy",ui:"res_TransferCallFailedCauseBusy"},Unreachable:{name:"Unreachable",ui:"res_TransferCallFailedCauseUnreachable"},DND:{name:"Dnd",ui:"res_TransferCallFailedCauseDND"}}),d=Object.freeze({CallForward:{name:"callForward",ui:"res_ForwardedFrom"},CallPickupNotification:{name:"callPickupNotification",ui:"res_CallPickupNotification"},CallPickedUp:{name:"callPickedUp",ui:"res_CallPickedUp"},Dss:{name:"dss",ui:"res_CallPickedUp"}}),u=Object.freeze({Ready:"ready",NotReady:"notReady"}),E=Object.freeze({CallNotFound:{name:"CallNotFound",ui:"res_PickUpCallFailedCauseNotFound"},CallAlreadyPickedUp:{name:"CallAlreadyPickedUp",ui:"res_PickUpCallFailedCauseAlreadyPickedUp"}}),C=Object.freeze({CallForwardingImmediate:"CallForwardingImmediate",CallForwardingToVM:"CallForwardingToVM"});return e.AtcCallInfo=function(){var t=null;this.cstaConn=null,this.cstaState=o.Idle,this.cstaReconnectId={},this.position=r.Other,this.servicesPermitted={},this.peerFQN="",this.peerDn="",this.peerName=null,this.missedReason="",this.ignoreCall=!1,this.originalPartnerDisplay={},this.handoverInProgress=!1,this.holdInProgress=!1,this.retrieveInProgress=!1,this.outgoingCallCampedOn=!1,this.redirectingUser={},this.masterParallelHgCall=!1,this.queuedIncomingCall=!1,this.recalledCall=!1,this.setPeerName=function(e){this.peerName=e||""},this.setPartnerDisplay=function(e){e&&(this.peerFQN=e.fqn||"",this.peerDn=e.dn||e.fqn||"",this.peerName=e.name||this.peerDn,!this.peerFQN&&this.peerDn.startsWith("+")&&(this.peerFQN=this.peerDn))},this.setOriginalPartnerDisplay=function(e){e&&i.isEmptyObject(this.originalPartnerDisplay)&&(this.originalPartnerDisplay=e)},this.setCstaConnection=function(e){this.cstaConn=e,this.isRemote&&(this.callId=e.cID)},this.getCstaConnection=function(){return this.cstaConn},this.setCstaCallId=function(e){this.cstaConn&&(this.cstaConn.cID=e)},this.getCstaCallId=function(){return this.cstaConn&&this.cstaConn.cID},this.getCstaDeviceId=function(){return this.cstaConn&&this.cstaConn.dID},this.setCstaReconnectId=function(e){this.cstaReconnectId=e},this.getCstaReconnectId=function(){return this.cstaReconnectId},this.setServicesPermitted=function(e){e&&!i.isEmptyObject(e)?(e.rSP&&void 0!==e.rSP.cCSs&&(this.servicesPermitted.rSP=e.rSP),void 0!==e.eSP&&(this.servicesPermitted.eSP=e.eSP),n.info("[AtcCallInfo]: Updated services permitted: ",this.servicesPermitted)):n.info("[AtcCallInfo]: Empty services permitted, keeping last values")},this.clearServicesPermitted=function(){this.servicesPermitted={}},this.getServicesPermitted=function(){return this.servicesPermitted},this.isHandoverAllowed=function(){return(this.isSilentHandoverAllowed()||this.isSeamlessHandoverAllowed())&&!this.isHandoverInProgress()},this.isSeamlessHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zseHo)||!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.zseHo)},this.isSilentHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zsiHo)},this.isTransferAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.sST||this.isHandoverInProgress())},this.isAlternateAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.alC)},this.isAnswerAllowed=function(){return this.servicesPermitted.rSP?!!this.servicesPermitted.rSP.cCSs.anC:this.cstaState===o.Ringing},this.isCallBackAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.cB)},this.isConsultAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.csC)},this.isDeflectAllowed=function(){return this.cstaState===o.Parked||this.cstaState===o.Ringing||!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.dCl)},this.isGenerateDigitsAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cAS.gD)},this.isHoldAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return!!this.servicesPermitted.rSP.cCSs.hCl;switch(this.cstaState){case o.Active:case o.Conference:case o.Held:return!0;default:return!1}},this.isConferenceCall=function(){return this.cstaState===o.Conference||this.cstaState===o.ConferenceHolding},this.isMakeCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.mCl)},this.isReconnectAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.rC)},this.isRetrieveAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.reC;switch(this.cstaState){case o.ConferenceHolding:case o.Holding:case o.HoldOnHold:return!0;default:return!1}},this.isTransferCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.tCl||this.isHandoverInProgress())},this.isConferenceCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.coC)},this.getPosition=function(){return this.position},this.setPosition=function(e){e&&e!==this.position&&(this.position=e,n.debug("[AtcCallInfo]: Set call position to ",e.name))},this.getMissedReason=function(){return this.missedReason},this.setMissedReason=function(e){e&&e!==this.missedReason&&(this.missedReason=e,n.debug("[AtcCallInfo]: Set missedReason to ",e))},this.isQueuedIncomingCall=function(){return this.queuedIncomingCall},this.setQueuedIncomingCall=function(e){this.queuedIncomingCall=e},this.isRecalledCall=function(){return this.recalledCall},this.setRecalledCall=function(e){this.recalledCall=e},this.getIgnoreCall=function(){return this.ignoreCall||this.cstaState===o.Offered},this.setIgnoreCall=function(e){this.ignoreCall=e},this.isHandoverInProgress=function(){return this.handoverInProgress},this.setHandoverInProgress=function(){this.handoverInProgress=!0},this.clearHandoverInProgress=function(){this.handoverInProgress=!1},this.isHoldInProgress=function(){return this.holdInProgress},this.setHoldInProgress=function(){this.holdInProgress=!0},this.clearHoldInProgress=function(){this.holdInProgress=!1},this.isRetrieveInProgress=function(){return this.retrieveInProgress},this.setRetrieveInProgress=function(){this.retrieveInProgress=!0},this.clearRetrieveInProgress=function(){this.retrieveInProgress=!1},this.isOutgoingCallCampedOn=function(){return this.outgoingCallCampedOn},this.setOutgoingCallCampedOn=function(){this.outgoingCallCampedOn=!0},this.clearOutgoingCallCampedOn=function(){this.outgoingCallCampedOn=!1},this.setTransferCallFailedCause=function(e){if(this.cstaState===o.TransferFailed)switch(e){case"busy":t=l.Busy;break;case"doNotDisturb":t=l.DND;break;default:t=l.Unreachable}},this.getTransferCallFailedCause=function(){return this.cstaState===o.TransferFailed?t||l.Unreachable:null},this.setRedirectingUser=function(e,t,n,i,r){r=r||this.redirectingUser.redirectionType,this.redirectingUser&&this.redirectingUser.fqNumber&&this.redirectingUser.fqNumber!==t||(this.redirectingUser={userId:i||"",displayName:n,phoneNumber:e,fqNumber:t,redirectionType:r})},this.getRedirectingUser=function(){return this.redirectingUser},this.setRedirectionType=function(e){this.redirectingUser.redirectionType=e},this.getRedirectionType=function(){return this.redirectingUser&&this.redirectingUser.redirectionType},this.isForwarded=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallForward},this.isPickupNotification=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallPickupNotification},this.isPickedUp=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallPickedUp}},e.Enums=e.Enums||{},e.Enums.CstaCallState=o,e.Enums.Targets=r,e.Enums.JournalEntryTypes=s,e.Enums.MissedReasonTypes=c,e.BusyHandlingOptions=t,e.RoutingOptions=a,e.Enums.TransferCallFailedCauses=l,e.Enums.RedirectionTypes=d,e.Enums.AgentState=u,e.Enums.TeamPickupFailedCauses=E,e.Enums.CallForwardingTypes=C,e}((Circuit=function(o){"use strict";var a=o.Constants,s=o.Utils,c={Active:{name:"Active",ui:"",established:!0,css:"active-call"},Busy:{name:"Busy",ui:"res_ParticipantState_busy",established:!1,css:"busy"},Calling:{name:"Calling",ui:"",established:!1,css:"calling"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},ConnectionLost:{name:"ConnectionLost",ui:"res_ParticipantState_connectionLost",established:!1,css:"connection-lost"},Declined:{name:"Declined",ui:"res_ParticipantState_declined",established:!1,css:"declined"},Delivered:{name:"Delivered",ui:"",established:!1,css:"outgoing"},Idle:{name:"Idle",ui:"",established:!1,css:"idle"},Inactive:{name:"Inactive",ui:"",established:!1,css:"inactive"},Initiated:{name:"Initiated",ui:"",established:!1,css:"outgoing"},Joined:{name:"Joined",ui:"res_ParticipantState_joined",established:!0,css:"joined-call"},Muted:{name:"Muted",ui:"res_ParticipantState_muted",established:!0,css:"muted"},Offline:{name:"Offline",ui:"res_ParticipantState_offline",established:!1,css:"offline"},OffStage:{name:"OffStage",ui:"res_ParticipantState_leftStage",established:!1,css:"declined"},OnStage:{name:"OnStage",ui:"res_ParticipantState_enteredStage",established:!0,css:"joined-call"},Removed:{name:"Removed",ui:"res_ParticipantState_removed",established:!1,css:"declined"},Ringing:{name:"Ringing",ui:"",established:!1,css:"incoming"},Terminated:{name:"Terminated",ui:"res_ParticipantState_left",established:!1,css:"declined"},Timeout:{name:"Timeout",ui:"res_ParticipantState_missed",established:!1,css:"busy"}},l={Drop:{name:"Drop",type:"hangup",icon:"",localize:"res_Hangup"},Mute:{name:"Mute",type:"microphone",icon:"unmuted",localize:"res_Mute"},Unmute:{name:"Unmute",type:"microphone",icon:"muted",localize:"res_Unmute"},StartVideo:{name:"StartVideo",type:"video",icon:"inactive",localize:"res_StartVideo"},StopVideo:{name:"StopVideo",type:"video",icon:"active",localize:"res_StopVideo"},RemoveFromStage:{name:"DropFromStage",type:"hangup",icon:"drop-from-stage",localize:""}},d={createFromUser:function(e,t){if(!e)return null;var n=Object.create(e);n.pcState=t||c.Idle,n.streamId=null,n.screenStreamId=null,n.videoStream=null,n.mediaType={audio:!1,video:!1,desktop:!1},n.muted=!1,n.activeSpeaker=!1,n.isActive=d.isActive.bind(null,n),n.actions=[],n.screenSharePointerSupported=!1,n.hasSameMediaType=d.hasSameMediaType.bind(null,n),n.hasVideoStream=d.hasVideoStream.bind(null,n),n.setActions=d.setActions.bind(null,n),n.rtcSupportedFeatures=[],n.flags=[],n.toJSON=function(){return this},n.userId=e.userId,n.firstName=e.firstName,n.lastName=e.lastName;var i=null,r="";return Object.defineProperty(n,"videoStream",{get:function(){return i},set:function(e){i=e,r=""},enumerable:!0,configurable:!1}),s.isMobile()&&Object.defineProperty(n,"videoUrl",{get:function(){return r=i?r||o.WebRTCAdapter.createObjectURL(i):""},enumerable:!0,configurable:!1}),n.streams={},n},isActive:function(e){switch(e.pcState){case c.Active:case c.Joined:case c.Muted:case c.OnStage:return!0}return!1},hasSameMediaType:function(e,t){return!!(e&&t&&e.mediaType&&t.mediaType&&e.mediaType.audio===t.mediaType.audio&&e.mediaType.video===t.mediaType.video&&e.mediaType.desktop===t.mediaType.desktop)},hasVideoStream:function(e){return!(!e.videoStream||!e.streamId&&!e.screenStreamId||!e.mediaType.video&&!e.mediaType.desktop)},setActions:function(e,t,n){if(e.actions=[],!t||!t.isTemporary)if(e.pcState.established)if(e.isMeetingPointInvitee)e.actions.push(e.mediaType.video?l.StopVideo:l.StartVideo),e.actions.push(e.muted?l.Unmute:l.Mute),e.actions.push(l.Drop);else{var i=!t||t.isModerated,r=t&&t.userIsModerator(n),o=t&&t.userIsModerator(e);e.muted||i&&o&&!r||e.actions.push(l.Mute),i&&!r||(t.type===a.ConversationType.LARGE&&!o&&r?e.isCMP||e.actions.push(l.RemoveFromStage):e.actions.push(l.Drop))}else e.pcState===c.Initiated&&e.actions.push(l.Drop)}};return o.RtcParticipant=d,o.Enums=o.Enums||{},o.Enums.ParticipantState=c,o.Enums.ParticipantAction=l,o}((Circuit=function(p){"use strict";var S=p.Constants,I=p.logger,A=p.Constants.RealtimeMediaType,R=p.Utils;return p.RtcPeerConnectionsUnified=function(e,c){c=c||{};var t,l=p.WebRTCAdapter,s=this,n=R.shallowCopy(e),d=null,a=0,u={},i=[];function r(e){return!!e&&e===d}function o(e,t){return!(!e||!t)&&l.getTrackId(e)===l.getTrackId(t)}function E(e){return!(!e||"video"!==e.kind)}function C(e,t,n){switch(e){case S.RealtimeMediaType.VIDEO:return t!==n;case S.RealtimeMediaType.DESKTOP_SHARING:return t===n;default:return!1}}function T(e,t){if("function"==typeof e)try{e(t)}catch(e){I.error(e)}}this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(t,e,n,i){!function(e,t){if((t=t||{}).audioInactive)d.addTransceiver("audio",{direction:"inactive"});else if(e.mandatory&&e.mandatory.OfferToReceiveAudio){d.getReceivers().some(function(e){return"audio"===(e.track&&e.track.kind)})||(I.debug("[RTCPeerConnectionsUnified]: create local SDP: Adding 1 audio receiver"),d.addTransceiver("audio",{direction:"recvonly"}))}var n=e.mandatory&&e.mandatory.OfferToReceiveVideo||c.onlyRemoteScreenShare,i=0,r=0;if(n)if(d.getReceivers().forEach(function(e){"video"===(e.track&&e.track.kind)&&i++}),r=a-i,u.track&&0<r?r=a-++i:n=!1,0<=r){I.debug("[RTCPeerConnectionsUnified]: create local SDP: Adding "+r+" video receivers");for(var o=0;o<r;o++)d.addTransceiver("video",{direction:"recvonly"})}else I.warn("[RTCPeerConnectionsUnified]: create local SDP: Could not calculate number of video receivers: ",r);I.debug("[RTCPeerConnectionsUnified]: Total number of video receivers: ",i+r),u.track&&d.addTransceiver(u.track,{direction:n&&!c.onlyRemoteScreenShare?"sendrecv":"sendonly"})}(n,i),d.createOffer(function(e){I.debug("[RTCPeerConnectionsUnified]: createOffer succeeded"),t(e)},e)},this.createAnswer=function(t,e,n,i){!function(e,n){n=n||{};var i=e.mandatory&&e.mandatory.OfferToReceiveVideo;i&&!n.audioInactive||d.getTransceivers().forEach(function(e){if(!e.stopped){var t=e.receiver&&e.receiver.track&&e.receiver.track.kind;i||"video"!==t?n.audioInactive&&"audio"===t&&(e.direction="inactive"):e.sender&&e.sender.track?e.direction="sendonly":e.direction="inactive"}}),u.track&&d.addTrack(u.track,u.stream)}(n,i),d.createAnswer(function(e){I.debug("[RTCPeerConnectionsUnified]: createAnswer succeeded"),t(e)},e)},this.setMainMediaLines=function(){},this.setLocalDescription=function(e,t,n){d.setLocalDescription(e,t,n)},this.setRemoteDescription=function(e,t,n){d.setRemoteDescription(function(e){return e&&"pranswer"===e.type?new l.SessionDescription({type:"answer",sdp:e.sdp}):e}(e),t,n)},this.removeStream=function(e){if(e){var n=d.getSenders();e.getTracks().forEach(function(t){I.debug("[RTCPeerConnectionsUnified]: Attempting to remove local track: ",t.label),n.some(function(e){return!!o(e.track,t)&&(I.debug("[RTCPeerConnectionsUnified]: Found sender, track removed"),o(u.track,t)&&(I.debug("[RTCPeerConnectionsUnified]: Set local desktop track to null"),u={}),d.removeTrack(e),!0)})})}},this.addStream=function(o,a,s){o&&(d.remoteDescription&&d.remoteDescription.type?o.getTracks().forEach(function(e){o.isScreen?(u.track=e,u.stream=o):d.addTrack(e,o)}):(o.getAudioTracks().forEach(function(e){d.addTransceiver(e,{direction:"sendrecv"})}),o.getVideoTracks().forEach(function(e){var t=l.getTrackId(e),n=t&&s[t],i=n&&n.direction||"sendrecv",r=!a||c.onlyRemoteScreenShare&&!o.isScreen?"sendonly":i;o.isScreen?(u.track=e,u.stream=o):d.addTransceiver(e,{direction:r}),I.debug("[RTCPeerConnectionsUnified]: Added local "+(o.isScreen?"screen":"video")+" track="+e.label+" direction="+r)})))},this.replaceTrack=function(r,o){return r&&o?new Promise(function(n,i){d.getSenders().some(function(e){if(r!==e.track)return!1;var t=e.track.label;return e.replaceTrack(o).then(function(){I.debug("[RTCPeerConnectionsUnified]: Successfully replaced "+t+" track with ",o.label),n()}).catch(function(e){I.error("[RTCPeerConnectionsUnified]: Error replacing "+t+" track with "+o.label+". ",e),i(e)}),!0})||(I.error("[RTCPeerConnectionsUnified]: Could not find track to be replaced"),i("Could not find track to be replaced"))}):Promise.reject("Missing parameter(s)")},this.getLocalStreams=function(){var t=[];return d.getSenders().forEach(function(e){e.track&&t.push(new l.MediaStream([e.track]))}),t},this.getRemoteStreams=function(){var n=[];return d.getTransceivers().forEach(function(e){if(e.receiver&&e.receiver.track){var t=new l.MediaStream([e.receiver.track]);t.mid=e.mid,n.push(t)}}),n},this.addIceCandidate=function(e){e?d.addIceCandidate(new l.IceCandidate(e)):d.addIceCandidate()},this.close=function(){d.close(),function(e){e.onnegotiationneeded=null,e.onicecandidate=null,e.onsignalingstatechange=null,e.oniceconnectionstatechange=null,e.ontrack=null}(d)},this.createDTMFSender=function(e){return d.createDTMFSender(e)},this.sendDataMessage=function(){return!1},this.getMediaId=function(t){if(t){var e=d.getTransceivers();if(e.length){var n=e.find(function(e){return e.sender&&o(e.sender.track,t)});if(n)return n.mid}}return null},this.getScreenShareMediaId=function(){var e=d.getTransceivers();if(e.length){if(u.track){var t=e.find(function(e){return!(!e.sender||!e.sender.track)&&o(e.sender.track,u.track)});if(t)return t.mid;I.warn("[RTCPeerConnectionsUnified]: Could not find desktop sender obj. Last video connection will be selected for screen share")}if(c.createDesktopPc)for(var n=e.length-1;0<=n;n--){var i=e[n];if(i.receiver&&i.receiver.track&&"video"===i.receiver.track.kind)return i.mid}}return null},this.getStats=function(){return d.getStats()},this.setMaxBitrate=function(r){d.getTransceivers().forEach(function(e){var t=e.sender&&e.sender.track,n=l.getTrackId(t),i=n&&r[n];i&&l.setEncodingParameters(e,i.maxBitrate,i.degradationPreference,i.scaleResolutionDownBy)})},this.getAvailableVideoReceivers=function(i){var r=s.getScreenShareMediaId(),o=[];return d.getTransceivers().forEach(function(e){var t=e.mid,n=e.receiver;n&&E(n.track)&&C(i,t,r)&&o.push({id:t})}),o},this.getAvailableVideoSenders=function(r){var o=s.getScreenShareMediaId(),a=[];return d.getTransceivers().forEach(function(e){var t=e.sender&&e.sender.track;if(E(t)&&C(A.VIDEO,e.mid,o)){var n=l.getTrackId(t),i=n&&r[n];i&&a.push({mid:e.mid,quality:i.quality,mediaType:A.VIDEO})}}),I.info("[RTCPeerConnectionsUnified] Video senders: ",a),a},Object.defineProperties(this,{localDescription:{get:function(){return d.localDescription},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return d.remoteDescription},enumerable:!0,configurable:!1},signalingState:{get:function(){return d.signalingState},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return d.iceConnectionState},enumerable:!0,configurable:!1},mainPeerConnection:{get:function(){return d},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return[]},enumerable:!0,configurable:!1},desktopPeerConnection:{get:function(){return c.createDesktopPc},enumerable:!0,configurable:!1},desktopRemoteSsrc:{get:function(){return i},set:function(e){i=e||[]},enumerable:!0,configurable:!1}}),n.sdpSemantics="unified-plan",n.bundlePolicy="max-compat",a=c.extraVideoChannels+(c.createDesktopPc?1:0)+(c.onlyRemoteScreenShare?0:1),n.iceCandidatePoolSize=1+a,I.debug("[RTCPeerConnectionsUnified]: Create RTCPeerConnection with config: ",n),(t=d=new l.PeerConnection(n)).onnegotiationneeded=function(e,t){I.debug("[RTCPeerConnectionsUnified]: onnegotiationneeded"),r(e)?function(e){T(s.onnegotiationneeded,e)}(t):I.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection")}.bind(null,t),t.onicecandidate=function(e,t){I.debug("[RTCPeerConnectionsUnified]: onicecandidate: iceGatheringState = ",e.iceGatheringState),r(e)?(t.candidate||I.debug("[RTCPeerConnectionsUnified]: End of candidates"),function(e){T(s.onicecandidate,e)}(t)):I.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection")}.bind(null,t),t.onsignalingstatechange=function(e,t){I.debug("[RTCPeerConnectionsUnified]: onsignalingstatechange: signalingState = ",e.signalingState),r(e)?function(e){T(s.onsignalingstatechange,e)}(t):I.debug("[RTCPeerConnectionsUnified]:  Event is from old Peer Connection")}.bind(null,t),t.oniceconnectionstatechange=function(e,t){I.debug("[RTCPeerConnectionsUnified]: oniceconnectionstatechange: iceConnectionState = ",e.iceConnectionState),r(e)?function(e){T(s.oniceconnectionstatechange,e)}(t):I.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection.")}.bind(null,t),t.ontrack=function(e,t){if(I.debug("[RTCPeerConnectionsUnified]: ontrack:",t.track&&t.track.label),r(e)){if(t.track){var n=null;if(d.getTransceivers().some(function(e){return!(!e.receiver||!o(e.receiver.track,t.track)||(n=e.mid,0))}),n){var i=new l.MediaStream([t.track]);i.mid=n,I.debug("[RTCPeerConnectionsUnified]: ontrack: mid: ",n),function(e){T(s.onaddstream,e)}({stream:i})}else I.error("[RTCPeerConnectionsUnified]: ontrack: Could not find the mid attribute. This remote track won't be played: ",t.track.label)}}else I.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection.")}.bind(null,t)},p}((Circuit=function(h){"use strict";var O=h.logger,D=h.Constants.RealtimeMediaType,P=h.sdpParser,y=h.Utils;return h.RtcPeerConnections=function(e,t,c){var E=h.WebRTCAdapter,l="video_screen",o=this,n=y.shallowCopy(e),i=t,r={screenControlChannelName:"SCREEN_CONTROL",isScreenControlled:!!(c=c||{}).isScreenControlled,isScreenOwner:!!c.isScreenOwner},C=null,T=null,d=c.extraVideoChannels||0,p=[],u={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}},a=0,s="new";function S(e){e.onnegotiationneeded=function(e,t){if(O.debug("[RTCPeerConnections]: onnegotiationneeded"),!A(e))return void O.debug("[RTCPeerConnections]: Event is from old Peer Connection");!function(e){m(o.onnegotiationneeded,e)}(t)}.bind(null,e),e.onicecandidate=function(e,t){if(O.debug("[RTCPeerConnections]: onicecandidate: iceGatheringState = ",e.iceGatheringState),!A(e))return void O.debug("[RTCPeerConnections]: Event is from old Peer Connection");if(t.candidate){if(e===T){var n=new E.IceCandidate({sdpMLineIndex:_()-1,sdpMid:t.candidate.sdpMid,candidate:t.candidate.candidate});t={candidate:n}}else if(e!==C){var i=p.indexOf(e);if(0<=i){var r=new E.IceCandidate({sdpMLineIndex:t.candidate.sdpMLineIndex+i+2,sdpMid:t.candidate.sdpMid,candidate:t.candidate.candidate});t={candidate:r}}}}else{if(++a<_())return;O.debug("[RTCPeerConnections]: End of candidates - all peer connections"),a=0}!function(e){m(o.onicecandidate,e)}(t)}.bind(null,e),e.onsignalingstatechange=function(e,t){if(O.debug("[RTCPeerConnections]: onsignalingstatechange: signalingState = ",e.signalingState),!A(e))return void O.debug("[RTCPeerConnections]: Event is from old Peer Connection");!function(e){m(o.onsignalingstatechange,e)}(t)}.bind(null,e),e.onaddstream=function(e,t){if(O.debug("[RTCPeerConnections]: onaddstream"),!A(e))return void O.debug("[RTCPeerConnections]: Event is from old Peer Connection");!function(e){m(o.onaddstream,e)}(t)}.bind(null,e),e.onremovestream=function(e,t){if(O.debug("[RTCPeerConnections]: onremovestream"),!A(e))return void O.debug("[RTCPeerConnections]: Event is from old Peer Connection");!function(e){m(o.onremovestream,e)}(t)}.bind(null,e),e.oniceconnectionstatechange=function(e,t){if(!A(e))return void O.debug("[RTCPeerConnections]: oniceconnectionstatechange from old Peer Connection.");var n;n=e===C?"main":e===T?"desktop":"aux"+p.indexOf(e);var i=e.iceConnectionState;if(O.debug("[RTCPeerConnections]: oniceconnectionstatechange - "+n+": iceConnectionState = ",i),e!==C||s===i)return;s=i,function(e){m(o.oniceconnectionstatechange,e)}(t)}.bind(null,e)}function I(e){e.onnegotiationneeded=null,e.onicecandidate=null,e.onsignalingstatechange=null,e.onaddstream=null,e.onremovestream=null,e.oniceconnectionstatechange=null,e.ondatachannel=null}function A(e){return!!e&&(e===C||e===T||p.includes(e))}function R(i){var e=C[i];if(!e||!e.type||!e.sdp)return null;if(0===d&&!T)return e;var r=P.parse(e.sdp);if(1===r.m.length&&"audio"===r.m[0].media&&"remoteDescription"!==i&&0<d&&P.addEmptyVideoLine(r),p.every(function(e){var t=e[i];if(!t||!t.type||!t.sdp)return!1;var n=P.parse(t.sdp);return(n=P.verifyFingerprintInMLines(n)).m.some(function(e){return"video"===e.media&&(r.m.push(e),!0)})}),T){var t=T[i];if(t&&t.type&&t.sdp){var n=P.parse(t.sdp);n.m&&n.m.length&&(n=P.verifyFingerprintInMLines(n),r.m.push(n.m[0]))}}return new E.SessionDescription({type:e.type,sdp:P.stringify(r)})}function f(){C.createdLocalSdp=null,p.forEach(function(e){e.createdLocalSdp=null})}function v(e){return"pranswer"===e.type&&(e.type="answer"),e}function _(){return(C?1:0)+p.length+(T?1:0)}function g(i){var r;return T&&i.some(function(t,n){return t.a.some(function(e){return"mid"===e.field&&e.value===l&&(r=t,i.splice(n,1),!0)})}),r}function N(e){var t=[];return e.forEach(function(e){e&&0<e.getVideoTracks().length&&t.push(E.getVideoStreamTrackId(e))}),t}function m(e,t){if("function"==typeof e)try{e(t)}catch(e){O.error(e)}}this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(i,r,e){var o=0,a=_(),s=null;function t(e,t){if(o++,O.debug("[RTCPeerConnections]: createOffer, count: ",o),e.createdLocalSdp=function(e,t,n){var i=P.parse(e.sdp),r=n===T;if(r||T||n.getLocalStreams().some(function(e){return e&&e.isScreen})&&(r=!0),r||d){var o=r?l:"video_"+(t-1);i.m.forEach(function(e){if("video"===e.media)for(var t=0,n=e.a.length;t<n;t++)if("mid"===e.a[t].field){e.a[t].value=o;break}})}return new E.SessionDescription({type:e.type,sdp:P.stringify(i)})}(t,o,e),a<=o){if(s)r(s);else{var n=R("createdLocalSdp");i(n)}f()}}function n(e){s||(s=e),a<=++o&&r(s)}e.mandatory.OfferToReceiveVideo=e.mandatory.OfferToReceiveVideo&&!c.onlyRemoteScreenShare,C.createOffer(t.bind(null,C),n,e),p.forEach(function(e){e.createOffer(t.bind(null,e),n,u)}),T&&T.createOffer(t.bind(null,T),n,u)},this.createAnswer=function(i,r,t){var o=0,a=_(),s=null;function n(e,t){if(o++,O.debug("[RTCPeerConnections]: createAnswer, count: ",o),e.createdLocalSdp=t,a<=o){if(s)r(s);else{var n=R("createdLocalSdp");i(n)}f()}}function c(e){s||(s=e),a<=++o&&r(s)}C.createAnswer(n.bind(null,C),c),p.forEach(function(e){e.remoteDescription?e.createAnswer(n.bind(null,e),c,t):o++}),T&&T.createAnswer(n.bind(null,T),c,t)},this.setMainMediaLines=function(n,i){i.m=n.splice(0,2),n.some(function(e,t){return"application"===e.media&&(O.info("[RTCPeerConnections]: Adding application media line to main SDP"),i.m.push(e),n.splice(t,1),!0)})},this.setLocalDescription=function(t,e,n){var i=0,r=_(),o=null;function a(){i++,O.debug("[RTCPeerConnections]: setLocalDescription onLocalSdpApplied, count: ",i),r<=i&&(o?n(o):e())}function s(e){i++,O.error("[RTCPeerConnections]: setLocalDescription error, count: "+i+"\n",e),o||(o=e),r<=i&&n(o)}var c=P.parse(t.sdp),l=c.m,d=g(l);this.setMainMediaLines(l,c),"answer"===t.type&&(P.parse(C.remoteDescription.sdp).m.some(function(e){return"video"===e.media})||(O.info("[RTCPeerConnections]: Remote sdp offer has no video"),c.m=c.m.filter(function(e){return"video"!==e.media})));var u=new E.SessionDescription({type:t.type,sdp:P.stringify(c)});C.setLocalDescription(u,a,s),p.forEach(function(e){if(!l.length)return i++,void O.warning("[RTCPeerConnections]: Missing sdp mline for peer connection: ",i);c.m=l.splice(0,1),u=new E.SessionDescription({type:t.type,sdp:P.stringify(c)}),e.setLocalDescription(u,a,s)}),T&&(c.m=d?[d]:l.splice(0,1),u=new E.SessionDescription({type:t.type,sdp:P.stringify(c)}),T.setLocalDescription(u,a,s))},this.setRemoteDescription=function(t,e,n){var i=0,r=_(),o=null;function a(){i++,O.debug("[RTCPeerConnections]: setRemoteDescription onRemoteSdpApplied, count: ",i),r<=i&&(o?n(o):e())}function s(e){o||(o=e),r<=++i&&n(o)}var c=P.parse(t.sdp),l=c.m,d=g(l);this.setMainMediaLines(l,c);var u=new E.SessionDescription({type:t.type,sdp:P.stringify(c)});u=v(u),C.setRemoteDescription(u,a.bind(null,C),s),p.forEach(function(e){if(!l.length)return i++,void O.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+i);c.m=l.splice(0,1),u=v(u=new E.SessionDescription({type:t.type,sdp:P.stringify(c)})),e.setRemoteDescription(u,a.bind(null,e),s)}),t.screen&&T?(c.m=d?[d]:[t.screen],u=new E.SessionDescription({type:t.type,sdp:P.stringify(c)}),T.setRemoteDescription(u,a,s)):(T=null,i++)},this.removeStream=function(e){C.removeStream(e),T&&T.removeStream(e)},this.addStream=function(e){return e&&e.isScreen&&T?T.addStream(e):C.addStream(e)},this.getLocalStreams=function(){var e=C.getLocalStreams();return T&&Array.prototype.push.apply(e,T.getLocalStreams()),e},this.getRemoteStreams=function(){var t=C.getRemoteStreams().slice(0);return p.forEach(function(e){t.push.apply(t,e.getRemoteStreams())}),T&&Array.prototype.push.apply(t,T.getRemoteStreams()),t},this.addIceCandidate=function(e){if(!e)return C.addIceCandidate(),T&&T.addIceCandidate(),void p.forEach(function(e){e.addIceCandidate()});if(e.sdpMid===l&&T)return T.addIceCandidate(new E.IceCandidate(e)),void(e.sdpMLineIndex=0);if(e.sdpMLineIndex<=1)C.addIceCandidate(new E.IceCandidate(e));else{var t=e.sdpMLineIndex-2;p[t]&&(e.sdpMLineIndex=0,p[t].addIceCandidate(new E.IceCandidate(e)))}},this.close=function(){C.close(),I(C),T&&(T.close(),I(T)),p.forEach(function(e){e.close(),I(e)})},this.createDTMFSender=function(e){return C.createDTMFSender(e)},this.sendDataMessage=function(e){return!!C.sendDataMessage&&C.sendDataMessage(e)},this.getScreenShareMediaId=function(){return l},this.setMaxBitrate=function(){},this.getAvailableVideoReceivers=function(e){var t=[];return e===D.VIDEO?(N(C.getRemoteStreams()).forEach(function(e){t.includes(e)||t.push(e)}),p.forEach(function(e){N(e.getRemoteStreams()).forEach(function(e){t.includes(e)||t.push(e)})})):T&&N(T.getRemoteStreams()).forEach(function(e){t.includes(e)||t.push(e)}),t.map(function(e){return{id:e}})},this.getAvailableVideoSenders=function(){return[]},Object.defineProperties(this,{localDescription:{get:function(){return R("localDescription")},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return R("remoteDescription")},enumerable:!0,configurable:!1},signalingState:{get:function(){return C.signalingState},enumerable:!0,configurable:!!Circuit.isUnitTestRun},iceConnectionState:{get:function(){return 0<d?s:C.iceConnectionState},enumerable:!0,configurable:!1},mainPeerConnection:{get:function(){return C},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return p},enumerable:!0,configurable:!1},desktopPeerConnection:{get:function(){return T},enumerable:!0,configurable:!1}}),n.sdpSemantics="plan-b",n.iceCandidatePoolSize=2,O.debug("[RTCPeerConnections]: Create RTCPeerConnection with config: ",n),S(C=new E.PeerConnection(n,i,r)),O.debug("[RTCPeerConnections]: Created main audio/video RTCPeerConnection"),E.groupPeerConnectionsSupported&&function(){for(var e=0;e<d;e++)try{n.iceCandidatePoolSize=1;var t=new E.PeerConnection(n,i);p.push(t),S(t),O.debug("[RTCPeerConnections]: Created aux video PeerConnection")}catch(e){O.error("[RTCPeerConnections]:  Failed to create aux video PeerConnection.",e)}}(),c.createDesktopPc&&(n.iceCandidatePoolSize=1,S(T=new E.PeerConnection(n,t)),O.debug("[RTCPeerConnections]: Created screenshare peer connection"))},h}((Circuit=function(I){"use strict";var A,R=I.logger,e=I.Utils,i=I.isElectron&&require("electron").ipcRenderer,f=I.isElectron&&require("os"),o={ordered:!1,maxRetransmitTime:1e3,negotiated:!1,id:0};void 0!==window.Promise&&(A=window.Promise);function a(){u&&(window.clearTimeout(u),u=null)}function n(e,t){var n;if(R.info("[WebRTCAdapter]: Destroying Data Channel (error: %s)",t&&t.message||t),e){n=e.label;try{e.close()}catch(e){R.info("[WebRTCAdapter]: Could not close the existing data channel")}e.onmessage=null,e.onopen=null,e.onclose=null,e.onerror=null}e=null,i&&i.send("remove-listeners",n)}function r(e){if(i&&this&&"open"===this.readyState){var t=JSON.parse(e.data);this.label.startsWith("SCREEN_CONTROL")?(t.dataChannelName=this.label,t.keysToOmitFromLogging=["key","keyCode"],R.debug("[WebRTCAdapter]: Sending controlling data to main process: ",t),i.send("screen-control-data",t)):R.warn("[WebRTCAdapter]: Received message for data channel "+this.label+" that cannot be handled")}else R.error("[WebRTCAdapter]: Cannot handle the received message. Data Channel has not been opened yet.")}function s(t,e){t?(t.binaryType="arraybuffer","number"==typeof t.bufferedAmountLowThreshold&&(t.bufferedAmountLowThreshold=65536),t.onopen=function(){"open"===t.readyState?(R.info("[WebRTCAdapter]: Data channel has been successfully opened."),e&&i&&i.send("register-listeners",t.label)):R.warn("[WebRTCAdapter]: Data channel has not been opened yet.")},e&&(t.onmessage=r),t.onclose=function(){n(t)},t.onerror=function(e){n(t,e)}):n(t,new Error("Data channel event is missing `channel` property"))}var c={VIDEO_1080:"1080p",VIDEO_720:"720p",VIDEO_480:"480p"},t=Object.freeze({RTP_QUALITY_POOR:{levelName:"poor",value:0,threshold:0},RTP_QUALITY_LOW:{levelName:"low",value:1,threshold:.1},RTP_QUALITY_MEDIUM:{levelName:"medium",value:2,threshold:.03},RTP_QUALITY_HIGH:{levelName:"high",value:3,threshold:0},getLevel:function(e){return e>this.RTP_QUALITY_LOW.threshold?this.RTP_QUALITY_LOW:e>this.RTP_QUALITY_MEDIUM.threshold?this.RTP_QUALITY_MEDIUM:this.RTP_QUALITY_HIGH}}),l={COLLECTION_INTERVAL:5e3,DELAY_UPON_ANSWER:e.isMobile()?0:5e3,DELAY_RTT_PROCESSING:3},v=function(e){if(e)try{e.oninactive=null;var t=function(e){return"function"==typeof e.getTracks?e.getTracks():e.getAudioTracks().concat(e.getVideoTracks())}(e);t.length&&t[0].stop?t.forEach(function(e){e.stop(),R.debug("[WebRTCAdapter]: Media track has been stopped:",e.label)}):e.stop&&e.stop(),R.info("[WebRTCAdapter]: Media stream has been stopped. Stream ID:",e.id)}catch(e){R.error("[WebRTCAdapter]: Failed to stop media stream. ",e)}},_=function(e){if(e)try{var t=e.getVideoTracks();t?t.forEach(function(e){e.stop&&"video"===e.kind&&!e.remote&&e.stop()}):R.info("[WebRTCAdapter]: No video tracks to be changed")}catch(e){R.error("[WebRTCAdapter]: Failed to disable local video tracks. ",e)}},g=function(e){try{e.close(),R.debug("[WebRTCAdapter]: RTCPeerConnection has been closed")}catch(e){R.error(e)}},N=function(){return!!navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.enumerateDevices&&"undefined"!=typeof HTMLMediaElement&&"function"==typeof HTMLMediaElement.prototype.setSinkId},d=[],u=null,E=null,m=function(e){if("function"==typeof e){var i,r,o;if(R.debug("[WebRTCAdapter]: Get audio output, microphone and camera devices"),!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return i=[{kind:"audio",id:"default",label:"",facing:""}],o=[{kind:"video",id:"default",label:"",facing:""}],void window.setTimeout(function(){e(i,o,null)},0);if(0<d.length)return R.debug("[WebRTCAdapter]: There is a pending MediaDevices.enumerateDevices() request"),void d.push(e);if(E&&E.validTimestamp>Date.now())return R.debug("[WebRTCAdapter]: Return cached devices"),i=E.audioSources,r=E.audioOutputs,o=E.videoSources,void window.setTimeout(function(){e(i,o,r)},0);var t=function(t,n,i){a();var e=d;d=[],e.forEach(function(e){try{e(t||[],n||[],i||null)}catch(e){}})}.bind(null);d.push(e),R.debug("[WebRTCAdapter]: Invoke MediaDevices.enumerateDevices()"),a(),u=window.setTimeout(function(){u=null,d.length&&(E?(R.error("[WebRTCAdapter]: MediaDevices.enumerateDevices timed out. Return cached devices."),i=E.audioSources,r=E.audioOutputs,o=E.videoSources):R.error("[WebRTCAdapter]: MediaDevices.enumerateDevices timed out. Device cache is empty, no devices available!"),t(i,o,r),t=null)},3e3),navigator.mediaDevices.enumerateDevices().then(function(e){e=e||[],i=[],r=[],o=[],R.info("[WebRTCAdapter]: MediaDevices.enumerateDevices returned "+e.length+" device(s)"),e.forEach(function(e){var t={id:e.deviceId,groupId:e.groupId,kind:e.kind,label:e.label};if(t.label){var n=t.label.match(/(.*)\s\(.*:.*\)/);t.label=n&&n[1]||t.label}switch(I.isElectron&&("default"!==t.id||t.label||(t.label="res_DefaultDeviceLabel")),t.kind){case"audioinput":i.push(t);break;case"audiooutput":r.push(t);break;case"videoinput":o.push(t)}}),0!==r.length&&N()||(r=null),R.debug("[WebRTCAdapter]: Update DeviceInfos cache"),E={audioSources:i,audioOutputs:r,videoSources:o},i.length?!i.some(function(e){return e.label})||o.length&&!o.some(function(e){return e.label})?(R.debug("[WebRTCAdapter]: User hasn't authorized access to audio and/or video input devices yet"),E.validTimestamp=0):E.validTimestamp=Date.now()+6e4:E.validTimestamp=0,t&&t(i,o,r)}).catch(function(e){R.error("[WebRTCAdapter]: Failed to enumerate devices. ",e),t&&t()})}},h=function(){R.debug("[WebRTCAdapter]: Cleared device info cache"),E=null},O=function(e){if(e&&e.iceServers){var n=[];e.iceServers.forEach(function(t){t.url?n.push(t):t.urls&&t.urls.forEach(function(e){n.push({url:e,credential:t.credential,username:t.username})})}),e.iceServers=n}},D=function(e,t){var n=[{autoGainControl:!!(e=e||{}).enableAudioAGC},{echoCancellation:!0}];return t?{advanced:n}:{optional:n}},P=function(e){return{optional:[{echoCancellation:!0},{googEchoCancellation:!0},{googEchoCancellation2:!0},{autoGainControl:!!(e=e||{}).enableAudioAGC},{googAutoGainControl:!!e.enableAudioAGC},{googAutoGainControl2:!!e.enableAudioAGC},{noiseSuppression:!0},{googNoiseSuppression:!0},{googNoiseSuppression2:!0},{googHighpassFilter:!0}]}},y=function(e){if(I.WebRTCAdapter.useNewConstraintSyntax)return function(e){var t;if(e&&e.videoResolution){switch(t={aspectRatio:{min:1.77,max:1.78},frameRate:{min:24,max:30}},e.minFrameRate&&(t.frameRate.min=Math.min(e.minFrameRate,t.frameRate.max)),e.sourceId&&(t.deviceId={exact:e.sourceId}),e.videoResolution){case c.VIDEO_1080:t.width={min:1920},t.height={min:1080};break;case c.VIDEO_720:t.width={min:1280},t.height={min:720};break;case c.VIDEO_480:t.width={min:854},t.height={min:480}}return t}return t={aspectRatio:{min:1.77,max:1.78}},e.sourceId&&(t.deviceId=e.sourceId),t}(e);var t={mandatory:{minAspectRatio:1.77,maxAspectRatio:1.78},optional:[{googNoiseReduction:!0}]};if(e)if(e.videoResolution)switch(t.mandatory.minFrameRate=24,t.mandatory.maxFrameRate=30,e.minFrameRate&&(t.mandatory.minFrameRate=Math.min(e.minFrameRate,t.mandatory.maxFrameRate)),e.sourceId&&(t.mandatory.sourceId=e.sourceId),e.videoResolution){case c.VIDEO_1080:t.mandatory.minWidth=1920,t.mandatory.maxWidth=1920,t.mandatory.minHeight=1080,t.mandatory.maxHeight=1080;break;case c.VIDEO_720:t.mandatory.minWidth=1280,t.mandatory.maxWidth=1280,t.mandatory.minHeight=720,t.mandatory.maxHeight=720;break;case c.VIDEO_480:t.mandatory.minWidth=853,t.mandatory.maxWidth=854,t.mandatory.minHeight=480,t.mandatory.maxHeight=480}else e.sourceId&&t.optional.push({sourceId:e.sourceId});return t},b=function(e,t){var n=e&&e.getAudioTracks();return!(!n||!n[0])&&(n[0].enabled=!!t,!0)},U=function(a,s,c){if(c=c||function(){},R.debug("[WebRTCAdapter]: Attach sinkId to audio element"),a)return s&&s.length?void(void 0!==a.sinkId&&I.WebRTCAdapter?(R.debug("[WebRTCAdapter]: Get media sources to find available device"),I.WebRTCAdapter.getMediaSources(function(e,t,n){var i=I.Utils.selectMediaDevice(n,s),r=i&&i.id||"";if(R.debug("[WebRTCAdapter]: Found audio output device to attach as sinkId. deviceId = ",r||"NONE"),a.sinkId===r)return R.debug("[WebRTCAdapter]: Audio output device is already attached to element"),void c();r||R.warn("[WebRTCAdapter]: A previously selected output device could not be found. Fallback to browser's default. Device not found: ",a.sinkId);var o=window.setTimeout(function(){o=null,R.error("[WebRTCAdapter]: Timed out attaching audio output device: ",r||"<default>"),c("timed out")},3e3);a.setSinkId(r).then(function(){o&&(window.clearTimeout(o),R.debug("[WebRTCAdapter]: Success, audio output device attached: ",r||"<default>"),c())}).catch(function(e){if(o){window.clearTimeout(o);var t=(e=e||{}).message||"unknown error";"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device."),R.error("[WebRTCAdapter]: Failed to attach output device. Device Id:"+r+" - ",t),c(t)}}),R.debug("[WebRTCAdapter]: setSinkId has been invoked")})):c("setSinkId not available")):(R.debug("[WebRTCAdapter]: There is no audio output device selected"),void c());c("Invalid parameters")},L=function(e){var t={offerToReceiveAudio:1,offerToReceiveVideo:1};return e&&(e.mandatory&&(e.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(t.offerToReceiveAudio=e.mandatory.OfferToReceiveAudio?1:0),e.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(t.offerToReceiveVideo=e.mandatory.OfferToReceiveVideo?1:0)),e.optional&&e.optional.some(function(e){return!!e.hasOwnProperty("VoiceActivityDetection")&&(t.voiceActivityDetection=!!e.VoiceActivityDetection,!0)})),t},M=function(r,o,a,s,c){function e(t){var e=function(e,t,n,i){if(!e||!e[t])return e;var r=e[t];if(r.mandatory){var o=r.mandatory[n];if(o){var a=(e=Object.create(e))[t];a.optional=a.optional||[];var s={};s[n]=o,a.optional.push(s),delete a.mandatory}}else{var c=r[i];c&&c.exact&&((e=Object.create(e))[t][i]=c.exact)}return e}(a,"audio","sourceId","deviceId");if(e!==a){R.warn("[WebRTCAdapter]: First getUserMedia attempt with required audio sourceId/deviceId failed. Falling back to optional.");var n=function(e){s(e,t)},i=r.apply(o,[e,n,c]);i&&i.then&&i.then(n).catch(c)}else c&&c(t)}var t=r.apply(o,[a,s,e]);t&&t.then&&t.then(s).catch(e)},w=function(t,n,i,r,o){var a=null,s=I.isElectron?1:3,c=0;function l(e){R.warn("[WebRTCAdapter]: Get user media failed: ",e&&e.name||e),a&&window.clearTimeout(a),a=null,o&&o(e),o=r=null}!function e(){R.info("[WebRTCAdapter]: Get user media attempt #:",c),a=null,c!==s?(++c,M(t,n,i,function(e,t){!function(e,t){R.info("[WebRTCAdapter]: Get user media succeeded"),r?r(e,t):v(e),o=r=null}(e,t),a&&window.clearTimeout(a),a=null},l),a=window.setTimeout(e,1e4)):l("Timeout")}()},G=function(e,t){if(e&&t&&t.isScreenControlled)if(R.info("[WebRTCAdapter]: Data channel will be created for supporting screen control"),t.isScreenOwner){var n=(new Date).toISOString(),i=t.screenControlChannelName+"_"+n,r=e.createDataChannel(i,o);s(r,!0),e.ondatachannel=null}else e.ondatachannel=function(e){s(e.channel,!1),this.dataChannel=e.channel,this.sendDataMessage=function(e){if(this.dataChannel&&"open"===this.dataChannel.readyState){var t;return e&&"object"==typeof e?(t=JSON.stringify(e),this.dataChannel.bufferedAmount+t.length<this.dataChannel.bufferedAmountLowThreshold?(e.keysToOmitFromLogging=["key","keyCode"],R.debug("[WebRTCAdapter]: Sending data over data channel: ",e),this.dataChannel.send(t),!0):(R.error("[WebRTCAdapter]: Cannot send data - Data channel buffer is full"),!1)):(R.error("[WebRTCAdapter]: Cannot send data - Data to send has incorrect format: ",typeof e),!1)}return R.error("[WebRTCAdapter]: Cannot send data - Data channel either not created or not ready"),!1}}.bind(e)},H=function(t,e,n,i,r){if(t&&e&&n){var o=[];i&&(e.degradationPreference=i,o.push("degradationPreference="+i)),e.encodings&&0<e.encodings.length?(e.encodings[0].maxBitrate=n,o.push("maxBitrate="+n),r&&(e.encodings[0].scaleResolutionDownBy=r,o.push("scaleResolutionDownBy="+r))):R.error("[WebRTCAdapter]: Unable to set max bitrate due to read-only encoding parameters for RtpSender mid="+t.mid),o.length&&t.sender.setParameters(e).then(function(){R.debug("[WebRTCAdapter]: Applied parameters {"+o+"} to RtpSender mid="+t.mid)}).catch(function(e){R.error("[WebRTCAdapter]: Could not apply parameters {"+o+"} to RtpSender mid="+t.mid+": ",e&&e.message||e)})}};return function e(){var r=I.TemasysAdapter,i=I.Utils.getBrowserInfo();try{if(i.chrome)return R.info("Setting WebRTC APIs for Chrome"),RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},void(I.WebRTCAdapter={enabled:!0,browser:"chrome",unifiedPlanEnabled:I.isUnitTestRun||72<=parseInt(i.version,10),useNewConstraintSyntax:!1,useReducedAudioConstraints:!0,MediaStream:webkitMediaStream,PeerConnection:function(e,t,n){var r=new webkitRTCPeerConnection(e,t);return r.origCreateOffer=r.createOffer,r.createOffer=function(t,n,e){var i;e&&(i=L(e)),r.origCreateOffer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origCreateAnswer=r.createAnswer,r.createAnswer=function(t,n,e){var i=L(e);r.origCreateAnswer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origGetStats=r.getStats,r.getStats=function(){return new A(function(e,t){r.origGetStats(e,t)})},G(r,n),r},SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,getUserMedia:function(e,t,n){w(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,e,t,n)},createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:v,stopLocalVideoTrack:_,closePc:g,getMediaSources:function(e){e&&m(e)},clearMediaSourcesCache:function(){h()},getAudioOptions:function(e){var t=Circuit.WebRTCAdapter.useReducedAudioConstraints?D(e,!1):P(e);return e&&e.sourceId&&"default"!==e.sourceId&&(t.mandatory=t.mandatory||{},t.mandatory.sourceId=e.sourceId),t},getVideoOptions:y,getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},setEncodingParameters:function(e,t,n,i){var r=e.sender.getParameters();H(e,r,t,n,i)},audioOutputSelectionSupported:N(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:U,toggleAudio:b,getNetmaskMap:function(){var t={};if(f){var n=f.networkInterfaces();Object.keys(n).forEach(function(e){(n[e]||[]).forEach(function(e){t[e.address]=e.netmask})})}return t}});if(i.firefox){R.info("Setting WebRTC APIs for Firefox");var o=function(e){e.ipAddress=e.address,e.portNumber=e.port,e.protocol=e.protocol||e.transport},a=function(e,t,n){var i="0"===n||"1"===n;switch(this.stats=e,this.id=e.id,e.type){case"inboundrtp":case"inbound-rtp":e.isRemote||(this.type="ssrc",this.stats.mid=n,"audio"===t?(this.stats.audioOutputLevel=!0,this.stats.googJitterReceived=e.jitter):this.stats.googFrameHeightReceived=!0,i&&(this.stats.googTrackId="audio"===t?"audio_main":"video_main"));break;case"outboundrtp":case"outbound-rtp":e.isRemote||(this.type="ssrc",this.stats.mid=n,"audio"===t?this.stats.audioInputLevel=!0:(this.stats.googFrameHeightSent=!0,this.stats.googFrameRateSent=e.framerateMean,this.stats.googTransmitBitrate=e.bitrateMean),i&&(this.stats.googTrackId="audio"===t?"audio_main":"video_main"));break;case"candidatepair":case"candidate-pair":this.type="googCandidatePair","boolean"==typeof e.selected&&e.selected&&"succeeded"===e.state?(this.stats.googActiveConnection="true",I.WebRTCAdapter.unifiedPlanEnabled?this.stats.googChannelId=e.transportId:"audio"===t&&(this.stats.googChannelId="Channel-audio-1")):this.discard=!0;break;case"local-candidate":this.type="localcandidate",o(this.stats);break;case"remote-candidate":this.type="remotecandidate",o(this.stats);break;default:this.type=e.type}};a.prototype.names=function(){return Object.keys(this.stats)},a.prototype.stat=function(e){return this.stats[e]};var s=function(e,n,i){var r,o=[];return e.forEach(function(e){var t=new a(e,n,i);t.discard||("googCandidatePair"===t.type&&(r=t.stats.transportId),o.push(t))}),r&&o.some(function(e){return"ssrc"===e.type&&(e.stats.transportId=r,!0)}),o},c=63<=parseInt(i.version,10),l="undefined"==typeof RTCPeerConnection?mozRTCPeerConnection:RTCPeerConnection,t="undefined"==typeof RTCSessionDescription?mozRTCSessionDescription:RTCSessionDescription,n="undefined"==typeof RTCIceCandidate?mozRTCIceCandidate:RTCIceCandidate;return void(I.WebRTCAdapter={enabled:!0,browser:"firefox",unifiedPlanEnabled:c,useNewConstraintSyntax:!0,MediaStream:MediaStream,PeerConnection:function(e,t,n){var r=new l(e);return r.origCreateOffer=r.createOffer,r.createOffer=function(t,n,e){var i;c||(i=L(e)),r.origCreateOffer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origCreateAnswer=r.createAnswer,r.createAnswer=function(t,n,e){c||L(e),r.origCreateAnswer(void 0).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origGetStats=r.getStats,r.getStats=function(){return function(e){var o=[],t=e.getTransceivers(),n=[];return t.forEach(function(r){r.receiver&&r.receiver.track?n.push(new A(function(i){r.receiver.getStats().then(function(e){var n=s(e,r.receiver.track.kind,r.mid);r.sender&&r.sender.track?r.sender.getStats().then(function(e){var t=s(e,r.sender.track.kind,r.mid);!function(e,t){t.some(function(t){return"ssrc"===t.type&&(t.stats.transportId&&e.some(function(e){return"ssrc"===e.type&&(e.stats.transportId=t.stats.transportId,!0)}),!0)})}(t,n),Array.prototype.push.apply(o,n),Array.prototype.push.apply(o,t),i()}).catch(function(e){R.debug("[WebRTCAdapter]: Error collecting stats for track: "+r.sender.track.label+" . Error: ",e),Array.prototype.push.apply(o,n),i()}):(Array.prototype.push.apply(o,n),i())}).catch(function(e){R.debug("[WebRTCAdapter]: Error collecting stats for track: "+r.sender.track.label+" . Error: ",e),i()})})):r.sender&&r.sender.track&&n.push(new A(function(t){r.sender.getStats().catch(function(e){R.debug("[WebRTCAdapter]: Error collecting stats for track: "+r.sender.track.label+" . Error: ",e)}).then(function(e){e&&Array.prototype.push.apply(o,s(e,r.sender.track.kind,r.mid)),t()})}))}),A.all(n).then(function(){return o})}(r)},r.removeStream=function(){},r.createDTMFSender=function(t){if("function"!=typeof r.getSenders)return null;var e=r.getSenders().find(function(e){return e.track===t}),n=e&&e.dtmf;return n?(n.canInsertDTMF=!0,n):null},r.addStream=function(e){var t=e.getAudioTracks()[0];t&&r.addTrack(t,e);var n=e.getVideoTracks()[0];n&&r.addTrack(n,e)},r.getRemoteStreams=function(){var n=[];return r.getReceivers().forEach(function(e){if(e.track&&e.track.mid){var t=new MediaStream([e.track]);n.push(t)}}),n},r.getLocalStreams=function(){var n=[];return r.getSenders().forEach(function(e){if(e.track){var t=new MediaStream([e.track]);n.push(t)}}),n},46<=parseInt(i.version,10)&&Object.defineProperty(r,"onaddstream",{enumerable:!0,get:function(){return r.onaddstreamCb},set:function(n){r.onaddstreamCb=n,r.ontrack=n?function(e){var t=e&&e.transceiver&&e.transceiver.mid;t&&e.track&&(e.track.mid=t),n({stream:e&&e.streams&&e.streams[0]})}:null}}),G(r,n),r},SessionDescription:t,IceCandidate:n,getUserMedia:function(e,t,n){w(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,e,t,n)},createObjectURL:function(e){return URL.createObjectURL(e)},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+(t.mid||t.id):""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+(t.mid||t.id):""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.mid||t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.mid||t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:v,stopLocalVideoTrack:_,closePc:function(e){window.setTimeout(function(){g(e)},500)},getMediaSources:function(e){e&&m(e)},clearMediaSourcesCache:function(){h()},getAudioOptions:function(e){var t=P(e);return e&&e.sourceId&&(t.deviceId={exact:e.sourceId}),t.advanced=t.optional,delete t.optional,t},getVideoOptions:y,getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return n.min=n.min||5,n.max=n.max||10,{mozMediaSource:e||"screen",mediaSource:e||"screen",width:{max:2560},height:{max:1600},advanced:[{frameRate:n}]}},setEncodingParameters:function(e,t,n,i){H(e,{encodings:[{}]},t,n,i)},audioOutputSelectionSupported:N(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:U,iceTimeoutSafetyFactor:.5,toggleAudio:b,getNetmaskMap:function(){return{}}})}if(i.safari){R.info("Setting WebRTC APIs for Safari");var d=function(e,t,n){var i="0"===n||"1"===n;switch(this.stats=e,this.id=e.id,e.type){case"inboundrtp":case"inbound-rtp":e.isRemote||(this.type="ssrc",this.stats.mid=n,"audio"===t?(this.stats.audioOutputLevel=!0,this.stats.googJitterReceived=1e3*e.jitter):this.stats.googFrameHeightReceived=!0,i&&(this.stats.googTrackId="audio"===t?"audio_main":"video_main"));break;case"outboundrtp":case"outbound-rtp":e.isRemote||(this.type="ssrc",this.stats.mid=n,"audio"===t?this.stats.audioInputLevel=!0:(this.stats.googFrameHeightSent=!0,this.stats.googFrameRateSent=e.framerateMean,this.stats.googTransmitBitrate=e.bitrateMean),i&&(this.stats.googTrackId="audio"===t?"audio_main":"video_main"));break;case"candidatepair":case"candidate-pair":this.type="googCandidatePair","succeeded"===e.state?(this.stats.googActiveConnection="true",this.stats.googChannelId=e.transportId,this.stats.googRtt=1e3*e.currentRoundTripTime):this.discard=!0;break;case"local-candidate":this.type="localcandidate",e.portNumber=e.port;break;case"remote-candidate":this.type="remotecandidate",e.portNumber=e.port;break;default:this.type=e.type}};d.prototype.names=function(){return Object.keys(this.stats)},d.prototype.stat=function(e){return this.stats[e]};var u=function(e,n,i){var r,o=[];return e.forEach(function(e){var t=new d(e,n,i);t.discard||("googCandidatePair"===t.type&&(r=t.stats.transportId),o.push(t))}),r&&o.some(function(e){return"ssrc"===e.type&&(e.stats.transportId=r,!0)}),o};return void(I.WebRTCAdapter={enabled:!0,browser:"safari",unifiedPlanEnabled:!0,useNewConstraintSyntax:!0,useReducedAudioConstraints:!0,MediaStream:MediaStream,PeerConnection:function(e,t,n){var r=new RTCPeerConnection(e,t);return r.origCreateOffer=r.createOffer,r.createOffer=function(t,n,e){var i;e&&(i=L(e)),r.origCreateOffer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origCreateAnswer=r.createAnswer,r.createAnswer=function(t,n,e){var i=L(e);r.origCreateAnswer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origSetLocalDescription=r.setLocalDescription,r.setLocalDescription=function(e,t,n){r.origSetLocalDescription(e).then(function(){t&&t()}).catch(function(e){n&&n(e)})},r.origSetRemoteDescription=r.setRemoteDescription,r.setRemoteDescription=function(e,t,n){r.origSetRemoteDescription(e).then(function(){t&&t()}).catch(function(e){n&&n(e)})},r.origGetStats=r.getStats,r.getStats=function(){return function(e){var o=[],t=e.getTransceivers(),n=[];return t.forEach(function(r){r.receiver&&r.receiver.track?n.push(new A(function(i){r.receiver.getStats().then(function(e){var n=u(e,r.receiver.track.kind,r.mid);r.sender&&r.sender.track?r.sender.getStats().then(function(e){var t=u(e,r.sender.track.kind,r.mid);!function(e,t){t.some(function(t){return"ssrc"===t.type&&(t.stats.transportId&&e.some(function(e){return"ssrc"===e.type&&(e.stats.transportId=t.stats.transportId,!0)}),!0)})}(t,n),Array.prototype.push.apply(o,n),Array.prototype.push.apply(o,t),i()}).catch(function(e){R.debug("[WebRTCAdapter]: Error collecting stats for track: "+r.sender.track.label+" . Error: ",e),Array.prototype.push.apply(o,n),i()}):(Array.prototype.push.apply(o,n),i())}).catch(function(e){R.debug("[WebRTCAdapter]: Error collecting stats for track: "+r.sender.track.label+" . Error: ",e),i()})})):r.sender&&r.sender.track&&n.push(new A(function(t){r.sender.getStats().catch(function(e){R.debug("[WebRTCAdapter]: Error collecting stats for track: "+r.sender.track.label+" . Error: ",e)}).then(function(e){e&&Array.prototype.push.apply(o,u(e,r.sender.track.kind,r.mid)),t()})}))}),A.all(n).then(function(){return o})}(r)},G(r,n),r},SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,getUserMedia:function(e,t,n){w(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,e,t,n)},createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:v,stopLocalVideoTrack:_,closePc:g,getMediaSources:function(e){e&&m(e)},clearMediaSourcesCache:function(){h()},getAudioOptions:function(e){var t=D(e,!0);return e&&e.sourceId&&(t.deviceId={exact:e.sourceId}),t},getVideoOptions:y,getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},setEncodingParameters:function(e,t,n){var i=e.sender.getParameters();H(e,i,t,n)},audioOutputSelectionSupported:N(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:U,toggleAudio:b,getNetmaskMap:function(){return{}}})}if(i.ios){R.info("Setting WebRTC APIs for iOS client");var E=function(t){this.id=t.id,this.type=t.type,this.timestamp=new Date(t.timestamp);var n={};Object.getOwnPropertyNames(t.values).forEach(function(e){n[e]=t.values[e]}),this.names=function(){return Object.getOwnPropertyNames(n)},this.stat=function(e){return n[e]},t=null},C=function(e){var t=e.map(function(e){return new E(e)});this.result=function(){return t},e=null};return void(I.WebRTCAdapter={enabled:!0,browser:"ios",unifiedPlanEnabled:!0,MediaStream:function(e){return navigator.createMediaStreamWithTracks(e)},PeerConnection:function(e,t){O(e);var n=RTCPeerConnection.createRTCPeerConnection(e,t);return n.origGetStats=n.getStats,n.getStats=function(){return new A(function(t){n.origGetStats(function(e){t(new C(e))})})},n.addIceCandidate=n.addIceCandidateJS,Object.defineProperties(n,{localDescription:{get:function(){return n.getLocalDescriptionJS()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return n.getRemoteDescriptionJS()},enumerable:!0,configurable:!1},signalingState:{get:function(){return n.getSignalingStateJS()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return n.getIceConnectionStateJS()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return n.getIceGatheringStateJS()},enumerable:!0,configurable:!1}}),n},SessionDescription:function(e){return RTCSessionDescription.createRTCSessionDescription(e)},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.streamId+" "+t.trackId:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.streamId+" "+t.trackId:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.trackId:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.trackId:""},getStreamId:function(e){return e&&e.streamId},getTrackId:function(e){return e&&e.trackId},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:v,stopLocalVideoTrack:_,closePc:g,getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:P,getVideoOptions:y,getDesktopOptions:function(){return{mandatory:{iOSMediaSource:"desktop"}}},setEncodingParameters:function(e,t){e&&e.sender&&t&&(e.sender.maxBitrate=t,R.debug("[WebRTCAdapter]: Applied maxBitrate {"+t+"} to RtpSender mid="+e.mid))},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:U,toggleAudio:b,getNetmaskMap:function(){return{}}})}if(i.android){var T;R.info("Setting WebRTC APIs for Android client");var p=function(n){this.id=n.id,this.type=n.type,this.timestamp=new Date(n.timestamp);var i={};Object.getOwnPropertyNames(n.values).forEach(function(e){var t=n.values[e];t.name&&(i[t.name]=t.value)}),this.names=function(){return Object.getOwnPropertyNames(i)},this.stat=function(e){return i[e]},n=null},S=function(e){var t=e.map(function(e){return new p(e)});this.result=function(){return t},e=null};return void(I.WebRTCAdapter={enabled:!0,browser:"android",unifiedPlanEnabled:!0,MediaStream:function(e){T||(T=RTCPeerConnectionUnified({sdpSemantics:"unified-plan"}));var t=T.createEmptyStream();return Array.isArray(e)?t.addTracks(e):t.addTrack(e),t},PeerConnection:function(e,t){O(e);var n=RTCPeerConnectionUnified(e,t);return n.getStats=function(){return new A(function(t){n.origGetStats(function(e){t(new S(e.data))})})},n},SessionDescription:function(e){return{type:e.type,sdp:e.sdp}},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:function(){return"dummy"},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:v,stopLocalVideoTrack:_,closePc:g,getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:P,getVideoOptions:y,getDesktopOptions:function(){return{mandatory:{androidMediaSource:"screen"}}},setEncodingParameters:function(){},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:U,toggleAudio:b,getNetmaskMap:function(){return{}}})}if(i.cordovaios)return R.info("Setting WebRTC APIs for Cordova iOS"),cordova.plugins.iosrtc.RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},cordova.plugins.iosrtc.RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},void(I.WebRTCAdapter={enabled:!0,browser:"cordovaios",unifiedPlanEnabled:!1,useNewConstraintSyntax:!0,MediaStream:cordova.plugins.iosrtc.MediaStream,PeerConnection:function(e,t){var r=new cordova.plugins.iosrtc.RTCPeerConnection(e,t);return r.origCreateOffer=r.createOffer,r.createOffer=function(t,n,e){var i=L(e);r.origCreateOffer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origCreateAnswer=r.createAnswer,r.createAnswer=function(t,n,e){var i=L(e);r.origCreateAnswer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origSetLocalDescription=r.setLocalDescription,r.setLocalDescription=function(e,t,n){r.origSetLocalDescription(e).then(function(){t&&t()}).catch(function(e){n&&n(e)})},r.origSetRemoteDescription=r.setRemoteDescription,r.setRemoteDescription=function(e,t,n){r.origSetRemoteDescription(e).then(function(){t&&t()}).catch(function(e){n&&n(e)})},r},SessionDescription:cordova.plugins.iosrtc.RTCSessionDescription,IceCandidate:cordova.plugins.iosrtc.RTCIceCandidate,getUserMedia:function(e,t,n){cordova.plugins.iosrtc.getUserMedia(e).then(t).catch(n)},createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:v,stopLocalVideoTrack:_,closePc:g,getMediaSources:function(e){e&&m(e)},clearMediaSourcesCache:function(){h()},getAudioOptions:function(e){var t=P(e);return e&&e.sourceId&&(t.deviceId=e.sourceId),t},getVideoOptions:function(e){var t=y(e);return e&&e.sourceId&&(t.deviceId=e.sourceId),t},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},setEncodingParameters:function(){},audioOutputSelectionSupported:N(),groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:U,toggleAudio:b,getNetmaskMap:function(){return{}}});if(r)return R.info("Setting WebRTC APIs for IE with Temasys plugin"),void(I.WebRTCAdapter={enabled:!0,browser:"msie",unifiedPlanEnabled:!1,PeerConnection:function(e,t,n){O(e);var i=r.PeerConnection(e,t);return G(i,n),i.origGetStats=i.getStats,i.getStats=function(){return new A(function(e,t){i.origGetStats(e,t)})},i},SessionDescription:r.SessionDescription,IceCandidate:r.IceCandidate,getUserMedia:function(e,t,n){M(r.getUserMedia,r,e,t,n)},createObjectURL:function(e,t,n){return r.createObjectURL(e,n)},attachMediaStream:r.attachMediaStream,getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.label+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.label+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:v,stopLocalVideoTrack:_,closePc:g,getMediaSources:function(i){"function"==typeof i&&r.getMediaSources(function(e){var t=[],n=[];e&&e.forEach(function(e){"audio"===e.kind?t.push(e):"video"===e.kind&&n.push(e)}),i(t,n,null)})},clearMediaSourcesCache:function(){},getAudioOptions:function(e){return!e||!e.sourceId||{mandatory:{sourceId:e.sourceId}}},getVideoOptions:function(e){return!e||!e.sourceId||{optional:[{sourceId:e.sourceId}]}},getDesktopOptions:function(){return{optional:[{sourceId:r.screensharingKey()}]}},setEncodingParameters:function(){},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:U,toggleAudio:b,getNetmaskMap:function(){return{}}});R.info("WebRTC is not supported")}catch(e){R.error("Failed to initialize WebRTCAdapter. ",e)}I.WebRTCAdapter={enabled:!1,browser:"",unifiedPlanEnabled:!1,PeerConnection:function(){},SessionDescription:function(){},IceCandidate:function(){},getUserMedia:function(e,t,n){n&&n("Not supported")},createObjectURL:function(){return""},getAudioStreamTrackId:function(){return""},getVideoStreamTrackId:function(){return""},getAudioTrackId:function(){return""},getVideoTrackId:function(){return""},getStreamId:function(){return""},getTrackId:function(){return""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(){return""},getVideoTrackLabel:function(){return""},stopMediaStream:function(){},stopLocalVideoTrack:function(){},closePc:function(){},getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:function(){return!1},getVideoOptions:function(){return!1},getDesktopOptions:function(){return!1},setEncodingParameters:function(){},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:function(e,t,n){n&&n()},toggleAudio:function(){return!1},getNetmaskMap:function(){return{}},init:e}}(),I.WebRTCAdapter.overridePromise=function(e){void 0===A&&(A=e)},I.Enums=I.Enums||{},I.Enums.VideoResolutionLevel=c,I.Enums.RtpQualityLevel=t,I.RtpStatsConfig=l,I}((Circuit=function(q){"use strict";var j=q.Constants,Q=q.Utils,X=Object.freeze({Disconnected:"Disconnected",Connecting:"Connecting",Reconnecting:"Reconnecting",Connected:"Connected",Ready:"Ready"});return q.ConnectionController=function(e){var n,i,r,o,a,s,c=q.logger;o=Q.isMobile()?s=a=r=n=i=0:(i=0,n=7e3,r=8e3,a=64e3,s=1350,1);var t=4e3,l=20,d=2e3,u=200,E=200,C=5,T=this,p=null,S=null,I=null,A=X.Disconnected,R=0,f=0,v=null,_=null,g=null,N=e||{},m=null,h=null,O=[],D=[],P=null,y=null;function b(e,t){if("function"==typeof e)try{e(t)}catch(e){c.error(e)}}function U(){c.debug("[CONN]: online event received"),g&&(c.debug("[CONN]: Clear offline timeout"),window.clearTimeout(g),g=null),A===X.Reconnecting&&(R=r,T.reconnect(null,1e3))}function L(){c.debug("[CONN]: offline event received"),A===X.Connected&&(window.addEventListener("online",U),g||(g=window.setTimeout(function(){g=null,window.navigator.onLine||(c.debug("[CONN]: The client is offline. Change state to Reconnecting."),T.reconnect())},t)))}function M(){p&&(p.onopen=null,p.onclose=null,p.onmessage=null,p.onerror=null,p=null)}function w(e){if(e!==A){c.debug("[CONN]: Changed connection state from "+A+" to "+e),c.debug("[CONN]: Raising connectionStateChange event");var t=A;A=e,window.setTimeout(function(){!function(e,t){b(T.onStateChange,{newState:e,oldState:t})}(e,t)},0)}}function G(e){try{S&&S(e)}catch(e){c.error("[CONN]: Exception on errorCallback. ",e)}finally{I=S=null}}function H(){P&&(window.clearTimeout(P),P=null),D=[],O=[]}function k(e){if(v&&(window.clearTimeout(v),v=null),_&&(window.clearTimeout(_),_=null),H(),p){c.debug("[CONN]: Disconnecting from server");var t=p;M(),t.close()}e||(window.removeEventListener&&(window.removeEventListener("online",U),window.removeEventListener("offline",L)),w(X.Disconnected))}function V(e){e===p&&(c.info("[CONN]: WebSocket is opened"),f=R=0,A!==X.Disconnected&&(w(X.Connected),window.addEventListener&&(window.addEventListener("offline",L),window.removeEventListener("online",U)),function(){try{c.debug("[CONN]: Registered Successfully"),I&&I()}catch(e){c.error("[CONN]: Exception on successCallback. ",e)}finally{I=S=null}}()))}function F(e,t){if(e===p)switch(H(),t=t||{},c.info("[CONN]: WebSocket is closed. Code: "+t.code+". Reason:",t.reason),A){case X.Connected:case X.Reconnecting:A===X.Reconnecting&&b(T.onReconnectFailed),w(X.Reconnecting),function(){if(Q.isMobile())c.warn("[CONN]: Mobile Client - Do not attempt to reconnect from JS");else{if(0<s&&s<=f)return c.warn("[CONN]: Reached max number of attempts reconnecting to WebSocket"),k();!1===window.navigator.onLine?(c.warn("[CONN]: Client is offline. Set retry timer to max value."),R=a):R||(R=y&&y()?(c.info("[CONN]: Client has an active call. Use priority reconnection timeout"),Q.randomNumber(i,n)):n+Q.randomNumber(0,r)),c.info("[CONN]: Retry to open socket in "+R/1e3+" seconds"),v=window.setTimeout(function(){v=null,x()},R),R<a&&(R=o<++f?2*R:r,R=Math.min(R,a))}}();break;case X.Connecting:k(),c.error("[CONN]: Failed to open WebSocket connection"),G("Failed to open WebSocket connection")}}function B(e,t){if(e===p)try{if(!t.data||"PING"===t.data)return;var n=t.data;if(!N.doNotParseMessages)try{n=JSON.parse(n)}catch(e){return void c.error("[CONN]: Message discarded (Cannot Parse): ",t.data)}!function(e){b(T.onMessage,e)}(n)}catch(e){c.error(e)}}function x(){if(A===X.Connecting||A===X.Reconnecting){M(),c.info("[CONN]: Opening WebSocket to ",h);try{switch(window.navigator.platform){case"iOS":p=WebSocket.createWebSocket(m);break;case"node":p=new WebSocket(m,N.cookie);break;default:p=new WebSocket(m)}}catch(e){return c.error("[CONN]: Failed to connect WebSocket. ",e),void G(e)}p.onopen=V.bind(null,p),p.onclose=F.bind(null,p),p.onmessage=B.bind(null,p),p.onerror=function(e,t){e===p&&(H(),A!==X.Reconnecting&&A!==X.Connected?(c.error("[CONN]: WebSocket Connection Error"),w(X.Disconnected),M(),G("Failed to open WebSocket connection")):"node"!==window.navigator.platform&&"iOS"!==window.navigator.platform&&"Android"!==window.navigator.platform||(c.error("[CONN]: WebSocket connection error. Force _socket.onclose. ",t),p.onclose()))}.bind(null,p)}}function W(){var t=Date.now(),e=O.findIndex(function(e){return t-e<d});-1===e?O=[]:O.splice(0,e)}function Y(){if(!P){var e=u;O.length>=l&&(e+=d-(Date.now()-O[0])),c.info("[CONN]: Start throttle timeout with delay = ",e),P=window.setTimeout(function(){P=null,function(){c.info("[CONN]: Dequeue throttled messages. Number of queued messages = ",D.length),W();var e=0;for(;0<D.length&&O.length<l&&e<C;)K(D.shift()),e++;0<D.length?(c.warn("[CONN]: Number of remaining queued messages = ",D.length),Y()):c.info("[CONN]: Dequeued all throttled messages")}()},e)}}function K(e){try{var t=e.request&&e.request.requestId||"N/A";p.send(JSON.stringify(e)),O.push(Date.now()),c.debug("[CONN]: Sent message with requestId:",t)}catch(e){c.error("[CONN]: Failed to send message. ",e)}}this.onStateChange=null,this.onReconnectFailed=null,this.onMessage=null,this.getState=function(){return A},this.isConnected=function(){return A===X.Connected},this.setTarget=function(e){h=(m=e).split("?")[0]},this.connect=function(e,t,n){c.debug("[CONN]: Connect WebSocket to ",e),A!==X.Disconnected&&k(!0),T.setTarget(e),I=t||function(){},S=n||function(){},w(X.Connecting),window.setTimeout(x,0)},this.disconnect=function(){c.debug("[CONN]: Disconnect WebSocket from ",h),k()},this.reconnect=function(e,t){c.debug("[CONN]: Reconnect WebSocket to ",h),k(!0),e&&T.setTarget(e),w(X.Reconnecting),_=window.setTimeout(function(){_=null,x()},t||50)},this.sendMessage=function(e,t){return A!==X.Connected?(c.warn("[CONN]: WebSocket is not connected. Cannot send message. ",e),!1):e?(t||c.msgSend("[CONN]: ",e),"string"==typeof e?"PING"===e&&Q.isMobile()?p.ping():p.send(e):(delete e.keysToOmitFromLogging,!P&&(O.length>=l&&W(),O.length<l)?K(e):function(e){return!(!e.request||!e.request.user||e.request.user.type!==j.UserActionType.LOGOUT)}(e)?(K(e),H()):(function(e){c.warn("[CONN]: Throttling limit exceeded. Queue the message."),D.length>=E?c.error("[CONN]: Throttling queue is full. Drop the message."):(D.push(e),c.info("[CONN]: Queued message #",D.length))}(e),Y())),!0):(c.error("[CONN]: Data is missing. Cannot send message."),!1)},this.injectHasActiveCall=function(e){y="function"==typeof e?e:null}},q.Enums=q.Enums||{},q.Enums.ConnectionState=X,q}((Circuit=function(e){"use strict";var n=e.Utils,i=Object.freeze({TLS:{name:"tls",start:0,end:11e6},TCP:{name:"tcp",start:12e6,end:31e6},UDP:{name:"udp",start:35e6,end:6e7}}),t=Object.freeze({VP8:"VP8",VP9:"VP9",H264:"H264"});function d(e){if(e){var t=(e=e.replace(/(a=)*candidate:([^\r]+)(\r\n)*/i,"$2")).split(" ");if(t.length<7)throw new Error("Invalid candidate: "+e);this.foundation=parseInt(t[0],10),this.componentId=parseInt(t[1],10),this.transport=t[2].toLowerCase(),this.priority=parseInt(t[3],10),this.address=t[4],this.port=parseInt(t[5],10),this.typ=t[7],this.optional=[];for(var n=8;n<t.length;n+=2)this.optional.push(t[n]),this[t[n]]=t[n+1]}else this.foundation=1,this.componentId=1,this.transport="udp",this.priority=1,this.address="0.0.0.0",this.port=1,this.typ="host",this.generation=0,this.optional=[]}d.prototype.equals=function(e){return e=e&&"string"!=typeof e?e:new d(e),this.foundation===e.foundation&&this.componentId===e.componentId&&this.transport===e.transport&&this.priority===e.priority&&this.address===e.address&&this.port===e.port&&this.typ===e.typ},d.prototype.isRtp=function(){return 1===this.componentId},d.prototype.isRtcp=function(){return 2===this.componentId},d.prototype.isTcpTlsRelay=function(){return"relay"===this.typ&&this.priority<=i.TCP.end},d.prototype.getRelayClientTransportType=function(){var t="";if("relay"===this.typ){var n=this.priority;[i.TLS,i.TCP,i.UDP].some(function(e){return n>=e.start&&n<=e.end&&(t=e.name,!0)})}return t},d.prototype.getValue=function(){for(var e=this.foundation+" "+this.componentId+" "+this.transport+" "+this.priority+" "+this.address+" "+this.port+" typ "+this.typ,t=0;t<this.optional.length;t++){var n=this.optional[t];e+=" "+n+" "+this[n]}return e},d.prototype.getParsedAttribute=function(){return{field:"candidate",value:this.getValue()}},d.prototype.toString=function(){return"candidate:"+this.getValue()};var u,c,r,o=(u=Circuit.logger,c=/^(\w+) +(\d+)(?:\/(\d))? +(\S+)(?: (\d+( +\d+)*))?/,r={o:function(e){return[e.username||"-",e.id,e.version,e.nettype||"IN",e.addrtype||"IP4",e.address].join(" ")},c:function(e){return[e.nettype||"IN",e.addrtype||"IP4",e.address].join(" ")},m:function(e){return[e.media||"audio",e.port||"0",e.proto||"RTP/AVP",e.fmt.join(" ")].join(" ")},a:function(e){return e.value?[e.field,e.value].join(":"):e.field}},{parse:T,stringify:function(e){var t="";return t+=a(e,"v",0),t+=a(e,"o"),t+=a(e,"s","-"),t+=a(e,"i"),t+=a(e,"u"),t+=a(e,"e"),t+=a(e,"p"),t+=a(e,"c"),t+=a(e,"b"),t+=a(e,"t","0 0"),t+=a(e,"r"),t+=a(e,"z"),t+=a(e,"k"),t+=a(e,"a"),e.m.forEach(function(e){t+=a({m:e},"m"),t+=a(e,"i"),t+=a(e,"c"),t+=a(e,"b"),t+=a(e,"k"),t+=a(e,"a")}),t},getConnectionMode:p,getVideoConnectionModes:function(e){var t="string"==typeof e?T(e):e,n=[];return t.m&&t.m.forEach(function(e){"video"===e.media&&e.a.some(function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":return n.push(e.field),!0}return!1})}),n},setConnectionMode:function(e,t,n){var i="string"==typeof e?T(e):e,r=t&&"both"!==t?[t]:["audio","video"];return"both"===t&&i.a&&(i.a=s(i.a),i.a.push({field:n})),i.m&&i.m.forEach(function(e){r.includes(e.media)&&(e.a=s(e.a),e.a.push({field:n}))}),i},isHold:function(e){var t=p(e);return"inactive"===t||"sendonly"===t},disableMultiplex:function(e){var t="string"==typeof e?T(e):e;return t.a&&(t.a=t.a.filter(function(e){return"group"!==e.field})),t},isMultiplexEnabled:function(e){var t="string"==typeof e?T(e):e;return!!t.a&&t.a.some(function(e){return"group"===e.field&&e.value&&e.value.startsWith("BUNDLE")})},hasVideo:function(e){var n="string"==typeof e?T(e):e;return!!n.m&&n.m.some(function(e,t){return"video"===e.media&&0!==e.port&&0!==e.fmt.length&&"inactive"!==p(n,{mLineIndex:t})&&e.a.some(function(e){return"rtpmap"===e.field&&/VP[89]/.test(e.value)})})},addEmptyVideoLine:function(e){var t="string"==typeof e?T(e):e;return t.m.push({media:"video",port:0,proto:"RTP/SAVPF",fmt:[100],c:{nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a:[{field:"inactive"}]}),t},removeVideo:function(e){var t="string"==typeof e?T(e):e;return t.m&&t.m.forEach(function(e){"video"===e.media&&(e.port=0,e.c={nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},e.a=e.a.filter(function(e){return"mid"===e.field}),e.a.push({field:"inactive"}))}),t},setOpusParameters:function(e,r){var t="string"==typeof e?T(e):e;return t.m&&r&&(r=n.shallowCopy(r),t.m.forEach(function(e){var n;"audio"===e.media&&e.a&&(e.a.some(function(e){return!("rtpmap"!==e.field||!e.value.includes("opus")||(n=e.value.split(" ")[0],0))}),n&&e.a.some(function(e){if("fmtp"===e.field&&e.value.includes(n)){e.value.substring(n.length+1).split(";").forEach(function(e){var t=e.split("="),n=t[0].trim(),i=t[1].trim();r.hasOwnProperty(n)||(r[n]=i)});var t=Object.keys(r).map(function(e){return e+"="+r[e]});return e.value=n+" "+t.join(";"),!0}return!1}))})),t},setVideoBandwidth:function(e,n,i,r){var t="string"==typeof e?T(e):e;return t.m&&t.m.forEach(function(e,t){if("video"===e.media){if(0<=r&&r!==t)return;i?n&&0<n.valueOf()?e.b=["AS:"+n,"TIAS:"+1e3*n]:(S(e.b)||I(e.b))&&delete e.b:(S(e.b)||C(e,"b","AS:"+n),I(e.b)||C(e,"b","TIAS:"+1e3*n))}}),t},setXGoogle:function(e,r,t){var n="string"==typeof e?T(e):e;return n.m&&r&&n.m.forEach(function(n,e){if("video"===n.media&&n.a&&!(0<=t&&t!==e)){var i=[];n.a=n.a.filter(function(e,t){return"rtpmap"===e.field&&/VP[89]/.test(e.value)&&i.push({idx:t+i.length,pt:e.value.split(" ")[0]}),("fmtp"!==e.field||e.value&&!e.value.includes("x-google"))&&"x-google-buffer-latency"!==e.field}),i.forEach(function(e){var t=[];r.minBitRate&&0<r.minBitRate.valueOf()&&t.push("x-google-min-bitrate="+r.minBitRate),r.maxBitRate&&0<r.maxBitRate.valueOf()&&t.push("x-google-max-bitrate="+r.maxBitRate),r.startBitRate&&0<r.startBitRate.valueOf()&&t.push("x-google-start-bitrate="+r.startBitRate),r.maxQuantization&&0<r.maxQuantization.valueOf()&&t.push("x-google-max-quantization="+r.maxQuantization),0<t.length&&(t=e.pt+" "+t.join("; "),n.a.splice(e.idx+1,0,{field:"fmtp",value:t}))})}}),n},setPreferredVideoCodec:function(e,o){var t="string"==typeof e?T(e):e;return t.m&&o&&t.m.forEach(function(e,t){if("video"===e.media){var n=e.a.find(function(e){return"rtpmap"===e.field&&e.value.includes(o)});if(n){var i=parseInt(n.value.split(" ")[0],10),r=e.fmt.indexOf(i);0<r&&(e.fmt.splice(r,1),e.fmt.unshift(i),u.debug("[SdpParser]: Prefer "+o+" format for video m-line #:",t))}}}),t},removeVideoBandwidth:function(e){var t="string"==typeof e?T(e):e;return t.m&&t.m.forEach(function(e){"video"===e.media&&(e.b=e.b&&e.b.filter(function(e){return!e.startsWith("AS:")&&!e.startsWith("TIAS:")}))}),t},removeAudioLevelAttr:function(e){var t="string"==typeof e?T(e):e;return t.m&&t.m.forEach(function(e){"audio"===e.media&&(e.a=e.a&&e.a.filter(function(e){return"extmap"!==e.field||!e.value||!e.value.includes("ssrc-audio-level")}))}),t},isTrickleIceOption:function(e){function t(e){return"ice-options"===e.field&&e.value&&e.value.includes("trickle")||"inactive"===e.field}var n="string"==typeof e?T(e):e;return n.a=n.a||[],n.a.some(t)||n.m&&0<n.m.length&&n.m.every(function(e){return e.a&&e.a.some(t)})},fixTrickleIceOption:function(e,t){function n(e,t,n){return"ice-options"===e.field&&(e.value=e.value||"",e.value=e.value.replace(/trickle\s*/gi,"").trim(),e.value||(u.debug("[SdpParser]: There are no other ice-options - remove the attribute."),n.splice(t,1)),!0)}var i="string"==typeof e?T(e):e;i.a=i.a||[];var r=this.isTrickleIceOption(i);return t&&!r?(u.debug("[SdpParser]: Adding Trickle ICE indication"),i.a.some(function(e){return"ice-options"===e.field&&(e.value=(e.value||"")+" trickle",!0)})||i.a.push({field:"ice-options",value:"trickle"})):!t&&r&&(u.debug("[SdpParser]: Removing Trickle ICE indication"),i.a.some(n),i.m.forEach(function(e){e.a&&e.a.some(n)})),i},addEndOfCandidatesLine:function(e){var t="string"==typeof e?T(e):e;return t.m&&t.m.forEach(function(e){e.a=e.a||[],e.a.some(function(e){return"end-of-candidates"===e.field})||e.a.push({field:"end-of-candidates"})}),t},removeEndOfCandidatesLine:function(e){var t="string"==typeof e?T(e):e;return t.m&&t.m.forEach(function(n){n.a&&n.a.some(function(e,t){return"end-of-candidates"===e.field&&(n.a.splice(t,1),!0)})}),t},validateIceCandidates:function(e,n,i){return!("string"==typeof e?T(e):e).m.some(function(e,t){return!function e(n,t,i,r){if(0===n.port)return!0;var o=0,a=!1,s=null,c=null,l=n.a.filter(function(e){if("candidate"!==e.field)return!0;var t=new d(e.value);if("udp"!==t.transport)return!1;if(i&&"video"===n.media){if("relay"!==t.typ)return!(a=!0);if(!t.isTcpTlsRelay())return u.debug("[SdpParser]: Removed UDP relay candidate: ",e.value),!(a=!0);!s&&t.isRtp()&&(s=t),!c&&t.isRtcp()&&(c=t)}return o++,!0});return s||!a||r?!(0===o&&!r||(n.a=l,c&&n.a.some(function(e){return"rtcp"===e.field&&(e.value=c.port+" IN IP4 "+c.address,!0)}),s&&(n.port=s.port,n.c&&(n.c.address=s.address)),0)):(u.info("[SdpParser]: Media description does not have TCP/TLS relay candidates. Do not filter UDP candidates!"),e(n,t,!1))}(e,t,n,i)})},isNoOfferSdp:function(e){return!!e&&""===e.sdp&&"nooffer"===e.type},iceTotalCandidatesCount:function(e){var t=0;return("string"==typeof e?T(e):e).m.forEach(function(e){e.a.forEach(function(e){"candidate"===e.field&&t++})}),t},getIceCandidates:function(e){var t=[];return("string"==typeof e?T(e):e).m.forEach(function(e){e.a.forEach(function(e){"candidate"===e.field&&t.push(new d(e.value))})}),t},removeAudioMediaProtocols:function(e,n){var t="string"==typeof e?T(e):e;return n&&n.length&&t.m.some(function(e){if("audio"===e.media&&e.proto){var t=e.proto.split("/");return t=t.filter(function(e){return!n.includes(e)}),e.proto=t.join("/"),!0}return!1}),t},verifyFingerprintInMLines:function(e){var n="string"==typeof e?T(e):e;return n.m&&n.m.forEach(function(t,e){t.a.some(function(e){return"fingerprint"===e.field})||n.a.some(function(e){return"fingerprint"===e.field&&(t.a.push(e),!0)})||u.debug("[SdpParser]: verifyFingerprintInMLines(): No session fingerprint found for video m-line #:",e)}),n},findMediaLineIndex:function(e,t){return t?function(e,t){return e.m.findIndex(function(e){return e.a.some(function(e){return"mid"===e.field&&e.value===t})})}("string"==typeof e?T(e):e,t):-1},setMediaIdAttribute:function(e,t,n,i){var r=("string"==typeof e?T(e):e).m[t];r&&(r.a.some(function(e){return"mid"===e.field&&(i&&(e.value=n),!0)})||r.a.push({field:"mid",value:n}))},getMediaIds:function(e){var t="string"==typeof e?T(e):e,i={};return t.m.forEach(function(e){var t,n;e.a&&e.a.some(function(e){return"mid"===e.field?t=e.value:"msid"===e.field&&(n=e.value),t&&n})&&(i[n]=t)}),i},getOrigin:function(e){if("string"!=typeof e)return a(e,"o");var t=/(o=[^\r]+)\r\n/i.exec(e);return t&&t[1]||""},getSsrcList:function(e){var t="string"==typeof e?T(e):e,n=[];return t.a.forEach(function(e){"ssrc"===e.field&&n.push(e.value.split(" ")[0])}),n}});function l(e){var t=e.split(/\s+/);return{nettype:t[0],addrtype:t[1],address:t[2]}}function E(e){var t=/^([^:]+)(?::(.*))?/.exec(e);return{field:t[1],value:t[2]}}function C(e,t,n){switch(t){case"v":case"o":case"s":case"i":case"u":case"e":case"p":case"c":e[t]=n;break;default:e[t]?e[t].push(n):e[t]=[n]}}function a(e,t,n){if(void 0===e[t])return n?t+"="+n+"\r\n":"";function i(e){return t+"="+(r[t]&&r[t](e)||e)+"\r\n"}return Array.isArray(e[t])?e[t].map(i).join(""):i(e[t])}function s(e){return e.filter(function(e){switch(e.field){case"inactive":case"recvonly":case"sendonly":case"sendrecv":return!1}return!0})}function T(e){var t,n,i=e.split(/\r\n/),r={};for(t=0;t<i.length&&((n=/^(\w)=(.*)/.exec(i[t]))&&"m"!==n[1]);++t)"a"===n[1]&&n[2]?C(r,n[1],E(n[2])):C(r,n[1],n[2]);r.m=[];for(var o,a,s=null;t<i.length&&(n=/(\w)=(.*)/.exec(i[t]));++t)"m"===n[1]?(o=n[2],a=void 0,s={media:(a=c.exec(o))[1],port:+a[2],portnum:+(a[3]||1),proto:a[4],fmt:a[5]?a[5].split(/\s+/).map(function(e){return+e}):[]},r.m.push(s)):"a"===n[1]&&n[2]?C(s,n[1],E(n[2])):C(s,n[1],n[2]);return r.s&&""!==r.s.trim()||(r.s="-"),r.o&&(r.o=function(e){var t=e.split(/\s+/);return{username:t[0],id:t[1],version:t[2],nettype:t[3],addrtype:t[4],address:t[5]}}(r.o)),r.c&&(r.c=l(r.c)),r.m.forEach(function(e){e.c&&(e.c=l(e.c))}),r}function p(e,t){var n="string"==typeof e?T(e):e,i="sendrecv";return void 0!==(t=t||{}).mLineIndex?n.m[t.mLineIndex].a.forEach(function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":i=e.field}}):(t.mediaType&&"both"!==t.mediaType||(t.mediaType="audio"),n.a&&n.a.forEach(function(e){switch(e.field){case"sendonly":case"recvonly":case"inactive":i=e.field}}),n.m&&n.m.forEach(function(e){e.media===t.mediaType&&e.a.forEach(function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":i=e.field}})})),i}function S(e){return!!Array.isArray(e)&&e.some(function(e){return e.includes("AS:")})}function I(e){return!!Array.isArray(e)&&e.some(function(e){return e.includes("TIAS:")})}return e.IceCandidate=d,e.sdpParser=o,e.Enums=e.Enums||{},e.Enums.VideoCodecs=t,e}((Circuit=function(t){"use strict";var r,o,a=t.logger,s=t.Utils,c=Object.freeze({WSMessageType:{REQUEST:"REQUEST",RESPONSE:"RESPONSE",EVENT:"EVENT"},ContentType:{SYSTEM:"SYSTEM",NONE:"NONE",EXTENSION:"EXTENSION",CONVERSATION:"CONVERSATION",USER:"USER",RTC_SESSION:"RTC_SESSION",RTC_CALL:"RTC_CALL",SEARCH:"SEARCH",KEEPALIVE:"KEEPALIVE",INSTRUMENTATION:"INSTRUMENTATION",GUEST:"GUEST",ADMINISTRATION:"ADMINISTRATION",THIRDPARTYCONNECTORS:"THIRDPARTYCONNECTORS",USER_TO_USER:"USER_TO_USER",VERSION:"VERSION",SANITY_CHECK:"SANITY_CHECK",WEB_HOOK:"WEB_HOOK",ACCOUNT:"ACCOUNT",ACTIVITYSTREAM:"ACTIVITYSTREAM",PROVISIONING:"PROVISIONING",RTC_CONNECTION:"RTC_CONNECTION",CONVERSATION_USER_DATA:"CONVERSATION_USER_DATA",MS_CONNECTOR:"MS_CONNECTOR",SPACE:"SPACE",CPAAS:"CPAAS",TEAM:"TEAM",USER_DATA:"USER_DATA"},ReturnCode:{OK:"OK",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",AUTHORIZATION_REQUIRED:"AUTHORIZATION_REQUIRED",SERVICE_EXCEPTION:"SERVICE_EXCEPTION",PROTOBUF_CONVERSION_EXCEPTION:"PROTOBUF_CONVERSION_EXCEPTION",CONVERSION_EXCEPTION:"CONVERSION_EXCEPTION",NO_MESSAGE_HANDLER:"NO_MESSAGE_HANDLER",INVALID_CLIENT:"INVALID_CLIENT",NO_RESULT:"NO_RESULT",OPERATION_NOT_SUPPORTED:"OPERATION_NOT_SUPPORTED",ENTITY_ALREADY_EXISTS:"ENTITY_ALREADY_EXISTS",FRAME_SIZE_TO_LONG:"FRAME_SIZE_TO_LONG",BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",OVERLOADED:"OVERLOADED",OLD_VERSION:"OLD_VERSION",STORAGE_OVERLOADED:"STORAGE_OVERLOADED",USER_NOT_FOUND:"USER_NOT_FOUND",CLOUD_TELEPHONY_EXCEPTION:"CLOUD_TELEPHONY_EXCEPTION",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",DISCONNECTED:"DISCONNECTED",INVALID_MESSAGE:"INVALID_MESSAGE",FAILED_TO_SEND:"FAILED_TO_SEND",UNEXPECTED_RESPONSE:"UNEXPECTED_RESPONSE",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",CHOOSE_DESKTOP_MEDIA_CANCELLED:"CHOOSE_DESKTOP_MEDIA_CANCELLED",REQUEST_CANCELED:"REQUEST_CANCELED",SDK_ERROR:"SDK_ERROR"},ErrorCode:{UNEXPECTED_ERROR:"UNEXPECTED_ERROR",CONSTRAINT_VIOLATION:"CONSTRAINT_VIOLATION",MAX_NUM_CONV_PARTICIPANTS:"MAX_NUM_CONV_PARTICIPANTS",THIRDPARTY_ERROR:"THIRDPARTY_ERROR",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",PERMISSION_DENIED:"PERMISSION_DENIED",RTC_NO_MEDIA_NODES_AVAILABLE:"RTC_NO_MEDIA_NODES_AVAILABLE",RTC_CONCURRENT_INCOMING_CALL:"RTC_CONCURRENT_INCOMING_CALL",DUPLICATED_ENTITY_ERROR:"DUPLICATED_ENTITY_ERROR",RTC_MEDIA_NODE_UNREACHABLE:"RTC_MEDIA_NODE_UNREACHABLE",CLOUD_TELEPHONY_ERROR:"CLOUD_TELEPHONY_ERROR",CIRCUIT_EXCEPTION:"CIRCUIT_EXCEPTION"},CircuitExceptionErrorCode:{INWEB_00000C:"INWEB-00000C",INWEB_00001C:"INWEB-00001C",INWEB_00002C:"INWEB-00002C",INWEB_00003C:"INWEB-00003C",INWEB_00004C:"INWEB-00004C",INWEB_00005C:"INWEB-00005C",SPACE_00004C:"SPACE-00004C",SPACE_00024C:"SPACE-00024C",SPACE_00032C:"SPACE-00032C",SPACE_00035C:"SPACE-00035C",SPACE_00045C:"SPACE-00045C"},ThirdPartyError:{UNSUPPORTED_PROVIDER:"UNSUPPORTED_PROVIDER",BAD_REQUEST:"BAD_REQUEST",GENERAL_ERROR:"GENERAL_ERROR",INSUFFICIENT_PERMISSION:"INSUFFICIENT_PERMISSION",NOT_AUTHORIZED:"NOT_AUTHORIZED",RESOURCE_NOT_FOUND:"RESOURCE_NOT_FOUND",SERVER_DOWN:"SERVER_DOWN",SESSION_EXPIRED:"SESSION_EXPIRED",UNSUPPORTED_FILE_TYPE:"UNSUPPORTED_FILE_TYPE",WRONG_SERVER:"WRONG_SERVER",EMPTY_SETTINGS:"EMPTY_SETTINGS",EMPTY_USERNAME:"EMPTY_USERNAME",EMPTY_PASSWORD:"EMPTY_PASSWORD",EMPTY_SERVER_ADDRESS:"EMPTY_SERVER_ADDRESS",INVALID_SERVER_ADDRESS:"INVALID_SERVER_ADDRESS",NOT_CONNECTED:"NOT_CONNECTED",ALREADY_CONNECTED:"ALREADY_CONNECTED",INVALID_ITEMIDS:"INVALID_ITEMIDS",INVALID_SITEID:"INVALID_SITEID",TOO_MANY_REQUESTS:"TOO_MANY_REQUESTS"},CloudTelephonyErrorType:{CMP_NEXT:"CMP_NEXT",VALIDATION:"VALIDATION",CMP_NEXT_VALIDATION:"CMP_NEXT_VALIDATION"},CloudTelephonyValidationError:{UNKNOWN:"UNKNOWN",DN_NOT_FOUND_IN_TENANT:"DN_NOT_FOUND_IN_TENANT",DUPLICATE_SITE_NAME:"DUPLICATE_SITE_NAME",OVERLAPPING_PUBLIC_RANGES_WITHIN_SITE:"OVERLAPPING_PUBLIC_RANGES_WITHIN_SITE",OVERLAPPING_PUBLIC_RANGES_ACROSS_DEPLOYMENT:"OVERLAPPING_PUBLIC_RANGES_ACROSS_DEPLOYMENT",OVERLAPPING_PRIVATE_RANGES_WITHIN_SITE:"OVERLAPPING_PRIVATE_RANGES_WITHIN_SITE",OVERLAPPING_PRIVATE_RANGES_ACROSS_TENANT:"OVERLAPPING_PRIVATE_RANGES_ACROSS_TENANT",EXISTING_USERS_IN_RANGE:"EXISTING_USERS_IN_RANGE",EXISTING_USERS_IN_PUBLIC_RANGE:"EXISTING_USERS_IN_PUBLIC_RANGE",EXISTING_USERS_IN_PRIVATE_RANGE:"EXISTING_USERS_IN_PRIVATE_RANGE",AREA_CODES_INCONSISTENT:"AREA_CODES_INCONSISTENT",DELETE_ITSP_ALREADY_ASSIGNED:"DELETE_ITSP_ALREADY_ASSIGNED",DN_NOT_FOUND_IN_SITE:"DN_NOT_FOUND_IN_SITE",CALLERID_NOT_FOUND_IN_PUBLIC_NUMBERS:"CALLERID_NOT_FOUND_IN_PUBLIC_NUMBERS",AA_OPERATOR_INVALID:"AA_OPERATOR_INVALID",MSN_AS_EXISTING_USER:"MSN_AS_EXISTING_USER",EA_INVALID_CREATE_UPDATE_CONFIGURATION:"EA_INVALID_CREATE_UPDATE_CONFIGURATION",INVALID_CHARACTERS_FOR_EA_GROUP_NAME:"INVALID_CHARACTERS_FOR_EA_GROUP_NAME",INVALID_LENGTH_FOR_EA_GROUP_NAME:"INVALID_LENGTH_FOR_EA_GROUP_NAME",MSN_ASSIGNED_TO_EA_GROUP:"MSN_ASSIGNED_TO_EA_GROUP",EXISTING_EA_USERS_IN_PUBLIC_RANGE:"EXISTING_EA_USERS_IN_PUBLIC_RANGE",EXISTING_EA_USERS_IN_PRIVATE_RANGE:"EXISTING_EA_USERS_IN_PRIVATE_RANGE",EXISTING_EA_USERS_IN_RANGE:"EXISTING_EA_USERS_IN_RANGE",INVALID_IP_OR_FQDN:"INVALID_IP_OR_FQDN",INVALID_PORT:"INVALID_PORT",EXISTING_AA_TRANSFER_TARGETS_IN_PUBLIC_RANGE:"EXISTING_AA_TRANSFER_TARGETS_IN_PUBLIC_RANGE",EXISTING_AA_TRANSFER_TARGETS_IN_PRIVATE_RANGE:"EXISTING_AA_TRANSFER_TARGETS_IN_PRIVATE_RANGE",EXISTING_AA_TRANSFER_TARGETS_IN_RANGE:"EXISTING_AA_TRANSFER_TARGETS_IN_RANGE",NUMBER_USED_IN_AA_TRANSFER_TARGET:"NUMBER_USED_IN_AA_TRANSFER_TARGET"},CloudTelephonyCmpNextError:{COUNTRY_DETAILS_NOT_FOUND:"COUNTRY_DETAILS_NOT_FOUND",OSV_OPERATION_FAILED:"OSV_OPERATION_FAILED",CALL_PICKUP_GROUP_DUPLICATE_NAME:"CALL_PICKUP_GROUP_DUPLICATE_NAME",OPENSCAPE_SITE_DID_AREA_CODES_INCONSISTENT:"OPENSCAPE_SITE_DID_AREA_CODES_INCONSISTENT",OPENSCAPE_SITE_DID_AREA_CODE_NOT_EMPTY:"OPENSCAPE_SITE_DID_AREA_CODE_NOT_EMPTY",INVALID_IP_OR_FQDN:"INVALID_IP_OR_FQDN"},ClientCapability:{GUEST_EXPERIENCE:1,SYSTEM_MESSAGES:2,TC_START_REASSIGNMENT:4,MUTABLE_APN:8},SortOrder:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},TimeRange:{ONE_HOUR:36e5,ONE_DAY:864e5,ONE_WEEK:6048e5,ONE_MONTH:2592e6},ConversationActionType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",ADD_TEXT_ITEM:"ADD_TEXT_ITEM",UPDATE_TEXT_ITEM:"UPDATE_TEXT_ITEM",DELETE_TEXT_ITEM:"DELETE_TEXT_ITEM",GET_CONVERSATION_BY_ID:"GET_CONVERSATION_BY_ID",GET_CONVERSATIONS:"GET_CONVERSATIONS",GET_ITEM_BY_ID:"GET_ITEM_BY_ID",GET_ITEMS_BY_CONVERSATION:"GET_ITEMS_BY_CONVERSATION",GET_ITEMS_BY_CONVERSATION_ITEM_ID:"GET_ITEMS_BY_CONVERSATION_ITEM_ID",SET_READ_POINTER:"SET_READ_POINTER",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",TYPING:"TYPING",GET_CONVERSATION_USER_DATA:"GET_CONVERSATION_USER_DATA",SET_FLAG_ITEM:"SET_FLAG_ITEM",CLEAR_FLAG_ITEM:"CLEAR_FLAG_ITEM",GET_FLAGGED_ITEMS:"GET_FLAGGED_ITEMS",GET_JOIN_DETAILS:"GET_JOIN_DETAILS",GET_SUPPORT_CONVERSATION_ID:"GET_SUPPORT_CONVERSATION_ID",GET_SUPPORT_CONVERSATION:"GET_SUPPORT_CONVERSATION",GET_OPEN_CONVERSATIONS:"GET_OPEN_CONVERSATIONS",JOIN_OPEN_CONVERSATION:"JOIN_OPEN_CONVERSATION",MARK_CONVERSATION:"MARK_CONVERSATION",UNMARK_CONVERSATION:"UNMARK_CONVERSATION",GET_MARKED_CONVERSATIONS_LIST:"GET_MARKED_CONVERSATIONS_LIST",SET_CONVERSATION_AVATAR:"SET_CONVERSATION_AVATAR",GET_TELEPHONY_CONVERSATION_ID:"GET_TELEPHONY_CONVERSATION_ID",GET_ATTACHMENTS:"GET_ATTACHMENTS",GET_CONVERSATION_BY_USER:"GET_CONVERSATION_BY_USER",GET_CONVERSATION_SUMMARY:"GET_CONVERSATION_SUMMARY",LIKE_TEXT_ITEM:"LIKE_TEXT_ITEM",UNLIKE_TEXT_ITEM:"UNLIKE_TEXT_ITEM",DELETE_RECORDING:"DELETE_RECORDING",MODERATE_CONVERSATION:"MODERATE_CONVERSATION",UNMODERATE_CONVERSATION:"UNMODERATE_CONVERSATION",ADD_SCHEDULE_ITEM:"ADD_SCHEDULE_ITEM",UPDATE_SCHEDULE_ITEM:"UPDATE_SCHEDULE_ITEM",DELETE_SCHEDULE_ITEM:"DELETE_SCHEDULE_ITEM",GET_ALL_USER_SCHEDULE_ITEMS:"GET_ALL_USER_SCHEDULE_ITEMS",GRANT_MODERATOR_RIGHTS:"GRANT_MODERATOR_RIGHTS",DROP_MODERATOR_RIGHTS:"DROP_MODERATOR_RIGHTS",GET_CONVERSATION_THREADS:"GET_CONVERSATION_THREADS",GET_THREAD_COMMENTS:"GET_THREAD_COMMENTS",GET_THREADS_BY_IDS:"GET_THREADS_BY_IDS",ADD_JOURNAL_ENTRY:"ADD_JOURNAL_ENTRY",GET_THREADS_BY_ITEM_IDS:"GET_THREADS_BY_ITEM_IDS",DELETE_ATTACHMENTS:"DELETE_ATTACHMENTS",UPDATE_GUEST_ACCESS:"UPDATE_GUEST_ACCESS",GET_CONVERSATION_PARTICIPANTS:"GET_CONVERSATION_PARTICIPANTS",GET_CONVERSATION_FEED:"GET_CONVERSATION_FEED",SET_FAVORITE_POSITION:"SET_FAVORITE_POSITION",GET_ITEMS_BY_IDS:"GET_ITEMS_BY_IDS",ADD_LABELS:"ADD_LABELS",ASSIGN_LABELS:"ASSIGN_LABELS",UNASSIGN_LABELS:"UNASSIGN_LABELS",GET_LABELS:"GET_LABELS",GET_LABEL_PAGE:"GET_LABEL_PAGE",REMOVE_LABELS:"REMOVE_LABELS",EDIT_LABEL:"EDIT_LABEL",UPDATE_RTC_ITEM_ATTACHMENTS:"UPDATE_RTC_ITEM_ATTACHMENTS",GET_CONVERSATIONS_BY_FILTER:"GET_CONVERSATIONS_BY_FILTER",ADD_FILTER:"ADD_FILTER",REMOVE_FILTERS:"REMOVE_FILTERS",GET_FILTERS:"GET_FILTERS",EDIT_FILTER:"EDIT_FILTER",GET_FAVORITE_CONVERSATION_IDS:"GET_FAVORITE_CONVERSATION_IDS",GET_CONVERSATIONS_BY_IDS:"GET_CONVERSATIONS_BY_IDS",GET_USER_DATA_SINCE:"GET_USER_DATA_SINCE",GET_CONFERENCE_INVITATION_TEXT:"GET_CONFERENCE_INVITATION_TEXT",GET_CONFERENCE_INVITATION_EXAMPLE:"GET_CONFERENCE_INVITATION_EXAMPLE",GET_TEASER_MESSAGES:"GET_TEASER_MESSAGES",TAKE_MODERATION_RIGHT:"TAKE_MODERATION_RIGHT",GET_CONVERSATION_TOPICS:"GET_CONVERSATION_TOPICS",PIN_TOPIC:"PIN_TOPIC",UNPIN_TOPIC:"UNPIN_TOPIC",DELETE_JOURNAL_ENTRY:"DELETE_JOURNAL_ENTRY",SET_CONVERSATION_RETENTION_POLICY:"SET_CONVERSATION_RETENTION_POLICY",GET_JOURNAL_ENTRIES:"GET_JOURNAL_ENTRIES",GET_CONVERSATION_DETAILS:"GET_CONVERSATION_DETAILS",GET_UNHEARD_VOICEMAILS_COUNT:"GET_UNHEARD_VOICEMAILS_COUNT",SET_VOICEMAIL_HEARD:"SET_VOICEMAIL_HEARD",GET_CONVERSATION_IDS_REMOVED_FROM:"GET_CONVERSATION_IDS_REMOVED_FROM",SET_RECORDING_DELETION_DELAY:"SET_RECORDING_DELETION_DELAY",TAG_CONVERSATION:"TAG_CONVERSATION",UNTAG_CONVERSATION:"UNTAG_CONVERSATION",DELETE_ALL_JOURNAL_ENTRIES:"DELETE_ALL_JOURNAL_ENTRIES"},ConversationEventType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_ITEM:"ADD_ITEM",UPDATE_ITEM:"UPDATE_ITEM",READ_ITEMS:"READ_ITEMS",TYPING:"TYPING",DRAFT_MESSAGE_SAVED:"DRAFT_MESSAGE_SAVED",DRAFT_MESSAGE_DISCARDED:"DRAFT_MESSAGE_DISCARDED",DRAFT_MESSAGE_PUBLISHED:"DRAFT_MESSAGE_PUBLISHED",FLAG_ITEM:"FLAG_ITEM",CLEAR_FLAGGED_ITEM:"CLEAR_FLAGGED_ITEM",CONVERSATION_MARKED:"CONVERSATION_MARKED",CONVERSATION_UNMARKED:"CONVERSATION_UNMARKED",FAVORITE_POSITION_CHANGED:"FAVORITE_POSITION_CHANGED",USER_DATA_CHANGED:"USER_DATA_CHANGED",JOURNAL_ENTRY_DELETED:"JOURNAL_ENTRY_DELETED",ALL_JOURNAL_ENTRIES_DELETED:"ALL_JOURNAL_ENTRIES_DELETED"},UISettings:{INFO:"INFO",DETAILS:"DETAILS",SPACE_INFO:"SPACE_INFO",SPACE_DETAILS:"SPACE_DETAILS",SPACE_PINNED_TOPICS:"SPACE_PINNED_TOPICS",SPACE_ACTIVE_POLLS:"SPACE_ACTIVE_POLLS",CONVERSATION_FAVORITES:"CONVERSATION_FAVORITES"},DefaultUISettingsValues:{INFO:!0,DETAILS:!0,SPACE_INFO:!0,SPACE_DETAILS:!0,SPACE_PINNED_TOPICS:!0,SPACE_ACTIVE_POLLS:!0,CONVERSATION_FAVORITES:!0},UserBusyHandlingOptions:{DefaultRouting:"DefaultRouting",BusySignal:"BusySignal",SendToAlternativeNumber:"SendToAlternativeNumber",SendToVm:"SendToVm"},RetentionPolicyStatus:{ENABLED:"ENABLED",USER_DISABLED:"USER_DISABLED",LEGALHOLD_DISABLED:"LEGALHOLD_DISABLED",USER_LEGALHOLD_DISABLED:"USER_LEGALHOLD_DISABLED"},SearchDirection:{AFTER:"AFTER",BEFORE:"BEFORE",BOTH:"BOTH"},TimestampFilter:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},OrderBy:{TIMESTAMP_ASC:"TIMESTAMP_ASC",TIMESTAMP_DESC:"TIMESTAMP_DESC"},OrderType:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},ConversationType:{DIRECT:"DIRECT",GROUP:"GROUP",OPEN:"OPEN",LARGE:"LARGE"},ConversationItemType:{TEXT:"TEXT",RTC:"RTC",SYSTEM:"SYSTEM"},ConversationItemTypeMapping:{RTC:"phone",CALL_SUMMARY:"call-summary",TEXT:"text",SYSTEM:"notification",VOICEMAIL:"vm",MARKER:"marker",DIVIDER:"divider",GAP:"gap"},ConversationFilter:{ALL:"ALL",OPEN_MEMBER:"OPEN_MEMBER",MARKED:"MARKED",ARCHIVED:"ARCHIVED",UNARCHIVED:"UNARCHIVED"},ConversationMarkFilter:{MUTE:"MUTE",FAVORITE:"FAVORITE"},GetConversationParticipantCriteria:{DISPLAY_NAME:"DISPLAY_NAME",TYPE:"TYPE"},ConversationParticipantType:{ACTIVE:"ACTIVE",REGULAR:"REGULAR",FORMER:"FORMER",MODERATOR:"MODERATOR",GUEST:"GUEST"},DataRetentionState:{UNTOUCHED:"UNTOUCHED",OUTDATED:"OUTDATED",DELETED:"DELETED"},RetrieveAction:{CONVERSATIONS:"CONVERSATIONS",CONVERSATION_IDS:"CONVERSATION_IDS",CONVERSATIONS_AND_IDS:"CONVERSATIONS_AND_IDS"},RTCItemType:{STARTED:"STARTED",ENDED:"ENDED",MISSED:"MISSED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",MOVED:"MOVED"},RTCItemMissed:{UNREACHABLE:"UNREACHABLE",TIMEOUT:"TIMEOUT",USER_BUSY:"USER_BUSY",DECLINED:"DECLINED",CANCELED:"CANCELED",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"},RTCItemMoved:{MOVED_FROM:"MOVED_FROM",MOVED_TO:"MOVED_TO"},ExternalUnshareProviderType:{SYNCPLICITY:"SYNCPLICITY"},SortingType:{RECENT_ACTIVITY_ASC:"RECENT_ACTIVITY_ASC",RECENT_ACTIVITY_DESC:"RECENT_ACTIVITY_DESC",ALPHABETICALLY_ASC:"ALPHABETICALLY_ASC",ALPHABETICALLY_DESC:"ALPHABETICALLY_DESC",POPULARITY_ASC:"POPULARITY_ASC",POPULARITY_DESC:"POPULARITY_DESC",TIMESTAMP_ASC:"TIMESTAMP_ASC"},TextItemContentType:{PLAIN:"PLAIN",RICH:"RICH"},TextItemState:{CREATED:"CREATED",EDITED:"EDITED",DELETED:"DELETED",CLUSTERED:"CLUSTERED"},SystemItemType:{CONVERSATION_CREATED:"CONVERSATION_CREATED",PARTICIPANT_ADDED:"PARTICIPANT_ADDED",PARTICIPANT_REMOVED:"PARTICIPANT_REMOVED",CONVERSATION_RENAMED:"CONVERSATION_RENAMED",CONFERENCE_DETAILS_CHANGED:"CONFERENCE_DETAILS_CHANGED",CONVERSATION_MODERATED:"CONVERSATION_MODERATED",MODERATOR_RIGHTS_GRANTED:"MODERATOR_RIGHTS_GRANTED",MODERATOR_RIGHTS_DROPPED:"MODERATOR_RIGHTS_DROPPED",GUEST_ACCESS_ENABLED:"GUEST_ACCESS_ENABLED",GUEST_ACCESS_DISABLED:"GUEST_ACCESS_DISABLED",AVATAR_CHANGED:"AVATAR_CHANGED",RETENTION_POLICY_CHANGED:"RETENTION_POLICY_CHANGED",PARTICIPANT_HARD_REMOVED:"PARTICIPANT_HARD_REMOVED",RETENTION_ITEMS_REMOVED:"RETENTION_ITEMS_REMOVED"},AttachmentOrderType:{CREATION:"CREATION",FILENAME:"FILENAME",SIZE:"SIZE",MIMETYPE:"MIMETYPE",FILEEXTENSION:"FILEEXTENSION"},AttachmentOrderDirection:{ASC:"ASC",DSC:"DSC"},BridgeLocale:{EN_US:"EN_US",EN_GB:"EN_GB",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN",PT_BR:"PT_BR",NL_NL:"NL_NL"},BridgeNumberType:{TOLL:"TOLL",TOLL_FREE:"TOLL_FREE",LOCAL:"LOCAL"},FilterTarget:{CONVERSATION_TYPE:"CONVERSATION_TYPE",LABEL_ID:"LABEL_ID",SYSTEM_TAG:"SYSTEM_TAG"},FilterTargetComparator:{EQ:"EQ",NOT:"NOT"},FilterBoolConnector:{AND:"AND",OR:"OR"},SystemLabel:{ARCHIVED:"ARCHIVED",FAVORITE:"FAVORITE",MODERATOR:"MODERATOR"},IncludedUserData:{LAST_READ_TS:"LASTREADTS",UNREAD_COUNT:"UNREADCOUNT",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},ChangedUserData:{LAST_READ_TS:"LASTREADTS",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},ModerationTakenResult:{OK:"OK",ALREADY_HAS_MODERATOR:"ALREADY_HAS_MODERATOR",NO_MODERATED_CONVERTION:"NO_MODERATED_CONVERTION",NO_FULL_CONVERSATION_MEMBER:"NO_FULL_CONVERSATION_MEMBER",TAKE_MODERATION_FORBIDDEN:"TAKE_MODERATION_FORBIDDEN"},JournalFilter:{ALL:"ALL",MISSED:"MISSED",DIALED:"DIALED",RECEIVED:"RECEIVED",DIVERTED:"DIVERTED",VOICEMAILS:"VOICEMAILS",UNHEARD_VOICEMAILS:"UNHEARD_VOICEMAILS"},AddLabelsResult:{OK:"OK",LABEL_LIMIT_REACHED:"LABEL_LIMIT_REACHED",LABEL_ALREADY_EXISTS:"LABEL_ALREADY_EXISTS"},SystemTag:{IC:"IC"},ContainerType:{SPACE:"SPACE",CONVERSATION:"CONVERSATION"},InstrumentationActionType:{SUBMIT_CLIENT_DATA:"SUBMIT_CLIENT_DATA",SUBMIT_QOS_DATA:"SUBMIT_QOS_DATA"},SubmitDataResult:{UNKNOWN:"UNKNOWN",OK:"OK",NO_USERID:"NO_USERID",NO_CLIENTID:"NO_CLIENTID",NO_DATA:"NO_DATA",PROCESSING_ERROR:"PROCESSING_ERROR"},QOSMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",SCREEN_SHARE:"SCREEN_SHARE"},RTCCallActionType:{JOIN:"JOIN",ANSWER:"ANSWER",ICE_CANDIDATES:"ICE_CANDIDATES",LEAVE:"LEAVE",TERMINATE:"TERMINATE",CHANGE_MEDIA_TYPE:"CHANGE_MEDIA_TYPE",INVITE_REJECT:"INVITE_REJECT",CHANGE_MEDIA_ACCEPT:"CHANGE_MEDIA_ACCEPT",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",PREPARE:"PREPARE",RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",SEND_PROGRESS:"SEND_PROGRESS",SUBMIT_RTC_QUALITY_RATING:"SUBMIT_RTC_QUALITY_RATING",MERGE:"MERGE"},RTCCallEventType:{SDP_ANSWER:"SDP_ANSWER",SDP_FAILED:"SDP_FAILED",INVITE:"INVITE",INVITE_CANCEL:"INVITE_CANCEL",INVITE_FAILED:"INVITE_FAILED",CHANGE_MEDIA_TYPE_REQUESTED:"CHANGE_MEDIA_TYPE_REQUESTED",PROGRESS:"PROGRESS",CHANGE_MEDIA_TYPE_FORCED:"CHANGE_MEDIA_TYPE_FORCED",ICE_CANDIDATES:"ICE_CANDIDATES",RTC_QUALITY_RATING_EVENT:"RTC_QUALITY_RATING_EVENT",IFRAME_STATISTICS:"IFRAME_STATISTICS"},SdpFailedCause:{SESSION_STARTED_FAILED:"SESSION_STARTED_FAILED",CONNECTION_LOST:"CONNECTION_LOST",SERVICE_ERROR:"SERVICE_ERROR",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",JOIN_FORBIDDEN:"JOIN_FORBIDDEN",SESSION_TERMINATED:"SESSION_TERMINATED",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED"},InviteCancelCause:{ACCEPT:"ACCEPT",BUSY:"BUSY",DECLINE:"DECLINE",REVOKED:"REVOKED"},InviteFailedCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT",NOT_REACHABLE:"NOT_REACHABLE",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE",REVOKED:"REVOKED"},InviteRejectCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE",NOT_REACHABLE:"NOT_REACHABLE"},RTCProgressType:{ALERTING:"ALERTING",PROGRESS:"PROGRESS",EARLY_CONNECT:"EARLY_CONNECT"},DisconnectCause:{HANGUP:"HANGUP",CONNECTION_LOST:"CONNECTION_LOST",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED",STREAM_LOST:"STREAM_LOST",CALL_SETUP_FAILED:"CALL_SETUP_FAILED"},DisconnectReason:{PAGE_UNLOADED:"PAGE_UNLOADED",CALL_LOST:"CALL_LOST",LOGOUT:"LOGOUT"},TerminateCause:{COMPLETED_ELSEWHERE:"COMPLETED_ELSEWHERE",PICKED_UP:"PICKED_UP"},RTCSessionActionType:{LOCK:"LOCK",MUTE_SESSION:"MUTE_SESSION",MUTE:"MUTE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",GET_ACTIVE_SESSIONS:"GET_ACTIVE_SESSIONS",GET_SESSION:"GET_SESSION",MOVE:"MOVE",START_RECORDING:"START_RECORDING",STOP_RECORDING:"STOP_RECORDING",GET_SESSIONID_BY_PIN:"GET_SESSIONID_BY_PIN",RAISE_QUESTION:"RAISE_QUESTION",INVITE_TO_STAGE:"INVITE_TO_STAGE",INVITE_TO_STAGE_ANSWER:"INVITE_TO_STAGE_ANSWER",UPDATE_QUESTION_STATE:"UPDATE_QUESTION_STATE",INVITE_TO_STAGE_CANCEL:"INVITE_TO_STAGE_CANCEL",REMOVE_FROM_STAGE:"REMOVE_FROM_STAGE",GET_QUESTIONS:"GET_QUESTIONS",OPEN_CURTAIN:"OPEN_CURTAIN",CLOSE_CURTAIN:"CLOSE_CURTAIN",GET_NODE_STATE:"GET_NODE_STATE",ENABLE_WHITEBOARD:"ENABLE_WHITEBOARD",DISABLE_WHITEBOARD:"DISABLE_WHITEBOARD",ADD_WHITEBOARD_ELEMENT:"ADD_WHITEBOARD_ELEMENT",REMOVE_WHITEBOARD_ELEMENT:"REMOVE_WHITEBOARD_ELEMENT",UPDATE_WHITEBOARD_ELEMENT:"UPDATE_WHITEBOARD_ELEMENT",CLEAR_WHITEBOARD:"CLEAR_WHITEBOARD",GET_WHITEBOARD:"GET_WHITEBOARD",SET_WHITEBOARD_BACKGROUND:"SET_WHITEBOARD_BACKGROUND",CLEAR_WHITEBOARD_BACKGROUND:"CLEAR_WHITEBOARD_BACKGROUND",TOGGLE_WHITEBOARD_OVERLAY:"TOGGLE_WHITEBOARD_OVERLAY",UNDO_WHITEBOARD:"UNDO_WHITEBOARD",SEND_CLIENT_INFO:"SEND_CLIENT_INFO",REQUEST_SCREEN_CONTROL:"REQUEST_SCREEN_CONTROL",REJECT_SCREEN_CONTROL_REQUEST:"REJECT_SCREEN_CONTROL_REQUEST",OFFER_SCREEN_CONTROL:"OFFER_SCREEN_CONTROL",ACCEPT_SCREEN_CONTROL:"ACCEPT_SCREEN_CONTROL",REJECT_SCREEN_CONTROL:"REJECT_SCREEN_CONTROL",STOP_SCREEN_CONTROL:"STOP_SCREEN_CONTROL",START_POLL:"START_POLL",GET_POLL:"GET_POLL",EDIT_POLL:"EDIT_POLL",VOTE_POLL:"VOTE_POLL",CLOSE_POLL:"CLOSE_POLL",RESUME_POLL:"RESUME_POLL",MAKE_POLL_RESULTS_VISIBLE:"MAKE_POLL_RESULTS_VISIBLE",STOP_POLL:"STOP_POLL",EXPORT_POLL:"EXPORT_POLL",ENABLE_POLL:"ENABLE_POLL",DISABLE_POLL:"DISABLE_POLL",SWITCH_RECORDING_LAYOUT:"SWITCH_RECORDING_LAYOUT",SET_VIDEO_RECEIVER_CONFIGURATION:"SET_VIDEO_RECEIVER_CONFIGURATION"},RTCSessionEventType:{SESSION_STARTED:"SESSION_STARTED",SESSION_TERMINATED:"SESSION_TERMINATED",SESSION_UPDATED:"SESSION_UPDATED",SESSION_MOVED:"SESSION_MOVED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",PARTICIPANT_UPDATED:"PARTICIPANT_UPDATED",ACTIVE_SPEAKER:"ACTIVE_SPEAKER",VIDEO_ACTIVE_SPEAKER:"VIDEO_ACTIVE_SPEAKER",SESSION_RECORDING_INFO:"SESSION_RECORDING_INFO",SESSION_RECORDING_STARTED:"SESSION_RECORDING_STARTED",SESSION_RECORDING_STOPPED:"SESSION_RECORDING_STOPPED",SESSION_RECORDING_FAILED:"SESSION_RECORDING_FAILED",SESSION_TERMINATION_TIMER_STARTED:"SESSION_TERMINATION_TIMER_STARTED",SESSION_TERMINATION_TIMER_CANCELLED:"SESSION_TERMINATION_TIMER_CANCELLED",SESSION_ATTRIBUTES_CHANGED_EVENT:"SESSION_ATTRIBUTES_CHANGED_EVENT",QUESTION_EVENT:"QUESTION_EVENT",INVITE_TO_STAGE_EVENT:"INVITE_TO_STAGE_EVENT",INVITE_TO_STAGE_CANCEL_EVENT:"INVITE_TO_STAGE_CANCEL_EVENT",CURTAIN_EVENT:"CURTAIN_EVENT",WHITEBOARD_ENABLED:"WHITEBOARD_ENABLED",WHITEBOARD_DISABLED:"WHITEBOARD_DISABLED",WHITEBOARD_ELEMENT_ADDED:"WHITEBOARD_ELEMENT_ADDED",WHITEBOARD_ELEMENT_REMOVED:"WHITEBOARD_ELEMENT_REMOVED",WHITEBOARD_ELEMENT_UPDATED:"WHITEBOARD_ELEMENT_UPDATED",WHITEBOARD_CLEARED:"WHITEBOARD_CLEARED",WHITEBOARD_BACKGROUND_SET:"WHITEBOARD_BACKGROUND_SET",WHITEBOARD_BACKGROUND_CLEARED:"WHITEBOARD_BACKGROUND_CLEARED",WHITEBOARD_OVERLAY_TOGGLED:"WHITEBOARD_OVERLAY_TOGGLED",WHITEBOARD_SYNC:"WHITEBOARD_SYNC",WHITEBOARD_CONVERSION_FAILED:"WHITEBOARD_CONVERSION_FAILED",SCREEN_CONTROL_REQUESTED:"SCREEN_CONTROL_REQUESTED",SCREEN_CONTROL_REQUEST_REJECTED:"SCREEN_CONTROL_REQUEST_REJECTED",SCREEN_CONTROL_OFFERED:"SCREEN_CONTROL_OFFERED",SCREEN_CONTROL_ACCEPTED:"SCREEN_CONTROL_ACCEPTED",SCREEN_CONTROL_REJECTED:"SCREEN_CONTROL_REJECTED",HANDOVER_SCREEN_CONTROL:"HANDOVER_SCREEN_CONTROL",SCREEN_CONTROL_TERMINATED:"SCREEN_CONTROL_TERMINATED",SCREEN_CONTROL_FAILED:"SCREEN_CONTROL_FAILED",POLL_STARTED:"POLL_STARTED",POLL_UPDATED:"POLL_UPDATED",POLL_CLOSED:"POLL_CLOSED",POLL_RESUMED:"POLL_RESUMED",POLL_STOPPED:"POLL_STOPPED",POLL_ENABLED:"POLL_ENABLED",POLL_DISABLED:"POLL_DISABLED",POLL_EXPORTED:"POLL_EXPORTED",LIVE_TRANSCRIPTION:"LIVE_TRANSCRIPTION"},RTCSessionTerminatedCause:{FORCED:"FORCED",NO_USERS_LEFT:"NO_USERS_LEFT",CONDITIONAL:"CONDITIONAL"},RTCSessionParticipantLeftCause:{LEFT:"LEFT",CONNECTION_LOST:"CONNECTION_LOST",REMOVED:"REMOVED",CONDITIONAL_TERMINATE:"CONDITIONAL_TERMINATE",FORCED_TERMINATE:"FORCED_TERMINATE",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED",USER_LEFT_STAGE:"USER_LEFT_STAGE",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",OFFER_NOT_ACCEPTED:"OFFER_NOT_ACCEPTED",STREAM_LOST:"STREAM_LOST",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",CALL_SETUP_FAILED:"CALL_SETUP_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED"},RTCSessionParticipantFlag:{CPU_LOAD:"CPU_LOAD",CPU_LOAD_TRANSCODE:"CPU_LOAD_TRANSCODE",NO_LICENSE:"NO_LICENSE",MAX_COUNT:"MAX_COUNT"},RtcSupportedFeatures:{UPGRADE_TO_CONFERENCE:"UPGRADE_TO_CONFERENCE",SCREEN_CONTROL:"SCREEN_CONTROL",SCREEN_CONTROLLER:"SCREEN_CONTROLLER",SCREEN_SHARE_AND_ACTIVE_SPEAKER_VIDEO:"SCREEN_SHARE_AND_ACTIVE_SPEAKER_VIDEO",MID_STREAM_MAPPING:"MID_STREAM_MAPPING",CALL_PICKUP:"CALL_PICKUP"},RealtimeMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",DESKTOP_SHARING:"DESKTOP_SHARING"},RecordingMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",TEXT:"TEXT"},RTCParticipantType:{USER:"USER",EXTERNAL:"EXTERNAL",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",VOICE_MAIL:"VOICE_MAIL",TEST_CALL:"TEST_CALL"},QuestionState:{RAISED:"RAISED",ANSWERED:"ANSWERED",DISCARDED:"DISCARDED",ANSWER_LATER:"ANSWER_LATER"},StageState:{INITIAL:"INITIAL",INVITED:"INVITED",REJECTED:"REJECTED",ACCEPTED:"ACCEPTED",WAS_ON_STAGE:"WAS_ON_STAGE",TIMEOUT:"TIMEOUT",LEFT_CONFERENCE:"LEFT_CONFERENCE"},QuestionEventType:{CREATED:"CREATED",UPDATED:"UPDATED",REVOKED:"REVOKED"},StageAction:{USER_ENTERED_STAGE:"USER_ENTERED_STAGE",USER_LEFT_STAGE:"USER_LEFT_STAGE"},CurtainState:{OPEN:"OPEN",INITIAL:"INITIAL",FINAL:"FINAL",PAUSED:"PAUSED"},NodeType:{MEDIA_ACCESS:"MEDIA_ACCESS",APPLICATION:"APPLICATION",STORAGE:"STORAGE",ACCESS:"ACCESS",LOAD_BALANCER:"LOAD_BALANCER",ZOOKEEPER:"ZOOKEEPER",MANAGEMENT:"MANAGEMENT",OPERATIONS:"OPERATIONS"},NodeState:{UP:"UP",DOWN:"DOWN",OVERLOAD:"OVERLOAD",MAINTENANCE:"MAINTENANCE"},RecordingInfoState:{INITIAL:"INITIAL",START_PENDING:"START_PENDING",STARTED:"STARTED",STOPPED:"STOPPED",FINISHED:"FINISHED"},RecordingInfoReason:{NONE:"NONE",STOPPED_MANUALLY:"STOPPED_MANUALLY",STOPPED_AUTOMATICALLY:"STOPPED_AUTOMATICALLY",NO_INPUT_TIMEOUT:"NO_INPUT_TIMEOUT",MAX_INPUT_TIMEOUT:"MAX_INPUT_TIMEOUT",NO_STREAMING_DATA:"NO_STREAMING_DATA",LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_MORE_DISK_SPACE_LEFT:"NO_MORE_DISK_SPACE_LEFT",UNKNOWN_ERROR:"UNKNOWN_ERROR"},RecordingTriggerReason:{USER:"USER",CURTAIN:"CURTAIN"},RecordingVideoLayoutName:{SINGLE:"SINGLE",VIDEO_SCREEN_50_50:"VIDEO_SCREEN_50_50",VIDEO_SCREEN_75_25:"VIDEO_SCREEN_75_25",VIDEO_SCREEN_25_75:"VIDEO_SCREEN_25_75",SINGLE_VIDEO:"SINGLE_VIDEO"},RtcClientInfoType:{OFFLINE_JOIN_FAILURE:"OFFLINE_JOIN_FAILURE",DEVICE_DIAGNOSTICS:"DEVICE_DIAGNOSTICS",CALL_CONNECTED:"CALL_CONNECTED"},RtcClientInfoReason:{NO_NETWORK_CONNECTION:"NO_NETWORK_CONNECTION",DISCONNECTED:"DISCONNECTED",FAILED_TO_SEND:"FAILED_TO_SEND",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",JOIN_DELAY:"JOIN_DELAY",CALL_CONNECTED:"CALL_CONNECTED"},RtcActionInfoType:{REQUEST_RESPONSE:"REQUEST_RESPONSE",EVENT:"EVENT"},RtcDiagnosticsAction:{RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",PREPARE:"PREPARE",JOIN:"JOIN",ICE_CANDIDATES:"ICE_CANDIDATES",SDP_CONNECTED:"SDP_CONNECTED",SDP_ANSWER:"SDP_ANSWER",REMOTE_ICE_CANDIDATES:"REMOTE_ICE_CANDIDATES"},SessionAttributesChangedEventType:{EVENT_ATTENDEE_COUNT_CHANGED:"EVENT_ATTENDEE_COUNT_CHANGED",SCREEN_CONTROL_REQUESTED:"SCREEN_CONTROL_REQUESTED",SCREEN_CONTROL_REQUEST_CLEARED:"SCREEN_CONTROL_REQUEST_CLEARED",SCREEN_CONTROL_ESTABLISHED:"SCREEN_CONTROL_ESTABLISHED",SCREEN_CONTROL_ENDED:"SCREEN_CONTROL_ENDED"},IncomingVideoContentType:{VIDEO:"VIDEO",SCREEN:"SCREEN"},VideoQuality:{LOW:"LOW",NORMAL:"NORMAL",HIGH:"HIGH"},AudioQualityParam:{ECHO:"ECHO",JITTER:"JITTER",NO_PACKETS_RECV:"NO_PACKETS_RECV",NO_PACKETS_SENT:"NO_PACKETS_SENT",PL_RECV:"PL_RECV",PL_SEND:"PL_SEND",RTT:"RTT"},VideoQualityParam:{BW_SEND:"BW_SEND",FRAME_HEIGHT_SENT:"FRAME_HEIGHT_SENT",FRAME_RATE_SENT:"FRAME_RATE_SENT",FRAME_WIDTH_SENT:"FRAME_WIDTH_SENT",PL_RECV:"PL_RECV",PL_SEND:"PL_SEND",RTT:"RTT",TRX_BITRATE:"TRX_BITRATE"},WhiteboardErrorCause:{EXTERNAL_URL_NOT_ALLOWED:"EXTERNAL_URL_NOT_ALLOWED",IMAGE_SIZE_TOO_LARGE:"IMAGE_SIZE_TOO_LARGE",IMAGE_DOWNLOAD_FAILED:"IMAGE_DOWNLOAD_FAILED"},SearchActionType:{START_ADVANCED_USER_SEARCH:"START_ADVANCED_USER_SEARCH",START_BASIC_SEARCH:"START_BASIC_SEARCH",START_DETAIL_SEARCH:"START_DETAIL_SEARCH",START_USER_SEARCH:"START_USER_SEARCH",CANCEL_SEARCH:"CANCEL_SEARCH",ADD_RECENT_SEARCH:"ADD_RECENT_SEARCH",SEARCH_CONVERSATION_PARTICIPANTS:"SEARCH_CONVERSATION_PARTICIPANTS"},SearchEventType:{BASIC_SEARCH_RESULT:"BASIC_SEARCH_RESULT",DETAILED_SEARCH_RESULT:"DETAILED_SEARCH_RESULT",SEARCH_STATUS:"SEARCH_STATUS",RECENT_SEARCH_ADDED:"RECENT_SEARCH_ADDED"},SystemActionType:{GET_GLOBAL_PROPERTY:"GET_GLOBAL_PROPERTY",GET_GLOBAL_PROPERTIES:"GET_GLOBAL_PROPERTIES"},SystemEventType:{BROADCAST:"BROADCAST",BROADCAST_REMOVED:"BROADCAST_REMOVED",MAINTENANCE:"MAINTENANCE",MAINTENANCE_REMOVED:"MAINTENANCE_REMOVED",MAINTENANCE_ADDED:"MAINTENANCE_ADDED"},GlobalPropertyName:{ATTACHMENT_UPLOAD_MAX_SIZE:"ATTACHMENT_UPLOAD_MAX_SIZE",CONV_PARTICIPANTS_MAX_SIZE:"CONV_PARTICIPANTS_MAX_SIZE",CONV_PARTICIPANTS_ADD_LIMIT:"CONV_PARTICIPANTS_ADD_LIMIT",XMPP_FEDERATION_ENABLED:"XMPP_FEDERATION_ENABLED",CLIENT_AUTOUPDATE_MAX_TIME:"CLIENT_AUTOUPDATE_MAX_TIME",ADD_TELEPHONY_CONNECTOR_DISABLED:"ADD_TELEPHONY_CONNECTOR_DISABLED",CHROME_EXTENSION_ID:"CHROME_EXTENSION_ID",CONV_INCOMING_WEBHOOKS_MAX_SIZE:"CONV_INCOMING_WEBHOOKS_MAX_SIZE"},SearchTypes:{CONVERSATION:"CONVERSATION",USER:"USER"},SearchStatusCode:{ERROR:"ERROR",CANCELED:"CANCELED",FINISHED:"FINISHED",TIMEOUT:"TIMEOUT",NO_RESULT:"NO_RESULT",MORE_RESULT:"MORE_RESULT"},SearchResultType:{TOPIC_MATCH:"TOPIC_MATCH",USER_MATCH:"USER_MATCH",ATTACHMENT_MATCH:"ATTACHMENT_MATCH",ITEM_MATCH:"ITEM_MATCH"},SearchScope:{ALL:"ALL",PEOPLE:"PEOPLE",MEMBERS:"MEMBERS",MESSAGES:"MESSAGES",CONVERSATIONS:"CONVERSATIONS",FILES:"FILES",SENT_BY:"SENT_BY",DATE:"DATE",LABEL:"LABEL",FILTER:"FILTER"},SearchContext:{USER:"USER",MEETING_POINT:"MEETING_POINT"},UserActionType:{LOGON:"LOGON",LOGOUT:"LOGOUT",RENEW_TOKEN:"RENEW_TOKEN",GET_USER_BY_ID:"GET_USER_BY_ID",UPDATE:"UPDATE",GET_LOGGED_ON:"GET_LOGGED_ON",GET_STUFF:"GET_STUFF",SET_PRESENCE:"SET_PRESENCE",GET_PRESENCE:"GET_PRESENCE",SUBSCRIBE_PRESENCE:"SUBSCRIBE_PRESENCE",UNSUBSCRIBE_PRESENCE:"UNSUBSCRIBE_PRESENCE",CHANGE_PASSWORD:"CHANGE_PASSWORD",GET_USERS_BY_IDS:"GET_USERS_BY_IDS",GET_DEVICES:"GET_DEVICES",GET_USER_SETTINGS:"GET_USER_SETTINGS",SET_USER_SETTINGS:"SET_USER_SETTINGS",GET_USER_BY_MAIL:"GET_USER_BY_MAIL",GET_USERS_BY_MAILS:"GET_USERS_BY_MAILS",EMAIL_UPDATE:"EMAIL_UPDATE",GENERATE_EMAIL_UPDATE_TOKEN:"GENERATE_EMAIL_UPDATE_TOKEN",GET_TELEPHONY_DATA:"GET_TELEPHONY_DATA",GET_USER_EXTENSIONS:"GET_USER_EXTENSIONS",SET_USER_EXTENSION_STATE:"SET_USER_EXTENSION_STATE",GET_LDAP_TECHNICAL_USER_PRESENCE:"GET_LDAP_TECHNICAL_USER_PRESENCE",GET_ATTACHMENTS:"GET_ATTACHMENTS",SET_PASSWORD:"SET_PASSWORD",GET_TENANT_SETTINGS:"GET_TENANT_SETTINGS",SUBSCRIBE_DEVICES:"SUBSCRIBE_DEVICES",UNSUBSCRIBE_DEVICES:"UNSUBSCRIBE_DEVICES",OAUTH_GET_GRANTED_ACCESS_TOKENS:"OAUTH_GET_GRANTED_ACCESS_TOKENS",OAUTH_REVOKE_ACCESS_TOKEN:"OAUTH_REVOKE_ACCESS_TOKEN",REVOKE_MANAGED_DEVICES:"REVOKE_MANAGED_DEVICES",GET_SECURITY_TOKEN_INFO:"GET_SECURITY_TOKEN_INFO",REVOKE_SECURITY_TOKEN:"REVOKE_SECURITY_TOKEN",RESET_OPENSCAPE_DEVICE_PINS:"RESET_OPENSCAPE_DEVICE_PINS",SUBSCRIBE_TENANT_PRESENCE:"SUBSCRIBE_TENANT_PRESENCE",UNSUBSCRIBE_TENANT_PRESENCE:"UNSUBSCRIBE_TENANT_PRESENCE",GET_TENANT_ID_TO_NAME_MAP:"GET_TENANT_ID_TO_NAME_MAP",ADD_RECENT_USED_CMR:"ADD_RECENT_USED_CMR",GET_RECENT_USED_CMRS:"GET_RECENT_USED_CMRS",IS_ALLOWED_TO_ADD_CMR:"IS_ALLOWED_TO_ADD_CMR",GET_SUPPORT_DATA:"GET_SUPPORT_DATA",WAKE_UP:"WAKE_UP",GO_TO_SLEEP:"GO_TO_SLEEP",SET_CLIENT_CAPABILITIES:"SET_CLIENT_CAPABILITIES"},UserEventType:{ATC_REFRESH_FAILED:"ATC_REFRESH_FAILED",USER_PRESENCE_CHANGE:"USER_PRESENCE_CHANGE",USER_UPDATED:"USER_UPDATED",SESSION_EXPIRES:"SESSION_EXPIRES",SESSION_EXPIRING:"SESSION_EXPIRING",SESSION_CLOSED:"SESSION_CLOSED",PASSWORD_CHANGED:"PASSWORD_CHANGED",USER_SETTING_UPDATED:"USER_SETTING_UPDATED",TELEPHONY_DATA:"TELEPHONY_DATA",DEVICE_LIST_CHANGED:"DEVICE_LIST_CHANGED",NOTIFICATION_SUBSCRIPTION_CHANGE:"NOTIFICATION_SUBSCRIPTION_CHANGE",TENANT_CONFIGURATION_UPDATED:"TENANT_CONFIGURATION_UPDATED",UCAAS_DEVICE_UPDATED:"UCAAS_DEVICE_UPDATED",TENANT_PRESENCE_CHANGE:"TENANT_PRESENCE_CHANGE",CMR_SETTINGS_UPDATED:"CMR_SETTINGS_UPDATED",CMR_COMMAND:"CMR_COMMAND",TELEPHONY_CHANGED:"TELEPHONY_CHANGED",TELEPHONY_PROVIDER_UPDATED:"TELEPHONY_PROVIDER_UPDATED",EAGROUP_STATUS_CHANGED:"EAGROUP_STATUS_CHANGED"},GetStuffType:{USER:"USER",ACCOUNTS:"ACCOUNTS",FIRST_WEB_LOGIN:"FIRST_WEB_LOGIN",PRESENCE_STATE:"PRESENCE_STATE",RECENT_SEARCHES:"RECENT_SEARCHES",RECENT_SPACE_SEARCHES:"RECENT_SPACE_SEARCHES",SETTINGS:"SETTINGS",TENANT_DATA:"TENANT_DATA",SUPPORT_CONVERSATION_ID:"SUPPORT_CONVERSATION_ID",TELEPHONY_CONVERSATION_ID:"TELEPHONY_CONVERSATION_ID",GLOBAL_PROPERTIES:"GLOBAL_PROPERTIES",TENANT:"TENANT",NOTIFICATION_SUBSCRIPTIONS:"NOTIFICATION_SUBSCRIPTIONS",SYSTEM_LABELS:"SYSTEM_LABELS",PENDING_SYSTEM_NOTIFICATIONS:"PENDING_SYSTEM_NOTIFICATIONS",SUPPORT_INFO:"SUPPORT_INFO",HAS_TENANT_MEETING_POINTS:"HAS_TENANT_MEETING_POINTS",TEAMS:"TEAMS",SPACES_NCA:"SPACES_NCA"},NotificationSubscriptionType:{ONLINE_STATUS:"ONLINE_STATUS"},NotificationSubscriptionAction:{SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},DeviceType:{PHONE:"PHONE",WEB:"WEB",APPLICATION:"APPLICATION",MOBILE:"MOBILE",SDK:"SDK",UNKNOWN:"UNKNOWN",SESSION_GUEST:"SESSION_GUEST"},PresenceState:{AVAILABLE:"AVAILABLE",OFFLINE:"OFFLINE",AWAY:"AWAY",BUSY:"BUSY",DND:"DND"},ChangePasswordResult:{OK:"OK",NEW_INVALID:"NEW_INVALID",OLD_INVALID:"OLD_INVALID",ALREADY_CHANGED:"ALREADY_CHANGED",OPERATION_ERROR:"OPERATION_ERROR"},SetPasswordResult:{OK:"OK",NOT_OK:"NOT_OK"},SessionClosedReason:{NEW_CONNECTION_DETECTED:"NEW_CONNECTION_DETECTED",UPGRADE_REQUIRED:"UPGRADE_REQUIRED",SUSPENDED:"SUSPENDED",DELETED:"DELETED",TENANT_DELETED:"TENANT_DELETED",TENANT_SUSPENDED:"TENANT_SUSPENDED"},RecordingStoppedReason:{LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_INPUT:"NO_INPUT"},RecordingUploadState:{IN_PROGRESS:"IN_PROGRESS",RETRYING:"RETRYING",FINISHED:"FINISHED",FAILED:"FAILED",DELETED:"DELETED"},UserRole:{GUEST:"GUEST",USER:"USER",TENANT_ADMIN:"TENANT_ADMIN",SUPPORT:"SUPPORT",SYSTEM_ADMIN:"SYSTEM_ADMIN",TELEPHONY_CONNECTOR:"TELEPHONY_CONNECTOR",VIRTUAL_TELEPHONY_CONNECTOR:"VIRTUAL_TELEPHONY_CONNECTOR",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",BOT:"BOT"},UserType:{REGULAR:"REGULAR",GUEST:"GUEST",SUPPORT:"SUPPORT",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",TECHNICAL:"TECHNICAL",BOT:"BOT",XMPP:"XMPP"},UserState:{INACTIVE:"INACTIVE",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED",PURGED:"PURGED"},Locale:{EN_US:"EN_US",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN",PT_BR:"PT_BR",NL_NL:"NL_NL"},AALanguageCode:{EN_US:"en_US",EN_GB:"en_GB",DE_DE:"de_DE",ES_ES:"es_ES",FR_FR:"fr_FR",IT_IT:"it_IT",RU_RU:"ru_RU",ZH_CN:"zh_CN",PT_BR:"pt_BR",NL_NL:"nl_NL"},PhoneNumberType:{WORK:"WORK",MOBILE:"MOBILE",HOME:"HOME",FAX:"FAX",OTHER:"OTHER",UCAAS:"UCAAS"},PhoneNumberNpi:{PUBLIC:"PUBLIC",PRIVATE:"PRIVATE"},EmailAddressType:{WORK:"WORK",HOME:"HOME",OTHER:"OTHER"},UserSettingArea:{ALL:"ALL",EMAIL:"EMAIL",DESKTOP:"DESKTOP",PRIVACY:"PRIVACY",CLIENT:"CLIENT"},UserSettingDataType:{BOOLEAN:"BOOLEAN",NUMBER:"NUMBER",STRING:"STRING",TIMESTAMP:"TIMESTAMP"},UserSettingKey:{EMAIL_INVITES:"EMAIL_INVITES",EMAIL_MISSED_RTC:"EMAIL_MISSED_RTC",EMAIL_SUMMARY:"EMAIL_SUMMARY",EMAIL_UPDATE:"EMAIL_UPDATE",DESKTOP_RTC:"DESKTOP_RTC",DESKTOP_MISSED_MESSAGE:"DESKTOP_MISSED_MESSAGE",DESKTOP_CONVERSATION_CHANGE:"DESKTOP_CONVERSATION_CHANGE",DESKTOP_SYSINFO:"DESKTOP_SYSINFO",SHARE_LOCATION:"SHARE_LOCATION",RELEASE_NOTES_WEB_VERSION:"RELEASE_NOTES_WEB_VERSION",RELEASE_NOTES_MOBILE_VERSION:"RELEASE_NOTES_MOBILE_VERSION",TM_WEB_START_CONV_WITH:"TM_WEB_START_CONV_WITH",TM_WEB_ENTER_NAME:"TM_WEB_ENTER_NAME",TM_WEB_CALL_ACTION_BUTTONS:"TM_WEB_CALL_ACTION_BUTTONS",TM_WEB_SUPPORT_FEEDBACK:"TM_WEB_SUPPORT_FEEDBACK",TM_WEB_SUPPORT_ISSUE:"TM_WEB_SUPPORT_ISSUE",TM_WEB_SCREEN_SHARING_ENABLED:"TM_WEB_SCREEN_SHARING_ENABLED",TM_WEB_SEARCH_FILTER:"TM_WEB_SEARCH_FILTER",AUDIO_WEB_SOUNDS:"AUDIO_WEB_SOUNDS",TM_WEB_OPEN_CONVERSATION:"TM_WEB_OPEN_CONVERSATION",TM_WEB_ADD_CONVERSATION_TITLE:"TM_WEB_ADD_CONVERSATION_TITLE",TM_WEB_RICH_TEXT_EDITING:"TM_WEB_RICH_TEXT_EDITING",TM_WEB_MUTE_CONVERSATION:"TM_WEB_MUTE_CONVERSATION",TM_WEB_VIEW_MUTED_CONVERSATIONS:"TM_WEB_VIEW_MUTED_CONVERSATIONS",TM_WEB_LEAVING_CONVERSATION:"TM_WEB_LEAVING_CONVERSATION",TM_WEB_FOCUS_MODE:"TM_WEB_FOCUS_MODE",TM_WEB_CONFERENCE_DIAL_IN:"TM_WEB_CONFERENCE_DIAL_IN",TM_WEB_REMOVING_PARTICIPANTS:"TM_WEB_REMOVING_PARTICIPANTS",TM_WEB_FULL_SCREEN_MODES:"TM_WEB_FULL_SCREEN_MODES",TM_WEB_ADD_MULTIPLE_USERS:"TM_WEB_ADD_MULTIPLE_USERS",TM_WEB_THIRD_COLUMN:"TM_WEB_THIRD_COLUMN",TM_WEB_RESERVE_1:"TM_WEB_RESERVE_1",TM_WEB_RESERVE_2:"TM_WEB_RESERVE_2",TM_IOS_SEARCH:"TM_IOS_SEARCH",MOBILE_ENABLE_VIDEO_WIFI_ONLY:"MOBILE_ENABLE_VIDEO_WIFI_ONLY",TM_WEB_ADMIN_TELEPHONY_ENABLED:"TM_WEB_ADMIN_TELEPHONY_ENABLED",TM_WEB_TELPHONY_NUMBER_ASSIGNED:"TM_WEB_TELPHONY_NUMBER_ASSIGNED",TM_WEB_ACTIVE_SPEAKER_VIDEO:"TM_WEB_ACTIVE_SPEAKER_VIDEO",TM_WEB_FIRST_DIRECT_CONVERSATION:"TM_WEB_FIRST_DIRECT_CONVERSATION",TM_WEB_FIRST_GROUP_CONVERSATION:"TM_WEB_FIRST_GROUP_CONVERSATION",TM_WEB_FIRST_CONV_ADD_PARTCPNTS:"TM_WEB_FIRST_CONV_ADD_PARTCPNTS",TM_WEB_FIRST_CONV_SET_NAME:"TM_WEB_FIRST_CONV_SET_NAME",TM_WEB_FIRST_CONV_START_CONV:"TM_WEB_FIRST_CONV_START_CONV",TM_WEB_INVITE_USERS:"TM_WEB_INVITE_USERS",TM_WEB_EMERGENCY_CALL_DISCLAIMER:"TM_WEB_EMERGENCY_CALL_DISCLAIMER",TM_WEB_FIRST_DIRECT_PRIVATE_CONV:"TM_WEB_FIRST_DIRECT_PRIVATE_CONV",TM_WEB_FIRST_DIRECT_CONV_SAY_HI:"TM_WEB_FIRST_DIRECT_CONV_SAY_HI",TM_WEB_FIRST_DIRECT_CONV_ADD:"TM_WEB_FIRST_DIRECT_CONV_ADD",TM_WEB_GUEST_ACCESS:"TM_WEB_GUEST_ACCESS",TM_WEB_SHARE_CONFERENCE_DETAILS:"TM_WEB_SHARE_CONFERENCE_DETAILS",TM_WEB_START_RECORDING:"TM_WEB_START_RECORDING",TM_WEB_STOP_RECORDING_INIT:"TM_WEB_STOP_RECORDING_INIT",TM_WEB_STOP_RECORDING_PART:"TM_WEB_STOP_RECORDING_PART",TM_WEB_FIRST_CONF_RING_ALL:"TM_WEB_FIRST_CONF_RING_ALL",TM_WEB_FIRST_CALL_ACTIONS:"TM_WEB_FIRST_CALL_ACTIONS",TM_WEB_FIRST_CALL_GO_TO_FEED:"TM_WEB_FIRST_CALL_GO_TO_FEED",TM_WEB_FIRST_CALL_FULLSCREEN:"TM_WEB_FIRST_CALL_FULLSCREEN",FIRST_WEB_LOGIN_TIMESTAMP:"FIRST_WEB_LOGIN_TIMESTAMP",VOICEMAIL_ENABLED:"VOICEMAIL_ENABLED",VOICEMAIL_TIMEOUT:"VOICEMAIL_TIMEOUT",STATUS_MESSAGE_TEXT:"STATUS_MESSAGE_TEXT",OPT_OUT_PRESENCE:"OPT_OUT_PRESENCE",SECOND_TELEPHONY_CALL_ROUTING:"SECOND_TELEPHONY_CALL_ROUTING",ATC_ROUTING:"ATC_ROUTING",VOICEMAIL_CUSTOMGREETING_ENABLED:"VOICEMAIL_CUSTOMGREETING_ENABLED",VOICEMAIL_CUSTOMGREETING_URI:"VOICEMAIL_CUSTOMGREETING_URI",DESKTOP_MESSAGE_NOTIFICATIONS_SETTING:"DESKTOP_MESSAGE_NOTIFICATIONS_SETTING",MOBILE_MESSAGE_NOTIFICATIONS_SETTING:"MOBILE_MESSAGE_NOTIFICATIONS_SETTING",PLAY_SOUND_MESSAGE_NOTIFICATIONS:"PLAY_SOUND_MESSAGE_NOTIFICATIONS",PLAY_SOUND_RTC:"PLAY_SOUND_RTC",PLAY_SYSTEM_SOUNDS:"PLAY_SYSTEM_SOUNDS",ENHANCED_DESKTOP_MESSAGE_NOTIFICATION:"ENHANCED_DESKTOP_MESSAGE_NOTIFICATION",ENHANCED_MOBILE_MESSAGE_NOTIFICATION:"ENHANCED_MOBILE_MESSAGE_NOTIFICATION",HIDE_PROFILE_EXTERNAL_ENABLED:"HIDE_PROFILE_EXTERNAL_ENABLED",PLAY_PICKUP_SOUND:"PLAY_PICKUP_SOUND",KEYBOARD_SHORTCUTS_ENABLED:"KEYBOARD_SHORTCUTS_ENABLED",TM_WEB_POPOUT_CONVERSATION:"TM_WEB_POPOUT_CONVERSATION",TM_WEB_DTMF_DIAL_PAD:"TM_WEB_DTMF_DIAL_PAD",TM_WEB_PHONE_CONSULTATION:"TM_WEB_PHONE_CONSULTATION",ANONYMOUS_RTC_PARTICIPANT:"ANONYMOUS_RTC_PARTICIPANT",VOICEMAIL_NO_RECORDING:"VOICEMAIL_NO_RECORDING",TM_SELECT_DRAFT_TYPE:"TM_SELECT_DRAFT_TYPE",TM_START_CONV_OR_CALL:"TM_START_CONV_OR_CALL"},OAuthScope:{ALL:"ALL",READ_USER_PROFILE:"READ_USER_PROFILE",WRITE_USER_PROFILE:"WRITE_USER_PROFILE",READ_CONVERSATIONS:"READ_CONVERSATIONS",WRITE_CONVERSATIONS:"WRITE_CONVERSATIONS",READ_USER:"READ_USER",CALLS:"CALLS",CALL_RECORDING:"CALL_RECORDING",MENTION_EVENT:"MENTION_EVENT",USER_MANAGEMENT:"USER_MANAGEMENT",MANAGE_CONVERSATIONS:"MANAGE_CONVERSATIONS",CREATE_CONVERSATIONS_CONTENT:"CREATE_CONVERSATIONS_CONTENT",DELETE_CONVERSATIONS_CONTENT:"DELETE_CONVERSATIONS_CONTENT",UPDATE_CONVERSATION_CONTENT:"UPDATE_CONVERSATION_CONTENT",MANAGE_PRESENCE:"MANAGE_PRESENCE",MODERATE_CONVERSATIONS:"MODERATE_CONVERSATIONS",ORGANIZE_CONVERSATIONS:"ORGANIZE_CONVERSATIONS",SEARCH_CONVERSATIONS:"SEARCH_CONVERSATIONS",USER_TO_USER:"USER_TO_USER",READ_SPACE:"READ_SPACE",WRITE_SPACE:"WRITE_SPACE",MANAGE_SPACE:"MANAGE_SPACE",CREATE_SPACE_CONTENT:"CREATE_SPACE_CONTENT",DELETE_SPACE_CONTENT:"DELETE_SPACE_CONTENT",UPDATE_SPACE_CONTENT:"UPDATE_SPACE_CONTENT",ORGANIZE_SPACE:"ORGANIZE_SPACE"},OAuthGrantTypes:{AUTHORIZATION_CODE:"AUTHORIZATION_CODE",IMPLICIT:"IMPLICIT",CLIENT_CREDENTIALS:"CLIENT_CREDENTIALS",RESOURCE_OWNER_CREDENTIALS:"RESOURCE_OWNER_CREDENTIALS",RESOURCE_OWNER:"RESOURCE_OWNER"},OAuthSubtype:{NONE:"NONE",INCOMING_WEBHOOK:"INCOMING_WEBHOOK"},MessageNotificationsSetting:{ALL:0,DIRECT_AND_MENTIONS:1,NONE:2},EnhancedMessageNotificationsSetting:{ALL:-1,NONE:0,DIRECT:1,MENTION:2,FAVORITE:4},TelephonyChangeType:{ADDED:"ADDED",UPDATED:"UPDATED",REMOVED:"REMOVED"},FederationFeature:{SPACE_FEDERATION:"SPACE_FEDERATION",CONVERSATION_FEDERATION:"CONVERSATION_FEDERATION",PRESENCE_FEDERATION:"PRESENCE_FEDERATION"},AdministrationActionType:{INVITE_USER:"INVITE_USER",ADD_USER:"ADD_USER",INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",UPDATE_USER:"UPDATE_USER",DELETE_USER:"DELETE_USER",VALIDATE_USER_INVITATION_TOKEN:"VALIDATE_USER_INVITATION_TOKEN",ACTIVATE_INVITED_USER:"ACTIVATE_INVITED_USER",RESEND_USER_INVITATION:"RESEND_USER_INVITATION",CHECK_INVALID_TENANTS:"CHECK_INVALID_TENANTS",GET_TENANT:"GET_TENANT",GET_SHARED_KEY:"GET_SHARED_KEY",GET_TENANT_SETTINGS:"GET_TENANT_SETTINGS",SET_TENANT_SETTINGS:"SET_TENANT_SETTINGS",FIND_TENANT_SETTING:"FIND_TENANT_SETTING",SAVE_TENANT_LOGIN_PROVIDER:"SAVE_TENANT_LOGIN_PROVIDER",UPDATE_TENANT_LOGIN_PROVIDER:"UPDATE_TENANT_LOGIN_PROVIDER",DELETE_TENANT_LOGIN_PROVIDER:"DELETE_TENANT_LOGIN_PROVIDER",GET_ALL_TENANT_LOGIN_PROVIDERS:"GET_ALL_TENANT_LOGIN_PROVIDERS",GET_TENANT_LOGIN_PROVIDER_BY_PROVIDERID_AND_TENANTID:"GET_TENANT_LOGIN_PROVIDER_BY_PROVIDERID_AND_TENANTID",GET_TENANT_LOGIN_PROVIDER_CONFIGURATION_BY_PROVIDERID:"GET_TENANT_LOGIN_PROVIDER_CONFIGURATION_BY_PROVIDERID",SEND_TENANT_LOGIN_PROVIDER_EMAIL_NOTIFICATIONS:"SEND_TENANT_LOGIN_PROVIDER_EMAIL_NOTIFICATIONS",UPDATE_TENANT:"UPDATE_TENANT",ENABLE_PARTNER_ADMINISTRATION:"ENABLE_PARTNER_ADMINISTRATION",DISABLE_PARTNER_ADMINISTRATION:"DISABLE_PARTNER_ADMINISTRATION",GET_RESELLER_INFO:"GET_RESELLER_INFO",SET_SUPPORT_TYPE:"SET_SUPPORT_TYPE",SET_SUPPORT_EMAIL_ADDRESS:"SET_SUPPORT_EMAIL_ADDRESS",EXPORT_DATA_USER:"EXPORT_DATA_USER",EXPORT_DATA_TENANT:"EXPORT_DATA_TENANT",UPLOAD_EXTENSION_CONFIGURATION:"UPLOAD_EXTENSION_CONFIGURATION",GET_TENANT_EXTENSIONS:"GET_TENANT_EXTENSIONS",SET_EXTENSION_STATE:"SET_EXTENSION_STATE",DELETE_EXTENSION:"DELETE_EXTENSION",REGENERATE_API_KEY:"REGENERATE_API_KEY",ADD_API_TECHNICAL_USER:"ADD_API_TECHNICAL_USER",GET_CUSTOM_APPS:"GET_CUSTOM_APPS",ADD_CUSTOM_APP:"ADD_CUSTOM_APP",GET_PROVISIONED_TENANT_USERS:"GET_PROVISIONED_TENANT_USERS",CREATE_PROVISIONED_USER:"CREATE_PROVISIONED_USER",REMOVE_PROVISIONED_USER:"REMOVE_PROVISIONED_USER",UPDATE_PROVISIONED_USER:"UPDATE_PROVISIONED_USER",SET_TELEPHONY_STATUS:"SET_TELEPHONY_STATUS",SET_TELEPHONY_TRUNK_DATA:"SET_TELEPHONY_TRUNK_DATA",GET_TELEPHONY_TRUNK_STATUS:"GET_TELEPHONY_TRUNK_STATUS",GET_TENANT_BRIDGE_NUMBERS:"GET_TENANT_BRIDGE_NUMBERS",SET_TENANT_BRIDGE_NUMBERS:"SET_TENANT_BRIDGE_NUMBERS",GET_TECHNICAL_CREDENTIALS:"GET_TECHNICAL_CREDENTIALS",ADD_TRUNK:"ADD_TRUNK",GET_TENANT_TELEPHONY_CONFIGURATION:"GET_TENANT_TELEPHONY_CONFIGURATION",ADD_TRUNK_WITHOUT_PARAMETERS:"ADD_TRUNK_WITHOUT_PARAMETERS",SET_TRUNK_PASSWORD:"SET_TRUNK_PASSWORD",GET_TELEPHONY_ROUTING_RULES:"GET_TELEPHONY_ROUTING_RULES",ADD_TELEPHONY_ROUTING_RULE:"ADD_TELEPHONY_ROUTING_RULE",UPDATE_TELEPHONY_ROUTING_RULE:"UPDATE_TELEPHONY_ROUTING_RULE",REMOVE_TELEPHONY_ROUTING_RULE:"REMOVE_TELEPHONY_ROUTING_RULE",TEST_TELEPHONY_ROUTING_RULES:"TEST_TELEPHONY_ROUTING_RULES",UPDATE_TENANT_TELEPHONY_CONFIGURATION:"UPDATE_TENANT_TELEPHONY_CONFIGURATION",GET_TELEPHONY_TRUNK_GROUPS:"GET_TELEPHONY_TRUNK_GROUPS",GET_TELEPHONY_TRUNK_GROUP:"GET_TELEPHONY_TRUNK_GROUP",ADD_TELEPHONY_TRUNK_GROUP:"ADD_TELEPHONY_TRUNK_GROUP",REMOVE_TELEPHONY_TRUNK_GROUP:"REMOVE_TELEPHONY_TRUNK_GROUP",UPDATE_TELEPHONY_TRUNK_GROUP:"UPDATE_TELEPHONY_TRUNK_GROUP",ADD_TELEPHONY_TRUNK_TO_GROUP:"ADD_TELEPHONY_TRUNK_TO_GROUP",REMOVE_TELEPHONY_TRUNK_FROM_GROUP:"REMOVE_TELEPHONY_TRUNK_FROM_GROUP",GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCKS:"GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCKS",GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",ADD_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"ADD_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",UPDATE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"UPDATE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",REMOVE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"REMOVE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",SET_TENANT_VOICEMAIL_NUMBERS:"SET_TENANT_VOICEMAIL_NUMBERS",GET_TENANT_VOICEMAIL_NUMBERS:"GET_TENANT_VOICEMAIL_NUMBERS",UPDATE_TRUNK:"UPDATE_TRUNK",START_TRUNK_SOFT_SUSPENSION:"START_TRUNK_SOFT_SUSPENSION",CANCEL_TRUNK_SOFT_SUSPENSION:"CANCEL_TRUNK_SOFT_SUSPENSION",GET_TRUNK_ACTIVE_CALLS:"GET_TRUNK_ACTIVE_CALLS",SHARE_TRUNK_GROUP:"SHARE_TRUNK_GROUP",UNSHARE_TRUNK_GROUP:"UNSHARE_TRUNK_GROUP",GET_VACANT_HOME_DIRECTORY_NUMBERS:"GET_VACANT_HOME_DIRECTORY_NUMBERS",GET_VACANT_HOME_DIRECTORY_NUMBERS_OF_SITE:"GET_VACANT_HOME_DIRECTORY_NUMBERS_OF_SITE",CREATE_OPENSCAPE_USER:"CREATE_OPENSCAPE_USER",UPDATE_OPENSCAPE_USER:"UPDATE_OPENSCAPE_USER",DELETE_OPENSCAPE_USER:"DELETE_OPENSCAPE_USER",GET_OPENSCAPE_USER:"GET_OPENSCAPE_USER",GET_OPENSCAPE_USER_V2:"GET_OPENSCAPE_USER_V2",GET_OPENSCAPE_TENANT:"GET_OPENSCAPE_TENANT",DELETE_OPENSCAPE_SITES:"DELETE_OPENSCAPE_SITES",CREATE_OPENSCAPE_SITE:"CREATE_OPENSCAPE_SITE",UPDATE_OPENSCAPE_SITE:"UPDATE_OPENSCAPE_SITE",GET_OPENSCAPE_SITE:"GET_OPENSCAPE_SITE",DELETE_PUBLIC_NUMBER_RANGE:"DELETE_PUBLIC_NUMBER_RANGE",DELETE_OPENSCAPE_MSN_NUMBER:"DELETE_OPENSCAPE_MSN_NUMBER",DELETE_PRIVATE_NUMBER_RANGE:"DELETE_PRIVATE_NUMBER_RANGE",CREATE_HUNT_GROUP:"CREATE_HUNT_GROUP",GET_HUNT_GROUP:"GET_HUNT_GROUP",GET_TENANT_HUNT_GROUPS:"GET_TENANT_HUNT_GROUPS",GET_HUNT_GROUP_PILOT_CANDIDATES:"GET_HUNT_GROUP_PILOT_CANDIDATES",GET_HUNT_GROUP_MEMBER_CANDIDATES:"GET_HUNT_GROUP_MEMBER_CANDIDATES",UPDATE_HUNT_GROUP:"UPDATE_HUNT_GROUP",DELETE_HUNT_GROUP:"DELETE_HUNT_GROUP",UPDATE_HUNT_GROUP_LIST:"UPDATE_HUNT_GROUP_LIST",GET_OPENSCAPE_ITSP_TEMPLATES:"GET_OPENSCAPE_ITSP_TEMPLATES",CREATE_OPENSCAPE_ITSP:"CREATE_OPENSCAPE_ITSP",GET_OPENSCAPE_ITSP:"GET_OPENSCAPE_ITSP",GET_OPENSCAPE_ITSPS:"GET_OPENSCAPE_ITSPS",UPDATE_OPENSCAPE_ITSP:"UPDATE_OPENSCAPE_ITSP",DELETE_OPENSCAPE_ITSP:"DELETE_OPENSCAPE_ITSP",ASSIGN_OPENSCAPE_ITSP_TO_SITE:"ASSIGN_OPENSCAPE_ITSP_TO_SITE",UNASSIGN_OPENSCAPE_ITSP_TO_SITE:"UNASSIGN_OPENSCAPE_ITSP_TO_SITE",FIND_OPENSCAPE_SITES_BY_ITSP:"FIND_OPENSCAPE_SITES_BY_ITSP",GET_PICKUP_GROUP_MEMBER_CANDIDATES:"GET_PICKUP_GROUP_MEMBER_CANDIDATES",CREATE_PICKUP_GROUP:"CREATE_PICKUP_GROUP",GET_TENANT_PICKUP_GROUPS:"GET_TENANT_PICKUP_GROUPS",DELETE_PICKUP_GROUPS:"DELETE_PICKUP_GROUPS",GET_PICKUP_GROUP:"GET_PICKUP_GROUP",UPDATE_PICKUP_GROUP:"UPDATE_PICKUP_GROUP",CREATE_AUTOMATED_ATTENDANT_CONFIGURATION:"CREATE_AUTOMATED_ATTENDANT_CONFIGURATION",GET_AUTOMATED_ATTENDANT_CONFIGURATIONS:"GET_AUTOMATED_ATTENDANT_CONFIGURATIONS",GET_AUTOMATED_ATTENDANT_CONFIGURATION:"GET_AUTOMATED_ATTENDANT_CONFIGURATION",UPDATE_AUTOMATED_ATTENDANT_CONFIGURATION:"UPDATE_AUTOMATED_ATTENDANT_CONFIGURATION",DELETE_AUTOMATED_ATTENDANT_CONFIGURATIONS:"DELETE_AUTOMATED_ATTENDANT_CONFIGURATIONS",GET_THIRD_PARTY_DEVICE_INFO:"GET_THIRD_PARTY_DEVICE_INFO",IS_MSN_RESERVED:"IS_MSN_RESERVED",HAS_RESERVED_DNS_IN_SITE_RANGES:"HAS_RESERVED_DNS_IN_SITE_RANGES",GET_TENANT_EXECUTIVE_ASSISTANT_GROUPS:"GET_TENANT_EXECUTIVE_ASSISTANT_GROUPS",CREATE_EXECUTIVE_ASSISTANT_GROUP:"CREATE_EXECUTIVE_ASSISTANT_GROUP",CREATE_EXECUTIVE_ASSISTANT_GROUP_ASYNC:"CREATE_EXECUTIVE_ASSISTANT_GROUP_ASYNC",GET_EXECUTIVE_ASSISTANT_GROUP_MEMBER_CANDIDATES:"GET_EXECUTIVE_ASSISTANT_GROUP_MEMBER_CANDIDATES",GET_EXECUTIVE_ASSISTANT_GROUP:"GET_EXECUTIVE_ASSISTANT_GROUP",GET_COMPOSER_CONNECTION_DETAILS:"GET_COMPOSER_CONNECTION_DETAILS",DELETE_EXECUTIVE_ASSISTANT_GROUPS:"DELETE_EXECUTIVE_ASSISTANT_GROUPS",ADD_LDAP_CONFIGURATION_FOR_PHONE:"ADD_LDAP_CONFIGURATION_FOR_PHONE",GET_LDAP_CONFIGURATION_FOR_PHONE:"GET_LDAP_CONFIGURATION_FOR_PHONE",VALIDATE_TRANSFER_TARGET:"VALIDATE_TRANSFER_TARGET",ADD_PHONE_ONLY_USER:"ADD_PHONE_ONLY_USER",ADD_SHARED_DEVICE:"ADD_SHARED_DEVICE",CREATE_APPLICATION_FRAMEWORK_CONFIGURATION:"CREATE_APPLICATION_FRAMEWORK_CONFIGURATION",GET_APPLICATION_FRAMEWORK_CONFIGURATIONS:"GET_APPLICATION_FRAMEWORK_CONFIGURATIONS",GET_APPLICATION_FRAMEWORK_CONFIGURATION:"GET_APPLICATION_FRAMEWORK_CONFIGURATION",UPDATE_APPLICATION_FRAMEWORK_CONFIGURATION:"UPDATE_APPLICATION_FRAMEWORK_CONFIGURATION",DELETE_APPLICATION_FRAMEWORK_CONFIGURATIONS:"DELETE_APPLICATION_FRAMEWORK_CONFIGURATIONS",SUSPEND_USER:"SUSPEND_USER",UNSUSPEND_USER:"UNSUSPEND_USER",INVITE_PARTNER_USER:"INVITE_PARTNER_USER",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS",ADD_MEETING_POINT:"ADD_MEETING_POINT",ADD_MEETING_POINT_V2:"ADD_MEETING_POINT_V2",UPDATE_MEETING_POINT_V2:"UPDATE_MEETING_POINT_V2",SET_CMR_SETTINGS:"SET_CMR_SETTINGS",GET_CMR_SETTINGS:"GET_CMR_SETTINGS",GET_CMR_INFO_BY_ID:"GET_CMR_INFO_BY_ID",GET_CMR_INFO_BY_IDS:"GET_CMR_INFO_BY_IDS",SET_ADMIN_MANAGED_CMR_SETTINGS:"SET_ADMIN_MANAGED_CMR_SETTINGS",SET_ADMIN_MANAGED_CMR_SETTINGS_BY_IDS:"SET_ADMIN_MANAGED_CMR_SETTINGS_BY_IDS",SHARE_CMR:"SHARE_CMR",UNSHARE_CMR:"UNSHARE_CMR",GET_CMR_SHARED_TENANT_INFO:"GET_CMR_SHARED_TENANT_INFO",SEND_CMR_COMMAND:"SEND_CMR_COMMAND",GET_PARTNER_MANAGEABLE_TENANTS:"GET_PARTNER_MANAGEABLE_TENANTS",GET_SYSTEM_NOTIFICATIONS:"GET_SYSTEM_NOTIFICATIONS",ADD_SYSTEM_NOTIFICATION:"ADD_SYSTEM_NOTIFICATION",REMOVE_SYSTEM_NOTIFICATION:"REMOVE_SYSTEM_NOTIFICATION",UPDATE_SYSTEM_NOTIFICATION:"UPDATE_SYSTEM_NOTIFICATION"},InvitationResponseCode:{INVITATION_SEND:"INVITATION_SEND",INVITATION_NOT_SEND:"INVITATION_NOT_SEND",INVALID_USER_STATE:"INVALID_USER_STATE",EMAIL_ALREADY_EXISTS:"EMAIL_ALREADY_EXISTS",ACCOUNT_ASSIGNMENT_FAILED:"ACCOUNT_ASSIGNMENT_FAILED",ERROR:"ERROR",SYSTEM_OVERLOADED:"SYSTEM_OVERLOADED",EMAIL_ALREADY_EXISTS_ON_SAME_TENANT:"EMAIL_ALREADY_EXISTS_ON_SAME_TENANT",UNTRUSTED_PARTNER_TENANT:"UNTRUSTED_PARTNER_TENANT",XMPP_FEDERATED_USER_NOT_FOUND:"XMPP_FEDERATED_USER_NOT_FOUND",LICENSE_LIMIT_EXCEEDED:"LICENSE_LIMIT_EXCEEDED",LICENSE_ERROR:"LICENSE_ERROR"},InvitationStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},GetUsersSorting:{USER_NAME:"USER_NAME",DATA_USAGE:"DATA_USAGE",LAST_ACCESS:"LAST_ACCESS",ROLE:"ROLE",STATUS:"STATUS",PHONE_NUMBER_ASSIGNED:"PHONE_NUMBER_ASSIGNED",EMAIL:"EMAIL"},GetUsersSearchFor:{ROLE:"ROLE",STATUS:"STATUS",NAME:"NAME",PRIMARY_EMAIL:"PRIMARY_EMAIL"},SetRoleRole:{ADMIN:"ADMIN",USER:"USER"},AdministrationEventType:{INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS"},SupportType:{CONVERSATION:"CONVERSATION",NO_SUPPORT:"NO_SUPPORT",EMAIL:"EMAIL",PARTNER_ADMIN_EMAIL:"PARTNER_ADMIN_EMAIL"},SystemNotificationType:{MAINTENANCE:"MAINTENANCE",BROADCAST:"BROADCAST"},HuntType:{INIT:"INIT",LINEAR:"LINEAR",CIRCULAR_WITH_HUNT:"CIRCULAR_WITH_HUNT",UCD:"UCD",MANUAL:"MANUAL",PARALLEL:"PARALLEL",PARALLEL_SA:"PARALLEL_SA"},TenantSettingsType:{CREDENTIALS_LOGIN_ENABLED:"CREDENTIALS_LOGIN_ENABLED",TELEPHONY_CONFIG_CONVERSATION:"TELEPHONY_CONFIG_CONVERSATION",CLIENT_AUTO_UPDATE:"CLIENT_AUTO_UPDATE",HELP_URL:"HELP_URL",SDK_USAGE_ENABLED:"SDK_USAGE_ENABLED",OAUTH_ACCESS_ENABLED:"OAUTH_ACCESS_ENABLED",LOGIN_METHODS_AVAILABLE:"LOGIN_METHODS_AVAILABLE",DATA_RETENTION_PERIOD:"DATA_RETENTION_PERIOD",PLUGIN_SELF_MANAGED_ENABLED:"PLUGIN_SELF_MANAGED_ENABLED",PLUGIN_DESKTOP_APP_ENABLED:"PLUGIN_DESKTOP_APP_ENABLED",PLUGIN_IE_PLUGIN_ENABLED:"PLUGIN_IE_PLUGIN_ENABLED",PLUGIN_MICROSOFT_OUTLOOK_INTEGRATION_ENABLED:"PLUGIN_MICROSOFT_OUTLOOK_INTEGRATION_ENABLED",PLUGIN_CHROME_EXTENSION_ENABLED:"PLUGIN_CHROME_EXTENSION_ENABLED",EXTENSION_MICROSOFT_EXCHANGE_ENABLED:"EXTENSION_MICROSOFT_EXCHANGE_ENABLED",EXTENSION_BOX_ENABLED:"EXTENSION_BOX_ENABLED",EXTENSION_GOOGLE_DRIVE_ENABLED:"EXTENSION_GOOGLE_DRIVE_ENABLED",EXTENSION_SYNCPLICITY_ENABLED:"EXTENSION_SYNCPLICITY_ENABLED",EXTENSION_JABRA_ENABLED:"EXTENSION_JABRA_ENABLED",EXTENSION_OPEN_XCHANGE_ENABLED:"EXTENSION_OPEN_XCHANGE_ENABLED",EXTENSION_PLANTRONICS_ENABLED:"EXTENSION_PLANTRONICS_ENABLED",EXTENSION_VDI_ENABLED:"EXTENSION_VDI_ENABLED",LOOKUP_API_BLACKLISTED_DOMAINS:"LOOKUP_API_BLACKLISTED_DOMAINS",ROOT_DEVICES_ALLOWED:"ROOT_DEVICES_ALLOWED",DT_LEGAL_INFORMATION:"DT_LEGAL_INFORMATION",SSO_REDIRECT_URL:"SSO_REDIRECT_URL",EXTENSION_ONE_DRIVE_ENABLED:"EXTENSION_ONE_DRIVE_ENABLED",EXTENSION_SKYPE_FOR_BUSINESS_ENABLED:"EXTENSION_SKYPE_FOR_BUSINESS_ENABLED",PHONE_DIALOUT_CALLER_ID_PREFIX:"PHONE_DIALOUT_CALLER_ID_PREFIX",PHONE_DIALOUT_MODE:"PHONE_DIALOUT_MODE",PHONE_DIALOUT_ENABLED:"PHONE_DIALOUT_ENABLED",SKYPE4B_CLIENT_ID:"SKYPE4B_CLIENT_ID",SKYPE4B_ROOT_URL:"SKYPE4B_ROOT_URL",C4O_AUTO_UPDATE:"C4O_AUTO_UPDATE",DA_AUTO_UPDATE:"DA_AUTO_UPDATE",EXTENSION_SENNHEISER_ENABLED:"EXTENSION_SENNHEISER_ENABLED",MUTE_ON_ENTRY:"MUTE_ON_ENTRY",MUTE_ON_ENTRY_CMR:"MUTE_ON_ENTRY_CMR",MUTE_ON_ENTRY_OUTCALL:"MUTE_ON_ENTRY_OUTCALL",C4O_PRESENCE_SETTINGS:"C4O_PRESENCE_SETTINGS",EXTENSION_ZAPIER_ENABLED:"EXTENSION_ZAPIER_ENABLED",CLOUD_ISTP_DRAFT_NUMBER_LIMIT_ENABLED:"CLOUD_ISTP_DRAFT_NUMBER_LIMIT_ENABLED",REMOTE_CONTROL_ENABLED:"REMOTE_CONTROL_ENABLED",REMOTE_CONTROL_EXTERNAL_ENABLED:"REMOTE_CONTROL_EXTERNAL_ENABLED",EXTENSION_EMBRAVA_ENABLED:"EXTENSION_EMBRAVA_ENABLED",EXTENSION_CONCEPTBOARD_ENABLED:"EXTENSION_CONCEPTBOARD_ENABLED",DATA_RETENTION_STRATEGY:"DATA_RETENTION_STRATEGY",PLANTRONICS_HUB_DOWNLOAD_URL:"PLANTRONICS_HUB_DOWNLOAD_URL",INCOMING_WEBHOOKS_ENABLED:"INCOMING_WEBHOOKS_ENABLED",CONVERSATION_RETENTION_POLICY_CHANGEABLE:"CONVERSATION_RETENTION_POLICY_CHANGEABLE",EXTENSION_GOOGLE_CONTACTS_ENABLED:"EXTENSION_GOOGLE_CONTACTS_ENABLED",EXTENSION_JPL_ENABLED:"EXTENSION_JPL_ENABLED",SCREENSHARE_DISABLED:"SCREENSHARE_DISABLED",FILESHARE_DISABLED:"FILESHARE_DISABLED",TRANSCRIPTION_ENABLED:"TRANSCRIPTION_ENABLED",TRANSCRIPTION_GOOGLE_API_KEY:"TRANSCRIPTION_GOOGLE_API_KEY",SUPPRESS_JOIN_INDICATION_THRESHOLD:"SUPPRESS_JOIN_INDICATION_THRESHOLD",USER_CONTROLLED_WEBRTC_POLICY_ENABLED:"USER_CONTROLLED_WEBRTC_POLICY_ENABLED",DATA_RETENTION_RECORDING_PERIOD:"DATA_RETENTION_RECORDING_PERIOD",DATA_RETENTION_EXTENDED_RECORDING_PERIOD:"DATA_RETENTION_EXTENDED_RECORDING_PERIOD",GLOBAL_SPACE_CREATION_ENABLED:"GLOBAL_SPACE_CREATION_ENABLED",ALLOW_EXTERNAL_SPACES:"ALLOW_EXTERNAL_SPACES",TRANSCRIPTION_LOCALES:"TRANSCRIPTION_LOCALES",EXTENSION_MEISTERTASK_ENABLED:"EXTENSION_MEISTERTASK_ENABLED",MASS_OPENSCAPE_USER_MANAGEMENT:"MASS_OPENSCAPE_USER_MANAGEMENT",FAQ_URL:"FAQ_URL",SPACE_DEFAULT_TYPE:"SPACE_DEFAULT_TYPE",ANONYMOUS_PARTICIPANTS_ENABLED:"ANONYMOUS_PARTICIPANTS_ENABLED",EXTENSION_KUANDO_ENABLED:"EXTENSION_KUANDO_ENABLED",EXTENSION_C4G_ENABLED:"EXTENSION_C4G_ENABLED",PASSWORD_POLICY_CONFIG_JSON:"PASSWORD_POLICY_CONFIG_JSON",IC_SUPPORT_PHONE_NUMBER:"IC_SUPPORT_PHONE_NUMBER",IC_SUPPORT_EMAIL_ADDRESS:"IC_SUPPORT_EMAIL_ADDRESS",IC_SUPPORT_OPERATING_HOURS_FROM:"IC_SUPPORT_OPERATING_HOURS_FROM",IC_SUPPORT_OPERATING_HOURS_TO:"IC_SUPPORT_OPERATING_HOURS_TO",IC_SUPPORT_OPERATING_HOURS_TIMEZONE:"IC_SUPPORT_OPERATING_HOURS_TIMEZONE",IC_USER_MANUAL_URL:"IC_USER_MANUAL_URL",IC_SAFETY_NOTICE_URL:"IC_SAFETY_NOTICE_URL",IC_ADDITIONAL_TERMS_OF_SERVICE_URL:"IC_ADDITIONAL_TERMS_OF_SERVICE_URL",EXTENSION_C4C_ENABLED:"EXTENSION_C4C_ENABLED",EXTENSION_C4O365_ENABLED:"EXTENSION_C4O365_ENABLED",SPACE_FEDERATION:"SPACE_FEDERATION",CONVERSATION_FEDERATION:"CONVERSATION_FEDERATION",PRESENCE_FEDERATION:"PRESENCE_FEDERATION",EXTERNAL_COMMUNICATION_BLOCKED:"EXTERNAL_COMMUNICATION_BLOCKED",EVENT_ORGANIZER_CONFIG:"EVENT_ORGANIZER_CONFIG",CALL_QUALITY_RATING_PERCENTAGE:"CALL_QUALITY_RATING_PERCENTAGE",EXTENSION_PLANTRONICS_STATUS_ENABLED:"EXTENSION_PLANTRONICS_STATUS_ENABLED",USER_BY_EMAIL_FEDERATION:"USER_BY_EMAIL_FEDERATION",EXTENSION_C4TEAMS_ENABLED:"EXTENSION_C4TEAMS_ENABLED",CO_BRANDING_CONFIG_JSON:"CO_BRANDING_CONFIG_JSON",EXTENSION_MICROSOFT_SHAREPOINT_ENABLED:"EXTENSION_MICROSOFT_SHAREPOINT_ENABLED"},TenantConfigurableTextType:{GUEST_ACCESS_ACCEPTANCE_TEXT:"GUEST_ACCESS_ACCEPTANCE_TEXT",USER_INVITE_ACCEPTANCE_TEXT:"USER_INVITE_ACCEPTANCE_TEXT"},TrunkState:{UP:"UP",DOWN:"DOWN",NOT_REQUESTED:"NOT_REQUESTED",REQUESTED:"REQUESTED",SUSPENDING:"SUSPENDING"},GtcTrunkType:{GTC_TRUNK_TYPE:"GTC_TRUNK_TYPE",ETC_TRUNK_TYPE:"ETC_TRUNK_TYPE",ATC_TRUNK_TYPE:"ATC_TRUNK_TYPE",EMBEDDED_TC_TRUNK_TYPE:"EMBEDDED_TC_TRUNK_TYPE",OSBIZ_TRUNK_TYPE:"OSBIZ_TRUNK_TYPE",SUB_TRUNK_TYPE:"SUB_TRUNK_TYPE"},TelephonyRoutingRuleCriteria:{ORIGIN:"ORIGIN",DESTINATION:"DESTINATION"},TelephonyRoutingRuleOperator:{AND:"AND",OR:"OR"},TelephonyRoutingRuleApplication:{TELEPHONY:"TELEPHONY",CONF_DIAL_OUT:"CONF_DIAL_OUT",BOTH:"BOTH"},TelephonyConfigurationDefaultRouting:{ANY:"ANY",NONE:"NONE"},TelephonyRoutingRuleResult:{NO_MATCH:"NO_MATCH",MATCH:"MATCH",SELECTED:"SELECTED"},ProviderType:{CREDENTIALS:"CREDENTIALS",SAML:"SAML",OPENID:"OPENID"},PhoneDialoutMode:{PHONE_USERS_ONLY:"PHONE_USERS_ONLY",ALL_USERS:"ALL_USERS"},RemoveTrunkGroupResult:{SUCCESS:"SUCCESS",REFERENCES_EXIST:"REFERENCES_EXIST",UNKNOWN_ERROR:"UNKNOWN_ERROR"},CMRSettingKey:{CMR_ADDRESS:"CMR_ADDRESS",CMR_PLATFORM_VERSION:"CMR_PLATFORM_VERSION",CMR_OS_VERSION:"CMR_OS_VERSION",CMR_APP_VERSION:"CMR_APP_VERSION",CMR_MAC_ADDRESS:"CMR_MAC_ADDRESS",VIDEO_DEVICE:"VIDEO_DEVICE",AUDIO_DEVICE:"AUDIO_DEVICE",PRIMARY_DISPLAY:"PRIMARY_DISPLAY",SECONDARY_DISPLAY:"SECONDARY_DISPLAY",UPDATE_SERVER_STATUS:"UPDATE_SERVER_STATUS",PLAYBACK_DEVICE:"PLAYBACK_DEVICE",RECORDING_DEVICE:"RECORDING_DEVICE"},AdminManagedCMRSettingKey:{CMR_UDP_QOS:"CMR_UDP_QOS",CMR_UDP_AUDIO_DSCP:"CMR_UDP_AUDIO_DSCP",CMR_UDP_VIDEO_DSCP:"CMR_UDP_VIDEO_DSCP",CMR_TCP_QOS:"CMR_TCP_QOS",CMR_TCP_AUDIO_DSCP:"CMR_TCP_AUDIO_DSCP",CMR_TCP_VIDEO_DSCP:"CMR_TCP_VIDEO_DSCP",MANUAL_TIME:"MANUAL_TIME",TIMEZONE:"TIMEZONE",DATE:"DATE",TIME:"TIME",NTP_SERVER:"NTP_SERVER",REMOTE_ACCESS:"REMOTE_ACCESS",ENERGY_SAVING:"ENERGY_SAVING",SUSPEND_AFTER:"SUSPEND_AFTER",DASHBOARD_PASSWORD:"DASHBOARD_PASSWORD",SW_UPDATE_INFO:"SW_UPDATE_INFO",CMR_MANUAL_QOS_PORTS:"CMR_MANUAL_QOS_PORTS",CMR_UDP_AUDIO_START_PORT:"CMR_UDP_AUDIO_START_PORT",CMR_UDP_AUDIO_END_PORT:"CMR_UDP_AUDIO_END_PORT",CMR_UDP_VIDEO_START_PORT:"CMR_UDP_VIDEO_START_PORT",CMR_UDP_VIDEO_END_PORT:"CMR_UDP_VIDEO_END_PORT",CMR_TCP_AUDIO_START_PORT:"CMR_TCP_AUDIO_START_PORT",CMR_TCP_AUDIO_END_PORT:"CMR_TCP_AUDIO_END_PORT",CMR_TCP_VIDEO_START_PORT:"CMR_TCP_VIDEO_START_PORT",CMR_TCP_VIDEO_END_PORT:"CMR_TCP_VIDEO_END_PORT",SW_UPDATE_PENDING:"SW_UPDATE_PENDING",RESTART_PENDING:"RESTART_PENDING",TRAPS_ENABLED:"TRAPS_ENABLED",SNMP_USERNAME:"SNMP_USERNAME",AUTHENTICATION_PASSWORD:"AUTHENTICATION_PASSWORD",ENCRYPTION_PASSWORD:"ENCRYPTION_PASSWORD",TRAP_DESTINATION_1:"TRAP_DESTINATION_1",TRAP_DESTINATION_2:"TRAP_DESTINATION_2",NO_AUDIO_CONNECTED_ENABLED:"NO_AUDIO_CONNECTED_ENABLED",NO_VIDEO_CONNECTED_ENABLED:"NO_VIDEO_CONNECTED_ENABLED",PERIODIC_REBOOT_ENABLED:"PERIODIC_REBOOT_ENABLED",PERIODIC_REBOOT_TOD:"PERIODIC_REBOOT_TOD",SWAP_AUXILIARY_CONTENT:"SWAP_AUXILIARY_CONTENT",DHCP:"DHCP",PROXY:"PROXY",PROXY_ADDRESS:"PROXY_ADDRESS",CIRCUIT_NO_PROXY:"CIRCUIT_NO_PROXY",PROXY_USERNAME:"PROXY_USERNAME",PROXY_PASSWORD:"PROXY_PASSWORD"},CMRCommand:{DOWNLOAD_SYSTEM_LOGS:"DOWNLOAD_SYSTEM_LOGS",UPDATE_SOFTWARE:"UPDATE_SOFTWARE",RESTART:"RESTART"},UcaasDeviceStatus:{NO_DEVICE:"NO_DEVICE",NOT_CONFIGURED:"NOT_CONFIGURED",CONFIGURED:"CONFIGURED"},DeviceTypeAssigned:{NONE:"NONE",UNIFY:"UNIFY",THIRD_PARTY:"THIRD_PARTY"},OpenscapeDirectoryNumberUsage:{MLHG_MEMBER:"MLHG_MEMBER",MLHG_PILOT:"MLHG_PILOT",PICKUP_MEMBER:"PICKUP_MEMBER",EXECUTIVE_ASSISTANT_MEMBER:"EXECUTIVE_ASSISTANT_MEMBER",MLHG_OVERFLOW_DESTINATION:"MLHG_OVERFLOW_DESTINATION",AA_TRANSFER_TARGET:"AA_TRANSFER_TARGET"},StatisticsTypes:{ACCOUNT_FLUX:"account-flux",ACCOUNT_STATUS:"account-status",CDR_STATS:"cdr-stats",DAILY_LOGINS_BY_DEVICE_SUB_TYPE:"daily-logins-by-device-sub-type",DAILY_LOGINS_BY_DEVICE_TYPE_VERSION:"daily-logins-by-device-type-version",DISCONNECT_CAUSE_BY_DEV_TYPE:"disconnect-cause-by-dev-type",DOCUMENTATION:"documentation",ITEM_ACTIVITY:"item-activity",USER_ADOPTION:"user-adoption",MINUTES_BY_MEDIA_STACKED:"minutes-by-media-stacked",QOS_METRIC_HISTOGRAM:"qos-metric-histogram",RATINGS_INTERVAL_STATS:"ratings-interval-stats",RATINGS_PIE_STATS:"ratings-pie-stats",RATINGS_PIE_COMBINED:"ratings-combined"},StatisticsTimePeriod:{TODAY:"TODAY",ONE_WEEK:"ONE_WEEK",TWO_WEEKS:"TWO_WEEKS",THREE_WEEKS:"THREE_WEEKS",FOUR_WEEKS:"FOUR_WEEKS"},StatisticsQosMetric:{JI:"JI",LA:"LA",MOS:"MOS",PLL:"PLL",PLR:"PLR"},StatisticsDeviceTypes:{ANDROID:"android",C4O:"c4o",CMR:"cmr",DA:"da",GTC:"gtc",GUEST:"guest",IOS:"ios",VRS:"vrs",WEB:"web"},ITSPRegistrationStates:{REGISTERED:"REGISTERED",NOT_REGISTERED:"NOT_REGISTERED",DA_FAILURE:"DA_FAILURE"},ITSPConnectionStates:{CONNECTED:"CONNECTED",NOT_CONNECTED:"NOT_CONNECTED"},ITSPConfigurationStates:{IN_PROGRESS:"IN_PROGRESS",FAILED:"FAILED",CREATED:"CREATED",DELETED:"DELETED",DELETE_FAILED:"DELETE_FAILED"},ExecutiveAssistantGroupStatus:{CREATED:"CREATED",CREATION_FAILED:"CREATION_FAILED",IN_PROGRESS:"IN_PROGRESS",DELETE_IN_PROGRESS:"DELETE_IN_PROGRESS",DELETED:"DELETED",DELETION_FAILED:"DELETION_FAILED"},AuthenticationType:{ANONYMOUS:"ANONYMOUS",SIMPLE:"SIMPLE"},TenantType:{DEFAULT:"DEFAULT",CAPEX:"CAPEX"},ThirdPartyConnectorsActionType:{GET_SETTINGS:"GET_SETTINGS",SAVE_SETTINGS:"SAVE_SETTINGS",CONNECT:"CONNECT",DISCONNECT:"DISCONNECT",SEND_AUTH_CODE:"SEND_AUTH_CODE",GET_CONNECTION_STATUS:"GET_CONNECTION_STATUS",GET_FOLDER_ITEMS:"GET_FOLDER_ITEMS",SHARE_FOLDER_ITEMS:"SHARE_FOLDER_ITEMS",UNSHARE_FOLDER_ITEMS:"UNSHARE_FOLDER_ITEMS",GET_EDIT_URL:"GET_EDIT_URL",GET_FOLDER_ITEMS_WITH_CURSOR:"GET_FOLDER_ITEMS_WITH_CURSOR",CONNECT_STORAGE:"CONNECT_STORAGE",REFRESH_CONNECTION:"REFRESH_CONNECTION",GET_OAUTH_DATA:"GET_OAUTH_DATA",GET_OAUTH_DATA_SESSION:"GET_OAUTH_DATA_SESSION"},ThirdPartyConnectorType:{EXCHANGE_CONNECTOR:"EXCHANGE_CONNECTOR",BOX:"BOX",OPEN_XCHANGE:"OPEN_XCHANGE",GOOGLE_CONTACTS:"GOOGLE_CONTACTS",GOOGLE_DRIVE:"GOOGLE_DRIVE",SYNCPLICITY:"SYNCPLICITY",ONE_DRIVE:"ONE_DRIVE",CLIENT_THIRDPARTY:"CLIENT_THIRDPARTY",ZAPIER:"ZAPIER",CONCEPTBOARD:"CONCEPTBOARD",MEISTERTASK:"MEISTERTASK",MS_SHAREPOINT:"MS_SHAREPOINT"},ThirdPartyEventType:{CONNECTED_TO_THIRDPARTY:"CONNECTED_TO_THIRDPARTY",DISCONNECTED_FROM_THIRDPARTY:"DISCONNECTED_FROM_THIRDPARTY"},ThirdPartyContentType:{SKYPE4B:"SKYPE4B"},Skype4BAuthentication:{BASIC:"BASIC",AZUREAD:"AZUREAD"},MsGraphDataTypes:{FILE:"file",FOLDER:"folder",DRIVE:"drive",SITE:"site",CONTENT:"content",SUBSITES:"subsites"},GuestActionType:{VALIDATE_SESSION_INVITE_TOKEN:"VALIDATE_SESSION_INVITE_TOKEN",REGISTER_SESSION_GUEST:"REGISTER_SESSION_GUEST",GET_REGIONS:"GET_REGIONS",GET_JOINING_INSTRUCTIONS:"GET_JOINING_INSTRUCTIONS",VALIDATE_SESSION_PIN:"VALIDATE_SESSION_PIN"},SessionInviteInfoResult:{INVALID:"INVALID",VALID_NOSESSION:"VALID_NOSESSION",VALID_SESSION:"VALID_SESSION",VALID_NO_GUEST_ACCESS:"VALID_NO_GUEST_ACCESS"},UserRoutingMessageType:{ATC:"ATC",CMP:"CMP",CONTACT_CARD:"CONTACT_CARD",DESKTOP_APP:"DESKTOP_APP",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",SDK:"SDK",STC:"STC",TEAM_PICKUP:"TEAM_PICKUP"},VersionActionType:{GET_VERSION:"GET_VERSION"},AccountActionType:{GET_PACKAGE_TEMPLATES:"GET_PACKAGE_TEMPLATES",GET_ASSIGNED_PACKAGES:"GET_ASSIGNED_PACKAGES",VALIDATE_ASSIGN_ACCOUNT_TEMPLATE:"VALIDATE_ASSIGN_ACCOUNT_TEMPLATE",ASSIGN_ACCOUNT_TEMPLATE:"ASSIGN_ACCOUNT_TEMPLATE",VALIDATE_MIGRATE_ACCOUNT:"VALIDATE_MIGRATE_ACCOUNT",MIGRATE_ACCOUNT:"MIGRATE_ACCOUNT",MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",GET_ACCOUNTS:"GET_ACCOUNTS",GET_SEARCH_TAGS:"GET_SEARCH_TAGS",SUSPEND_ACCOUNT:"SUSPEND_ACCOUNT",UNSUSPEND_ACCOUNT:"UNSUSPEND_ACCOUNT",ASSIGN_TELEPHONY_CONFIGURATION:"ASSIGN_TELEPHONY_CONFIGURATION",DELETE_TELEPHONY_CONFIGURATION:"DELETE_TELEPHONY_CONFIGURATION",GET_ACCOUNT_BY_ID:"GET_ACCOUNT_BY_ID",GET_ACCOUNT_BY_USER_ID:"GET_ACCOUNT_BY_USER_ID",GET_TECHNICAL_ADMIN_USER_ID:"GET_TECHNICAL_ADMIN_USER_ID",RENEW_ASSOCIATED_TELEPHONY_USER:"RENEW_ASSOCIATED_TELEPHONY_USER",ADD_ACCOUNT_PERMISSION:"ADD_ACCOUNT_PERMISSION",REMOVE_ACCOUNT_PERMISSION:"REMOVE_ACCOUNT_PERMISSION"},UserDataActionType:{GET_USER_DATA:"GET_USER_DATA"},AccountEventType:{MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",TELEPHONY_CONFIGURATION_UPDATED:"TELEPHONY_CONFIGURATION_UPDATED",TC_BALANCING_NEEDED:"TC_BALANCING_NEEDED",TC_START_REASSIGNMENT:"TC_START_REASSIGNMENT"},AccountTemplateName:{USER:"USER",ADMIN:"ADMIN",MEETING_POINT:"MEETING_POINT",XMPP_FEDERATED_USER:"XMPP_FEDERATED_USER"},AccountStatus:{NONE:"NONE",CREATED:"CREATED",INITIAL:"INITIAL",INVITED:"INVITED",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED"},GetAccountsSorting:{BY_FIRST_NAME:"BY_FIRST_NAME",BY_LAST_NAME:"BY_LAST_NAME",BY_NAME:"BY_NAME",BY_PRIMARY_EMAIL:"BY_PRIMARY_EMAIL",BY_PHONE_NUMBER:"BY_PHONE_NUMBER",BY_LAST_LOGIN:"BY_LAST_LOGIN",BY_LOCATION:"BY_LOCATION"},GetAccountsFilterCriteria:{PRIMARY_EMAIL:"PRIMARY_EMAIL",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",STATUS:"STATUS",TAG:"TAG",TELEPHONY_USER_ID:"TELEPHONY_USER_ID",TELEPHONY_TRUNK_GROUP_ID:"TELEPHONY_TRUNK_GROUP_ID"},SystemPermission:{IGNORE:"IGNORE",CLIENT_LOGON:"CLIENT_LOGON",INVITE_USER:"INVITE_USER",ROLE_TELEPHONY_CONNECTOR:"ROLE_TELEPHONY_CONNECTOR",ROLE_VIRTUAL_TELEPHONY_CONNECTOR:"ROLE_VIRTUAL_TELEPHONY_CONNECTOR",ROLE_TECHNICAL:"ROLE_TECHNICAL",ROLE_SESSION_GUEST:"ROLE_SESSION_GUEST",ROLE_USER:"ROLE_USER",ROLE_TENANT_ADMIN:"ROLE_TENANT_ADMIN",ROLE_SUPPORT:"ROLE_SUPPORT",ROLE_SYSTEM_ADMIN:"ROLE_SYSTEM_ADMIN",ROLE_SYSTEM_USER:"ROLE_SYSTEM_USER",ROLE_SYSTEM:"ROLE_SYSTEM",MANAGE_TENANT:"MANAGE_TENANT",TELEPHONY:"TELEPHONY",RECORDING:"RECORDING",MODERATION:"MODERATION",GUEST_ACCESS:"GUEST_ACCESS",MAX_PACKAGE_ACCOUNTS:"MAX_PACKAGE_ACCOUNTS",FREE_TRIAL:"FREE_TRIAL",USER_STORAGE:"USER_STORAGE",INTEGRATIONS:"INTEGRATIONS",RTC_PARTICIPANTS:"RTC_PARTICIPANTS",ACCOUNTS:"ACCOUNTS",IE_PLUGIN_SUPPORT:"IE_PLUGIN_SUPPORT",SUPPORT_CONVERSATION:"SUPPORT_CONVERSATION",SUPPORT_FORUM:"SUPPORT_FORUM",OUTLOOK_PLUGIN:"OUTLOOK_PLUGIN",TENANT_STORAGE:"TENANT_STORAGE",PSTN_DIAL_IN:"PSTN_DIAL_IN",LDAP_AGENT:"LDAP_AGENT",INVITE_PARTNER:"INVITE_PARTNER",LARGE_CONFERENCE:"LARGE_CONFERENCE",CREATE_COMMUNITY:"CREATE_COMMUNITY",CONTENT_MODERATOR:"CONTENT_MODERATOR",SDK_ACCESS:"SDK_ACCESS",OAUTH_ACCESS_ENABLED:"OAUTH_ACCESS_ENABLED",SDK_USAGE_ENABLED:"SDK_USAGE_ENABLED",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",BASIC_AUTHENTICATION:"BASIC_AUTHENTICATION",ENTITY_ACCESS_DENIED:"ENTITY_ACCESS_DENIED",ROLE_BOT:"ROLE_BOT",NO_SECURITY_CONTEXT:"NO_SECURITY_CONTEXT",NO_OAUTH_SCOPE_ACCESS:"NO_OAUTH_SCOPE_ACCESS",MS_CONNECTOR:"MS_CONNECTOR",RTC_WHITE_BOARD:"RTC_WHITE_BOARD",SYSTEM_ANALYTICS:"SYSTEM_ANALYTICS",VENDOR_ANALYTICS:"VENDOR_ANALYTICS",TENANT_ANALYTICS:"TENANT_ANALYTICS",USER_ANALYTICS:"USER_ANALYTICS",UCAAS:"UCAAS",PARTNER_ADMIN:"PARTNER_ADMIN",DEVELOPER_CONSOLE_ACCESS:"DEVELOPER_CONSOLE_ACCESS",DEVELOPER_CONSOLE_VIEW:"DEVELOPER_CONSOLE_VIEW",DEVELOPER_CONSOLE_MANAGE_USER:"DEVELOPER_CONSOLE_MANAGE_USER",S4B_INTEGRATION:"S4B_INTEGRATION",TENANT_PRESENCE_SUBSCRIPTION:"TENANT_PRESENCE_SUBSCRIPTION",SCREEN_CONTROL:"SCREEN_CONTROL",CONCURRENT_VIDEO_CHANNELS:"CONCURRENT_VIDEO_CHANNELS",WORKFLOW_INTEGRATIONS:"WORKFLOW_INTEGRATIONS",CLV_SUPERADMIN:"CLV_SUPERADMIN",UCAAS_MLHG_QUEUING:"UCAAS_MLHG_QUEUING",DISTRIBUTOR_ANALYTICS:"DISTRIBUTOR_ANALYTICS",RESELLER_ANALYTICS:"RESELLER_ANALYTICS",CLV_ACCESS:"CLV_ACCESS",MAX_OAUTH_APPS:"MAX_OAUTH_APPS",MAX_OAUTH_BOTS:"MAX_OAUTH_BOTS",CREATE_TENANT:"CREATE_TENANT",MAX_INCOMING_WEBHOOKS:"MAX_INCOMING_WEBHOOKS",HD_VIDEO:"HD_VIDEO",HD_SCREENSHARE:"HD_SCREENSHARE",MAX_PRESENCE_SUBSCRIPTIONS:"MAX_PRESENCE_SUBSCRIPTIONS",SPACES:"SPACES",SPACE_CREATION:"SPACE_CREATION",SPACE_MASTER:"SPACE_MASTER",UCAAS_EA:"UCAAS_EA",IC_ONLY_USER:"IC_ONLY_USER",IC_MIXED_USER:"IC_MIXED_USER",ANALYTICS:"ANALYTICS",VIEW_OPEN_CONVERSATION:"VIEW_OPEN_CONVERSATION",SSO:"SSO",IE_PLUGIN_SUPPORT_LIMITATION:"IE_PLUGIN_SUPPORT_LIMITATION",ROLE_MEETING_POINT:"ROLE_MEETING_POINT",EVENT_ORGANIZER_BASIC:"EVENT_ORGANIZER_BASIC",TEAM:"TEAM",ORGANIZE_EVENTS:"ORGANIZE_EVENTS",EVENT_ORGANIZER_XS:"EVENT_ORGANIZER_XS",EVENT_ORGANIZER_S:"EVENT_ORGANIZER_S",EVENT_ORGANIZER_M:"EVENT_ORGANIZER_M",EVENT_ORGANIZER_L:"EVENT_ORGANIZER_L",REST_ADMIN_API:"REST_ADMIN_API",VOICEMAIL:"VOICEMAIL",TRANSCRIPTION:"TRANSCRIPTION"},PermissionType:{TENANT_QUOTA:"TENANT_QUOTA",USER_QUOTA:"USER_QUOTA",FEATURE:"FEATURE",OVERALL_PACKAGE_QUOTA:"OVERALL_PACKAGE_QUOTA",OVERALL_PACKAGE_FEATURE:"OVERALL_PACKAGE_FEATURE",RESTRICTION:"RESTRICTION"},MigrateMultipleStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},MigrateResponseCode:{NULL_PARAMETER:"NULL_PARAMETER",ACCOUNT_DOES_NOT_EXIST:"ACCOUNT_DOES_NOT_EXIST",TECHNICAL_ACCOUNT_NOT_ALLOWED:"TECHNICAL_ACCOUNT_NOT_ALLOWED",ACCOUNT_TEMPLATE_DOES_NOT_EXIST:"ACCOUNT_TEMPLATE_DOES_NOT_EXIST",ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT:"ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT",MAXIMUM_ACCOUNTS_REACHED:"MAXIMUM_ACCOUNTS_REACHED",ERROR:"ERROR",OK:"OK",OK_NO_CHANGES:"OK_NO_CHANGES"},ActivityStreamActionType:{CREATE_MENTION:"CREATE_MENTION",GET_MENTIONS_BY_USER:"GET_MENTIONS_BY_USER",GET_ACTIVITIES_BY_USER:"GET_ACTIVITIES_BY_USER",UPDATE_ACTIVITY_READ:"UPDATE_ACTIVITY_READ",MARK_ALL_READ:"MARK_ALL_READ"},ActivityStreamEventType:{ACTIVITY_CREATED:"ACTIVITY_CREATED",ACTIVITY_MARKED_READ:"ACTIVITY_MARKED_READ",ACTIVITY_MARKED_UNREAD:"ACTIVITY_MARKED_UNREAD",ACTIVITY_DELETED:"ACTIVITY_DELETED",ACTIVITY_MARK_ALL_READ:"ACTIVITY_MARK_ALL_READ"},ActivityStreamItemType:{NAVIGABLE:"NAVIGABLE",SYSTEM:"SYSTEM"},NavigableStreamItemType:{MENTION:"MENTION",SPACES_MENTION:"SPACES_MENTION",SPACES_ADD:"SPACES_ADD",SPACES_REQUEST_ACCEPT:"SPACES_REQUEST_ACCEPT",SPACES_REQUEST_TO_JOIN:"SPACES_REQUEST_TO_JOIN",SPACES_USER_MASS_IMPORT:"SPACES_USER_MASS_IMPORT",SPACES_TAG_ADD:"SPACES_TAG_ADD",SPACES_TAG_REMOVE:"SPACES_TAG_REMOVE",TEAM_USER_INVITED_TO_JOIN:"TEAM_USER_INVITED_TO_JOIN",TEAM_USER_INVITATION_DECLINED:"TEAM_USER_INVITATION_DECLINED",TEAM_USER_INVITATION_ACCEPTED:"TEAM_USER_INVITATION_ACCEPTED",TEAM_USER_DELETED_FROM_TEAM:"TEAM_USER_DELETED_FROM_TEAM",TEAM_I_BELONG_TO_HAS_BEEN_DELETED:"TEAM_I_BELONG_TO_HAS_BEEN_DELETED",TEAM_USER_LEFT_TEAM:"TEAM_USER_LEFT_TEAM"},SystemStreamItemType:{REMOVED_FROM:"REMOVED_FROM",SPACES_REMOVE:"SPACES_REMOVE",SPACES_REQUEST_DECLINE:"SPACES_REQUEST_DECLINE"},ConversationUserDataEventType:{LABELS_ADDED:"LABELS_ADDED",LABELS_REMOVED:"LABELS_REMOVED",LABEL_EDITED:"LABEL_EDITED",FILTERS_REMOVED:"FILTERS_REMOVED",FILTER_ADDED:"FILTER_ADDED",FILTER_EDITED:"FILTER_EDITED"},SpaceActionType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",CLEAR_NCA:"CLEAR_NCA",GET_NCA_DATA:"GET_NCA_DATA",EXISTS_SPACE_NAME:"EXISTS_SPACE_NAME",SET_GLOBAL_CONFIGURATION:"SET_GLOBAL_CONFIGURATION",GET_GLOBAL_CONFIGURATION:"GET_GLOBAL_CONFIGURATION",SET_FAVORITE_SPACE:"SET_FAVORITE_SPACE",REMOVE_FAVORITE_SPACE_MARKER:"REMOVE_FAVORITE_SPACE_MARKER",GET_FAVORITE_SPACES:"GET_FAVORITE_SPACES",GET_SPACES:"GET_SPACES",GET_SPACES_BY_IDS:"GET_SPACES_BY_IDS",SEARCH_TAGS:"SEARCH_TAGS",GET_DIRECTORY:"GET_DIRECTORY",GET_ADMIN_DIRECTORY:"GET_ADMIN_DIRECTORY",SELECT_SPACE:"SELECT_SPACE",GET_PARTICIPANTS_IMPORT_DATA:"GET_PARTICIPANTS_IMPORT_DATA",GET_SPACE_PREVIEW_DATA:"GET_SPACE_PREVIEW_DATA",ADD_PARTICIPANTS:"ADD_PARTICIPANTS",ADD_PARTICIPANTS_SEARCH:"ADD_PARTICIPANTS_SEARCH",UPDATE_PARTICIPANT:"UPDATE_PARTICIPANT",REMOVE_PARTICIPANTS:"REMOVE_PARTICIPANTS",IMPORT_PARTICIPANTS:"IMPORT_PARTICIPANTS",GET_PARTICIPANTS:"GET_PARTICIPANTS",GET_PENDING_PARTICIPANTS:"GET_PENDING_PARTICIPANTS",SEARCH_SPACE_PARTICIPANTS:"SEARCH_SPACE_PARTICIPANTS",JOIN:"JOIN",LEAVE:"LEAVE",REQUEST_ACCESS:"REQUEST_ACCESS",GRANT_ACCESS:"GRANT_ACCESS",DENY_ACCESS:"DENY_ACCESS",IS_EXTERNAL_PARTICIPANT_IN_SPACE:"IS_EXTERNAL_PARTICIPANT_IN_SPACE",UPDATE_READ_TIMESTAMP:"UPDATE_READ_TIMESTAMP",ASSIGN_LABELS:"ASSIGN_LABELS",UNASSIGN_LABELS:"UNASSIGN_LABELS",GET_TOPICS:"GET_TOPICS",GET_TOPIC_WITH_REPLIES:"GET_TOPIC_WITH_REPLIES",GET_POLL_WITH_REPLIES:"GET_POLL_WITH_REPLIES",GET_OPEN_POLLS:"GET_OPEN_POLLS",GET_REPLIES:"GET_REPLIES",GET_MATCHING_REPLIES:"GET_MATCHING_REPLIES",GET_ITEMS_BY_IDS:"GET_ITEMS_BY_IDS",CREATE_TOPIC:"CREATE_TOPIC",CREATE_POLL:"CREATE_POLL",VOTE_POLL_OPTIONS:"VOTE_POLL_OPTIONS",GET_POLL_OPTION_VOTERS:"GET_POLL_OPTION_VOTERS",CREATE_REPLY:"CREATE_REPLY",UPDATE_TOPIC:"UPDATE_TOPIC",UPDATE_POLL:"UPDATE_POLL",UPDATE_REPLY:"UPDATE_REPLY",DELETE_ITEM:"DELETE_ITEM",GET_LIKES:"GET_LIKES",LIKE:"LIKE",UNLIKE:"UNLIKE",FLAG:"FLAG",UNFLAG:"UNFLAG",GET_FLAGGED_ITEMS_COUNT:"GET_FLAGGED_ITEMS_COUNT",GET_FLAGGED_ITEMS:"GET_FLAGGED_ITEMS",GET_SPACE_ITEMS_BY_IDS_WITH_TOPIC_AND_SPACE_ID:"GET_SPACE_ITEMS_BY_IDS_WITH_TOPIC_AND_SPACE_ID",PIN_TOPIC:"PIN_TOPIC",UNPIN_TOPIC:"UNPIN_TOPIC",GET_PINNED_TOPICS:"GET_PINNED_TOPICS",SET_WELCOME_BOX:"SET_WELCOME_BOX",GET_WELCOME_BOX:"GET_WELCOME_BOX",DELETE_WELCOME_BOX:"DELETE_WELCOME_BOX",GET_SPACE_FILES:"GET_SPACE_FILES",UPDATE_TOPIC_TAGS:"UPDATE_TOPIC_TAGS",CLOSE_POLL:"CLOSE_POLL",START_BASIC_SEARCH:"START_BASIC_SEARCH",START_DETAILED_SEARCH:"START_DETAILED_SEARCH",CANCEL_SEARCH:"CANCEL_SEARCH",GET_RECENT_SEARCHES:"GET_RECENT_SEARCHES",ADD_RECENT_SEARCH:"ADD_RECENT_SEARCH"},SpaceEventType:{IMPORT_PARTICIPANTS:"IMPORT_PARTICIPANTS",NCA:"NCA",SPACE_UPDATED:"SPACE_UPDATED",SPACE_DELETED:"SPACE_DELETED",ITEM_CREATED:"ITEM_CREATED",ITEM_UPDATED:"ITEM_UPDATED",ITEM_DELETED:"ITEM_DELETED",FLAGGED:"FLAGGED",UNFLAGGED:"UNFLAGGED",LIKED:"LIKED",UNLIKED:"UNLIKED",BASIC_SEARCH_RESULT:"BASIC_SEARCH_RESULT",DETAILED_SEARCH_RESULT:"DETAILED_SEARCH_RESULT",RECENT_SEARCH_ADDED:"RECENT_SEARCH_ADDED",SEARCH_STATUS:"SEARCH_STATUS",PARTICIPANT_UPDATED:"PARTICIPANT_UPDATED"},SpaceParticipantRole:{MODERATOR:"MODERATOR",AUTHOR:"AUTHOR",PARTICIPANT:"PARTICIPANT",READER:"READER"},SpaceParticipantDefaultRole:{AUTHOR:"AUTHOR",PARTICIPANT:"PARTICIPANT",READER:"READER"},SpaceParticipantState:{ACTIVE:"ACTIVE",PENDING:"PENDING"},SpaceParticipantAccessType:{INTERNAL:"INTERNAL",EXTERNAL:"EXTERNAL"},SpaceType:{OPEN:"OPEN",CLOSED:"CLOSED",SECRET:"SECRET"},SpaceAccessModeType:{INTERNAL_ONLY:"INTERNAL_ONLY",INTERNAL_EXTERNAL:"INTERNAL_EXTERNAL"},SpaceStatus:{ENABLED:"ENABLED",DISABLED:"DISABLED"},SpaceItemStatus:{CREATED:"CREATED",EDITED:"EDITED",DELETED:"DELETED"},SpacePollStatus:{OPEN:"OPEN",CLOSED:"CLOSED"},SpaceItemType:{TOPIC:"TOPIC",REPLY:"REPLY",WELCOME_BOX:"WELCOME_BOX",POLL:"POLL",QUESTION:"QUESTION"},SpacesAdminDirectorySortBy:{LAST_CONTENT:"LAST_CONTENT",SPACE_NAME:"SPACE_NAME",NUMBER_OF_USERS:"NUMBER_OF_USERS",CREATION_DATE:"CREATION_DATE"},SpaceOwnerType:{OWNED:"OWNED",NOT_OWNED:"NOT_OWNED"},SpacesAdminDirectoryFilterCriteria:{OWNER:"OWNER",ACCESS_MODE_TYPE:"ACCESS_MODE_TYPE",SPACE_TYPE:"SPACE_TYPE",SPACE_STATUS:"SPACE_STATUS"},SpacesDirectorySortBy:{LAST_CONTENT:"LAST_CONTENT",NAME:"NAME",NUMBER_OF_USERS:"NUMBER_OF_USERS"},SpacesDirectoryFilter:{JOINED:"JOINED",REQUESTED:"REQUESTED",OPEN:"OPEN",CLOSED:"CLOSED",NOT_JOINED_REQUESTED:"NOT_JOINED_REQUESTED"},SpaceFilterCriterion:{ALL:"ALL",MY_MODERATED:"MY_MODERATED"},SpaceFilesSortBy:{FILE_NAME:"FILE_NAME",CREATION_TIME:"CREATION_TIME",FILE_SIZE:"FILE_SIZE",MIME_TYPE:"MIME_TYPE",FILE_EXTENSION:"FILE_EXTENSION"},SpaceAddParticipantsResult:{PARTICIPANT_ADDED:"PARTICIPANT_ADDED",ALREADY_MEMBER:"ALREADY_MEMBER",USER_DOES_NOT_EXIST:"USER_DOES_NOT_EXIST",INTERNAL_ONLY:"INTERNAL_ONLY",BLOCKED:"BLOCKED",ERROR:"ERROR"},SpaceSearchScope:{ALL:"ALL",SPACES:"SPACES",TOPICBY:"TOPICBY",FILES:"FILES",TAGS:"TAGS",LABEL:"LABEL",DATE:"DATE"},SpacesParticipantsFilter:{ALL:"ALL",MODERATOR:"MODERATOR",READER:"READER",AUTHOR:"AUTHOR",PARTICIPANT:"PARTICIPANT",INTERNAL:"INTERNAL",EXTERNAL:"EXTERNAL"},SpaceParticipantsFilterCriteria:{ACCESS_TYPE:"ACCESS_TYPE",ROLE:"ROLE",STATE:"STATE"},SpaceParticipantsSortBy:{DISPLAY_NAME:"DISPLAY_NAME",NAME:"NAME",FIRST_NAME:"FIRST_NAME"},SpacePermissionAddParticipant:{MODERATORS_ONLY:"MODERATORS_ONLY",INTERNAL_MEMBERS:"INTERNAL_MEMBERS"},SpaceMassImportStatus:{NO_IMPORT:"NO_IMPORT",IMPORT_SCHEDULED:"IMPORT_SCHEDULED",IMPORT_RUNNING:"IMPORT_RUNNING",IMPORT_FINISHED_SUCCESS:"IMPORT_FINISHED_SUCCESS",IMPORT_INVALID_FILE_FORMAT:"IMPORT_INVALID_FILE_FORMAT",IMPORT_FINISHED_FAILURE_SYSTEM_RESTART:"IMPORT_FINISHED_FAILURE_SYSTEM_RESTART",IMPORT_FINISHED_FAILURE:"IMPORT_FINISHED_FAILURE"},SpaceMassImportErrors:{IMPORT_ILLEGAL_ARGUMENTS:"SPACE-00048C",IMPORT_FILE_DOES_NOT_EXIST:"SPACE-00049C",IMPORT_FILEHUB_DOWNLOAD_ERROR:"SPACE-00050C",IMPORT_UNZIP_ERROR:"SPACE-00051C",IMPORT_INVALID_CONTENT:"SPACE-00052C",IMPORT_INVALID_DATA:"SPACE-00053C",IMPORT_INTERNAL_ERROR:"SPACE-00054C",IMPORT_RUNNING:"SPACE-00055C"},CPaaSActionType:{SUBMIT_FORM_DATA:"SUBMIT_FORM_DATA",GET_OAUTH_APPLICATIONS:"GET_OAUTH_APPLICATIONS",CREATE_OAUTH_APPLICATION:"CREATE_OAUTH_APPLICATION",GET_OAUTH_APPLICATION:"GET_OAUTH_APPLICATION",DELETE_OAUTH_APPLICATION:"DELETE_OAUTH_APPLICATION",SUSPEND_OAUTH_APPLICATION:"SUSPEND_OAUTH_APPLICATION",UNSUSPEND_OAUTH_APPLICATION:"UNSUSPEND_OAUTH_APPLICATION",UPDATE_OAUTH_APPLICATION:"UPDATE_OAUTH_APPLICATION",RECREATE_CLIENT_SECRET:"RECREATE_CLIENT_SECRET",DELETE_USER_FROM_OAUTH_APPLICATION:"DELETE_USER_FROM_OAUTH_APPLICATION",ADD_USER_TO_OAUTH_APPLICATION:"ADD_USER_TO_OAUTH_APPLICATION",GET_TENANT_BOTS:"GET_TENANT_BOTS",CREATE_INCOMING_WEBHOOK:"CREATE_INCOMING_WEBHOOK",GET_INCOMING_WEBHOOK:"GET_INCOMING_WEBHOOK",GET_INCOMING_WEBHOOKS:"GET_INCOMING_WEBHOOKS",UPDATE_INCOMING_WEBHOOK:"UPDATE_INCOMING_WEBHOOK",DELETE_INCOMING_WEBHOOK:"DELETE_INCOMING_WEBHOOK",SUSPEND_INCOMING_WEBHOOK:"SUSPEND_INCOMING_WEBHOOK",UNSUSPEND_INCOMING_WEBHOOK:"UNSUSPEND_INCOMING_WEBHOOK",GET_OAUTHSCOPE_LIST:"GET_OAUTHSCOPE_LIST",GET_TENANT_INTEGRATIONS:"GET_TENANT_INTEGRATIONS",ENABLE_TENANT_INTEGRATION:"ENABLE_TENANT_INTEGRATION",DISABLE_TENANT_INTEGRATION:"DISABLE_TENANT_INTEGRATION",GET_CONVERSATION_INTEGRATIONS:"GET_CONVERSATION_INTEGRATIONS",ENABLE_CONVERSATION_INTEGRATION:"ENABLE_CONVERSATION_INTEGRATION",UPDATE_CONVERSATION_INTEGRATION:"UPDATE_CONVERSATION_INTEGRATION",DISABLE_CONVERSATION_INTEGRATION:"DISABLE_CONVERSATION_INTEGRATION",GET_INTEGRATION_DATA:"GET_INTEGRATION_DATA"},CPaaSEventType:{SUBMIT_FORM_DATA:"SUBMIT_FORM_DATA",INTEGRATION_STATE_CHANGED:"INTEGRATION_STATE_CHANGED"},CPaaSFormMetaDataControlType:{LABEL:"LABEL",BUTTON:"BUTTON",RADIO:"RADIO",CHECKBOX:"CHECKBOX",DROPDOWN:"DROPDOWN",INPUT:"INPUT",SPACER:"SPACER"},CPasSIntegrationStateChangedReason:{ENABLED:"ENABLED",DISABLED:"DISABLED",STARTUP:"STARTUP",SHUTDOWN:"SHUTDOWN",ENABLE_FAILED:"ENABLE_FAILED",DISABLE_FAILED:"DISABLE_FAILED"},CPasSIncomingWebhookFilter:{TENANT:"TENANT",USER:"USER",CONVERSATION:"CONVERSATION"},TenantIntegrationState:{ACTIVE:"ACTIVE",DISABLED:"DISABLED",SHUTDOWN:"SHUTDOWN",STARTUP:"STARTUP"},IntegrationKeys:{MEISTERTASK:"MEISTERTASK",INCOMING_WEBHOOKS:"INCOMING-WEBHOOKS"},MeistertaskIntegrationType:{GET_USER_PROJECTS:"GET_USER_PROJECTS"},TeamActionType:{CREATE_TEAM:"CREATE_TEAM",UPDATE_TEAM:"UPDATE_TEAM",DELETE_TEAM:"DELETE_TEAM",GET_TEAMS:"GET_TEAMS",GET_TEAMS_BY_IDS:"GET_TEAMS_BY_IDS",INVITE_MEMBER:"INVITE_MEMBER",REMOVE_MEMBER:"REMOVE_MEMBER",ACCEPT_INVITATION:"ACCEPT_INVITATION",DECLINE_INVITATION:"DECLINE_INVITATION",LEAVE_TEAM:"LEAVE_TEAM",CHANGE_MEMBER_ROLE:"CHANGE_MEMBER_ROLE"},TeamEventType:{NOTIFY:"NOTIFY",NOTIFY_CANCEL:"NOTIFY_CANCEL",TEAM_CREATED:"TEAM_CREATED",TEAM_UPDATED:"TEAM_UPDATED",TEAM_DELETED:"TEAM_DELETED",TEAM_MEMBERSHIP_CHANGED:"TEAM_MEMBERSHIP_CHANGED"},MemberResultCode:{SUCCESS:"SUCCESS",ERROR:"ERROR",USER_ID_DOES_NOT_EXIST:"USER_ID_DOES_NOT_EXIST",USER_IS_SUSPENDED:"USER_IS_SUSPENDED",USER_IS_ALREADY_A_MEMBER:"USER_IS_ALREADY_A_MEMBER",TEAMS_PER_USER_LIMIT_REACHED:"TEAMS_PER_USER_LIMIT_REACHED",USER_IS_NOT_A_MEMBER:"USER_IS_NOT_A_MEMBER"},MemberStatus:{INVITED:"INVITED",ACCEPTED:"ACCEPTED",DECLINED:"DECLINED",PENDING:"PENDING",FAILED:"FAILED"},MemberRole:{MEMBER:"MEMBER",OWNER:"OWNER"},LabFeatureName:{ACTIVE_WHITEBOARD:"ACTIVE_WHITEBOARD",ADD_CMR_NEW_FLOW:"ADD_CMR_NEW_FLOW",ADD_CMR_VIA_QR_CODE:"ADD_CMR_VIA_QR_CODE",ANDROID_STRICT_MODE:"ANDROID_STRICT_MODE",ANR_WATCHDOG:"ANR_WATCHDOG",ANSWER_CALL_SCREEN:"ANSWER_CALL_SCREEN",AUTHENTICATION_SETTINGS:"AUTHENTICATION_SETTINGS",CMR_CONTROL_PANEL:"CMR_CONTROL_PANEL",CONFERENCE_POLL:"CONFERENCE_POLL",DARK_MODE:"DARK_MODE",DISABLE_CALL_KIT:"DISABLE_CALL_KIT",ENHANCED_AUTOMATED_ATTENDANT:"ENHANCED_AUTOMATED_ATTENDANT",FAVORITE_A_SPACE:"FAVORITE_A_SPACE",FLOATING_ONGOING_CALL_CONTROL:"FLOATING_ONGOING_CALL_CONTROL",GOOGLE_CALENDAR:"GOOGLE_CALENDAR",GUEST_ON_BOARDING:"GUEST_ON_BOARDING",HASHTAGS:"HASHTAGS",IN_MEETING_STATUS:"IN_MEETING_STATUS",JABRA_NODE_MODULE_SDK:"JABRA_NODE_MODULE_SDK",LANDSCAPE_MODE:"LANDSCAPE_MODE",LEAK_CANARY:"LEAK_CANARY",LOCK_SCREEN_CALL_CONTROL:"LOCK_SCREEN_CALL_CONTROL",MEISTER_TASK_INTEGRATION:"MEISTER_TASK_INTEGRATION",MICROSOFT_TEAMS:"MICROSOFT_TEAMS",MOBILE_CSS:"MOBILE_CSS",NEW_LOGIN_VIEW:"NEW_LOGIN_VIEW",OPEN_XCHANGE:"OPEN_XCHANGE",ORGANISE_CONTENT:"ORGANISE_CONTENT",OSBIZ_EXTENDED_TELEPHONY:"OSBIZ_EXTENDED_TELEPHONY",OUTLOOK_365:"OUTLOOK_365",PHONE_ONLY_AND_SHARED_DEVICES:"PHONE_ONLY_AND_SHARED_DEVICES",SCOPE_SEARCHES:"SCOPE_SEARCHES",SECOND_LOCAL_CALL:"SECOND_LOCAL_CALL",SHAREPOINT:"SHAREPOINT",SIMULCAST:"SIMULCAST",SPACES:"SPACES",SPACES_CODE_FORMAT:"SPACES_CODE_FORMAT",SPACES_FILTER_AND_LABELS:"SPACES_FILTER_AND_LABELS",SPACES_HASHTAGS:"SPACES_HASHTAGS",SPACES_PAGES:"SPACES_PAGES",SPACES_POLLING:"SPACES_POLLING",SPACES_QUESTIONS:"SPACES_QUESTIONS",STARTED_MEETING_SUMMARY:"STARTED_MEETING_SUMMARY",TEAMS:"TEAMS",TENANT_ADMIN_USER_TABLE_ENHANCEMENT:"TENANT_ADMIN_USER_TABLE_ENHANCEMENT",TRANSCRIPTION_AND_TRANSLATION:"TRANSCRIPTION_AND_TRANSLATION",UCAAS_PHONES_LDAP_SETTINGS:"UCAAS_PHONES_LDAP_SETTINGS",UCAAS_SHARED_TRUNKS:"UCAAS_SHARED_TRUNKS",UNIFIED_CONVERSATION_CREATION:"UNIFIED_CONVERSATION_CREATION",WEBRTC_DEBUG_LOGGING:"WEBRTC_DEBUG_LOGGING",WEBRTC_ICE_OPTIMIZATION:"WEBRTC_ICE_OPTIMIZATION"},MeetingRoomFeatureName:{DISPLAY_MULTIPLE_VIDEO_STREAMS:"DISPLAY_MULTIPLE_VIDEO_STREAMS",CONFERENCE_POLL:"CONFERENCE_POLL"},DraftType:{DIRECT:"DIRECT",GROUP:"GROUP",OPEN:"OPEN",LARGE:"LARGE",PRIVATE:"PRIVATE",BRIDGE:"BRIDGE",EXPERT:"EXPERT"},AvatarBadgeType:{COMMUNITY:"COMMUNITY",EVENT:"EVENT",EXPERT:"EXPERT",SKYPE:"SKYPE"},AudioVideoDeviceCategories:{AUDIO_OUTPUT:"AUDIO_OUTPUT",RINGING_OUTPUT:"RINGING_OUTPUT",AUDIO_INPUT:"AUDIO_INPUT",AUDIO_DEVICE:"AUDIO_DEVICE",VIDEO_INPUT:"VIDEO_INPUT"},RecordingState:{IDLE:"IDLE",LISTENING:"LISTENING",PROCESSING:"PROCESSING"},TranscriptionError:{RECORDING_NOT_SUPPORTED:"RECORDING_NOT_SUPPORTED",RECORDING_NOT_STARTED:"RECORDING_NOT_STARTED",RECORDING_IN_PROGRESS:"RECORDING_IN_PROGRESS",RECORDING_ABORTED:"RECORDING_ABORTED",INVALID_CALL:"INVALID_CALL",INVALID_PROVIDER:"INVALID_PROVIDER"},AtcCapabilities:{EXTENDED_ALERTING:"EXTENDED_ALERTING",CLEAR_CONNECTION_BUSY:"CLEAR_CONNECTION_BUSY",PBX_CALL_LOG:"PBX_CALL_LOG"},StcCapabilities:{STC_TRANSFER:"STC_TRANSFER",STC_MERGE:"STC_MERGE"},TcAvailableFeatures:{HOLD:"HOLD",CONSULTATION:"CONSULTATION",MERGE:"MERGE",TRANSFER:"TRANSFER"}}),e=(o=/^\|\|::\$\$privateData=({.*})::\|\|/,{SUPPORTED_PRIVATE_DATA_FIELDS:r=["conceptboards","rtcInstanceId"],convertPrivateDataToContent:function(t,n){if(!t)return"";n=n||[];var i={};if(r.forEach(function(e){void 0===t[e]||null===t[e]||n.includes(e)||(i[e]=t[e])}),s.isEmptyObject(i))return"";var e=JSON.stringify(i);return e=s.textToHtmlEscaped(e),"||::$$privateData=%%1::||".replace("%%1",e)},retrievePrivateDataFromContent:function(t){if(t&&t.text)try{if(r.forEach(function(e){void 0===t[e]&&(t[e]=null)}),!t.text.content)return;var e=o.exec(t.text.content);if(e&&e[0]){t.text.content=t.text.content.slice(e[0].length);var n=e[1];if(n){n=s.escapedHtmlToText(n);var i=JSON.parse(n);r.forEach(function(e){void 0!==i[e]&&(t[e]=i[e])})}}}catch(e){a.error("[Proto]: Failed to retrieve private data. ",e)}}}),l={requestNr:0,normalizeWhiteboard:function(e){t.isSDK&&e&&("boolean"==typeof e.backround?e.background=e.backround:"boolean"==typeof e.background?e.backround=e.background:(e.background=!1,e.backround=!1))},Request:function(e,t,n){l.requestNr++;var i={msgType:c.WSMessageType.REQUEST,request:{requestId:l.requestNr,type:e}};switch(n&&(i.request.tenantContext=n),e){case c.ContentType.CONVERSATION:i.request.conversation=t;break;case c.ContentType.USER:i.request.user=t;break;case c.ContentType.RTC_CALL:i.request.rtcCall=t;break;case c.ContentType.RTC_SESSION:i.request.rtcSession=t;break;case c.ContentType.SEARCH:i.request.search=t;break;case c.ContentType.INSTRUMENTATION:i.request.instrumentation=t;break;case c.ContentType.ADMINISTRATION:i.request.administration=t;break;case c.ContentType.SYSTEM:i.request.system=t;break;case c.ContentType.THIRDPARTYCONNECTORS:i.request.thirdpartyconnectors=t;break;case c.ContentType.GUEST:i.request.guest=t;break;case c.ContentType.USER_TO_USER:i.request.userToUser=t;break;case c.ContentType.VERSION:i.request.version=t;break;case c.ContentType.ACCOUNT:i.request.account=t;break;case c.ContentType.ACTIVITYSTREAM:i.request.activityStream=t;break;case c.ContentType.SPACE:i.request.space=t;break;case c.ContentType.CPAAS:i.request.cpaas=t;break;case c.ContentType.USER_DATA:i.request.userData=t;break;case c.ContentType.TEAM:i.request.team=t}return i},ParseEvent:function(e,t){var n,i={};switch(e.type){case c.ContentType.CONVERSATION:switch(n="Conversation."+e.conversation.type,e.conversation.type){case c.ConversationEventType.CREATE:i=e.conversation.create;break;case c.ConversationEventType.UPDATE:i=e.conversation.update;break;case c.ConversationEventType.ADD_ITEM:i=e.conversation.addItem;break;case c.ConversationEventType.ADD_PARTICIPANT:i=e.conversation.addParticipant;break;case c.ConversationEventType.UPDATE_ITEM:i=e.conversation.updateItem;break;case c.ConversationEventType.READ_ITEMS:i=e.conversation.readItems;break;case c.ConversationEventType.TYPING:i=e.conversation.typing;break;case c.ConversationEventType.DRAFT_MESSAGE_SAVED:case c.ConversationEventType.DRAFT_MESSAGE_DISCARDED:case c.ConversationEventType.DRAFT_MESSAGE_PUBLISHED:i=e.conversation.draftMessage;break;case c.ConversationEventType.FLAG_ITEM:i=e.conversation.setFlagItem;break;case c.ConversationEventType.CLEAR_FLAGGED_ITEM:i=e.conversation.clearFlaggedItem;break;case c.ConversationEventType.CONVERSATION_MARKED:i=e.conversation.conversationMarked;break;case c.ConversationEventType.CONVERSATION_UNMARKED:i=e.conversation.conversationUnmarked;break;case c.ConversationEventType.FAVORITE_POSITION_CHANGED:i=e.conversation.favoritePositionChangedEvent;break;case c.ConversationEventType.USER_DATA_CHANGED:i=e.conversation.userDataChangedEvent;break;case c.ConversationEventType.JOURNAL_ENTRY_DELETED:i=e.conversation.journalEntryDeletedEvent;break;case c.ConversationEventType.ALL_JOURNAL_ENTRIES_DELETED:i=e.conversation.allJournalEntriesDeleted}i.convId=e.conversation.convId;break;case c.ContentType.USER:switch(n="User."+e.user.type,e.user.type){case c.UserEventType.USER_PRESENCE_CHANGE:i=e.user.presenceChanged;break;case c.UserEventType.USER_UPDATED:i=e.user.userUpdated;break;case c.UserEventType.SESSION_CLOSED:i=e.user.sessionClosed;break;case c.UserEventType.PASSWORD_CHANGED:i=e.user.passwordChanged;break;case c.UserEventType.USER_SETTING_UPDATED:i=e.user.userSettingUpdated;break;case c.UserEventType.TELEPHONY_DATA:i=e.user.telephonyData;break;case c.UserEventType.DEVICE_LIST_CHANGED:i=e.user.deviceListChangedEvent;break;case c.UserEventType.NOTIFICATION_SUBSCRIPTION_CHANGE:i=e.user.notificationSubscriptionChange;break;case c.UserEventType.TENANT_CONFIGURATION_UPDATED:i=e.user.tenantConfigurationUpdatedEvent;break;case c.UserEventType.TENANT_PRESENCE_CHANGE:i=e.user.tenantPresenceChanged;break;case c.UserEventType.CMR_SETTINGS_UPDATED:i=e.user.cmrSettingsUpdatedEvent;break;case c.UserEventType.CMR_COMMAND:i=e.user.cmrCommandEvent;break;case c.UserEventType.TELEPHONY_CHANGED:i=e.user.telephonyChangedEvent;break;case c.UserEventType.TELEPHONY_PROVIDER_UPDATED:i=e.user.telephonyProviderEvent;break;case c.UserEventType.EAGROUP_STATUS_CHANGED:i=e.user.executiveAssistantGroupEvent}i.userId=e.user.userId;break;case c.ContentType.RTC_CALL:switch(n="RTCCall."+e.rtcCall.type,e.rtcCall.type){case c.RTCCallEventType.SDP_ANSWER:i=e.rtcCall.sdpAnswer;break;case c.RTCCallEventType.SDP_FAILED:i=e.rtcCall.sdpFailed;break;case c.RTCCallEventType.INVITE:i=e.rtcCall.invite;break;case c.RTCCallEventType.INVITE_CANCEL:i=e.rtcCall.inviteCancel;break;case c.RTCCallEventType.INVITE_FAILED:i=e.rtcCall.inviteFailed;break;case c.RTCCallEventType.CHANGE_MEDIA_TYPE_REQUESTED:i=e.rtcCall.changeMediaRequested;break;case c.RTCCallEventType.PROGRESS:i=e.rtcCall.participantProgress;break;case c.RTCCallEventType.CHANGE_MEDIA_TYPE_FORCED:i=e.rtcCall.changeMediaTypeForcedEvent;break;case c.RTCCallEventType.ICE_CANDIDATES:i=e.rtcCall.iceCandidates;break;case c.RTCCallEventType.RTC_QUALITY_RATING_EVENT:i=e.rtcCall.ratingEvent;break;case c.RTCCallEventType.IFRAME_STATISTICS:i=e.rtcCall.iFrameStatisticsEvent}i.sessionId=e.rtcCall.sessionId,i.instanceId=e.rtcCall.instanceId;break;case c.ContentType.RTC_SESSION:switch(n="RTCSession."+e.rtcSession.type,e.rtcSession.type){case c.RTCSessionEventType.SESSION_STARTED:i=e.rtcSession.sessionStarted;break;case c.RTCSessionEventType.SESSION_TERMINATED:i=e.rtcSession.sessionTerminated;break;case c.RTCSessionEventType.SESSION_UPDATED:i=e.rtcSession.sessionUpdated;break;case c.RTCSessionEventType.SESSION_MOVED:i=e.rtcSession.sessionMoved;break;case c.RTCSessionEventType.PARTICIPANT_JOINED:i=e.rtcSession.participantJoined;break;case c.RTCSessionEventType.PARTICIPANT_LEFT:i=e.rtcSession.participantLeft;break;case c.RTCSessionEventType.PARTICIPANT_UPDATED:i=e.rtcSession.participantUpdated;break;case c.RTCSessionEventType.ACTIVE_SPEAKER:i=e.rtcSession.speaker;break;case c.RTCSessionEventType.VIDEO_ACTIVE_SPEAKER:i=e.rtcSession.videoSpeaker;break;case c.RTCSessionEventType.SESSION_RECORDING_INFO:i=e.rtcSession.sessionRecordingInfo;break;case c.RTCSessionEventType.SESSION_RECORDING_STARTED:i=e.rtcSession.sessionRecordingStarted;break;case c.RTCSessionEventType.SESSION_RECORDING_STOPPED:i=e.rtcSession.sessionRecordingStopped;break;case c.RTCSessionEventType.SESSION_RECORDING_FAILED:i=e.rtcSession.sessionRecordingFailed;break;case c.RTCSessionEventType.SESSION_TERMINATION_TIMER_STARTED:i=e.rtcSession.sessionTerminationTimerStarted;break;case c.RTCSessionEventType.SESSION_TERMINATION_TIMER_CANCELLED:i=e.rtcSession.sessionTerminationTimerCancelled;break;case c.RTCSessionEventType.SESSION_ATTRIBUTES_CHANGED_EVENT:i=e.rtcSession.sessionAttributesChangedEvent;break;case c.RTCSessionEventType.QUESTION_EVENT:i=e.rtcSession.questionEvent;break;case c.RTCSessionEventType.INVITE_TO_STAGE_EVENT:i=e.rtcSession.inviteToStageEvent;break;case c.RTCSessionEventType.INVITE_TO_STAGE_CANCEL_EVENT:i=e.rtcSession.inviteToStageCancelEvent;break;case c.RTCSessionEventType.CURTAIN_EVENT:i=e.rtcSession.curtainEvent;break;case c.RTCSessionEventType.WHITEBOARD_ENABLED:i=e.rtcSession.whiteboardEnabled,l.normalizeWhiteboard(i.whiteboard,t);break;case c.RTCSessionEventType.WHITEBOARD_ELEMENT_ADDED:i=e.rtcSession.whiteboardElementAdded;break;case c.RTCSessionEventType.WHITEBOARD_ELEMENT_REMOVED:i=e.rtcSession.whiteboardElementRemoved;break;case c.RTCSessionEventType.WHITEBOARD_ELEMENT_UPDATED:i=e.rtcSession.whiteboardElementUpdated;break;case c.RTCSessionEventType.WHITEBOARD_CLEARED:i=e.rtcSession.whiteboardCleared;break;case c.RTCSessionEventType.WHITEBOARD_BACKGROUND_SET:i=e.rtcSession.whiteboardBackgroundSet;break;case c.RTCSessionEventType.WHITEBOARD_SYNC:i=e.rtcSession.whiteboardSync,l.normalizeWhiteboard(i.whiteboard,t);break;case c.RTCSessionEventType.WHITEBOARD_CONVERSION_FAILED:i=e.rtcSession.whiteboardConversionFailed;break;case c.RTCSessionEventType.SCREEN_CONTROL_REQUESTED:i=e.rtcSession.screenControlRequested;break;case c.RTCSessionEventType.SCREEN_CONTROL_OFFERED:i=e.rtcSession.screenControlOffered;break;case c.RTCSessionEventType.SCREEN_CONTROL_ACCEPTED:i=e.rtcSession.screenControlAccepted;break;case c.RTCSessionEventType.HANDOVER_SCREEN_CONTROL:i=e.rtcSession.handoverScreenControl;break;case c.RTCSessionEventType.POLL_ENABLED:i=e.rtcSession.pollEnabledEvent;break;case c.RTCSessionEventType.POLL_STARTED:i=e.rtcSession.pollStartedEvent;break;case c.RTCSessionEventType.POLL_STOPPED:i=e.rtcSession.pollStoppedEvent;break;case c.RTCSessionEventType.POLL_UPDATED:i=e.rtcSession.pollUpdatedEvent;break;case c.RTCSessionEventType.POLL_EXPORTED:i=e.rtcSession.pollExportedEvent;break;case c.RTCSessionEventType.LIVE_TRANSCRIPTION:i=e.rtcSession.liveTranscriptionEvent}i.sessionId=e.rtcSession.sessionId;break;case c.ContentType.SEARCH:switch(n="Search."+e.search.type,e.search.type){case c.SearchEventType.BASIC_SEARCH_RESULT:i=e.search.basicSearchResult;break;case c.SearchEventType.DETAILED_SEARCH_RESULT:i=e.search.detailSearchResult;break;case c.SearchEventType.SEARCH_STATUS:i=e.search.searchStatus;break;case c.SearchEventType.RECENT_SEARCH_ADDED:i=e.search.recentSearchAdded}i.searchId=e.search.searchId;break;case c.ContentType.SYSTEM:switch(n="System."+e.system.type,e.system.type){case c.SystemEventType.BROADCAST:(i=e.system.systemNotificationEvent).eventId=e.system.eventId;break;case c.SystemEventType.MAINTENANCE:case c.SystemEventType.MAINTENANCE_ADDED:(i=e.system.maintenance).eventId=e.system.eventId;break;case c.SystemEventType.BROADCAST_REMOVED:case c.SystemEventType.MAINTENANCE_REMOVED:i=e.system.eventId}break;case c.ContentType.ADMINISTRATION:switch(n="Administration."+e.administration.type,e.administration.type){case c.AdministrationEventType.INVITE_MULTIPLE_USERS:i=e.administration.inviteMultipleUsers;break;case c.AdministrationEventType.INVITE_MULTIPLE_PARTNER_USERS:i=e.administration.inviteMultiplePartnerUsers}break;case c.ContentType.THIRDPARTYCONNECTORS:switch(n="ThirdParty."+e.thirdParty.type,e.thirdParty.type){case c.ThirdPartyEventType.CONNECTED_TO_THIRDPARTY:i=e.thirdParty;break;case c.ThirdPartyEventType.DISCONNECTED_FROM_THIRDPARTY:i=e.thirdParty.provider}break;case c.ContentType.USER_TO_USER:n="UserToUser."+e.userToUser.userToUser.type,(i=e.userToUser.userToUser).routing=e.userToUser.routing;break;case c.ContentType.ACTIVITYSTREAM:switch(n="ActivityStream."+e.activity.type,e.activity.type){case c.ActivityStreamEventType.ACTIVITY_CREATED:i=e.activity.create.item;break;case c.ActivityStreamEventType.ACTIVITY_DELETED:i=e.activity.delete.item;break;case c.ActivityStreamEventType.ACTIVITY_MARKED_READ:i=e.activity.markRead.itemId;break;case c.ActivityStreamEventType.ACTIVITY_MARKED_UNREAD:i=e.activity.markUnread.itemId;break;case c.ActivityStreamEventType.ACTIVITY_MARK_ALL_READ:i=e.activity.markAllRead.status}break;case c.ContentType.ACCOUNT:switch(n="Account."+e.account.type,e.account.type){case c.AccountEventType.MIGRATE_MULTIPLE_USERS:i=e.account.migrateMultipleUsers;break;case c.AccountEventType.TELEPHONY_CONFIGURATION_UPDATED:i=e.account.telephonyConfigurationUpdated;break;case c.AccountEventType.TC_START_REASSIGNMENT:i=e.account.tcStartReassignment}break;case c.ContentType.CONVERSATION_USER_DATA:switch(n="ConversationUserData."+e.conversationUserData.type,e.conversationUserData.type){case c.ConversationUserDataEventType.LABELS_ADDED:i=e.conversationUserData.labelsAdded;break;case c.ConversationUserDataEventType.LABELS_REMOVED:i=e.conversationUserData.labelsRemoved;break;case c.ConversationUserDataEventType.LABEL_EDITED:i=e.conversationUserData.labelEdited;break;case c.ConversationUserDataEventType.FILTERS_REMOVED:i=e.conversationUserData.filtersRemoved;break;case c.ConversationUserDataEventType.FILTER_ADDED:i=e.conversationUserData.filterAdded;break;case c.ConversationUserDataEventType.FILTER_EDITED:i=e.conversationUserData.filterEdited}break;case c.ContentType.SPACE:switch(n="Space."+e.space.type,e.space.type){case c.SpaceEventType.IMPORT_PARTICIPANTS:i=e.space.importParticipant;break;case c.SpaceEventType.NCA:i=e.space.nca;break;case c.SpaceEventType.SPACE_UPDATED:i=e.space.spaceUpated;break;case c.SpaceEventType.SPACE_DELETED:i=e.space.spaceDeleted;break;case c.SpaceEventType.ITEM_CREATED:i=e.space.itemCreated;break;case c.SpaceEventType.ITEM_UPDATED:i=e.space.itemUpdated;break;case c.SpaceEventType.ITEM_DELETED:i=e.space.itemDeleted;break;case c.SpaceEventType.FLAGGED:i=e.space.flagged;break;case c.SpaceEventType.UNFLAGGED:i=e.space.unflagged;break;case c.SpaceEventType.LIKED:i=e.space.liked;break;case c.SpaceEventType.UNLIKED:i=e.space.unliked;break;case c.SpaceEventType.BASIC_SEARCH_RESULT:i=e.space.basicSearchResult;break;case c.SpaceEventType.DETAILED_SEARCH_RESULT:i=e.space.detailedSearchResult;break;case c.SpaceEventType.RECENT_SEARCH_ADDED:i=e.space.recentSearchAdded;break;case c.SpaceEventType.SEARCH_STATUS:i=e.space.searchStatus;break;case c.SpaceEventType.PARTICIPANT_UPDATED:i=e.space.participantUpdated}break;case c.ContentType.CPAAS:switch(n="CPAAS."+e.cpaas.type,e.cpaas.type){case c.CPaaSEventType.SUBMIT_FORM_DATA:i=e.cpaas.submitFormData;break;case c.CPaaSEventType.INTEGRATION_STATE_CHANGED:i=e.cpaas.integrationStateChanged}break;case c.ContentType.TEAM:switch(n="Team."+e.team.type,e.team.type){case c.TeamEventType.NOTIFY:i=e.team.notifyEvent;break;case c.TeamEventType.NOTIFY_CANCEL:i=e.team.notifyCancelEvent;break;case c.TeamEventType.TEAM_CREATED:i=e.team.teamCreatedEvent.team;break;case c.TeamEventType.TEAM_UPDATED:i=e.team.teamUpdatedEvent.team;break;case c.TeamEventType.TEAM_DELETED:i=e.team.teamDeletedEvent.teamId;break;case c.TeamEventType.TEAM_MEMBERSHIP_CHANGED:i=e.team.teamMembershipChangedEvent}break;default:return null}return{name:n,data:i}},getMediaType:function(e){if(!e)return{audio:!1,video:!1,desktop:!1};var t={audio:!1,video:!1,desktop:!1};return e.forEach(function(e){switch(e){case c.RealtimeMediaType.AUDIO:t.audio=!0;break;case c.RealtimeMediaType.VIDEO:t.video=!0;break;case c.RealtimeMediaType.DESKTOP_SHARING:t.desktop=!0}}),t},isOfflineFailure:function(e){return e===c.ReturnCode.DISCONNECTED||e===c.ReturnCode.FAILED_TO_SEND||e===c.ReturnCode.REQUEST_TIMEOUT}};return t.Constants=c,t.PrivateData=e,t.Proto=l,t}((Circuit=function(e){"use strict";var r=e.Utils||{};r.EMOTICON_MAPPING={":)":128515,":D":128516,":(":128542,":heart":128525,";)":128521,":awesome":128516,":angry":128544,":zzz":128554,":O":128562,";(":128546};var t=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^/?>]*\/?)>/gi;function n(e,t,n){var i=r.EMOTICON_MAPPING[n];return i?String.fromCodePoint(i):""}return r.standardizeEmoticon=function(e){return e?e.replace(t,n):""},r.removeMentionHtml=function(e){var i=0;return e.replace(/(<span.*?>)|(<\/span>)/gi,function(e,t,n){return t?t.match(/class="mention"/i)?"":(i++,t):n&&i?(i--,n):""})},e}((Circuit=function(a){"use strict";a.__server="",a.__domain="",a.isElectron=!(a.isSDK||"undefined"==typeof process||!process.versions||!process.versions.electron);var t,c=a.logger,l=a.Emoticons,d=a.Emoji;if(a.isElectron){var e=(t=require("electron").remote).getCurrentWindow();a.__server=e._domain||"",a.__sotelUser=!!e._sotelUser,a.productName=e._productName||"Circuit",a.productBrand=e._productBrand||""}else a.productName="string"==typeof __productName?__productName:"Circuit",a.productBrand="string"==typeof __productBrand?__productBrand:"";"undefined"!=typeof Skype&&(a.SkypeSDK=Skype,Skype=null);var u="https://",E="circuit://",C=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^/?>]*\/?)>/gi,T=a.Utils||{};var n="(?:[\\w@'^=$%&amp;\\/~+\\{\\}\\-\\|.,?!:\\[\\]\\(\\)#]*[\\w@'^=$%&amp;\\/~+\\{\\}\\-\\|#])?",i=["items","parents","peerUsers","previousMembers"];T.trimCallForMobile=function(e){var t;return e&&(t=T.flattenObj(e)),t},T.trimConvForMobile=function(e){var t;return e&&(t=T.flattenObj(e),i.forEach(function(e){delete t[e]}),t.call=T.trimCallForMobile(e.call)),t},T.isPromise=function(e){return!(!e||"function"!=typeof e.then)},T.convertVersionToNumber=function(e){if("string"!=typeof e)return 0;var t=e.split("."),n=parseInt(t[0],10)||0,i=parseInt(t[1],10)||0;i=Math.min(i,99);var r=parseInt(t[2],10)||0;return(r=Math.min(r,9999))+1e4*i+1e6*n},T.trimTextWithEmoticonsBeforeMatch=function(e,t,n){for(var i=e.indexOf(t),r=e.slice(i),o=e.slice(0,i),a=String.fromCharCode(17),s=String.fromCharCode(18),c=o.replace(C,function(e,t){return a+t+s}),l=!0,d=c.length-1,u=c.length-1,E=u;o.length-1-d<=n&&0<=u;)18===c.charCodeAt(u)?(c=c.replaceAt(u,">"),l=!1):17===c.charCodeAt(u)&&(c=c.replaceAt(u,"<"),l=!0),E=u,u--,l&&d--;return(o=0<E?"..."+c.slice(E):c)+r},T.enhanceEncodeURI=function(e){var t={"!":"%21","(":"%28",")":"%29","#":"%23","{":"%7B","}":"%7D"};return encodeURIComponent(e).replace(/[!()#{}]/gi,function(e){return t[e]})},T.normalizeDn=function(e){return e?e.replace("+",""):""},T.cleanPhoneNumber=function(e){return e?e.replace(/[^*#\d+]/g,""):""},T.cleanPhoneNumberDigitsWithPin=function(e){return e?e.replace(/[^*#\d+,]/g,""):""},T.isMSDoc=function(e){return 0<=e.search(/<\S*?WordDocument>/i)||0<=e.search(/<[^>]*?style=[^>]*?mso-[^<]+?>/i)||0<=e.search(/<meta[^>]*?Microsoft/i)},T.isXCodeDoc=function(e){return 0<=e.search(/<meta[^>]*?Cocoa[^<]+?>/)},T.isYourCircuitDomain=function(){var e=a.isElectron?a.__server:window.location.host;return-1!==["eu.yourcircuit.com","na.yourcircuit.com"].indexOf(e)},T.isIntegrationsSupported=function(){var e=a.isElectron?a.__server.split(":")[0]:window.location.hostname;return["tandi.circuitsandbox.net","adfs01.circuitsandbox.net","circuitsandbox.net","beta.circuit.com","eu.yourcircuit.com","na.yourcircuit.com","circuitdev.unify.com"].includes(e)},T.sanitizer=null,T.sanitize=function(t){if(!t||!T.sanitizer)return t||"";try{t=(t=(t=(t=t.replace(/style="background-color: rgb\(212, 239, 181\);"/gi,'class="rich-text-highlight"')).replace(/<[^>]+background-color: rgb\(212, 239, 181\);.*?>/gi,function(e){return e.includes("class=")?e.replace(/class=".*?"/gi,function(e){return e.includes("rich-text-highlight")?e:e.replace(/[^=]\s*(.*)/gi,function(e){return e.slice(0,-1)+" rich-text-highlight"})}):e.replace(">",function(e){return' class="rich-text-highlight" '+e})})).replace(/<img(?![^>]*class="(emoticon-icon|emojione-icon))[^>]*>/gi,"")).replace(/<title[^>]*>([\s\S]*?)<\/title>/gi,""),t=(t=(t=(t=(t=l?l.normalizeEmoticonHtml(t):t).replace(/<font[^>]*>|<\/font>/gi,"")).replace(/(<\s*hr\s*><\s*\/hr\s*>|<\s*hr\s*>)/gi,"<hr/>")).replace(/(\r|\n)+(?=[^<]*?>)/gi," ")).replace(/\r\n|\r|\n/g,"<br>"),"function"==typeof T.sanitizer&&(t=T.sanitizer(t));var e=t.split(/<\/?div.*?>|<\/?p.*?>/g).filter(function(e){return!!e}),n=e.length,i="";if(1<n)for(var r,o,a=/<br>(?![\s\S]*<br>)(?=(<[^/][^>]*><\/[^>]*>)*$|(<\/[^>]*>)*$|$)/i,s=0;s<n;s++)r=e[s].replace(/((<span( class="[\S]*")*>)|(<b( class="[\S]*")*>)|(<i( class="[\S]*")*>))*(<br>|<br\/>)(<\/span>|<\/b>|<\/i>)*/g,"<br>"),!o||o.endsWith("</ul>")||o.endsWith("</ol>")||a.test(o)||(i+="<br>"),i+=r,o=r;else i=e[0];t=i}catch(e){return c.error("[Utils]: Error sanitizing content. ",e),c.error("[Utils]: Unexpected content: ",t),""}return t||""},T.sanitizeSymbols=function(e){return T.isMobile()&&"undefined"!=typeof he?e&&he.encode(e,{allowUnsafeSymbols:!0,decimal:!0}):e},T.convertSymbolCodes=function(e){return T.isMobile()?e&&e.replace(d.HTML_ENTITY_REGEX,function(e){return function(e){var t=e.replace(/[&#;]/g,"");if(!/^[0-9]+$/.test(t)||55296<=t&&t<=57343||1114111<t)return e;var n="";return 65535<t&&(t-=65536,n+=String.fromCharCode(t>>>10&1023|55296),t=56320|1023&t),n+=String.fromCharCode(t)}(e)}):e},T.retrieveTextOnly=function(e,t){if(!e||"PLAIN"===t)return e;e=(e=(e=(e=(e=e.replace(Circuit.Emoticons.HTML_REGEX,"")).replace(/&#\d+;/g,"")).replace(/<span.*?class=["']mention["'].*?>.*?>/g,"")).replace(T.URL_PATTERN,"")).replace(T.PSEUDO_URL_PATTERN,"");var n=document.createElement("div");return n.innerHTML=e.replace(/<(br[/]?|\/li|hr[/]?)>/gi,"&nbsp;"),n.textContent.trim()},T.toPlainText=function(e,t){if(!e||t&&"RICH"!==t)return e;l&&(e=e.replace(l.HTML_REGEX,function(e,t){return l.isEmoticonContent(e)?t:e}));var n=document.createElement("div");return n.innerHTML=e.replace(/<(br[/]?|\/li|hr[/]?)>/gi,"&nbsp;"),n.textContent},T.toPlainTextWithEmoticonHtml=function(e,t){if(!e||t&&"RICH"!==t)return e;var n=String.fromCharCode(17),i=String.fromCharCode(18);e=e.replace(l.HTML_REGEX,function(e,t){return l.isEmoticonContent(e)?n+t+i:e}),e=d.convertEmojis(e);var r=String.fromCharCode(19),o=String.fromCharCode(20);e=e.replace(d.HTML_REGEX,function(e,t){return d.isEmojiContent(e)?r+t+o:e});var a=document.createElement("div");a.innerHTML=e.replace(/<(br[/]?|\/li|hr[/]?)>/gi," ");var s=T.textToHtmlEscaped(a.textContent,!0);return(s=s.replace(/\x11([^\x11\x12]*)\x12/gim,function(e,t){return l.getHtmlFromShortcut(t,!1,!0,!0)})).replace(/\x13([^\x13\x14]*)\x14/gim,function(e,t){return d.convertEmojis(t.replace(/&amp;/g,"&"))})},T.truncateFileName=function(e){return!e||e.length<=22?e:e.substring(0,10)+" ..."+e.substring(e.length-8,e.length)},T.convertItemText=function(e,t,n){return e?n?T.toPlainTextWithEmoticonHtml(e,t):T.toPlainText(e,t):""},T.createMentionedUsersArray=function(e,n){for(var t=[],i=/<span.*?class=["']mention["'].*?>/g,r=i.exec(e);null!==r;){var o=T.ABBR_PATTERN.exec(r[0]);o=o&&o[1],-1===t.indexOf(o)&&t.push(o),r=i.exec(e)}return n&&(t=t.filter(function(t){return n.some(function(e){return e.userId===t})})),t},T.DEFAULT_HELP_URL="https://www.circuit.com/support",T.DEFAULT_FAQ_URL="https://www.circuit.com/unifyportalfaqdetail",T.SEPARATORS_PATTERN="!-/:-@[-^{-~\\s",T.NUMERIC_PATTERN="^[0-9]*$",T.NUMERIC_SIGN_PATTERN="^[*+]?[0-9]*$",T.ALPHANUMERIC_PATTERN="^[a-zA-Z0-9_]*$",T.URL_SEPARATORS_PATTERN=/(?=[.,;!]?\s+|[.,;!]$)/,T.URL_PATTERN=new RegExp("(http|ftp|https|circuit):\\/\\/[\\w-]+?((\\.|:)[\\w-]+?)*?"+n,"gim"),T.EXACT_URL_PATTERN=new RegExp("^"+T.URL_PATTERN.source+"$","i"),T.PSEUDO_URL_PATTERN=new RegExp("www\\.+[\\w-]+?(\\.[\\w-]+?)+?"+n,"gim"),T.PROTOCOL_PATTERN=/^(?:http|https|ftp):\/\//,T.TABBABLE_ELEMENTS_PATTERN="a[href], area[href], input:not([disabled]):not([tabindex='-1']), button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']), textarea:not([disabled]):not([tabindex='-1']), iframe, object, embed, *[tabindex]:not([tabindex='-1']), *[contenteditable=true]",T.RICH_TEXT_LINK_CLASS="text-linkDarkGreen",T.ABBR_PATTERN=/abbr=["'](.*?)["']/,T.SPACE_HASHTAGS_PATTERN=/<span[^>]*class=["']hashtag["'][^>]*>/gim,T.SPACE_HASHTAG_PATTERN=/^([a-zA-Z\u0080-\u009f\u00a1-\uffff0-9_]+)$/g,T.EMAIL_ADDRESS_INCLUDED_PATTERN=/[\w*+\-$?^{!#%&'/=`|}~]+?(?:\.[\w*+\-$?^{!#%&'/=`|}~]+?)*?@[a-z\d-]+?(?:\.[a-z\d-]{2,})+/gim,T.EMAIL_ADDRESS_PATTERN=new RegExp("^"+T.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","i"),a.isElectron&&t&&(T.SSO_EMAIL_DOMAINS_MAPPING=t.getGlobal("constants").SSO_EMAIL_DOMAINS_MAPPING||[],T.SSO_PATTERN="[_a-z0-9-]+?@(("+T.SSO_EMAIL_DOMAINS_MAPPING.join(")|(")+"))",T.SSO_EMAIL_ADDRESS_PATTERN=new RegExp(T.SSO_PATTERN,"i")),T.CIRCUIT_CONVERSATION_HASH_PATTERN=/#\/(conversation|open|muted)\/[0-9\-a-z]+?(\?((user=(\d)+?)|(item=([0-9\-a-z])+?(&user=(\d)+?)?)))?$/gim,T.CIRCUIT_SPACE_HASH_PATTERN=/#\/space\/[0-9\-a-z]+?(\?topic=[0-9\-a-z]+?(&reply=[0-9\-a-z]+?)?)?$/gim,T.CIRCUIT_LINKS_HASH_PATTERN=/#\/(profile|phone|user|search)\/[0-9\-a-z]+?$/gim,T.CIRCUIT_HASH_TAG_SEARCH_PATTERN=/#\/search\/[a-zA-Z\u0080-\u009f\u00a1-\uffff0-9_]+/gim,T.CIRCUIT_EMAIL_HASH_PATTERN=new RegExp("#\\/email\\/"+T.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","gim"),T.PHONE_PATTERN=/^(\+\s*)?\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)$/,T.GNF_PHONE_PATTERN=/^((\+)|(\+\s*\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)))$/,T.PHONE_PAC=/^([#*]+[#*()\-\s+\d]*)$/,T.PHONE_DIAL_PATTERN=/^([#*()\\/\-.\s+\d,]*)$/,T.PHONE_DIAL_WITH_PIN_PATTERN=/^([#*()\\/\-.\s+\d]*)(,+[,\d#*]+)$/,T.PHONE_WITH_EXTENSION_PATTERN=/^([#*()\\/\-.\s+\d]*)(\s*(x|X|ext\.)\s*\d+)$/,T.TIME_PATTERN=/^((([0-1]?[0-9]|2[0-3]):[0-5][0-9]\s*)|((0?[1-9]|1[0-2]):[0-5][0-9]\s*(PM|AM)))$/,T.IPV4_ADDRESS_PATTERN=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/,T.TCP_PORT_NUMBERS_PATTERN=/^(0|([1-9]\d{0,3}|[1-5]\d{4}|[6][0-5][0-5]([0-2]\d|[3][0-5])))$/,T.FQDN_PATTERN=/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$/,T.matchPhonePattern=function(e){return e&&"string"==typeof e?e.match(T.PHONE_PATTERN):null},T.matchUrlPattern=function(e){return e&&"string"==typeof e?e.match(T.URL_PATTERN)||e.match(T.PSEUDO_URL_PATTERN):null},T.matchEmailPattern=function(e){return e&&"string"==typeof e?e.match(T.EMAIL_ADDRESS_INCLUDED_PATTERN):null},T.getEmails=function(e){var t=e&&e.split(/[;,]\s*|\s+/i);return(t=t&&t.map(function(e){var t=e.match(T.EMAIL_ADDRESS_INCLUDED_PATTERN);return t&&t[0]}).filter(function(e){return!!e}))||[]},T.getTags=function(e){return e&&e.split(/[;,]\s*/i).reduce(function(e,t){var n=t.trim();return n.length&&e.push(n),e},[])},T.matchNames=function(e,t,n){if(!e||"string"!=typeof e||!t)return!1;var i=new RegExp("^"+RegExp.escape(t),n||"i");return i.test(e)||e.split(" ").some(function(e){return i.test(e)})},T.matchIpOrFqdnPattern=function(e){return e&&"string"==typeof e?e.match(T.IPV4_ADDRESS_PATTERN)||e.match(T.FQDN_PATTERN):null},T.compareStrings=function(e,t){return"string"==typeof e&&"string"==typeof t&&new RegExp("^"+RegExp.escape(e)+"$","i").test(t)},T.rstring=function(){return Math.floor(1e9*Math.random()).toString()},T.randomNumber=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},T.randomBoolean=function(){return Math.random()<.5},T.createTransactionId=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(e[19]?3:8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},T.getLegalRegion=function(e){switch(e){case"europe":var t=(navigator.language||navigator.browserLanguage).split("-");return"de"===T.lastArrayElement(t).toLowerCase()?"de":"uk";case"americas":case"apac":default:return"us"}},T.getBrowserInfo=function(){if("iOS"===window.navigator.platform)return{ios:!0,type:"ios"};if("Android"===window.navigator.platform)return{android:!0,type:"android"};if("node"===window.navigator.platform)return{node:!0,type:"node"};if(Circuit.isElectron)return{chrome:!0,type:"chrome",version:process.versions.chrome};if(window.cordova&&"ios"===window.cordova.platformId)return{cordovaios:!0,type:"cordovaios"};var e,t={},n=navigator.userAgent.toLowerCase(),i=/(msie|trident)(?: |.*rv:)([\d.]+)/.exec(n)||/(opera|opr)\/(?:.*version\/|)([\d.]+)/.exec(n)||/(firefox)\/([\d.]+)/.exec(n)||/(edge)\/([\d.]+)/.exec(n)||/(edg)\/([\d.]+)/.exec(n)||/(chrome)\/([\d.]+)/.exec(n)||/version\/([\d.]+).*(safari)/.exec(n)||/(phantomjs)\/([\d.]+)/.exec(n)||[],r=i[1]||"",o=i[2]||0;if("safari"===o)r=i[2],o=i[1];else switch(r){case"trident":r="msie";break;case"opr":r="opera";break;case"edg":r="chrome",e="edge"}return t[r]=!0,t.type=r,t.version=o,e&&(t.subType=e),t};var r=[{s:"Windows 10",r:/(Windows.* 10|Windows 10.0|Windows[ _]NT.* 10.0)/},{s:"Windows 8.1",r:/(Windows.* 8.1|Windows[ _]NT.* 6.3)/},{s:"Windows 8",r:/(Windows.* 8|Windows[ _]NT.* 6.2)/},{s:"Windows 7",r:/(Windows.* 7|Windows[ _]NT.* 6.1)/},{s:"Windows Vista",r:/(Windows.* Vista|Windows[ _]NT.* 6.0)/},{s:"Windows Server 2003",r:/(Windows Server 2003|Windows[ _]NT.* 5.2)/},{s:"Windows XP",r:/(Windows[ _]NT.* 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows[ _]NT.* 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Windows 3.11|Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/Open BSD|OpenBSD/},{s:"Sun OS",r:/Sun OS|SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iOS|iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh|Darwin)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(Search Bot|nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];function o(e){if(!e)return"";var t=document.createElement("div"),n=document.createElement("div");e=e.replace(/\$/gm,"$$$$");var i=0;return e=e.replace(/(<span.*?>)|(<\/span>)/gi,function(e,t,n){return t?t.match(/class="mention"/i)?e.replace(/.*abbr="(.*?)".*?>/gi,'<span class="mention" abbr="$1"><a href="#/profile/$1">'):t.match(/class="hashtag"/i)?e.replace(/.*abbr="(.*?)".*?>/gi,'<span class="hashtag" abbr="$1"><a href="#/search/$1">'):(i++,t):n?i?(i--,n):"</a></span>":""}),T.isMobile()||(e=d.convertEmojis(e)),t.innerHTML=e,function e(t,n){if(!t||!t.childNodes||!t.childNodes.length)return t;var i;for(var r=0,o=t.childNodes.length;r<o;r++)switch((i=t.childNodes[r]).nodeType){case 1:if("A"===i.nodeName){var a=p(),s=T.getCircuitRelativeLink(a,i.href);s?i.href=s:(i.target="_blank",i.rel="noopener noreferrer")}if(i.classList.contains("link-preview"))break;e(i,n);break;case 3:for(n.innerHTML=T.linkifyText(i.textContent,"PRE"===i.parentNode.tagName),r+=n.childNodes.length-1;n.childNodes.length;)t.insertBefore(n.childNodes[0],i);t.removeChild(i),o=t.childNodes.length}return t}(t,n).innerHTML.replace(/&nbsp;/gi," ")}function p(){return a.isElectron?u+a.__server:window.location&&window.location.origin}T.getOSInfo=function(t){var n=t=t||window.navigator.userAgent,e="",i="";if(r.some(function(e){return!!e.r.test(t)&&(n=e.s,!0)})&&/Windows/.test(n))i=/Windows (.*)/.exec(n)[1],e="Windows";else{e=n;try{switch(n){case"Mac OS X":i=/Mac OS X (10[._\d]+)/.exec(t)[1];break;case"Android":i=/Android ([._\d]+)/.exec(t)[1]}}catch(e){c.debug("[Utils]: osVersion does not contain version on it. ",t)}}return{type:e,version:i,info:n}},T.checkUserDomain=function(e,t){var n=a.isElectron?a.__server.split(":")[0]:window.location.hostname;return t?n.startsWith(e):n.endsWith(e)},T.parseIpWithPort=function(e){if(!e||"string"!=typeof e)return null;if("["===e[0]){var t=/\[(.*)\]:(\d*)/.exec(e);if(t&&3===t.length)return{ipAddress:t[1],port:t[2]}}else if(e.includes(":")){var n=e.split(":");if(2===n.length)return{ipAddress:n[0],port:n[1]}}return null},T.isEmptyObject=function(e){return 0===Object.keys(e).length},T.getBaseObject=function(t,e){if(!t||"object"!=typeof t)return null;if(Array.isArray(t))return t;var n=Object.getPrototypeOf(t);return T.isEmptyObject(n)?t:(!1!==e&&Object.getOwnPropertyNames(n).forEach(function(e){"function"!=typeof n[e]&&t.hasOwnProperty(e)&&(n[e]=t[e])}),n)},T.syncBaseObject=function(t){var e=T.getBaseObject(t,!0);e&&e!==t&&Object.getOwnPropertyNames(e).forEach(function(e){t.hasOwnProperty(e)&&delete t[e]})},T.flattenObj=function(e){if(!e||"object"!=typeof e||Array.isArray(e))return e;var t=Object.getPrototypeOf(e);if(T.isEmptyObject(t))return e;var n={};for(var i in e)"function"!=typeof e[i]&&(n[i]=e[i]);return n},T.getNormalizedFileExtension=function(e){var t=e&&(e.fileName||e.name);if(!t)return null;if(/audio/i.test(e.mimeType))return"audio";if(/video/i.test(e.mimeType))return"video";var n=t.split(".").pop();if(n)switch(n.toLowerCase()){case"doc":case"docx":return"doc";case"ppt":case"pptx":return"ppt";case"pdf":return"pdf";case"xls":case"xlsx":return"xls";case"gz":case"zip":return"zip";case"html":return"html";case"csv":return"csv";case"png":return"png";case"jpg":case"jpeg":return"jpg";case"log":return"log";case"flv":case"mp4":case"ogv":case"webm":return"video";case"wav":case"mp3":case"ogg":return"audio";case"vtt":return"vtt"}return"def"},T.getImageFileExtension=function(e){if(e.type)switch(e.type.toLowerCase()){case"image/png":return"png";case"image/jpeg":return"jpg";case"image/gif":return"gif";case"image/bmp":return"bmp";case"image/svg+xml":return"svg"}return null},T.getMimeTypes=function(e){if(!e)return null;var t=e.split(".").pop();if(t)switch(t.toLowerCase()){case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xltx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.template";case"potx":return"application/vnd.openxmlformats-officedocument.presentationml.template";case"ppsx":return"application/vnd.openxmlformats-officedocument.presentationml.slideshow";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"sldx":return"application/vnd.openxmlformats-officedocument.presentationml.slide";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"dotx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.template";case"xlam":return"application/vnd.ms-excel.addin.macroEnabled.12";case"xlsb":return"application/vnd.ms-excel.sheet.binary.macroEnabled.12"}return"application/octet-stream"},T.textToHtmlEscaped=function(e,t){if(!e)return"";var n=t?"&nbsp;":"<br>";return e.replace(/&/g,"&amp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n|\r|\n/gm,n)},T.escapedHtmlToText=function(e){return e?e.replace(/&amp;/g,"&").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/<br\/?>/g,"\r\n"):""},T.stripParenthesis=function(e){for(var t=(e=e.trim()).match(/\(/g)||[],n=e.match(/\)/g)||[],i=0;"("===e[i];)i++;return e.slice(i,e.length-Math.abs(t.length-i-n.length))},T.linkifyText=function(e,t){t||(e=e.replace(/\xA0|&#160;|\x0A|\x0D/gim," "));for(var a=String.fromCharCode(17),s=String.fromCharCode(18),c=String.fromCharCode(19),n=function(e){var t="",n="",i=p(),r=T.getCircuitRelativeLink(i,e);if(!r){var o=!0;if((r=e).startsWith(E))new RegExp(i.replace(u,"")+"\\/guest\\?token=","i").exec(e)?r=e.replace(E,u):o=!1;else T.PROTOCOL_PATTERN.exec(e)||(r="http://"+r);t=o?" target="+c+"_blank"+c:"",n=" rel="+c+"noopener noreferrer"+c}return a+"a href="+c+r+c+t+n+s+e+a+"/a"+s},i=e.split(T.URL_SEPARATORS_PATTERN),r=0;r<i.length;r++){var o=i[r],l=T.stripParenthesis(o),d=l;0<=d.search(/http|ftp|https|circuit/gim)&&0<=d.search(T.URL_PATTERN)?d=d.replace(T.URL_PATTERN,n):0<=d.search(/www\./gim)&&0<=d.search(T.PSEUDO_URL_PATTERN)?d=d.replace(T.PSEUDO_URL_PATTERN,n):0<=d.search(/\S@\S/gim)&&0<=d.search(T.EMAIL_ADDRESS_INCLUDED_PATTERN)&&(d=d.replace(T.EMAIL_ADDRESS_INCLUDED_PATTERN,a+"a href="+c+"mailto:$&"+c+" target="+c+"_blank"+c+" rel="+c+"noopener noreferrer"+c+s+"$&"+a+"/a"+s)),o=o.replace(l,d),i[r]=o}return e=i.join(""),T.textToHtmlEscaped(e).replace(/\x11/gi,"<").replace(/\x12/gi,">").replace(/\x13/gi,"'")},T.linkifyContent=function(e,t){if(!e)return"";return 5e4<e.length?e:(e=l.addEmoticonsAltAttr(e),"PLAIN"===t?T.linkifyText(e):o(e))},T.invalidFileTypes=["ade","adp","app","asp","bas","bat","cer","chm","cmd","cnt","com","cpl","crt","csh","der","exe","fxp","gadget","hlp","hpj","hta","inf","ins","isp","its","js","jse","ksh","lnk","mad","maf","mag","mam","maq","mar","mas","mat","mau","mav","maw","mda","mdb","mde","mdt","mdw","mdz","msc","msh","msh1","msh1xml","msh2","msh2xml","mshxml","msi","msp","mst","ops","osd","pcd","pif","plg","prf","prg","ps1","ps1xml","ps2","ps2xml","psc1","psc2","pst","reg","scf","scr","sct","shb","shs","tmp","url","vb","vbe","vbp","vbs","vsmacros","vsw","ws","wsc","wsf","wsh","xnk"],T.hasScrollbar=function(e){if(e&&0<e.length){var t=e[0];return!!t&&t.scrollHeight>t.clientHeight}return!1},T.isDescendantOrEqual=function(e,t){if(e===t)return!0;for(var n=e;n;)if((n=n.parentElement)===t)return!0;return!1},T.isSupportedImage=function(e){return/^image\/(jpeg|gif|bmp|png)$/i.test(e)},T.isVideoSupportedByBrowser=function(e){return/^video\/(quicktime|mp4|webm)$/i.test(e)},T.shallowCopy=function(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.slice();var t=T.flattenObj(e),n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},T.normalizeLocaleProto=function(e){var t;return e&&5<=e.length&&(t=e.replace(/-/g,"_").toUpperCase()),t},T.normalizeLocale=function(e){var t;return e&&5<=e.length&&(t=e.substr(0,2).toLowerCase()+e.substr(2,e.length-2).replace(/_/g,"-")),t},T.getLocalTime=function(e){var t=new Date;return null==e||t.setTime(t.getTime()+60*(t.getTimezoneOffset()-e)*1e3),t.getTime()},T.delayOrTimestamp=function(e,t){return 0<e?Date.now()+e:t},T.buildAttachmentMetaData=function(e){function n(e){var t={fileId:e.fileId,fileName:e.fileName,itemId:e.itemId,mimeType:e.mimeType,size:e.size};return e.thumbnail&&e.thumbnail.fileId&&(t.thumbnailId=e.thumbnail.fileId),e.inlineUsage&&(t.inlineUsage=e.inlineUsage),t}var i=[],r=[];return e&&e.forEach(function(e){if(e.isThirdParty){var t=n(e);r.push({type:e.provider,attachment:t,downloadLocation:e.url,previewLocation:e.url,shareLinkToken:e.shareLinkToken})}else i.push(n(e)),e.thumbnail&&i.push(n(e.thumbnail))}),{attachments:i,externalAttachments:r}},T.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,(e.prototype.constructor=e).parent=t.prototype},T.bytesToSize=function(e,t){if(!(e=parseInt(e,10)))return"0 Bytes";var n=Math.floor(Math.log(e)/Math.log(1024));return Number((e/Math.pow(1024,n)).toPrecision(t||3))+" "+["Bytes","KB","MB","GB","TB","PB"][n]},T.isMacOs=!(!window.navigator||!window.navigator.userAgent)&&(-1!==window.navigator.userAgent.indexOf("Mac")||-1!==window.navigator.userAgent.indexOf("Darwin")),T.isWindowsOs=!(!window.navigator||!window.navigator.platform)&&"win"===window.navigator.platform.substring(0,3).toLowerCase(),T.isMobile=function(){return"iOS"===window.navigator.platform||"Android"===window.navigator.platform},T.isIOS=function(){return"iOS"===window.navigator.platform},T.formatPIN=function(e,t,n){if(!t)return"";if(n)return(e||"")+t+"#";for(var i,r=[],o=e?3:4,a=0;a<t.length;a+=o)0<a&&(o=3),2<=(i=t.substr(a,o)).length||0===r.length?r.push(i):r[r.length-1]+=i;return e&&r.unshift(e),r.push("#"),r.join(" ")},T.CountriesArray=[{name:"res_countryName_Andorra",code:"AD"},{name:"res_countryName_United_Arab_Emirates",code:"AE"},{name:"res_countryName_Afghanistan",code:"AF"},{name:"res_countryName_Antigua_and_Barbuda",code:"AG"},{name:"res_countryName_Anguilla",code:"AI"},{name:"res_countryName_Albania",code:"AL"},{name:"res_countryName_Armenia",code:"AM"},{name:"res_countryName_Netherland_Antilles",code:"AN"},{name:"res_countryName_Angola",code:"AO"},{name:"res_countryName_Antarctic",code:"AQ"},{name:"res_countryName_Argentina",code:"AR"},{name:"res_countryName_American_Samoa",code:"AS"},{name:"res_countryName_Austria",code:"AT"},{name:"res_countryName_Australia",code:"AU"},{name:"res_countryName_Aruba",code:"AW"},{name:"res_countryName_Azerbaijan",code:"AZ"},{name:"res_countryName_Bosnia_and_Herzegovina",code:"BA"},{name:"res_countryName_Barbados",code:"BB"},{name:"res_countryName_Bangladesh",code:"BD"},{name:"res_countryName_Belgium",code:"BE"},{name:"res_countryName_Burkina_Faso",code:"BF"},{name:"res_countryName_Bulgaria",code:"BG"},{name:"res_countryName_Bahrain",code:"BH"},{name:"res_countryName_Burundi",code:"BI"},{name:"res_countryName_Benin",code:"BJ"},{name:"res_countryName_Bermuda",code:"BM"},{name:"res_countryName_Brunei_Darussalam",code:"BN"},{name:"res_countryName_Bolivia",code:"BO"},{name:"res_countryName_Brazil",code:"BR"},{name:"res_countryName_Bahamas",code:"BS"},{name:"res_countryName_Bhutan",code:"BT"},{name:"res_countryName_Botswana",code:"BW"},{name:"res_countryName_Belarus",code:"BY"},{name:"res_countryName_Belize",code:"BZ"},{name:"res_countryName_Canada",code:"CA"},{name:"res_countryName_Dem_Republic_Congo",code:"CD"},{name:"res_countryName_Central_African_Republik",code:"CF"},{name:"res_countryName_Congo",code:"CG"},{name:"res_countryName_Switzerland",code:"CH"},{name:"res_countryName_Cote_d_Ivoire",code:"CI"},{name:"res_countryName_Chile",code:"CL"},{name:"res_countryName_Cameroon",code:"CM"},{name:"res_countryName_China_Peoples_Republic",code:"CN"},{name:"res_countryName_Colombia",code:"CO"},{name:"res_countryName_Costa_Rica",code:"CR"},{name:"res_countryName_Cuba",code:"CU"},{name:"res_countryName_Cap_Verde",code:"CV"},{name:"res_countryName_Cyprus",code:"CY"},{name:"res_countryName_Czech_Republik",code:"CZ"},{name:"res_countryName_Germany",code:"DE"},{name:"res_countryName_Djibouti",code:"DJ"},{name:"res_countryName_Denmark",code:"DK"},{name:"res_countryName_Dominica",code:"DM"},{name:"res_countryName_Dominican_Republik",code:"DO"},{name:"res_countryName_Algeria",code:"DZ"},{name:"res_countryName_Ecuador",code:"EC"},{name:"res_countryName_Estonia",code:"EE"},{name:"res_countryName_Egypt",code:"EG"},{name:"res_countryName_Westsahara",code:"EH"},{name:"res_countryName_Eritrea",code:"ER"},{name:"res_countryName_Spain",code:"ES"},{name:"res_countryName_Ethiopia",code:"ET"},{name:"res_countryName_Finland",code:"FI"},{name:"res_countryName_Fiji",code:"FJ"},{name:"res_countryName_Falkland_Islands",code:"FK"},{name:"res_countryName_Micronesia_Fed_States",code:"FM"},{name:"res_countryName_Faroer",code:"FO"},{name:"res_countryName_France",code:"FR"},{name:"res_countryName_Gaboon",code:"GA"},{name:"res_countryName_United_Kingdom",code:"GB"},{name:"res_countryName_United_Kingdom",code:"UK"},{name:"res_countryName_Grenada",code:"GD"},{name:"res_countryName_Georgia",code:"GE"},{name:"res_countryName_French_Guayana",code:"GF"},{name:"res_countryName_Ghana",code:"GH"},{name:"res_countryName_Gibraltar",code:"GI"},{name:"res_countryName_Greenland",code:"GL"},{name:"res_countryName_Gambia",code:"GM"},{name:"res_countryName_Guinea",code:"GN"},{name:"res_countryName_Guadeloupe",code:"GP"},{name:"res_countryName_Equatorial_Guinea",code:"GQ"},{name:"res_countryName_Greece",code:"GR"},{name:"res_countryName_South_Georgia_South_Sandwichisland",code:"GS"},{name:"res_countryName_Guatemala",code:"GT"},{name:"res_countryName_Guam",code:"GU"},{name:"res_countryName_Guinea_Bissau",code:"GW"},{name:"res_countryName_Guyana",code:"GY"},{name:"res_countryName_Hong_Kong",code:"HK"},{name:"res_countryName_Honduras",code:"HN"},{name:"res_countryName_Croatia",code:"HR"},{name:"res_countryName_Haiti",code:"HT"},{name:"res_countryName_Hungary",code:"HU"},{name:"res_countryName_Canary_Island",code:"IC"},{name:"res_countryName_Indonesia",code:"ID"},{name:"res_countryName_Ireland",code:"IE"},{name:"res_countryName_Israel",code:"IL"},{name:"res_countryName_India",code:"IN"},{name:"res_countryName_British_Indian_Ocean_Territory",code:"IO"},{name:"res_countryName_Iraq",code:"IQ"},{name:"res_countryName_Iran_Islamic_Republic",code:"IR"},{name:"res_countryName_Iceland",code:"IS"},{name:"res_countryName_Italy",code:"IT"},{name:"res_countryName_Jamaica",code:"JM"},{name:"res_countryName_Jordan",code:"JO"},{name:"res_countryName_Japan",code:"JP"},{name:"res_countryName_Kenya",code:"KE"},{name:"res_countryName_Kyrgyzstan",code:"KG"},{name:"res_countryName_Cambodia",code:"KH"},{name:"res_countryName_Kiribati",code:"KI"},{name:"res_countryName_Comoros",code:"KM"},{name:"res_countryName_St_Kitts_and_Nevis",code:"KN"},{name:"res_countryName_Korea_Dem_Peoples_Rep_North_Korea",code:"KP"},{name:"res_countryName_Korea_South",code:"KR"},{name:"res_countryName_Kuwait",code:"KW"},{name:"res_countryName_Cayman_Islands",code:"KY"},{name:"res_countryName_Kazakhstan",code:"KZ"},{name:"res_countryName_Laos_Democratic_Peoples_Republic",code:"LA"},{name:"res_countryName_Lebanon",code:"LB"},{name:"res_countryName_Saint_Lucia",code:"LC"},{name:"res_countryName_Liechtenstein",code:"LI"},{name:"res_countryName_Sri_Lanka",code:"LK"},{name:"res_countryName_Liberia",code:"LR"},{name:"res_countryName_Lesotho",code:"LS"},{name:"res_countryName_Lithuania",code:"LT"},{name:"res_countryName_Luxembourg",code:"LU"},{name:"res_countryName_Latvia",code:"LV"},{name:"res_countryName_Libya_Libyan_Arabian_Dschamahirija",code:"LY"},{name:"res_countryName_Morocco",code:"MA"},{name:"res_countryName_Monaco",code:"MC"},{name:"res_countryName_Moldova_Republic",code:"MD"},{name:"res_countryName_Montenegro",code:"ME"},{name:"res_countryName_Madagascar",code:"MG"},{name:"res_countryName_Marshall_Islands",code:"MH"},{name:"res_countryName_Mazedonia_former_Rep_of_Yugoslavia",code:"MK"},{name:"res_countryName_Mali",code:"ML"},{name:"res_countryName_Myanmar_Burma",code:"MM"},{name:"res_countryName_Mongolia",code:"MN"},{name:"res_countryName_Macau",code:"MO"},{name:"res_countryName_Northern_Marians",code:"MP"},{name:"res_countryName_Martinique",code:"MQ"},{name:"res_countryName_Mauretania",code:"MR"},{name:"res_countryName_Montserrat",code:"MS"},{name:"res_countryName_Malta",code:"MT"},{name:"res_countryName_Mauritius",code:"MU"},{name:"res_countryName_Maledives",code:"MV"},{name:"res_countryName_Malawi",code:"MW"},{name:"res_countryName_Mexico",code:"MX"},{name:"res_countryName_Malaysia",code:"MY"},{name:"res_countryName_Mozambique",code:"MZ"},{name:"res_countryName_Namibia",code:"NA"},{name:"res_countryName_New_Caledonia",code:"NC"},{name:"res_countryName_Niger",code:"NE"},{name:"res_countryName_Norfolk_Islands",code:"NF"},{name:"res_countryName_Nigeria",code:"NG"},{name:"res_countryName_Nicaragua",code:"NI"},{name:"res_countryName_Netherlands",code:"NL"},{name:"res_countryName_Norway",code:"NO"},{name:"res_countryName_Nepal",code:"NP"},{name:"res_countryName_Nauru",code:"NR"},{name:"res_countryName_New_Zealand",code:"NZ"},{name:"res_countryName_Oman",code:"OM"},{name:"res_countryName_Panama",code:"PA"},{name:"res_countryName_Peru",code:"PE"},{name:"res_countryName_French_Polynesia",code:"PF"},{name:"res_countryName_Papua_New_Guinea",code:"PG"},{name:"res_countryName_Philippines",code:"PH"},{name:"res_countryName_Pakistan",code:"PK"},{name:"res_countryName_Poland",code:"PL"},{name:"res_countryName_Saint_Pierre_and_Miquelon",code:"PM"},{name:"res_countryName_Pitcairn_Island",code:"PN"},{name:"res_countryName_Puerto_Rico",code:"PR"},{name:"res_countryName_Palestine_regions_occupied",code:"PS"},{name:"res_countryName_Portugal",code:"PT"},{name:"res_countryName_Palau",code:"PW"},{name:"res_countryName_Paraguay",code:"PY"},{name:"res_countryName_Quatar",code:"QA"},{name:"res_countryName_Reunion",code:"RE"},{name:"res_countryName_Romania",code:"RO"},{name:"res_countryName_Russian_Federation",code:"RU"},{name:"res_countryName_Rwanda",code:"RW"},{name:"res_countryName_Saudi_Arabia",code:"SA"},{name:"res_countryName_Solomonen",code:"SB"},{name:"res_countryName_Seychelles",code:"SC"},{name:"res_countryName_Sudan",code:"SD"},{name:"res_countryName_Sweden",code:"SE"},{name:"res_countryName_Singapore",code:"SG"},{name:"res_countryName_Saint_Helena",code:"SH"},{name:"res_countryName_Slovenia",code:"SI"},{name:"res_countryName_Spitzbergen",code:"SJ"},{name:"res_countryName_Slovakia",code:"SK"},{name:"res_countryName_Sierra_Leone",code:"SL"},{name:"res_countryName_San_Marino",code:"SM"},{name:"res_countryName_Senegal",code:"SN"},{name:"res_countryName_Somalia",code:"SO"},{name:"res_countryName_Suriname",code:"SR"},{name:"res_countryName_South_Sudan_Republic_of",code:"SS"},{name:"res_countryName_Sao_Tome_and_Principe",code:"ST"},{name:"res_countryName_El_Salvador",code:"SV"},{name:"res_countryName_Syria_Arabian_Republic",code:"SY"},{name:"res_countryName_Swaziland",code:"SZ"},{name:"res_countryName_Turks_and_Caicos_Islands",code:"TC"},{name:"res_countryName_Chad",code:"TD"},{name:"res_countryName_Togo",code:"TG"},{name:"res_countryName_Thailand",code:"TH"},{name:"res_countryName_Tajikstan",code:"TJ"},{name:"res_countryName_Tokelau",code:"TK"},{name:"res_countryName_Timor_Leste",code:"TL"},{name:"res_countryName_Turkmenistan",code:"TM"},{name:"res_countryName_Tunisia",code:"TN"},{name:"res_countryName_Tonga",code:"TO"},{name:"res_countryName_Turkey",code:"TR"},{name:"res_countryName_Trinidad_and_Tobago",code:"TT"},{name:"res_countryName_Tuvalu",code:"TV"},{name:"res_countryName_Taiwan",code:"TW"},{name:"res_countryName_Tanzania_United_Republic",code:"TZ"},{name:"res_countryName_Ukraine",code:"UA"},{name:"res_countryName_Uganda",code:"UG"},{name:"res_countryName_Minor_American_Oversea_Islands",code:"UM"},{name:"res_countryName_United_States_of_America",code:"US"},{name:"res_countryName_Uruguay",code:"UY"},{name:"res_countryName_Uzbekistan",code:"UZ"},{name:"res_countryName_Vatican_City",code:"VA"},{name:"res_countryName_Saint_Vincent_and_Grenadines",code:"VC"},{name:"res_countryName_Venezuela",code:"VE"},{name:"res_countryName_British_Virgin_Islands",code:"VG"},{name:"res_countryName_American_Virgin_Islands",code:"VI"},{name:"res_countryName_Vietnam",code:"VN"},{name:"res_countryName_Vanuatu",code:"VU"},{name:"res_countryName_Wallis_and_Futuna",code:"WF"},{name:"res_countryName_Samoa",code:"WS"},{name:"res_countryName_Kosovo",code:"XK"},{name:"res_countryName_Serbia",code:"XS"},{name:"res_countryName_Yemen",code:"YE"},{name:"res_countryName_Mayotte",code:"YT"},{name:"res_countryName_South_Africa",code:"ZA"},{name:"res_countryName_Zambia",code:"ZM"},{name:"res_countryName_Zimbabwe",code:"ZW"}],T.CountryCodeToCountryNameResourceMap={},T.CountriesArray.forEach(function(e){T.CountryCodeToCountryNameResourceMap[e.code]=e.name}),T.getCircuitRelativeLink=function(e,t){if(!t)return"";if(e=e||p(),a.isElectron&&0===t.search(/^file:\/\/\S+?\.html#\/\S+?$/i))return"#"+t.split("#")[1];if(t.startsWith("#/"))return t;if(T.PROTOCOL_PATTERN.exec(e)||(e=u+e),e.endsWith("/")||(e+="/"),T.PROTOCOL_PATTERN.exec(t)||(t=t.startsWith(E)?t.replace(E,u):u+t),!t.startsWith(e)){var n=u+"partner.",i=e.startsWith(n)?e.replace(n,u):e.replace(u,n);t.startsWith(i)&&(t=t.replace(i,e))}if(t.length>e.length&&t.startsWith(e)){var r=t.slice(e.length),o=r.match(T.CIRCUIT_CONVERSATION_HASH_PATTERN);return o?o[0].replace(/\/(muted|open)/gim,"/conversation"):(o=r.match(T.CIRCUIT_SPACE_HASH_PATTERN))?o[0]:(o=r.match(T.CIRCUIT_LINKS_HASH_PATTERN)||r.match(T.CIRCUIT_EMAIL_HASH_PATTERN)||r.match(T.CIRCUIT_HASH_TAG_SEARCH_PATTERN))&&o[0]}return""},T.isCircuitLink=function(e,t){return!!T.getCircuitRelativeLink(e,t)},T.throttle=function(n,i,r){var o,a,s,c=null,l=0;r=r||{};function d(){l=!1===r.leading?0:Date.now(),c=null,s=n.apply(o,a),o=a=null}return function(){var e=Date.now();l||!1!==r.leading||(l=e);var t=i-(e-l);return o=this,a=arguments,t<=0?(c&&(window.clearTimeout(c),c=null),l=e,s=n.apply(o,a),o=a=null):c||!1===r.trailing||(c=window.setTimeout(d,t)),s}},T.hasEmptyPrototype=function(e){return!(!e||"object"!=typeof e)&&T.isEmptyObject(Object.getPrototypeOf(e))},T.compareElements=function(e,t){if(e===t)return!0;if(!e||!t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;var i=t.slice();return e.every(function(n){return i.some(function(e,t){return!!T.compareElements(n,e)&&(i.splice(t,1),!0)})})}if(!T.hasEmptyPrototype(e)||!T.hasEmptyPrototype(t))return!1;for(var n in e)if(e.hasOwnProperty(n)&&0!==n.indexOf("$$")&&!T.compareElements(e[n],t[n]))return!1;return!0},T.copyToClipboard=function(e,t,n){var i,r,o,a,s;if(e)try{r=document.createRange(),i=window.getSelection(),a=document.body.style.overflow,s=this.getBrowserInfo().msie,o=n?document.createElement("textarea"):document.createElement("div"),n||(e=e.replace(/\r\n/gi,"<br>")),o.style.backgroundColor="#fff",o.style.font="normal normal 15px Calibri, sans-serif",o.style["white-space"]="pre-wrap",n?(o.value=e,o.setAttribute("readonly",""),o.style.position="absolute",o.style.left="-9999px",document.body.appendChild(o),i.removeAllRanges(),o.select(),o.setSelectionRange(0,e.length)):(o.innerHTML=e,document.body.appendChild(o),r.selectNode(o),i.removeAllRanges(),i.addRange(r)),s&&(document.body.style.overflow="hidden"),document.execCommand("copy")?t&&t():t&&t("Failed to copy")}catch(e){c.error("[Utils]: Copy to clipboard failed"),t&&t("Internal error")}finally{i&&("function"!=typeof i.removeRange||n?i.removeAllRanges():i.removeRange(r)),s&&(document.body.style.overflow=a),o&&document.body.removeChild(o)}},T.toCamelCase=function(e){if(!e||"string"!=typeof e)return"";for(var t=e.toLowerCase().split(/[_-]/),n=1;n<t.length;n++)t[n]=t[n].charAt(0).toUpperCase()+t[n].slice(1);return t.join("")},T.sslProxify=function(e,t){return e&&!T.PROTOCOL_PATTERN.exec(e)&&(e=e.startsWith("//")?e.replace("//",t):t+e),e&&e.startsWith("http://")?"https://embed-proxy.circuitsandbox.net/?target="+encodeURIComponent(e):e},T.parsePreviewObject=function(e,t){var n=T.PROTOCOL_PATTERN.test(e)?e:"http://"+e,i={preview:{type:t.type,title:t.title||"",description:t.description||"",provider:t.provider_name||"",srcURL:e,previewURL:n,imageURI:t.thumbnail_url}};switch(i.previewImageURISecure=T.sslProxify(i.preview.imageURI,T.getUrlProtocol(n)),t.type){case"photo":i.previewImageURISecure=T.sslProxify(e,T.getUrlProtocol(e));break;case"video":i.preview.html=t.html;break;case"rich":i.preview.type="link"}return i},T.appIsFocused=function(){if(a.isElectron){var e=t.getCurrentWindow();return e.isFocused()&&e.isVisible()&&!e.isMinimized()}return!0!==document.hidden},T.validatePreviewProtocol=function(e){return e?e.match(/https:/)?e:e.replace('src="//','src="https://'):""},T.getUrlProtocol=function(e){return e&&T.PROTOCOL_PATTERN.exec(e)?e.split("/")[0]+"//":"http://"},T.TabSelector=function(e){if(Array.isArray(e)&&0!==e.length){var n=this,i={},r="";e.forEach(function(t,e){0===e?(i[t]=!0,r=t):i[t]=!1,Object.defineProperty(n,t,{get:function(){return i[t]},set:function(e){e&&(Object.keys(i).forEach(function(e){i[e]=!1}),i[t]=!0,r=t)},enumerable:!0,configurable:!1})}),Object.defineProperty(this,"selected",{get:function(){return r},enumerable:!0,configurable:!1}),Object.defineProperty(this,"selectedIdx",{get:function(){return e.indexOf(r)},enumerable:!0,configurable:!1})}},T.getOrigin=p,T.parseQS=function(e){var t={};e=e.substring(1);for(var n=/([^&=]+)=([^&]*)/g,i=n.exec(e);i;)t[decodeURIComponent(i[1])]=decodeURIComponent(i[2]),i=n.exec(e);return t},T.toQS=function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)&&void 0!==e[n]){var i=e[n];Array.isArray(i)?i.forEach(function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}return t.join("&")},T.extractConfigurableText=function(e,t,n){var i=e&&e.find(function(e){return e.type===t});if(!i||!i.texts)return"";function r(t){return i.texts.find(function(e){return e.language===t})}var o;return n&&((o=r(n))||(o=r(n=n.split("-",1)[0]))),o||(o=r("default")),o&&o.translation},T.selectMediaDevice=function(e,t,n){return e&&t?(t.some(function(t){return!!(i=void 0===t.id?t:e.find(function(e){return t.id===e.id}))}),!i&&n&&t.some(function(t){return!!(i=e.find(function(e){return t.label===e.label}))}),i):null;var i},T.removeArrayElement=function(e,t){if(Array.isArray(e)&&void 0!==t&&t){var n=e.indexOf(t);-1<n&&e.splice(n,1)}},T.binaryInsert=function(e,t,n,i){return function e(t,n,i,r,o,a){if(!n||!Array.isArray(t))return-1;if(0===t.length)return t.push(n),0;if(o=o||0,(a=a||t.length-1)-o<=1)return i(n,t[o])<0?(t.splice(o,0,n),o):0<i(n,t[a])?(t.splice(a+1,0,n),a+1):n[r]===t[o][r]?(t[o]=n,o):(n[r]===t[a][r]?t[a]=n:t.splice(a,0,n),a);var s=Math.floor((a-o)/2)+o;return i(n,t[s])<0?e(t,n,i,r,o,s):e(t,n,i,r,s,a)}(e,t,n,i||"id")},T.isEmptyArray=function(e){return 0===e.length},T.lastArrayElement=function(e){if(0<e.length)return e[e.length-1]},T.shuffleArray=function(e){if(e.length)for(var t=e.length,n=0;n<t;n++){var i=Math.floor(Math.random()*t),r=e[i];e[i]=e[n],e[n]=r}return e},T.randomArrayCopy=function(e,t){if(Array.isArray(e)){var n=e.slice(0);return T.shuffleArray(n),n.splice(0,t)}return null},T.moveArrayElement=function(e,t,n){if(!("number"!=typeof t||"number"!=typeof n||t<0||t>=e.length||n<0||t===n)){for(var i=e.length;i<=n;i++)e.push(void 0);e.splice(n,0,e.splice(t,1)[0])}},T.emptyArray=function(e){if(e.length)for(;0<e.length;)e.pop()},T.getAvatarImageFormat=function(e){return/[\w]+:[\w]+\/png/.exec(e)?"png":"jpeg"},T.displayNameToInitials=function(e){if(!e)return"";var t=e.indexOf("@"),n=0<=t?e.slice(0,t).split("."):e.split(/[ ]+/);return((n[0][0]||"")+(n[1]&&n[1][0]||"")).toUpperCase()};var s,S,I=["pdf","doc","xls","ppt","html","csv","jpg","png","zip","log","video","audio"];function A(e){return"function"==typeof e||"[object Function]"===s.call(e)}function R(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(0<t?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),S)}T.getIconFile=function(e){return I.includes(e)?"icon-file-"+e:"icon-file-generic"},"function"!=typeof Object.values&&(Object.values=function(t){return Object.keys(t).map(function(e){return t[e]})}),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return null!=e&&(e=e.toString(),t=Math.floor(t)||0,this.substr(t,e.length)===e)}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){return null!=e&&(t=void 0===t?this.length:Math.min(Math.floor(t)||0,this.length),!((t-=(e=e.toString()).length)<0)&&this.substr(t,e.length)===e)}}),String.prototype.includes||Object.defineProperty(String.prototype,"includes",{value:function(e){return-1!==this.indexOf(e)}}),String.prototype.repeat||Object.defineProperty(String.prototype,"repeat",{value:function(e){if(null===this)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0===t.length||0===e)return"";if(1<<28<=t.length*e)throw new RangeError("repeat count must not overflow maximum string size");for(var n="",i=0;i<e;i++)n+=t;return n}}),Object.defineProperty(String.prototype,"format",{value:function(){var n=arguments;return this.replace(/{(\d+)}/g,function(e,t){return null!=n[t]?n[t]:e})}}),Object.defineProperty(String.prototype,"replaceAt",{value:function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)}}),Object.defineProperty(String.prototype,"randomCharacter",{value:function(){return this[Math.floor(this.length*Math.random())]}}),Array.from||(Array.from=(s=Object.prototype.toString,S=Math.pow(2,53)-1,function(e,t,n){var i=Object(e);if(null===e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var r,o=1<arguments.length?t:void 0;if(void 0!==o){if(!A(o))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(r=n)}for(var a,s=R(i.length),c=A(this)?Object(new this(s)):new Array(s),l=0;l<s;)a=i[l],c[l]=o?void 0===r?o(a,l):o.call(r,a,l):a,l+=1;return c.length=s,c})),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e){return-1!==this.indexOf(e)}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return t}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return o;return-1}}),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},RegExp.escape=function(e){return e?e.replace(/[.*+?|()[\]{}\\$^]/g,"\\$&"):""},Date.prototype.moveToEndOfDay=function(){return this.set({hour:23,minute:59,second:59})},Date.prototype.moveToFirstDayOfYear=function(){return this.set({day:1,month:0})},Date.prototype.moveToLastDayOfYear=function(){return this.set({month:11}).moveToLastDayOfMonth()};var f={format:function(e,t){if("undefined"!=typeof PhoneNumberUtil&&e&&"+"===e.charAt(0))try{var n=e.match(T.PHONE_DIAL_WITH_PIN_PATTERN),i="";n&&(e=n[1],i=t?"":n[2]);var r=PhoneNumberUtil.parseAndKeepRawInput(e,null);e=PhoneNumberUtil.formatInternational(r)+i}catch(e){}return e}};return a.Utils=T,a.PhoneNumberFormatter=f,a}((Circuit=function(e){"use strict";var t={SIGNATURE:"ansibleChromeExtensionSignature"};return t.DOMEvent=Object.freeze({TO_EXTENSION:"toExtension",FROM_EXTENSION:"fromExtension"}),t.BgMsgType=Object.freeze({REQUEST:"request",RESPONSE:"response",EVENT:"event"}),t.BgTarget=Object.freeze({INTERNAL:"internal",LOG:"log",SCREEN_SHARE:"screenShare",EXCHANGE_CONNECTOR:"exchange_connector",HEADSET_APP:"headsetAppManager",PRIVACY_SETTINGS:"privacySettings"}),t.ResponseError=Object.freeze({UNREGISTERED:"unregistered",TIMEOUT:"timeout",UNSUPPORTED_REQUEST:"unsupportedRequest",INTERNAL_ERROR:"internalError"}),t.BgLogMsgType=Object.freeze({LOG:"log"}),t.BgInternalMsgType=Object.freeze({INIT_MSG:"initMsg",INIT_MSG_ACK:"initMsgAck",INJECT_SIGNATURE:"injectChromeAppSignature",IS_ALIVE:"isAlive",GET_WINDOW_SIZE:"getWindowSize",EXTENSION_DISCONNECTED:"extensionDisconnected",BRING_TO_FRONT:"bringToFront",GET_FILE:"getFile"}),t.BgScreenShareMsgType=Object.freeze({CHOOSE_DESKTOP_MEDIA:"cdm",CHOOSE_DESKTOP_MEDIA_DONE:"cdmDone",CHOOSE_DESKTOP_MEDIA_CANCELLED:"cdmCancelled"}),t.BgPrivacySettingsMsgType=Object.freeze({SET_IP_HANDLING_POLICY:"setWebRTCIPHandlingPolicy",GET_IP_HANDLING_POLICY:"getWebRTCIPHandlingPolicy",IP_HANDLING_POLICY_CHANGED:"webRTCIPHandlingPolicyChanged"}),t.BgPrivacySettingsError=Object.freeze({NOT_AUTHORIZED:"notAuthorized",NOT_CONTROLLABLE:"notControllable",CONTROLLED_BY_OTHER_EXTENSIONS:"controlledByOtherExtensions"}),t.BgExchangeMsgType=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",SEARCH_CONTACTS:"searchContacts",AUTODISCOVER_GET_SERVER:"autodiscoverGetServer",GET_CONNECTION_STATUS:"getConnectionStatus",GET_CAPABILITIES:"getCapabilities",GET_CONTACT:"getContact",STORE_EXCH_CREDENTIALS:"storeCredentials",CONNECTION_STATUS:"connectionStatus",GET_ALL_PERSONAL_CONTACTS:"getAllPersonalContacts",CONTACT_FOLDERS_SYNC_STATE:"contactFoldersSyncState",SYNC_ALL_PERSONAL_CONTACTS:"syncAllPersonalContacts",GET_APPOINTMENTS:"getAppointments",GET_STORED_CREDENTIALS:"getStoredCredentials",GET_RENEWED_TOKEN:"getRenewedToken",ON_RENEWED_TOKEN:"onRenewedToken",GET_OOO_MSG:"getOooMsg",GET_USER_AVAILABILITY:"getUserAvailability"}),t.BgHeadsetAppMsgType=Object.freeze({GET_HEADSET_APP_STATUS:"getHeadsetAppStatus",LAUNCH_HEADSET_APP:"launchHeadsetApp",HEADSET_APP_LAUNCHED:"headsetAppLaunched",HEADSET_APP_UNINSTALLED:"headsetAppUninstalled",RESTART_HEADSET_APP:"restartHeadsetApp"}),t.ExchangeConnResponse=Object.freeze({OK:"ok",NO_RESULT:"noResult",FAILED:"failed",COULD_NOT_CONNECT:"couldNotConnect",UNAUTHORIZED:"unauthorized",UNSUPPORTED_METHOD:"unsupportedMethod",TIMED_OUT:"timedOut",MAILBOX_NOT_FOUND:"mailboxNotFound",NTLM_NOT_SUPPORTED:"ntlmNotSupported"}),t.HeadsetAppStatus=Object.freeze({NO_MANAGEMENT_PERMISSION:"noManagementPermission",NOT_INSTALLED:"notInstalled",INSTALLED:"installed",DISABLED:"disabled",UNKNOWN:"unknown"}),t.Exchange=Object.freeze({CONFIGURED_PASSWORD_MASKED:"$$$$"}),t.PortMsg=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",MSG:"msg"}),e.ChromeExtension=t,"undefined"!=typeof module&&module.exports&&(module.exports=t),e}((Circuit=function(e){"use strict";var n=null;try{n=window.localStorage||n}catch(e){n=window.sessionStorage||n}function i(e,t){try{return n?n[e].apply(n,t):null}catch(e){return null}}var t={getItem:function(e){return i("getItem",[e])},setItem:function(e,t){return i("setItem",[e,t])},removeItem:function(e){return i("removeItem",[e])}};return e.storeManager=t,e}((Circuit=function(e){"use strict";return e.Error=function(e,t){this.code=e||"UNEXPECTED_ERROR","string"==typeof t?this.message=t:"object"==typeof t&&(this.errObj=t).info&&!t.message&&(t.message=t.info),this.stack=Error().stack},e.Error.prototype=Object.create(Error.prototype),e.Error.prototype.name="Error",e}((Circuit=function(e){"use strict";var n=Object.freeze({Debug:1,Info:2,Warning:3,Error:4,Off:5}),i=n.Warning,t="undefined"!=typeof _circuitLogger?_circuitLogger:{setLevel:function(e){i=e},getLevel:function(){return i},debug:function(){i<=n.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},info:function(){i<=n.Info&&console.info.apply(console,Array.prototype.slice.apply(arguments))},warning:function(){i<=n.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},warn:function(){i<=n.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},error:function(e,t){i<=n.Error&&(e=e&&e.stack||e,(t=t&&t.stack||t)?console.error(e,t):console.error(e))},msgSend:function(){i<=n.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},msgRcvd:function(){i<=n.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},logMsg:function(e,t,n){switch(e.name){case"DEBUG":this.debug(t,n);break;case"INFO":this.info(t,n);break;case"WARN":case"WARNING":case"ERROR":this.info(t,n);break;default:this.debug(t,n)}},setExtensionVersion:function(e){console.log("ExtensionVersion = "+e)}};return e.logger=t,e.Enums=e.Enums||{},e.Enums.LogLevel=n,e}((Circuit=function(e){"use strict";e.isSDK=!0;var t={name:"unknown"};return"undefined"!=typeof process?process.versions&&process.versions.node?t={name:"node",version:process.versions.node,hostname:require("os").hostname()}:process.argv&&process.argv[0]&&(t={name:process.argv[0]}):t={name:"browser"},window.setTimeout=window.setTimeout||setTimeout,window.clearTimeout=window.clearTimeout||clearTimeout,window.setInterval=window.setInterval||setInterval,window.clearInterval=window.clearInterval||clearInterval,window.location||(window.location={host:t.hostname}),navigator.platform||(navigator.platform=t.name),navigator.userAgent||(navigator.userAgent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36"),window.navigator||(window.navigator=navigator),window.btoa||(window.btoa=function(e){return new Buffer(e).toString("base64")}),e._runtime=t,e.DefaultAvatars={},e}(Circuit||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{});
return Circuit;

}));
