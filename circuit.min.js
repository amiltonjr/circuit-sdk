(function (root, factory) {
  if (root === undefined && window !== undefined) root = window;
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module unless amdModuleId is set
    define([], function () {
      return (root['Circuit'] = factory());
    });
  } else if (typeof module === 'object' && module.exports) {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory();
  } else {
    root['Circuit'] = factory();
  }
}(this, function () {

/**
 *  Copyright 2019 Unify Software and Solutions GmbH & Co.KG.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  @version: 1.2.5603
 */

var Circuit = {}; Object.defineProperty(Circuit, 'version', { value: '1.2.5603'});


!function(e,t){void 0===e&&void 0!==window&&(e=window),"function"==typeof define&&define.amd?define([],function(){return e.Circuit=t()}):"object"==typeof module&&module.exports?module.exports=t():e.Circuit=t()}(this,function(){var e={};Object.defineProperty(e,"version",{value:"1.2.5603"});var t=Function("return this")(),n=t.window||t,i=t.navigator||n.navigator||{},r=n.document,o=t.WebSocket,a=t.XMLHttpRequest,s=t.Promise;return e=function(t){"use strict";var i=t.Enums.ConnectionState,r=t.Enums.ConversationType,o=t.Constants,c=t.logger,l=t.PrivateData,d=t.Enums.Targets,u=t.Enums.VideoResolutionLevel,C=t.Utils,E="tHuMbNaIl___";function T(){if(n.frameElement&&n.parent)n.parent.document.body.removeChild(n.frameElement);else try{n.close()}catch(e){}}!function(e,t){if(e.location.hash||e.location.search){var n=Object.assign({},C.parseQS(e.location.hash),C.parseQS(e.location.search));if(n.state)try{Object.assign(n,JSON.parse(n.state))}catch(e){c.error("Could not decode state parameter")}if(n.display&&"popup"===n.display&&n.redirect_uri===e.location.origin+e.location.pathname&&e.document.addEventListener("DOMContentLoaded",function(){e.document.body.innerHTML="Redirecting, please wait..."}),n.callback){var i=n.callback;if(i in t)try{delete n.callback,t[i](n)}catch(e){}}n.display&&"popup"===n.display&&T()}}(n,n.opener||n.parent);var p=C.getBrowserInfo();return t.ExtensionConnHandlerSingleton.getInstance(),t.Client=function(T){t.BaseEventTarget.call(this,t.logger);var p=this,S=t.Enums.ConnectionState.Disconnected,I=C.shallowCopy(T)||{};I.domain=I.domain||"circuitsandbox.net",I.emoticonMode=I.emoticonMode||"standard",F(T);var f,R,v,A,g,_,N="node"===n.navigator.platform,m="dotnet"===n.navigator.platform,h="Win32"===n.navigator.platform,O="iOS"===n.navigator.platform||"Android"===n.navigator.platform,D=[],y=!1,P=null,b=new t.ClientApiHandler(I),U=new t.UserToUserHandler(b),L=t.RtcSessionController;p._clientApiHandler=b,p._userToUserHandler=U,p._rtcSessionController=L;var M=new t.SdkServices(b,U);function w(e,t,n,i){if(e===o.ReturnCode.NO_RESULT&&n)return!1;if(e){var r=b.getLastError();return i&&i(r),r&&delete r.errObj,t(r),!0}return!1}function G(t,n){return!!t&&(n(new e.Error(o.ReturnCode.SDK_ERROR,t)),!0)}function H(){return"https://"+p.domain+"/"}function k(e,t,i){var r,o={};return o.width=t,o.height=i,o.left=n.screenX+(n.outerWidth-t)/2,o.top=n.screenY+(n.outerHeight-i)/2,o.scrollbars="yes",r=Object.keys(o).map(function(e){return e+"="+o[e]}).join(", "),n.open(e,o.name,r)}function V(e){return I.scope.split(",").indexOf(e)>=0||I.scope.split(",").indexOf("ALL")>=0}function F(e){e=e||{},I.client_id=e.client_id,I.client_secret=e.client_secret,I.redirect_uri=e.redirect_uri||n.location.origin+n.location.pathname,I.scope=(e.scope?e.scope.replace(/\s+/g,""):"")||"ALL",V(o.OAuthScope.READ_USER_PROFILE)||(I.scope=o.OAuthScope.READ_USER_PROFILE+","+e.scope),V(o.OAuthScope.ALL)&&(I.scope=o.OAuthScope.ALL)}function B(t){return new s(function(n,i){var r,s=N?new a(I):new a;if(s.open(t.type||t.dataType||"GET",t.url,!0),s.withCredentials=t.xhrFields&&t.xhrFields.withCredentials,!f||t.headers&&t.headers.Authorization||s.setRequestHeader("Authorization","Bearer "+f),t.headers)for(var c in t.headers)t.headers.hasOwnProperty(c)&&s.setRequestHeader(c,t.headers[c]);s.onload=function(){if(200===s.status)t.success&&t.success(s.responseText),n(s.responseText);else{var r=new e.Error(s.status,s.responseText||s.statusText);t.error&&t.error(r),i(r)}},s.onerror=function(){var n=new e.Error(o.ErrorCode.AUTHORIZATION_FAILED,"Network error or incorrect credentials");t.error&&t.error(n),i(n)},t.data&&(r=C.toQS(t.data),s.setRequestHeader("Content-type","application/x-www-form-urlencoded")),s.send(r)})}function x(e){return new s(function(t,n){B({type:"POST",url:"https://"+p.domain+"/sdklogin",data:{token:e.token||void 0,accessToken:e.accessToken||void 0},xhrFields:{withCredentials:!0},crossDomain:!0}).then(function(){e.accessToken&&(f=e.accessToken),t()}).catch(n)})}function W(){return B({url:"https://"+p.domain+"/validateSession",xhrFields:{withCredentials:!0},crossDomain:!0}).then(function(){})}function Y(){switch(n.navigator.platform){case"node":return"NODE_SDK";case"dotnet":return"DOT_NET_SDK";case"Win32":return"WIN_JS_SDK";case"iOS":return"IOS_SDK";case"Android":return"ANDROID_SDK";default:return"JS_SDK"}}function K(){return new s(function(t,i){if(I.client_id)if(n.localStorage){var r=n.localStorage.getItem("oauth");try{r=JSON.parse(r)}catch(t){return n.localStorage.removeItem("oauth"),void i(new e.Error(o.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}r&&"object"==typeof r||(r={}),r[I.client_id]={access_token:f,domain:p.domain,expires_at:R},n.localStorage.setItem("oauth",JSON.stringify(r)),c.debug("[SDK]: Stored access_token for client_id: "+I.client_id),t()}else t();else i(new e.Error(o.ReturnCode.SDK_ERROR,"client_id missing in client object"))})}function q(){return new s(function(t,i){var r=n.localStorage.getItem("oauth");if(r){try{r=JSON.parse(r)}catch(t){return void i(new e.Error(o.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}if("object"==typeof r){var a=r[I.client_id];a&&a.access_token?(f=a.access_token,R=a.expires_at,c.debug("[SDK]: Retrieved access_token for client_id: "+I.client_id),t(f)):i(new e.Error(o.ReturnCode.SDK_ERROR,"client_id not found in localStorage"))}else i(new e.Error(o.ReturnCode.SDK_ERROR,"invalid data in localStorage"))}else i(new e.Error(o.ReturnCode.SDK_ERROR,"OAuth access token not found in localStorage"))})}function j(e){var t="_circuit_"+parseInt(1e12*Math.random(),10).toString(36);return n[t]=function(){try{e.apply(this,arguments)&&delete n[t]}catch(e){c.error(e)}},t}function Q(){return new s(function(t,i){var r=null;if(!I.client_id)return p.oauthwin&&(p.oauthwin.close(),p.oauthwin=null),void i(new e.Error(o.ReturnCode.SDK_ERROR,"client_id missing in client object"));f=void 0;var a=j(function(a){if(r&&n.clearInterval(r),!a||a.error){f=void 0;var s=a?a.error:"The authentication was not completed";i(new e.Error(o.ReturnCode.SDK_ERROR,s))}else f=a.access_token,R=a.expires_in&&Date.now()+1e3*a.expires_in,K().catch(function(e){c.error("[SDK]: Failed to store the OAuth access token.",e)}).then(function(){t({username:a.username,accessToken:a.access_token})})}),s={client_id:I.client_id,redirect_uri:I.redirect_uri,response_type:"token",scope:I.scope||""};s.state=JSON.stringify({callback:a,display:"popup",redirect_uri:s.redirect_uri});var l="https://"+I.domain+"/oauth/authorize?"+C.toQS(s),d=p.oauthwin||k(l,450,520);d?(p.oauthwin=null,n.setTimeout(function(){d.location.href=l},500),r=n.setInterval(function(){d&&!d.closed||(r&&n.clearInterval(r),i(new e.Error(o.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)):i(new e.Error(o.ErrorCode.SDK_ERROR,"OAuth popup blocked"))})}function z(){return new s(function(t,i){var r=null,a=j(function(a){if(r&&n.clearInterval(r),!a||a.error){var s=a?a.error:"The authentication was not completed";i(new e.Error(o.ReturnCode.SDK_ERROR,s))}else t({username:a.username})}),s=JSON.stringify({callback:a,display:"popup",redirect_uri:I.redirect_uri}),c={return_to:I.redirect_uri+"#state="+s},l="https://"+I.domain+"/oauth/login?"+C.toQS(c),d=p.oauthwin||k(l,450,520);p.oauthwin=null,n.setTimeout(function(){d.location.href=l},500),r=n.setInterval(function(){d&&!d.closed||(r&&n.clearInterval(r),i(new e.Error(o.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)})}function X(t){return t=t||f,B({type:"GET",url:"https://"+p.domain+"/oauth/token/"+t,crossDomain:!0}).then(function(t){try{return JSON.parse(t)}catch(t){return s.reject(new e.Error(o.ReturnCode.SDK_ERROR,"Invalid token returned"))}})}function J(){if(I.client_secret&&I.autoRenewToken&&R){v&&n.clearTimeout(v);var e=R-Date.now()-6e4;(e=Math.min(2147483648,e))>0&&(v=n.setTimeout($,e))}}function $(){return new s(function(t,i){var r={type:"POST",url:"https://"+p.domain+"/oauth/token",data:{scope:I.scope,grant_type:"implicit"}};I.client_secret&&(r.headers={Authorization:"Basic "+n.btoa(I.client_id+":"+I.client_secret)},r.data.grant_type="client_credentials"),B(r).then(function(n){var r=JSON.parse(n);if(r&&r.access_token&&"Bearer"===r.token_type)f=r.access_token,b.setToken(f),R=r.expires_in&&Date.now()+1e3*r.expires_in,J(),Be({type:"accessTokenRenewed"}),t(f);else{f=null,R=null;var a=new e.Error(o.ReturnCode.SDK_ERROR,"Error renewing OAuth2 access token");Be({type:"renewAccessTokenFailed",error:a}),i(a)}}).catch(i)})}function Z(){return new s(function(e,t){var n=[o.GetStuffType.USER,o.GetStuffType.SUPPORT_CONVERSATION_ID,o.GetStuffType.TELEPHONY_CONVERSATION_ID,o.GetStuffType.ACCOUNTS,o.GetStuffType.PRESENCE_STATE];b.getStuff(n,function(n,i){w(n,t,!0)||(g=i.telephonyConvId,_=i.supportConvId,we(i.user).then(function(t){p.loggedOnUser=t,M.SdkHelperSvc.setLocalUser(t),e()}).catch(t))})})}function ee(){return V(o.OAuthScope.CALLS)?M.CallControlSvc.initActiveSessionsForSdk():s.resolve()}function te(){return V(o.OAuthScope.CALLS)&&I.enableTelephony&&M.AtcRegistrationSvc.initAtcForSdk(),s.resolve()}function ne(){return new s(function(e,t){b.getUserData(function(n,i){w(n,t)||(L.processClientSettings(i.clientSettings),e(i))})}).then(Z).then(ee).then(te)}function ie(){return new s(function(i,r){P&&(n.clearInterval(P),P=null,b.disconnect()),b.setToken(f),b.setClientInfo({deviceType:o.DeviceType.SDK,deviceSubtype:Y(),clientVersion:t.version}),b.connect(function(){c.info("[SDK]: Successfully connected to access server."),P=n.setInterval(xe,50),i()},function(t){c.error("[SDK]: Failed to connect: ",t),b.disconnect(),r(new e.Error(o.ReturnCode.SDK_ERROR,t))},p.domain)}).then(ne).then(function(){return p.loggedOnUser})}function re(){return new s(function(t,i){B({type:"POST",url:"https://"+p.domain+"/oauth/token",headers:{Authorization:"Basic "+n.btoa(I.client_id+":"+I.client_secret)},data:{grant_type:"client_credentials",scope:I.scope}}).then(function(n){var r=JSON.parse(n);r&&r.access_token&&"Bearer"===r.token_type?(f=r.access_token,R=r.expires_in&&Date.now()+1e3*r.expires_in,J(),t({accessToken:f})):(f=null,R=null,i(new e.Error(o.ReturnCode.SDK_ERROR,r&&r.error_description||"Internal error with Client Credentials Grant authentication")))}).catch(i)})}function oe(t){return new s(function(n,i){t&&t.filterConnector?(t.retrieveAction=t.retrieveAction||e.Enums.RetrieveAction.CONVERSATIONS,t.retrieveAction!==e.Enums.RetrieveAction.CONVERSATIONS&&t.retrieveAction!==e.Enums.RetrieveAction.CONVERSATION_IDS&&i(new e.Error(o.ReturnCode.SDK_ERROR,"Invalid retrieveAction")),b.getConversationsByFilter(t,function(r,o){if(!w(r,i,!0))if(t.retrieveAction===e.Enums.RetrieveAction.CONVERSATIONS){var a=o&&o.conversations||[];s.all(a.map(Ve)).then(n).catch(i)}else t.retrieveAction===e.Enums.RetrieveAction.CONVERSATION_IDS&&n(o.conversationIds||[])})):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"options.filterConnector"))})}function ae(e){return new s(function(t,n){b.getConversationById(e,function(e,i){w(e,n)||Ve(i).then(t).catch(n)})})}function se(e){return new s(function(t,n){b.getUserByEmail(e,function(e,i){w(e,n,null,function(e){e&&e.code===o.ReturnCode.NO_RESULT&&(e.info="User does not exist")})||we(i).then(t).catch(n)})})}function ce(){return new s(function(e,t){b.getDevices(function(n,i){w(n,t,!0)||e(i||[])})})}function le(e){return"string"==typeof e&&(e={userId:e,createIfNotExists:!1}),new s(function(t,n){e.userId?b.getConversationByUser(e.userId,function(i,r){i?i===o.ReturnCode.NO_RESULT?e.createIfNotExists?ue(e.userId).then(function(e){t(e&&e.conversation)}):t():w(i,n):Ve(r).then(t).catch(n)}):n(new Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"user ID is required"))})}function de(e,t){return"string"!=typeof e?s.reject(new Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"email or user ID is required")):e.match(C.EMAIL_ADDRESS_PATTERN)?se(e).then(function(e){return{userId:e.userId,createIfNotExists:t}}).then(le):le({userId:e,createIfNotExists:t})}function ue(t){return new s(function(n,i){if(p.loggedOnUser.userId!==t){var r={type:o.ConversationType.DIRECT,participants:[{userId:t},{userId:p.loggedOnUser.userId}]};b.createConversation(r,function(e,t,r){w(e,i)||Ve(t).then(function(e){n({conversation:e,alreadyExists:r})})})}else i(new e.Error(o.ReturnCode.SDK_ERROR,"userId is of logged on user"))})}function Ce(t,n){return new s(function(i,r){t?b.updateGuestAccess(t,n,function(e){w(e,r)||i()}):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function Ee(e){var t={};return e&&e.forEach(function(e){switch(e.key){case o.UserSettingKey.HIDE_PROFILE_EXTERNAL_ENABLED:t.hideProfileExternal=e.booleanValue;break;case o.UserSettingKey.OPT_OUT_PRESENCE:t.presenceOptOut=e.booleanValue;break;case o.UserSettingKey.SHARE_LOCATION:t.shareLocation=e.booleanValue;break;case o.UserSettingKey.VOICEMAIL_ENABLED:t.voicemailEnabled=e.booleanValue;break;case o.UserSettingKey.VOICEMAIL_TIMEOUT:t.voicemailTimeout=e.numberValue;break;case o.UserSettingKey.VOICEMAIL_CUSTOMGREETING_ENABLED:t.voicemailCustomGreetingEnabled=e.booleanValue;break;case o.UserSettingKey.VOICEMAIL_CUSTOMGREETING_URI:t.voicemailCustomGreetingUri=e.stringValue?H()+"fileapi?fileid="+e.stringValue:null}}),t}function Te(e){return new s(function(t,n){e.userId=p.loggedOnUser.userId,b.setPresence(e,function(e){w(e,n)||t()})})}function pe(e,t){return new s(function(n,i){b.getPresence(e,t,function(e,t){w(e,i)||n(t)})})}function Se(){return new s(function(e,t){b.renewToken(function(n){w(n,t)?Be({type:"renewSessionTokenFailed",error:n}):(c.debug("[SDK]: Session token renewed"),Be({type:"sessionTokenRenewed"}),e())})})}function Ie(e){return ce().then(function(t){return t.some(function(t){return e?t.clientId===e:t.clientId!==p.loggedOnUser.clientId&&(t.clientInfo.deviceType===o.DeviceType.WEB||t.clientInfo.deviceType===o.DeviceType.APPLICATION&&"DESKTOP_APP"===t.clientInfo.deviceSubtype)})})}function fe(e){return ce().then(function(t){return t.some(function(t){return t.clientId===e})})}function Re(e){var t=M.CallControlSvc.findCall(e);return t||((t=M.CallControlSvc.getActiveCall(e))||null)}function ve(e){return e.pin=e.tenantPIN+e.sessionPIN,e.link&&(e.link="https://"+p.domain+e.link),delete e.tenantPIN,delete e.sessionPIN,delete e.conversationId,e}function Ae(t){return new s(function(n,i){t?M.CallControlSvc.endCall(t,function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function ge(t,n){return new s(function(i,r){var o={VGA:"",HD:u.VIDEO_720,FHD:u.VIDEO_1080},a={audio:!1,video:e.WebRTCAdapter.getVideoOptions({sourceId:t,videoResolution:o[n]})};e.WebRTCAdapter.getUserMedia(a,function(t){e.WebRTCAdapter.stopMediaStream(t),i(n)},r)})}function _e(e,t){return function(n){var i=n&&n.name;return"ConstraintNotSatisfiedError"===i||"OverconstrainedError"===i?ge(e,t):s.reject(n)}}function Ne(t,n){return new s(function(i,r){if(t){var a=Re(t);if(a)if(a.hasLocalScreenShare())M.CallControlSvc.removeMediaStream(t,function(e){G(e,r)||i()});else{if(!n)return void r(new e.Error(o.ReturnCode.SDK_ERROR,"Missing MediaStream"));M.CallControlSvc.addMediaStream(t,n,function(e){G(e,r)||i()})}else r(new e.Error(o.ReturnCode.SDK_ERROR,"No call found"))}else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function me(t){return new s(function(n,i){if(void 0!==t){var r=M.CallControlSvc.getActiveCall();if(r){var a=r.sessionCtrl.getLocalStream(t);a?n(a):i("No stream found with id "+t)}else i(new e.Error(o.ReturnCode.SDK_ERROR,"No call found"))}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"id is required"))})}var he="/content/images/icon-general-default-avatar",Oe="/content/images/icon-general-openconvo-avatar",De="/content/images/icon-general-large-conference",ye="/content/images/icon-general-emptyconvo-avatar",Pe=["-blue","-green","-orange","-yellow"];function be(e){var t=0;if(e)for(var n=0;n<e.length;n++)t+=e.charCodeAt(n);return Pe[t%Pe.length]}function Ue(e,t){if("function"==typeof e)try{var n=e(t);if(n&&"object"==typeof n)return"function"==typeof n.then?n:s.resolve(n)}catch(e){c.error("[SDK]: Error applying injector. ",e)}return s.resolve(t)}var Le=["activeMediaType","callId","convId","convType","cstaCallId","direction","establishedTime","isMeetingPointInvited","isRemote","isTelephonyCall","isTestCall","locallyMuted","localMediaType","localVideoStream","localVideoUrl","localStreams","mediaType","participants","peerUser","remoteAudioDisabled","remoteAudioStream","remoteAudioUrl","remotelyMuted","remoteVideoDisabled","remoteVideoStreams","recording","ringAllAllowed","ringAllMaxNumber","whiteboardEnabled"];function Me(t){if(!t)return s.resolve();var n={};return Le.forEach(function(e){try{n[e]=t[e]}catch(e){}}),n.state=t.state.name,n.isEstablished=t.state.established,Ue(e.Injectors.callInjector,n)}function we(t){if(!t)return s.resolve();if(t.smallImageUri&&t.largeImageUri)t.avatar=H()+"fileapi/"+t.userId+"_s.jpg?fileid="+t.smallImageUri,t.avatarLarge=H()+"fileapi/"+t.userId+"_b.jpg?fileid="+t.largeImageUri,t.hasAvatar=!0;else{var n=be(t.userId);t.avatar="https://"+p.domain+he+n+".png",t.avatarLarge="https://"+p.domain+he+n+"-XL.png"}return delete t.smallImageUri,delete t.largeImageUri,delete t.tenantId,delete t.roles,delete t.accountTemplateType,delete t.associatedGTCUserId,delete t.reroutingPhoneNumber,delete t.assignedPhoneNumbers,t.accounts&&t.accounts.length&&(t.tenantId=t.accounts[0].tenantId),t.hasPermission=function(e){if(!this.accounts||!e)return!1;var t=this.accounts[0],n=t&&t.permissions;return!!n&&n.some(function(t){return t.systemPermission===e})},Ue(e.Injectors.userInjector,t)}function Ge(t){if(!t)return s.resolve();switch(t.type){case o.ConversationItemType.TEXT:t.text.state===o.TextItemState.DELETED?t.text.content="":(t.attachments=t.attachments||[],t.externalAttachments=t.externalAttachments||[],"standard"===I.emoticonMode&&(t.text.content=C.standardizeEmoticon(t.text.content)),l.retrievePrivateDataFromContent(t),!t.conceptboards||t.text.conceptboards&&t.text.conceptboards.length||(t.text.conceptboards=t.conceptboards),delete t.conceptboards,I.removeMentionHtml&&(t.text.content=C.removeMentionHtml(t.text.content)));break;case o.ConversationItemType.SYSTEM:t.system.affectedParticipants&&(t.system.affectedParticipants=t.system.affectedParticipants.map(function(e){return e.userId}))}return t.attachments&&t.attachments.length&&(t.attachments=t.attachments.filter(function(e){if(e.url=H()+"fileapi/"+encodeURIComponent(e.fileName)+"?fileid="+e.fileId+"&itemid="+e.itemId,e.fileName.startsWith(E)){var n=e.fileName.substring(E.length),i=t.attachments.find(function(e){return e.fileName===n});if(i)return i.thumbnailUrl=e.url,i.isImage=!0,!1}return!0})),Ue(e.Injectors.itemInjector,t)}function He(e){return new s(function(t){e&&e.topLevelItem?(c.debug("[SDK]: Publicize the topLevelItem. convId = ",e.convId),Ge(e.topLevelItem).then(function(){c.debug("[SDK]: Publicized topLevelItem. convId = ",e.convId),t(e)}).catch(function(n){c.error("[SDK]: Failed to publicize topLevelItem. ",n),t(e)})):t(e)})}function ke(e){return new s(function(t){if(e&&e.parentItem){c.debug("[SDK]: Publicize the thread. itemId = ",e.parentItem.intemId),e.comments=e.comments||[];var n=e.comments.slice(0);n.unshift(e.parentItem),s.all(n.map(Ge)).then(function(){t(e)}).catch(function(n){c.error("[SDK]: Failed to publicize thread. ",n),t(e)})}else t(e)})}function Ve(t){if(!t)return s.resolve();if(c.debug("[SDK]: Publicize conversation. convId = ",t.convId),t.participants=t.participants.map(function(e){return e.userId}),t.moderators=t.moderators&&t.moderators.map(function(e){return e.userId}),t.isTelephonyConversation=t.convId===g,t.isSupportConversation=t.convId===_,t.type!==o.ConversationType.DIRECT){if(t.conversationAvatar&&t.conversationAvatar.smallPictureId&&t.conversationAvatar.largePictureId)t.avatar=H()+"avatar?convId="+t.convId+"&type=small&fileid="+t.conversationAvatar.smallPictureId,t.avatarLarge=H()+"avatar?convId="+t.convId+"&type=large&fileid="+t.conversationAvatar.largePictureId,t.hasConversationAvatar=!0;else if(t.type===o.ConversationType.OPEN){var n=t.isDraft?"-grey":be(t.convId);t.avatar="https://"+p.domain+Oe+n+".png",t.avatarLarge="https://"+p.domain+Oe+n+"-XL.png"}else t.type===o.ConversationType.LARGE?(t.avatar="https://"+p.domain+De+".png",t.avatarLarge="https://"+p.domain+De+"-XL.png"):(t.avatar="https://"+p.domain+ye+".png",t.avatarLarge="https://"+p.domain+ye+"-XL.png");t.type===o.ConversationType.OPEN&&(t.type=r.COMMUNITY)}return Ue(e.Injectors.conversationInjector,t).then(He)}function Fe(t){if(!t)return s.resolve();if(t.smallImageUri&&t.largeImageUri)t.avatar=H()+"fileapi/"+t.userId+"_s.jpg?fileid="+t.smallImageUri,t.avatarLarge=H()+"fileapi/"+t.userId+"_b.jpg?fileid="+t.largeImageUri,t.hasAvatar=!0;else{var n=be(t.userId);t.avatar="https://"+p.domain+he+n+".png",t.avatarLarge="https://"+p.domain+he+n+"-XL.png"}return delete t.smallImageUri,delete t.largeImageUri,Ue(e.Injectors.participantInjector,t)}function Be(e){c.debug("[SDK]: Enqueue "+e.type),D.push(e)}function xe(){if(!y&&D.length){y=!0;try{var e=D.shift();if(c.debug("[SDK]: Dequeue "+e.type+". Events left in the queue: "+D.length),!p.hasEventListener(e.type))return void c.debug("[SDK]: There is no listener for this event");var t=[];t.push(e.user?we(e.user):void 0),t.push(e.item?Ge(e.item):void 0),t.push(e.conversation?Ve(e.conversation):void 0),t.push(e.call?Me(e.call):void 0),s.all(t).then(function(t){t[0]&&(e.user=t[0]),t[1]&&(e.item=t[1]),t[2]&&(e.conversation=t[2]),t[3]&&(e.call=t[3]),c.debug("[SDK]: Dispatch ",e.type),p.dispatch(e)})}catch(e){c.error("[SDK]: Error processing event queue. ",e)}finally{y=!1}}}return Object.defineProperty(p,"domain",{get:function(){return I.domain},set:function(e){I.domain=e},enumerable:!0,configurable:!1}),Object.defineProperty(p,"accessToken",{get:function(){return f},set:function(e){f=e},enumerable:!0,configurable:!0}),Object.defineProperty(p,"expiresAt",{get:function(){return R},enumerable:!0,configurable:!0}),Object.defineProperty(p,"connectionState",{get:function(){return S},enumerable:!0,configurable:!0}),Object.defineProperty(p,"getAudioVideoStats",{get:function(){var t=M.CallControlSvc.getActiveCall();if(!t)return function(){return s.reject(new e.Error(o.ReturnCode.SDK_ERROR,"No call found"))};var n=t.sessionCtrl.getCurrentPeerConnection();return n&&n.getStats?n.origGetStats?n.origGetStats.bind(n):n.getStats.bind(n):function(){return s.reject(new e.Error(o.ReturnCode.SDK_ERROR,"No PeerConnection present"))}},enumerable:!1,configurable:!1}),p.setOauthConfig=F,p.logon=function(t){var i,r,a,l;if(t){if("object"!=typeof t)return i="OAuth2 is the only supported authentication menthod. Basic Auth is not supported anymore.",c.error(i),s.reject(new e.Error(o.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+i));if(I.client_id&&I.client_secret)return i="Circuit.Client is created with client_id and client_secret (Client Credentials Grant), so no token should be passed to the logon API.",c.error(i),s.reject(new e.Error(o.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+i));if(I.client_id&&t.token)return i="Circuit.Client is created with client_id, so no API token should be passed to the logon API.",c.error(i),s.reject(new e.Error(o.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+i));if(!I.client_id&&!t.token)return i="Circuit.Client was not created with client_id, so API token should be passed to the logon API.",c.error(i),s.reject(new e.Error(o.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+i))}else if(!I.client_id)return i="Login with a session cookie has been disabled. OAuth2 or API token are the only supported authentication method.",c.error(i),s.reject(new e.Error(o.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+i));return I.client_id&&I.client_secret?re().then(x).then(ie):I.client_id&&t&&t.username&&t.password?(a=t.username,l=t.password,new s(function(t,i){B({type:"POST",url:"https://"+p.domain+"/oauth/token",headers:{Authorization:"Basic "+n.btoa(I.client_id)},data:{username:a,password:l,grant_type:"password",scope:I.scope}}).then(function(n){var r=JSON.parse(n);r&&r.access_token&&"Bearer"===r.token_type?(f=r.access_token,R=r.expires_in&&Date.now()+1e3*r.expires_in,J(),t({accessToken:f})):(f=null,R=null,i(new e.Error(o.ReturnCode.SDK_ERROR,"Internal error with Client Credentials Grant authentication")))}).catch(i)})).then(x).then(ie):I.client_id&&t&&t.accessToken?N||m||h||O||t.skipTokenValidation?x(t).then(ie):(t.prompt&&(r="https://"+I.domain+"/dist/oauthLoading.html",p.oauthwin=k(r,450,520)),f=t.accessToken,X().then(function(){return t.prompt?W().then(function(){p.oauthwin.close(),p.oauthwin=null}).catch(z).then(ie):ie()}).catch(function(e){return p.oauthwin&&p.oauthwin.close(),p.oauthwin=null,s.reject(e)})):I.client_id?p.logonChecked?ie():t&&t.logonChecked?q().then(X).then(W).then(ie):(r="https://"+I.domain+"/dist/oauthLoading.html",p.oauthwin=k(r,450,520),q().then(X).then(W).then(function(){p.oauthwin.close(),p.oauthwin=null}).catch(Q).then(ie)):t&&t.token?x(t).then(ie):s.reject(new e.Error(o.ErrorCode.MISSING_REQUIRED_PARAMETER,"Missing credentials"))},p.logonCheck=function(){return q().then(X).then(W).then(function(){p.logonChecked=!0,A&&n.clearTimeout(A),A=n.setTimeout(function(){A=null,p.logonChecked=!1},5e3)})},p.changePassword=function(){return new s(function(t,i){var r=null,a=j(function(a){if(r&&n.clearInterval(r),!a||a.error){var s=a?a.error:"The password change failed";i(new e.Error(o.ReturnCode.SDK_ERROR,s))}else t()}),s={client_id:I.client_id,redirect_uri:I.redirect_uri,response_type:"token",scope:I.scope||""};s.state=JSON.stringify({callback:a,display:"popup",redirect_uri:s.redirect_uri});var c="https://"+I.domain+"/oauth/changePassword?"+C.toQS(s),l=p.oauthwin||k(c,450,520);p.oauthwin=null,n.setTimeout(function(){l.location.href=c},500),r=n.setInterval(function(){l&&!l.closed||(r&&n.clearInterval(r),i(new e.Error(o.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)})},p.logout=function(e){return e?new s(function(e){var t=function(){f=null,R=null,b.disconnect(),n.clearInterval(P),p.dispatch({type:"connectionStateChanged",state:i.Disconnected}),e()},r=n.setTimeout(function(){r=null,t()},2e3);b.logout(function(){r&&(n.clearTimeout(r),t())})}):(f=null,R=null,b.disconnect(),s.resolve())},p.revokeToken=function(e){return new s(function(t,i){e=e||f,f=null,R=null,K();var r=n.setTimeout(function(){r=null,t()},2e3);b.revokeAccessToken(e,function(e){r&&(n.clearTimeout(r),e!==o.ReturnCode.DISCONNECTED&&w(e,i)||t())})})},p.setCookie=function(e){I.cookie=e},p.getCookie=function(){return I.cookie},p.isAuthenticated=W,p.validateToken=X,p.getLoggedOnUser=function(){return new s(function(e,t){b.getLoggedOnUser(function(n,i){w(n,t)||we(i.user).then(function(t){p.loggedOnUser=t,M.SdkHelperSvc.setLocalUser(t),e(t)})})})},p.getTelephonyConversationId=function(){return new s(function(e,t){b.getTelephonyConversationId(function(n,i){w(n,t)||e(i)})})},p.getSupportConversationId=function(){return new s(function(e,t){b.getSupportConversationId(function(n,i){w(n,t)||e(i)})})},p.getTenantUsers=function(e){return new s(function(t,n){(e=e||{}).pageSize=e.pageSize||25,e.sorting=e.sorting||o.GetAccountsSorting.BY_FIRST_NAME,b.getAccounts(e,function(e,i){w(e,n)||s.all(i.accounts.map(function(e){return we(e.user)})).then(t).catch(n)})})},p.getAccounts=function(e){return new s(function(t,n){(e=e||{}).pageSize=e.pageSize||25,e.sorting=e.sorting||o.GetAccountsSorting.BY_FIRST_NAME,b.getAccounts(e,function(e,i){w(e,n)||s.all(i.accounts.map(function(e){return we(e.user)})).then(function(e){var n=i.accounts.map(function(t,n){return{account:t.account,user:e[n]}});t({accounts:n,searchPointer:i.searchPointer,hasMore:i.hasMoreResults})}).catch(n)})})},p.subscribePresence=function(e){return new s(function(t,n){b.subscribePresence(e,function(e){w(e,n)||t()})})},p.unsubscribePresence=function(e){return new s(function(t,n){b.unsubscribePresence(e,function(e){w(e,n)||t()})})},p.subscribeTenantPresence=function(){return new s(function(t,n){I.client_secret?b.subscribeTenantPresence(p.loggedOnUser.tenantId,function(e){w(e,n)||t()}):n(new e.Error(o.ReturnCode.SDK_ERROR,"API only allowed for bots"))})},p.unsubscribeTenantPresence=function(){return new s(function(t,n){I.client_secret?b.unsubscribeTenantPresence(p.loggedOnUser.tenantId,function(e){w(e,n)||t()}):n(new e.Error(o.ReturnCode.SDK_ERROR,"API only allowed for bots"))})},p.subscribeTypingIndicator=function(t){return new s(function(n,i){t?b.subscribe(t,function(e){w(e,i)||n()}):i(new e.Error(o.ReturnCode.SDK_ERROR,"convId is required"))})},p.unsubscribeTypingIndicator=function(t){return new s(function(n,i){t?b.unsubscribe(t,function(e){w(e,i)||n()}):i(new e.Error(o.ReturnCode.SDK_ERROR,"convId is required"))})},p.typing=function(t,n,i){return new s(function(r,a){t&&void 0!==n?b.typing(t,n,i,function(e){w(e,a)||r()}):a(new e.Error(o.ReturnCode.SDK_ERROR,"missing parameter"))})},p.renewSessionToken=Se,p.renewToken=$,p.getUserById=function(t){return new s(function(n,i){t?b.getUser(t,function(e,t){w(e,i)||we(t).then(n).catch(i)}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId is required"))})},p.getUsersById=function(t,n){return new s(function(i,r){t?t.length?(n?b.getPartialUsersByIds:b.getUsersByIds)(t,function(e,t){w(e,r)||s.all(t.map(we)).then(i).catch(r)}):i([]):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"userIds is required"))})},p.getUserByEmail=se,p.getUsersByEmail=function(t){return new s(function(n,i){if(t)if(t.length){var r={emailAddresses:t};b.getUsersByEmails(r,function(e,t){w(e,i)||s.all(t.map(we)).then(n).catch(i)})}else n([]);else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"email is required"))})},p.updateUser=function(e){return new s(function(t,n){b.updateUser(e,function(e){w(e,n)||t()})})},p.getPresence=pe,p.setPresence=Te,p.setStatusMessage=function(e){return new s(function(t,n){e=e||"",b.setUserSettings({key:o.UserSettingKey.STATUS_MESSAGE_TEXT,dataType:o.UserSettingDataType.STRING,stringValue:e},function(i){w(i,n)||pe([p.loggedOnUser.userId]).then(function(t){return Te({state:t.length&&t[0].state,statusMessage:e})}).then(t).catch(n)})})},p.getStatusMessage=function(){return new s(function(e,t){b.getUserSettings([o.UserSettingArea.ALL],function(n,i){if(!w(n,t)){var r=i&&i.find(function(e){return e.key===o.UserSettingKey.STATUS_MESSAGE_TEXT});e(r?r.stringValue:"")}})})},p.setUserSettings=function(t){return new s(function(n,i){if(t){var r=[];void 0!==t.presenceOptOut&&r.push({key:o.UserSettingKey.OPT_OUT_PRESENCE,dataType:o.UserSettingDataType.BOOLEAN,booleanValue:!!t.presenceOptOut}),void 0!==t.shareLocation&&r.push({key:o.UserSettingKey.SHARE_LOCATION,dataType:o.UserSettingDataType.BOOLEAN,booleanValue:!!t.shareLocation}),void 0!==t.voicemailEnabled&&r.push({key:o.UserSettingKey.VOICEMAIL_ENABLED,dataType:o.UserSettingDataType.BOOLEAN,booleanValue:!!t.voicemailEnabled}),void 0!==t.voicemailTimeout&&r.push({key:o.UserSettingKey.VOICEMAIL_TIMEOUT,dataType:o.UserSettingDataType.NUMBER,numberValue:t.voicemailTimeout}),void 0!==t.voicemailCustomGreetingEnabled&&r.push({key:o.UserSettingKey.VOICEMAIL_CUSTOMGREETING_ENABLED,dataType:o.UserSettingDataType.BOOLEAN,booleanValue:!!t.voicemailCustomGreetingEnabled}),void 0!==t.hideProfileExternal&&r.push({key:o.UserSettingKey.HIDE_PROFILE_EXTERNAL_ENABLED,dataType:o.UserSettingDataType.BOOLEAN,booleanValue:!!t.hideProfileExternal}),b.setUserSettings(r,function(e){w(e,i)||n()})}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"userSettings is required"))})},p.getUserSettings=function(){return new s(function(e,t){b.getUserSettings([o.UserSettingArea.ALL],function(n,i){w(n,t)||e(Ee(i))})})},p.uploadCustomVoicemailGreeting=function(n){return new s(function(i,r){n?new t.FileUpload(I).uploadFiles([n],p.domain).then(function(t){if(t&&t.length){var n=[{key:o.UserSettingKey.VOICEMAIL_CUSTOMGREETING_URI,dataType:o.UserSettingDataType.STRING,stringValue:t[0].fileId}];b.setUserSettings(n,function(e){w(e,r)||i()})}else r(new e.Error(o.ReturnCode.SDK_ERROR,"error uploading file"))}).catch(function(t){c.error("[SDK]: Fileupload error.",t),r(new e.Error(o.ReturnCode.SDK_ERROR,t))}):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"file is required"))})},p.getDevices=ce,p.getConversations=function(e){return new s(function(t,n){(e=e||{}).numberOfConversations=e.numberOfConversations||25;var i=e.direction!==o.SearchDirection.AFTER;b.getConversations(p.loggedOnUser.userId,e.timestamp,i,e.numberOfConversations,o.ConversationFilter.ALL,function(e,i){w(e,n)||s.all(i.map(Ve)).then(t).catch(n)})})},p.getConversationTopics=function(e,t){return new s(function(n,i){var r=(t=t||{}).maxNumberOfTopics||void 0,o=t.timestamp||void 0;b.getConversationTopics(e,o,r,function(e,t,r){if(!w(e,i)){var o=[];(t=t||[]).forEach(function(e){Object.keys(e).forEach(function(t){o.push(e[t])})}),s.all(o.map(Ge)).then(function(){n({conversationTopics:t,hasOlderTopics:r})}).catch(i)}})})},p.getMarkedConversations=function(){return new s(function(e,t){b.getMarkedConversationsList(function(n,i){w(n,t,!0)||e(i||[])})})},p.getFavoriteConversationIds=function(){return new s(function(e,t){b.getFavoriteConversationIds(function(n,i){w(n,t,!0)||e(i||[])})})},p.favoriteConversation=function(t){return new s(function(n,i){t?b.markConversation({convId:t,markType:o.ConversationMarkFilter.FAVORITE},function(e){w(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},p.unfavoriteConversation=function(t){return new s(function(n,i){t?b.unmarkConversation({convId:t,markType:o.ConversationMarkFilter.FAVORITE},function(e){w(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},p.archiveConversation=function(t){return new s(function(n,i){t?b.markConversation({convId:t,markType:o.ConversationMarkFilter.MUTE},function(e){w(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},p.unarchiveConversation=function(t){return new s(function(n,i){t?b.unmarkConversation({convId:t,markType:o.ConversationMarkFilter.MUTE},function(e){w(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},p.addLabels=function(t){return new s(function(n,i){Array.isArray(t)?(t=t.map(function(e){return{value:e}}),b.addLabels(t,function(e,t){w(e,i,!0)||n(t||[])})):i(new e.Error(o.ReturnCode.SDK_ERROR,"Parameter must be an array of label names."))})},p.assignLabels=function(t,n){return new s(function(i,r){Array.isArray(n)?b.assignLabels(t,n,function(e,t){w(e,r)||i(t||[])}):r(new e.Error(o.ReturnCode.SDK_ERROR,"Parameter must be an array of label Ids."))})},p.editLabel=function(e){return new s(function(t,n){b.editLabel(e,function(e,i){w(e,n,!0)||t(i)})})},p.getAllLabels=function(){return new s(function(e,t){b.getAllLabels(function(n,i){w(n,t,!0)||e(i||[])})})},p.removeLabels=function(t){return new s(function(n,i){Array.isArray(t)?b.removeLabels(t,function(e,t){w(e,i,!0)||n(t||[])}):i(new e.Error(o.ReturnCode.SDK_ERROR,"Parameter must be an array of label Ids."))})},p.unassignLabels=function(t,n){return new s(function(i,r){Array.isArray(n)?b.unassignLabels(t,n,function(e,t){w(e,r)||i(t||[])}):r(new e.Error(o.ReturnCode.SDK_ERROR,"Parameter must be an array of label Ids."))})},p.getConversationsByFilter=oe,p.getConversationsByLabel=function(t,n){return t?((n=n||{}).filterConnector={conditions:[{filterTarget:o.FilterTarget.LABEL_ID,expectedValue:[t]}]},n.retrieveAction=e.Enums.RetrieveAction.CONVERSATIONS,oe(n)):s.reject(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"labelId"))},p.getConversationsByType=function(t,n){return t?((n=n||{}).retrieveAction=e.Enums.RetrieveAction.CONVERSATIONS,n.number=n.number||25,n.filterConnector={conditions:[{filterTarget:o.FilterTarget.CONVERSATION_TYPE,expectedValue:[t]}],connectors:[{boolConnector:o.FilterBoolConnector.OR,conditions:[{filterTarget:o.FilterTarget.LABEL_ID,filterTargetComparator:o.FilterTargetComparator.NOT,expectedValue:[o.SystemLabel.ARCHIVED]}]}],boolConnector:o.FilterBoolConnector.AND},oe(n)):new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"conversationType is required.")},p.getArchivedConversations=function(t){return(t=t||{}).filterConnector={conditions:[{filterTarget:o.FilterTarget.LABEL_ID,expectedValue:[o.SystemLabel.ARCHIVED]}]},t.retrieveAction=e.Enums.RetrieveAction.CONVERSATIONS,oe(t)},p.getConversationById=ae,p.getConversationsByIds=function(e){return new s(function(t,n){b.getConversationsByIds(e,function(e,i){w(e,n)||s.all(i.map(Ve)).then(t).catch(n)})})},p.getConversationParticipants=function(e,t){return new s(function(n,i){t=t||{},b.getConversationParticipants(e,t,function(e,t){w(e,i)||s.all(t.participants.map(Fe)).then(function(e){t.participants=e,n(t)}).catch(i)})})},p.getItemById=function(e){return new s(function(t,n){b.getItemById(e,function(e,i){w(e,n)||Ge(i).then(t).catch(n)})})},p.getItemsById=function(e){return new s(function(t,n){b.getItemsByIds(e,function(e,i){w(e,n)||s.all(i.map(Ge)).then(t).catch(n)})})},p.getConversationItems=function(e,t){return new s(function(n,i){(t=t||{}).modificationDate=t.modificationDate||void 0,t.creationDate=t.creationDate||t.creationTime||void 0,t.direction=t.direction||o.SearchDirection.BEFORE,t.numberOfItems=t.numberOfItems||25,b.getConversationItems(e,t.modificationDate,t.creationDate,t.direction,t.numberOfItems,function(e,t){w(e,i)||s.all(t.map(Ge)).then(n).catch(i)})})},p.getConversationFeed=function(e,t){return new s(function(n,i){t=t||{},b.getConversationFeed(e,t.timestamp,t.minTotalItems,t.maxTotalUnread,t.commentsPerThread,t.maxUnreadPerThread,function(e,t,r){w(e,i)||s.all(t.map(ke)).then(function(e){n({threads:e,hasOlderThreads:r})}).catch(i)})})},p.getItemsByThread=function(e,t,n){return new s(function(i,r){var a=(n=n||{}).modificationDate||n.creationDate,c=n.modificationDate?o.TimestampFilter.MODIFICATION:o.TimestampFilter.CREATION;b.getThreadComments(e,t,a,c,n.direction,n.number||n.numberOfItems,function(e,t,n){w(e,r)||s.all(t.map(Ge)).then(function(e){i({items:e,hasMore:n})}).catch(r)})})},p.addTextItem=function(n,i){return new s(function(r,a){function s(e){e.mentionedUsers=C.createMentionedUsersArray(e.content),b.addTextItem(e,function(e,t){w(e,a)||Ge(t).then(r).catch(a)})}if(n)if(i)if("string"==typeof i)s({convId:n,content:i,contentType:"RICH"});else if("object"==typeof i){var l={convId:n,parentId:i.parentId,contentType:i.contentType||o.TextItemContentType.RICH,subject:i.subject,content:i.content,form:i.form,externalAttachmentMetaData:i.externalAttachments};i.attachments&&i.attachments.length>0?new t.FileUpload(I).uploadFiles(i.attachments,p.domain).then(function(e){l.attachmentMetaData=[],e.forEach(function(e){l.attachmentMetaData.push(e)}),s(l)}).catch(function(t){c.error("[SDK]: Fileupload error.",t),a(new e.Error(o.ReturnCode.SDK_ERROR,t))}):s(l)}else a(new e.Error(o.ReturnCode.SDK_ERROR,"Invalid content"));else a(new Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"content is required"));else a(new Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},p.updateTextItem=function(n){return new s(function(i,r){function a(e){e.mentionedUsers=C.createMentionedUsersArray(e.content),b.updateTextItem(e,function(e,t){w(e,r)||Ge(t).then(i).catch(r)})}n?n.itemId?"object"==typeof n?n.attachments&&n.attachments.length>0?new t.FileUpload(I).uploadFiles(n.attachments,p.domain).then(function(e){n.attachmentMetaData=[],e.forEach(function(e){n.attachmentMetaData.push(e)}),a(n)}).catch(function(t){c.error("[SDK]: Fileupload error.",t),r(new e.Error(o.ReturnCode.SDK_ERROR,t))}):a(n):r(new e.Error(o.ReturnCode.SDK_ERROR,"Invalid content")):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"item.itemId is required")):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"))})},p.getDirectConversationWithUser=de,p.addParticipant=function(e,t,n){return new s(function(i,r){var o={convId:e,userId:t};b.addParticipant(o,function(o,a){w(o,r)||(Ve(a.conversation).then(i).catch(r),n&&M.SdkHelperSvc.getConversationPromise(e).then(function(e){if(e.call)if(a.conversation.convId===e.convId){var n=t.map(function(e){return{userId:e}});M.PubSubSvc.publish("/conversation/participants/add",[e.call,n])}else M.PubSubSvc.publish("/conversation/upgrade",[e,a.conversation])}))})})},p.removeParticipant=function(e,t){return new s(function(n,i){b.removeParticipant(e,t,function(e){w(e,i)||n()})})},p.getFlaggedItems=function(){return new s(function(e,t){b.getFlaggedItems(function(n,i){w(n,t,!0)||e(i||[])})})},p.flagItem=function(e,t){return new s(function(n,i){b.setFlagItem({convId:e,itemId:t},function(e){w(e,i)||n()})})},p.unflagItem=function(e,t){return new s(function(n,i){b.clearFlagItem(e,t,function(e){w(e,i)||n()})})},p.likeItem=function(e){return new s(function(t,n){b.likeTextItem(e,p.loggedOnUser.userId,function(e){w(e,n)||t()})})},p.unlikeItem=function(e){return new s(function(t,n){b.unlikeTextItem(e,p.loggedOnUser.userId,function(e){w(e,n)||t()})})},p.markItemsAsRead=function(e,t){return new s(function(n,i){t=t||Date.now(),b.setReadPointer(e,t,function(e){w(e,i)||n()})})},p.moderateConversation=function(t){return new s(function(n,i){t?b.moderateConversation(t,function(e,t){w(e,i)||(t&&"LOCK_OK"===t.moderateResult?n():i(t))}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},p.unmoderateConversation=function(t){return new s(function(n,i){t?b.unmoderateConversation(t,function(e,t){w(e,i)||(t&&"UNLOCK_OK"===t.moderateResult?n():i(t))}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},p.grantModeratorRights=function(t,n){return new s(function(i,r){t&&n?b.grantModeratorRights(t,n,function(e,t){w(e,r)||(t&&"GRANT_OK"===t.grantModeratorResult?i():r(t))}):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))})},p.dropModeratorRights=function(t,n){return new s(function(i,r){t&&n?b.dropModeratorRights(t,n,function(e,t){w(e,r)||(t&&"DROP_OK"===t.dropModeratorResult?i():r(t))}):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))})},p.enableGuestAccess=function(e){return Ce(e,!1)},p.disableGuestAccess=function(e){return Ce(e,!0)},p.createDirectConversation=function(t){return t&&"string"==typeof t?t.match(C.EMAIL_ADDRESS_PATTERN)?se(t).then(function(e){return e.userId}).then(ue):ue(t):s.reject(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participant email or user ID is required"))},p.createGroupConversation=function(t,n){return new s(function(i,r){if(t)if(-1===t.indexOf(p.loggedOnUser.userId)&&t.unshift(p.loggedOnUser.userId),t.length<2)r(new e.Error(o.ReturnCode.SDK_ERROR,"At least one participant (other than self) is required"));else if(t.indexOf("")>-1||t.indexOf(null)>-1)r(new e.Error(o.ReturnCode.SDK_ERROR,"Participant cannot be empty"));else{t=t.map(function(e){return{userId:e}});var a={type:o.ConversationType.GROUP,participants:t,topic:n};b.createConversation(a,function(e,t){w(e,r)||Ve(t).then(i).catch(r)})}else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participants is required"))})},p.createConferenceBridge=function(t){return new s(function(n,i){if(t){var r={type:o.ConversationType.GROUP,participants:[{userId:p.loggedOnUser.userId}],topic:t};b.createConversation(r,function(e,t){w(e,i)||Ve(t).then(n).catch(i)})}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"Topic is required"))})},p.createCommunity=function(e,t,n){return new s(function(i,r){e&&e.length||(e=[p.loggedOnUser.userId]),e=e.map(function(e){return{userId:e}});var a={type:o.ConversationType.OPEN,participants:e,topic:t,description:n};b.createConversation(a,function(e,t){w(e,r)||Ve(t).then(i).catch(r)})})},p.joinCommunity=function(t){return new s(function(n,i){t?b.joinOpenConversation(t,function(e,t){w(e,i)||n(t)}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},p.updateConversation=function(e,t){return new s(function(n,i){var r={conversationId:e,topic:t.topic||void 0,description:t.description||void 0};b.updateConversation(r,function(e,t){w(e,i)||Ve(t).then(n).catch(i)})})},p.findCall=function(e){return s.resolve(Me(Re(e)))},p.getCalls=function(){return s.all(M.CallControlSvc.getCalls().map(Me))},p.getActiveCall=function(){return s.resolve(Me(M.CallControlSvc.getActiveCall()))},p.getActiveRemoteCalls=function(){return s.all(M.CallControlSvc.getActiveRemoteCall().map(Me))},p.getStartedCalls=function(){return s.all(M.CallControlSvc.getCalls().filter(function(t){return t.state.name===e.Enums.CallState.Started.name}).map(Me))},p.getConferenceInvitationText=function(e,t){return new s(function(n,i){b.getConferenceInvitationText(e,t,function(e,t){w(e,i)||n(t)})})},p.startConference=function(t,n){return ae(t).then(function(t){return new s(function(i,r){t?(M.SdkHelperSvc.addConversationToCache(t),M.CallControlSvc.startConference(t.convId,n,function(e,t,n){G(e,r)||Me(n).then(i).catch(r)})):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"Conversation does not exist"))})})},p.getConversationDetails=function(e){return new s(function(t,n){b.getJoinDetails(e,!1,function(e,i){w(e,n)||t(ve(i))})})},p.changeConversationPin=function(e){return new s(function(t,n){b.getJoinDetails(e,!0,function(e,i){w(e,n)||t(ve(i))})})},p.joinConference=function(t,n,i){return new s(function(r,a){t?i&&i!==p.loggedOnUser.clientId?fe(i).then(function(s){if(s){var c={content:{type:"JOIN_CONFERENCE_REQUEST",callId:t,mediaType:n},destUserId:p.loggedOnUser.userId,destClientId:i};U.sendContactCardRequest(c,function(t,n){t?a(new e.Error(o.ErrorCode.SDK_ERROR,t)):n&&n.response?n.response.code&&"OK"!==n.response.code?a(new e.Error(o.ErrorCode.SDK_ERROR,n.response.code)):r():a(new e.Error(o.ErrorCode.SDK_ERROR,"Invalid response for JOIN_CONFERENCE_REQUEST"))})}else a(new e.Error(o.ErrorCode.SDK_ERROR,"No client found for clientId "+i))}):M.CallControlSvc.joinGroupCall(t,n,function(e){G(e,a)||r()}):a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.pullRemoteCall=function(t,n){return new s(function(i,r){t?M.CallControlSvc.pullRemoteCall(t,n,function(e){G(e,r)||i()}):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.leaveConference=Ae,p.endConference=function(t){return new s(function(n,i){t?M.CallControlSvc.endConference(t,function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.setMediaDevices=function(t){return new s(function(n,i){if(t)if(t.playback||t.recording||t.video||t.ringing){t.playback&&(t.playback=Array.isArray(t.playback)?t.playback:[t.playback],L.playbackDevices=t.playback.map(function(e){return{id:e}})),t.recording&&(t.recording=Array.isArray(t.recording)?t.recording:[t.recording],L.recordingDevices=t.recording.map(function(e){return{id:e}})),t.video&&(t.video=Array.isArray(t.video)?t.video:[t.video],L.videoDevices=t.video.map(function(e){return{id:e}})),t.ringing&&(t.ringing=Array.isArray(t.ringing)?t.ringing:[t.ringing],L.ringingDevices=t.ringing.map(function(e){return{id:e}}));var r=M.CallControlSvc.getActiveCall();r?M.CallControlSvc.renegotiateMedia(r.callId,function(e){e&&c.warn("[SDK]: Unable to renegotiate media.",e),n()}):n()}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices must contain playback, recording, video or ringing attributes"));else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices is required"))})},p.makeCall=function(t,n,i){return de(t,i).then(function(t){return new s(function(i,r){t?(M.SdkHelperSvc.addConversationToCache(t),M.CallControlSvc.makeCall(t.convId,n,function(e,t,n){G(e,r)||Me(n).then(i).catch(r)})):r(new e.Error(o.ErrorCode.SDK_ERROR,"Conversation does not exist"))})})},p.endRemoteCall=function(t){return new s(function(n,i){t?M.CallControlSvc.endRemoteCall(t,function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.dropParticipant=function(t,n){return new s(function(i,r){t?M.CallControlSvc.dropParticipant(t,{userId:n},function(e){G(e,r)||i()}):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.muteParticipant=function(t,n){return new s(function(i,r){t?M.CallControlSvc.muteParticipant(t,{userId:n},function(e){G(e,r)||i()}):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.muteRtcSession=function(t){return new s(function(n,i){t?M.CallControlSvc.muteRtcSession(t,function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.getCallDevices=function(){return M.CallControlSvc.getCallDevices().map(function(e){return e.name})},p.getPushDevices=function(){return M.CallControlSvc.getPushDevices().map(function(e){return e.name})},p.getAnswerDevices=function(e){return M.CallControlSvc.getAnswerDevices(e).map(function(e){return e.name})},p.getAtcCalls=M.CallControlSvc.getAtcCalls,p.dialNumber=function(t,n){return new s(function(i,r){C.PHONE_PATTERN.test(t||null)?M.CallControlSvc.dialNumber(t,n,{audio:!0,video:!1},function(e,t,n){G(e||t,r)||Me(n).then(i).catch(r)}):r(new e.Error(o.ReturnCode.SDK_ERROR,"Invalid number"))})},p.getTelephonyData=M.SdkHelperSvc.getTelephonyData,p.sendDigits=function(t,n){return new s(function(i,r){/^[\d#\*,]+$/.exec(n)?M.CallControlSvc.sendDigits(t,n,function(e){G(e,r)||i()}):r(new e.Error(o.ReturnCode.SDK_ERROR,"Invalid DTMF digits (Allowed: 0-9,#,*)"))})},p.sendClickToCallRequest=function(t,i,r,a){return new s(function(s,c){if(t){i=i||"audio";var l=t.match(C.PHONE_DIAL_PATTERN),d=l&&l.length&&l[0];d&&(t=null),r?fe(r).then(function(t){t?u(r):c(new e.Error(o.ErrorCode.SDK_ERROR,"No client found for clientId "+r))}):Ie().then(function(r){r?u():a?c(new e.Error(o.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set.")):function(){var r,a=p.domain.startsWith("sdk.")?p.domain.substr(4):p.domain;r=d?"https://"+a+"/#/phone?number="+d:"https://"+a+"/#/call?user="+t+"&media="+i;var l=n.open(r,"_blank");l?(l.focus(),s({type:"CALL_VIA_URL",win:l})):c(new e.Error(o.ErrorCode.SDK_ERROR,"Popup blocker prevented opening Circuit in new window"))}()})}else c(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"emailAddress is required"));function u(n){var r={content:{type:"CLICK_TO_CALL_REQUEST",mediaType:d?"telephony":i,contact:{email:t,phoneNumber:d},promptBeforeDial:!n,sdk:!0},destUserId:p.loggedOnUser.userId};n&&(r.destClientId=n),U.sendContactCardRequest(r,function(t){t?c(new e.Error(o.ErrorCode.SDK_ERROR,t)):s({type:"CALL_VIA_OTHER_CLIENT"})})}})},p.sendClickToAnswerRequest=function(t,n,i){return new s(function(r,a){function s(i){var s={content:{type:"CLICK_TO_ANSWER_REQUEST",mediaType:n,callId:t,promptBeforeAnswer:!i,sdk:!0},destUserId:p.loggedOnUser.userId};i&&(s.destClientId=i),U.sendContactCardRequest(s,function(t){t?a(new e.Error(o.ErrorCode.SDK_ERROR,t)):r({type:"ANSWER_VIA_OTHER_CLIENT"})})}n=n||"audio",i?fe(i).then(function(t){t?s(i):a(new e.Error(o.ErrorCode.SDK_ERROR,"No client found for clientId "+i))}):Ie().then(function(t){t?s():a(new e.Error(o.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set."))})})},p.muteDevice=function(t,n,i){return new s(function(r,a){t?(void 0===(i=i||{}).mic&&(i.mic=!0),void 0===i.speaker&&(i.speaker=!0),Ie(n).then(function(s){if(s){var c={content:{type:"MUTE_DEVICE_REQUEST",callId:t,option:i},destUserId:p.loggedOnUser.userId,destClientId:n,sdk:!0};U.sendContactCardRequest(c,function(t,n){t?a(new e.Error(o.ErrorCode.SDK_ERROR,t)):n&&n.response?n.response.code&&"OK"!==n.response.code?a(new e.Error(o.ErrorCode.SDK_ERROR,n.response.code)):r():a(new e.Error(o.ErrorCode.SDK_ERROR,"Invalid response for MUTE_DEVICE_REQUEST"))})}else a(new e.Error(o.ErrorCode.SDK_ERROR,"Device not found"))})):a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.addParticipantToCall=function(t,n){return new s(function(i,r){if(t)if(n)if(n.userId||n.email||n.number){var a={userId:n.userId||void 0,dialOutPhoneNumber:n.number||void 0,displayName:n.displayName||void 0};!n.userId&&n.email&&n.email.match(C.EMAIL_ADDRESS_PATTERN)?se(n.email).then(function(n){a.userId=n.userId,M.CallControlSvc.addParticipantToCall(t,a,function(t){t?r(new e.Error(o.ErrorCode.SDK_ERROR,t)):i()})}).catch(r):M.CallControlSvc.addParticipantToCall(t,a,function(t){t?r(new e.Error(o.ErrorCode.SDK_ERROR,t)):i()})}else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.addParticipantToRtcSession=function(t,n){return new s(function(i,r){if(t)if(n)if(n.userId||n.email||n.number){var a={userId:n.userId||void 0,dialOutPhoneNumber:n.number||void 0,displayName:n.displayName||void 0};!n.userId&&n.email&&n.email.match(C.EMAIL_ADDRESS_PATTERN)?se(n.email).then(function(n){a.userId=n.userId,M.CallControlSvc.addParticipantToRtcSession(t,a,function(t){t?r(new e.Error(o.ErrorCode.SDK_ERROR,t)):i()})}).catch(r):M.CallControlSvc.addParticipantToRtcSession(t,a,function(t){t?r(new e.Error(o.ErrorCode.SDK_ERROR,t)):i()})}else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.answerCall=function(t,n,i){return new s(function(r,a){t?M.CallControlSvc.answerCallOnDevice(t,n,i&&d[i],function(e){G(e,a)||r()}):a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.endCall=Ae,p.toggleVideo=function(t){return new s(function(n,i){t?M.CallControlSvc.toggleVideo(t,function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.changeHDVideo=function(t,n){return new s(function(i,r){t?(n=!!n,M.CallControlSvc.changeHDVideo(t,n,function(e){G(e,r)||i()})):r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.getMaxVideoResolution=function(t){return t?ge(t,e.Enums.VideoResolution.FHD).catch(_e(t,e.Enums.VideoResolution.HD)).catch(_e(t,e.Enums.VideoResolution.VGA)).catch(function(){return s.reject("No video supported for deviceId: "+t)}):s.reject(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"deviceId is required"))},p.toggleRemoteAudio=function(t){return new s(function(n,i){if(t){var r=Re(t);r?(r.remoteAudioDisabled?M.CallControlSvc.enableRemoteAudio(t):M.CallControlSvc.disableRemoteAudio(t),n(t)):i(new e.Error(o.ReturnCode.SDK_ERROR,"No call found"))}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.toggleRemoteVideo=function(t){return new s(function(n,i){t?M.CallControlSvc.toggleRemoteVideo(t,function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.toggleScreenShare=function(t){return new s(function(n,i){if(t){var r=Re(t);r?r.hasLocalScreenShare()?M.CallControlSvc.removeScreenShare(t,function(e){G(e,i)||n()}):M.CallControlSvc.addScreenShare(t,null,function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.SDK_ERROR,"No call found"))}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.setScreenshareStream=Ne,p.toggleMediaStream=Ne,p.getLocalAudioVideoStream=me.bind(p,L.LOCAL_STREAMS.AUDIO_VIDEO),p.getLocalScreenshareStream=me.bind(p,L.LOCAL_STREAMS.DESKTOP),p.setAudioVideoStream=function(t,n){return new s(function(i,r){if(t)if(n){var a=Re(t);if(a)if(e.WebRTCAdapter.origGetUserMedia)r(new e.Error(o.ReturnCode.SDK_ERROR,"Already setting another audio/video stream"));else{var s={audio:!!n.getAudioTracks().length,video:!!n.getVideoTracks().length};e.WebRTCAdapter.origGetUserMedia=e.WebRTCAdapter.getUserMedia,e.WebRTCAdapter.getUserMedia=function(e,t){t&&t(n)},a.sessionCtrl.dontReuseAudioStream=!0,M.CallControlSvc.setMediaType(t,s,function(t){a.sessionCtrl.dontReuseAudioStream=!1,e.WebRTCAdapter.getUserMedia=e.WebRTCAdapter.origGetUserMedia,delete e.WebRTCAdapter.origGetUserMedia,G(t,r)||i()})}else r(new e.Error(o.ReturnCode.SDK_ERROR,"No call found"))}else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"stream is required"));else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.startRecording=function(t,n,i){return new s(function(r,a){if(t){var s=M.CallControlSvc.getActiveCall();s?t===s.callId?M.CallControlSvc.startRecording(function(e){G(e,a)||r()},n,i):a(new e.Error(o.ReturnCode.SDK_ERROR,"Call ID is not for active call")):a(new e.Error(o.ReturnCode.SDK_ERROR,"No active call found"))}else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.stopRecording=function(t){return new s(function(n,i){if(t){var r=M.CallControlSvc.getActiveCall();r?t===r.callId?M.CallControlSvc.stopRecording(function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.SDK_ERROR,"Call ID is not for active call")):i(new e.Error(o.ReturnCode.SDK_ERROR,"No active call found"))}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.switchRecordingLayout=function(t,n){return new s(function(i,r){if(t){var a=M.CallControlSvc.getActiveCall();a?t===a.callId?M.CallControlSvc.switchRecordingLayout(n,function(e){G(e,r)||i()}):r(new e.Error(o.ReturnCode.SDK_ERROR,"Call ID is not for active call")):r(new e.Error(o.ReturnCode.SDK_ERROR,"No active call found"))}else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.deleteRecording=function(e){return new s(function(t,n){b.deleteRecording(e,function(e){w(e,n)||t()})})},p.mute=function(t){return new s(function(n,i){t?M.CallControlSvc.mute(t,function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.unmute=function(t){return new s(function(n,i){t?M.CallControlSvc.unmute(t,function(e){G(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.getLastRtpStats=function(t){if(!t)throw new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var n=Re(t);return n&&n.sessionCtrl?n.sessionCtrl.getLastSavedStats()||[]:null},p.getRemoteStreams=function(t){if(!t)throw new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var n=Re(t);return n&&n.sessionCtrl?n.sessionCtrl.getRemoteStreams()||[]:null},p.enableWhiteboard=function(t,n){return new s(function(i,r){if(t)if(n){var a={rtcSessionId:t,viewbox:n};b.enableWhiteboard(a,function(e){w(e,r)||i()})}else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"viewbox is required"));else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.disableWhiteboard=function(t){return new s(function(n,i){if(t){var r={rtcSessionId:t};b.disableWhiteboard(r,function(e){w(e,i)||n()})}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.addWhiteboardElement=function(t,n){return new s(function(i,r){if(t)if(n){var a={rtcSessionId:t,xmlElement:n};b.addWhiteboardElement(a,function(e){w(e,r)||i()})}else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.removeWhiteboardElement=function(t,n){return new s(function(i,r){if(t)if(n){var a={rtcSessionId:t,xmlId:n};b.removeWhiteboardElement(a,function(e){w(e,r)||i()})}else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else r(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.updateWhiteboardElement=function(t,n,i){return new s(function(r,a){if(t)if(n)if(i){var s={rtcSessionId:t,xmlId:n,xmlElement:i};b.updateWhiteboardElement(s,function(e){w(e,a)||r()})}else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.clearWhiteboard=function(t,n,i){return new s(function(r,a){if(t){var s={rtcSessionId:t,userId:n||void 0,preserveBackground:i||void 0};b.clearWhiteboard(s,function(e){w(e,a)||r()})}else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.getWhiteboard=function(t){return new s(function(n,i){if(t){var r={rtcSessionId:t};b.getWhiteboard(r,function(e,t){w(e,i)||(t.callId=t.rtcSessionId,delete t.rtcSessionId,n(t))})}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.setWhiteboardBackground=function(n,i){return new s(function(r,a){if(n)if(i)if("object"==typeof i)new t.FileUpload(I).uploadWhiteboardFile(i,n).then(function(e){var t={rtcSessionId:n,url:e.url};b.setWhiteboardBackground(t,function(e){w(e,a)||r()})}).catch(function(t){c.error("[SDK]: File upload error. ",t),a(new e.Error(o.ReturnCode.SDK_ERROR,t))});else if("string"==typeof i){var s={rtcSessionId:n,url:i};b.setWhiteboardBackground(s,function(e){w(e,a)||r()})}else a(new e.Error(o.ReturnCode.SDK_ERROR,"file must be a File object or a string"));else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"file is required"));else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.clearWhiteboardBackground=function(t){return new s(function(n,i){if(t){var r={rtcSessionId:t};b.clearWhiteboardBackground(r,function(e){w(e,i)||n()})}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.toggleWhiteboardOverlay=function(t){return new s(function(n,i){if(t){var r={rtcSessionId:t};b.toggleWhiteboardOverlay(r,function(e){w(e,i)||n()})}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.undoWhiteboard=function(t,n,i){return new s(function(r,a){if(t){var s={rtcSessionId:t,steps:n,userId:i||void 0};b.undoWhiteboard(s,function(e){w(e,a)||r()})}else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},p.startUserSearch=function(e){return"string"==typeof e&&(e={query:e}),new s(function(t,n){b.startUserSearch(e,function(e,i){e?n(e):t(i)})})},p.startBasicSearch=function(e){var t;return t="string"==typeof e?{scope:o.SearchScope.ALL,searchTerm:e}:e,new s(function(e,n){b.startBasicSearch(t,null,function(t,i){t?n(t):e(i)})})},p.startAdvancedUserSearch=function(t){return new s(function(n,i){if(t)if("object"==typeof t&&t.query){var r={searchContext:t.searchContext||e.Enums.SearchContext.USER,query:t.query,searchExactAssignedPhoneNumber:t.searchExactAssignedPhoneNumber||!1,resultSetLimit:0};b.startAdvancedUserSearch(r,function(e,t){w(e,i)||n(t)})}else i(new e.Error(o.ReturnCode.SDK_ERROR,"query needs to be an object containing the property to be queried"));else i(new e.Error(o.ReturnCode.SDK_ERROR,"missing parameter"))})},p.cancelSearch=function(e){return new s(function(t,n){b.cancelSearch(e,function(e){w(e,n)||t()})})},p.submitForm=function(e,t){return new s(function(n,i){b.submitFormData(e,t,function(e){w(e,i)||n()})})},p.createIncomingWebhook=function(t){return new s(function(n,i){t&&"object"==typeof t?t.conversationId?b.createIncomingWebhook(t,function(e,t){w(e,i)||n(t)}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"Object must contain a conversation Id")):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"newWebhookData must be an object"))})},p.deleteIncomingWebhook=function(t){return new s(function(n,i){t&&"string"==typeof t?b.deleteIncomingWebhook(t,function(e){w(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be deleted"))})},p.getIncomingWebhook=function(t){return new s(function(n,i){t&&"string"==typeof t?b.getIncomingWebhook(t,function(e,t){w(e,i)||n(t)}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be retrieved"))})},p.getIncomingWebhooks=function(t){return new s(function(n,i){if(t&&"object"==typeof t){if(t.tenantId)t.filter=o.CPasSIncomingWebhookFilter.TENANT;else if(t.userId)t.filter=o.CPasSIncomingWebhookFilter.USER;else{if(!t.conversationId)return void i("Missing id for filtering");t.filter=o.CPasSIncomingWebhookFilter.CONVERSATION}b.getIncomingWebhooks(t,function(e,t){w(e,i)||n(t)})}else i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"searchCondition must be an object"))})},p.suspendIncomingWebhook=function(t){return new s(function(n,i){t&&"string"==typeof t?b.suspendIncomingWebhook(t,function(e){w(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be suspended"))})},p.unsuspendIncomingWebhook=function(t){return new s(function(n,i){t&&"string"==typeof t?b.unsuspendIncomingWebhook(t,function(e){w(e,i)||n()}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"webhookId must be an string of the webhook id to be unsuspended"))})},p.updateIncomingWebhook=function(t){return new s(function(n,i){t&&"object"==typeof t?t.webhookId?b.updateIncomingWebhook(t,function(e,t){w(e,i)||n(t)}):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"Object must contain a webhook Id")):i(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"updateWebhookData must be an object"))})},p.sendAppMessageToUser=function(t,n,i){return new s(function(r,a){if(t&&"string"==typeof t)if(n&&"string"==typeof n)if(i&&"object"==typeof i){var s={content:{type:t,message:i},destUserId:n};U.sendSdkRequest(s,function(t){t?a(new e.Error(o.ErrorCode.SDK_ERROR,t)):r()})}else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId [string] is required"));else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"))})},p.sendAppMessageToClient=function(t,n,i){return new s(function(r,a){if(t&&"string"==typeof t)if(n&&"string"==typeof n)if(i&&"object"==typeof i){var s={content:{type:t,message:i},destUserId:p.loggedOnUser.userId,destClientId:n};U.sendSdkRequest(s,function(t){t?a(new e.Error(o.ErrorCode.SDK_ERROR,t)):r()})}else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"destClientId [string] is required"));else a(new e.Error(o.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"))})},p.addAppMessageListener=function(e,t){U.on("SDK."+e,t)},p.removeAppMessageListener=U.off,M.PubSubSvc.subscribe("/localUser/update",function(){Be({type:"loggedOnUserUpdated",user:p.loggedOnUser})}),b.on("Conversation.ADD_ITEM",function(e){Be({type:"itemAdded",item:e.item})}),b.on("Conversation.UPDATE_ITEM",function(e){Be({type:"itemUpdated",item:e.item})}),b.on("Conversation.FLAG_ITEM",function(e){Be({type:"itemFlagged",convId:e.convId,itemId:e.conversationItemId})}),b.on("Conversation.CLEAR_FLAGGED_ITEM",function(e){Be({type:"itemUnflagged",convId:e.convId,itemId:e.conversationItemId})}),b.on("Conversation.CREATE",function(e){Be({type:"conversationCreated",conversation:e.conversation})}),b.on("Conversation.UPDATE",function(e){Be({type:"conversationUpdated",conversation:e.conversation})}),M.PubSubSvc.subscribe("/conversation/new",function(e){Be({type:"conversationUpdated",conversation:e})}),b.on("Conversation.CONVERSATION_MARKED",function(e){switch(e.filter){case o.ConversationMarkFilter.MUTE:Be({type:"conversationArchived",convId:e.convId});break;case o.ConversationMarkFilter.FAVORITE:Be({type:"conversationFavorited",convId:e.convId})}}),b.on("Conversation.CONVERSATION_UNMARKED",function(e){switch(e.filter){case o.ConversationMarkFilter.MUTE:Be({type:"conversationUnarchived",convId:e.convId});break;case o.ConversationMarkFilter.FAVORITE:Be({type:"conversationUnfavorited",convId:e.convId})}}),b.on("ConversationUserData.LABELS_ADDED",function(e){Be({type:"labelsAdded",labels:e.labelsAdded})}),b.on("ConversationUserData.LABEL_EDITED",function(e){Be({type:"labelEdited",label:e.labelEdited})}),b.on("ConversationUserData.LABELS_REMOVED",function(e){Be({type:"labelsRemoved",labelIds:e.labelsRemoved})}),b.on("Conversation.USER_DATA_CHANGED",function(e){Be({type:"conversationUserDataChanged",data:e})}),b.on("Conversation.READ_ITEMS",function(e){Be({type:"conversationReadItems",data:e})}),b.on("User.USER_PRESENCE_CHANGE",function(e){Be({type:"userPresenceChanged",presenceState:e.newState})}),b.on("User.TENANT_PRESENCE_CHANGE",function(e){e.newState.forEach(function(e){Be({type:"userPresenceChanged",presenceState:e})})}),b.on("Conversation.TYPING",function(e){Be({type:"typing",data:e})}),b.on("User.USER_UPDATED",function(e){Be({type:"userUpdated",user:e.user})}),b.addEventListener("connectionStateChange",function(e){S===i.Reconnecting&&e.newState===i.Connected&&ne().catch(function(e){c.error("Error initializing websocket on reconenct",e)}),S=e.newState,Be({type:"connectionStateChanged",state:e.newState})}),b.addEventListener("reconnectFailed",function(){Be({type:"reconnectFailed"}),I.client_secret&&re().then(x).then(ie).catch(function(e){c.error("Error re-authenticating on auto-reconnect for client credentials grant",e)})}),b.on("User.SESSION_EXPIRES",function(){p.loggedOnUser&&Se()}),b.on("User.SESSION_EXPIRING",function(){Be({type:"sessionExpiring"})}),b.on("User.SESSION_CLOSED",function(e){Be({type:"sessionClosed",reason:e.reason})}),b.on("User.PASSWORD_CHANGED",function(){Be({type:"passwordChanged"})}),b.on("User.USER_SETTING_UPDATED",function(e){var t=Ee(e.settings);Object.keys(t).length>0&&Be({type:"userSettingsChanged",userSettings:t})}),b.on("Search.BASIC_SEARCH_RESULT",function(e){Be({type:"basicSearchResults",data:e})}),b.on("Search.SEARCH_STATUS",function(e){Be({type:"searchStatus",data:e})}),b.on("System.MAINTENANCE",function(e){Be({type:"systemMaintenance",data:e})}),b.on("User.USER_DELETED",function(e){Be({type:"userDeleted",data:e})}),b.on("Conversation.DELETE",function(e){Be({type:"conversationDeleted",convId:e.convId})}),b.on("RTCSession.WHITEBOARD_ENABLED",function(e){var t=Re(e.sessionId);t&&(t.whiteboardEnabled=!0,Be({type:"whiteboardEnabled",enabled:!0,whiteboard:e.whiteboard,data:{enabled:!0,whiteboard:e.whiteboard}}),Be({type:"callStatus",call:t,reason:"whiteboardEnabled"}))}),b.on("RTCSession.WHITEBOARD_DISABLED",function(e){var t=Re(e.sessionId);t&&(t.whiteboardEnabled=!1,Be({type:"whiteboardEnabled",enabled:!1,data:{enabled:!1}}),Be({type:"callStatus",call:t,reason:"whiteboardEnabled"}))}),b.on("RTCSession.WHITEBOARD_CLEARED",function(e){Be({type:"whiteboardCleared",userId:e.userId,possibleUndoOperations:e.possibleUndoOperations})}),b.on("RTCSession.WHITEBOARD_ELEMENT_ADDED",function(e){Be({type:"whiteboardElement",action:"added",element:e.element,possibleUndoOperations:e.possibleUndoOperations})}),b.on("RTCSession.WHITEBOARD_ELEMENT_REMOVED",function(e){Be({type:"whiteboardElement",action:"removed",elementId:e.elementId,possibleUndoOperations:e.possibleUndoOperations})}),b.on("RTCSession.WHITEBOARD_ELEMENT_UPDATED",function(e){Be({type:"whiteboardElement",action:"updated",element:e.element,possibleUndoOperations:e.possibleUndoOperations})}),b.on("RTCSession.WHITEBOARD_BACKGROUND_SET",function(e){Be({type:"whiteboardBackground",action:"set",element:e.element,possibleUndoOperations:e.possibleUndoOperations})}),b.on("RTCSession.WHITEBOARD_BACKGROUND_CLEARED",function(){Be({type:"whiteboardBackground",action:"cleared"})}),b.on("RTCSession.WHITEBOARD_OVERLAY_TOGGLED",function(){Be({type:"whiteboardOverlayToggled"})}),b.on("RTCSession.WHITEBOARD_SYNC",function(e){Be({type:"whiteboardSync",whiteboard:e.whiteboard,possibleUndoOperations:e.possibleUndoOperations})}),b.on("RTCSession.WHITEBOARD_CONVERSION_FAILED",function(e){Be({type:"whiteboardConversionFailed",callId:e.sessionId,errorText:e.errorText,lastElements:e.lastElements})}),b.on("ActivityStream.ACTIVITY_CREATED",function(e){e.navigableItem&&e.navigableItem.mention&&Be({type:"mention",mention:e.navigableItem.mention})}),b.on("CPAAS.SUBMIT_FORM_DATA",function(e){Be({type:"formSubmission",itemId:e.itemId,form:e.form,submitterId:e.submitterId})}),M.PubSubSvc.subscribe("/call/incoming",function(e){Be({type:"callIncoming",call:e})}),N&&M.PubSubSvc.subscribe("/call/warmupFailed",function(e,t){Be({type:"callIncoming",call:t})}),M.PubSubSvc.subscribe("/call/state",function(e){Be({type:"callStatus",call:e,reason:"callStateChanged"})}),M.PubSubSvc.subscribe("/call/remoteStreamUpdated",function(e){Be({type:"callStatus",call:e,reason:"remoteStreamUpdated"})}),M.PubSubSvc.subscribe("/call/localStreamEnded",function(e){Be({type:"callStatus",call:e,reason:"localStreamEnded"})}),M.PubSubSvc.subscribe("/call/muted",function(e){Be({type:"callStatus",call:e,reason:"callMuted"})}),M.PubSubSvc.subscribe("/call/localUser/muted",function(e){Be({type:"callStatus",call:Re(e),reason:"localUserMuted"})}),M.PubSubSvc.subscribe("/call/localUser/unmuted",function(e){Be({type:"callStatus",call:Re(e),reason:"localUserUnmuted"})}),M.PubSubSvc.subscribe("/call/localUser/mutedSelf",function(e,t){var n=Re(e);Be(t?{type:"callStatus",call:n,reason:"localUserSelfMuted"}:{type:"callStatus",call:n,reason:"localUserSelfUnmuted"})}),M.PubSubSvc.subscribe("/call/locked",function(e){Be({type:"callStatus",call:e,reason:"callLocked"})}),M.PubSubSvc.subscribe("/call/moved",function(e,t){Be({type:"callStatus",call:Re(t),reason:"callMoved"})}),M.PubSubSvc.subscribe("/call/participant/updated",function(e,t){Be({type:"callStatus",call:Re(e),participant:t,reason:"participantUpdated"})}),M.PubSubSvc.subscribe("/call/participants/updated",function(e,t){Be({type:"callStatus",call:Re(e),participants:t,reason:"participantsUpdated"})}),M.PubSubSvc.subscribe("/call/participant/added",function(e,t){Be({type:"callStatus",call:Re(e),participant:t,reason:"participantAdded"})}),M.PubSubSvc.subscribe("/call/participants/added",function(e,t){Be({type:"callStatus",call:Re(e),participants:t,reason:"participantsAdded"})}),M.PubSubSvc.subscribe("/call/participant/joined",function(e,t){Be({type:"callStatus",call:e,participant:t,reason:"participantJoined"})}),M.PubSubSvc.subscribe("/call/participant/removed",function(e){Be({type:"callStatus",call:Re(e),reason:"participantRemoved"})}),M.PubSubSvc.subscribe("/call/recording/info",function(e){Be({type:"callStatus",call:e,reason:"callRecording"})}),M.PubSubSvc.subscribe("/call/droppedRemotely",function(e){Be({type:"callStatus",call:e,reason:"droppedRemotely"})}),M.PubSubSvc.subscribe("/call/sdpConnected",function(e){Be({type:"callStatus",call:e,reason:"sdpConnected"})}),M.PubSubSvc.subscribe("/call/participants/activeSpeakers",function(e,t){Be({type:"callStatus",call:Re(e),reason:"activeSpeakerChanged",activeSpeakers:t})}),M.PubSubSvc.subscribe("/call/network/quality",function(e){Be({type:"callNetworkQualityChanged",data:e})}),M.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/detected",function(e){Be({type:"callRtpThresholdReached",call:Re(e)})}),M.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/cleared",function(e){Be({type:"callRtpThresholdCleared",call:Re(e)})}),M.PubSubSvc.subscribe("/call/ended",function(e,t){Re(e.callId)||Be({type:"callEnded",call:e,replaced:t})}),p},t.Client.prototype.name="Client",t.isCompatible=function(){var e=parseInt(p.version,10);return p.chrome&&e>=44||p.firefox&&e>=42||p.edge},t.supportedFeatures=function(){return t.isCompatible()?{text:!0,rtc:p.chrome||p.firefox}:{text:!1,rtc:!1}},Object.defineProperty(t,"supportedEvents",{get:function(){return["accessTokenRenewed","renewAccessTokenFailed","loggedOnUserUpdated","itemAdded","itemUpdated","itemFlagged","itemUnflagged","conversationCreated","conversationUpdated","conversationArchived","conversationFavorited","conversationUnarchived","conversationUnfavorited","conversationUserDataChanged","conversationReadItems","userPresenceChanged","userUpdated","connectionStateChanged","sessionTokenRenewed","reconnectFailed","userSettingsChanged","basicSearchResults","searchStatus","systemMaintenance","whiteboardEnabled","whiteboardElement","whiteboardCleared","mention","formSubmission","callIncoming","callStatus","callNetworkQualityChanged","callRtpThresholdReached","callRtpThresholdCleared","callEnded","whiteboardBackground","whiteboardOverlayToggled","whiteboardSync","labelsAdded","labelEdited","labelsRemoved","typing"]},enumerable:!0,configurable:!0}),t}(e=function(e){"use strict";return e.Injectors={},e}((e=function(e){"use strict";var t=e.Constants,i=e.logger,r=e.PhoneNumberFormatter,o=e.Utils;function a(e,n){if(!e||!e.localUser)return i.warn("[sdk-services]: Cannot extend Conversation object without localUser"),null;if(!n||n.isExtended)return n;var r=Object.create(n);r.isExtended=!0,r.moderators=r.moderators||[];var o=n.participants.map(function(e){return"string"==typeof e?{userId:e}:e}).filter(function(t){return t.userId===e.localUser.userId&&(r.hasJoined=!0),t.userId!==e.localUser.userId});return r.peerUsers=o,n.type===t.ConversationType.DIRECT&&(r.peerUser=o[0]),r.userIsModerator=function(e){return!!e&&r.moderators.some(function(t){return t.userId===e.userId})},r}function c(e){if(!e||e.isExtended)return e;var t=Object.create(e);return t.isExtended=!0,t}function l(e){var n=e&&e.accounts&&e.accounts[0],i=n&&n.telephonyConfiguration;if(i){if(i.phoneNumber=r.format(i.phoneNumber)||"",i.callerId=r.format(i.callerId)||"",i.reroutingPhoneNumber=r.format(i.reroutingPhoneNumber)||"",e.reroutingPhoneNumber=i.reroutingPhoneNumber,e.ondSipAuthenticationHash=i.ondSipAuthenticationHash,e.onsSipAuthenticationHash=i.onsSipAuthenticationHash,e.associatedTelephonyUserID=i.associatedTelephonyUserID,e.associatedTelephonyUserType=i.associatedTelephonyUserType,e.previousAlternativeNumbers=(i.previousAlternativeDevice||[]).map(o.cleanPhoneNumber),e.reroutingPhoneNumber){var a=o.cleanPhoneNumber(e.reroutingPhoneNumber);e.previousAlternativeNumbers.includes(a)||e.previousAlternativeNumbers.unshift(a)}e.associatedTelephonyUserID?(e.isOsBizCTIEnabled=e.associatedTelephonyUserType===t.GtcTrunkType.OSBIZ_TRUNK_TYPE&&i.isOsBizCTIEnabled,e.isATC=e.isOsBizCTIEnabled||e.associatedTelephonyUserType===t.GtcTrunkType.ATC_TRUNK_TYPE,e.isSTC=e.associatedTelephonyUserType===t.GtcTrunkType.SUB_TRUNK_TYPE,(e.isATC||e.isSTC)&&(e.associatedGTCUserId=e.associatedTelephonyUserID)):(e.isOsBizCTIEnabled=!1,e.isATC=!1,e.isSTC=!1)}else delete e.associatedGTCUserId,delete e.reroutingPhoneNumber,delete e.ondSipAuthenticationHash,delete e.onsSipAuthenticationHash,delete e.associatedTelephonyUserID,delete e.associatedTelephonyUserType,delete e.isATC,delete e.isSTC}var d=function(e,t){return n.setTimeout(e,t)};d.cancel=function(e){e&&n.clearTimeout(e)};var u=function(e,t,i){if(void 0===i)return n.setInterval(e,t);if(i<=0)return null;var r=0,o=null;return o=n.setInterval(function(){e(),++r>=i&&n.clearInterval(o)},t)};u.cancel=function(e){e&&n.clearInterval(e)};var C=null;e.ClientApiHandlerSingleton.getInstance=function(){return C};var E=null;return e.UserToUserHandlerSingleton.getInstance=function(){return E},e.SdkServices=function(t,r){C=t,E=r,this.rootScope={localUser:null,clientVersion:"",browser:o.getBrowserInfo(),circuitLabs:{},$$phase:!0,$apply:function(e){e&&e()},$digest:function(){},i18n:{localize:function(e){return e},map:{res_Unknown:"Unknown"}},localize:function(e){return e}},e.Conversation={extend:a.bind(null,this.rootScope)},e.UserProfile={extend:c.bind(null),syncTelephonyConfig:l.bind(null)},this.PubSubSvc=new e.PubSubSvcImpl(i),this.ExtensionSvc=new e.ExtensionSvcImpl(this.rootScope,d,n,s,i,this.PubSubSvc,null),this.SdkHelperSvc=new e.SdkHelperSvcImpl(this.rootScope,s,i,this.PubSubSvc),this.AtcRegistrationSvc=new e.AtcRegistrationSvcImpl(this.rootScope,d,i,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.DeviceDiagnosticSvc=new e.DeviceDiagnosticSvcImpl(this.rootScope,d,i,this.PubSubSvc,null),this.CircuitCallControlSvc=new e.CircuitCallControlSvcImpl(this.rootScope,d,u,n,s,i,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc,null,this.SdkHelperSvc,this.DeviceDiagnosticSvc),this.CstaSvc=new e.CstaSvcImpl(this.rootScope,d,i,this.PubSubSvc,this.CircuitCallControlSvc,this.AtcRegistrationSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.CallControlSvc=new e.CallControlSvcImpl(this.rootScope,s,d,i,this.PubSubSvc,this.CircuitCallControlSvc,this.SdkHelperSvc,this.CstaSvc,null,null,this.SdkHelperSvc,this.SdkHelperSvc),e.Conversation=null,e.UserProfile=null,C=null,E=null},e}(e=function(t){"use strict";var n=t.Enums.CallState,i=t.Enums.CstaCallState,r=t.Constants,o=t.Enums,a=t.Enums.Targets,s=t.Enums.TransferCallFailedCauses,c=t.Utils,l=t.UserToUserHandlerSingleton;return t.CallControlSvcImpl=function(t,d,u,C,E,T,p,S,I,f,R,v){C.debug("New Service: CallControlSvc");var A,g=2e3,_=[],N=this,m=l.getInstance();function h(e,t,n){return n=n||function(){},e&&t&&t.userId?I?w(e)?!!t.isMeetingPointInvitee||(C.warn("[CallControlSvc]: Cannot invoke CMR action - Participant is not CMR invitee"),n("Not CMR invitee"),!1):(C.warn("[CallControlSvc]: Cannot invoke CMR action - There is no local call"),n("Call invalid"),!1):(C.error("[CallControlSvc]: Cannot invoke CMR action - MeetingPointSvc is not initialized"),n("MeetingPointSvc not initialized"),!1):(n("Invalid arguments"),!1)}function O(e){_.some(function(t,n){return!!e.sameAs(t)&&(_.splice(n,1),!0)})}function D(e){return _.find(function(t){return t.callId===e})||null}function y(){for(var e=null,t=0;t<_.length;t++){if(_[t].state===n.ActiveRemote)return _[t];_[t].checkCstaState(i.Conference)&&(e=_[t])}return e}function P(e){C.debug("[CallControlSvc]: Publish /call/state event. callId = "+e.callId+", state = "+e.state.name),E.publish("/call/state",[e])}function b(e){e.terminate()}function U(e){e&&(C.debug("[CallControlSvc]: Publish /conversation/update event. convId = ",e.convId),E.publish("/conversation/update",[e]))}function L(a){if(a)if(a.isAtcRemote){var s=p.getConversationFromCache(a.convId);if(s&&s.isTelephonyConv){if(!a.checkCstaState([i.Idle,i.Terminated])&&(function(e){for(var t=0;t<_.length;t++)if(e.sameAs(_[t]))return C.debug("[CallControlSvc]: Updating call with callId = "+e.callId),void(_[t]=e);_.push(e)}(a),!s.call||s.call.isHandoverInProgress&&!s.call.sameAs(a)||s.call.isAtcRemote&&(s.call.isHolding()||s.call.isHoldInProgress()))){if(s.call&&s.call.isHandoverInProgress){var c=s.call;c.clearAtcHandoverInProgress(),a.establishedTime=c.establishedTime,c.isAtcRemote?O(c):T.removeCallFromList(c),c.terminateReason=o.CallClientTerminatedReason.USER_ENDED,b(c),C.debug("[CallControlSvc]: Publish /call/ended event."),E.publish("/call/ended",[c,!1])}s.call=a}switch(a.getCstaState()){case i.Initiated:case i.Offered:case i.ExtendedRinging:a.setState(n.Started);break;case i.Delivered:a.setState(n.Delivered);break;case i.Busy:a.setState(n.Busy);break;case i.Ringing:a.checkState(n.Ringing)||(a.setState(n.Ringing),f&&f.show({type:e.Enums.NotificationType.INCOMING_VOICE_CALL,user:a.peerUser,extras:{conversation:s,call:a}}));break;case i.Idle:case i.TransferFailed:case i.Failed:a.setState(n.Idle);break;case i.Terminated:a.setState(n.Terminated);break;default:a.setState(n.ActiveRemote)}a.state!==n.Idle&&a.state!==n.Terminated&&a.state!==n.Started?(U(s),P(a),!S.isPrimaryClient()||a.state===n.Ringing||t.localUser.isOsBizCTIEnabled&&T.getActiveRemoteCall().empty()||v.setPresenceWithLocation(r.PresenceState.BUSY)):a.state!==n.Idle&&a.state!==n.Terminated||(b(a),O(a),C.debug("[CallControlSvc]: Publish /call/ended event"),E.publish("/call/ended",[a,!1]),a.isHandoverInProgress||s.call&&s.call.sameAs(a)&&(s.call=y(),s.call||T.getActiveCall()||v.setPresenceWithLocation(r.PresenceState.AVAILABLE)),U(s))}else C.warn("[CallControlSvc]: Call in /atccall/info event is not for telephony conversation")}else P(a);else C.warn("[CallControlSvc]: Invalid call object in /atccall/info event")}function M(e){var t=function(){for(var e=0;e<_.length;e++)if(_[e].isHandoverInProgress)return _[e];return null}();if(t){t.atcCallInfo.transferCb&&(t.atcCallInfo.transferCb(null,null,e),delete t.atcCallInfo.transferCb);var n=p.getConversationFromCache(e.convId);e.establishedTime=t.establishedTime,b(t),O(t),n&&n.call&&(n.call=e,U(n))}}function w(e){var t=T.getActiveCall();return!!t&&e===t.callId}function G(e){C.debug("[CallControlSvc]: Publish /call/nativeDial event"),E.publish("/call/nativeDial",[e])}function H(){if(!t.localUser.isOsBizCTIEnabled)return null;var e=T.findOsBizFirstCall();if(!e)return null;var n=T.findOsBizSecondCall();if(!n)return null;var i=e.checkCstaState(o.CstaCallState.Holding);return{activeCall:i?n:e,heldCall:i?e:n}}function k(e,n,i){var r;"object"==typeof n&&(r=n);var a={content:{type:o.StcMessage.TRANSFER,phoneNumber:t.localUser.callerId,transferRequest:{sessionId:e.callId,target:{dn:r?r.peerUser.phoneNumber:n,sessionId:r?r.callId:void 0}}},destUserId:t.localUser.associatedTelephonyUserID};m.sendStcRequest(a,function(e,t){if(e||t&&t.error){var n=s.Unreachable.name;t&&s[t.error]&&(n=t.error),i&&i(s[n].ui)}else r&&r.isPresent()&&!r.state.established&&N.endCall(r.callId)})}return E.subscribe("/atccall/info",function(e){C.debug("[CallControlSvc]: Received /atccall/info event"),L(e)}),E.subscribe("/atccall/replace",function(e){C.debug("[CallControlSvc]: Received /atccall/replace event"),M(e)}),E.subscribe("/call/ended",function(e){if(C.debug("[CallControlSvc]: Received /call/ended event"),e.sendDtmfTimer&&(u.cancel(e.sendDtmfTimer),e.sendDtmfTimer=null),delete e.dtmfDigits,e.isAtcRemote)e.clearAtcHandoverInProgress(),O(e);else{var t=p.getConversationFromCache(e.convId);t&&t.isTelephonyConv&&!t.call&&(t.call=y()||_.find(function(e){return e.state===n.Ringing})||null,t.call&&U(t)),e.isRemote||T.getActiveCall()||(S.isPrimaryClient()&&y()||v.setPresenceWithLocation(r.PresenceState.AVAILABLE),v.cancelAutoSnooze())}}),E.subscribe("/atccall/hangingcall",function(e){var t;C.debug("[CallControlSvc]: Received /atccall/hangingcall event"),t=e,p.getTelephonyConversation(function(e,n){!e&&n&&n.call&&n.call.atcCallInfo.getCstaCallId()===t&&(n.call=null,U(n))})}),E.subscribe("/call/state",function(e){C.debug("[CallControlSvc]: Received /call/state event"),e&&e.state.established&&(e.isRemote||v.setPresenceWithLocation(r.PresenceState.BUSY),e.dtmfDigits&&function(e){var t=e.dtmfDigits;if(t){delete e.dtmfDigits;var n=t.match(/^\,*/)[0].length,i=n*g+1e3;n&&(t=t.substr(n)),e.sendDtmfTimer=u(function(){e.sendDtmfTimer=null,e.isPresent()&&(C.debug("[CallControlSvc]: Send delayed DTMF digits "+t+" for call "+e.callId),N.sendDigits(e.callId,t))},i)}}(e))}),E.subscribe("/screenshare/started",function(){C.info("[CallControlSvc]: Received /screenshare/started event. Screenshare was started. Start Auto-Snooze."),v.startAutoSnooze()}),E.subscribe("/screenshare/ended",function(){C.info("[CallControlSvc]: Received /screenshare/ended event. Screenshare was ended. Resume from Auto-Snooze."),v.cancelAutoSnooze()}),E.subscribe("/call/action",function(e){switch(C.debug("[CallControlSvc]: Received /call/action event with action ",e.type),e.type){case o.NotificationActionType.ANSWER:N.answerCall(e.callId,{audio:!0,video:!1,desktop:!1});break;case o.NotificationActionType.DECLINE:N.endCall(e.callId);break;case o.NotificationActionType.IGNORE:return void N.ignoreCall(e.callId);case o.NotificationActionType.ALLOW:N.offerScreenControl(e.callId,e.userId);break;case o.NotificationActionType.REJECT:return void N.rejectScreenControlRequest(e.callId,e.userId);case o.NotificationActionType.SCREEN_SHARE_OFF:return void N.removeScreenShare(e.callId);case o.NotificationActionType.MUTE:return void N.mute(e.callId);case o.NotificationActionType.UN_MUTE:return void N.unmute(e.callId);case o.NotificationActionType.REMOTE_CONTROL_OFF:return void N.stopScreenControl(e.callId)}var t=N.findConversationByCallId(e.callId);t&&(C.debug("[CallControlSvc]: Publish /conversation/navigate event"),E.publish("/conversation/navigate",[t]))}),c.isMobile()&&m.on("MOBILE_BREAKOUT.DIAL",function(e){C.info("[CallControlSvc]: Received UserToUser MOBILE_BREAKOUT.DIAL event."),t.$apply(function(){!function(e){if(e&&e.phoneNumber){C.debug("[CallControlSvc]: Received MobileBreakout.DIAL event");var t={phoneNumber:e.phoneNumber,autoDial:e.autoDial,userName:e.userName},n=[];e.conversationId&&n.push(p.getConversationPromise(e.conversationId)),e.userId&&n.push(R.getUserPromise(e.userId)),n.length?d.all(n).then(function(e){e&&e.forEach(function(e){e.userId?t.user=e:t.conversation=e}),G(t)}):G(t)}}(e)})}),this.initActiveSessionsForSdk=T.initActiveSessionsForSdk,this.setDisableRemoteVideoByDefault=T.setDisableRemoteVideoByDefault,this.getDisableRemoteVideoByDefault=T.getDisableRemoteVideoByDefault,this.setClientDiagnosticsDisabled=T.setClientDiagnosticsDisabled,this.getCalls=T.getCalls,this.getPhoneCalls=T.getPhoneCalls,this.getActiveCall=T.getActiveCall,this.isConnectionInProgress=T.isConnectionInProgress,this.getIncomingCall=T.getIncomingCall,this.getActiveRemoteCall=T.getActiveRemoteCall,this.joinGroupCall=T.joinGroupCall,this.makeCall=T.makeCall,this.makeAtcCall=function(e,n,i){var r=c.cleanPhoneNumber("object"==typeof n?n.dialedDn:n);"object"==typeof n?n.dialedDn=r:n={dialedDn:r},n.dtmfDigits&&(n.dtmfDigits=c.cleanPhoneNumberDigitsWithPin(n.dtmfDigits));var o=function(e){return _.find(function(t){return t.atcCallInfo.getPosition()===e})||null}(e)||t.localUser.isOsBizCTIEnabled&&N.getActiveCall();S.startCall(o,e,n,i)},this.makeEchoTestCall=T.makeEchoTestCall,this.makeEchoTestCallWithOptions=T.makeEchoTestCallWithOptions,this.dialNumber=T.dialNumber,this.dialPhoneNumber=T.dialPhoneNumber,this.dialUsingDefaultDevice=function(e,n){n=n||function(){};var i=e&&e.dialedDn;i&&c.PHONE_DIAL_PATTERN.test(i)?(C.debug("[CallControlSvc]: Calling "+i+" with name: "+e.toName),p.getTelephonyConversation(function(r,o){if(r||!o)return C.debug("[CallControlSvc]: Error on getTelephonyConversation. ",r),void n(r||"No telephony conversation");if(o.call&&o.call.consultation){var s=o.call.getPosition()||A;if(s&&s!==a.WebRTC||t.localUser.isOsBizCTIEnabled)return C.info("[CallControlSvc]: Start consultation from "+s.name+" to ",i),N.makeAtcCall(s,e,n),void(o.call.consultation=!1)}else if(A&&(A!==a.WebRTC||o.call&&t.localUser.isOsBizCTIEnabled))return C.info("[CallControlSvc]: Make call from "+A.name+" to ",i),void N.makeAtcCall(A,e,n);e.mediaType=e.mediaType||{audio:!0,video:!1,desktop:!1},N.dialPhoneNumber(e,n)})):n("Missing or wrong number")},this.setDefaultCallDevice=function(e){e&&e.name&&Object.keys(a).some(function(t){return e.name===a[t].name&&(A=a[t],C.debug("[CallControlSvc]: Set defaultCallDevice to ",A.name),!0)})},this.startConference=T.startConference,this.startConferenceWithOptions=T.startConferenceWithOptions,this.cannotHandleSecondCall=function(){var e=N.getIncomingCall();if(!e)return!1;var t=N.getActiveCall();return!!t&&(t.isTelephonyCall&&!e.isTelephonyCall||!t.isTelephonyCall&&t.checkState([n.Active,n.Waiting]))},this.answerCall=function(e,t,n){if(T.getEstablishedLocalPhoneCalls().length>1)return C.warn("[CallControlSvc]: answerCall - There are already 2 local phone calls"),void(n&&n("Can not answer the call"));var i=T.findCall(e);if(i)T.answerCall(e,t,n);else{i=D(e);var o=T.getActiveCall(),a=T.getIncomingCall(),s=T.getCallToPickup();i?o&&!o.isTelephonyCall?T.endActiveCall(function(){S.pullRemoteCall(e,n)}):a&&!a.isTelephonyCall?T.endCallWithCauseCode(a.callId,r.InviteRejectCause.BUSY,function(){S.pullRemoteCall(e,n)}):S.pullRemoteCall(e,n):s&&s.callId===e?T.pickupTeamCall(e,t,n):(C.warn("[CallControlSvc]: answerCall - There is no alerting call"),n&&n("No alerting call"))}},this.answerCallOnDevice=function(e,n,i,r){if(r=r||function(){},i&&i!==a.WebRTC){var o=T.findCall(e);o?o.isTelephonyCall?t.localUser.isOsBizCTIEnabled&&i!==a.VM?S.answerCallRemoteDevice(o.atcCallInfo.getCstaCallId(),r):S.deflect(e,i,null,r):(C.warn("[CallControlSvc]: answerCallOnDevice - The active call is not a telephony call"),r("Not telephony call")):(o=D(e))?o.pickupNotification?S.pickupCall(e,i,r):o.getPosition()!==i?S.deflect(e,i,null,r):S.answer(e,r):(C.warn("[CallControlSvc]: answerCallOnDevice - There is no alerting call"),r("No alerting call"))}else N.answerCall(e,n,r)},this.endCall=function(e,t){N.endCallWithCauseCode(e,null,t)},this.endCallWithCauseCode=function(e,i,r){var o=T.findCall(e);o?o.isOsBizFirstCall?S.reconnect(o,T.findOsBizSecondCall(),r):o.isOsBizSecondCall?S.reconnect(o,T.findOsBizFirstCall(),r):o.isRemote?T.endRemoteCall(e,r):i?T.endCallWithCauseCode(e,i,r):(t.localUser.isOsBizCTIEnabled&&o.isTelephonyCall&&o.checkState(n.Ringing)&&S.endCallOnRemoteDevices(o.atcCallInfo.getCstaCallId()),T.endCall(e,r)):(o=D(e))&&_.length>1&&N.reconnectCall(e,r)||(o?S.endRemoteCall(e,r):(C.warn("[CallControlSvc]: endCall invoked without a valid call. callId = ",e),r&&r("Call not found")))},this.endConference=T.endConference,this.startScreenShare=T.startScreenShare,this.addScreenShare=T.addScreenShare,this.selectMediaToShare=T.selectMediaToShare,this.removeScreenShare=T.removeScreenShare,this.requestScreenControl=T.requestScreenControl,this.offerScreenControl=T.offerScreenControl,this.rejectScreenControlRequest=T.rejectScreenControlRequest,this.stopScreenControl=T.stopScreenControl,this.addAudio=T.addAudio,this.removeAudio=T.removeAudio,this.enableRemoteAudio=T.enableRemoteAudio,this.disableRemoteAudio=T.disableRemoteAudio,this.addVideo=T.addVideo,this.removeVideo=T.removeVideo,this.toggleRemoteVideo=T.toggleRemoteVideo,this.toggleVideo=T.toggleVideo,this.changeHDVideo=T.changeHDVideo,this.changeVideoResolution=T.changeVideoResolution,this.renegotiateMedia=T.renegotiateMedia,this.setMediaType=T.setMediaType,this.addMediaStream=T.addMediaStream,this.removeMediaStream=T.removeMediaStream,this.pullRemoteCall=function(e,t,n){var i=T.findCall(e);if(i)T.pullRemoteCall(e,t,n);else if(i=D(e)){var r=T.getActiveCall();if(r)return r.isTelephonyCall?void T.holdCall(r.callId,function(){S.pullRemoteCall(e,n)}):void T.endActiveCall(function(){S.pullRemoteCall(e,n)});S.pullRemoteCall(e,n)}else C.warn("[CallControlSvc]: pullRemoteCall invoked without a valid call"),n&&n("No active remote call")},this.pushLocalCall=S.pushLocalCall,this.getAtcCalls=function(){return _},this.swapCall=function(e,t){t=t||function(){};var n=H();if(n)S.alternate(n.heldCall,n.activeCall,t);else{var r=T.findCall(e);if(r&&r.isTelephonyCall&&!r.isRemote)T.swapCall(e,t);else{if(_.length>1){var o=_.find(function(t){return t.isHolding()&&t.callId===e});if(o){var a=o.atcCallInfo.getPosition(),s=_.find(function(t){return t.checkCstaState([i.Active,i.Conference])&&t.atcCallInfo.getPosition()===a&&t.callId!==e});if(s)return void S.alternate(o,s,t)}}C.warn("[CallControlSvc]: swapCall possible only with 2 calls"),t("No calls to swap")}}},this.mergeCall=function(e,n){n=n||function(){};var r,o,a=T.getPhoneCalls(!0);if(_.length<=1&&a.length<=1)return C.warn("[CallControlSvc]: mergeCall possible only with 2 calls"),void n("No calls to merge");if(a.length>1&&(r=T.findActivePhoneCall(!0),o=T.findHeldPhoneCall(!0),r&&o))o.isAtcConferenceCall()&&!t.localUser.isOsBizCTIEnabled?N.swapCall(o.callId,function(e){e?(C.warn("[CallControlSvc]: Swap call failed. Cannot proceed with merge call."),n(e)):S.conference(r,o,n)}):S.conference(o,r,n);else{if(r=_.find(function(t){return t.checkCstaState([i.Active,i.Conference])&&t.callId===e})){var s=r.atcCallInfo.getPosition();if(o=_.find(function(t){return t.isHolding()&&t.atcCallInfo.getPosition()===s&&t.callId!==e}))return void S.conference(o,r,n)}C.warn("[CallControlSvc]: mergeCall possible only with 2 calls"),n("No calls to merge")}},this.transferCall=function(e,t,n){n=n||function(){};var i=H();if(i)S.consultationTransfer(i.activeCall,i.heldCall,n);else{var r,o=T.findCall(e),a=T.getPhoneCalls(!0);if(t=c.cleanPhoneNumber(t),o&&1===a.length)o.isTelephonyCall&&o.atcCallInfo?S.transfer(o,t,n):o.isSTC?k(o,t,n):(C.warn("[CallControlSvc]: The active call is not a telephony call"),n("The active call is not a telephony call"));else{if(o&&2===a.length)return r=T.findHeldPhoneCall(!0),void(o.isTelephonyCall&&o.atcCallInfo?S.consultationTransfer(o,r,n):o.isSTC?k(o.state.established?o:r,o.state.established?r:o,n):(C.warn("[CallControlSvc]: The active call is not a telephony call"),n("The active call is not a telephony call")));if(_.length>0){if(1===_.length&&!_[0].isHolding())return o=_[0],void S.transfer(o,t,n);if(o=_.find(function(t){return!t.isHolding()&&t.callId===e})){var s=o.atcCallInfo.getPosition();if(r=_.find(function(t){return t.isHolding()&&t.atcCallInfo.getPosition()===s&&t.callId!==e}))return void S.consultationTransfer(o,r,n)}}C.warn("[CallControlSvc]: transferCall possible only with 1 or 2 calls"),n("Not enough calls for the transfer")}}},this.holdCall=function(e,n){n=n||function(){};var i=T.findCall(e);i?i.isHolding()?(C.warn("[CallControlSvc]: Call is not in valid state"),n("Call is not in valid state")):t.localUser.isOsBizCTIEnabled&&i.isTelephonyCall?S.holdWithConsultationCall(i,n):T.holdCall(e,n):(i=D(e))?i.isHolding()?(C.warn("[CallControlSvc]: Call is not in valid state"),n("Call is not in valid state")):S.hold(i,n):(C.warn("[CallControlSvc]: holdCall invoked without a valid call"),n("Call not found"))},this.retrieveCall=function(e,n){n=n||function(){};var i=T.findCall(e);i?i.isHolding()?t.localUser.isOsBizCTIEnabled&&i.isTelephonyCall?S.retrieveWithReconnectCall(i,n):T.retrieveCall(e,n):(C.warn("[CallControlSvc]: Call is not in valid state"),n("Call is not in valid state")):(i=D(e))?i.isHolding()?S.retrieve(i,n):(C.warn("[CallControlSvc]: Call is not in valid state"),n("Call is not in valid state")):(C.warn("[CallControlSvc]: retrieveCall invoked without a valid call"),n("Call not found"))},this.reconnectCall=function(e,t){if(_.length>1){var n=_.find(function(t){return!t.isHolding()&&t.callId===e});if(n){var i=n.atcCallInfo.getPosition(),r=_.find(function(t){return t.isHolding()&&t.atcCallInfo.getPosition()===i&&t.callId!==e});if(r)return S.reconnect(n,r,t),!0}}return C.warn("[CallControlSvc]: reconnectCall possible only with 2 calls"),t("No calls to reconnect"),!1},this.ignoreCall=function(e,t){var n=D(e);n&&n.pickupNotification?S.ignoreCall(n,t):t&&t("No pickup call")},this.hideRemoteCall=T.hideRemoteCall,this.dropParticipant=T.dropParticipant,this.addParticipantToCall=T.addParticipantToCall,this.addParticipantToRtcSession=T.addParticipantToRtcSession,this.mute=T.mute,this.unmuteLocally=T.unmuteLocally,this.unmute=T.unmute,this.toggleMute=T.toggleMute,this.muteParticipant=function(e,t,n){if(n=n||function(){},e&&t){if(!w(e))return C.warn("[CallControlSvc]: muteParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!I)return C.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_MuteParticipantFailed");I.muteMeetingPoint(t.userId,function(i){i?(C.warn("[CircuitCallControlSvc]: Failed to mute Meeting Point locally"),n("res_MuteParticipantFailed")):T.muteParticipant(e,t,n)})}else T.muteParticipant(e,t,n)}else n("Missing callId or participant")},this.hasUnmutedParticipants=T.hasUnmutedParticipants,this.hasScreenControlFeature=T.hasScreenControlFeature,this.muteRtcSession=T.muteRtcSession,this.unmuteParticipant=function(e,t,n){if(n=n||function(){},e&&t){if(!w(e))return C.warn("[CallControlSvc]: unmuteParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!I)return C.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_UnmuteParticipantFailed");I.unmuteMeetingPoint(t.userId,function(e){e?(C.warn("[CircuitCallControlSvc]: Failed to unmute Meeting Point locally"),n("res_UnmuteParticipantFailed")):n()})}else T.unmuteParticipant(e,t,n)}else n("Missing callId or participant")},this.toggleMuteParticipant=function(e,t,n){e&&t?t.muted?N.unmuteParticipant(e,t,n):N.muteParticipant(e,t,n):n("Missing callId or participant")},this.toggleVideoParticipant=function(e,t,n){if(n=n||function(){},e&&t&&t.userId){if(!w(e))return C.warn("[CallControlSvc]: toggleVideoParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!I)return C.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_StartVideoParticipantFailed");I.toggleVideoMeetingPoint(t.userId,function(e){e?(C.warn("[CallControlSvc]: Failed to toggle video MeetingPoint participant"),n("res_ToggleVideoFailed")):n()})}else C.warn("[CallControlSvc]: Cannot toggle video MeetingPoint participant: ",t.userId),n("res_StartVideoParticipantFailed")}else n("Missing callId or participant")},this.toggleScreenSharing=function(e,t,n){h(e,t,n)&&(n=n||function(){},I.toggleScreenShareMeetingPoint(t.userId,function(e){e?(C.warn("[CallControlSvc]: Failed to toggle screen share for Meeting Room invitee. ",e),n("Cannot toggle Screen Sharing")):n()}))},this.toggleWhiteboard=function(e,t,n){h(e,t,n)&&(n=n||function(){},I.toggleWhiteboardMeetingPoint(t.userId,function(e){e?(C.warn("[CallControlSvc]: Failed to toggle whiteboard for Meeting Room invitee. ",e),n("Cannot toggle Whiteboard")):n()}))},this.toggleVideoFeature=function(e,t,n){h(e,t,n)&&(n=n||function(){},I.toggleVideoFeatureMeetingPoint(t.userId,function(e){e?(C.warn("[CallControlSvc]: Failed to toggle video for Meeting Room invitee. ",e),n("Cannot toggle Video")):n()}))},this.toggleLayout=function(e,t,n,i){h(e,n,i)&&(t?(i=i||function(){},I.toggleLayoutMeetingPoint(n.userId,t,function(e,t){e?(C.warn("[CallControlSvc]: Failed to toggle layout MeetingPoint participant"),i("Cannot toggle Layout")):i(null,t)})):i("Missing layout action"))},this.swapDisplays=function(e,t,n){h(e,t,n)&&(n=n||function(){},I.swapDisplays(t.userId,function(e){e?(C.warn("[CallControlSvc]: Failed to swap displays MeetingPoint participant"),n("Cannot swap displays")):n()}))},this.isAllowedToAddVideoFeature=function(e,t,n){return!!(e&&e.isMeetingPointInvitee&&e.cmrData)&&!(1!==e.cmrData.displayCount||!t||(e.cmrData.isLayoutsEnabled?!n:e.cmrData.primaryScreen))},this.stopRingingTone=T.stopRingingTone,this.endActiveCall=T.endActiveCall,this.startRecording=T.startRecording,this.stopRecording=T.stopRecording,this.switchRecordingLayout=T.switchRecordingLayout,this.submitCallQualityRating=T.submitCallQualityRating,this.raiseQuestion=T.raiseQuestion,this.inviteToStage=T.inviteToStage,this.inviteToStageAnswer=T.inviteToStageAnswer,this.inviteToStageCancel=T.inviteToStageCancel,this.removeFromStage=T.removeFromStage,this.getQuestions=T.getQuestions,this.updateQuestionState=T.updateQuestionState,this.openCurtain=T.openCurtain,this.closeCurtain=T.closeCurtain,this.getNodeState=T.getNodeState,this.canSendWebRTCDigits=T.canSendWebRTCDigits,this.sendDigits=function(e,t,n){if(n=n||function(){},!t)return C.warn("[CallControlSvc]: sendDigits invoked without any digit"),void n("No digits");var i=T.findCall(e);i?i.sessionCtrl.canSendDTMFDigits()?T.sendDigits(e,t,n):i.atcCallInfo?S.generateDigits(i,t,function(e){e?n("res_SendDtmfFailed"):n()}):n("res_SendDtmfFailed"):(i=D(e))?S.generateDigits(i,t,n):(C.warn("[CallControlSvc]: SendDigits invoked without a valid call"),n("Call not found"))},this.disableIncomingVideo=T.disableIncomingVideo,this.enableIncomingVideo=T.enableIncomingVideo,this.toggleParticipantPointer=T.toggleParticipantPointer,this.sendDataMessage=T.sendDataMessage,this.findCall=T.findCall,this.findConversationByCallId=function(e){var t=p.getConversationByRtcSession(e);if(t)return t;for(var n=0;n<_.length;n++)if(_[n].callId===e)return p.getConversationFromCache(_[n].convId);return null},this.sendParticipantPointer=T.sendParticipantPointer,this.sendParticipantDrawing=T.sendParticipantDrawing,this.getCallDevices=S.getCallDevices,this.getPushDevices=S.getPushDevices,this.getAnswerDevices=function(e){if(e&&"object"==typeof e)return S.getAnswerDevices(e);var t=T.findCall(e)||D(e);return S.getAnswerDevices(t)},this.updateActiveCallMediaDevices=T.updateActiveCallMediaDevices,this.addSimulatedParticipants=T.addSimulatedParticipants,this.canStartScreenShare=T.canStartScreenShare,this.addConferenceAsGuest=T.addConferenceAsGuest,this.removeConferenceAsGuest=T.removeConferenceAsGuest,this.testCandidatesCollection=T.testCandidatesCollection,this.findOsBizSecondCall=T.findOsBizSecondCall,this.getConferenceParticipants=T.getConferenceParticipants,this},t}(e=function(t){"use strict";var n=e.Enums.AgentState,i=t.AtcCallInfo,r=t.Enums.AtcMessage,o=t.Enums.AtcRegistrationState,a=t.AtcRemoteCall,s=t.BusyHandlingOptions,c=t.Enums.CallDirection,l=t.Enums.CallState,d=t.ClientApiHandlerSingleton,u=t.Constants,C=t.Enums.CstaCallState,E=t.CstaParser,T=t.Enums.JournalEntryTypes,p=t.LocalCall,S=t.Enums.MissedReasonTypes,I=e.PhoneNumberFormatter,f=e.Enums.RedirectionTypes,R=t.RoutingOptions,v=t.Enums.Targets,A=t.UserToUserHandlerSingleton,g=t.Utils,_=t.Enums.TransferCallFailedCauses;return t.CstaSvcImpl=function(e,N,m,h,O,D,y,P){m.debug("New Service: CstaSvc");var b=4e3,U=5e3,L=2e3,M=["connected","hold","queued"],w=["connected","hold"],G="Number not available",H="02000000000000000000000000000000",k=/Forward/,V=3,F=6e4,B=2e3,x=2e3,W=this,Y={forwardList:[]},K=A.getInstance(),q=d.getInstance(),j=new E,Q=null,z=null,X=null,J=null,$={},Z=null,ee=[],te={},ne={},ie=!1,re=!0,oe=!0,ae={},se={},ce=[],le=[],de=!1,ue=null,Ce=null,Ee=null,Te=null,pe=!1,Se=null,Ie=null,fe=null,Re=null,ve=!1,Ae=0,ge=0,_e=null,Ne=null;function me(e,t,n,i,r){e.setPeerUser(t,i);var o=N(function(){o=null,e.isPresent()&&(r&&r(),r=null)},L,!1);y.startReverseLookUp(n,function(n){N.cancel(o),e.isPresent()&&(n&&e.setPeerUser(t,n.displayName,n.userId),r&&r())})}function he(e,t,n,i,r,o){if(!e.redirectingUser||!e.redirectingUser.redirectionType){e.setRedirectingUser(t,n,i,null,r);var a=N(function(){a=null,e.isPresent()&&(o&&o(),o=null)},L,!1);y.startReverseLookUp(n,function(i){N.cancel(a),e.isPresent()&&(i&&e.setRedirectingUser(t,n,i.displayName,i.userId,r),o&&o())})}}function Oe(){if(le.length){var e=le.splice(0,1);y.startPhoneCallSearch(e[0].phoneNumber,function(){var t=y.getUserSearchList().slice(0),n=e[0].call;delete e[0].call;var i=null;(i=1===t.length?n.addParticipant({userId:t[0].userId,phoneNumber:e[0].phoneNumber,displayName:t[0].displayName,participantId:e[0].participantId}):n.addParticipant(e[0]))&&Q&&(m.debug("[CstaSvc]: Publish /atccall/participant/added"),h.publish("/atccall/participant/added",[n.callId,i])),N(Oe,0)})}else de=!1}function De(){e.localUser.isATC&&((Q=Q||P.getCachedTelephonyConversation())||P.getTelephonyConversationPromise().then(function(e){Q=e}).catch(function(){m.debug("[CstaSvc]: No telephony conversation found")}),Object.assign(Y,D.getAtcRegistrationData()),z=function(){var e=O.getActiveCall();if(!e||!e.isTelephonyCall)return null;var t=ye(e);if(t)return t;var n=Object.create(e);return n.atcCallInfo=e.atcCallInfo||new i,ee.push(n),n}(),X=function(){var e=O.findHeldPhoneCall();if(!e)return null;var t=ye(e);if(t)return t;var n=Object.create(e);return n.atcCallInfo=e.atcCallInfo||new i,ee.push(n),n}(),J=Pe(),Z=be(),ee.length>0&&(ee=ee.filter(function(e){return!e.checkState(l.Terminated)||(z===e&&(z=null),X===e&&(X=null),J===e&&(J=null),Z===e&&(Z=null),!1)})),z||J||X||Z||ee.empty())}function ye(e){for(var t=0;t<ee.length;t++)if(ee[t].callId===e.callId){var n=ee[t].atcCallInfo;return e.peerUser.phoneNumber!==ee[t].peerUser.phoneNumber&&n.clearServicesPermitted(),ee[t]=e,e.atcCallInfo&&e.atcCallInfo.cstaConn||(ee[t].atcCallInfo=n),ee[t]}return null}function Pe(){var e=O.getIncomingCall();if(!e||!e.isTelephonyCall)return null;var t=ye(e);if(t)return t;var n=Object.create(e);return n.atcCallInfo=e.atcCallInfo||new i,ee.push(n),n}function be(){var e=O.getActiveRemoteCall()[0];if(!e||!e.isTelephonyCall)return null;var t=ye(e);return t||(e.atcCallInfo=e.atcCallInfo||new i,ee.push(e),e)}function Ue(e,t){if($[e]){m.debug("[CstaSvc]: Remove remote call with Call Id = "+e);var n=$[e];!t&&Le(n),n.setCstaState(C.Idle),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n]),delete $[e]}}function Le(t){if(!e.localUser.noCallLog&&!t.pickupNotification)if(t){if(!t.atcCallInfo.getIgnoreCall()&&(t.isAtcRemote||t.isOsBizSecondCall)){if(!Q)return void m.error("[CstaSvc]: No telephony conversation");if(!t.peerUser.phoneNumber&&t.peerUser.displayName===Q.peerUser.displayName)return void m.warn("[CstaSvc]: This call has no peer display information.");var n=t.atcCallInfo.originalPartnerDisplay&&t.atcCallInfo.originalPartnerDisplay.fqn&&t.atcCallInfo.originalPartnerDisplay.fqn!==t.atcCallInfo.peerFQN,i={phoneNumber:n?t.atcCallInfo.originalPartnerDisplay.dn:t.peerUser.phoneNumber,displayName:n?t.atcCallInfo.originalPartnerDisplay.name:t.peerUser.displayName,userId:n?Q.peerUser.userId:t.peerUser.userId||Q.peerUser.userId,resolvedUser:!!t.peerUser.userId&&!n,fqn:n?t.atcCallInfo.originalPartnerDisplay.fqn:t.atcCallInfo.peerFQN},r={convId:Q.convId,starter:t.direction===c.INCOMING?i.userId:e.localUser.userId,source:t.direction===c.INCOMING?i.fqn:e.localUser.phoneNumber,destination:t.direction===c.OUTGOING?i.fqn:e.localUser.phoneNumber,startTime:t.creationTime,duration:t.establishedTime?Date.now()-t.establishedTime:0,type:0===t.establishedTime?T.MISSED:T.REGULAR,participants:[{userId:e.localUser.userId,type:"USER",phoneNumber:e.localUser.phoneNumber,displayName:e.localUser.displayName},{userId:i.userId,type:"TELEPHONY",phoneNumber:i.phoneNumber,displayName:i.displayName,resolvedUser:i.resolvedUser}]};if(r.type===T.MISSED)switch(t.atcCallInfo.getMissedReason()){case S.DEST_OUT_OF_ORDER:r.missedReason=u.RTCItemMissed.UNREACHABLE;break;case S.REORDER_TONE:r.missedReason=u.RTCItemMissed.INVALID_NUMBER;break;case S.BUSY:r.missedReason=u.RTCItemMissed.USER_BUSY;break;case S.CANCELLED:r.missedReason=u.RTCItemMissed.CANCELED;break;case S.DECLINED:r.missedReason=u.RTCItemMissed.DECLINED;break;case S.TRANSFERRED:r.type=T.REGULAR;break;default:r.missedReason=u.RTCItemMissed.TEMPORARILY_UNAVAILABLE}if(oe)q.addJournalEntry(r);else{var o=1e3+1e3*Math.random();N(function(){(function(e){var t=e&&e.participants&&e.participants[1];return!!t&&ce.some(function(e,n){return g.cleanPhoneNumber(e.phoneNumber)===g.cleanPhoneNumber(t.phoneNumber)&&e.displayName===t.displayName&&(m.debug("[CstaSvc]: Call log entry already sent by another client"),ce.splice(n,1),!0)})})(r)||q.addJournalEntry(r)},o,!1)}}}else m.error("[CstaSvc]: No remoteCall")}function Me(){for(var e in $)$.hasOwnProperty(e)&&Ue(e,!0)}function we(e){return Object.values($).find(function(t){return t.callId===e})||null}function Ge(){return Object.values($).find(function(e){return e.isHolding()})||null}function He(e){if(!Q)return null;var t=Object.create(Q);return t.rtcSessionId=e,new a(t)}function ke(e){var t=e.endpoints,n=e.callingDevice,i=e.calledDevice,r=Ve(n)?c.OUTGOING:c.INCOMING;if(!t||t.length<2)return null;var o,a=null,s=t[0].callIdentifier.cID,l=t.length>2?C.Conference:C.Active;return t.forEach(function(n){if(l&&Ve(n.deviceOnCall)){if(-1===M.indexOf(n.localConnectionState))return void(l=null);var i=Be(n.deviceOnCall,e.epid);i===v.WebRTC&&(z||Z)?z?a=z:(a=Z,i=v.Other):a=He(s),a.direction||(a.direction=r),a.atcCallInfo.setPosition(i),a.atcCallInfo.setCstaConnection(n.callIdentifier),Object.assign(e.servicesPermitted,n.servicesPermitted),"queued"===n.localConnectionState?l=C.Parked:"hold"===n.localConnectionState&&(l=t.length>2?C.ConferenceHolding:l===C.Held?C.HoldOnHold:C.Holding)}}),a&&2===t.length&&t.forEach(function(e){if(!Ve(e.deviceOnCall)){if(-1===w.indexOf(e.localConnectionState))return void(l=null);var t=a.direction===c.OUTGOING?xe(i):xe(n);a.atcCallInfo.setPartnerDisplay(t),me(a,a.atcCallInfo.peerDn,a.atcCallInfo.peerFQN,a.atcCallInfo.peerName),"hold"===e.localConnectionState&&(l=l===C.Holding?C.HoldOnHold:C.Held)}}),l?(a.atcCallInfo.setServicesPermitted(e.servicesPermitted),a.setCstaState(l),$[s]=a,a.atcCallInfo.getPosition()===v.WebRTC&&W.isPrimaryClient()?(o=a,m.info("[CstaSvc]: Found a hanging WebRTC call"),o.atcCallInfo.setPosition(v.Other),o.atcCallInfo.isSeamlessHandoverAllowed()?(m.info("[CstaSvc]: Attempt to recover the hanging call by initiating a Seamless Handover"),st(o,v[v.WebRTC.name],null,function(e){e?(m.warn("[CstaSvc]: Failed to move the hanging call. ",e),W.hangupRemote(o)):m.info("[CstaSvc]: Hanging call has been successfully moved")})):(m.info("[CstaSvc]: Clear the hanging call"),W.hangupRemote(o)),null):(m.debug("[CstaSvc]: Created new Remote Call object: ",a),a)):null}function Ve(t){if(!t)return!1;var n=function(t){var n=t;if(e.localUser.isOsBizCTIEnabled){var i=Fe(t);i&&i[1]&&(n=i[1])}return n}(t);return!!(n.includes(Y.onsFQN)||Y.osmoDeviceList&&Y.osmoDeviceList.includes(n))&&!n.includes("uid=")&&!function(e){return e.includes("keyId=")}(n)}function Fe(t){return e.localUser.isOsBizCTIEnabled?Y.osmoDeviceList&&/\/(\+?\**\d+)/.exec(t)||/\<(\+?\**\d+)/.exec(t)||[t,t]:/ond=(\+?\d+)/.exec(t)}function Be(e,t){if(m.debug("[CstaSvc]: Get call position for "+e),!Ve(e))return m.error("[CstaSvc]: Invalid device ID ("+e+"). Cannot determine position."),v.Other;var n=v.Other,i=Fe(e);if(i&&i[1]){var r=i[1];r===Y.osmoFQN?n=t&&t!==Y.epid?v.Other:v.WebRTC:r===Y.cell?n=v.Cell:r===Y.parkingDn?n=v.Queue:Y.osmoDeviceList&&Y.osmoDeviceList.includes(r)&&(n=v.Desk)}else n=v.Desk;return m.debug("[CstaSvc]: Call position is:",n.name),n}function xe(t){var n={fqn:"",dn:G,name:""};if(t){var i=/N<([^>]*)>([^;]*)((?:[^;]*;)*(?:displayNumber=(\d*)))?(?:;.*)*/,r=i.exec(t);r?(e.localUser.isOsBizCTIEnabled&&r[1]&&(r[1]=r[1].replace(/\/.*/,"")),n.fqn=r[1]||"",n.name=r[2]||"",n.dn=r[4]||r[1]||"Number not available"):(r=(i=/N([^;]*)/).exec(t))?(n.fqn=r[1]||"",n.dn=r[1]||"Number not available"):(n.fqn=t,n.dn=t)}return m.debug("[CstaSvc]: Retrieved partner display: ",n),n}function We(e){De();for(var t=O.getPhoneCalls(),n=[],r=0;r<t.length;r++)if(t[r].atcCallInfo&&t[r].atcCallInfo.getCstaCallId()){if(t[r].atcCallInfo.getCstaCallId()===e)return z=t[r]}else{var o=t[r].getRedirectingUser();t[r].atcCallInfo=new i,o&&(t[r].atcCallInfo.redirectingUser=o),n.push(t[r])}return J&&J.atcCallInfo.getCstaCallId()===e?J:(J&&!J.atcCallInfo.getCstaCallId()&&n.push(J),n[0])}function Ye(t){return"forwardImmediate"===t||e.localUser.isOsBizCTIEnabled&&("forwardImmInt"===t||"forwardImmExt"===t)}function Ke(){var t=!0;Me(),De(),W.snapshotDevice(function(n,i){if(ie=!0,n)n.indexOf("deviceOutOfService")>-1&&(re=!0,Ze());else if(i.hasOwnProperty("deskPhoneRegistered")?(re=!i.deskPhoneRegistered,t=!1):re=e.localUser.isOsBizCTIEnabled&&!Y.osmoDeviceList,Ze(),t&&e.localUser.isOSV&&!re&&W.getLogicalDeviceInformation(),i.activeCalls)try{i.activeCalls.forEach(function(e){e.localCallState.length<2||(2!==e.localCallState.length||-1!==M.indexOf(e.localCallState[0])&&-1!==w.indexOf(e.localCallState[1]))&&W.snapshotCall(e.connectionId,function(e,t){if(!e&&t){var n=ke(t);n&&(m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n]))}})})}catch(e){m.error(e)}})}function qe(){Ke(),W.getForwarding(Et),e.localUser.isOsBizCTIEnabled?oe&&St(pe):W.getAgentState(Tt)}function je(t,n,i,r){var o=e.localUser.isOsBizCTIEnabled?"":Y.onsFQN+";ond=";switch(t){case v.WebRTC:r&&Y.osmoDeviceList.length>1?o="N<"+Y.onsFQN+"/"+Y.osmoDeviceList[1]+">":o+=i?Y.osmoFQN:Y.osmoFQN+";epid="+Y.epid;break;case v.Cell:if(!Y.cell)return m.error("[CstaSvc]: Cell phone is not configured"),null;o+=Y.cell;break;case v.Desk:o+=Y.onsFQN,r&&Y.osmoDeviceList&&(o="N<"+o+"/"+Y.osmoDeviceList[0]+">");break;case v.VM:o=Y.vm;break;case v.Other:n?o+=n:o=Y.vm;break;default:return m.error("[CstaSvc]: Invalid target: "+t),null}return o}function Qe(t){return Object.assign(Y,D.getAtcRegistrationData()),!(!e.localUser.cstaNumber||!Y)||(t&&t("There is no registered user."),!1)}function ze(t,n){var i=j.genCstaRequest(t);if(!i)return m.error("[CstaSvc]: Failed to build CSTA request: "+t.request),void(n&&n("Failed to send the request"));if(Ee===o.Registered){var a={content:{type:r.CSTA,phoneNumber:e.localUser.cstaNumber,CSTA:i},destUserId:e.localUser.associatedTelephonyUserID};K.sendAtcRequest(a,function(i,r){e.$apply(function(){if(i)m.warn("[CstaSvc]: ",i),n&&n(i);else{var e=j.parseResponse(t.request,r.CSTA);e||""===e?e.error?("Operation Error"===e.errorCategory&&"invalidConnectionID"===e.errorValue&&"busy"!==t.reason&&"AcceptCall"!==t.request&&"DeflectCall"!==t.request&&Ke(),n&&n(e.errorCategory+" - "+e.errorValue)):n&&n(null,e):n&&n("Failed to parse response from server")}})})}else n&&n("Client is not registered with ATC")}function Xe(e,t){var n,i,r,o;t.transferredCall&&!t.seamlessHandover&&(ne[e]={newCallId:t.transferredCall.cID,failedCallId:(n=t.transferredCall.cID,r=(parseInt(n.substring(0,2),16)+2).toString(16).toUpperCase(),o=n.substring(2),i=r.length<2?"0"+r+o:r+o,m.debug("[CstaSvc]: FailedCallId to be tracked: "+i),i),timeout:N(function(){delete ne[e]},b)})}function Je(e,t){return!(!e||!Qe()||t!==v.Other&&e.atcCallInfo.position===t||!(n=dt(),Y&&Y.vm&&n.push(v.VM),n.push(v.Other),n).includes(t)&&(m.error("[CstaSvc]: isTargetAllowed invoked with invalid target: "+t),1));var n}function $e(){e.localUser.isOsBizCTIEnabled||(m.debug("[CstaSvc]: Synchronize the selected routing option"),W.updateRoutingOption(e.localUser.selectedRoutingOption))}function Ze(){var e=!re,t=!(!Y||!Y.cell);m.debug("[CstaSvc]: Publish /csta/deviceChange event. desk="+e+", cell="+t),h.publish("/csta/deviceChange")}function et(){return e.localUser.isOsBizCTIEnabled?Y.onsFQN:e.localUser.isOSV?g.normalizeDn(e.localUser.cstaNumber):e.localUser.cstaNumber}function tt(e){var t=O.findOsBizFirstCall(),n=O.findOsBizSecondCall();if(t&&n){if(t.atcCallInfo.getCstaCallId()===e)return m.debug("[CstaSvc]: First local call with callId: ",e),m.debug("[CstaSvc]: Second local call with callId: ",n.atcCallInfo.getCstaCallId()),O.moveOsBizCalls(t,n),!0;if(n.atcCallInfo.getCstaCallId()===e)return m.debug("[CstaSvc]: Second local call with callId: ",e),m.debug("[CstaSvc]: First local call with callId: ",t.atcCallInfo.getCstaCallId()),O.moveOsBizCalls(n,t),!0}else if(!t&&!n){var i=be();if(i&&i.atcCallInfo&&i.atcCallInfo.getCstaCallId()===e){m.debug("[CstaSvc]: Remote call with callId: ",e);var r=Ge();if(r){m.debug("[CstaSvc]: Second remote call with callId: ",r.atcCallInfo.getCstaCallId());var o=i.atcCallInfo;return i.atcCallInfo=r.atcCallInfo,i.setPeerUser(i.atcCallInfo.peerDn,i.atcCallInfo.peerName),r.atcCallInfo=o,delete $[i.atcCallInfo.getCstaCallId()],$[o.getCstaCallId()]=r,Ue(r.atcCallInfo.getCstaCallId()),!0}}}return!1}function nt(e){var t,n,i=We(e.connection.cID);if(i)i.direction===c.OUTGOING&&k.test(e.cause)&&(he(i,(t=xe(e.divertingDevice)).dn,t.fqn,t.name,f.CallForward),n=xe(e.newDestination),i.setPeerUser(n.dn,n.name),i.atcCallInfo.setOriginalPartnerDisplay(t));else if("distributed"===e.cause&&Ve(e.divertingDevice)&&Be(e.newDestination)===v.Desk)m.debug("[CstaSvc]: Ignore Diverted event with cause = distributed and newDestination = desk");else{if(i=$[e.connection.cID]){if(i.atcCallInfo.masterParallelHgCall)return void m.debug("[CstaSvc]: Ignore Diverted event for master parallel hunt group")}else i=He(e.connection.cID);if("null"===e.localConnectionInfo&&Ve(e.divertingDevice)){if(Ve(e.newDestination)){if(Ve(e.newDestination)&&(Be(e.newDestination)===v.WebRTC&&(ae={cID:e.connection.cID,dID:e.newDestination}),i)){if(i.pickupNotification)return;if("redirected"===e.cause&&e.lastRedirectionDevice&&!Ve(e.lastRedirectionDevice)){var r=xe(e.lastRedirectionDevice);he(i,r.dn,r.fqn,r.name,f.CallForward),$[e.connection.cID]=i}if(i.forwarded)return;if(i.checkCstaState(C.Ringing)&&Be(e.newDestination)===i.atcCallInfo.getPosition())return m.debug("[CstaSvc]: new destination has the same position as the current alerting position. Ignore event"),void(ae={});i.atcCallInfo.setIgnoreCall(!0),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i])}}else{if(((s=e.newDestination)&&xe(s).dn===Y.vm||Be(e.connection.dID)===v.WebRTC)&&i.atcCallInfo.setIgnoreCall(!0),i.setCstaState(C.Idle),i.direction=c.INCOMING,i.atcCallInfo.setMissedReason(S.CANCELLED),k.test(e.cause)){$[e.connection.cID]=i;var o=xe(e.callingDevice);m.debug("[CstaSvc]: Update partner display to ",o),i.atcCallInfo.setPartnerDisplay(o),me(i,i.atcCallInfo.peerDn,i.atcCallInfo.peerFQN,i.atcCallInfo.peerName)}m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i])}i&&!i.isHandoverInProgress&&Ue(e.connection.cID)}else if(!Ve(e.divertingDevice)&&i){var a=xe(e.divertingDevice);if(a&&i.atcCallInfo.setOriginalPartnerDisplay(a),i.direction===c.OUTGOING&&k.test(e.cause))return he(i,(t=xe(e.divertingDevice)).dn,t.fqn,t.name,f.CallForward),n=xe(e.newDestination),void i.setPeerUser(n.dn,n.name);i.atcCallInfo.setMissedReason(S.CANCELLED),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i])}var s}}function it(e,t){se&&se.newCallId===t&&(e.direction=se.direction,e.setRedirectingUser(se.redirectingUser.phoneNumber,se.redirectingUser.fqNumber,se.redirectingUser.displayName,se.redirectingUser.userId,se.redirectingUser.redirectionType),e.atcCallInfo.transferCb=se.transferCb,delete se.transferCb,se={})}function rt(t){return e.localUser.isOsBizCTIEnabled?{cID:t.getCstaCallId(),dID:Y.onsFQN}:t.getCstaConnection()}function ot(t){var n,i,r,o=t.failedConnection.cID;if("fail"===t.localConnectionInfo&&Ve(t.failingDevice)){if((n=$[o])&&n.atcCallInfo&&n.atcCallInfo.masterParallelHgCall)return void m.debug("[CstaSvc]: Ignore Failed event for master parallel hunt group");switch(Ve(t.callingDevice)&&(i=xe(t.calledDevice)).dn!==G&&n&&i.fqn!==g.cleanPhoneNumber(n.atcCallInfo.peerFQN)&&(me(n,i.dn,i.fqn,i.name),n.atcCallInfo.setPartnerDisplay(i)),t.cause){case"blocked":te[o]&&m.debug("[CstaSvc]: Received Failed event for transfer, waiting for ConnectionCleared event"),e.localUser.isOSV||(r=Be(t.failedConnection.dID),(n=r===v.WebRTC?We(o):$[o])&&n.isHandoverInProgress&&(m.debug("[CstaSvc]: Received Failed event from non OSV PBX while handover is in progress"),n.clearAtcHandoverInProgress(),m.debug("[CstaSvc]: Publish /atccall/moveFailed event"),h.publish("/atccall/moveFailed")),e.localUser.isOsBizCTIEnabled&&n&&n.isRemote&&n.atcCallInfo&&n.atcCallInfo.setServicesPermitted(t.servicesPermitted));break;case"doNotDisturb":(n=$[o])?(m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n])):m.warn("[CstaSvc]: DND call does not exist. Ignore Failed event");break;case"reorderTone":(n=$[o])?(n.atcCallInfo.setMissedReason(S.REORDER_TONE),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n])):m.warn("[CstaSvc]: Outgoing call failed with reorder tone");break;case"busy":(n=$[o])?(n.atcCallInfo.setMissedReason(S.BUSY),n.checkCstaState(C.Offered)&&n.setCstaState(C.Failed),n.atcCallInfo.clearOutgoingCallCampedOn(),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n])):m.warn("[CstaSvc]: Busy call does not exist. Ignore Failed event");break;case"destNotObtainable":(n=We(o)||$[o])&&N(function(){n.isPresent()&&function(e,t){var n=e.isOsBizSecondCall?O.findOsBizFirstCall():Ge();if(e&&n&&Qe(t)){var i={request:"ReconnectCall",heldCall:rt(n.atcCallInfo),activeCall:rt(e.atcCallInfo)};ze(i,t)}else t&&t()}(n)},x)}}else if("connected"===t.localConnectionInfo&&Ve(t.callingDevice)){if((n=We(o))&&n.atcCallInfo.getCstaCallId()===o||(n=$[o]),!n)return void m.warn("[CstaSvc]: Could not find call corresponding to handle FailedEvent Event.");switch(n.atcCallInfo.setServicesPermitted(t.servicesPermitted),n.atcCallInfo.peerFQN||(i=xe(t.failingDevice||t.calledDevice))&&(n.atcCallInfo.setPartnerDisplay(i),me(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName)),t.cause){case"busy":n.isRemote&&(n.setCstaState(C.Busy),n.atcCallInfo.setMissedReason(S.BUSY));break;case"reorderTone":n.atcCallInfo.setMissedReason(S.REORDER_TONE);break;case"blocked":n.atcCallInfo.setMissedReason(S.DECLINED);break;case"destOutOfOrder":n.atcCallInfo.setMissedReason(S.DEST_OUT_OF_ORDER);break;default:n.atcCallInfo.setMissedReason(S.DEFAULT)}m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n])}}function at(e){if(_e)return m.warn("[CstaSvc]: Queue new forwarding request until loop detected timer expires"),void(Ne=e);Date.now()-Ae<B?ge++:ge=0,Ae=Date.now(),m.debug("[CstaSvc]: Forward loop counter: "+ge+" timestamp: "+Ae),ge>V?(m.error("[CstaSvc]: Loop detected while trying to update forwarding data."),Ne=e,_e=N(function(){m.debug("[CstaSvc]: Loop detection timeout has expired. Process queued request."),ge=0,_e=null,Ne&&Ne(),Ne=null},F,!1)):e&&e()}function st(t,n,i,r){if(Qe(r))if(t.atcCallInfo&&(t.checkCstaState([C.Active])||t.atcCallInfo.isHandoverAllowed()||t.atcCallInfo.isDeflectAllowed()))if(Je(t,n)){var o=je(n,i,e.localUser.isOsBizCTIEnabled,e.localUser.isOsBizCTIEnabled);if(o){var a={autoAnswer:n===v.Desk||n===v.WebRTC};t.checkCstaState([C.Ringing,C.Parked])?(a.request="DeflectCall",a.callToBeDiverted=rt(t.atcCallInfo),a.newDestination=o,e.localUser.isOSV||(m.debug("[CstaSvc]: Publish /csta/handover event"),h.publish("/csta/handover",t.atcCallInfo.getCstaCallId())),t.setAtcHandoverInProgress(),ze(a,function(i){i?(r&&r("res_MoveCallFailed"),t.clearAtcHandoverInProgress(),e.localUser.isOSV||(m.debug("[CstaSvc]: Publish /atccall/moveFailed event"),h.publish("/atccall/moveFailed",[!0]))):(e.localUser.isOSV&&(m.debug("[CstaSvc]: Publish /csta/handover event"),h.publish("/csta/handover",t.atcCallInfo.getCstaCallId())),n===v.WebRTC&&t.atcCallInfo.setIgnoreCall(!0),t.atcCallInfo.transferCb=r)})):(a.request="SingleStepTransferCall",a.activeCall=rt(t.atcCallInfo),a.transferredTo=o,a.seamlessHandover=t.atcCallInfo.isSeamlessHandoverAllowed(),e.localUser.isOSV||(m.debug("[CstaSvc]: Publish /csta/handover event"),h.publish("/csta/handover",t.atcCallInfo.getCstaCallId())),t.setAtcHandoverInProgress(),ze(a,function(n,i){n||!i?(r&&r("res_MoveCallFailed"),t.clearAtcHandoverInProgress(),e.localUser.isOSV||(m.debug("[CstaSvc]: Publish /atccall/moveFailed event"),h.publish("/atccall/moveFailed",[!0]))):(Xe(a.activeCall.cID,i),se={primaryCallId:a.activeCall.cID,newCallId:i.transferredCall.cID,direction:t.direction,redirectingUser:t.redirectingUser,transferCb:r},e.localUser.isOSV&&(m.debug("[CstaSvc]: Publish /csta/handover event"),h.publish("/csta/handover",t.atcCallInfo.getCstaCallId())),t.atcCallInfo.transferCb=r)}))}else r&&r("Failed to create new destination.")}else r&&r("The selected target is not available for this call.");else r&&r("res_MoveCallFailed")}function ct(t,n){var i=He(t.dialedDn);me(i,t.dialedDn,t.dialedDn,t.toName),i.setCstaState(C.Delivered),i.direction=c.OUTGOING,i.atcCallInfo.setPosition(n);var r={dn:t.dialedDn,fqn:t.dialedDn,name:t.toName||""};if(i.atcCallInfo.setPartnerDisplay(r),i.atcCallInfo.setIgnoreCall(!0),$[t.dialedDn]=i,n===v.WebRTC&&e.localUser.isOsBizCTIEnabled){var o={reuseSessionCtrl:z&&z.sessionCtrl},a=new p(Q,o);a.atcCallInfo=i.atcCallInfo,me(a,i.peerUser.phoneNumber,null,i.peerUser.displayName),a.isOsBizSecondCall=!0,a.setState(l.Initiated),a.direction=c.OUTGOING,Ue(t.dialedDn,!0),Q.call=a,m.debug("[CstaSvc]: Publish /conversation/update event. convId = ",Q.convId),h.publish("/conversation/update",[Q]),O.addCallToList(a),m.debug("[CstaSvc]: Publish /call/state event. callId = "+a.callId+", state = "+a.state.name),h.publish("/call/state",[a])}else m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i]),m.debug("[CstaSvc]: Created new Remote Call object: ",i)}function lt(e,t,n){var i=we(t.dialedDn);if(i)i.atcCallInfo.setCstaConnection(e),i.setCallIdForTelephony(e.cID),i.setCstaState(C.Delivered),i.atcCallInfo.setIgnoreCall(!1),t.dtmfDigits&&(i.dtmfDigits=t.dtmfDigits),delete $[t.dialedDn];else{me(i=He(e.cID),t.dialedDn,t.dialedDn,t.toName),i.setCstaState(C.Delivered),i.direction=c.OUTGOING,i.atcCallInfo.setCstaConnection(e),i.atcCallInfo.setPosition(n);var r={dn:t.dialedDn,fqn:t.dialedDn,name:t.toName||""};i.atcCallInfo.setPartnerDisplay(r)}$[e.cID]=i,m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i]),m.debug("[CstaSvc]: Created new Remote Call object: ",i)}function dt(){var e=[];return t.WebRTCAdapter.enabled&&e.push(v.WebRTC),re||e.push(v.Desk),Y&&Y.cell&&e.push(v.Cell),e}function ut(e){var t=e.atcCallInfo&&e.atcCallInfo.getCstaConnection()||ae;oe&&ze({request:"DeflectCall",callToBeDiverted:t,newDestination:je(v.Desk)})}function Ct(t){var n=null;if(e.localUser.selectedBusyHandlingOption!==s.DefaultRouting.name){var i=t.atcCallInfo&&t.atcCallInfo.getCstaConnection()||ae;if(i&&oe){switch(e.localUser.selectedBusyHandlingOption){case s.SendToAlternativeNumber.name:n={request:"DeflectCall",callToBeDiverted:i,newDestination:je(v.Cell)};break;case s.BusySignal.name:n={request:"ClearConnection",connectionToBeCleared:i,reason:"busy"};break;case s.SendToVM.name:n={request:"DeflectCall",callToBeDiverted:i,newDestination:je(v.VM)};break;default:return}ze(n,function(e){if(!e&&"ClearConnection"===n.request)if(t.atcCallInfo)t.atcCallInfo.setMissedReason(S.BUSY),t.checkCstaState(C.Offered)&&t.setCstaState(C.Failed);else if(D.isClearConnectionBusySupported()){var r=$[i.cID]||He(i.cID);r.peerUser=t.peerUser,r.direction=c.INCOMING,r.creationTime=t.creationTime,r.atcCallInfo.setMissedReason(S.BUSY),$[i.cID]=r,Ue(i.cID)}}),ae={}}}else t.checkCstaState(C.Offered)&&(ze(n={request:"AcceptCall",callToBeAccepted:t.atcCallInfo.getCstaConnection()}),ae={})}function Et(t,n){!t&&n&&(e.localUser.callForwardingAvailable=!e.localUser.isOSV,n.forwardList&&n.forwardList.length>0&&n.forwardList.forEach(function(t){Ye(t.forwardingType)&&(e.localUser.callForwardingAvailable=!0,t.forwardDN!==Y.vm?(e.localUser.callForwardingNumber=I.format(t.forwardDN),e.localUser.callForwardingEnabled=t.forwardStatus):(e.localUser.callForwardingToVMEnabled=t.forwardStatus,e.localUser.isOsBizCTIEnabled&&(e.localUser.callForwardingNumber=Y.vm)))}),Y.forwardList=n.forwardList||[],n.hasOwnProperty("voicemailActive")&&(e.localUser.voicemailPBXEnabled=!0,e.localUser.voicemailActive=n.voicemailActive,e.localUser.voicemailRingDuration=n.voicemailRingDuration,Se=n.voicemailRingDuration),n.mainRingDuration&&(e.localUser.ringDurationEnabled=!0,e.localUser.mainRingDuration=n.mainRingDuration,e.localUser.clientRingDuration=n.clientRingDuration,e.localUser.cellRingDuration=n.cellRingDuration,Ie=n.mainRingDuration,fe=n.clientRingDuration,Re=n.cellRingDuration,e.localUser.alternativeNumber=n.alternativeNumber||g.cleanPhoneNumber(e.localUser.reroutingPhoneNumber),e.localUser.routeToCell=n.routeToCell,e.localUser.ringDurationConfigurable=n.hasOwnProperty("overrideProfile")?n.overrideProfile:!e.localUser.isOSV),m.debug("[CstaSvc]: Publish /localUser/update event"),h.publish("/localUser/update",[e.localUser]),m.debug("[CstaSvc]: Publish /csta/getForwardingResponse"),h.publish("/csta/getForwardingResponse"),$e())}function Tt(t,i){!t&&i&&(e.localUser.isAgent=i.loggedOnState,e.localUser.isAgent&&(e.localUser.agentStateReady=i.agentState===n.Ready,m.debug("[CstaSvc]: Publish /agent/state/ready event"),h.publish("/agent/state/ready",[e.localUser.agentStateReady])))}function pt(e){g.isMobile()||O.getActiveCall()||(e=e||Object.values($).find(function(e){return e.isPickupNotification()}))&&e.isPresent()&&!e.pickupNotificationShown&&(m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[e]),m.debug("[CstaSvc]: Publish /call/pickupNotification event"),h.publish("/call/pickupNotification",[e]),e.pickupNotificationShown=!0)}function St(e,t){Qe(t)&&ze({request:"SetBusy",device:et(),busyState:e},t)}function It(e,t){e.isOsBizSecondCall&&(e.setState(t),m.debug("[CstaSvc]: Publish /conversation/update event. convId = ",Q.convId),h.publish("/conversation/update",[Q]))}return K.on("ATC.CSTA",function(t){m.info("[CstaSvc]: Received CSTA event: ",t),t.type===r.CSTA&&t.CSTA&&e.$apply(function(){!function(e){var t=j.parseEvent(e);if(t)switch(m.debug("[CstaSvc]: Parsed CSTA Event: ",t),t.category){case"CallControl":case"CallAssociatedFeature":W.handleCallEvent(t);break;case"LogicalDeviceFeature":W.handleLogicalDeviceEvent(t);break;case"PhysicalDeviceFeature":break;case"DeviceMaintenance":W.handleDeviceEvent(t);break;default:m.debug("[CstaSvc]: Unsupported CSTA Event category: "+t.category)}}(t.CSTA)})}),K.on("ATC.PRIMARYCLIENT",function(t){var n;m.info("[CstaSvc]: Received PRIMARYCLIENT event:",t),t.type===r.PRIMARYCLIENT&&t.primaryClientId&&(n=t.primaryClientId,e.localUser.clientId!==n?(m.debug("[CstaSvc]: This is not the Primary ATC client"),oe=!1):(m.debug("[CstaSvc]: This is the primary ATC client"),oe=!0))}),K.on("ATC.ADVANCING",function(e){if(e.type===r.ADVANCING){m.debug("[CstaSvc]: Received UserToUser ATC.ADVANCING");var t=O.getIncomingCall(e.rtcSessionId);t&&(se={newCallId:t.atcCallInfo.getCstaCallId(),direction:t.direction,redirectingUser:t.redirectingUser})}}),h.subscribe("/atcRegistration/state",function(t){m.debug("[CstaSvc]: Received /atcRegistration/state event."),Ee=t,e.localUser.isATC&&(!ie&&t===o.Registered&&ve?qe():ie=!1,t!==o.Registered&&Me())}),h.subscribe("/activeSessions/received",function(){m.debug("[CstaSvc]: Received /activeSessions/received event"),ve=!0,ie||Ee===o.Registered&&qe()}),h.subscribe("/registration/state",function(e){m.debug("[CstaSvc]: Received /registration/state event"),e!==RegistrationState.Registered&&(ve=!1)}),h.subscribe("/call/incoming",function(e){e&&Q&&e.convId===Q.convId&&(m.debug("[CstaSvc]: Received /call/incoming event."),Object.keys($).some(function(e){var t=$[e];return!(!t.checkCstaState(C.Ringing)||t.atcCallInfo.getPosition()!==v.WebRTC||((J=Pe())&&(m.debug("[CstaSvc]: Found a matching ATC remote call. Move call info to alerting call."),J.atcCallInfo=t.atcCallInfo,t.atcCallInfo=new i,t.atcCallInfo.setIgnoreCall(!0),Ue(e)),0))}))}),h.subscribe("/atccall/firstcall",function(e){m.debug("[CstaSvc]: Received /atccall/firstcall event"),ut(e)}),h.subscribe("/atccall/secondcall",function(e){m.debug("[CstaSvc]: Received /atccall/secondcall event."),Ct(e)}),h.subscribe("/conversation/item/add",function(e){e&&Q&&e.convId===Q.convId&&e.rtc&&e.rtc.rtcParticipants&&2===e.rtc.rtcParticipants.length&&(ce.unshift("TELEPHONY"===e.rtc.rtcParticipants[0].type?e.rtc.rtcParticipants[0]:e.rtc.rtcParticipants[1]),ce.length>2&&ce.pop())}),h.subscribe("/call/ended",function(e){e&&e.isTelephonyCall&&!e.isRemote&&(ue=e,N.cancel(Ce),Ce=N(function(){ue=null,Ce=null},2e3),e.isOsBizSecondCall&&Le(e)),e.isPickupNotification()||e.isRemote||pt(),De()}),h.subscribe("/routing/alternativeNumber/changed",function(){m.debug("[CstaSvc]: Received /routing/alternativeNumber/changed event"),$e()}),h.subscribe("/localUser/update",function(){e.localUser.isATC&&(m.debug("[CstaSvc]: Received /localUser/update event"),e.localUser.isOsBizCTIEnabled&&(pe&&e.localUser.userPresenceState.state!==u.PresenceState.BUSY||!pe&&e.localUser.userPresenceState.state===u.PresenceState.BUSY&&O.getCalls().some(function(e){return!e.isTelephonyCall}))&&(pe=!pe,oe&&(m.debug("[CstaSvc]: Update busy state. New State: ",pe),St(pe))),$e())}),this.alternate=function(t,n,i){if(Qe(i))if(t&&n){t.setRetrieveInProgress(),n.setHoldInProgress();var r={request:"AlternateCall"};r.activeCall=rt(n.atcCallInfo),r.heldCall=rt(t.atcCallInfo),ze(r,function(r){r?(t.clearRetrieveInProgress(),n.clearHoldInProgress(),i&&i("res_RetrieveCallFailed")):(e.localUser.isOsBizCTIEnabled&&(Q.call=t,m.debug("[CstaSvc]: Publish /conversation/update event. convId = ",Q.convId),h.publish("/conversation/update",[Q])),i&&i(null))})}else i&&i("Invalid calls to alternate")},this.conference=function(e,t,n){if(Qe(n))if(e&&t){var i={request:"ConferenceCall"};i.activeCall=rt(t.atcCallInfo),i.heldCall=rt(e.atcCallInfo),ze(i,function(e,t){!e&&t||n&&n("res_MergeCallFailed")})}else n&&n("Invalid calls to conference")},this.answer=function(e,t){if(Qe(t)){var n=we(e);if(!n){if(!J||!J.atcAdvancing)return void(t&&t("There is no call to be answered"));var i=rt((n=J).atcCallInfo);i.dID=Y.onsFQN,n.atcCallInfo.setCstaConnection(i)}var r=n.atcAdvancing?v.Desk:n.atcCallInfo.getPosition(),o=Object.values($).find(function(t){return t.callId!==e&&t.atcCallInfo.getPosition()===r});o?W.alternate(n,o,t):ze({request:"AnswerCall",callToBeAnswered:rt(n.atcCallInfo)},t)}},this.answerCallRemoteDevice=function(e,t){Qe(t)&&ze({request:"AnswerCall",callToBeAnswered:{cID:e,dID:Y.onsFQN}},t)},this.pickupCall=function(e,t,n){if(Qe(n=n||function(){})){var i=we(e);i&&i.pickupNotification?(ze({request:"GroupPickupCall",newDestination:je(t=t||v.WebRTC)},function(t){if(t)return n("res_PickUpCallFailed"),void Ue(e,!0);n()}),m.debug("[CstaSvc]: Publish /atccall/pickUpInProgress"),h.publish("/atccall/pickUpInProgress",[i]),i.setAtcHandoverInProgress()):n("There is no call to be picked up")}},this.clearTransferredCall=function(e){ne[e]&&(N.cancel(ne[e].timeout),delete ne[e])},this.consultationTransfer=function(e,t,n){Qe(n)&&ze({request:"TransferCall",heldCall:rt(t.atcCallInfo),activeCall:rt(e.atcCallInfo)},function(e,t){e||!t?n&&n(_.Unreachable.ui):n&&n(null)})},this.deflect=function(e,t,n,i){if(Qe(i)){var r=We(e)||O.getIncomingCall()||we(e);if(r)if(Je(r,t))if(r.atcAdvancing&&t===v.Desk)W.answer(e,i);else{var o=je(t,n);o?ze({request:"DeflectCall",callToBeDiverted:rt(r.atcCallInfo),newDestination:o,autoAnswer:t===v.Desk||t===v.WebRTC},function(e){e?i&&i("res_MoveCallFailed"):t!==v.VM&&r.setAtcHandoverInProgress()}):i&&i("Failed to create new destination.")}else i&&i("The selected target is not available for this call.");else i&&i("There is no call to be deflected")}},this.generateDigits=function(t,n,i){Qe(i)&&ze({request:"GenerateDigits",connectionToSendDigits:rt(t.atcCallInfo),charactersToSend:n},function(r){i&&i(r),e.localUser.isOsBizCTIEnabled&&!r&&(m.info("[CstaSvc]: Digits played",n),h.publish("/call/singleDigitSent",[t]))})},this.getDoNotDisturb=function(e){Qe(e)&&ze({request:"GetDoNotDisturb",device:et()},e)},this.getForwarding=function(e){Qe(e)&&ze({request:"GetForwarding",device:et()},e)},this.getMessageWaiting=function(e){Qe(e)&&ze({request:"GetMessageWaitingIndicator",device:et()},e)},this.getTransferredCall=function(e){return ne[e]},this.pullRemoteCall=function(e,t){var n=we(e);n?n.pickupNotification?W.pickupCall(e,null,t):st(n,v[v.WebRTC.name],null,t):(m.warn("[CstaSvc]: pullRemoteCall invoked without a valid call"),t("No active remote call"))},this.pushLocalCall=function(e,t,n){var i;De(),z&&z.callId===e?i=z:X&&X.callId===e&&(i=X),i?st(i,v[t],null,n):(m.warn("[CstaSvc]: pushLocalCall invoked without a valid call"),n("No active local call"))},this.endRemoteCall=function(e,t){var n=we(e);n?this.hangupRemote(n,t):(m.warn("[CstaSvc]: endRemoteCall invoked without a valid call"),t&&t("No active remote call"))},this.endCallOnRemoteDevices=function(e){Qe()&&Y.osmoDeviceList&&e&&ze({request:"ClearConnection",connectionToBeCleared:{cID:e,dID:Y.onsFQN}})},this.hangupRemote=function(e,t){e.isRemote&&Qe(t)&&ze({request:"ClearConnection",connectionToBeCleared:rt(e.atcCallInfo)},function(n){n?t&&t(n):(e.getCstaState().established||e.atcCallInfo.getMissedReason()||(e.direction===c.INCOMING?e.atcCallInfo.setMissedReason(S.DECLINED):e.atcCallInfo.setMissedReason(S.CANCELLED),Ue(e.atcCallInfo.getCstaCallId())),t&&t())})},this.hold=function(t,n){if(Qe(n)){var i={request:"HoldCall",callToBeHeld:rt(t.atcCallInfo)};e.localUser.isOsBizCTIEnabled&&t.isRemote&&e.circuitLabs.OSBIZ_EXTENDED_TELEPHONY&&Y.supportedFeatures&&Y.supportedFeatures.includes("zhOs")&&(i.holdOptions="exclusiveHold"),t.setHoldInProgress(),ze(i,function(e){e?(t.clearHoldInProgress(),n&&n("res_HoldCallFailed")):n&&n(null)})}},this.holdWithConsultationCall=function(e,t){if(Qe(t)){var n={request:"ConsultationCall",existingCall:rt(e.atcCallInfo)};e.setHoldInProgress(),ze(n,function(n,i){n?(e.clearHoldInProgress(),t&&t("res_HoldCallFailed")):(i&&i.iC&&i.iC.cID&&e.atcCallInfo.setCstaReconnectId({cID:i.iC.cID,dID:Y.onsFQN}),t&&t(null))})}},this.reconnect=function(e,t,n){Qe(n)&&ze({request:"ReconnectCall",heldCall:rt(t.atcCallInfo),activeCall:rt(e.atcCallInfo)},n)},this.retrieve=function(e,t){if(Qe(t)){var n={request:"RetrieveCall",callToBeRetrieved:rt(e.atcCallInfo)};e.setRetrieveInProgress(),ze(n,function(n){n?(e.clearRetrieveInProgress(),t&&t("res_RetrieveCallFailed")):t&&t(null)})}},this.retrieveWithReconnectCall=function(e,t){if(Qe(t)){var n={request:"ReconnectCall",heldCall:rt(e.atcCallInfo),activeCall:e.atcCallInfo.getCstaReconnectId()};e.setRetrieveInProgress(),ze(n,function(n){n?(e.clearRetrieveInProgress(),e.atcCallInfo.setCstaReconnectId({}),t&&t("res_RetrieveCallFailed")):t&&t(null)})}},this.setDoNotDisturb=function(e,t){Qe(t)&&ze({request:"SetDoNotDisturb",device:et(),doNotDisturbOn:e},t)},this.setForwarding=function(e,t){if(Qe(t)){var n={request:"SetForwarding",device:et(),activateForward:e.activateForward,forwardDN:e.forwardDN||"",forwardingType:e.forwardingType,ringCount:e.ringCount};at(function(){ze(n,t)})}},this.snapshotCall=function(e,t){Qe(t)&&ze({request:"SnapshotCall",snapshotObject:e},t)},this.snapshotDevice=function(e){Qe(e)&&ze({request:"SnapshotDevice",snapshotObject:Y.onsFQN,osmo:Y.osmo},e)},this.getLogicalDeviceInformation=function(e){Qe(e=e||function(){})&&ze({request:"GetLogicalDeviceInformation",device:et()},function(t,n){t||!n||n.hasPhysicalDeviceInformation||re||(re=!0,Ze()),e(t,n)})},this.transfer=function(e,t,n){if(Qe(n)){var i={};e.checkCstaState([C.Ringing,C.Parked])?(i.request="DeflectCall",i.callToBeDiverted=rt(e.atcCallInfo),i.newDestination=t,ze(i,n)):(i.request="SingleStepTransferCall",i.activeCall=rt(e.atcCallInfo),i.transferredTo=t,ze(i,function(e,t){if(e||!t){if(e&&-1!==e.indexOf("internalResourceBusy"))return Xe(i.activeCall.cID,{transferredCall:{cID:"00000000000000000000000000000000"}}),void(n&&n(null));n&&n(_.Unreachable.ui)}else Xe(i.activeCall.cID,t),n&&n(null)}))}},this.consultationCall=function(t,n,i){if(Qe(i)&&n){var r={request:"ConsultationCall"};r.consultedDevice=n.dialedDn,r.existingCall=rt(t.atcCallInfo),ct(n,t.atcCallInfo.getPosition());var o=$[n.dialedDn];ze(r,function(r,a){if(r||!a){if(i&&i("res_MakeCallFailed"),o){if(r.endsWith("invalidCalledDeviceID"))o.atcCallInfo.setMissedReason(S.REORDER_TONE);else{if(r.endsWith("requestIncompatibleWithCallingDevice")||r.endsWith("invalidDeviceID"))return void Ue(n.dialedDn,!0);o.atcCallInfo.setMissedReason(S.DEST_OUT_OF_ORDER)}o.atcCallInfo.setIgnoreCall(!1),Ue(n.dialedDn)}}else!t.isRemote&&e.localUser.isOsBizCTIEnabled?t.isOsBizFirstCall=!0:lt(a.iC,n,t.atcCallInfo.getPosition()),i&&i()})}},this.makeCall=function(e,t,n){if(Qe(n)&&t){var i={request:"MakeCall"};i.calledDirectoryNumber=t.dialedDn,i.callingDevice=je(e),i.autoOriginate=e===v.Desk||e===v.WebRTC?"doNotPrompt":"prompt",ct(t,e);var r=$[t.dialedDn];ze(i,function(i,o){if(i||!o){if(n&&n("res_MakeCallFailed"),i.endsWith("invalidCalledDeviceID"))r.atcCallInfo.setMissedReason(S.REORDER_TONE);else{if(i.endsWith("requestIncompatibleWithCallingDevice")||i.endsWith("invalidDeviceID"))return void Ue(t.dialedDn,!0);r.atcCallInfo.setMissedReason(S.DEST_OUT_OF_ORDER)}r.atcCallInfo.setIgnoreCall(!1),Ue(t.dialedDn)}else lt(o.caD,t,e),n&&n()})}},this.ignoreCall=function(e,t){Ue(e.callId),t&&t()},this.callBackCallRelated=function(e,t){Qe(t)&&ze({request:"CallBackCallRelated",callBackConnection:e.atcCallInfo.getCstaConnection()},t)},this.callBackNonCallRelated=function(e,t){Qe(t)&&ze({request:"CallBackNonCallRelated",orD:Y.onsFQN,tD:e},t)},this.cancelCallBack=function(e,t){Qe(t)&&ze({request:"CancelCallBack",orD:Y.onsFQN,td:e||void 0},t)},this.setMicrophoneMute=function(e,t){Qe(t)&&ze({request:"SetMicrophoneMute",device:et(),mute:e},t)},this.getMicrophoneMute=function(e){Qe(e)&&ze({request:"GetMicrophoneMute",device:et()},e)},this.callLogSnapShot=function(e){Qe(e)&&ze({request:"CallLogSnapShot",device:et()},e)},this.snapshot=function(){Ke()},this.getAgentState=function(e){Qe(e)&&ze({request:"GetAgentState",device:et()},e)},this.setAgentState=function(t,i){(t=!!t)!==e.localUser.agentStateReady&&Qe(i)&&ze({request:"SetAgentState",device:et(),state:t?n.Ready:n.NotReady},i)},this.handleCallEvent=function(t){var n,i,r;if(t)if(De(),ie)try{switch(t.name){case"CallInformationEvent":!function(e){var t=e.connection.cID,n=null;if(e.pickupNotificationEarly){if(Ve(e.connection.dID))return void m.debug("[CstaSvc]: The pickup notification is for this user. Ignore it");n=$[t];var i=xe(e.connection.dID),r=xe(e.callingDevice);n?(m.debug("[CstaSvc]: Existing pickup call for: ",i.dn),n.atcCallInfo.setCstaConnection(e.connection)):(m.debug("[CstaSvc]: New pickup call for: ",i.dn),(n=He(t)).atcCallInfo.setPosition(v.Other),n.atcCallInfo.setPartnerDisplay(r),$[t]=n,n.atcCallInfo.setServicesPermitted(e.servicesPermitted),n.setCstaState(C.Ringing),n.direction=c.INCOMING,n.atcCallInfo.setCstaConnection(e.connection),n.atcCallInfo.setOriginalPartnerDisplay(i),me(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName,function(){he(n,i.dn,i.fqn,i.name,f.CallPickupNotification,function(){pt(n)})}))}else{var o=Be(e.connection.dID,e.epid);if(n=o===v.WebRTC?We(t):$[t]){if(n.atcCallInfo.setCstaConnection(e.connection),e.callingDevice&&!Ve(e.callingDevice)){var a=xe(e.callingDevice);n.atcCallInfo.setPartnerDisplay(a),me(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName)}e.servicesPermitted&&(n.atcCallInfo.setServicesPermitted(e.servicesPermitted),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.sST&&(n.checkCstaState(C.ConferenceHolding)?n.setCstaState(C.Holding):n.checkCstaState(C.Conference)&&n.setCstaState(C.Active))),n.checkCstaState([C.Offered,C.ExtendedRinging,C.Idle])?m.debug("[CstaSvc]: Do not publish /atccall/info event at Offered state"):(m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n]))}else m.warn("[CstaSvc]: Could not find call corresponding to CallInformation Event.")}}(t);break;case"ConferencedEvent":!function(t){t.secondaryOldCall&&(e.localUser.isOsBizCTIEnabled&&tt(t.secondaryOldCall.cID)?m.debug("[CstaSvc]: Cleared secondary atc call with Call Id = ",t.secondaryOldCall.cID):Ue(t.secondaryOldCall.cID));var n=null,i=t.primaryOldCall.cID,r=Be(t.primaryOldCall.dID,t.epid);(n=r===v.WebRTC?We(i):$[i])?(t.conferenceConnections.forEach(function(e){if(e.endpoint&&Ve(e.endpoint)||e.connection&&Ve(e.connection.dID)){if(n.atcCallInfo.setCstaConnection(e.connection),n.isAtcRemote){var t=n.atcCallInfo,r=n.peerUser,o=n.participants,a=n.direction;n.setCstaState(C.Idle),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n]),delete $[i],(n=He(e.connection.cID)).atcCallInfo=t,n.peerUser=r,n.participants=o,n.direction=a,$[e.connection.cID]=n}m.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",e.connection)}else{var s=e.endpoint&&xe(e.endpoint)||xe(e.connection.dID);le.push({call:n,userId:e.connection.dID,participantId:e.connection.dID,phoneNumber:s.dn,displayName:s.name}),de||(de=!0,Oe())}}),"hold"===t.localConnectionInfo?n.setCstaState(C.ConferenceHolding):(n.setCstaState(C.Conference),!n.isRemote&&e.localUser.isOsBizCTIEnabled&&n.setState(l.Active)),n.atcCallInfo.setServicesPermitted(t.servicesPermitted),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n])):m.debug("[CstaSvc]: Could not find a call with Call Id = "+i)}(t);break;case"ConnectionClearedEvent":!function(t){var n=t.droppedConnection.cID,i=We(n)||$[n];if(ae={},i){if(i.pickupNotification&&i.isHandoverInProgress)return;if(t.pickupNotificationTerminated&&(!t.droppedConnection.dID||Ve(t.droppedConnection.dID)))return void m.debug("[CstaSvc]: The pickup notification terminated event is for this user. Ignore it");if("null"!==t.localConnectionInfo){if(e.localUser.isOsBizCTIEnabled&&"multipleAlerting"===t.cause&&(i.direction===c.INCOMING||i.isRemote))return void m.info("[CstaSvc]: Discarding ConnectionClearEvent due to parallel ringing");if(m.info("[CstaSvc]: Local connection info is not null.Update services permitted."),i.atcCallInfo.setServicesPermitted(t.servicesPermitted),i.participants.length>1&&(i.participants.some(function(e){return e.participantId===t.droppedConnection.dID&&(i.removeParticipant(e.userId),!0)}),1===i.participants.length&&i.isRemote||2===i.participants.length&&!i.isRemote)){var r=i.participants[i.isRemote?0:1];i.removeParticipant(r.userId),me(i,r.phoneNumber,r.phoneNumber,r.displayName),i.checkCstaState(C.Conference)?i.setCstaState(C.Active):i.checkCstaState(C.ConferenceHolding)&&i.setCstaState(C.Holding)}return i.atcCallInfo.getMissedReason()||i.establishedTime||(i.direction===c.INCOMING?i.atcCallInfo.setMissedReason(Ve(t.releasingDevice)?S.DECLINED:S.CANCELLED):i.atcCallInfo.setMissedReason(Ve(t.releasingDevice)?S.CANCELLED:S.DECLINED)),m.debug("[CstaSvc]: Publish /atccall/info event"),void h.publish("/atccall/info",[i])}if(m.info("[CstaSvc]: Local connection info is null."),i.atcCallInfo.getMissedReason()||i.establishedTime||i.atcCallInfo.setMissedReason(i.direction===c.INCOMING&&"normalClearing"===t.cause?S.DECLINED:S.CANCELLED),i.clearAtcHandoverInProgress(),i.atcCallInfo.clearOutgoingCallCampedOn(),e.localUser.isOsBizCTIEnabled&&(i.atcCallInfo.getCstaReconnectId().cID&&(ze({request:"ClearConnection",connectionToBeCleared:i.atcCallInfo.getCstaReconnectId()}),i.atcCallInfo.setCstaReconnectId({})),Z&&Z.checkState(l.ActiveRemote)&&(Z.pullBlocked=!1),tt(n)))return;if(i.checkCstaState(C.Busy)&&i.atcCallInfo.isCallBackAllowed()&&!e.localUser.isOsBizCTIEnabled)return void N(function(){m.debug("[CstaSvc]: Callback presenting timer expired - terminate call"),Ue(i.atcCallInfo.getCstaCallId())},U)}var o=te[t.droppedConnection.cID]||te[H];o&&((i=He(o)).atcCallInfo.setCstaConnection(t.droppedConnection),"normalClearing"!==t.cause&&(i.setCstaState(C.TransferFailed),i.atcCallInfo.setTransferCallFailedCause(t.cause)),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i]),delete te[t.droppedConnection.cID],delete te[H]),Ue(t.droppedConnection.cID)}(t);break;case"DeliveredEvent":!function(t){var n,i,r,o,a,s=null;if(ae={},Ve(t.callingDevice))o=C.Delivered,i=t.alertingDevice,r=t.calledDevice,n={cID:t.connection.cID,dID:t.callingDevice},a=c.OUTGOING;else{if(!Ve(t.alertingDevice))return void m.error("[CstaSvc]: ONS DN is neither in callingDevice nor in alertingDevice?!?");o=C.Ringing,i=t.callingDevice,n=t.connection,a=c.INCOMING}var d=Be(n.dID,t.epid),u=xe(i);if("enteringDistribution"===t.cause)return m.debug("[CstaSvc]: This event is for the master of the parallel hunt group"),(s=$[n.cID])||(s=He(n.cID),$[n.cID]=s,m.debug("[CstaSvc]: Created new Remote Call object for callID= ",n.cID)),s.setCstaState(o),s.atcCallInfo.setPosition(d),s.atcCallInfo.setCstaConnection(n),s.atcCallInfo.setIgnoreCall(),void(s.atcCallInfo.masterParallelHgCall=!0);if(!e.localUser.isOsBizCTIEnabled||"keyOperation"!==t.cause&&"singleStepTransfer"!==t.cause||d!==v.Desk||a!==c.INCOMING||$[n.cID]){if(d===v.WebRTC){if(s=We(n.cID)){if(s.atcCallInfo.setCstaConnection(n),s.atcCallInfo.setServicesPermitted(t.servicesPermitted),s.setCstaState(o),It(s,l.Delivered),d=s.isRemote?v.Other:d,s.atcCallInfo.setPosition(d),u){m.debug("[CstaSvc]: Update partner display to ",u),s.atcCallInfo.setPartnerDisplay(u),me(s,s.atcCallInfo.peerDn,s.atcCallInfo.peerFQN,s.atcCallInfo.peerName);var E=we(n.cID);E&&(E.forwarded&&he(s,E.redirectingUser.phoneNumber,E.redirectingUser.fqNumber,E.redirectingUser.displayName,E.redirectingUser.redirectionType),E.atcCallInfo.setIgnoreCall(!0),Ue(n.cID))}return m.debug("[CstaSvc]: Publish /atccall/info event"),void h.publish("/atccall/info",[s])}if(ue&&ue.atcCallInfo&&ue.atcCallInfo.getCstaCallId()===t.connection.cId)return void m.warn("[CstaSvc]: The Delivered event is for a local call that was just terminated. Ignore it");m.warn("[CstaSvc]: There is no local call associated with the Delivered Event")}var T=n.cID;if((s=$[T])||(s=He(T),$[T]=s,m.debug("[CstaSvc]: Created new Remote Call object for callID= ",T)),s.atcCallInfo.masterParallelHgCall)m.debug("[CstaSvc]: Ignore Delivered event for master parallel hunt group");else if(s.setCstaState(o),s.atcCallInfo.setServicesPermitted(t.servicesPermitted),s.atcCallInfo.setPosition(d),s.atcCallInfo.setCstaConnection(n),s.clearAtcHandoverInProgress(),s.direction=a,s.receivedAlerting=!0,u){if(s.atcCallInfo.setPartnerDisplay(u),r){var p=xe(r);p.fqn!==u.fqn?s.atcCallInfo.setOriginalPartnerDisplay(p):s.atcCallInfo.setOriginalPartnerDisplay(u)}me(s,s.atcCallInfo.peerDn,s.atcCallInfo.peerFQN,s.atcCallInfo.peerName,function(){ie&&(m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[s]))})}else m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[s])}else m.debug("[CstaSvc]: This event is received for parallel ringing on device.")}(t);break;case"DigitsGeneratedEvent":i=(n=t).connection.cID,(r=We(i))||(r=$[i]),r&&Ve(n.connection.dID)&&(m.info("[CstaSvc]: Digits played",n.digitGeneratedList),h.publish("/call/singleDigitSent",[r]));break;case"DivertedEvent":nt(t);break;case"EstablishedEvent":!function(t){var n,i,r,o,a;if(ae={},Ve(t.callingDevice))n={cID:t.establishedConnection.cID,dID:t.callingDevice},i=t.answeringDevice,r=c.OUTGOING,a=xe(t.calledDevice);else{if(!Ve(t.answeringDevice))return void m.error("[CstaSvc]: ONS DN is neither in callingDevice nor in answeringDevice?!?");n=t.establishedConnection,i=t.callingDevice,r=c.INCOMING,a=xe(t.callingDevice)}m.debug("[CstaSvc]: LocalConnection: ",n),m.debug("[CstaSvc]: Partner Device ID: ",i);var s=xe(i),d=Be(n.dID,t.epid);if(d===v.WebRTC){if(m.info("[CstaSvc]: The Established Event is for a local WebRTC call"),o=We(n.cID)){o.atcCallInfo.setCstaConnection(n),m.info("[CstaSvc]: Set the CSTA connection ID for the active call: ",n),o.isRemote&&(m.warn("[CstaSvc]: There is no local call associated with the Established Event"),d=v.Other),o.atcCallInfo.setServicesPermitted(t.servicesPermitted),"hold"===t.localConnectionInfo?o.setCstaState(C.Holding):o.setCstaState(C.Active),It(o,l.Active),o.atcCallInfo.setPartnerDisplay(s),o.atcCallInfo.setPosition(d),o.clearAtcHandoverInProgress(),o.atcCallInfo.clearOutgoingCallCampedOn(),o.receivedAlerting=!0,me(o,o.atcCallInfo.peerDn,o.atcCallInfo.peerFQN,o.atcCallInfo.peerName),it(o,n.cID);var u=we(n.cID);return u&&(u.forwarded||u.pickupNotification)?(he(o,u.redirectingUser.phoneNumber,u.redirectingUser.fqNumber,u.redirectingUser.displayName,u.redirectingUser.redirectionType===f.CallForward?f.CallForward:f.CallPickedUp),u.atcCallInfo.setIgnoreCall(!0),Ue(n.cID)):"callPickup"===t.cause&&r===c.INCOMING&&(o.pickupNotification?o.setRedirectionType(f.CallPickedUp):t.lastRedirectionDevice&&he(o,xe(t.lastRedirectionDevice).dn,xe(t.lastRedirectionDevice).fqn,xe(t.lastRedirectionDevice).name,f.CallPickedUp)),o.isRemote||o.isOsBizSecondCall||o.updateCallState(),m.debug("[CstaSvc]: Publish /atccall/info event"),void h.publish("/atccall/info",[o])}if("recall"===t.cause||"callPickup"===t.cause)return o=O.findActivePhoneCall(),m.info("[CstaSvc]: Original call callId:",o.atcCallInfo.getCstaCallId()),o.atcCallInfo.setCstaConnection(n),o.atcCallInfo.setServicesPermitted(t.servicesPermitted),"hold"===t.localConnectionInfo?o.setCstaState(C.Holding):o.setCstaState(C.Active),o.updateCallState(),m.debug("[CstaSvc]: Publish /atccall/info event"),void h.publish("/atccall/info",[o]);if(m.debug("[CstaSvc]: There is no local or remote call, change the position to Other"),d=v.Other,Ve(t.answeringDevice)&&!t.epid)return void m.debug("[CstaSvc]: This is a call answered by VM. Ignore it");if(ue&&ue.atcCallInfo&&ue.atcCallInfo.getCstaCallId()===n.cId)return void m.warn("[CstaSvc]: The Established event is for a local call that was just terminated. Ignore it")}var E=!1;(o=$[n.cID])||(E=!0,it(o=He(n.cID),n.cID)),o.atcCallInfo.masterParallelHgCall?m.debug("[CstaSvc]: Ignore Established event for master parallel hunt group"):(o.atcCallInfo.setPosition(d),o.atcCallInfo.setPartnerDisplay(s),o.atcCallInfo.setOriginalPartnerDisplay(a),me(o,o.atcCallInfo.peerDn,o.atcCallInfo.peerFQN,o.atcCallInfo.peerName),o.atcCallInfo.setServicesPermitted(t.servicesPermitted),o.atcCallInfo.setCstaConnection(n),o.direction=r,o.atcCallInfo.transferCb&&(o.atcCallInfo.transferCb&&o.atcCallInfo.transferCb(null,null,o),delete o.atcCallInfo.transferCb),o.clearAtcHandoverInProgress(),o.atcCallInfo.clearOutgoingCallCampedOn(),o.receivedAlerting=!0,"hold"===t.localConnectionInfo?o.setCstaState(C.Holding):(o.setCstaState(C.Active),o.clearRetrieveInProgress()),"callPickup"===t.cause&&(o.pickupNotification?o.setRedirectionType(f.CallPickedUp):t.lastRedirectionDevice&&he(o,xe(t.lastRedirectionDevice).dn,xe(t.lastRedirectionDevice).fqn,xe(t.lastRedirectionDevice).name,f.CallPickedUp)),E&&(m.debug("[CstaSvc]: Created new Remote Call object: ",o),$[n.cID]=o),e.localUser.isOsBizCTIEnabled&&Z&&(Z.pullBlocked=!0),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[o]))}(t);break;case"FailedEvent":ot(t);break;case"HeldEvent":!function(e){var t=e.heldConnection.cID,n=We(t);if(n||(n=$[t])){if(Ve(e.holdingDevice)){switch(n.atcCallInfo.setCstaConnection(e.heldConnection),n.getCstaState()){case C.Held:n.setCstaState(C.HoldOnHold);break;case C.Conference:n.setCstaState(C.ConferenceHolding);break;default:n.setCstaState(C.Holding),n.isRemote||n.setState(l.Holding)}n.clearHoldInProgress()}else"hold"===e.localConnectionInfo?n.checkCstaState(C.ConferenceHolding)||n.setCstaState(C.HoldOnHold):n.checkCstaState(C.Conference)||n.setCstaState(C.Held);n.atcCallInfo.setServicesPermitted(e.servicesPermitted),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n])}else m.warn("[CstaSvc]: Could not find call corresponding to Held Event.")}(t);break;case"OfferedEvent":!function(t){var n,i;if(Ve(t.offeredDevice)){if(n=t.offeredConnection,i=t.callingDevice,m.debug("[CstaSvc]: LocalConnection: ",n),m.debug("[CstaSvc]: Partner Device ID: ",i),e.localUser.callForwardingEnabled)return m.debug("[CstaSvc]: Immediate call forwarding is enabled. Accept call"),void ze({request:"AcceptCall",callToBeAccepted:n});var r=xe(i),o=$[n.cID];if(!o||!o.pickupNotification){if((o=He(n.cID)).atcCallInfo.setPosition(v.Desk),o.atcCallInfo.setPartnerDisplay(r),me(o,o.atcCallInfo.peerDn,o.atcCallInfo.peerFQN,o.atcCallInfo.peerName),o.atcCallInfo.setServicesPermitted(t.servicesPermitted),o.setCstaState(C.Offered),o.direction=c.INCOMING,o.atcCallInfo.setCstaConnection(n),k.test(t.cause)){var a=xe(t.lastRedirectionDevice);he(o,a.dn,a.fqn,a.name,f.CallForward)}m.debug("[CstaSvc]: Created new Remote Call object: ",o),$[n.cID]=o,ae={cID:n.cID,dID:je(v.WebRTC,null,!0)},e.localUser.selectedRoutingOption!==R.DeskPhone.name?O.isSecondCall()||Q.call&&Q.call.isAtcRemote?Ct(o):(ze({request:"AcceptCall",callToBeAccepted:rt(o.atcCallInfo)}),ae={}):ut(o)}}else m.debug("[CstaSvc]: ONS DN is not the offered device. Ignore Offered event.")}(t);break;case"QueuedEvent":!function(t){var n,i,r,o,a;if(Ve(t.queue)){n=t.queuedConnection,i=t.callingDevice,m.debug("[CstaSvc]: LocalConnection: ",n),m.debug("[CstaSvc]: Partner Device ID: ",i),r=Be(n.dID,t.epid);var s=xe(i);if(o=n.cID,!(a=$[o])){if("noAvailableAgents"===t.cause)return void m.debug("[CstaSvc]: Cause=noAvailableAgents. Ignore Queued event");if(e.localUser.isOsBizCTIEnabled&&"multipleQueuing"===t.cause&&r===v.Desk)return void m.debug("[CstaSvc]: Cause=multipleQueuing. Ignore Queued event");a=He(o),$[o]=a,m.debug("[CstaSvc]: Created new Remote Call object for callID= ",o)}a.atcCallInfo.setPosition(r),a.atcCallInfo.setPartnerDisplay(s),me(a,a.atcCallInfo.peerDn,a.atcCallInfo.peerFQN,a.atcCallInfo.peerName),a.setCstaState(C.Parked),a.atcCallInfo.setCstaConnection(n)}else{if(!e.localUser.isOsBizCTIEnabled||!Ve(t.callingDevice)||"campOn"!==t.cause)return void m.debug("[CstaSvc]: ONS DN is not the queue device. Ignore Queued event.");if(r=Be(t.callingDevice),o=t.queuedConnection.cID,!(a=r===v.WebRTC?We(o):$[o]))return void m.debug("[CstaSvc]: Call not found for callID= ",o);a.atcCallInfo.setOutgoingCallCampedOn(),a.isRemote&&a.checkCstaState(C.Busy)&&a.setCstaState(C.Delivered)}a.atcCallInfo.setServicesPermitted(t.servicesPermitted),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[a])}(t);break;case"RetrievedEvent":!function(e){var t=e.retrievedConnection.cID,n=We(t);if(n||(n=$[t])){if(Ve(e.retrievingDevice))n.atcCallInfo.setCstaConnection(e.retrievedConnection),n.checkCstaState(C.HoldOnHold)?(n.setCstaState(C.Held),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.zsiHo&&n.setCstaState(C.Active)):n.checkCstaState(C.ConferenceHolding)?(n.setCstaState(C.Conference),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.sST&&n.setCstaState(C.Active)):n.setCstaState(C.Active),n.isRemote||n.setState(l.Active),n.clearRetrieveInProgress(),n.atcCallInfo.setCstaReconnectId({});else if(n.checkCstaState([C.ConferenceHolding,C.Conference]))"hold"===e.localConnectionInfo?n.setCstaState(C.ConferenceHolding):n.setCstaState(C.Conference);else if("hold"===e.localConnectionInfo?n.setCstaState(C.Holding):n.setCstaState(C.Active),n.isRemote){var i=xe(e.retrievingDevice);n.atcCallInfo.setPartnerDisplay(i),me(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName)}n.atcCallInfo.setServicesPermitted(e.servicesPermitted),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n])}else m.warn("[CstaSvc]: Could not find call corresponding to Retrieved Event.")}(t);break;case"ServiceCompletionFailureEvent":!function(e){var t=e.primaryCall.connectionID.cID,n=Be(e.primaryCall.connectionID.dID,Y.epid)===v.WebRTC?We(t):$[t];if(!n)return m.debug("[CstaSvc]: Could not find a call with Call Id = "+t),m.debug("[CstaSvc]: Publish /atccall/hangingcall event"),void h.publish("/atccall/hangingcall",t);if(m.debug("[CstaSvc]: Publish /atccall/moveFailed event"),h.publish("/atccall/moveFailed"),n.checkState([l.Terminated,l.Idle])){var i=n.atcCallInfo,r=n.peerUser,o=n.establishedTime,a=n.direction;delete $[t],(n=He(t)).atcCallInfo=i,n.peerUser=r,n.establishedTime=o,n.direction=a,$[t]=n}n.clearAtcHandoverInProgress(),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[n])}(t);break;case"ServiceInitiatedEvent":!function(e){var t,n=Be(e.initiatingDevice,e.epid);if(n===v.WebRTC&&(t=We(e.initiatedConnection.cID)))if(t.atcCallInfo.setCstaConnection(e.initiatedConnection),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),!t.isRemote&&t.checkState([l.Initiated,l.Ringing,l.Delivered]))m.info("[CstaSvc]: Set the CSTA connection ID for the call: ",e.initiatedConnection),t.setCstaState(C.Initiated),It(t,l.Delivered),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[t]);else{if(t.isRemote)return void m.info("[CstaSvc]: Set the CSTA connection ID for the remote call: ",e.initiatedConnection);m.error("[CstaSvc]: Call Initiated for WebRTC client has no active call or not in Initiated/Ringing state")}else(t=$[e.initiatedConnection.cID])||(t=He(e.initiatedConnection.cID)).setCstaState(C.Initiated),t.atcCallInfo.setPosition(n),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),t.direction=c.OUTGOING,t.atcCallInfo.setCstaConnection(e.initiatedConnection),$[e.initiatedConnection.cID]=t,m.debug("[CstaSvc]: Created new Remote Call object: ",t)}(t);break;case"TransferredEvent":!function(e){if("null"!==e.localConnectionInfo){var t=null,n=e.primaryOldCall.cID,i=We(n)||$[n];if(i){if(e.transferredConnections.forEach(function(r){if(r.endpoint&&Ve(r.endpoint)||r.connection&&Ve(r.connection.dID))i.atcCallInfo.setCstaConnection(r.connection),m.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",r.connection);else{if(i.isAtcRemote){var o=i.atcCallInfo;i.setCstaState(C.Idle);var a=i.peerUser,s=i.direction,c=i.establishedTime;m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i]),delete $[n],(i=He(r.connection.cID)).atcCallInfo=o,me(i,a.phoneNumber,a.phoneNumber,a.displayName),i.direction=s,i.establishedTime=c;var l=xe(e.transferringDevice);i.atcCallInfo.setOriginalPartnerDisplay(l),$[i.callId]=i}t=r.endpoint&&xe(r.endpoint)||r.connection.dID&&xe(r.connection.dID)}}),!i.isRemote&&!i.isEstablished())return m.debug("[CstaSvc]: This is a WebRTC call that has not been answered. Update the display"),void(t&&(i.atcCallInfo.setPartnerDisplay(t),me(i,i.atcCallInfo.peerDn,i.atcCallInfo.peerFQN,i.atcCallInfo.peerName,function(){ie&&(m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i]))})));switch(e.localConnectionInfo){case"hold":i.setCstaState(C.Holding);break;case"connected":i.setCstaState(C.Active);break;case"alerting":i.setCstaState(C.Ringing);break;default:m.debug("[CstaSvc]: Unexpected localConnectionInfo: ",e.localConnectionInfo)}i.atcCallInfo.setServicesPermitted(e.servicesPermitted),t&&(i.atcCallInfo.setPartnerDisplay(t),me(i,i.atcCallInfo.peerDn,i.atcCallInfo.peerFQN,i.atcCallInfo.peerName,function(){ie&&(m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i]))})),m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[i])}else m.debug("[CstaSvc]: Could not find a call with Call Id = "+n)}else{if(e.secondaryOldCall){Ue(e.primaryOldCall.cID);var r=$[e.secondaryOldCall.cID];r&&r.atcCallInfo.setMissedReason(S.TRANSFERRED),N(function(){Ue(e.secondaryOldCall.cID)},1e3)}else{if(Ve(e.transferringDevice)&&Ve(e.transferredToDevice)){var o=$[e.primaryOldCall.cID];o&&o.atcCallInfo.setIgnoreCall(!0)}Ue(e.primaryOldCall.cID)}if("singleStepTransfer"===e.cause){var a=W.getTransferredCall(e.primaryOldCall.cID);a&&(W.clearTransferredCall(e.primaryOldCall.cID),te[a.failedCallId]=e.primaryOldCall.cID)}else if("transfer"===e.cause){var s=He(e.secondaryOldCall.cID);m.debug("[CstaSvc]: Publish /atccall/info event"),h.publish("/atccall/info",[s])}}}(t);break;default:m.debug("[CstaSvc]: Ignore CSTA Call Event ("+t.name+")")}}catch(e){m.error(e)}else m.debug("[CstaSvc]: Ignore any call event until snapshot is performed")},this.handleDeviceEvent=function(e){if(e)try{switch(e.name){case"BackInServiceEvent":re=!1,Ze();break;case"OutOfServiceEvent":re=!0,Ze();break;default:m.debug("[CstaSvc]: Ignore CSTA Device Event ("+e.name+")")}}catch(e){m.error(e)}},this.handleLogicalDeviceEvent=function(t){var n;if(t)try{switch(t.name){case"ForwardingEvent":(n=t)&&(Y.forwardList.some(function(e){return!!(e.forwardingType===n.forwardingType||Ye(e.forwardingType)&&Ye(n.forwardingType))&&(e.forwardStatus=n.forwardStatus,e.forwardDN=n.forwardTo,!0)})||Y.forwardList.push({forwardDN:n.forwardTo,forwardStatus:n.forwardStatus,forwardingType:n.forwardingType}),Ye(n.forwardingType)&&(e.localUser.callForwardingAvailable=!0,n.forwardTo!==Y.vm?(e.localUser.callForwardingNumber=I.format(n.forwardTo),e.localUser.callForwardingEnabled=n.forwardStatus,e.localUser.callForwardingToVMEnabled=!1):(e.localUser.callForwardingToVMEnabled=n.forwardStatus,e.localUser.callForwardingEnabled=!1,e.localUser.isOsBizCTIEnabled&&(e.localUser.callForwardingNumber=Y.vm))),n.hasOwnProperty("staticOndActive")&&(n.staticOndActive?(Te=n.staticOndDN,n.staticOndDN===g.cleanPhoneNumber(e.localUser.reroutingPhoneNumber)?e.localUser.selectedRoutingOption=R.AlternativeNumber.name:(e.localUser.selectedRoutingOption=R.Other.name,e.localUser.otherRoutingNumber=I.format(n.staticOndDN))):(Te="",e.localUser.selectedRoutingOption!==R.AlternativeNumber.name&&e.localUser.selectedRoutingOption!==R.Other.name||(e.localUser.selectedRoutingOption=R.DefaultRouting.name))),n.hasOwnProperty("voicemailActive")&&(e.localUser.voicemailPBXEnabled=!0,e.localUser.voicemailActive=n.voicemailActive,e.localUser.voicemailRingDuration=n.voicemailRingDuration,Se=n.voicemailRingDuration),n.hasOwnProperty("mainRingDuration")&&(e.localUser.ringDurationEnabled=!0,e.localUser.mainRingDuration=n.mainRingDuration,e.localUser.clientRingDuration=n.clientRingDuration,e.localUser.cellRingDuration=n.cellRingDuration,Ie=n.mainRingDuration,fe=n.clientRingDuration,Re=n.cellRingDuration,e.localUser.alternativeNumber=n.alternativeNumber,e.localUser.routeToCell=n.routeToCell,e.localUser.ringDurationConfigurable=n.hasOwnProperty("overrideProfile")?n.overrideProfile:!e.localUser.isOSV),m.debug("[CstaSvc]: Publish /localUser/update event"),h.publish("/localUser/update",[e.localUser]),m.debug("[CstaSvc]: Publish /csta/forwardingEvent"),h.publish("/csta/forwardingEvent"));break;case"AgentReadyEvent":case"AgentNotReadyEvent":case"AgentBusyEvent":case"AgentLoggedOffEvent":case"AgentLoggedOnEvent":!function(t){if(e.localUser){switch(t.name){case"AgentReadyEvent":e.localUser.agentStateReady=!0;break;case"AgentNotReadyEvent":case"AgentBusyEvent":e.localUser.agentStateReady=!1;break;case"AgentLoggedOffEvent":e.localUser.isAgent=!1,e.localUser.agentStateReady=!1;break;case"AgentLoggedOnEvent":e.localUser.isAgent=!0,e.localUser.agentStateReady=!1;break;default:return}m.debug("[CstaSvc]: Publish /agent/state/ready event"),h.publish("/agent/state/ready",[e.localUser.agentStateReady])}}(t);break;default:m.debug("[CstaSvc]: Ignore CSTA Logical Device Event ("+t.name+")")}}catch(e){m.error(e)}},this.isPrimaryClient=function(){return oe},this.getDisplayInfo=xe,this.getCallDevices=dt,this.getPushDevices=function(){var e=[];return re||e.push(v.Desk),Y&&Y.cell&&e.push(v.Cell),e},this.getAnswerDevices=function(t){var n=[];return t&&(re||n.push(v.Desk),Y&&Y.cell&&t.getPosition()!==v.Cell&&n.push(v.Cell),Y&&Y.vm&&(e.localUser.voicemailActive||e.localUser.isOsBizCTIEnabled)&&!t.pickupNotification&&n.push(v.VM)),n},this.updateStaticOnd=function(t,n){if(Qe(n)){t=!!t,m.debug("[CstaSvc]: Update static OND status to ",t);var i={staticOndActive:t};if(t&&(i.staticOndDN=g.cleanPhoneNumber(e.localUser.reroutingPhoneNumber),!i.staticOndDN))return void(n&&n("Cannot activate static OND without the static OND DN"));t!==!!Te||t&&i.staticOndDN!==Te?ze({request:"SetForwarding",device:et(),staticOndActive:i.staticOndActive,staticOndDN:i.staticOndDN},function(e){e?n&&n(e):(Te=i.staticOndDN||"",n&&n(null))}):n&&n(null)}},this.updateRoutingOption=function(e,t){switch(e){case R.AlternativeNumber.name:W.updateStaticOnd(!0,function(e){e?t&&t(e):W.setForwardingToVM(!1,t)});break;case R.VM.name:W.setForwardingToVM(!0,function(e){e?t&&t(e):W.updateStaticOnd(!1,t)});break;default:W.setForwardingToVM(!1,function(e){e?t&&t(e):W.updateStaticOnd(!1,t)})}},this.setForwardingImmediate=function(t,n,i){n=n||e.localUser.callForwardingNumber;var r={activateForward:!!t,forwardDN:g.cleanPhoneNumber(n),forwardingType:"forwardImmediate"};W.setForwarding(r,i)},this.setForwardingToVM=function(e,t){if(W.getForwardingVMStatus()!==e){var n={activateForward:!!e,forwardDN:g.cleanPhoneNumber(Y.vm),forwardingType:"forwardImmediate"};W.setForwarding(n,t)}else t&&t()},this.getForwardingData=function(){return Y.forwardList},this.getForwardingImmediate=function(){var e=Y.forwardList.find(function(e){return Ye(e.forwardingType)&&e.forwardDN!==Y.vm});return{status:!(!e||!e.forwardStatus),forwardDN:e&&e.forwardDN}},this.getForwardingVMStatus=function(){return Y.forwardList.some(function(e){return Ye(e.forwardingType)&&e.forwardDN===Y.vm&&e.forwardStatus})},this.setVoicemail=function(t,n,i){if(Qe(i))if(n=n||Se,e.localUser.pbxCallForwardToVoiceMailSupported&&e.localUser.voicemailPBXEnabled)if(m.debug("[CstaSvc]: Set voice mail duration to: ",n),t!==e.localUser.voicemailActive||t&&Se!==n){var r={request:"SetForwarding",device:et(),voicemailActive:t,voicemailRingDuration:t?n:void 0};at(function(){ze(r,function(e){e?i&&i(e):(Se=n,i&&i(null))})})}else i&&i(null);else i&&i("Cannot configure VM on PBX")},this.setRoutingTimers=function(t,n){if(Qe(n))if(e.localUser.ringDurationEnabled){if(m.debug("[CstaSvc]: Set routing timers to: ",t),Ie!==t.mainRingDuration||Re!==t.cellRingDuration||fe!==t.clientRingDuration||!e.localUser.routeToCell){var i={request:"SetForwarding",device:et(),mainRingDuration:t.mainRingDuration||void 0,clientRingDuration:t.clientRingDuration||void 0,cellRingDuration:t.cellRingDuration||void 0,routeToCell:!0};at(function(){ze(i,function(e){e?n&&n(e):(Ie=t.mainRingDuration||Ie,fe=t.clientRingDuration||fe,Re=t.cellRingDuration||Re,n&&n(null))})})}}else m.debug("[CstaSvc]: Cannot set routing timers"),n&&n("Cannot configure routing timers on PBX")},this.startCall=function(t,n,i,r){Qe(r)&&(t?e.localUser.isOsBizCTIEnabled&&t.isHolding()&&t.isRemote?e.circuitLabs.OSBIZ_EXTENDED_TELEPHONY&&Y.supportedFeatures&&Y.supportedFeatures.includes("zhOs")?(m.debug("[CstaSvc]: OSBiz supports exlussive hold for remote call. Send MakeCall"),W.makeCall(n,i,r)):W.retrieve(t,function(e){e?r&&r("res_MakeCallFailed"):W.consultationCall(t,i,r)}):W.consultationCall(t,i,r):W.makeCall(n,i,r))},this},t}(e=function(t){"use strict";var n=t.AtcCallInfo,i=t.Enums.AtcMessage,r=t.BusyHandlingOptions,o=t.ClientApiHandlerSingleton,a=t.Constants,s=t.Enums,c=t.LocalCall,l=t.Proto,d=e.Enums.RedirectionTypes,u=t.RemoteCall,C=t.RoutingOptions,E=t.RtcParticipant,T=t.RtcSessionController,p=t.ScreenSharingController,S=t.Enums.ScreenDisplayAction,I=t.sdpParser,f=t.UserToUserHandlerSingleton,R=t.Utils,v=Object.values(t.Enums.VideoResolutionLevel);return t.CircuitCallControlSvcImpl=function(A,g,_,N,m,h,O,D,y,P,b,U){var L=t.Conversation,M=t.UserProfile;h.debug("New Service: CircuitCallControlSvc");var w=R.isMobile(),G="dotnet"===N.navigator.platform,H=!!N.cordova,k=3200,V=6e4,F=2e3,B=5e3,x=this,W=o.getInstance(),Y=f.getInstance(),K=[],q=null,j=null,Q=[],z=null,X=!1,J=!1,$={},Z=[],ee=null,te=!1,ne=!1,ie={},re=null,oe=null,ae=null,se=null,ce=null;function le(e){return y.getConversationAsGuestById(e)||y.getConversationFromCache(e)}function de(){if(oe){var e=1e3*(oe.ttl||0);e=Math.max(e-V,0),oe.expirationTimestamp=Date.now()+e}}function ue(e){return A.isCMR?(e.hdVideo=e.video,e.desktop=!1):(A.localUser.canUseHDVideo||A.localUser.canUseHDScreenShare)&&(e.hdVideo=e.video&&A.localUser.canUseHDVideo,e.hdDesktop=e.desktop&&A.localUser.canUseHDScreenShare),e}function Ce(e){return new m(function(t,n){var i=oe&&oe.expirationTimestamp||0;if(Date.now()<i){var r=new Date(i);return h.debug("[CircuitCallControlSvc]: Existing credentials are still valid. Expiration: "+r),void t(oe)}h.debug("[CircuitCallControlSvc]: Get new TURN credentials");var o=U.createActionInfo(e,a.RtcDiagnosticsAction.RENEW_TURN_CREDENTIALS);W.renewTurnCredentials(e.callId,function(i,r){A.$apply(function(){return o&&(o.data=JSON.stringify(r),U.finishActionInfo(e,o)),i?(h.error("[CircuitCallControlSvc]: Error renewing TURN credentials.",i),void n(i)):r&&r.length?(r=r[0],h.info("[CircuitCallControlSvc]: Received new TURN credentials=",r.turnServer),oe=r,de(),void t(oe)):(h.error("[CircuitCallControlSvc]: Error renewing TURN credentials. No server(s) available."),void n("No TURN server(s) available"))})})})}function Ee(e){if(e){if(e.startsWith("res_"))return e;if(e===a.ErrorCode.PERMISSION_DENIED)return"res_JoinRTCSessionFailedPermission";if(e===a.SdpFailedCause.JOIN_FORBIDDEN)return"res_JoinRTCSessionFailedForbidden";if(e===a.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE)return"res_JoinRTCSessionFailedMissingResources";if(e===a.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)return e;if(e===a.ReturnCode.DISCONNECTED||e===a.ReturnCode.FAILED_TO_SEND)return"res_NotConnectedTryAgain"}return"res_JoinRTCSessionFailed"}function Te(){return q&&q.isMocked&&!q.isDirect&&q.participants.length>1}function pe(){!ee&&Te()&&(ee=_(function(){h.debug("[CircuitCallControlSvc]: Active speaker simulation interval has fired"),Te()?q.isEstablished()&&function(){if(R.randomBoolean()){var e=q.participants.filter(function(e){return e.pcState===s.ParticipantState.Active});if(!(e.length<2)){e.push(A.localUser);var t={sessionId:q.callId},n=["first","second","third"],i=R.randomNumber(0,3),r=e.randomCopy(i);-1===r.indexOf(e[0])&&R.randomBoolean()&&(r.unshift(e[0]),i<3&&i++);for(var o=0;o<i;o++)t[n[o]]=r[o].userId;if(h.debug("[CircuitCallControlSvc]: Firing mocked ACTIVE_SPEAKER event: ",t),It(t),!(q.sessionCtrl.getNumberOfExtraVideoChannels()>0||q.hasRemoteScreenShare())){var a=r[0];a&&a.userId!==A.localUser.userId&&a.mediaType.video&&!a.streamId&&ft({sessionId:q.callId,userId:a.userId,videoStreamId:"mock"})}}}}():(h.debug("[CircuitCallControlSvc]: Active speaker simulation is no longer needed. Stop interval."),_.cancel(ee),ee=null)},2e3,0,!1))}function Se(e,t){if(!e.checkState(s.CallState.Ringing)||(Z.push(e),!t)){for(var n=0;n<K.length;n++)if(e.sameAs(K[n]))return h.debug("[CircuitCallControlSvc]: Updating call with callId = "+e.callId),void(K[n]=e);K.push(e),e===q&&pe(),A.localUser.isOsBizCTIEnabled&&e.isTelephonyCall&&!e.isRemote&&q&&e!==q&&(j=e),z=null}}function Ie(e){return!!e&&(A.localUser.remoteControlEnabled||A.isSessionGuest)}function fe(e){var t;for(t=0;t<K.length;t++)if(e.sameAs(K[t])){K.splice(t,1);break}for(t=0;t<Z.length;t++)if(e.sameAs(Z[t])&&!e.isHandoverInProgress){Z.splice(t,1);break}for(t=0;t<Q.length;t++)if(e.sameAs(Q[t])){Q.splice(t,1);break}e.isRemote?z=null:(X=e.sessionCtrl&&e.sessionCtrl.isMuted(),z=e,g(function(){z===e&&(z=null)},k))}function Re(e){e&&(h.debug("[CircuitCallControlSvc]: Publish /conversation/update event. convId = ",e.convId),O.publish("/conversation/update",[e]))}function ve(e,t){e&&e.state!==s.CallState.Terminated&&(h.debug("[CircuitCallControlSvc]: Publish /call/state event. callId = "+e.callId+", state = "+e.state.name),O.publish("/call/state",t?[e,t]:[e]))}function Ae(e,t){e&&e.isEstablished()&&(h.debug("[CircuitCallControlSvc]: Publish /call/rtp/iceConnectionState event. callId = "+e.callId+", iceState = "+t),O.publish("/call/rtp/iceConnectionState",[e.callId,t]))}function ge(e,t,n){if(e){h.info("[CircuitCallControlSvc]: Terminating call...");var i=function(e){if(q&&q.sameAs(e)){var t=x.getIncomingCall();return!!(t&&t.replaces&&t.replaces.sameAs(e))}return!!(q&&q.replaces&&q.replaces.sameAs(e))}(e);yt(e),e.isRemote||(t&&(e.terminateReason=t,function(e){switch(e){case s.CallClientTerminatedReason.DISCONNECTED:case s.CallClientTerminatedReason.FAILED_TO_SEND:case s.CallClientTerminatedReason.REQUEST_TIMEOUT:return!0;default:return!1}}(t)&&function(e){if(e){var t="";switch(e.terminateReason){case s.CallClientTerminatedReason.DISCONNECTED:t=a.RtcClientInfoReason.DISCONNECTED;break;case s.CallClientTerminatedReason.FAILED_TO_SEND:t=a.RtcClientInfoReason.FAILED_TO_SEND;break;case s.CallClientTerminatedReason.REQUEST_TIMEOUT:t=a.RtcClientInfoReason.REQUEST_TIMEOUT;break;default:return}var n={userId:A.localUser.userId,convId:e.convId,clientInfoType:a.RtcClientInfoType.OFFLINE_JOIN_FAILURE,reason:t,timestamp:Date.now(),sessionId:e.callId},i=y.getConversationByRtcSession(e.callId);i&&i.call&&i.call.instanceId&&(n.instanceId=i.call.instanceId),h.info("[CircuitCallControlSvc]: Store new offline join failure. ",n),U.storeClientInfo(n)}}(e)),U.forceFinishDeviceDiagnostics(e)),e.screenShareEventHandler&&(p.unregEvtHandlers(e.screenShareEventHandler),e.screenShareEventHandler=null),e.rejectGetScreenPromise&&(e.rejectGetScreenPromise(a.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED),e.rejectGetScreenPromise=null),e.isOsBizSecondCall||function(e){var t=e&&e.sessionCtrl;t&&(t.onIceCandidate=null,t.onSessionDescription=null,t.sessionClosed=null,t.onSdpConnected=null,t.onIceConnected=null,t.onIceDisconnected=null,t.onRemoteVideoAdded=null,t.onRemoteVideoRemoved=null,t.onRemoteStreamUpdated=null,t.onDTMFToneChange=null,t.onRtcError=null,t.onRtcWarning=null,t.onLocalStreamEnded=null,t.onStatsThresholdExceeded=null,t.onStatsNoOutgoingPackets=null,t.onNetworkQuality=null)}(e),fe(e),e.terminate(),A.closePopoutCallStage&&A.closePopoutCallStage(e),q&&q.sameAs(e)?(g.cancel(q.terminateTimer),q=j,j=null):j&&j.sameAs(e)&&(g.cancel(j.terminateTimer),j=null);var r=le(e.convId);if(r&&r.call&&r.call.sameAs(e)&&!e.isHandoverInProgress){if(e.isTelephonyCall){var o=he()||Oe();r.call=o||null}else r.call=null;(e.isDirect||e.establishedTime&&Date.now()-e.establishedTime>=B)&&y.updateLastCallTime(r),Re(r)}ee&&!q&&(_.cancel(ee),ee=null),n||(h.debug("[CircuitCallControlSvc]: Publish /call/ended event. Replaced=",i),O.publish("/call/ended",[e,i]),e.ratingEvent&&Tt(e.ratingEvent))}}function _e(e){return q&&q.callId===e?q:j&&j.callId===e?j:null}function Ne(e){var t;for(t=0;t<K.length;t++)if(K[t].callId===e)return K[t];for(t=0;t<Z.length;t++)if(Z[t].callId===e)return Z[t];var n=y.getConversationByRtcSession(e);return n&&n.call&&!n.call.isAtcRemote&&n.call.state.established&&n.call.callId===e?(K.push(n.call),n.call):_e(e)}function me(e,t){if(e.participantType===a.RTCParticipantType.TELEPHONY&&e.phoneNumber){var n=q.getParticipant(e.userId);if(n&&n.phoneNumber&&n.phoneNumber===e.phoneNumber)return;D.startReverseLookUp(e.phoneNumber,function(n){if(t.isPresent()&&n){var i=q.getParticipant(e.userId);i&&(i.firstName=n.firstName,i.lastName=n.lastName,i.displayName=n.displayName,i.resolvedUserId=n.userId,rt(t,i))}})}}function he(e){return K.find(function(t){return t.isTelephonyCall&&t.state.established&&!t.isHolding()&&(!e||!t.isRemote)})||null}function Oe(e){return K.find(function(t){return t.isTelephonyCall&&t.state.established&&t.isHolding()&&(!e||!t.isRemote)})||null}function De(){return!A.localUser.selectedBusyHandlingOption||A.localUser.selectedBusyHandlingOption===r.DefaultRouting.name||A.localUser.isSTC}function ye(e,t,n,i,r,o){if(!n&&e.atcCallInfo&&(n=e.atcCallInfo.peerFQN),e.setPeerUser(t,i,r),!r&&n){var a=null;o&&(a=g(function(){a=null,e.isPresent()&&(o(),o=null)},F)),D.startReverseLookUp(n,function(n){g.cancel(a),e.isPresent()&&(n?(e.setPeerUser(t,n.displayName,n.userId),o?o():ve(e)):o&&o())})}else o&&o()}function Pe(e,t,n,i,r){e.redirectingUser&&e.redirectingUser.redirectionType||(e.setRedirectingUser(t,n,i,null,r),n&&D.startReverseLookUp(n,function(i){i&&e.isPresent()&&(e.setRedirectingUser(t,n,i.displayName,i.userId,r),ve(e))}))}function be(e,t){var n,i=(!e.participantType||e.participantType===a.RTCParticipantType.USER||e.participantType===a.RTCParticipantType.MEETING_POINT)&&e.userId!=="echo_"+A.localUser.userId;if(e.userId===A.localUser.userId?n=A.localUser:i&&(n=D.getUserFromCache(e.userId)),!n){e.userDisplayName=e.userDisplayName||e.phoneNumber||A.i18n.map.res_Unknown;var r=e.userDisplayName.split(" ");e.participantType===a.RTCParticipantType.MEETING_POINT?(e.lastName=r[0],e.location=r.splice(1).join(" ").trim().slice(1,-1)):(e.firstName=r[0],e.lastName=r.splice(1).join(" ")),i?(n=M.extend({userId:e.userId,firstName:e.firstName,lastName:e.lastName,displayName:e.displayName,location:e.location,userType:e.participantType===a.RTCParticipantType.MEETING_POINT?a.UserType.MEETING_POINT:a.UserType.REGULAR}),e.isSimulated?n.isSimulated=!0:(n.noData=!0,D.addUsersToCache(n,!0,!1))):(e.participantType===a.RTCParticipantType.SESSION_GUEST&&(e.userType=a.UserType.SESSION_GUEST),n=M.extend(e))}var o=E.createFromUser(n,s.ParticipantState.Active);return o.streamId=e.videoStreamId||"",o.screenStreamId=e.screenStreamId||"",o.mediaType=l.getMediaType(e.mediaTypes||t),o.muted=e.muted||!o.mediaType.audio,o.participantType=e.participantType||a.RTCParticipantType.USER,o.screenSharePointerSupported=!!e.screenSharePointerSupported,o.isModerator=!!e.isModerator,o.isMeetingGuest=e.isMeetingGuest,o.rtcSupportedFeatures=e.rtcSupportedFeatures||[],o.flags=e.flags||[],o}function Ue(e,t){if(t&&t.length){var n=$[e];n?n.turnServers=t:$[e]={turnServers:t}}}function Le(e){switch(e){case a.ReturnCode.DISCONNECTED:return s.CallClientTerminatedReason.DISCONNECTED;case a.ReturnCode.FAILED_TO_SEND:return s.CallClientTerminatedReason.FAILED_TO_SEND;case a.ReturnCode.REQUEST_TIMEOUT:return s.CallClientTerminatedReason.REQUEST_TIMEOUT;default:return s.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED}}function Me(e,t){e&&(h.debug("[CircuitCallControlSvc]: New call has been terminated during call setup. Call Id:",e.callId),e.callState!==s.CallState.Terminated&&ge(e,s.CallClientTerminatedReason.USER_ENDED),t&&t("Call already terminated"))}function we(e,t,n,i){if(!Lt(e,n,i))return!1;q&&(j=q);var r={clientId:W.clientId,isSessionGuest:A.isSessionGuest,midMappingEnabled:Ct(),isSTC:A.localUser.isSTC&&e.isTelephonyConv,stcTransferAllowed:A.localUser.stcTransferAllowed&&e.isTelephonyConv};n.replaces&&t.desktop&&(r.reuseDesktopStreamFrom=n.replaces.sessionCtrl),(q=new c(e,r)).setState(s.CallState.Initiated),Se(q);var o=e.call;if(o&&o.isRemote&&!o.isAtcRemote&&(h.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),n.handover&&(q.activeClient=o.activeClient,o.isTelephonyCall&&(q.atcCallInfo=o.atcCallInfo,ye(q,o.peerUser.phoneNumber,null,o.peerUser.displayName),q.participants=o.participants),e.call=q),q.hadRemoteCall=!0,o.isTelephonyCall||ge(o)),q.setCallIdForTelephony(n.callId),q.setTransactionId(),(A.isSessionGuest||A.isCMR||e.isTemporary)&&!e.testCall&&q.sessionCtrl.useMaxNumberOfExtraVideoChannels(),(J||e.isTelephonyConv)&&(h.info("[CircuitCallControlSvc] Disabling remote video for outgoing call"),q.disableRemoteVideo()),q.direction=s.CallDirection.OUTGOING,q.mediaType=t,n.replaces){q.replaces=n.replaces;var a=n.replaces.sessionCtrl.getLocalStream(T.LOCAL_STREAMS.DESKTOP);a&&(h.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",n.replaces.callId),q.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.DESKTOP,a),n.replaces.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.DESKTOP,null)),(a=n.replaces.sessionCtrl.getLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO))&&(h.debug("[CircuitCallControlSvc] Reusing audio/video stream from call ID=",n.replaces.callId),q.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO,a),n.replaces.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO,null))}if(n.joiningGroupCall&&(q.isJoiningGroupCall=!0),n.callOut&&(q.setPeerUsersAsParticipants(),q.isCallOut=!0),q.isTelephonyCall)if(n.handover){var l=Je(q.callId);l&&(q.atcCallInfo=l.atcCallInfo,l.isAtcConferenceCall()||ye(q,l.peerUser.phoneNumber,null,l.peerUser.displayName),ge(l)),q.handover=!0}else ye(q,n.dialedDn,null,n.toName,n.userId),n.dtmfDigits&&(q.dtmfDigits=n.dtmfDigits);return ve(q),e.call&&e.call.isRemote&&n.handover||q.conferenceCall||(h.debug("[CircuitCallControlSvc]: Publish /call/outgoing event"),O.publish("/call/outgoing",[q])),q.isNewSession=!e.call||e.call!==q&&!n.handover,e.call=q,Re(e),!0}function Ge(e,t){var n=Ct()?[a.RtcSupportedFeatures.MID_STREAM_MAPPING]:[];return A.circuitLabs.DIRECT_TO_CONF_UPGRADE&&e.isDirect&&n.push(a.RtcSupportedFeatures.UPGRADE_TO_CONFERENCE),Ie(e)&&!R.isMobile()&&(t&&t.mediaType&&t.mediaType.desktop?t.screenShareOptions&&t.screenShareOptions.screenControlSupported&&n.push(a.RtcSupportedFeatures.SCREEN_CONTROL):A.localUser.canStartScreenControl&&n.push(a.RtcSupportedFeatures.SCREEN_CONTROLLER)),ut(e)&&n.push(a.RtcSupportedFeatures.SCREEN_SHARE_AND_ACTIVE_SPEAKER_VIDEO),A.circuitLabs.TEAMS&&e.isDirect&&e.checkState(s.CallState.Initiated)&&n.push(a.RtcSupportedFeatures.CALL_PICKUP),n}function He(e,n,i,r){if(!q)return r(Ee()),void h.error("[CircuitCallControlSvc]: joinSession failed because there's no local call");r=r||function(){},h.debug("[CircuitCallControlSvc]: joinSession - rtcSessionId=",i.callId||e.rtcSessionId);var o=q,l=q.sessionCtrl,d=function(t){if(l.onSessionDescription=null,l.onClosed=null,q===o){q.mediaType=l.getMediaConstraints();var n={convId:e.convId,rtcSessionId:q.callId||e.rtcSessionId,ownerId:e.creatorId,sdp:t.sdp,mediaType:q.mediaType,callOut:i.callOut,handover:i.handover,sendInviteCancel:!i.callOut,replaces:i.replaces&&i.replaces.callId,isTelephonyConversation:q.isTelephonyCall,displayName:A.localUser.displayName,transactionId:q.transactionId,screenSharePointerSupported:!(!q.pointer||!q.pointer.isEnabled),rtcSupportedFeatures:Ge(q),pickUpSession:i.pickUpSession};q.isTelephonyCall&&(n.fromDn=R.cleanPhoneNumber(A.localUser.callerId),n.fromName=A.localUser.displayName,n.fromUserId=A.localUser.userId,n.dialedDn=R.cleanPhoneNumber(i.dialedDn),n.toName=i.toName,n.toUserId=i.userId,n.noCallLog=A.localUser.noCallLog),e.isTemporary&&e.guestToken&&(n.guestToken=e.guestToken),A.localUser.hasTelephonyRole&&(n.fromName="Gru",n.fromDn="+19998455246");var s=U.createActionInfo(q,a.RtcDiagnosticsAction.JOIN);s&&(s.data=JSON.stringify(n.sdp)),W.joinRtcCall(n,function(e){A.$apply(function(){if(U.finishActionInfo(q,s),q===o)if(e){var t=q.replaces,n=Le(e);q.hadRemoteCall?x.endCallWithCauseCode(q.callId,n):ge(q,n),t&&(q=t),r(Ee(e))}else h.debug("[CircuitCallControlSvc]: Join RTC session call was successful"),q.conferenceCall&&(h.debug("[CircuitCallControlSvc]: Publish /conference/participant/joining event"),O.publish("/conference/participant/joining",[q])),r(null,i.warning,q);else Me(o,r)})})}else Me(o,r)},u=function(e){if(q===o){var t=Le(e);if(h.warn("[CircuitCallControlSvc]: Failed to initiate call. ",e),i.handover)ge(q,t);else if(q.setDisconnectCause(a.DisconnectCause.CALL_SETUP_FAILED,e),q.hadRemoteCall)x.endCallWithCauseCode(q.callId,t);else{var n=q.isDirect?"terminateRtcCall":"leaveRtcCall";W[n](q.callId,q.disconnectCause,function(e){e&&h.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",e)}),ge(q,t)}r(Ee(e))}else Me(o,r)},C=function(){l.onClosed=null,l.onSessionDescription=null,o&&o.state===s.CallState.Initiated&&o.terminateReason===s.CallClientTerminatedReason.USER_ENDED?r&&r():r&&r(Ee())};(q.isNewSession?function(e,n,i){return new m(function(r,o){var s={convId:e.convId,rtcSessionId:n.callId,ownerId:e.creatorId,mediaNode:n.getMediaNode(),isTelephonyConversation:e.isTelephonyConv,replaces:i.replaces&&i.replaces.callId,desiredRegion:i.desiredRegion};U.startDiagnostics(n),n.isDirect||U.startJoinDelayTimer(n);var l=U.createActionInfo(n,a.RtcDiagnosticsAction.PREPARE);W.prepareSession(s,function(e,i,s){A.$apply(function(){if(l&&(l.data=e?e.toString():JSON.stringify(i),U.finishActionInfo(n,l)),e)return e===a.ErrorCode.RTC_CONCURRENT_INCOMING_CALL?h.debug("[CircuitCallControlSvc]: Concurrent incoming call, aborting own attempt."):e===a.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE?h.error("[CircuitCallControlSvc]: No media nodes available, call not possible."):e===a.ErrorCode.RTC_MEDIA_NODE_UNREACHABLE?h.error("[CircuitCallControlSvc]: Specified media node is not reachable, call not possible."):h.error("[CircuitCallControlSvc]: Error retrieving start session data. ",e),void o(e);if(!i||!i.length)return h.error("[CircuitCallControlSvc]: Error getting TURN credentials. No server(s) available."),void o("No TURN server(s) available");if(h.info("[CircuitCallControlSvc]: Received new TURN credentials"),i=i[0],oe=i,de(),n.isTelephonyCall&&s&&s!==n.callId){var d=le(n.convId);if(d&&(R.isMobile()||t.isSDK)){n.setCallIdForTelephony(s);var u=new c(d,{clientId:n.clientId});d.call=u,u.terminate(),h.debug("[CircuitCallControlSvc]: Publish /call/ended event"),O.publish("/call/ended",[u,!0]),d.call=n,Re(d),h.debug("[CircuitCallControlSvc]: Publish /call/moved event"),O.publish("/call/moved",[u.callId,n.callId]),ve(n)}else{var C=n.callId;n.setCallIdForTelephony(s),ve(n,C)}}r(oe)})})})}(e,q,i):Ce(q)).then(function(t){t&&(Ue(e.rtcSessionId,t.turnServer),l.setTurnUris(t.turnServer),l.setTurnCredentials(t)),function e(){n=ue(n),l.warmup(n,null,function(){q===o?A.$apply(function(){h.debug("[CircuitCallControlSvc]: The connection warmup was successful. Start the call."),l.onSessionDescription=d,l.onClosed=C,pt(q),l.start(n,null)}):Me(o,r)},function(t){if(n.audio&&(n.video||n.hdVideo))return h.info("[CircuitCallControlSvc]: Fetching audio and video media failed, trying again without video"),n.video=!1,n.hdVideo=!1,void e();A.$apply(u.bind(null,t))},i.screenShareOptions)}()}).catch(u)}function ke(e){We(e,function(e){e?h.error("[CircuitCallControlSvc]: Failed to stop the screen control. ",e):h.debug("[CircuitCallControlSvc]: Successfully stopped screen control")})}function Ve(e,t){h.info("[CircuitCallControlSvc]: changeMediaType - data: ",e);var n=_e(e.callId);if(!n)return h.warn("[CircuitCallControlSvc]: changeMediaType - Cannot find local call"),void t("No active call");if(!n.isEstablished())return h.info("[CircuitCallControlSvc]: changeMediaType - The local call is not established"),void t("Call not established");var i=n.sessionCtrl;if(i.isConnStable()){var r=function(n){e.dontReuseAudioStream&&(i.dontReuseAudioStream=!1),t(n)};i.dontReuseAudioStream=e.dontReuseAudioStream;var o=function(t){i.onSessionDescription=null,n.setTransactionId(e.transactionId);var o={rtcSessionId:n.callId,sdp:t.sdp,mediaType:e.mediaType,transactionId:n.transactionId,screenSharePointerSupported:!(!n.pointer||!n.pointer.isEnabled),hosted:e.hosted,replaces:e.replaces,rtcSupportedFeatures:Ge(n,e)};W.changeMediaType(o,function(e){A.$apply(function(){n.clearTransactionId(),e?(i.renegotiationFailed(e),r(e)):h.debug("[CircuitCallControlSvc]: changeMediaType was successful. Wait for SDP_ANSWER event")})})},a=n.localMediaType.desktop;Ce(n).then(function(t){if(i.setTurnUris(t.turnServer),i.setTurnCredentials(t),i.onSessionDescription=o,"boolean"==typeof e.hold)(e.hold?i.holdCall:i.retrieveCall)(function(e){e?(h.error("[CircuitCallControlSvc]: Error in hold/retrieve media"),i.onSessionDescription=null,i.renegotiationFailed(e),r("Error in hold/retrieve media")):r()});else{n.lastMediaType=n.mediaType;var s={changeDesktopMedia:e.changeDesktopMedia,screenShareOptions:e.screenShareOptions,isDirectUpgradingToConf:!!(n.isDirect&&e.hosted&&e.replaces)};e.mediaType=ue(e.mediaType),i.changeMediaType(e.mediaType,s,function(t){A.$apply(function(){if(t)h.warn("[CircuitCallControlSvc]: changeMediaType failed - reason: ",t),i.onSessionDescription=null,i.renegotiationFailed(t),a&&!n.localMediaType.desktop&&i.updateScreenControlData(!1,!1),r(t||"Error changing media");else{var o=n.screenOwnerId===A.localUser.userId;a&&!n.localMediaType.desktop?(h.debug("[CircuitCallControlSvc]: Publish /screenshare/ended event"),O.publish("/screenshare/ended"),n.pointer.isSupported=n.pointer.isEnabled=!1,o&&ke(n.callId)):!o||!e.screenShareOptions||e.screenShareOptions.screenIndex===ce&&e.screenShareOptions.screenControlSupported||ke(n.callId),ce=e.screenShareOptions&&e.screenShareOptions.screenIndex||null,r()}})})}}).catch(function(e){r(Ee(e))})}else t("Connection not stable")}function Fe(e,t,n){n=n||function(){};var i=_e(e);if(!i)return h.warn("[CircuitCallControlSvc]: offerScreenControl - There is no local call"),void n("No active call");if(!t)return h.warn("[CircuitCallControlSvc]: offerScreenControl - controllerId was not provided"),void n("Controller not specified");var r=function(i){h.warn("[CircuitCallControlSvc]: offerScreenControl - Failed to offer screen control. ",i),x.rejectScreenControlRequest(e,t),n(i)};if(i.isEstablished())if(i.hasLocalScreenShare()&&Ie(i)){var o=i.sessionCtrl;o.isConnStable()?(o.onSessionDescription=function(e){if(o.onSessionDescription=null,e.sdp&&e.sdp.sdp&&e.sdp.sdp.includes("webrtc-datachannel")){i.screenOwnerId=A.localUser.userId,i.screenControllerId=t;var a={rtcSessionId:i.callId,sdp:e.sdp,controllerId:i.screenControllerId};W.offerScreenControl(a,function(e){A.$apply(function(){e?(h.debug("[CircuitCallControlSvc]: Failed to offer screen control. ",e),n(e)):(h.debug("[CircuitCallControlSvc]: offerScreenControl was successful. Wait for the SCREEN_CONTROL_ACCEPTED event."),n())})})}else i.screenOwnerId=null,i.screenControllerId=null,r("Failed to create data channel")},Ce(i).then(function(e){o.setTurnUris(e.turnServer),o.setTurnCredentials(e),o.updateScreenControlData(!0,!0),o.offerScreenControl(function(e){e&&A.$apply(function(){h.warn("[CircuitCallControlSvc]: offerScreenControl failed - reason: ",e),o.onSessionDescription=null,o.updateScreenControlData(!1,!1),r(e)})})}).catch(r)):r("Connection not stable")}else r("Screen control not possible");else r("Call not established")}function Be(e,t,n,i){e.screenOwnerId=t,e.screenControllerId=n;var r=e.screenOwnerId===A.localUser.userId,o=r||e.screenControllerId===A.localUser.userId;e.screenOwner=null,e.screenController=null,r||n&&n!==A.localUser.userId?e.screenController=e.participants.find(function(t){return t.userId===e.screenControllerId}):o&&(e.screenOwner=e.participants.find(function(t){return t.userId===e.screenOwnerId})),A.remoteControlActive=o,e.remoteControlActive=o,t||n||(e.preventScreenControlRequestInConf=!1),e.sessionCtrl.updateScreenControlData(o,r),i&&(h.debug("[CircuitCallControlSvc]: Publish /screenControl/updated event"),O.publish("/screenControl/updated",[e]))}function xe(e,t){try{var n=_e(e.sessionId);if(!n)return void h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!n.isEstablished())return void h.info("[CircuitCallControlSvc]: The local call is not established");if(e.clientID&&W.clientId!==e.clientID)return void h.debug("[CircuitCallControlSvc]: Event is not for this client: ",W.clientId);A.$apply(function(){var t;if(e.sdp){var i=e.sdp.type,r=n.sessionCtrl;"offer"===i?(Be(n,e.ownerId,A.localUser.userId,!1),r.onSessionDescription=function(e){r.onSessionDescription=null;var t={rtcSessionId:n.callId,sdp:e.sdp,ownerId:n.screenOwnerId};W.acceptScreenControl(t,function(e){A.$apply(function(){if(e)h.error("[CircuitCallControlSvc]: acceptScreenControl failed. ",e),Be(n,null,null,!0);else{h.debug("[CircuitCallControlSvc]: acceptScreenControl was successful");var t=n.participants.find(function(e){return e.userId===n.screenOwnerId});h.debug("[CircuitCallControlSvc]: Publish /screenControl/accepted event"),O.publish("/screenControl/accepted",[n,t])}})})}):Be(n,A.localUser.userId,n.screenControllerId,!1),Ce(n).then(function(t){r.setTurnUris(t.turnServer),r.setTurnCredentials(t),r.establishScreenControl(e.sdp,n.screenOwnerId,n.screenControllerId,function(e){e?A.$apply(function(){h.warn("[CircuitCallControlSvc]: Screen control event could not be processed - reason: ",e),r.onSessionDescription=null}):h.debug("[CircuitCallControlSvc]: Screen control event was successfully processed.")})}).catch(function(e){h.error("[CircuitCallControlSvc]: getTurnCredentials error: ",e)})}else t=n,W.rejectScreenControl({rtcSessionId:t.callId},function(e){A.$apply(function(){e?h.error("[CircuitCallControlSvc]: rejectScreenControl sending error"):(h.debug("[CircuitCallControlSvc]: rejectScreenControl was successful."),Be(t,null,null,!0))})})})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling "+t+" event. ",e)}}function We(e,t,n){t=t||function(){};var i=_e(e);if(!i)return h.warn("[CircuitCallControlSvc]: stopScreenControl - There is no local call"),void t("No active call");if(!i.isEstablished())return h.info("[CircuitCallControlSvc]: stopScreenControl - The local call is not established"),void t("Call not established");var r=i.sessionCtrl;r&&r.stopScreenControl(function(e){e?A.$apply(function(){h.warn("[CircuitCallControlSvc]: stopScreenControl failed - reason: ",e),r.onSessionDescription=null,t(e)}):(Be(i,null,null,!0),n||W.stopScreenControl({rtcSessionId:i.callId},function(e){A.$apply(function(){e?t(e):(h.debug("[CircuitCallControlSvc]: stopScreenControl was successful."),t())})}))})}function Ye(e,t,n,i,r){if(!e)return null;if(e.isTemporary&&!t&&!e.guestToken)return h.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),O.publish("/conversation/temporary/ended",[e]),null;var o=new u(e);return o.setState(t?s.CallState.ActiveRemote:s.CallState.Started),n&&(n.instanceId&&o.setInstanceId(n.instanceId),o.screenOwnerId=n.screenOwnerId,o.screenControllerId=n.screenControllerId),i&&o.setCallIdForTelephony(i),Se(o),t&&(o.setActiveClient(t),Ze(o),n&&(1===n.participants.length&&n.callOut&&(o.pullNotAllowed=!0),o.mediaType=l.getMediaType(n.mediaTypes))),"function"==typeof r&&r(o),e.call=o,Re(e),ve(o),o}function Ke(e){if(e.isGuestInvite){fe(e);var t=le(e.convId);t&&t.isTemporary&&(h.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),O.publish("/conversation/temporary/ended",[t]))}else e.setState(s.CallState.Started),e.activeClient=null,ve(e),Q.some(function(t,n){return t.callId===e.callId&&(Q.splice(n,1),!0)})}function qe(e){W.declineRtcCall({convId:e.convId,rtcSessionId:e.sessionId,cause:a.InviteRejectCause.BUSY,transactionId:e.transactionId})}function je(e,t,n){var i=new c(e,{clientId:W.clientId,midMappingEnabled:Ct()});i.setInstanceId(t.instanceId),i.setTransactionId(t.transactionId),i.setState(s.CallState.Ringing),t.from&&ye(i,t.from.phoneNumber,t.from.fullyQualifiedNumber,t.from.displayName,null,function(){h.debug("atccall/firstcall"),O.publish(n?"/atccall/firstcall":"/atccall/secondcall",[i])})}function Qe(e,t,n,i){if(i=i||function(){},fe(e=e||q),!e||e.state!==s.CallState.Ringing&&e.state!==s.CallState.Answering)return h.debug("[CircuitCallControlSvc]: call invalid to be declined"),void i("Call Invalid");h.debug("[CircuitCallControlSvc]: decline - rtcSessionId: ",e.callId);var r={convId:e.convId,rtcSessionId:e.callId,cause:t.type,transactionId:e.transactionId},o=[e];t.err&&o.push(t.err),W.declineRtcCall(r,function(e){A.$apply(function(){e?(h.warn("[CircuitCallControlSvc]: Error declining the RTC call. ",e),i(e)):i()})}),e.isDirect||Ye(le(e.convId)),h.debug("[CircuitCallControlSvc]: Publish /call/declining event"),O.publish("/call/declining",o),ge(e,t.type,n)}function ze(e,t,n,i,r){if(!(e=e||q))return h.debug("[CircuitCallControlSvc]: There is no local call"),void(r&&g(r));if(e.terminateTimer)return h.debug("[CircuitCallControlSvc]: Local call is already being terminated. Ignore leave request."),void(r&&g(r));if(r=r||function(){},e.checkState([s.CallState.Ringing,s.CallState.Answering]))Qe(e,{type:t||a.InviteRejectCause.DECLINE},!1,r);else{var o;if(h.debug("[CircuitCallControlSvc]: leaveCall - rtcSessionId=",e.callId),e.clearAtcHandoverInProgress(),e.activeClient)return Ye(o=le(e.convId),e.activeClient,null,null,function(e){q.isTelephonyCall&&(e.atcCallInfo=q.atcCallInfo,e.peerUser=q.peerUser)}),void ge(e,n);if(e.isDirect)W.terminateRtcCall(e.callId,e.disconnectCause,function(e){A.$apply(function(){e&&h.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",e),r&&r(e)})},e.pickUpUserId);else{if(!e.isTestCall&&(o=le(e.convId))&&(e.participants.length||o.isTemporary||e.hadRemoteCall)){var c=Ye(o);e.isDirectUpgradedToConf&&c.setDirectUpgradedToConf()}A.localUser.userId===e.screenOwnerId&&ke(e.callId),W.leaveRtcCall(e.callId,e.disconnectCause,function(e){A.$apply(function(){e&&h.warn("[CircuitCallControlSvc]: Error leaving the RTC call. ",e),r&&r(e)})})}n===s.CallClientTerminatedReason.PAGE_UNLOADED&&(e.terminateReason=n,e.qosSubmitted=!0,b.sendQOSData(e,e.mediaType,e.sessionCtrl.getLastSavedStats())),i||(e.directCall?(h.debug("[CircuitCallControlSvc]: Publish /call/terminating event"),O.publish("/call/terminating",[q])):e.conferenceCall?(h.debug("[CircuitCallControlSvc]: Publish /conference/leaving event"),O.publish("/conference/leaving",[e])):(h.debug("[CircuitCallControlSvc]: Publish /group/leaving event"),O.publish("/group/leaving",[e]))),e.outgoingFailed()?(e.terminateTimer=g(function(){e.terminateTimer=null,ge(e,n)},k),e.terminateReason=n):ge(e,n)}}function Xe(e){if(!q.isDirect)if(q.sessionCtrl.hasMaxExtraVideoChannels())h.debug("[CircuitCallControlSvc]: We already have max number of extra video channels");else{var t=e&&e.participants.length;t||(t=q.sessionCtrl.getNumberOfExtraVideoChannels()+2);var n=Math.max(q.participants.length+1,t);q.sessionCtrl.setExtraVideoChannelsForParticipants(n)&&q.isEstablished()&&(h.debug("[CircuitCallControlSvc]: The number of extra channels has increased. Trigger a media renegotiation."),Ve({callId:q.callId,mediaType:q.localMediaType},function(e){e&&h.warn("[CircuitCallControlSvc]: Failed to renegotiate the media. Error: ",e)}))}}function Je(e){return Q.find(function(t){return t.callId===e})||null}function $e(e){return Z.find(function(t){return t.callId===e})||null}function Ze(e){Q.some(function(t,n){return t===e||t.callId===e.callId&&(Q[n]=e,!0)})||Q.push(e)}function et(e,t){if(t.streamId){var n=0===e.sessionCtrl.getNumberOfExtraVideoChannels();e.isMocked&&!n||e.participants.forEach(function(n){n.streamId===t.streamId&&n.userId!==t.userId&&(n.streamId="",h.debug("[CircuitCallControlSvc]: The video stream has been re-assigned. Clear the streamId for previous participant. [userId, streamId] = ",[n.userId,t.streamId]),q.setParticipantRemoteVideoStream(n),h.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",n.userId),O.publish("/call/participant/updated",[e.callId,n]))})}}function tt(e,t){var n=le(e.convId);A.isSessionGuest||t.setActions(n,A.localUser)}function nt(e,t){var n=0;t&&t.flags&&(t.flags.includes(a.RTCSessionParticipantFlag.CPU_LOAD)?n=2:t.flags.includes(a.RTCSessionParticipantFlag.CPU_LOAD_TRANSCODE)&&(n=1)),n>(e.vrsOverloadLevel||0)&&(e.vrsOverloadLevel=n,h.debug("[CircuitCallControlSvc]: Publish /call/vrsOverloadLevelChanged event. userId =",t.userId+", level = "+n),O.publish("/call/vrsOverloadLevelChanged",[e,t]))}function it(e,t,n,i){var r=e.addParticipant(t,n,i);return r&&(et(e,r),tt(e,r),nt(e,r),t.noData&&!t.reqPending&&(h.debug("[CircuitCallControlSvc]: Get user data for added participant. userId: ",t.userId),D.getUserById(t.userId,function(n,i){i&&(h.debug("[CircuitCallControlSvc]: Successfully retrieved participant data. userId: ",t.userId),e.isPresent()&&e.hasParticipant(t.userId)&&(t.firstName=i.firstName,t.lastName=i.lastName,h.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",t.userId),O.publish("/call/participant/updated",[e.callId,t])))}))),r}function rt(e,t,n){var i=e.updateParticipant(t,n);return i&&(et(e,i),tt(e,i),nt(e,i)),i}function ot(e,t,n){var i=s.ParticipantState.Terminated;switch(n){case a.RTCSessionParticipantLeftCause.CONNECTION_LOST:case a.RTCSessionParticipantLeftCause.STREAM_LOST:i=s.ParticipantState.ConnectionLost;break;case a.RTCSessionParticipantLeftCause.REMOVED:i=s.ParticipantState.Removed;break;case a.RTCSessionParticipantLeftCause.USER_LEFT_STAGE:i=s.ParticipantState.OffStage}e.setParticipantState(t,i);var r=e.removeParticipant(t);if(!e.hasOtherParticipants()){if(!e.conferenceCall)return h.debug("[CircuitCallControlSvc]: Publish /group/terminated event"),O.publish("/group/terminated",[e]),void ze(e,null,s.CallClientTerminatedReason.NO_USERS_LEFT,!0);e.setState(s.CallState.Waiting)}if(r){e.updateMediaType(),!e.isRemote&&r.isCMP&&r.isMeetingPointInvitee&&(e.setMeetingPointInviteState(!1),x.enableRemoteAudio(e.callId)),e.conferenceCall&&(h.debug("[CircuitCallControlSvc]: Publish /conference/participant/left event"),O.publish("/conference/participant/left",[e,n]));var o=n?{leftCause:n}:null;h.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),O.publish("/call/participant/removed",[e.callId,r,o])}ve(e)}function at(e,t){if(!e||!t||!t.state)return null;var n=e.recording;return n.state!==t.state?(n.notifyByCurtain=t.state===a.RecordingInfoState.START_PENDING||t.state===a.RecordingInfoState.STARTED&&n.state===a.RecordingInfoState.START_PENDING,n.notifyByUser=!n.notifyByCurtain||t.state===a.RecordingInfoState.START_PENDING&&n.state!==a.RecordingInfoState.STARTED):(n.notifyByCurtain=!1,n.notifyByUser=!1),n.state=t.state,n.duration=t.duration||n.duration,n.reason=t.reason,t.state===a.RecordingInfoState.STARTED&&(n.resumeTime=Date.now()),t.starter&&t.starter.userId&&t.starter.userId!==n.starter.userId&&(n.starter=t.starter,n.starter.userId===A.localUser.userId?n.starter.res="res_StartedRecording_You":(n.starter.name=n.starter.firstName||n.starter.displayName,n.starter.res=n.starter.name?"res_StartedRecording_Other":"res_StartedRecording")),n}function st(e){q&&void 0!==e&&q.attendeeCount!==e&&(q.attendeeCount=e,q.updateCallState(),h.debug("[CircuitCallControlSvc]: Publish /call/attendeeCountChanged"),O.publish("/call/attendeeCountChanged",[q.callId,q.attendeeCount]))}function ct(e,t){return new m(function(n,i){e&&!e.screenShareEventHandler?e.isVdi?n({}):(e.screenShareEventHandler=p.getScreen(function(t){g(function(){e.screenShareEventHandler=null,e.rejectGetScreenPromise=null,n(t||{})},0)},function(t){g(function(){e.screenShareEventHandler=null,e.rejectGetScreenPromise=null,t===a.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?i(t):i("res_AccessToDesktopFailed")},0)},t),e.rejectGetScreenPromise=function(t){h.warn("[CircuitCallControlSvc]: Cancelling getScreen promise for call ID: ",e.callId),i(t)}):i("res_ErrorMsgInternal")})}function lt(t){return new m(function(n,i){var r=new T({disableTrickleIce:!0,isDirectCall:!0,candidatesCollectionTest:!0}),o=function(){h.debug("[CircuitCallControlSvc]: Terminate ICE candidates collection test"),r.onSessionDescription=null,r.onRtcError=null,r.terminate()};t&&(r.setTurnUris(t.turnServer),r.setTurnCredentials(t)),r.disableRemoteVideo(),r.onSessionDescription=function(i){var r=e.sdpParser.getIceCandidates(i.sdp.sdp);h.debug("[CircuitCallControlSvc]: testIceCandidates - candidates: ",r),o(),n({turnServers:t&&t.turnServer||[],candidates:r})},r.onRtcError=function(e){h.error("[CircuitCallControlSvc]: Error collecting candidates. ",e.error),o(),i(e.error)},h.debug("[CircuitCallControlSvc]: testIceCandidates - Start collection"),r.start({audio:!1})})}function dt(e,t){if(e&&e.replaces){var n=Ne(e.replaces.callId);n&&(A.localUser.userId===n.screenOwnerId&&(e.restartScreenControlSession=!0,e.screenControllerId=n.screenControllerId),t&&ze(n,null,s.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV)),h.debug("[CircuitCallControlSvc]: Publish /call/moved event"),O.publish("/call/moved",[e.replaces.callId,e.callId]),e.replaces=null,ve(e)}}function ut(e){return!(!A.isCMR&&(e&&e.isDirect||R.isMobile()))}function Ct(){return t.WebRTCAdapter.unifiedPlanEnabled||"firefox"===t.WebRTCAdapter.browser}function Et(e){return!!v.includes(e)||(h.error("[CircuitCallControlSvc]: Invalid video resolution: ",e),!1)}function Tt(e){h.debug("[CircuitCallControlSvc]: Publish /call/showRatingDialog event"),O.publish("/call/showRatingDialog",[e])}function pt(e){var t=e&&e.sessionCtrl;t?(t.onIceCandidate=function(e,t){h.debug("[CircuitCallControlSvc]: RtcSessionController - onIceCandidate");var n={rtcSessionId:e.callId,userId:A.localUser.userId,origin:t.origin,candidates:t.candidates.map(JSON.stringify.bind(JSON))};t.isAudioVideo&&(e.sdpOrigin=t.origin);var i=U.createActionInfo(e,a.RtcDiagnosticsAction.ICE_CANDIDATES);i&&(i.data=n.candidates,i.isEndOfCandidates=t.endOfCandidates),W.sendIceCandidates(n,function(t){U.finishActionInfo(e,i),t&&h.warn("Failed to send ICE candidate: ",t)})}.bind(null,e),t.onSdpConnected=function(e){h.debug("[CircuitCallControlSvc]: RtcSessionController - onSdpConnected"),A.$apply(function(){h.debug("[CircuitCallControlSvc]: Publish /call/sdpConnected event"),O.publish("/call/sdpConnected",[e]);var t=U.createActionInfo(e,a.RtcDiagnosticsAction.SDP_CONNECTED);U.finishActionInfo(e,t),e.isTelephonyCall?(e.state.established||e.setState(s.CallState.Waiting),e.updateCallState()):e.setState(e.isDirect||e.hasOtherParticipants()?s.CallState.Active:s.CallState.Waiting),ve(e),U.finishDeviceDiagnostics(e),U.sendCallConnected(e)})}.bind(null,e),t.onIceConnected=function(e,t){if(h.debug("[CircuitCallControlSvc]: RtcSessionController - onIceConnected. pcType:",t.pcType),"audio/video"===t.pcType&&e.isEstablished()){var n=e.disconnectCause||{};n.cause===a.DisconnectCause.STREAM_LOST&&(e.disconnectCause=null),Ae(e,"connected")}else"screen control"===t.pcType&&Be(e,e.screenOwnerId,e.screenControllerId,!0)}.bind(null,e),t.onIceDisconnected=function(e,t){h.debug("[CircuitCallControlSvc]: RtcSessionController - onIceDisconnected. pcType:",t.pcType),"audio/video"===t.pcType&&e.isEstablished()&&!e.isHeld()?(e.setDisconnectCause(a.DisconnectCause.STREAM_LOST),Ae(e,"disconnected")):"screen control"===t.pcType&&(We(e.callId),Be(e,null,null,!0))}.bind(null,e),t.onRemoteVideoAdded=function(){h.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoAdded")}.bind(null,e),t.onRemoteVideoRemoved=function(){h.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoRemoved")}.bind(null,e),t.onRemoteStreamUpdated=function(e){h.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteStreamUpdated"),A.$apply(function(){h.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),O.publish("/call/remoteStreamUpdated",[e])})}.bind(null,e),t.onDTMFToneChange=function(e,t){h.debug("[CircuitCallControlSvc]: RtcSessionController - onDTMFToneChange"),t.tone?(h.debug("[CircuitCallControlSvc]: Sent DTMF Digit: "+t.tone),O.publish("/call/singleDigitSent",[e,t.tone])):""===t.tone&&(h.info("[CircuitCallControlSvc]: Digits played completely"),O.publish("/call/digitsSent",[e]))}.bind(null,e),t.onRtcError=St.bind(null,e),t.onRtcWarning=function(e,t){h.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcWarning"),O.publish("/call/rtcWarning",[e,t.warning])}.bind(null,e),t.onLocalStreamEnded=function(e,t){h.debug("[CircuitCallControlSvc]: RtcSessionController - onStreamEnded"),t.isDesktop&&q.hasLocalScreenShare()?(h.debug("[CircuitCallControlSvc]: Screenshare stream ended, remove screenshare or terminate the call"),q.isEstablished()?x.removeScreenShare(q.callId):x.endCall(q.callId)):x.renegotiateMedia(e.callId,function(t){t&&(h.debug("[CircuitCallControlSvc]: Publish /call/localStreamEnded event"),O.publish("/call/localStreamEnded",[e]))})}.bind(null,e),t.onQosAvailable=function(e,t){if(h.debug("[CircuitCallControlSvc]: RtcSessionController - onQosAvailable"),t.renegotiationInProgress&&(e.terminateReason=s.CallClientTerminatedReason.MEDIA_RENEGOTIATION),e.sessionCtrl){if(e.qosSubmitted)return void h.info("[CircuitCallControlSvc]: QoS already submitted for call Id:",e.callId);b.sendQOSData(e,e.lastMediaType,t.qos,t.lastSavedStats)}t.renegotiationInProgress&&(e.terminateReason=null,e.updateMediaDevices())}.bind(null,e),t.onStatsThresholdExceeded=function(e,t){te||(h.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsThresholdExceeded. Cleared: ",!(!t||!t.cleared)),t&&t.cleared?O.publish("/call/rtp/threshholdExceeded/cleared",[e.callId]):O.publish("/call/rtp/threshholdExceeded/detected",[e.callId]))}.bind(null,e),t.onStatsNoOutgoingPackets=function(e){h.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsNoOutgoingPackets. Publish /call/rtp/noOutgoingPackets event"),O.publish("/call/rtp/noOutgoingPackets",[e.callId])}.bind(null,e),t.onNetworkQuality=function(e,t){if(t&&t.quality){var n=t.quality,i={userId:A.localUser.userId,audio:{qualityLevel:n.qualityLevel.value,currentPlSend:n.currentPlSend,currentPlReceive:n.currentPlReceive,firstTimeLowQuality:n.firstTimeLowQuality}};h.debug("[CircuitCallControlSvc]: Publish /call/network/quality event for quality=",i.audio.qualityLevel),O.publish("/call/network/quality",[i])}}.bind(null,e),t.onGetUserMediaException=function(e,t){h.debug("[CircuitCallControlSvc]: RtcSessionController - onGetUserMediaException. Publish /call/getUserMediaException event"),O.publish("/call/getUserMediaException",[e,t.info])}.bind(null,e)):h.error("[CircuitCallControlSvc]: Failed to get RtcSessionController for given call. ",e)}function St(e,t){if(h.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcError: ",t.error),"res_RemoteControlSessionStopped"===t.error)return ke(e.callId),void O.publish("/screenControl/terminated",[e]);O.publish("/call/rtcError",[e,t.error]),e.checkState([s.CallState.Ringing,s.CallState.Answering])?Qe(e,{type:a.InviteRejectCause.BUSY}):e.sameAs(q)&&("res_CallMediaFailed"===t.error?(e.setDisconnectCause(a.DisconnectCause.NEGOTIATION_FAILED),x.endCallWithCauseCode(e.callId,s.CallClientTerminatedReason.ICE_TIMED_OUT)):"res_CallMediaDisconnected"===t.error?(e.setDisconnectCause(a.DisconnectCause.STREAM_LOST),x.endCallWithCauseCode(e.callId,s.CallClientTerminatedReason.LOST_MEDIA_STREAM),W.pingServer()):e.isEstablished()||x.endCall(e.callId))}function It(e){try{h.debug("[CircuitCallControlSvc]: Received RTCSession.ACTIVE_SPEAKER");var t=_e(e.sessionId);if(!t)return void h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(t.isDirect||t.participants.length<2)return void h.debug("[CircuitCallControlSvc]: Ignore RTC.ACTIVE_SPEAKER event for 1-2-1 calls");var n=[];if(e.first&&n.push(e.first),e.second&&n.push(e.second),e.third&&n.push(e.third),!t.setActiveSpeakers(n))return;h.debug("[CircuitCallControlSvc]: Publish /call/participant/activeSpeakers event"),O.publish("/call/participants/activeSpeakers",[t.callId,n])}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTC.ACTIVE_SPEAKER event. ",e)}}function ft(e){try{h.debug("[CircuitCallControlSvc]: Received RTCSession.VIDEO_ACTIVE_SPEAKER");var t=_e(e.sessionId);if(!t)return void h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");var n=t.getParticipant(e.userId);if(!n)return void h.debug("[CircuitCallControlSvc]: Participant info not available. Ignoring VIDEO_ACTIVE_SPEAKER. userId=",e.userId);if(n.streamId===e.videoStreamId)return void h.debug("[CircuitCallControlSvc]: Participant is already assigned to the received videoStreamId. Ignoring VIDEO_ACTIVE_SPEAKER");A.$apply(function(){n.streamId=e.videoStreamId,et(t,n),t.setParticipantRemoteVideoStream(n),t.checkForActiveRemoteVideo(),h.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",n.userId),O.publish("/call/participant/updated",[t.callId,n])})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.VIDEO_ACTIVE_SPEAKER event.",e)}}function Rt(e){if(h.debug("[CircuitCallControlSvc]: Processing active session for convId = ",e.convId),e.participants&&0!==e.participants.length){var t=y.getConversationByRtcSession(e.rtcSessionId);if(t&&(t.hasJoined||t.isTemporary)&&(e.turnServers&&Ue(e.rtcSessionId,e.turnServers),!$e(e.rtcSessionId))){var n,i=!1;if(e.participants.some(function(e){return e.userId===A.localUser.userId&&(n=e,e.clientId===W.clientId&&(i=!0),!0)}),t.call){var r=t.call;return r.isRemote&&t.isTemporary&&n?(t.call.setState(s.CallState.ActiveRemote),r.setActiveClient(n),Ze(r),void(r.mediaType=l.getMediaType(e.mediaTypes))):void h.debug("[CircuitCallControlSvc]: Conversation already has an associated call")}if(t.type!==a.ConversationType.DIRECT||n){if(i){var o=function(t){t&&h.warn("[CircuitCallControlSvc] Lost session could not be terminated. Session Id=",e.rtcSessionId)},c={disconnectCause:a.DisconnectCause.CONNECTION_LOST,disconnectReason:a.DisconnectReason.CALL_LOST};if(t.type===a.ConversationType.DIRECT)return void W.terminateRtcCall(e.rtcSessionId,c,o);W.leaveRtcCall(e.rtcSessionId,c,o)}Ye(t,n,e,e.rtcSessionId,function(t){n&&vt(t,e)})}}}else h.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",e.rtcSessionId)}function vt(e,t){e&&e.isTelephonyCall&&t&&t.participants&&t.participants.length<=2&&t.participants.some(function(t){return t.participantType===a.RTCParticipantType.TELEPHONY&&(ye(e,t.phoneNumber,null,t.userDisplayName),!0)})}function At(e){var t=!1;return _e(e.rtcSessionId)&&e.participants&&(t=e.participants.some(function(e){return e.userId===A.localUser.userId&&e.clientId===W.clientId})),t}function gt(){return new m(function(e,t){ne||A.isSessionGuest?(h.debug("[CircuitCallControlSvc]: Initialize active RTC sessions"),W.getActiveSessions(function(t,n){A.$apply(function(){t&&h.error("[CircuitCallControlSvc]: Error getting active sessions: ",t),n=n||[],Q.empty();for(var i=K.length-1;i>=0;i--)K[i].isRemote&&(K[i].guestToken?Q.push(K[i]):ge(K[i]));var r=null,o=!1,a=!1,c=[];n.forEach(function(e){var t=_e(e.rtcSessionId);if(t){if(At(e))return o=o||t===q,a=a||t===j,h.info("[CircuitCallControlSvc]: Found localCall in active sessions. Trigger media renegotiation."),void x.renegotiateMedia(t.callId,function(n){t.screenOwnerId===A.localUser.userId&&(n||e.screenOwnerId!==A.localUser.userId?(h.debug("[CircuitCallControlSvc]: There was a renegotiation error or remote control has been terminated on backend"),ke(t.callId)):(h.debug("[CircuitCallControlSvc]: Starting a screen control session."),Fe(t.callId,e.screenControllerId,function(e){e?h.error("[CircuitCallControlSvc]: Could not start the screen control session."):h.debug("[CircuitCallControlSvc]: Successfully started the screen control session.")}))),n?Be(t,null,null,!0):Be(t,e.screenOwnerId,e.screenControllerId,!0)});ge(t,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}(r=y.getConversationByRtcSession(e.rtcSessionId))&&r.hasJoined?Rt(e):e.invitedGuests&&e.invitedGuests.includes(A.localUser.userId)?(h.info("[CircuitCallControlSvc]: Local user is invited as guest to this session"),c.push(y.createConversationAsGuestFromSummary(e.convId))):r||(h.info("[CircuitCallControlSvc]: Conversation associated with session is not cached. Need to get it."),c.push(y.getConversationPromise(e.convId)))}),O.publish("/activeSessions/received"),j&&!a&&ge(j,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),q&&!o&&ge(q,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),c.length>0?(h.info("[CircuitCallControlSvc]: Wait for get conversation promises to be resolved."),m.all(c).then(function(t){var n=t.map(function(e){return e.convId});h.debug("[CircuitCallControlSvc]: Retrieved the missing conversation(s): ",n),h.debug("[CircuitCallControlSvc]: Now that we have all the conversations, check if they still have active RTC sessions."),W.getActiveSessions(function(t,i){A.$apply(function(){t&&(h.error("[CircuitCallControlSvc]: Error getting active sessions: ",t),i=[]),i.forEach(function(e){-1!==n.indexOf(e.convId)&&(At(e)||Rt(e))}),e()})})}).catch(function(e){h.error("[CircuitCallControlSvc]: Failed to retrieve the conversation(s). ",e)})):e()})})):t("Not ready to initialize active sessions")})}function _t(e,t){var n={rtcSessionId:e,transactionId:t};W.changeMediaReject(n,function(e){e?h.error("[CircuitCallControlSvc]: changeMediaReject sending error"):h.debug("[CircuitCallControlSvc]: changeMediaReject sent")})}function Nt(e,t,n){if(n||(h.debug("[CircuitCallControlSvc]: Publish /call/incoming event"),O.publish("/call/incoming",[e.call])),P){var i={type:e.call.isGuestInvite?s.NotificationType.INCOMING_INVITATION_AS_GUEST:e.call.mediaType.video?s.NotificationType.INCOMING_VIDEO_CALL:s.NotificationType.INCOMING_VOICE_CALL,userId:t,extras:{conversation:e,call:e.call}};e.isTelephonyConv&&e.call.peerUser&&(i.userId=e.call.peerUser.userId,i.userId||(i.user=e.call.peerUser),i.extras.phoneNumber=e.call.peerUser.phoneNumber,i.extras.displayName=e.call.peerUser.displayName),P.show(i)}e.call.startRingingTimer(function(){Qe(e.call,{type:a.InviteRejectCause.TIMEOUT},!1)})}function mt(e,i){if(e&&i){var o=null,a=!1,u=!1,E=!1,p=!1;if(e.replaces&&Je(e.replaces))a=!0;else if(q)if(q.callId===e.replaces)u=q.sessionCtrl&&q.sessionCtrl.isMuted(),o=q;else if(q.terminateTimer){if(q.callId===e.sessionId)return h.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not terminated"),void qe(e);ge(q)}else{if(q.callId===e.sessionId)return void(q.isDirect?(h.debug("[CircuitCallControlSvc]: INVITE for same local call. Reject it"),qe(e)):h.warn("[CircuitCallControlSvc]: INVITE for same conversation as local call. Ignore it."));if(!q.isEstablished()&&(!e.pickUpSession||e.pickUpSession!==q.callId)&&(!i.isTelephonyConv||De()))return h.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not established"),void qe(e)}if(i.isTelephonyConv?e.to&&e.to.displayName&&e.to.displayName.startsWith("handover-from")?(h.debug("[CircuitCallControlSvc]: Received handover call"),re?(E=!0,g.cancel(re),re=null):(h.warn("[CircuitCallControlSvc]: INVITE for handover call from another client. Ignore it."),a=!0)):ae&&(E=!0,g.cancel(ae),ae=null):z&&z.callId===e.replaces&&(u=X,o=z,z=null),$e(e.sessionId))h.warn("[CircuitCallControlSvc]: INVITE for existing ringing call. Ignore it.");else{if(!a&&!e.pickUpSession&&!o&&Z.length>=1&&!E&&(!i.isTelephonyConv||De()))return h.debug("[CircuitCallControlSvc]: Reject second incoming call."),void qe(e);if(i.isTelephonyConv&&!E&&!a){if(A.localUser.selectedRoutingOption===C.DeskPhone.name&&A.localUser.isATC)return void je(i,e,!0);if(!A.localUser.selectedBusyHandlingOption||A.localUser.selectedBusyHandlingOption===r.DefaultRouting.name||A.localUser.isSTC){if(q&&q.isPresent()&&j&&j.isPresent())return h.debug("[CircuitCallControlSvc]: Reject incoming call. We cannot handle more than 2 local phone calls"),void qe(e)}else if(q||Z.length>=1||!Q.isEmpty()||i.call&&i.call.isAtcRemote&&!i.call.isPickupNotification())return void je(i,e)}var S={isAtcPullCall:i.isTelephonyConv&&E&&"offer"===e.sdp.type&&!se&&!A.localUser.isOsBizCTIEnabled,clientId:W.clientId,midMappingEnabled:Ct(),isSTC:A.localUser.isSTC&&i.isTelephonyConv,stcTransferAllowed:A.localUser.stcTransferAllowed&&i.isTelephonyConv};o&&o.localMediaType.desktop&&(S.reuseDesktopStreamFrom=o.sessionCtrl);var I=new c(i,S);if(I.setCallIdForTelephony(e.sessionId),I.setInstanceId(e.instanceId),I.setTransactionId(e.transactionId),q&&e.pickUpSession===q.callId&&((o=q).pickUpUserId=e.userId),o){I.replaces=o;var f=o.sessionCtrl.getLocalStream(T.LOCAL_STREAMS.DESKTOP);f&&(h.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",o.callId),I.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.DESKTOP,f),o.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.DESKTOP,null),A.localUser.userId===o.screenOwnerId&&(I.restartScreenControlSession=!0,I.screenControllerId=o.screenControllerId)),(f=o.sessionCtrl.getLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO))&&(h.debug("[CircuitCallControlSvc] Reusing audio/video stream from call ID=",o.callId),I.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO,f),o.sessionCtrl.setLocalStream(T.LOCAL_STREAMS.AUDIO_VIDEO,null))}if(J&&(h.info("[CircuitCallControlSvc] Disabling remote video for incoming call"),I.disableRemoteVideo()),I.setState(s.CallState.Ringing),I.direction=s.CallDirection.INCOMING,A.localUser.isATC&&I.isTelephonyCall&&(I.atcCallInfo=new n,e.atcAdvancing&&(h.debug("[CircuitCallControlSvc] This ATC call has already advanced to the desk phone"),I.atcAdvancing=!0,I.sessionCtrl.setIgnoreNextConnection(!0)),se)){I.atcCallInfo.setCstaConnection(se.atcCallInfo.getCstaConnection());var R=se.peerUser;I.setPeerUser(R.phoneNumber,R.displayName,R.userId);var v=se.getRedirectingUser();I.setRedirectingUser(v.phoneNumber,v.fullyQualifiedNumber,v.displayName,v.userId,d.CallPickedUp),se=null,p=!0}var _=e.mediaType||["AUDIO"];it(I,be({userId:e.userId},_),s.ParticipantState.Calling),I.ringingTimeout=e.ringingTimeout||I.ringingTimeout;var N=l.getMediaType(_);if(I.mediaType=N,N.desktop&&h.debug("[CircuitCallControlSvc]: INVITE for a Screen Share"),a)Se(I,!0);else{Se(I);var m,D,y=function(){A.$apply(function(){if(I.state!==s.CallState.Terminated){pt(I),h.debug("[CircuitCallControlSvc]: New alerting call: ",I.callId),i.call&&!i.isTelephonyConv&&(h.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),ge(i.call));var t=null;if(i.call&&i.call.isAtcRemote&&(t=i.call.callId),i.call=I,i.isTelephonyConv&&E?(h.debug("[CircuitCallControlSvc]: Publish /atccall/replace event"),O.publish("/atccall/replace",[I,t])):Re(i),o)x.answerCall(I.callId,o.localMediaType,function(e){e||u&&q.sessionCtrl&&q.sessionCtrl.mute()});else{if(A.isCMR&&(N.video=!0,N.videoResolution=A.videoResolution,E=!0),E)return I.isTelephonyCall&&e.from&&!p&&ye(I,e.from.phoneNumber,e.from.fullyQualifiedNumber,e.from.displayName,null,function(){if(e.telephonyInfo&&e.telephonyInfo.redirectingUser){var t=e.telephonyInfo.redirectingUser;Pe(I,t.phoneNumber,t.fullyQualifiedNumber,t.displayName,d.CallForward)}}),void x.answerCall(I.callId,N);W.sendProgress(I.callId,e.userId,A.localUser.userId,function(e){e&&h.error("[CircuitCallControlSvc]: sendProgress error",e)}),I.isTelephonyCall&&e.from?ye(I,e.from.phoneNumber,e.from.fullyQualifiedNumber,e.from.displayName,null,function(){if(i.call===I&&Nt(i,e.userId),e.telephonyInfo&&e.telephonyInfo.redirectingUser){var t=e.telephonyInfo.redirectingUser;Pe(I,t.phoneNumber,t.fullyQualifiedNumber,t.displayName,d.CallForward)}}):Nt(i,e.userId)}}else h.debug("[CircuitCallControlSvc]: New alerting call has been terminated already")})},P=function(e){h.warn("[CircuitCallControlSvc]: Warmup failed. Ignore the incoming call: ",e),O.publish("/call/warmupFailed",[e,I]),ge(I,null,!0),i.isTemporary&&(h.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),O.publish("/conversation/temporary/ended",[i]))},b=I.sessionCtrl,U=(m=i.rtcSessionId,(D=$[m])&&D.turnServers&&D.turnServers.length?D.turnServers:null);if(A.isCMR&&b.useMaxNumberOfExtraVideoChannels(),!t.WebRTCAdapter.enabled)return h.warn("[CircuitCallControlSvc]: Client does not support WebRTC."),void P("res_NoWebRTC");Ce(I).then(function(n){if(I.isPresent()){var i;if(U?(h.debug("[CircuitCallControlSvc]: Using TURN servers associated with session: ",U),b.setTurnUris(U)):(h.debug("[CircuitCallControlSvc]: Using retrieved TURN servers"),b.setTurnUris(n.turnServer)),b.setTurnCredentials(n),h.debug("[CircuitCallControlSvc]: Set TURN credentials"),I.replaces)i=I.replaces.localMediaType;else{var r="firefox"===t.WebRTCAdapter.browser,o="android"===t.WebRTCAdapter.browser;i={audio:!(r||o||G||H),video:!1}}Dt(i,function(t){b.warmup(t,e.sdp,y,P)})}else h.debug("[CircuitCallControlSvc]: There is no incoming call anymore")}).catch(P)}}}else h.error("[CircuitCallControlSvc]: processInvite called without evt or conversation")}function ht(e,t){e&&t&&(e.hasJoined||e.isTemporary?t.some(function(t){var n;return e.rtcSessionId===t.rtcSessionId&&(h.debug("[CircuitCallControlSvc]: Processing active session for convId = ",e.convId),t.participants&&0!==t.participants.length?(t.participants.some(function(e){return e.userId===A.localUser.userId&&(n=e,!0)}),e.type===a.ConversationType.DIRECT&&!n||(e.call?(h.debug("[CircuitCallControlSvc]: Conversation already has an associated call"),!0):(Ye(e,n,t,null,function(e){n?vt(e,t):e.conferenceCall&&(h.debug("[CircuitCallControlSvc]: Publish /conference/started event"),O.publish("/conference/started",[e]))}),!0))):(h.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",t.rtcSessionId),!0))}):h.debug("[CircuitCallControlSvc]: User is not a conversation participant. Ignore active session."))}function Ot(e,t,n,i){e.type===a.ConversationType.LARGE&&A.isSessionGuest&&(t.audio=!1,h.debug("[CircuitCallControlSvc]: Set media type for large conference participant to ",t)),Dt(t,function(t,r){if(r){if(e.isTelephonyConv)return h.warn("[CircuitCallControlSvc]: Phone calls are not possible without a microphone. Terminate local call."),ge(q),void i("res_MakeCallFailedNoMic");n.warning=r}He(e,t,n,i)})}function Dt(e,n){return e=ue(e),h.debug("[CircuitCallControlSvc]: Check media sources for mediaType = ",e),!A.browser.msie||A.isSessionGuest||A.localUser.hasPermission(a.SystemPermission.IE_PLUGIN_SUPPORT)?(e=e?R.shallowCopy(e):{audio:!0,video:!1},w||G||H||!e.audio&&!e.video?(h.debug("[CircuitCallControlSvc]: Normalized mediaType = ",e),void n(e)):(h.debug("[CircuitCallControlSvc]: Get audio and video media sources"),void t.WebRTCAdapter.getMediaSources(function(t,r){e.video&&(!r||r.length<1)&&(h.warn("[CircuitCallControlSvc]: No camera detected"),e.video=!1,i="res_AnswerWarnNoCamera"),e.audio&&(!t||t.length<1)&&(e.audio=!1,h.warn("[CircuitCallControlSvc]: No microphone detected"),i="res_AnswerWarnNoCamera"===i?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailedWarning"),h.debug("[CircuitCallControlSvc]: Normalized mediaType = ",e),n(e,i)}))):(h.debug("[CircuitCallControlSvc]: User does not have permission to use IE plugin. Publish /ieplugin/permissionDenied event."),void O.publish("/iePlugin/permissionDenied"));var i}function yt(e){e&&e.activeNotification&&!e.isHandoverInProgress&&(P&&P.dismiss(e.activeNotification),e.activeNotification=null)}function Pt(e){x.mute(e),x.disableRemoteAudio(e)}function bt(e,t,n){if(n=n||function(){},!e||!t)return h.error("[CircuitCallControlSvc]: addParticipant - Invalid arguments"),void n("Invalid arguments");if(e.isDirect&&(!e.upgradeToConfSupported||!A.circuitLabs.DIRECT_TO_CONF_UPGRADE))return h.error("[CircuitCallControlSvc]: addParticipant - Cannot upgrade call to conference"),void n("Cannot upgrade to conference");var i=t.cmrData;delete t.cmrData;var r=t.dialOutPhoneNumber,o=r?{userId:"gtc-callout-"+r.replace(/[+ ]+/g,""),phoneNumber:R.cleanPhoneNumber(r),displayName:t.displayName,resolvedUserId:t.userId,participantType:a.RTCParticipantType.TELEPHONY,pstnDialIn:!1}:t;if(!o.userId)return h.warn("[CircuitCallControlSvc]: addParticipant - Participant missing userId"),void n("Missing userId");if(e.hasParticipant(o.userId)||o.resolvedUserId&&e.hasParticipant(o.resolvedUserId))return h.info("[CircuitCallControlSvc]: addParticipantTo - Participant is already in the call"),void n("Participant exists");h.debug("[CircuitCallControlSvc]: Adding participant to existing RTC session. userId =",o.userId);var c=R.shallowCopy(e.mediaType);c.audio=!0;var l={rtcSessionId:e.callId,userId:o.userId,mediaType:c};r&&(l.from={phoneNumber:R.cleanPhoneNumber(A.localUser.callerId),displayName:A.localUser.displayName},l.to={phoneNumber:o.phoneNumber,displayName:o.displayName,resolvedUserId:o.resolvedUserId}),W.addParticipantToRtcSession(l,function(t){A.$apply(function(){if(t){if(t===a.ErrorCode.PERMISSION_DENIED)return h.info("[CircuitCallControlSvc]: Failed to add participant. Reached conference participants limit"),void n("res_MaxConversationParticipantsLimit");h.warn("[CircuitCallControlSvc]: Failed to add participant"),n("res_AddParticipantToRtcSessionFailed")}else{if(h.debug("[CircuitCallControlSvc]: Add participant request was successful"),e.direction=s.CallDirection.OUTGOING,!e.isRemote){var r=be(o,["AUDIO"]),c=s.ParticipantState.Initiated,l=it(e,r,c);l&&(l.isCMP&&(l.isMeetingPointInvitee=!0,l.cmrData=i||{},e.setMeetingPointInviteState(!0),Pt(e.callId)),h.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),O.publish("/call/participant/added",[e.callId,l]))}n()}})})}function Ut(e,t){var n=t?e.getParticipant(t):null;h.debug("[CircuitCallControlSvc]: Publish /call/localUser/muted event"),O.publish("/call/localUser/muted",[e.callId,e.remotelyMuted,e.locallyMuted,n]),n&&e.remotelyMuted&&P&&P.show({type:s.NotificationType.HIGH_PRIORITY,user:A.localUser,extras:{title:A.i18n.map.res_Muted,text:A.i18n.localize("res_MutedByNotification",[n.displayName])}})}function Lt(e,t,n){if(n=n||function(){},Z.length>=1)return n("res_CannotJoinMultipleSessions"),!1;if(q&&q.isPresent())if(q.isTelephonyCall){if(!e.isTelephonyConv||!A.localUser.isRegisterTC)return n("res_CannotJoinMultipleSessions"),!1;if(j)return n("res_CannotInitiateThirdPhoneCall"),!1}else if(!t.replaces)return n("res_CannotJoinMultipleSessions"),!1;for(var i=0;i<K.length;i++)if(!K[i].state.established&&K[i].isTelephonyCall)return h.error("[CircuitCallControlSvc]: Cannot initiate second phone call if existing call is not established"),n("res_JoinRTCSessionFailed"),!1;if(e.isTelephonyConv){if(!t.handover&&(t.dialedDn=t.dialedDn?t.dialedDn.trim():null,!t.dialedDn))return n("Missing Dialed DN"),!1;if(!A.localUser.callerId)return n("Missing Caller ID"),!1;if(A.localUser.isOsBizCTIEnabled&&!t.handover&&e.call)return n("res_CannotJoinMultipleSessions"),!1}return!0}function Mt(e,t){return e=e||{},t&&Object.assign(e,t),e.callOut=!!e.callOut,e.handover=!!e.handover,e}function wt(e,t,n,i){var r="[CircuitCallControlSvc]: "+(n=n||"addRemoveMedia")+": ",o=_e(e);if(!o)return h.warn(r+"There is no local call"),m.reject("No active call");h.debug(r,t);var a={callId:e,dontReuseAudioStream:!(!i||!i.dontReuseAudioStream),mediaType:Object.assign({},o.localMediaType,t)};return ut(o)||(t.video?a.mediaType.desktop=!1:t.desktop&&(a.mediaType.video=!1)),new m(function(e,t){Ve(a,function(n){n?(h.warn(r+"failed - ",n),t(n)):e()})})}function Gt(e){if(e){var t=e.hasRemoteScreenShare()||e.hasLocalScreenShare();if(t){if(e.screenEnabledFeature)return;e.whiteboardEnabled&&(e.screenEnabledFeature=S.ToggleScreenShare.name,h.debug("[CircuitCallControlSvc]: ScreenShare is selected to show on invited CMR"))}else e.screenEnabledFeature=null,h.debug("[CircuitCallControlSvc]: There is nothing selected to show on invited CMR");e.participants.some(function(n){if(n.isMeetingPointInvitee){if(n.cmrData=n.cmrData||{},t||(n.cmrData.pendingMediaFeatures=null),t){if(n.cmrData.pendingMediaFeatures&&n.cmrData.pendingMediaFeatures.screenShare)return n.cmrData.selectedFeature===S.ToggleScreenShare.name&&(n.cmrData.pendingMediaFeatures.screenShare=!1),!0;n.cmrData.selectedFeature=S.ToggleScreenShare.name}else e.whiteboardEnabled?n.cmrData.selectedFeature===S.ToggleScreenShare.name&&(n.cmrData.selectedFeature=S.ToggleWhiteboard.name):n.cmrData.selectedFeature=null;return!0}return!1})}}if(O.subscribe("/conversation/update",function(e,t){if(t){var n=_e(e.rtcSessionId);n&&!n.isDirect&&(h.debug("[CircuitCallControlSvc]: Received /conversation/update event"),t.addedParticipants&&Xe(e),void 0!==t.isModerated&&n.participants.forEach(function(t){t.setActions(e,A.localUser)}))}}),O.subscribe("/conversation/upgrade",function(e,t){if(h.debug("[CircuitCallControlSvc]: Received /conversation/upgrade event. Old convId = "+e.convId+". New convId = ",t.convId),e.call&&t.convId!==e.convId&&(e.call.checkState(s.CallState.Active)||e.type!==a.ConversationType.DIRECT&&e.call.checkState(s.CallState.Waiting)))if(h.debug("[CircuitCallControlSvc]: Move Session"),e.type===a.ConversationType.DIRECT&&t.type===a.ConversationType.GROUP){var n=Mt({callOut:!0,handover:!1,replaces:e.call});we(t,e.call.localMediaType,n)&&He(t,e.call.localMediaType,n,function(n){n||e.call.sessionCtrl&&e.call.sessionCtrl.isMuted()&&t.call.sessionCtrl&&t.call.sessionCtrl.mute()})}else{var i={sessionId:e.rtcSessionId,conversationId:e.convId,newSessionId:t.rtcSessionId,newConversationId:t.convId};W.moveRtcSession(i,function(e){e&&h.warn("[CircuitCallControlSvc]: Error moving RTC Session. ",e)})}}),O.subscribe("/conversation/left",function(e){h.debug("[CircuitCallControlSvc]: Received /conversation/left event. convId = ",e.convId),e&&e.call&&x.hideRemoteCall(e.call.callId)}),O.subscribe("/conversation/participants/add",function(e,t){h.debug("[CircuitCallControlSvc]: Received /conversation/participants/add event."),e&&t&&t.forEach(function(t){bt(e,t)})}),O.subscribe("/csta/handover",function(){h.debug("[CircuitCallControlSvc]: Received /csta/handover event."),re=g(function(){re=null},6e3)}),O.subscribe("/atccall/moveFailed",function(){h.debug("[CircuitCallControlSvc]: Received /atccall/moveFailed event."),re&&(g.cancel(re),re=null)}),O.subscribe("/atccall/pickUpInProgress",function(e){h.debug("[CircuitCallControlSvc]: Received /atccall/pickUpInProgress event."),se=e,ae=g(function(){ae=null,se=null},4e3)}),O.subscribe("/conversations/loadComplete",function(){h.debug("[CircuitCallControlSvc]: Received /conversations/loadComplete event"),ne=!0,gt()}),O.subscribe("/registration/state",function(e){h.debug("[CircuitCallControlSvc]: Received /registration/state event"),e!==RegistrationState.Registered?(q&&q.isTestCall&&ge(q,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),Z.forEach(function(e){h.debug("[CircuitCallControlSvc]: Lost websocket connection, terminate local incoming call"),ge(e,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}),e!==RegistrationState.Disconnected&&e!==RegistrationState.Waiting||K.forEach(function(e){ge(e,s.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)})):A.isSessionGuest&&q&&gt()}),O.subscribe("/conversation/re-added",function(e){h.debug("[CircuitCallControlSvc]: Received /conversation/re-added event. convId = ",e.convId),W.getSession(e.rtcSessionId,function(t,n){t?h.warn("[CircuitCallControlSvc] Error retrieving session. Err: ",t):n.participants&&n.participants.length>0&&A.$apply(function(){ht(e,[n])})})}),O.subscribe("/call/meetingPointInvitee",function(e){if(h.debug("[CircuitCallControlSvc]: Received /call/meetingPointInvitee event"),e){var t=_e(e);t&&(t.setMeetingPointInviteState(!0),Pt(e))}}),O.subscribe("/call/removeConferenceAsGuest",function(e){h.debug("CircuitCallControlSvc]: /call/removeConferenceAsGuest"),x.removeConferenceAsGuest(e)}),t.isElectron){var Ht=function(e,t,n){try{if(!q||!q.hasLocalScreenShare())return void h.debug("[CircuitCallControlSvc]: No local screen share. Ignore DESKTOP_APP event.");if(t.userId=n.srcUserId,i=t.userId,!q||!q.participants.some(function(e){return e.userId===i}))return void h.debug("[CircuitCallControlSvc]: Event sender is not a participant. Ignore DESKTOP_APP event.");D.getUserById(t.userId,function(n,i){!n&&q&&q.hasLocalScreenShare()&&(t.name=i.displayName,require("electron").ipcRenderer.send(e,t))})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP event.",e)}var i};Y.on("DESKTOP_APP.PARTICIPANT_POINTER",function(e,t){h.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_POINTER"),Ht("participant-pointer",e,t)}),Y.on("DESKTOP_APP.PARTICIPANT_DRAWING",function(e,t){A.circuitLabs.PARTICIPANT_DRAWING&&(h.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_DRAWING"),Ht("participant-drawing",e,t))})}return Y.on("ATC.ADVANCING",function(e){try{if(e.type===i.ADVANCING){h.debug("[CircuitCallControlSvc]: Received UserToUser ATC.ADVANCING");var t=$e(e.rtcSessionId);t&&(t.atcAdvancing=!0,t.sessionCtrl.setIgnoreNextConnection(!0))}}catch(e){h.error("[CircuitCallControlSvc]: Exception handling UserToUser ATC.ADVANCING event. ",e)}}),W.on("RTCCall.SDP_ANSWER",function(e){try{h.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_ANSWER");var t=_e(e.sessionId);if(!t)return void h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(W.clientId!==e.clientID)return void h.debug("[CircuitCallControlSvc]: Event is not for this client: ",W.clientId);t.isDirect&&U.startJoinDelayTimer(t),A.$apply(function(){var n=e.sdp;if(n){var i=U.createActionInfo(t,a.RtcDiagnosticsAction.SDP_ANSWER);n.sdp&&"sdp"!==n.sdp&&"data"!==n.sdp||(n.sdp="sdp",h.debug("[CircuitCallControlSvc]: This is a mocked call"),t.setMockedCall()),t.setInstanceId(e.instanceId),t.sessionCtrl.setRemoteDescription(n,function(e){t.clearTransactionId(),e&&(t.setDisconnectCause(a.DisconnectCause.REMOTE_SDP_FAILED,"type="+n.type+" origin="+I.getOrigin(n.sdp)),ze(t,null,s.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED),i&&(i.data=e)),U.finishActionInfo(t,i)})}})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_ANSWER event. ",e)}}),W.on("RTCCall.ICE_CANDIDATES",function(e){try{h.debug("[CircuitCallControlSvc]: Received RTCCall.ICE_CANDIDATES",e);var t=_e(e.sessionId);if(!t)return void h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(W.clientId!==e.clientId)return void h.debug("[CircuitCallControlSvc]: Event is not for this client: ",W.clientId);t.sessionCtrl.addIceCandidates(e.origin,e.candidates);var n=U.createActionInfo(t,a.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES);n&&(n.data=e.candidates,U.finishActionInfo(t,n))}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCCall.ICE_CANDIDATES event. ",e)}}),W.on("RTCSession.SESSION_UPDATED",function(e){A.$apply(function(){try{var t,n;h.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_UPDATED");var i=e.session.participants.find(function(e){return e.userId===A.localUser.userId}),r=_e(e.sessionId);if(i){var o=Je(e.sessionId);if(o)return h.debug("[CircuitCallControlSvc]: Event is for an existing active remote call"),o.mediaType=l.getMediaType(e.session.mediaTypes),o.setActiveClient(i),void ve(o);if($e(e.sessionId))return void h.debug("[CircuitCallControlSvc]: Event is for an existing active remote call");if(!r||r.callId!==e.sessionId&&!he(!0)){if(t=y.getConversationByRtcSession(e.sessionId))n=m.resolve(t);else{if(!i.isMeetingGuest)return void h.warn("[CircuitCallControlSvc]: Could not find corresponding conversation");h.debug("[CircuitCallControlSvc]: Local user is guest of this session"),n=y.createConversationAsGuestFromSummary(e.session.convId)}return i.clientId===W.clientId?void h.warn("[CircuitCallControlSvc]: Event is for a local call that has been terminated. Ignore event."):void n.then(function(t){Ye(t,i,e.session,e.sessionId,function(t){t.voicemailConnected=e.session.participants.some(function(e){return e.participantType===a.RTCParticipantType.VOICE_MAIL}),vt(t,e.session)})}).catch(function(e){h.warn("[CircuitCallControlSvc]: Could not retrieve guest conversation. Remote call will not be displayed.",e)})}if(i.clientId!==W.clientId){n=!(t=le(r.convId))&&i.isMeetingGuest?y.createConversationAsGuestFromSummary(e.session.convId):m.resolve(t);var c=null,d=null,u=null;r.isTelephonyCall&&(c=r.peerUser.phoneNumber,d=r.peerUser.displayName,u=r.participants),e.session.screenControllerId&&A.localUser.userId===e.session.screenOwnerId&&ke(e.sessionId);var C=r.atcCallInfo;return ge(r,s.CallClientTerminatedReason.ANOTHER_CLIENT_PULLED_CALL),void n.then(function(t){Ye(t,i,e.session,e.sessionId,function(e){e.atcCallInfo=C,e.isTelephonyCall&&(ye(e,c,null,d),e.participants=u)})}).catch(function(e){h.warn("[CircuitCallControlSvc]: Could not retrieve guest conversation. Remote call will not be displayed.",e)})}r.remotelyMuted!==i.muted&&(r.remotelyMuted=i.muted,Ut(r))}else if(!r||!r.isLarge)return void h.info("[CircuitCallControlSvc]: Not a large conference and local user is not in the participants list. Ignore event. ");r.instanceId||r.setInstanceId(e.session.instanceId),e.session.muted!==r.sessionMuted&&(r.sessionMuted=e.session.muted,h.debug("[CircuitCallControlSvc]: Publish /call/muted event"),O.publish("/call/muted",[r])),e.session.locked!==r.sessionLocked&&(r.sessionLocked=e.session.locked,h.debug("[CircuitCallControlSvc]: Publish /call/locked event"),O.publish("/call/locked",[r])),e.stageAction&&(e.stageAction===a.StageAction.USER_ENTERED_STAGE?r.raiseHandState.onStage=!0:e.stageAction===a.StageAction.USER_LEFT_STAGE&&(r.raiseHandState.onStage=!1),h.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/stageAction event"),O.publish("/call/raiseHand/stageAction",[e.stageAction])),e.session.curtain&&(r.curtain=e.session.curtain,h.debug("[CircuitCallControlSvc]: Publish /call/curtain event (session updated)"),O.publish("/call/curtain",[r.curtain])),e.session.testMode&&!A.isSessionGuest&&(r.testMode=e.session.testMode,h.debug("[CircuitCallControlSvc]: Publish /call/testMode event (session updated)"),O.publish("/call/testMode",[r])),e.session.hosted&&r.isDirect?r.setDirectUpgradedToConf():r.isDirectUpgradedToConf&&!e.session.hosted&&r.clearDirectUpgradedToConf(),r.whiteboardEnabled!==!!e.session.whiteboardEnabled&&(r.whiteboardEnabled=!!e.session.whiteboardEnabled,O.publish("/call/whiteboard/update",[r])),r.pollEnabled!==!!e.session.pollEnabled&&(r.pollEnabled=!!e.session.pollEnabled,O.publish("/call/poll/update",[r])),r.screenControllerId=e.session.screenControllerId||null,r.screenOwnerId=e.session.screenOwnerId||null,r.preventScreenControlRequestInConf=r.screenControllerId&&r.screenControllerId!==A.localUser.userId&&r.screenOwnerId&&r.screenOwnerId!==A.localUser.userId,r.hadRemoteCall=!1;var E,T=[],p=[],S=e.session.participants||[];if(A.isCMR||S.some(function(e,t){return e.userId===A.localUser.userId&&(S.splice(t,1),!0)}),r.isDirect||r.isAtcConferenceCall()||(E=r.participants.filter(function(e){return e.pcState!==s.ParticipantState.Initiated}).map(function(e){return e.userId})),S.length>0||r.conferenceCall){var I=l.getMediaType(e.session.mediaTypes);I.audio=I.audio||r.localMediaType.audio,I.video=I.video||r.localMediaType.video,I.desktop=I.desktop||r.localMediaType.desktop,r.mediaType=I,r.activeClient=null,I.desktop!==r.lastMediaType.desktop&&Gt(r),dt(r,S.length>0),r.isAtcConferenceCall()||S.forEach(function(e){var t=!1,n=be(e),i=n.muted?s.ParticipantState.Muted:s.ParticipantState.Active,o=r.getParticipant(e.userId);if(me(n,r),o){R.removeArrayElement(E,e.userId);var a=o.pcState,c=o.videoStream;o.streamId===n.streamId&&o.hasSameMediaType(n)||(t=!0);var l=rt(r,n,i);l&&(t||l.pcState!==a||l.videoStream!==c)&&p.push(l)}else{var d=it(r,n,i);d&&T.push(d)}})}var f=r.state;st(e.session.attendeeCount),(r.conferenceCall||r.checkState(s.CallState.Answering))&&(r.isEstablished()||r.setState(s.CallState.Waiting),r.updateCallState()),r.checkState(f)||ve(r),Xe(t=A.isSessionGuest?null:le(r.convId)),r.conferenceCall&&!r.hasOtherParticipants()&&(h.debug("[CircuitCallControlSvc]: Publish /conference/starting event"),O.publish("/conference/starting",[r])),E&&E.length>0&&E.forEach(function(e){var t=r.removeParticipant(e);t&&(h.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event. userId = ",e),O.publish("/call/participant/removed",[r.callId,t]))}),p.length>0&&(h.debug("[CircuitCallControlSvc]: Publish /call/participants/updated event"),O.publish("/call/participants/updated",[r.callId,p])),T.length>0&&(h.debug("[CircuitCallControlSvc]: Publish /call/participants/added event"),O.publish("/call/participants/added",[r.callId,T])),r.isTestCall||e.session.recordingInfo&&e.session.recordingInfo.state!==a.RecordingInfoState.INITIAL&&at(r,e.session.recordingInfo)&&(h.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),O.publish("/call/recording/info",[r])),r.isJoiningGroupCall=!1,pe(),Be(r,r.screenOwnerId,r.screenControllerId,!0)}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_UPDATED event. ",e)}})}),W.on("RTCSession.SESSION_STARTED",function(e){if(ne)try{h.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_STARTED");var t=_e(e.sessionId);if(t&&t.isTestCall)return void h.debug("[CircuitCallControlSvc]: Received SESSION_STARTED event for echo test call. Just ignore it.");e.session.turnServers&&Ue(e.sessionId,e.session.turnServers);var n=le(e.convId);if(!n){h.info("[CircuitCallControlSvc]: Could not find corresponding conversation");var i=1===e.session.participants.length&&e.session.participants[0].userId;if(e.callOut&&i!==A.localUser.userId)return;return h.info("[CircuitCallControlSvc]: Get the conversation from the server"),void y.getConversationById(e.convId,{randomLoaded:!0},function(e,t){e?h.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):(h.info("[CircuitCallControlSvc]: Successfully retrieved the conversation. Check if there are any active sessions."),W.getActiveSessions(function(e,n){A.$apply(function(){e&&(h.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),n=[]),ht(t,n)})}))})}if(!n.hasJoined)return void h.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");A.$apply(function(){if(t)h.debug("[CircuitCallControlSvc]: Found local call for SESSION_STARTED event"),h.info("[CircuitCallControlSvc]: Ignore SESSION_STARTED. State =",t.state.name);else if(e.callOut)e.session.participants.some(function(t){return t.userId===A.localUser.userId&&t.clientId!==W.clientId&&(Ye(n,t,e.rtcSession,e.sessionId,function(e){e.pullNotAllowed=!0}),!0)});else if(n.type===a.ConversationType.GROUP||n.type===a.ConversationType.LARGE){var i=e.session.participants.find(function(e){return e.userId===A.localUser.userId&&e.clientId!==W.clientId});Ye(n,i,e.rtcSession,e.sessionId,function(e){i||(h.debug("[CircuitCallControlSvc]: Publish /conference/started event"),O.publish("/conference/started",[e]))})}st(e.session.attendeeCount)})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_STARTED event: ",e)}else h.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the SESSION_STARTED event.")}),W.on("RTCSession.PARTICIPANT_JOINED",function(e){try{h.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_JOINED");var t=e.participant.userId;if(A.localUser.userId===t)return void h.debug("[CircuitCallControlSvc]: Ignore JOINED event for own user");var n=Je(e.sessionId);if(n)return void A.$apply(function(){n.pullNotAllowed&&(n.pullNotAllowed=!1),n.isTelephonyCall&&!n.atcCallInfo&&ye(n,e.participant.phoneNumber,null,e.participant.userDisplayName)});var i=_e(e.sessionId);if(!i)return void h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!i.isEstablished()&&i.direction===s.CallDirection.INCOMING)return void h.info("[CircuitCallControlSvc]: Ignore JOINED event for incoming alerting calls");A.$apply(function(){(e.participant.participantType===a.RTCParticipantType.VOICE_MAIL||e.participant.userDisplayName&&e.participant.userDisplayName.startsWith("VoiceMail of"))&&i.sessionCtrl.setCallStatsOptions({sendOnlyStream:!0}),i.isTelephonyCall&&!i.atcCallInfo&&ye(i,e.participant.phoneNumber,null,e.participant.userDisplayName),i.checkState([s.CallState.Delivered,s.CallState.Waiting])&&(i.checkState(s.CallState.Delivered)?i.setState(s.CallState.Waiting):i.conferenceCall&&i.sessionCtrl.isConnected()&&i.setState(s.CallState.Active),i.activeClient=null,dt(i,!0));var n=be(e.participant),r=n.muted?s.ParticipantState.Muted:s.ParticipantState.Active;if(me(n,i),i.hasParticipant(t)){var o=rt(i,n,r);o&&(h.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),O.publish("/call/participant/updated",[i.callId,o]))}else{var c=it(i,n,r);c&&(h.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),O.publish("/call/participant/added",[i.callId,c]))}var l=e.userEnteredStage?{userEnteredStage:e.userEnteredStage}:null;h.debug("[CircuitCallControlSvc]: Publish /call/participant/joined event"),O.publish("/call/participant/joined",[i,i.getParticipant(n.userId),l]),pe(),i.updateMediaType(),ve(i),Xe()})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTC.PARTICIPANT_JOINED event. ",e)}}),W.on("RTCSession.SESSION_MOVED",function(e){try{if(h.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_MOVED"),ie[e.oldRtcSessionId])return h.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete ie[e.oldRtcSessionId];var t=Ne(e.oldRtcSessionId);if(!t)return void h.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");var n=le(e.oldConversationId),i=le(e.newConversationId);if(!n||!i)return void h.warn("[CircuitCallControlSvc]: Could not find corresponding conversations");A.$apply(function(){if(function(e,t,n){var i;i=n.isRemote?new u(t):new c(t,{clientId:n.clientId}),t.call=i,i.terminate(),h.debug("[CircuitCallControlSvc]: Publish /call/ended event"),O.publish("/call/ended",[i,!0]),t.call=null,Re(t),n.updateCall(e),e.call=n,Re(e),h.debug("[CircuitCallControlSvc]: Publish /call/moved event"),O.publish("/call/moved",[i.callId,n.callId]),ve(n)}(i,n,t),t.isRemote)h.debug("[CircuitCallControlSvc]: Session Moved for Remote Call");else if("iOS"!==N.navigator.platform&&Xe(i),i.creatorId===A.localUser.userId){var e={};n.participants.forEach(function(t){e[t.userId]=!0}),i.participants.forEach(function(n){e[n.userId]||bt(t,n)})}})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTC.SESSION_MOVED event. ",e)}}),W.on("RTCCall.INVITE",function(e){if(ne){if(A.isCMR){if(A.localUser.userPresenceState.state===a.PresenceState.BUSY)return h.info("[CircuitCallControlSvc]: CMP is updating its software. Reject the INVITE with cause BUSY."),void qe(e);if(!A.inviterUserId||A.inviterUserId!==e.userId)return h.info("[CircuitCallControlSvc]: Reject the INVITE with cause BUSY."),void qe(e)}try{h.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE");var t=e.isGuestInvite&&!A.isCMR,n=le(e.convId);if(!n){h.info("[CircuitCallControlSvc]: Could not find corresponding conversation. Save pending INVITE and retrieve conversation.");var i=e.sessionId;return ie[i]=e,void(t?y.createConversationAsGuestFromSummary(e.convId).then(function(e){ie[i]&&(h.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),mt(ie[i],e),delete ie[i])}).catch(function(){h.warn("[CircuitCallControlSvc]: Could not create temporary conversation from summary."),delete ie[i]}):y.getConversationById(e.convId,{randomLoaded:!0,sessionId:e.sessionId},function(e,t){e?h.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):ie[i]?(h.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),mt(ie[i],t)):(h.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Check if there are any active sessions."),W.getActiveSessions(function(e,n){A.$apply(function(){e&&(h.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),n=[]),ht(t,n)})})),delete ie[i]}))}if(t&&!n.isTemporary&&(n=y.createConversationAsGuest(n)),!n.hasJoined&&!t)return void h.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");A.$apply(function(){mt(e,n)})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE event. ",e)}}else h.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the INVITE event.")}),W.on("RTCSession.PARTICIPANT_LEFT",function(e){A.$apply(function(){try{h.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_LEFT");var t=A.localUser.userId===e.userId,n=_e(e.sessionId),i=[a.RTCSessionParticipantLeftCause.TRANSPORT_NEGOTIATION_FAILED,a.RTCSessionParticipantLeftCause.NEGOTIATION_FAILED,a.RTCSessionParticipantLeftCause.SECURITY_NEGOTIATION_FAILED];if(t){if(n&&!n.isDirect&&!n.isEstablished()&&!i.includes(e.cause))return void h.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for non-established group calls");var r=n&&e.cause===a.RTCSessionParticipantLeftCause.REMOVED&&e.requesterId?n.getParticipant(e.requesterId):null;h.debug("[CircuitCallControlSvc]: Publish /localUser/leftConference event"),O.publish("/localUser/leftConference",r?[e.sessionId,e.cause,r]:[e.sessionId,e.cause]),r&&P&&P.show({type:s.NotificationType.HIGH_PRIORITY,user:A.localUser,extras:{title:A.i18n.map.res_RemovedFromConferenceTitle,text:A.i18n.localize("res_RemovedFromConferenceBy",[r.displayName])}})}var o=Je(e.sessionId);if(o)return h.info("[CircuitCallControlSvc]: Event is for active remote call."),void(t&&Ke(o));if(!n){var c=$e(e.sessionId);if(c&&!c.isDirect&&c.hasParticipant(e.userId)){h.info("[CircuitCallControlSvc]: Event is for an incoming call. Caller has left the conversation."),ot(c,e.userId,e.cause);var l=le(c.convId);l&&(Ye(l),ge(c,s.CallClientTerminatedReason.CALLER_LEFT_CONFERENCE))}else h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");return}if(n.isTestCall)return void h.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for test calls");if(!t||e.userId!==n.screenOwnerId&&e.userId!==n.screenControllerId||ke(n.callId),n.isDirect)return void(t||e.cause!==a.RTCSessionParticipantLeftCause.CONNECTION_LOST&&e.cause!==a.RTCSessionParticipantLeftCause.STREAM_LOST?h.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for direct calls"):n.setParticipantState(e.userId,s.ParticipantState.ConnectionLost));var d=e.userId,u=le(n.convId);if(t){if(Ye(u),e.cause===a.RTCSessionParticipantLeftCause.REMOVED){var C=n.getParticipant(e.requesterId);O.publish("/call/droppedRemotely",[n,C])}else if(i.includes(e.cause))return void St(n,{error:"res_CallMediaFailed"});ge(n,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+e.cause)}else{if(e.cause===a.RTCSessionParticipantLeftCause.MAX_PARTICIPANTS_REACHED){var E=u.participants.some(function(e){return e.userId===d}),T=function(e,t){e||(h.debug("[CircuitCallControlSvc]: Publish /call/participant/rejected event"),O.publish("/call/participant/rejected",[n.callId,t]))};return void(E?D.getUserById(d,T):T())}ot(n,d,e.cause),Gt(n),n.isDirectUpgradedToConf&&0===n.participants.length&&ze(n,null,s.CallClientTerminatedReason.ENDED_BY_ANOTHER_USER)}n.screenControlSupported&&!n.hasRemoteScreenShare()&&(n.screenControlSupported=!1)}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_LEFT event. ",e)}})}),W.on("RTCCall.SDP_FAILED",function(e){try{h.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_FAILED with cause =",e.cause);var t=_e(e.sessionId);if(!t)return void h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(W.clientId!==e.clientID)return void h.debug("[CircuitCallControlSvc]: Event is not for this client");if(t.instanceId||t.setInstanceId(e.instanceId),e.cause===a.SdpFailedCause.SESSION_TERMINATED)return void h.debug("[CircuitCallControlSvc]: SDP_FAILED due to session terminated. Ignore");A.$apply(function(){t.isEstablished()?t.sessionCtrl.renegotiationFailed("SDP failed received"):e.cause===a.SdpFailedCause.MAX_PARTICIPANTS_REACHED?St(t,{error:"res_JoinRTCSessionFailedPermission"}):t.isDirect&&t.isCallOut||(e.cause===a.SdpFailedCause.SESSION_STARTED_FAILED?ge(t,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+e.cause):ze(t,null,s.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED))})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_FAILED event. ",e)}}),W.on("RTCSession.SESSION_TERMINATED",function(e){try{if(h.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATED"),$[e.sessionId]&&delete $[e.sessionId],ie[e.sessionId])return h.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete ie[e.sessionId];var t=Ne(e.sessionId);if(!t)return void h.warn("[CircuitCallControlSvc]: Could not find call with rtcSessionId =",e.sessionId);if(t.terminateTimer)return void h.info("[CircuitCallControlSvc]: Call is already being terminated. Ignore event");t.isTelephonyCall&&re&&(h.debug("[CircuitCallControlSvc]: Call is being moved to another device, keep showing"),t.setAtcHandoverInProgress(),g.cancel(re),re=null),A.$apply(function(){var n=e.cause;if(h.info("[CircuitCallControlSvc]: Publish /call/terminated. cause = ",n),O.publish("/call/terminated",[t,n]),ge(t,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+n),A.localUser.isOsBizCTIEnabled){var i=t.isOsBizFirstCall?x.findOsBizSecondCall():x.findOsBizFirstCall();i&&!i.checkState(s.CallState.Terminated)&&(O.publish("/call/terminated",[i]),ge(i))}})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_TERMINATED event. ",e)}}),W.on("RTCCall.INVITE_CANCEL",function(e){try{if(W.clientId===e.clientID)return void h.debug("[CircuitCallControlSvc]: Ignore own INVITE_CANCEL");if(ie[e.sessionId])return h.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete ie[e.sessionId];A.$apply(function(){h.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_CANCEL with cause: ",e.cause);var t=$e(e.sessionId);if(t){if(!t.isDirect||e.cause===a.InviteCancelCause.ACCEPT){var n=le(t.convId),i=e.cause===a.InviteCancelCause.ACCEPT?{clientId:e.clientID}:null;Ye(n,i,null,e.sessionId,function(e){i&&e.isTelephonyCall&&ye(e,t.peerUser.phoneNumber,null,t.peerUser.displayName)})}var r=s.CallClientTerminatedReason.ANOTHER_CLIENT_REJECTED;e.cause===a.InviteCancelCause.ACCEPT?r=s.CallClientTerminatedReason.ANOTHER_CLIENT_ANSWERED:e.cause===a.InviteCancelCause.REVOKED&&(r=s.CallClientTerminatedReason.ENDED_BY_ANOTHER_USER),ge(t,r)}else if(h.debug("[CircuitCallControlSvc]: There is no corresponding alerting call"),e.cause===a.InviteCancelCause.ACCEPT){var o=Ne(e.sessionId);o&&o.isRemote&&(h.debug("[CircuitCallControlSvc]: There is a remote call, probably ringing timeout or another client called in"),o.activeClient={clientId:e.clientID},o.setState(s.CallState.ActiveRemote),Ze(o),ve(o))}})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE_CANCEL event. ",e)}}),W.on("RTCCall.INVITE_FAILED",function(e){try{h.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_FAILED");var t=_e(e.sessionId);if(!t)return void h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(!t.isDirect){var n=t.getParticipant(e.userId);if(e.to){n.displayName=e.to.displayName;var i=rt(t,n);i&&(h.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),O.publish("/call/participant/updated",[t.callId,i]))}if(n&&n.isActive())return void h.debug("[CircuitCallControlSvc]: Unexpected event. participant already connected: ",e.userId)}if(e.clientID&&W.clientId!==e.clientID)return void h.debug("[CircuitCallControlSvc]: Event is not for this client: ",W.clientId);t.isTelephonyCall&&e.to&&ye(t,e.to.phoneNumber,e.to.fullyQualifiedNumber,e.to.displayName,e.to.userId),A.$apply(function(){var n,i=t,r=e.cause,o=e.userId;switch(r){case a.InviteFailedCause.NOT_REACHABLE:n=s.ParticipantState.Offline,i.isDirect&&i.setState(s.CallState.Failed);break;case a.InviteFailedCause.BUSY:n=s.ParticipantState.Busy,i.isDirect&&i.setState(s.CallState.Busy);break;case a.InviteFailedCause.DECLINE:n=s.ParticipantState.Declined,i.isDirect&&i.setState(s.CallState.Declined);break;case a.InviteFailedCause.TIMEOUT:n=s.ParticipantState.Timeout,i.isDirect&&i.setState(s.CallState.NotAnswered);break;case a.InviteFailedCause.TEMPORARILY_UNAVAILABLE:case a.InviteFailedCause.INVALID_NUMBER:n=s.ParticipantState.Busy,i.isDirect&&i.setState(s.CallState.Failed);break;case a.InviteFailedCause.REVOKED:n=s.ParticipantState.Removed,i.isDirect&&i.setState(s.CallState.Failed);break;default:h.warn("[CircuitCallControlSvc]: Unexpected RTCCall.INVITE_FAILED cause =",e.cause),n=s.ParticipantState.Busy,i.isDirect&&i.setState(s.CallState.Failed)}if(i.isDirect)i.setParticipantState(o,n),ve(i),i.hasVideo()&&i.removeParticipant(o),ze(i,null,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+r,!0);else{i.setParticipantState(o,n);var c=i.removeParticipant(o);c&&(h.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),O.publish("/call/participant/removed",[i.callId,c]),i.participants.isEmpty()&&(i.conferenceCall?i.checkState(s.CallState.Waiting)||(i.setState(s.CallState.Waiting),ve(i)):(i.setState(s.CallState.NotAnswered),ve(i),ze(null,null,s.CallServerTerminatedReason.SERVER_ENDED_PRFX+r,!0))))}})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTC.INVITE_FAILED event. ",e)}}),W.on("RTCSession.ACTIVE_SPEAKER",It),W.on("RTCSession.VIDEO_ACTIVE_SPEAKER",ft),W.on("RTCCall.CHANGE_MEDIA_TYPE_REQUESTED",function(e){try{if(h.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_REQUESTED"),$e(e.sessionId))return void _t(e.sessionId,e.transactionId);var t=_e(e.sessionId);if(!t||t.isRemote)return void h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(e.clientID&&W.clientId!==e.clientID)return void h.debug("[CircuitCallControlSvc]: Event is not for this client: ",W.clientId);if(t.activeClient)return void h.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(!t.isEstablished()&&t.direction===s.CallDirection.INCOMING||!t.isDirect)return void _t(t.callId,e.transactionId);A.$apply(function(){if(e.sdp){var n=t.sessionCtrl;if(!n.isConnStable())return void _t(t.callId,e.transactionId);t.setTransactionId(e.transactionId),t.isTelephonyCall&&t.atcAdvancing&&"nooffer"!==e.sdp.type&&t.sessionCtrl.setIgnoreTurnOnNextPC();var i=function(e){n.onSessionDescription=null;var i={rtcSessionId:t.callId,sdp:e.sdp,transactionId:t.transactionId};W.changeMediaAccept(i,function(e){A.$apply(function(){t.clearTransactionId(),e?h.error("[CircuitCallControlSvc]: changeMediaAccept sdp answer sending error"):h.debug("[CircuitCallControlSvc]: changeMediaAccept sdp answer sent")})})};t.atcAdvancing=!1,Ce(t).then(function(r){n.setTurnCredentials(r),I.isNoOfferSdp(e.sdp)?Ve({callId:t.callId,transactionId:t.transactionId,mediaType:t.localMediaType,hosted:e.hosted,replaces:e.replaces},function(e){e&&h.warn("[CircuitCallControlSvc]: Failed to renegotiate the media")}):(t.lastMediaType=t.mediaType,n.onSessionDescription=i,n.setRemoteDescription(e.sdp,function(i){i&&(n.onSessionDescription=null,t.transactionId===e.transactionId?_t(t.callId,e.transactionId):h.warn("[CircuitCallControlSvc]: TransactionId: "+e.transactionId+" has already been completed."))}))}).catch(function(){_t(t.callId,e.transactionId)})}else _t(t.callId,e.transactionId)})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_REQUESTED event. ",e)}}),W.on("RTCCall.CHANGE_MEDIA_TYPE_FORCED",function(e){try{h.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_FORCED");var t=_e(e.sessionId);if(!t)return void h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(t.isDirect)return void h.debug("[CircuitCallControlSvc]: Event is not applicable for direct calls. Ignore it.");if(e.clientID&&W.clientId!==e.clientID)return void h.debug("[CircuitCallControlSvc]: Event is not for this client: ",W.clientId);if(t.activeClient)return void h.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(e.removeMediaTypes){var n=null;e.removeMediaTypes.includes(a.RealtimeMediaType.AUDIO)&&(n={audio:!1}),e.removeMediaTypes.includes(a.RealtimeMediaType.VIDEO)&&((n=n||{}).video=!1),t.localMediaType.desktop&&e.removeMediaTypes.includes(a.RealtimeMediaType.DESKTOP_SHARING)&&((n=n||{}).desktop=!1),n&&A.$apply(function(){var i=null;if(void 0!==n.desktop){var r=e.removeMediaTypes.includes(a.RealtimeMediaType.AUDIO);h.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/started event"),O.publish("/screenshare/forceStop/started",[e.userId,r]),i=function(n){if(h.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/ended event"),O.publish("/screenshare/forceStop/ended",[n]),!n){var i=e.userId&&t.getParticipant(e.userId),r=i&&i.displayName;P&&P.show({type:s.NotificationType.HIGH_PRIORITY,user:A.localUser,extras:{title:A.i18n.map.res_ScreenShareNotificationTitle,text:r?A.i18n.localize("res_ScreenShareRemotelyDisabledByUser",[r]):A.i18n.map.res_ScreenShareRemotelyDisabled}})}}}wt(t.callId,n,"changeMediaForced").then(function(){i&&i()}).catch(function(e){i&&i(e)})})}}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_TYPE_FORCED event. ",e)}}),W.on("RTCCall.RTC_QUALITY_RATING_EVENT",function(e){h.debug("[CircuitCallControlSvc]: Received RTCCall.RTC_QUALITY_RATING_EVENT");var t=q||j;if(t)return h.info("[CircuitCallControlSvc]: Postpone call quality rating during call"),void(t.ratingEvent=e);A.$apply(function(){Tt(e)})}),W.on("RTCCall.IFRAME_STATISTICS",function(e){h.debug("[CircuitCallControlSvc]: Received RTCCall.IFRAME_STATISTICS"),A.$apply(function(){P&&P.show({type:s.NotificationType.HIGH_PRIORITY,user:A.localUser,extras:{title:A.i18n.map.res_ScreenShareNotificationTitle,text:A.i18n.localize("res_ScreenShareIFrameDelay",[Math.round(e.receiveDuration/1e3)])}})})}),W.on("RTCSession.PARTICIPANT_UPDATED",function(e){try{h.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_UPDATED");var t=_e(e.sessionId),n=Je(e.sessionId)||t;if(n&&n.callId===e.sessionId&&n.isTelephonyCall&&!n.atcCallInfo&&A.localUser.userId!==e.participant.userId&&ye(n,e.participant.phoneNumber,null,e.participant.userDisplayName),!t)return void h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");A.$apply(function(){var n=e.participant.userId,i=e.participant.muted;if(A.localUser.userId!==n)if(t.isEstablished()||t.direction!==s.CallDirection.INCOMING){var r=t.getParticipant(e.participant.userId);if(r){var o=be(e.participant),a=o.muted?s.ParticipantState.Muted:s.ParticipantState.Active,c=r.muted!==o.muted,l=!r.hasSameMediaType(o)||r.streamId!==o.streamId,d=rt(t,o,a);if(d){if(me(d,t),l){var u=t.mediaType.desktop;t.updateMediaType(),u!==t.mediaType.desktop&&Gt(t),t.screenOwnerId!==d.userId||d.mediaType.desktop||(h.warn("[CircuitCallControlSvc]: screenOwnerId is no longer sharing the screen. Stop remote control."),ke(t.callId))}(l||c)&&(h.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),O.publish("/call/participant/updated",[t.callId,d]))}ve(t)}else h.debug("[CircuitCallControlSvc]: Ignore UPDATED event, can not find participant to update for userId: ",n)}else h.debug("[CircuitCallControlSvc]: Ignore UPDATED event for incoming alerting calls");else t.remotelyMuted!==i&&(t.remotelyMuted=i,Ut(t,e.mutedBy))})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_UPDATED event. ",e)}}),W.on("RTCSession.SESSION_RECORDING_INFO",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_INFO");var t=_e(e.sessionId);t?A.$apply(function(){at(t,e.recordingInfo)&&(h.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),O.publish("/call/recording/info",[t]))}):h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),W.on("RTCSession.SESSION_TERMINATION_TIMER_STARTED",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_STARTED");var t=_e(e.sessionId);t?A.$apply(function(){h.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (started)"),O.publish("/call/sessionTerminateTimerChanged",[t.callId,e.endTime])}):h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),W.on("RTCSession.SESSION_TERMINATION_TIMER_CANCELLED",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_CANCELLED");var t=_e(e.sessionId);t?A.$apply(function(){h.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (cancelled)"),O.publish("/call/sessionTerminateTimerChanged",[t.callId,null])}):h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),W.on("RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT");var t=_e(e.sessionId);if(t){var n=e.type||a.SessionAttributesChangedEventType.EVENT_ATTENDEE_COUNT_CHANGED;n!==a.SessionAttributesChangedEventType.EVENT_ATTENDEE_COUNT_CHANGED||void 0!==e.attendeeCount&&t.attendeeCount!==e.attendeeCount?A.$apply(function(){switch(n){case a.SessionAttributesChangedEventType.EVENT_ATTENDEE_COUNT_CHANGED:st(e.attendeeCount);break;case a.SessionAttributesChangedEventType.SCREEN_CONTROL_REQUESTED:t.preventScreenControlRequestInConf=!0;break;case a.SessionAttributesChangedEventType.SCREEN_CONTROL_REQUEST_CLEARED:t.preventScreenControlRequestInConf=!1;break;case a.SessionAttributesChangedEventType.SCREEN_CONTROL_ESTABLISHED:Be(t,e.screenControl.screenOwnerId,e.screenControl.screenControllerId,!0);break;case a.SessionAttributesChangedEventType.SCREEN_CONTROL_ENDED:Be(t,null,null,!0);break;default:h.warn("[CircuitCallControlSvc]: Unexpected SessionAttributesChangedEventType - ",n)}}):h.debug("[CircuitCallControlSvc]: No changes")}else h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),W.on("RTCCall.PROGRESS",function(e){h.debug("[CircuitCallControlSvc]: Received RTCCall.PROGRESS");var t=_e(e.sessionId);if(t)if(t.isDirect&&(e.sdp||t.earlyMedia||e.progressType!==a.RTCProgressType.ALERTING?e.sdp&&e.progressType!==a.RTCProgressType.EARLY_CONNECT&&(t.earlyMedia=!0,t.receivedAlerting&&(h.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/stopped, call ID: ",t.callId),O.publish("/sound/call/alerting/stopped",[t]))):(t.isTelephonyCall&&(h.debug("[CircuitCallControlSvc]: Pre-allocate a new peer connection in case of immediate renegotiations"),t.sessionCtrl.prepareForRenegotiation()),t.receivedAlerting=!0,h.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/started, call ID: ",t.callId),O.publish("/sound/call/alerting/started",[t]))),t.checkState([s.CallState.Initiated,s.CallState.Delivered])){e.to&&t.isTelephonyCall&&!A.localUser.isATC&&ye(t,e.to.phoneNumber,e.to.fullyQualifiedNumber,e.to.displayName,e.to.userId);try{A.$apply(function(){!e.sdp||"answer"!==e.sdp.type&&"pranswer"!==e.sdp.type||(e.sdp.type="pranswer",t.isPranswer=!0,t.sessionCtrl.setRemoteDescription(e.sdp,function(n){n&&(t.setDisconnectCause(a.DisconnectCause.REMOTE_SDP_FAILED,"type="+e.sdp.type+" origin="+I.getOrigin(e.sdp.sdp)),ze(t,null,s.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED))})),t.setState(s.CallState.Delivered),ve(t)})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCCall.PROGRESS event.",e)}}else h.info("[CircuitCallControlSvc]: Ignore PROGRESS. Call state =",t.state.name);else h.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.")}),W.on("RTCSession.INVITE_TO_STAGE_EVENT",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_EVENT");var t=_e(e.sessionId);t?(t.raiseHandState.videoAllowed=e.allowedMediaTypes.includes(a.RealtimeMediaType.VIDEO),t.raiseHandState.screenshareAllowed=e.allowedMediaTypes.includes(a.RealtimeMediaType.DESKTOP_SHARING),A.$apply(function(){var t={invitedByUserId:e.invitedByUserId,allowedMediaTypes:e.allowedMediaTypes,expirationTime:R.delayOrTimestamp(e.expirationDelay,e.expirationTime)};h.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite, questionNumber: ",e.questionNumber),O.publish("/call/raiseHand/invite",[e.questionNumber,t])})):h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),W.on("RTCSession.INVITE_TO_STAGE_CANCEL_EVENT",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_CANCEL_EVENT"),_e(e.sessionId)?A.$apply(function(){h.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite (cancel), questionNumber: ",e.questionNumber),O.publish("/call/raiseHand/invite",[e.questionNumber,null])}):h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),W.on("RTCSession.QUESTION_EVENT",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.QUESTION_EVENT"),_e(e.sessionId)?A.$apply(function(){h.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/question, questionNumber: ",e.question.questionNumber),O.publish("/call/raiseHand/question",[e.question,e.subType])}):h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),W.on("RTCSession.CURTAIN_EVENT",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.CURTAIN_EVENT"),_e(e.sessionId)?A.$apply(function(){q.curtain=e.curtain,h.debug("[CircuitCallControlSvc]: Publish /call/curtain event"),O.publish("/call/curtain",[q.curtain])}):h.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),W.on("RTCSession.SCREEN_CONTROL_REQUESTED",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_REQUESTED");var n=_e(e.sessionId);if(n){if(!n.hasLocalScreenShare()||!t.isElectron||!Ie(n))return h.info("[CircuitCallControlSvc]: Screen control is not possible for local call. Reject it."),void x.rejectScreenControlRequest(n.callId,e.controllerId);var i=n.participants.find(function(t){return t.userId===e.controllerId});if(!i)return h.info("[CircuitCallControlSvc]: Cannot find controller in participants list. Reject it."),void x.rejectScreenControlRequest(n.callId,e.controllerId);A.$apply(function(){if(h.debug("[CircuitCallControlSvc]: Publish /screenControl/requested event"),O.publish("/screenControl/requested",[n,i]),!n.activeNotification){var t={type:s.NotificationType.SCREEN_CONTROL_REQUESTED,userId:e.controllerId,extras:{call:n,controllerId:e.controllerId}};P.show(t)}})}else h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")}),W.on("RTCSession.SCREEN_CONTROL_OFFERED",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_OFFERED"),xe(e,"SCREEN_CONTROL_OFFERED")}),W.on("RTCSession.SCREEN_CONTROL_ACCEPTED",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_ACCEPTED"),xe(e,"SCREEN_CONTROL_ACCEPTED")}),W.on("RTCSession.SCREEN_CONTROL_REJECTED",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_REJECTED");var t=_e(e.sessionId);t?A.$apply(function(){We(e.sessionId),h.debug("[CircuitCallControlSvc]: Publish /screenControl/rejected event"),O.publish("/screenControl/rejected",[t])}):h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")}),W.on("RTCSession.SCREEN_CONTROL_REQUEST_REJECTED",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_REJECTED");var t=_e(e.sessionId);t?A.$apply(function(){h.debug("[CircuitCallControlSvc]: Publish /screenControl/requestRejected event"),O.publish("/screenControl/requestRejected",[t])}):h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")}),W.on("RTCSession.SCREEN_CONTROL_FAILED",function(e){h.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_FAILED");var t=_e(e.sessionId);t?A.$apply(function(){h.debug("[CircuitCallControlSvc]: Publish /screenControl/failed event"),O.publish("/screenControl/failed",[t]),We(e.sessionId,null,!0)}):h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.")}),W.on("RTCSession.HANDOVER_SCREEN_CONTROL",function(e){try{h.debug("[CircuitCallControlSvc]: Received RTCSession.HANDOVER_SCREEN_CONTROL");var t=_e(e.sessionId);if(!t)return void h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!t.isEstablished())return void h.info("[CircuitCallControlSvc]: The local call is not established");if(e.clientID&&W.clientId!==e.clientID)return void h.debug("[CircuitCallControlSvc]: handoverScreenControl event is not for this client: ",W.clientId);Fe((n=t).callId,n.screenControllerId,function(e){e?(h.error("[CircuitCallControlSvc]: Could not transfer the screen control to the active user client."),ke(n.callId)):(n.restartScreenControlSession=!1,h.debug("[CircuitCallControlSvc]: Successfully transfered the screen control to the active user client."))})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.HANDOVER_SCREEN_CONTROL event. ",e)}var n}),W.on("RTCSession.SCREEN_CONTROL_TERMINATED",function(e){try{h.debug("[CircuitCallControlSvc]: Received RTCSession.SCREEN_CONTROL_TERMINATED");var t=_e(e.sessionId);if(!t)return void h.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!t.isEstablished())return void h.info("[CircuitCallControlSvc]: The local call is not established");t.localMediaType.desktop&&(h.info("[CircuitCallControlSvc]: Stop screen control"),t.sessionCtrl.stopScreenControl(function(e){e?h.warn("[CircuitCallControlSvc]: stopScreenControl failed - reason: ",e):h.debug("[CircuitCallControlSvc]: stopScreenControl was successful.")})),A.$apply(function(){Be(t,null,null,!0)})}catch(e){h.error("[CircuitCallControlSvc]: Exception handling RTCSession.SCREEN_CONTROL_TERMINATED event. ",e)}}),W.on("Team.NOTIFY",function(e){h.debug("[CircuitCallControlSvc]: Received Team.NOTIFY"),x.getActiveCall()||x.getIncomingCall()?h.debug("[CircuitCallControlSvc]: Ignore event as the user has other calls"):A.circuitLabs.TEAMS?A.$apply(function(){D.getUsersByIds([e.callingUserId,e.calledUserId],function(t,i){if(t)h.error("[CircuitCallControlSvc]: Error getting users");else if(i&&i.length&&2===i.length){var r,o;i.forEach(function(t){t.userId===e.callingUserId?r=t:o=t});var c={rtcSessionId:e.rtcSessionId,type:a.ConversationType.DIRECT,peerUser:r,participants:[]};(se=new u(c)).atcCallInfo=new n,se.startRingingTimer=function(){},se.setState(s.CallState.Ringing),se.setRedirectingUser(null,null,o.displayName,o.userId,d.CallPickupNotification),c.call=se,Nt(c,r.userId,!0)}else h.error("[CircuitCallControlSvc]: Unexpected result from getUsersByIds")})}):h.debug("[CircuitCallControlSvc]: Ignore event as the user has not enabled the featute")}),W.on("Team.NOTIFY_CANCEL",function(e){h.debug("[CircuitCallControlSvc]: Received Team.NOTIFY_CANCEL"),e.rtcSessionId===se.callId&&(yt(se),se=null)}),this.initActiveSessionsForSdk=function(){return ne=!0,gt()},this.initForUnitTests=function(){ne=!0},this.setDisableRemoteVideoByDefault=function(e){h.info("[CircuitCallControlSvc] Setting _disableRemoteVideoByDefault to ",!!e),J=!!e},this.getDisableRemoteVideoByDefault=function(){return J},this.setClientDiagnosticsDisabled=function(e){te=e},this.getCalls=function(){return K},this.getPhoneCalls=function(e){return K.filter(function(t){return t.isTelephonyCall&&(!e||!t.isRemote)})},this.getEstablishedLocalPhoneCalls=function(){return K.filter(function(e){return e.isTelephonyCall&&e.state.established&&!e.isRemote})},this.getActiveCall=function(e){return e?_e(e):q&&q.replaces?q.replaces:q||null},this.isConnectionInProgress=function(e){var t=x.getActiveCall(e);return!!t&&!t.sessionCtrl.isConnStable()},this.getIncomingCall=function(){return Z[0]||null},this.getActiveRemoteCall=function(){return Q},this.joinGroupCall=function(e,t,n){if(n=n||function(){},!e)return h.warn("[CircuitCallControlSvc]: joinGroupCall - Invalid Call Id"),void n("Missing callId");var i=Ne(e);if(!i||!i.isRemote||i.state.name!==s.CallState.Started.name||i.activeClient)return h.warn("[CircuitCallControlSvc]: joinGroupCall invoked without a valid call"),void n("Invalid call");var r=le(i.convId);if(!r||!r.call||r.call.callId!==i.callId)return h.warn("[CircuitCallControlSvc]: joinGroupCall - Cannot find valid conversation"),void n("Invalid conversation");i.isGuestInvite&&r.type===a.ConversationType.LARGE&&(h.info("[CircuitCallControlSvc]: in-circuit guest is joining large conference without audio"),t.audio=!1);var o=Mt({callOut:!1,handover:!1,joiningGroupCall:!0});we(r,t,o,n)&&Ot(r,t,o,n)},this.makeCall=function(e,t,n){if(n=n||function(){},!e)return h.warn("[CircuitCallControlSvc]: makeCall - Invalid Conversation Id"),void n("Missing convId");var i=le(e);if(!i)return h.warn("[CircuitCallControlSvc]: makeCall - Cannot find conversation with id ",e),void n("Conversation not found");var r=Mt({callOut:!0,handover:!1});we(i,t,r,n)&&Ot(i,t,r,n)},this.pickupTeamCall=function(e,t,n){n=n||function(){},se.callId===e&&y.createConversation(a.ConversationType.DIRECT,[{userId:se.peerUser.userId}],null,function(i,r){if(i)return h.error("[CircuitCallControlSvc]: pickupTeamCall - Unable to retrieved direct conversation. Err: ",i),void n("Conversation not found");var o=Mt({callOut:!0,handover:!1,pickUpSession:e});we(r,t,o,n)&&Ot(r,t,o,n)})},this.makeEchoTestCall=function(e,t,n){x.makeEchoTestCallWithOptions(e,null,t,n)},this.makeEchoTestCallWithOptions=function(e,t,n,i){n=n||function(){},i=i||function(){};var r=A.isSessionGuest&&A.localUser.conversationId||"echo_"+A.localUser.clientId,o={creatorId:A.localUser.userId,convId:r,rtcSessionId:"echo_"+A.localUser.clientId,participants:[{userId:A.localUser.userId}],testCall:!0};n((o=L.extend(o)).rtcSessionId),g(function(){var n=Mt({callOut:!1,handover:!1},t);we(o,e,n,i)&&He(o,e,n,i)},200)},this.dialNumber=function(e,t,n,i){i=i||function(){},y.getTelephonyConversation(function(r,o){if(r||!o)i(r);else{var a=Mt({callOut:!0,handover:!1,dialedDn:e,toName:t});we(o,n,a,i)&&Ot(o,n,a,i)}})},this.dialPhoneNumber=function(e,t){t=t||function(){},e=e||{},y.getTelephonyConversation(function(n,i){if(n||!i)t(n);else{var r=Mt({callOut:!0,handover:!1,dialedDn:e.dialedDn,toName:e.toName,userId:e.userId,dtmfDigits:e.dtmfDigits});if(!Lt(i,r,t))return;if(q&&q.isTelephonyCall&&!q.isHolding())return void x.holdCall(q.callId,function(n){n?t&&t(n):we(i,e.mediaType,r,t)&&Ot(i,e.mediaType,r,t)});we(i,e.mediaType,r,t)&&Ot(i,e.mediaType,r,t)}})},this.startConference=function(e,t,n){x.startConferenceWithOptions(e,t,null,n)},this.startConferenceWithOptions=function(e,t,n,i){if(t=t||{audio:!0,video:!1},i=i||function(){},!e)return h.warn("[CircuitCallControlSvc]: startConference - Invalid Conversation Id"),void i("Missing convId");var r=le(e);if(!r)return h.warn("[CircuitCallControlSvc]: startConference - Cannot find conversation with id ",e),void i("Conversation not found");if(r.type!==a.ConversationType.GROUP&&r.type!==a.ConversationType.LARGE)return h.warn("[CircuitCallControlSvc]: startConference - Invalid conversation type"),void i("Invalid conversation type");var o=Mt({callOut:!1,handover:!1},n);we(r,t,o,i)&&Ot(r,t,o,i)},this.answerCall=function(e,t,n){n=n||function(){};var i,r,o,c=null;if(Z.some(function(t,n){return e===t.callId&&(c=t,i=n,!0)}),!c)return h.warn("[CircuitCallControlSvc]: answerCall - There is no alerting call"),void n("No alerting call");function l(){if(c.isPresent()){j=q,q=c,pe(),Z.splice(i,1),yt(q),q.stopRingingTimer(),q.setState(q.isATCCall?s.CallState.Waiting:s.CallState.Answering);var e=le(q.convId);if(!e||!e.call||e.call.callId!==q.callId)return h.warn("[CircuitCallControlSvc]: joinCall - Cannot find valid conversation"),Qe(q,{type:a.InviteRejectCause.BUSY},!1),void n("Conversation not found");ve(q),function(e,t,n,i){if(q){var r=q,o=r.sessionCtrl;n=n||{},o.onSessionDescription=function(a){o.onSessionDescription=null;var s={convId:e.convId,rtcSessionId:r.callId||e.rtcSessionId,ownerId:e.creatorId,sdp:a.sdp,mediaType:t,callOut:!1,handover:!1,sendInviteCancel:!0,isTelephonyConversation:e.isTelephonyConv,displayName:A.localUser.displayName,transactionId:r.transactionId,rtcSupportedFeatures:Ge(r)};function c(e){A.$apply(function(){r.clearTransactionId(),e?(ge(r,Le(e)),i(Ee(e))):(h.debug("[CircuitCallControlSvc]: Join/Answer RTC session was successful."),i(null,n.warning))})}s.sdp&&"offer"===s.sdp.type?W.joinRtcCall(s,c):(U.startJoinDelayTimer(r),W.answerRtcCall(s,c))},o.start(t,null)||(ge(r,s.CallClientTerminatedReason.RTC_SESSION_START_FAILED),i(Ee()))}else h.warn("[CircuitCallControlSvc]: joinSessionCalled invoked without _primaryLocalCall")}(e,r,{warning:o},n)}else n("No call to answer")}function d(){Dt(t,function(e,t){if(t){var i=y.getConversationFromCache(c.convId);if(i&&i.isTelephonyConv)return h.warn("[CircuitCallControlSvc]: Phone calls are not possible without a microphone. Do not answer call."),void n("res_AnswerCallFailedNoMic")}r=e,o=t,l()})}if(!q||!q.isPresent()||c.replaces||q.isTelephonyCall&&c.isTelephonyCall&&A.localUser.isRegisterTC){if(q&&q.isTelephonyCall&&A.localUser.isRegisterTC&&!q.isHolding())return void x.holdCall(q.callId,function(e){e?n&&n(e):d()})}else ze(q,null,s.CallClientTerminatedReason.USER_ENDED),j&&ze(j,null,s.CallClientTerminatedReason.USER_ENDED);d()},this.endCall=function(e,t){var n=a.InviteRejectCause.DECLINE,i=x.getActiveCall();i&&i.callId===e&&(i.isEstablished()||i.direction===s.CallDirection.OUTGOING)&&(n=null),x.endCallWithCauseCode(e,n,t)},this.endCallWithCauseCode=function(e,t,n){var i=s.CallClientTerminatedReason.USER_ENDED,r=a.InviteRejectCause.DECLINE;t&&(i=t,a.InviteRejectCause[t]&&(r=t));var o=_e(e);if(o)o.replaces&&o.checkState(s.CallState.Answering)?n("Auto answer in progress"):o.terminateTimer?(ge(o,i),n&&g(n)):ze(o,r,i,!1,n);else if(q&&q.replaces&&q.replaces.callId===e)ze(q.replaces,r,i,!1,n);else{var c=Ne(e);if(c)return void(c.terminateTimer?(ge(c),n&&g(n)):ze(c,r,i,!1,n));var l=$e(e);if(l)Qe(l,{type:r},!1,n);else{h.warn("[CircuitCallControlSvc]: endCall - There is no local or alerting call");var d=y.getConversationByRtcSession(e);d&&d.call&&(d.call=null,Re(d)),n&&n("Call not found")}}},this.endConference=function(e,t){var n=Ne(e);n?A.isSessionGuest||n.isGuestInvite?t&&t("Not allowed"):function(e,t){if(t=t||function(){},e.isDirect)return h.debug("[CircuitCallControlSvc]: Direct call. Ignore terminate conference request."),void g(t);h.debug("[CircuitCallControlSvc]: terminateConference - rtcSessionId=",e.callId),W.terminateRtcCall(e.callId,e.disconnectCause,function(n){A.$apply(function(){if(n&&(h.warn("[CircuitCallControlSvc]: Error terminating the RTC call. ",n),e===q)){var i=le(e.convId);i&&e.isEstablished()&&Ye(i)}t&&t(n)})}),e===q&&ge(e,s.CallClientTerminatedReason.USER_ENDED)}(n,t):t&&t("Call not found")},this.startScreenShare=function(e,t,n){if(n=n||function(){},!e)return h.warn("[CircuitCallControlSvc]: startScreenShare - Invalid Conversation Id"),void n("Invalid convId");var i=le(e);if(!i)return h.warn("[CircuitCallControlSvc]: startScreenShare - Cannot find conversation with id ",e),void n("Conversation not found");var r={audio:!0,video:!1,desktop:!0};t&&"string"==typeof t&&(t={screenShareType:t});var o=Mt({callOut:!0,handover:!1,screenShareOptions:t});we(i,r,o,n)&&He(i,r,o,function(e){e||(h.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),O.publish("/screenshare/started")),n(e)})},this.addScreenShare=function(e,t,n){n=n||function(){};var i=_e(e);if(!i)return h.warn("[CircuitCallControlSvc]: addScreenShare - There is no local call"),void n("No active call");var r=Object.assign({},i.localMediaType);r.desktop=!0,ut(i)||(r.video=!1),t&&"string"==typeof t&&(t={screenShareType:t}),ce=null,ct(i,t).then(function(i){Ve({callId:e,mediaType:r,screenShareOptions:{screenIndex:i.screenIndex,streamId:i.streamId,screenType:t&&t.screenShareType,pointer:i.pointer,screenControlSupported:i.screenControlSupported,mediaStream:i.mediaStream}},function(e){if(e)return h.warn("[CircuitCallControlSvc]: AddScreenShare failed: ",e),void n(e);h.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),O.publish("/screenshare/started"),n()})}).catch(function(e){n(e)})},this.addMediaStream=function(e,t,n){n=n||function(){};var i=_e(e);if(!i)return h.warn("[CircuitCallControlSvc]: addMediaStream - There is no local call"),void n("No active call");var r=Object.assign({},i.localMediaType);r.desktop=!0,ut(i)||(r.video=!1),Ve({callId:e,mediaType:r,screenShareOptions:{mediaStream:t}},function(e){e?(h.warn("[CircuitCallControlSvc]: addMediaStream failed: ",e),n("res_AddMediaStreamFailed")):n()})},this.removeMediaStream=function(e,t){t=t||function(){},wt(e,{desktop:!1},"removeMediaStream").then(t).catch(function(){t("res_RemoveMediaStreamFailed")})},this.requestScreenControl=function(e){return new m(function(t,n){h.debug("[CircuitCallControlSvc]: requestScreenControl...");var i=_e(e);if(!i)return h.warn("[CircuitCallControlSvc]: requestScreenControl - There is no local call"),void n("No active call");if(!i.hasRemoteScreenShare())return h.warn("[CircuitCallControlSvc]: requestScreenControl - Local call does not have remote screenshare"),void n("No screen share");if(!i.screenControlSupported)return h.warn("[CircuitCallControlSvc]: requestScreenControl - Screen control not supported by presenter"),void n("Not supported");var r=i.participants.find(function(e){return e.mediaType.desktop});if(!r)return h.warn("[CircuitCallControlSvc]: requestScreenControl - Could not find screenshare presenter"),void n("No presenter");var o={rtcSessionId:i.callId,ownerId:r.userId};W.requestScreenControl(o,function(e){A.$apply(function(){e?(h.error("[CircuitCallControlSvc]: Failed to request screen control. ",e),n(e)):(h.debug("[CircuitCallControlSvc]: requestScreenControl was successful. Wait for the SCREEN_CONTROL_OFFERED event."),t(),h.debug("[CircuitCallControlSvc]: Publish /screenControl/request event"),O.publish("/screenControl/request",[i,r]))})})})},this.offerScreenControl=function(e,t){return new m(function(n,i){h.debug("[CircuitCallControlSvc]: offerScreenControl..."),Fe(e,t,function(e){e?i(e):n()})})},this.rejectScreenControlRequest=function(e,t){return new m(function(n,i){h.debug("[CircuitCallControlSvc]: rejectScreenControlRequest...");var r=_e(e);if(!r)return h.warn("[CircuitCallControlSvc]: rejectScreenControlRequest - There is no local call"),void i("No active call");if(!t)return h.warn("[CircuitCallControlSvc]: rejectScreenControlRequest - controllerId was not provided"),void i("No active call");var o={rtcSessionId:e,controllerId:t};W.rejectScreenControlRequest(o,function(e){e?(h.error("[CircuitCallControlSvc]: Failed to reject screen control request. ",e),i(e)):(h.debug("[CircuitCallControlSvc]: rejectScreenControlRequest was successful."),Be(r,null,null,!0),n())})})},this.stopScreenControl=function(e){return new m(function(t,n){We(e,function(e){e?n(e):t()})})},this.sendDataMessage=function(e){h.debug("[CircuitCallControlSvc]: Sending WebRTC data");var t=x.getActiveCall();t&&t.sessionCtrl&&t.sessionCtrl.sendDataMessage(e)||h.error("[CircuitCallControlSvc]: Cannot send WebRTC data")},this.selectMediaToShare=function(e,t,n){n=n||function(){};var i=_e(e);if(!i)return h.warn("[CircuitCallControlSvc]: selectMediaToShare - There is no local call"),void n("No active call");h.debug("[CircuitCallControlSvc]: selectMediaToShare...");var r=Object.assign({},i.localMediaType);r.desktop=!0,ut(i)||(r.video=!1),t&&"string"==typeof t&&(t={screenShareType:t}),ct(i,t).then(function(i){Ve({callId:e,mediaType:r,changeDesktopMedia:!0,screenShareOptions:{screenIndex:i.screenIndex,streamId:i.streamId,screenType:t&&t.screenShareType,pointer:i.pointer,screenControlSupported:i.screenControlSupported,mediaStream:i.mediaStream}},n)}).catch(function(e){n(e)}),O.publish("/screenshare/changed")},this.removeScreenShare=function(e,t){t=t||function(){},wt(e,{desktop:!1},"removeScreenShare").then(t).catch(function(){t("res_RemoveScreenShareFailed")})},this.addAudio=function(e,t){t=t||function(){},wt(e,{audio:!0},"addAudio").then(t).catch(function(){t("Renegotiate for receive-only media failed")})},this.removeAudio=function(e,t){t=t||function(){},wt(e,{audio:!1},"removeAudio").then(t).catch(function(){t("Renegotiate for receive-only media failed")})},this.enableRemoteAudio=function(e){var t=_e(e);t?t.remoteAudioDisabled&&(t.enableRemoteAudio(),h.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),O.publish("/call/remoteStreamUpdated",[t])):h.warn("[CircuitCallControlSvc]: enableRemoteAudio - There is no local call")},this.disableRemoteAudio=function(e){var t=_e(e);t?t.remoteAudioDisabled||(t.disableRemoteAudio(),h.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),O.publish("/call/remoteStreamUpdated",[t])):h.warn("[CircuitCallControlSvc]: disableRemoteAudio - There is no local call")},this.addVideo=function(e,t){t=t||function(){},wt(e,{video:!0},"addVideo").then(t).catch(function(){t("res_AddVideoFailed")})},this.removeVideo=function(e,t){t=t||function(){},wt(e,{video:!1},"removeVideo").then(t).catch(function(){t("res_RemoveVideoFailed")})},this.toggleRemoteVideo=function(e,t){t=t||function(){};var n=_e(e);if(!n)return h.warn("[CircuitCallControlSvc]: toggleRemoteVideo - There is no local call"),void t("No active call");h.debug("[CircuitCallControlSvc]: toggleRemoteVideo..."),n.sessionCtrl.isConnStable()?(n.remoteVideoDisabled?n.enableRemoteVideo():(n.disableRemoteVideo(),O.publish("/call/toggleRemoteVideo")),Ve({callId:e,mediaType:n.localMediaType},function(e){e?(n.remoteVideoDisabled?n.enableRemoteVideo():n.disableRemoteVideo(),h.warn("[CircuitCallControlSvc]: toggleRemoteVideo failed: ",e),t("res_ToggleVideoFailed")):(t(),n.state&&n.state.established&&n.remoteControlActive&&!n.hasRemoteScreenShare()&&ke(n.callId),!n.remoteVideoDisabled&&O.publish("/call/toggleRemoteVideo"))})):t("Connection not stable")},this.changeHDVideo=function(e,t,n,i){n=n||function(){};var r=_e(e);if(!r)return h.warn("[CircuitCallControlSvc]: changeHDVideo - There is no local call"),void n("No active call");if(!r.localMediaType.video)return h.warn("[CircuitCallControlSvc]: changeHDVideo - Local call has no video"),void n("No video");if(t=!!t,h.debug("[CircuitCallControlSvc]: changeHDVideo - hdVideo = ",t),r.localMediaType.hdVideo===t)return h.debug("[CircuitCallControlSvc]: changeHDVideo - No changes"),void n();Et(i)||(i=null);var o=Object.assign({},r.localMediaType);o.hdVideo=t,o.videoResolution=i,Ve({callId:e,mediaType:o},function(e){e?(h.warn("[CircuitCallControlSvc]: changeHDVideo failed: ",e),n("res_ToggleVideoFailed")):n()})},this.changeVideoResolution=function(e,t,n){n=n||function(){};var i=_e(e);if(!i)return h.warn("[CircuitCallControlSvc]: changeVideoResolution - There is no local call"),void n("No active call");if(!i.localMediaType.video&&!i.localMediaType.hdVideo)return h.warn("[CircuitCallControlSvc]: changeVideoResolution - Local call has no HD video"),void n("No video");if(h.debug("[CircuitCallControlSvc]: changeVideoResolution - newResolution = ",t),Et(t)){if(i.localMediaType.videoResolution===t)return h.debug("[CircuitCallControlSvc]: changeVideoResolution - No changes"),void n();var r=Object.assign({},i.localMediaType);r.videoResolution=t,Ve({callId:e,mediaType:r},function(e){e?(h.warn("[CircuitCallControlSvc]: changeVideoResolution failed: ",e),n("res_ToggleVideoFailed")):n()})}else n("Invalid resolution")},this.toggleVideo=function(e,t){t=t||function(){};var n=_e(e);if(!n)return h.warn("[CircuitCallControlSvc]: toggleVideo - There is no local call"),void t("No active call");wt(e,{video:!n.localMediaType.video},"toggleVideo").then(t).catch(function(){t("res_ToggleVideoFailed")})},this.renegotiateMedia=function(e,t,n){t=t||function(){},wt(e,{},"renegotiateMedia",n).then(t).catch(function(){t("Renegotiate media failed")})},this.setMediaType=function(e,t,n){if(n=n||function(){},!_e(e))return h.warn("[CircuitCallControlSvc]: setMediaType - There is no local call"),void n("No active call");h.debug("[CircuitCallControlSvc]: setMediaType..."),Ve({callId:e,mediaType:t},function(e){e?(h.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),n("Renegotiate media failed")):n()})},this.holdCall=function(e,t){t=t||function(){};var n=_e(e);return n?n.isHolding()||n.isHoldInProgress()?(h.debug("[CircuitCallControlSvc]: holdCall - The call is already held"),void t()):(h.debug("[CircuitCallControlSvc]: holdCall..."),n.setHoldInProgress(),void Ve({callId:e,mediaType:n.localMediaType,hold:!0},function(e){n.clearHoldInProgress(),e?(h.warn("[CircuitCallControlSvc]: Failed to hold the call"),t("res_HoldCallFailed")):t()})):(h.warn("[CircuitCallControlSvc]: holdCall - There is no call"),void t("No active call"))},this.retrieveCall=function(e,t){t=t||function(){};var n=_e(e);if(!n.isHolding())return h.debug("[CircuitCallControlSvc]: retrieveCall - There is no held local call"),void t();h.debug("[CircuitCallControlSvc]: retrieveCall..."),n.setRetrieveInProgress(),Ve({callId:e,mediaType:n.localMediaType,hold:!1},function(e){if(n.clearRetrieveInProgress(),e)h.warn("[CircuitCallControlSvc]: Failed to retrieve the call"),t("res_RetrieveCallFailed");else{n===j&&(j=q,q=n);var i=le(q.convId);i.call=q,Re(i),t()}})},this.swapCall=function(e,t){if(t=t||function(){},!(j=x.getPhoneCalls(!0).length>1?Oe(!0):null)||!q)return h.warn("[CircuitCallControlSvc]: swapCall - There are no held and active local calls"),void t("No calls to swap");if(j&&j.callId!==e)return h.warn("[CircuitCallControlSvc]: swapCall - Wrong callId of the held call"),void t("Wrong callId");var n=j.callId,i=q.callId;x.holdCall(i,function(e){e?t&&t(e):x.retrieveCall(n,t)})},this.pullRemoteCall=function(e,t,n){n=n||function(){};var i=Je(e);if(!i)return h.warn("[CircuitCallControlSvc]: pullRemoteCall invoked without a valid call"),void n("No active remote call");if(i.pullNotAllowed)n("res_PullCallNotAllowed");else{var r=le(i.convId);if(!r||!r.isTelephonyConv&&r.call.callId!==e)return h.warn("[CircuitCallControlSvc]: pullRemoteCall - Cannot find valid conversation"),void n("Conversation not found");q&&q.isTelephonyCall?x.holdCall(q.callId,function(e){e?n&&n(e):o()}):o()}function o(){var o=i.activeClient||{},a={audio:!0,video:!(!o.mediaType||!o.mediaType.video)};t&&(a.video=!1);var s=Mt({callOut:!1,handover:!0,callId:e});we(r,a,s,n)&&Ot(r,a,s,n)}},this.endRemoteCall=function(e,t){t=t||function(){};var n=Je(e);if(!n)return h.warn("[CircuitCallControlSvc]: endRemoteCall invoked without a valid call"),void t("No active remote call");var i=le(n.convId);if(!i||i.call.callId!==e)return h.warn("[CircuitCallControlSvc]: endRemoteCall - Cannot find valid conversation"),void t("Conversation not found");!function(e,t){h.debug("[CircuitCallControlSvc]: endRemoteCall - rtcSessionId=",e.callId),e.isDirect?W.terminateRtcCall(e.callId,e.disconnectCause,function(e){A.$apply(function(){e&&h.warn("[CircuitCallControlSvc]: Error terminating remote RTC call. ",e),t(e)})}):W.leaveRtcCall(e.callId,e.disconnectCause,function(e){A.$apply(function(){e&&h.warn("[CircuitCallControlSvc]: Error leaving remote RTC call. ",e),t(e)})})}(n,function(e){e?t("res_EndRemoteCallFailed"):(Ke(n),t())})},this.hideRemoteCall=function(e){var t=Ne(e);t?ge(t):h.warn("[CircuitCallControlSvc]: hideRemoteCall invoked without a valid call")},this.dropParticipant=function(e,t,n){n=n||function(){};var i=_e(e);return!i||i.isDirect?(h.warn("[CircuitCallControlSvc]: dropParticipant - invalid call"),void n("Call invalid")):t&&t.userId?(t.isCMP&&t.isMeetingPointInvitee&&(i.setMeetingPointInviteState(!1),x.enableRemoteAudio(e)),h.debug("[CircuitCallControlSvc]: Dropping participant in existing RTC session. userId =",t.userId),void function(e,t){if(t=t||function(){},q){var n=q.getParticipant(e);if(n)if(n.actions.includes(s.ParticipantAction.Drop)){var i={rtcSessionId:q.callId,userId:e};W.removeSessionParticipant(i,function(e){A.$apply(function(){e?(h.warn("[CircuitCallControlSvc]: Failed to remove participant"),t("res_RemoveParticipantFailed")):t()})})}else h.warn("[CircuitCallControlSvc]: remove call participant, unsupported pcState: ",n.pcState.name),t("Participant not active");else h.error("[CircuitCallControlSvc]: call participant not found: ",e),t("Participant not found")}else t("No active call")}(t.userId,n)):(h.warn("[CircuitCallControlSvc]: dropParticipant - Invalid participant"),void n("Participant invalid"))},this.addParticipantToCall=function(e,t,n){var i=_e(e);i?bt(i,t,n):(h.warn("[CircuitCallControlSvc]: addParticipantToCall - There is no local call"),n&&n("Invalid callId"))},this.addParticipantToRtcSession=function(e,t,n){var i=Ne(e);i?bt(i,t):(h.warn("[CircuitCallControlSvc]: addParticipantToRtcSession - Call not found"),n&&n("Invalid callId"))},this.mute=function(e,t){t=t||function(){};var n=_e(e);if(!n||e!==n.callId)return h.warn("[CircuitCallControlSvc]: mute - There is no local call"),void t("Call not valid");n.locallyMuted?t("Call already muted"):(h.debug("[CircuitCallControlSvc]: Mute the local call"),n.mute(function(){A.$apply(function(){h.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),O.publish("/call/localUser/mutedSelf",[e,!0]),t()})}))},this.unmuteLocally=function(e){e=e||function(){},q?q.locallyMuted?(h.debug("[CircuitCallControlSvc]: Unmute the local call"),q.unmute(function(t){A.$apply(function(){t||(h.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),O.publish("/call/localUser/mutedSelf",[q.callId,!1])),e(t)})})):e():e("Call not found")},this.unmute=function(e,t){t=t||function(){};var n=_e(e);n?n.isMuted()?x.unmuteLocally(function(e){!e&&n.remotelyMuted?x.unmuteParticipant(n.callId,A.localUser,t):t(e)}):t("Call not muted"):h.warn("[CircuitCallControlSvc]: unmute - There is no local call")},this.toggleMute=function(e,t){t=t||function(){};var n=_e(e);return n?n.isLocalMuteAllowed()?void(n.isMuted()?x.unmute(n.callId,t):x.mute(n.callId,t)):(h.warn("[CircuitCallControlSvc]: toggleMute - Local Mute is not allowed"),void t()):(h.warn("[CircuitCallControlSvc]: toggleMute - There is no local call"),void t("Call not valid"))},this.muteParticipant=function(e,t,n){n=n||function(){};var i=_e(e);if(!i)return h.warn("[CircuitCallControlSvc]: muteParticipant - There is no local call"),void n("Call invalid");var r=t&&t.userId;if(!r)return h.warn("[CircuitCallControlSvc]: muteParticipant - Invalid participant ID"),void n("Participant invalid");h.debug("[CircuitCallControlSvc]: Mute participant in existing RTC session. participantId =",r);var o={rtcSessionId:i.callId,usersIds:[r],muted:!0};W.muteParticipant(o,function(e){A.$apply(function(){e?(h.warn("[CircuitCallControlSvc]: Failed to mute participant"),n("res_MuteParticipantFailed")):n()})})},this.hasUnmutedParticipants=function(e){var t=_e(e);return t&&e===t.callId?t.hasUnmutedParticipants():(h.warn("[CircuitCallControlSvc]: hasUnmutedParticipants - There is no local call"),!1)},this.muteRtcSession=function(e,t){t=t||function(){};var n=_e(e);if(!n||e!==n.callId)return h.warn("[CircuitCallControlSvc]: muteRtcSession - There is no local call"),void t("Call invalid");if(n.hasUnmutedParticipants()){h.debug("[CircuitCallControlSvc]: Mute RTC session (all other participants)");var i={rtcSessionId:n.callId,muted:!0,excludedUserIds:[A.localUser.userId]};W.muteRtcSession(i,function(e){A.$apply(function(){e?(h.warn("[CircuitCallControlSvc]: Failed to mute RTC session"),t("res_MuteAllOtherParticipantsFailed")):t()})})}},this.unmuteParticipant=function(e,t,n){n=n||function(){};var i=_e(e);if(!i)return h.warn("[CircuitCallControlSvc]: unmuteParticipant - There is no local call"),void n("Call invalid");var r=t&&t.userId;if(!r)return h.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void n("Participant invalid");if(r!==A.localUser.userId)return h.warn("[CircuitCallControlSvc]: Cannot unmute remote participant"),void n("Cannot unmute others");h.debug("[CircuitCallControlSvc]: Unmute participant in existing RTC session. userId =",r);var o={rtcSessionId:i.callId,usersIds:[r],muted:!1};W.muteParticipant(o,function(e){A.$apply(function(){e?(h.warn("[CircuitCallControlSvc]: Failed to unmute participant"),n("res_UnmuteParticipantFailed")):(i.remotelyMuted=!1,Ut(i),n())})})},this.toggleMuteParticipant=function(e,t,n){if(n=n||function(){},!_e(e))return h.warn("[CircuitCallControlSvc]: toggleMuteParticipant - There is no local call"),void n("Call invalid");t&&t.userId?t.muted?x.unmuteParticipant(e,t,n):x.muteParticipant(e,t,n):(h.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),n("Participant invalid"))},this.stopRingingTone=function(e){var t=$e(e);t?(t.ringToneStopped=!0,h.debug("[CircuitCallControlSvc]: stopRingingTone for call with callId = ",e),O.publish("/call/ringingTone/stop",[e])):h.warn("[CircuitCallControlSvc]: stopRingingTone - incoming call not found: ",e)},this.endActiveCall=function(e){e=e||function(){},q?x.endCall(q.callId,e):e("No active call")},this.startRecording=function(e,t,n){if(!q)return h.warn("[CircuitCallControlSvc]: startRecording - There is no local call"),void e("No active call");var i={audio:!0,video:!1,desktop:!!t},r={convId:q.convId,rtcSessionId:q.callId,mediaTypes:i,videoLayout:n};W.startRecording(r,function(t){A.$apply(function(){e&&e(t)})})},this.stopRecording=function(e){if(!q)return h.warn("[CircuitCallControlSvc]: stopRecording - There is no local event call"),void e("No active call");var t={convId:q.convId,rtcSessionId:q.callId};W.stopRecording(t,function(t){A.$apply(function(){e&&e(t)})})},this.switchRecordingLayout=function(e,t){if(!q)return h.warn("[CircuitCallControlSvc]: switchRecordingLayout - There is no local call"),void t("No active call");if(!e||!e.layoutName)return h.warn("[CircuitCallControlSvc]: switchRecordingLayout - Missing or invalid videoLayout"),void t("Invalid videoLayout");var n={rtcSessionId:q.callId,videoLayout:e};W.switchRecordingLayout(n,function(e){A.$apply(function(){t&&t(e)})})},this.submitCallQualityRating=function(e,t,n){if(!e||!e.hasOwnProperty("rating")||!t)return h.warn("[CircuitCallControlSvc]: submitCallQualityRating - Missing rating or call data"),void(n&&n("No rating data"));Object.assign(e,t),W.submitCallQualityRating([e],function(e){A.$apply(function(){n&&n(e),e||(h.debug("[CircuitCallControlSvc]: Publish /call/rated event"),O.publish("/call/rated"))})})},this.raiseQuestion=function(e,t,n){if(!q||!q.isLarge)return h.warn("[CircuitCallControlSvc]: raiseQuestion - There is no local event call"),void n("No active event");var i={convId:q.convId,rtcSessionId:q.callId,question:e,displayName:A.localUser.displayName,isAnonymous:!!t};W.raiseQuestion(i,function(e,t){A.$apply(function(){n&&n(e,t)})})},this.inviteToStage=function(e,t){if(!q||!q.isLarge)return h.warn("[CircuitCallControlSvc]: inviteToStage - There is no local event call"),void t("No active event");var n={convId:q.convId,rtcSessionId:q.callId,questionNumber:e,allowedMediaTypes:[a.RealtimeMediaType.AUDIO,a.RealtimeMediaType.VIDEO,a.RealtimeMediaType.DESKTOP_SHARING]};W.inviteToStage(n,function(e){A.$apply(function(){t&&t(e)})})},this.inviteToStageAnswer=function(e,t,n){if(!q||!q.isLarge)return h.warn("[CircuitCallControlSvc]: inviteToStageAnswer - There is no local event call"),void n("No active event");var i={convId:q.convId,rtcSessionId:q.callId,questionNumber:e,isAccepted:!!t};t&&oe&&(h.debug("[CircuitCallControlSvc]: inviteToStageAnswer - force renewal of turn credentials"),oe.expirationTimestamp=0),W.inviteToStageAnswer(i,function(i){A.$apply(function(){!i&&t?x.addAudio(q.callId,function(t){t?(h.debug("[CircuitCallControlSvc]: inviteToStageAnswer - Unable to access a microphone, sending decline"),x.inviteToStageAnswer(e,!1),t="res_AccessToAudioInputDeviceFailed"):x.unmuteLocally(),n&&n(t)}):n&&n(i)})})},this.inviteToStageCancel=function(e,t){if(!q||!q.isLarge)return h.warn("[CircuitCallControlSvc]: inviteToStageCancel - There is no local event call"),void t("No active event");var n={convId:q.convId,rtcSessionId:q.callId,questionNumber:e};W.inviteToStageCancel(n,function(e){A.$apply(function(){t&&t(e)})})},this.removeFromStage=function(e,t){if(!q||!q.isLarge)return h.warn("[CircuitCallControlSvc]: removeFromStage - There is no local event call"),void t("No active event");var n={convId:q.convId,rtcSessionId:q.callId,userToRemoveId:e||A.localUser.userId};W.removeFromStage(n,function(e){A.$apply(function(){t&&t(e)})})},this.getQuestions=function(e,t,n){if(!q||!q.isLarge)return h.warn("[CircuitCallControlSvc]: getQuestions - There is no local event call"),void n("No active event");var i={convId:q.convId,rtcSessionId:q.callId,startQuestionNumber:e,numberOfQuestions:t};W.getQuestions(i,function(e,t){A.$apply(function(){n&&n(e,t)})})},this.updateQuestionState=function(e,t,n){if(!q||!q.isLarge)return h.warn("[CircuitCallControlSvc]: updateQuestionState - There is no local event call"),void n("No active event");var i={convId:q.convId,rtcSessionId:q.callId,questionNumber:e,newQuestionState:t};W.updateQuestionState(i,function(e,t){A.$apply(function(){n&&n(e,t)})})},this.openCurtain=function(e){if(!q||!q.isLarge)return h.warn("[CircuitCallControlSvc]: openCurtain - There is no local event call"),void e("No active event");var t={convId:q.convId,rtcSessionId:q.callId};W.openCurtain(t,function(t){A.$apply(function(){e&&e(t)})})},this.closeCurtain=function(e,t,n,i){if(!q||!q.isLarge)return h.warn("[CircuitCallControlSvc]: closeCurtain - There is no local event call"),void i("No active event");var r={curtainState:e};t&&(r.message=t),n&&(r.pauseDuration=n);var o={convId:q.convId,rtcSessionId:q.callId,curtain:r};W.closeCurtain(o,function(e){A.$apply(function(){i&&i(e)})})},this.getNodeState=function(e,t,n){var i={convId:"noCall",nodeType:e,tenantId:t||""};W.getNodeState(i,function(e,t){A.$apply(function(){e&&h.error("[CircuitCallControlSvc]: Failed to get node(s). ",e),n&&n(e,t)})})},this.canSendWebRTCDigits=function(){return q&&q.sessionCtrl.canSendDTMFDigits()},this.sendDigits=function(e,t,n){return n=n||function(){},_e(e)?t?/^[\d#\*,]+$/.exec(t)?void function(e,t,n){var i=_e(e);if(!i)return h.info("[CircuitCallControlSvc]: sendDTMFDigits - The given call ID does not match the local call"),void n("Invalid callId");h.info("[CircuitCallControlSvc]: Sending DTMF Digits=",t),i.sessionCtrl.sendDTMFDigits(t)||(h.error("[CircuitCallControlSvc]: Cannot send DTMF digits"),n("res_CannotSendDTMF"))}(e,t,n):(h.error("[CircuitCallControlSvc]: Digits cannot be sent: "+t+" (Allowed: 0-9,#,*)"),void n("res_InvalidDtmf")):void n("res_InvalidDtmf"):(h.warn("[CircuitCallControlSvc]: sendDigits - There is no local call"),void n("Call not valid"))},this.disableIncomingVideo=function(e){q&&q.sameAs(e)&&(h.debug("[CircuitCallControlSvc]: Disabling remote incoming video. Call ID=",q.callId),q.sessionCtrl.disableIncomingVideo())},this.enableIncomingVideo=function(e){q&&q.sameAs(e)&&(h.debug("[CircuitCallControlSvc]: Enabling remote incoming video. Call ID=",q.callId),q.sessionCtrl.enableIncomingVideo())},this.toggleParticipantPointer=function(e){var t=_e(e);t?t.pointer&&t.pointer.isSupported?(t.pointer.isEnabled=!t.pointer.isEnabled,Ve({callId:t.callId,transactionId:t.transactionId,mediaType:t.localMediaType})):h.warn("[CircuitCallControlSvc]: toggleParticipantPointer - Local call does not support participant pointer"):h.warn("[CircuitCallControlSvc]: toggleParticipantPointer - There is no local call")},this.findCall=Ne,this.findLocalCallByCallId=_e,this.findActivePhoneCall=he,this.findHeldPhoneCall=Oe,this.sendParticipantPointer=function(e,t,n){var i={content:{type:"PARTICIPANT_POINTER",x:t,y:n,userId:A.localUser.userId},destUserId:e};Y.sendDesktopAppRequest(i,function(e){e?h.error("[CircuitCallControlSvc]: Error sending participant pointer coordinates: ",e):h.info("[CircuitCallControlSvc]: Successfully sent participant pointer coordinates.")})},this.sendParticipantDrawing=function(e,t,n){var i={content:{type:"PARTICIPANT_DRAWING",points:t,options:n||{},userId:A.localUser.userId},destUserId:e};Y.sendDesktopAppRequest(i,function(e){e?h.error("[CircuitCallControlSvc]: Error sending participant drawing coordinates: ",e):h.info("[CircuitCallControlSvc]: Successfully sent participant drawing coordinates.")})},this.removeCallFromList=fe,this.isSecondCall=function(){return q||Z.length>=1||!Q.isEmpty()},this.updateActiveCallMediaDevices=function(){q&&q.updateMediaDevices()},this.addSimulatedParticipants=function(){var e=5e4,t=x.getActiveCall();if(t&&!t.isDirect&&t.isMocked&&!(t.participants.length>0)){var n=function(){t.isPresent()&&0!==t.participants.length&&(ot(t,t.participants[0].userId),t.participants.length>0&&g(n,2500))},i=function(r){var o,c=be((o={isSimulated:!0,userId:(e+r).toString(),mediaTypes:[a.RealtimeMediaType.AUDIO],muted:!1},r>0&&!(r%6)?(o.participantType=a.RTCParticipantType.MEETING_POINT,o.userDisplayName="CMR ("+r+")"):(o.participantType=a.RTCParticipantType.SESSION_GUEST,o.userDisplayName=[Math.floor(r/10),r%10].join(" "),r%9||o.mediaTypes.push(a.RealtimeMediaType.VIDEO)),o));!t.isMeetingPointInvited&&c.isCMP&&(c.isMeetingPointInvitee=!0,c.cmrData={},t.setMeetingPointInviteState(!0),Pt(t.callId));var l=it(t,c,s.ParticipantState.Active);O.publish("/call/participant/added",[t.callId,l]),O.publish("/call/participant/joined",[t,l]),pe(),r<19?g(function(){t.isPresent()&&i(r+1)},2500):g(n,12e4)};i(0),t.setState(s.CallState.Active),ve(t)}},this.hasScreenControlFeature=Ie,this.canStartScreenShare=function(e){var t=_e(e);if(!t)return h.warn("[CircuitCallControlSvc]: canStartScreenShare - There is no local call"),!1;if(!t.hasRemoteScreenShare())return!0;if(!t.participants.some(function(e){return e.isModerator&&e.mediaType&&e.mediaType.desktop}))return!0;if(A.isSessionGuest||t.isGuestInvite)return!1;var n=y.getConversationFromCache(t.convId);return!!n&&n.userIsModerator(A.localUser)},this.addConferenceAsGuest=function(e){var t=le(e);if(t&&t.isTemporary&&t.guestToken){h.debug("[CircuitCallControlSvc]: Create placeholder remote call for temporary guest conversation with convId = ",t.convId);var n=new u(t);n.setState(s.CallState.NotStarted),n.guestToken=t.guestToken,Se(n),t.call=n,Re(t),ve(n)}else h.warn("[CircuitCallControlSvc]: addConferenceAsGuest - No temporary conversation or guest token is missing")},this.removeConferenceAsGuest=function(e){var t=Ne(e);if(t)if(t.isRemote){var n=le(t.convId);n&&n.isTemporary?(ge(t),h.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),O.publish("/conversation/temporary/ended",[n])):h.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - No temporary conversation")}else h.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - Cannot remove temporary conversation with active call");else h.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - Could not find call")},this.testCandidatesCollection=function(e){return e?(h.debug("[CircuitCallControlSvc]: Test ICE candidates collection with TURN..."),new m(function(e,t){var n="echo_"+A.localUser.clientId,i={convId:A.isSessionGuest&&A.localUser.conversationId||n,rtcSessionId:n,ownerId:A.localUser.userId,isTelephonyConversation:!1,mediaNode:T.mediaNode};h.debug("[CircuitCallControlSvc]: testIceCandidates - Get TURN servers"),W.prepareSession(i,function(i,r){if(i)return h.error("[CircuitCallControlSvc]: Failed to prepare session data. ",i),void t(i);if(!r||!r.length)return W.terminateRtcCall(n,a.DisconnectCause.HANGUP),h.error("[CircuitCallControlSvc]: Failed to prepare session data. No TURN servers."),void t("No TURN servers");var o=r[0];h.debug("[CircuitCallControlSvc]: testIceCandidates - TURN servers: ",o.turnServer),lt(o).then(function(t){W.terminateRtcCall(n,a.DisconnectCause.HANGUP,function(){e(t)})}).catch(function(e){W.terminateRtcCall(n,a.DisconnectCause.HANGUP,function(){t(e)})})})})):(h.debug("[CircuitCallControlSvc]: Test ICE candidates collection without TURN..."),lt())},this.addCallToList=Se,this.moveOsBizCalls=function(e,t){if(h.debug("[CircuitCallControlSvc]: Move oldCall: "+e.callId+" to newCall: "+t.callId),e.isOsBizFirstCall){var n=t.atcCallInfo;e.atcCallInfo=n,e.setPeerUser(e.atcCallInfo.peerDn,e.atcCallInfo.peerName),e.setCstaState(s.CstaCallState.Active),e.setState(s.CallState.Active),e.isOsBizFirstCall=!1,ge(t)}else ge(e),t.isOsBizFirstCall=!1,t.isOsBizSecondCall=!1},this.findOsBizFirstCall=function(){return K.find(function(e){return e.isOsBizFirstCall})||null},this.findOsBizSecondCall=function(){return K.find(function(e){return e.isOsBizSecondCall})||null},this.getCallToPickup=function(){return se},this.getConferenceParticipants=function(e){return new m(function(t,n){h.debug("[CircuitCallControlSvc]: Get participants for call with callId = ",e);var i=Ne(e);return i?i.isRemote?void W.getSession(e,function(e,i){A.$apply(function(){if(e||!i)h.warn("[CircuitCallControlSvc] Error retrieving RTC session. Err: ",e),n(e);else{var r=i.participants.map(be),o=r.filter(function(e){return e.noData}).map(function(e){return e.userId});D.getUsersByIds(o,function(){t(r)})}})}):(h.warn("[CircuitCallControlSvc]: This is a local call. Return local participants."),void t(i.participants)):(h.warn("[CircuitCallControlSvc]: Call does not exist"),void n("Call does not exist"))})},this},t}(e=function(e){"use strict";var t=e.ClientApiHandlerSingleton,n=e.Constants,i=e.Proto,r=e.Utils,o=e.WebRTCAdapter,a=e.RtcSessionController;return e.DeviceDiagnosticSvcImpl=function(e,s,c,l,d){c.debug("New Service: DeviceDiagnosticSvc");var u=3e3,C=6e4,E=5e4,T=t.getInstance(),p=[],S=!(!d||e.isSessionGuest);function I(){if(S)if(0!==p.length){var e=JSON.stringify(p);if(e.length>C){c.warn("[DeviceDiagnosticSvc]: Stored device diagnostics exceeded max size. Discard old data.");var t="",n=e.length-E;p.some(function(i,r){return(t+=JSON.stringify(i)).length>n&&(c.warn("[DeviceDiagnosticSvc]: Number of discarded records: ",r+1),p.splice(0,r+1),e=JSON.stringify(p),!0)})}d.setString(d.keys.RTC_CLIENT_INFOS,e)}else d.removeItem(d.keys.RTC_CLIENT_INFOS)}function f(e){e&&e.joinDelayTimer&&(s.cancel(e.joinDelayTimer),e.joinDelayTimer=null)}function R(e){return!(!e||!e.deviceDiagnostics)&&(e.deviceDiagnostics.data.actionInfo.some(function(e){return!e.complete})||!e.deviceDiagnostics.iceGatheringFinished)}function v(e){if(e&&e.deviceDiagnostics){c.debug("[DeviceDiagnosticSvc]: Force finish device diagnostics");var t=e.deviceDiagnostics;f(t),t.joinDelayed&&_(e),A(e)}}function A(e){e&&e.deviceDiagnostics&&(c.debug("[DeviceDiagnosticSvc]: Clear device diagnostics"),f(e.deviceDiagnostics),delete e.deviceDiagnostics)}function g(e){S&&(c.debug("[DeviceDiagnosticSvc]: Store device diagnostics to send when client reconnects"),p.push(e),I())}function _(t){if(t&&t.deviceDiagnostics){var o={sdpOrigin:t.sdpOrigin||null,userId:e.localUser.userId,convId:t.convId,clientInfoType:n.RtcClientInfoType.DEVICE_DIAGNOSTICS,reason:n.RtcClientInfoReason.JOIN_DELAY,timestamp:Date.now(),sessionId:t.callId,deviceDiagnostics:r.shallowCopy(t.deviceDiagnostics.data)};t.instanceId&&(o.instanceId=t.instanceId),A(t),c.debug("[DeviceDiagnosticSvc]: Sending device diagnostics..."),T.sendClientInfo([o],function(e){e&&(c.debug("[DeviceDiagnosticSvc]: Failed to send device diagnostics. ",e),i.isOfflineFailure(e)&&g(o))})}else c.debug("[DeviceDiagnosticSvc]: sendDeviceDiagnostics - Nothing to send")}function N(t){if(!t||!t.label||"string"!=typeof t.label)return"";var n=t.label;return n.startsWith("res_")?e.i18n.localize(n)||"":n}return S&&l.subscribe("/conversations/loadComplete",function(){c.debug("[DeviceDiagnosticSvc]: Received /conversations/loadComplete event"),function(){if(p.length>0){var e=p;p=[],d.removeItem(d.keys.RTC_CLIENT_INFOS),c.info("[DeviceDiagnosticSvc]: Send offline join failures to backend"),T.sendClientInfo(e,function(t){t?(c.error("[DeviceDiagnosticSvc]: Failed to send offline join failures. ",t),i.isOfflineFailure(t)&&(Array.prototype.unshift.apply(p,e),I())):c.debug("[DeviceDiagnosticSvc]: Sent offline join failures")})}}()}),this.startDiagnostics=function(e){e&&!e.isRemote&&(c.info("[DeviceDiagnosticSvc]: Start diagnostics collection for callId = ",e.callId),e.deviceDiagnostics=e.deviceDiagnostics||{data:{actionInfo:[]}})},this.startJoinDelayTimer=function(e){if(e&&e.deviceDiagnostics){c.debug("[DeviceDiagnosticSvc]: Start join delay timer for callId = ",e.callId);var t=e.deviceDiagnostics;f(t),t.joinDelayTimer=s(function(){t.joinDelayTimer=null,function(e){if(e&&e.deviceDiagnostics){var t=e.deviceDiagnostics;if(c.debug("[DeviceDiagnosticSvc]: Join action delayed, preparing device diagnostics"),f(t),t.joinDelayed=!0,"undefined"!=typeof DeviceStatistics){var n=DeviceStatistics.getStatistics();c.info("[DeviceDiagnosticSvc]: Received native device diagnostics: ",n),t.data.usedRAMApp=n.usedRAMApp,t.data.availableRAMApp=n.availableRAMApp,t.data.usedRAMDevice=n.usedRAMDevice,t.data.availableRAMDevice=n.availableRAMDevice,t.data.virtualMemory=n.virtualMemory,t.data.usagePerCore=n.usagePerCore,t.data.numberOfCores=n.numberOfCores,t.data.networkType=n.networkType}}}(e)},u),t.joinDelayed=!1,t.waitingToSend=!1,t.iceGatheringFinished=!1,e.deviceDiagnostics=t}},this.createActionInfo=function(e,t){if(c.debug("[DeviceDiagnosticSvc]: Create action info ",t),!e||!e.deviceDiagnostics||!t)return null;var i={actionType:t};switch(t){case n.RtcDiagnosticsAction.SDP_ANSWER:case n.RtcDiagnosticsAction.SDP_CONNECTED:case n.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES:i.type=n.RtcActionInfoType.EVENT,i.timestampEvent=Date.now();break;default:i.type=n.RtcActionInfoType.REQUEST_RESPONSE,i.timestampRequest=Date.now()}return e.deviceDiagnostics.data.actionInfo.push(i),i},this.finishActionInfo=function(e,t){t&&(c.debug("[DeviceDiagnosticSvc]: Finish action info ",t.actionType),t.complete=!0,t.type===n.RtcActionInfoType.REQUEST_RESPONSE&&(t.timestampResponse=Date.now()),e&&e.deviceDiagnostics&&(t.isEndOfCandidates&&(e.deviceDiagnostics.iceGatheringFinished=!0,c.debug("[DeviceDiagnosticSvc]: Ice gathering finished")),e.deviceDiagnostics.waitingToSend&&!R(e)&&v(e)))},this.finishDeviceDiagnostics=function(e){if(e&&e.deviceDiagnostics){c.debug("[DeviceDiagnosticSvc]: Finish device diagnostics");var t=e.deviceDiagnostics;f(t),t.joinDelayed?R(e)?(t.waitingToSend=!0,c.debug("[DeviceDiagnosticSvc]: Send device diagnostic delayed")):_(e):A(e)}},this.forceFinishDeviceDiagnostics=v,this.storeClientInfo=g,this.sendCallConnected=function(t){c.debug("[DeviceDiagnosticSvc]: Send call connected event to backend");var i=("undefined"!=typeof DeviceStatistics?DeviceStatistics.getStatistics():null)||{};o.getMediaSources(function(o,s,l){var d=r.selectMediaDevice(o,a.recordingDevices);i.recordingDevice=N(d),d=r.selectMediaDevice(l,a.playbackDevices),i.playbackDevice=N(d),i.negotiationInfos=[];var u={sdpOrigin:t.sdpOrigin||null,userId:e.localUser.userId,convId:t.convId,clientInfoType:n.RtcClientInfoType.CALL_CONNECTED,reason:n.RtcClientInfoReason.CALL_CONNECTED,timestamp:Date.now(),sessionId:t.callId,deviceDiagnostics:i};T.sendClientInfo([u],function(e){e&&c.debug("[DeviceDiagnosticSvc]: Failed to send call connected event. ",e)})})},S&&(p=d.getObjectSync(d.keys.RTC_CLIENT_INFOS)||[],Array.isArray(p)||(p=[]),I()),this},e}(e=function(e){"use strict";var t=e.Enums.AtcInfoMessage,n=e.Enums.AtcMessage,i=e.Enums.AtcRegistrationState,r=e.ClientApiHandlerSingleton,o=e.Constants,a=e.DefaultAvatars,s=e.PhoneNumberFormatter,c=e.RoutingOptions,l=e.UserToUserHandlerSingleton,d=e.Utils;return e.AtcRegistrationSvcImpl=function(u,C,E,T,p,S){E.debug("New Service: AtcRegistrationSvc");var I,f=64,R=8,v=8,A=18e4,g=r.getInstance(),_=l.getInstance(),N={},m=i.Disconnected,h=!1,O=null,D=null,y={},P=null,b=R,U=null,L={state:o.TrunkState.DOWN},M=null,w=!1,G=null,H=!1;I=d.isMobile()?o.DeviceType.MOBILE:e.isElectron?o.DeviceType.APPLICATION:o.DeviceType.WEB;var k=!1,V="cFC1",F=!1;function B(e){e!==m&&(m=e,E.info("[AtcRegistrationSvc]: Publish /atcRegistration/state event. State =",e),T.publish("/atcRegistration/state",[e]),u.localUser.isRegisterTC&&e!==i.Registering&&z(L))}function x(e){return e.state!==o.TrunkState.DOWN&&O!==o.TrunkState.DOWN}function W(){return!!u.localUser.telephonyAvailable!=(!!u.localUser.callerId||!!u.localUser.phoneNumber)}function Y(e){(function(e){return!!e&&(e===o.ReturnCode.FAILED_TO_SEND||e===o.ReturnCode.REQUEST_TIMEOUT||503===e.code||408===e.code)})(e)&&p.isRegistered()&&m===i.Registering&&(E.info("[AtcRegistrationSvc]: Retry ATC registration in "+b+" seconds"),P=C(function(){P=null,b<f&&(b=Math.min(2*b,f)),K()},1e3*b)),B(i.Unregistered)}function K(){var e={content:{type:"REGISTER",phoneNumber:u.localUser.registerNumber,reroutingPhoneNumber:d.cleanPhoneNumber(u.localUser.reroutingPhoneNumber),onsHash:u.localUser.onsSipAuthenticationHash||void 0,ondHash:u.localUser.ondSipAuthenticationHash||void 0,routeToDesk:u.localUser.selectedRoutingOption===c.DeskPhone.name&&!u.localUser.callForwardingEnabled,tcPool:u.localUser.associatedTelephonyTrunkGroupId,pbxCallLog:!0,deviceType:I,userId:u.localUser.userId,conversationId:M.convId,rtcSessionId:M.rtcSessionId,lastItemTime:M.lastItemModificationTime,renewRegistration:k||void 0,sTC:u.localUser.isSTC||void 0},destUserId:u.localUser.associatedTelephonyUserID,keysToOmitFromLogging:["content.onsHash","content.ondHash"]};C.cancel(P),P=null,N.phoneNumber=u.localUser.registerNumber,N.associatedTelephonyUserID=u.localUser.associatedTelephonyUserID,N.associatedTelephonyTrunkGroupId=u.localUser.associatedTelephonyTrunkGroupId,N.reroutingPhoneNumber=d.cleanPhoneNumber(u.localUser.reroutingPhoneNumber),N.onsSipAuthenticationHash=u.localUser.onsSipAuthenticationHash,N.ondSipAuthenticationHash=u.localUser.ondSipAuthenticationHash,G=u.localUser.selectedRoutingOption,H=u.localUser.callForwardingEnabled,u.localUser.noCallLog=!1,B(i.Registering),E.info("[AtcRegistrationSvc]: Registering with ATC, phoneNumber: "+N.phoneNumber+", associatedTelephonyUserID: "+N.associatedTelephonyUserID),_.sendAtcRequest(e,function(e,r){u.$apply(function(){if(h&&!M.call)return E.info("[AtcRegistrationSvc]: There was a configuration update while registering. Need to register again"),h=!1,void(e||!r||r.err?K():(w=!0,q()));if(e||r&&r.err)return e=e||r.err,E.error("[AtcRegistrationSvc]: Register with ATC failed with error: ",e),void Y(e);if(r&&r.configurationData){if(E.info("[AtcRegistrationSvc]: Received ATC configuration data: ",r.configurationData),E.debug("[AtcRegistrationSvc]: Registration refresh will be handled by access server"),k=!1,u.localUser.isSTC)return B(i.Registered),j(o.TrunkState.UP),void(u.localUser.stcTransferAllowed=r.capabilities&&r.capabilities.includes(o.StcCapabilities.STC_TRANSFER));b=R,N.configurationData=r.configurationData,N.reroutingPhoneNumber=r.configurationData.cell,N.capabilities=r.capabilities,u.localUser.reroutingPhoneNumber=s.format(r.configurationData.cell),u.localUser.vmNumber=r.configurationData.vm,u.localUser.pbxCallForwardToVoiceMailSupported=!!r.configurationData.supportedFeatures&&r.configurationData.supportedFeatures.includes(V),u.localUser.isOSV=r.configurationData.pbx&&"OSV"===r.configurationData.pbx,u.localUser.PBXCallLogSupported=N.capabilities&&N.capabilities.includes(o.AtcCapabilities.PBX_CALL_LOG),B(i.Registered),u.localUser.PBXCallLogSupported&&!u.localUser.noCallLog&&(a=!0,c={content:{type:n.INFO,phoneNumber:u.localUser.cstaNumber,info:{type:t.ENABLE_PBX_CALL_LOG,status:a}},destUserId:u.localUser.associatedTelephonyUserID},_.sendAtcRequest(c)),j(o.TrunkState.UP)}else B(i.Unregistered);var a,c})})}function q(){if(E.info("[AtcRegistrationSvc]: Unregister with ATC"),m!==i.Unregistered&&m!==i.Disconnected){var e={content:{type:"UNREGISTER",phoneNumber:N.phoneNumber},destUserId:N.associatedTelephonyUserID};B(i.Unregistered),k=u.localUser.associatedTelephonyUserID!==N.associatedTelephonyUserID,N.associatedTelephonyUserID="",_.sendAtcRequest(e,function(e){u.$apply(function(){e?E.error("[AtcRegistrationSvc]: Unregister with ATC failed with: ",e):E.info("[AtcRegistrationSvc]: Unregistered successfully with ATC"),w&&(K(),w=!1)})})}else E.debug("[AtcRegistrationSvc]: The client is not registered with ATC")}function j(e){e!==O&&u.$apply(function(){O=e,E.debug("[AtcRegistrationSvc]: Set trunk state to ",O);var t=d.shallowCopy(L);t.state=e,Q(t)})}function Q(e){if(e){if(u.localUser.isRegisterTC)if(e.state===o.TrunkState.DOWN)q();else if(L.state===o.TrunkState.DOWN&&e.state===o.TrunkState.UP)return L=e,m===i.Registering?(E.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(h=!0)):void function(){C.cancel(P),P=null;var e=d.randomNumber(0,v);E.info("[AtcRegistrationSvc]: Delay ATC registration by "+e+" seconds"),P=C(function(){P=null,L.state===o.TrunkState.UP&&m===i.Unregistered&&K()},1e3*e)}();z(e)}}function z(e){e&&(L=e,u.localUser.isRegisterTC?(L.state=m===i.Registered?o.TrunkState.UP:o.TrunkState.DOWN,L.defaultCallerId=null,L.isGTCEnabled=!0):L.defaultCallerId=L.defaultCallerId||null,L.telephonyAvailableForTenant=!!e.isGTCEnabled,L.telephonyAvailableForUser=!(!e.isGTCEnabled||!u.localUser.callerId&&!L.defaultCallerId),L.conferenceDialOutAvailable=L.telephonyAvailableForTenant&&x(L),L.phoneCallsAvailable=L.telephonyAvailableForUser&&x(L),E.info("[AtcRegistrationSvc]: Publish /telephony/data event. data = ",L),T.publish("/telephony/data",[L]),L.state!==o.TrunkState.DOWN&&L.state!==o.TrunkState.UP||S.getTelephonyConversationPromise().then(function(e){e&&(x(L)?e.avatar=a.TELEPHONY:e.avatar=a.TELEPHONY_DISABLED,M=e)}).catch(function(){E.debug("[AtcRegistrationSvc]: No telephony conversation found")}))}function X(e){E.info("[AtcRegistrationSvc]: Getting telephony data"),u.telephonyEnabled?g.getTelephonyData(function(t,n){u.$apply(function(){t?t!==o.ReturnCode.NO_RESULT&&(E.error("[AtcRegistrationSvc]: Error getting telephony data: ",t),e&&e(t)):(Q(n),e&&e(null,L))})}):(z({state:o.TrunkState.DOWN}),e&&e(null,L))}function J(e){if(D&&D!==u.localUser.associatedTelephonyUserID&&(y[D]||g.unsubscribePresence([D]),D=null,k=!0),u.localUser.associatedTelephonyUserID&&D!==u.localUser.associatedTelephonyUserID&&(D=u.localUser.associatedTelephonyUserID,U&&(C.cancel(U),U=null),u.localUser.isRegisterTC&&y[D]||g.subscribePresence([u.localUser.associatedTelephonyUserID],function(e,t){if(e)return E.error("[AtcRegistrationSvc]: Unable to subscribe to associated TC presence"),void(D=null);t&&t.length>0&&!u.localUser.isRegisterTC&&j(t[0].state===o.PresenceState.AVAILABLE?o.TrunkState.UP:o.TrunkState.DOWN)})),!u.localUser.isRegisterTC||!u.localUser.registerNumber)return m===i.Registered?(E.debug("[AtcRegistrationSvc]: Cannot register without an associated ATC or STC or assigned phoneNumber"),q(),X()):(e||W())&&X(),void B(i.Disconnected);if(H!==u.localUser.callForwardingEnabled&&(H=u.localUser.callForwardingEnabled,u.localUser.selectedRoutingOption===c.DeskPhone.name&&$()),u.localUser.associatedTelephonyUserID!==N.associatedTelephonyUserID||u.localUser.registerNumber!==N.phoneNumber||d.cleanPhoneNumber(u.localUser.reroutingPhoneNumber)!==N.reroutingPhoneNumber||u.localUser.onsSipAuthenticationHash!==N.onsSipAuthenticationHash||u.localUser.ondSipAuthenticationHash!==N.ondSipAuthenticationHash||m!==i.Registered&&m!==i.Registering){if(m===i.Registering)return E.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(h=!0);if(m===i.Registered){if(E.debug("[AtcRegistrationSvc]: Client is already registered and configuration has changed."),M.call)return E.debug("[AtcRegistrationSvc]: There is an active telephony call, wait..."),void(h=!0);w=!0,q()}if(!w){if(!M)return E.debug("[AtcRegistrationSvc]: Get telephony conversation before proceeding with ATC register"),S.getTelephonyConversationPromise().then(function(e){M=e,E.debug("[AtcRegistrationSvc]: Got telephony conversation. Proceed with ATC register."),J()}).catch(function(){E.debug("[AtcRegistrationSvc]: No telephony conversation found")}),void(!e&&W()&&X());m!==i.ForcedUnregistered&&K()}}else E.debug("[AtcRegistrationSvc]: Client is already registered or registering with ATC and the associatedTelephonyUserID is the same")}function $(){if(m===i.Registered){var e=u.localUser.selectedRoutingOption===c.DeskPhone.name&&!u.localUser.callForwardingEnabled;E.debug("[AtcRegistrationSvc]: Send SET_ROUTE_TO_DESK event to ATC. status = ",e);var r={content:{type:n.INFO,phoneNumber:u.localUser.cstaNumber,info:{type:t.SET_ROUTE_TO_DESK,status:e}},destUserId:u.localUser.associatedTelephonyUserID};_.sendAtcRequest(r)}}function Z(e,t){if(U&&(C.cancel(U),U=null),u.localUser.associatedTelephonyTrunkGroupId){var n=t||d.randomNumber(0,A);E.debug("[AtcRegistrationSvc]: Renew associated telephony connector in "+n/1e3+" seconds"),U=C(function(){U=null,E.debug("[AtcRegistrationSvc]: Renew associated telephony connector"),g.renewAssociatedTelephonyUser(u.localUser.associatedTelephonyUserID,function(t){t&&(E.error("[AtcRegistrationSvc]: Failed to renew associated telephony connector. ",t),e&&Z(!0,A))})},n)}else E.debug("[AtcRegistrationSvc]: User is not associated to any pool. Ignore the TC reassignment request.")}function ee(){m===i.Registered?M.call&&!M.call.isRemote?E.info("[AtcRegistrationSvc]: There is an active call, ignoring ATC re-register for now. If error persists on server another event will come later."):u.$apply(function(){E.info("[AtcRegistrationSvc]: New registration must be triggered."),w=!0,q()}):E.info("[AtcRegistrationSvc]: Client is not registered, ignoring failed refresh on server.")}return T.subscribe("/localUser/update",function(){p.isRegistered()&&S.isConversationsLoadComplete()&&(E.debug("[AtcRegistrationSvc]: Received /localUser/update event"),J())}),T.subscribe("/conversations/loadComplete",function(){E.debug("[AtcRegistrationSvc]: Received /conversations/loadComplete event"),J(!0)}),T.subscribe("/registration/state",function(e){S.isConversationsLoadComplete()&&(E.debug("[AtcRegistrationSvc]: Received /registration/state event"),e!==RegistrationState.LoggingOut&&e!==RegistrationState.Reconnecting&&e!==RegistrationState.Disconnected||(C.cancel(P),P=null,C.cancel(U),U=null,C(u.localUser.isRegisterTC?q:function(){L.state=o.TrunkState.DOWN,D=null,z(L)})))}),T.subscribe("/conversation/update",function(e){if(e.isTelephonyConv){if(E.debug("[AtcRegistrationSvc]: Received /conversation/update event"),M=e,!h&&!F)return;if(e.call)E.debug("[AtcRegistrationSvc]: There is still an active telephony call, wait...");else if(m!==i.Registering){if(F)return B(i.ForcedUnregistered),void(F=!1);h=!1,w=!0,q()}}}),T.subscribe("/user/settings/update",function(){S.isConversationsLoadComplete()&&(E.debug("[AtcRegistrationSvc]: Received /user/settings/update event"),G!==u.localUser.selectedRoutingOption&&(G=u.localUser.selectedRoutingOption,$()))}),g.on("User.TELEPHONY_DATA",function(e){u.$apply(function(){try{E.debug("[AtcRegistrationSvc]: Received User.TELEPHONY_DATA with data: ",e.data),e.data&&(e.data.isGTCEnabled=!0,Q(e.data))}catch(e){E.error("[AtcRegistrationSvc]: Exception handling User.TELEPHONY_DATA event.",e)}})}),g.on("User.USER_PRESENCE_CHANGE",function(e){e.userId&&(e.userId===D&&(E.debug("[AtcRegistrationSvc]: Received User.USER_PRESENCE_CHANGE for associated TC. newState = ",e.newState),j(e.newState.state===o.PresenceState.AVAILABLE?o.TrunkState.UP:o.TrunkState.DOWN)),y[e.userId]&&(E.info("[AtcRegistrationSvc]: Publish /trunk/update event. newState = ",e.newState),T.publish("/trunk/update",[e.newState])))}),g.on("User.ATC_REFRESH_FAILED",function(){E.error("[AtcRegistrationSvc]: Received User.ATC_REFRESH_FAILED event."),ee()}),_.on("ATC.REFRESH_FAILED",function(){E.error("[AtcRegistrationSvc]: Received UserToUser.ATC.REFRESH_FAILED event."),ee()}),g.on("Account.TC_START_REASSIGNMENT",function(e){E.debug("[AtcRegistrationSvc]: Account.TC_START_REASSIGNMENT event");var t=e&&e.maxThrottlingTime||A;Z(!0,Math.max(t,3e4))}),_.on("ATC.INFO",function(e){E.debug("[AtcRegistrationSvc]: Received ATC.INFO with data = ",e),u.localUser&&e.hasOwnProperty("pbxCallLogStatus")&&(u.localUser.noCallLog=!!e.pbxCallLogStatus)}),_.on("ATC.START_REASSIGNMENT",function(){E.debug("[AtcRegistrationSvc]: Received ATC.START_REASSIGNMENT event"),Z(!1)}),_.on("ATC.UNREGISTERED",function(){E.error("[AtcRegistrationSvc]: Received UserToUser.ATC.UNREGISTERED event."),m===i.Registered?M.call&&!M.call.isRemote?(E.info("[AtcRegistrationSvc]: There is an active call, ignoring ATC Unregistered event for now."),F=!0):u.$apply(function(){B(i.ForcedUnregistered)}):E.info("[AtcRegistrationSvc]: Client is not registered, ignoring Unregistered event.")}),this.initAtcForSdk=function(){E.debug("[AtcRegistrationSvc]: initAtcForSdk"),I=o.DeviceType.SDK,J(!0)},this.atcState=function(){return m},this.getAtcRegistrationData=function(){return N.configurationData},this.atcUnregister=q,this.getTelephonyData=function(e){"function"==typeof e&&(m===i.Registering?e("ATC Registering"):e(null,L))},this.isExtendedAlertingSupported=function(){return!(!N||!N.capabilities)&&N.capabilities.includes(o.AtcCapabilities.EXTENDED_ALERTING)},this.isClearConnectionBusySupported=function(){return!(!N||!N.capabilities)&&N.capabilities.includes(o.AtcCapabilities.CLEAR_CONNECTION_BUSY)},this.subscribeConnectorPresence=function(e,t){(e=e.filter(function(e){return!y[e]})).length&&(E.debug("[AtcRegistrationSvc]: Subscribe for connectors presence. ",e),g.subscribePresence(e,function(e,n){u.$apply(function(){e?(E.error("[AtcRegistrationSvc]: Failed to subscribe to connectors presence. ",e),t&&t(e)):n&&(E.debug("[AtcRegistrationSvc]: Successfully subscribed for connectors presence"),n.forEach(function(e){y[e.userId]=!0}),t&&t(null,n))})}))},this.unsubscribeConnectorPresence=function(e,t){e?e=e.filter(function(e){return!!y[e]&&(delete y[e],e!==D)}):(e=Object.keys(y).filter(function(e){return e!==D}),y={}),e.length&&(E.debug("[AtcRegistrationSvc]: Unsubscribe for connectors presence. ",e),g.unsubscribePresence(e,t))},this.isPBXCallLogSupported=function(){return!(!N||!N.capabilities)&&N.capabilities.includes(o.AtcCapabilities.PBX_CALL_LOG)},this},e}(e=function(e){"use strict";var t=e.ChromeExtension,n=e.ExtensionConnHandlerSingleton,i=e.ScreenSharingController,r=e.Utils;return e.ExtensionSvcImpl=function(o,a,s,c,l,d,u,C){l.debug("New Service: ExtensionSvc");var E="circuitsandbox.net",T="beta.circuit.com",p="tandi.circuitsandbox.net",S="teams.univergeblue.com",I="bluebeta.circuit.com",f="1.2.1600",R=r.convertVersionToNumber(f),v="electron",A=Object.freeze({UNSUPPORTED_BROWSER:"UNSUPPORTED_BROWSER",UNSUPPORTED_EXT_VERSION:"UNSUPPORTED_EXT_VERSION",USER_CANCELLED_INSTALL:"USER_CANCELLED_INSTALL",INTERNAL_ERROR:"INTERNAL_ERROR"}),g=this,_="object"==typeof n?n.getInstance():null,N="",m=!0,h=e.isElectron?require("electron").ipcRenderer:null;function O(){var e="https://chrome.google.com/webstore/detail/";if(o.siemensAGUser)return e+="siemens-circuit-by-unify/mnkbplodbhpkiphfeldjmaoickanlanc",l.info("[ExtensionSvc]: Set URL to Siemens AG Circuit extension webstore link"),e;var t=C.getChromeExtensionId();return t?l.info("[ExtensionSvc]: Set URL using Extension ID set in global properties: ",t):(t=function(){var e;switch(s.location.hostname){case T:e="jafbhekoolndfieffjkikfbmekjppnec",l.info("[ExtensionSvc]: Set extension ID to Beta-Circuit extension: ",e);break;case E:e="ogdfpjnhdggplglemglldmioiblhkadm",l.info("[ExtensionSvc]: Set extension ID to Sandbox-Circuit extension: ",e);break;case p:e="gdgfgnopapmocggkadgfkjekdlcohmdl",l.info("[ExtensionSvc]: Set extension ID to T&I-Circuit extension: ",e);break;case S:case I:e="jhpcobccapenojpdohnfmhmdmppngdad",l.info("[ExtensionSvc]: Set extension ID to UNIVERGE BLUE TC extension: ",e);break;default:e="mhkbaognlahkdimlfcfhbeihldmjofgg",l.info("[ExtensionSvc]: Set extension ID to Circuit extension: ",e)}return e}(),l.info("[ExtensionSvc]: Set URL using Extension ID from host name: ",t)),e+=t}function D(e,t,n){return l.debug("[ExtensionSvc]: Invoke ExtensionConnHandler API: ",e),_?_.isExtensionRunning()?(n&&(t=t||[]).push(function(e,t){o.$apply(function(){n(e,t)})}),_[e].apply(_,t)):(l.debug("[ExtensionSvc]: Chrome extension is not running"),void(n&&a(function(){n("Extension not running")},0))):(l.debug("[ExtensionSvc]: ExtensionConnHandler is not loaded"),void(n&&a(function(){n("No ExtensionConnHandler")},0)))}function y(e){return o.browser&&o.browser.chrome?m?null:(l.warn("[ExtensionSvc]: We are running an outdated extension:",N),e&&u&&u.error({message:"res_UnsupportedExtensionVersion"}),A.UNSUPPORTED_EXT_VERSION):A.UNSUPPORTED_BROWSER}if(i&&i.injectExtensionSvc(this,_),_){_.addEventListener("extensionInitialized",function(e){o.$apply(function(){N=e.data.version,l.info("[ExtensionSvc]: Validate the installed extension version: ",N),N!==v&&((m=r.convertVersionToNumber(N)>=R)||l.warn("[ExtensionSvc]: The installed extension version ("+N+") is not supported. Minimum version is "+f)),m&&(o.isChromeExtRunning=!0,l.setExtensionVersion(N),l.debug("[ExtensionSvc]: Publish /chromeExt/initialized event"),d.publish("/chromeExt/initialized"))})}),_.addEventListener("extensionUnregistered",function(){o.$apply(function(){o.isChromeExtRunning=!1,l.debug("[ExtensionSvc]: Publish /chromeExt/unregistered event"),d.publish("/chromeExt/unregistered")})});var P=function(e,t){o.$apply(function(){var n=t.data&&t.data.data;l.debug("[ExtensionSvc]: Publish "+e+" event: ",n),d.publish(e,[n])})};_.addEventListener("headsetAppLaunched",P.bind(null,"/chromeExt/headsetAppLaunched")),_.addEventListener("headsetAppUninstalled",P.bind(null,"/chromeExt/headsetAppUninstalled")),_.addEventListener("webRTCIPHandlingPolicyChanged",P.bind(null,"/chromeExt/webRTCIPHandlingPolicyChanged"))}return this.isExtensionRunning=function(){return _&&_.isExtensionRunning()&&m},this.getExtensionVersion=function(){return N},this.isExtensionVersionSupported=function(){return m},this.installExtension=function(e){return new c(function(t,n){if(g.isExtensionRunning())t();else{if(!u)return l.error("[ExtensionSvc]: installExtension API requires PopupSvc"),void n(A.INTERNAL_ERROR);var i=y(e);i?n(i):u.confirm({message:"res_ActionInstallExtensionText",title:"res_ActionInstallExtensionTitle",yesLabel:"res_ActionInstall",noLabel:"res_Close",backdrop:!0}).result.then(function(){g.inlineInstallation(e).then(t).catch(n)}).catch(function(){n(A.USER_CANCELLED_INSTALL)})}})},this.inlineInstallation=function(e){return new c(function(t,n){var i=y(e);if(i)n(i);else{var r=O();l.debug("[ExtensionSvc]: Open store link for ",r),s.open(r),t()}})},this.addEventListener=function(e,t){_&&_.addEventListener(e,t)},this.exchangeGetConnectionStatus=function(e,t){return D("exchangeGetConnectionStatus",[e],t)},this.exchangeConnect=function(e,t){return D("exchangeConnect",[e],t)},this.exchangeSearchContacts=function(e,t,n,i){return D("exchangeSearchContacts",[e,t,n],i)},this.exchangeGetCapabilities=function(e){return D("exchangeGetCapabilities",[],e)},this.exchangeAutodiscoverGetServer=function(e,t){return D("exchangeAutodiscoverGetServer",[e],t)},this.exchangeResolveContact=function(e,t,n){return D("exchangeResolveContact",[e,t],n)},this.exchangeGetContact=function(e,t,n){return D("exchangeGetContact",[e,t],n)},this.exchangeDisconnect=function(e){return D("exchangeDisconnect",[],e)},this.exchangeOnRenewedToken=function(e,t,n,i){return D("exchangeOnRenewedToken",[e,t,n],i)},this.storeExchCredentials=function(e,t){return D("exchangeStoreCredentials",[e],t)},this.getStoredCredentials=function(e,t){return D("getStoredCredentials",[e],t)},this.getAllPersonalContacts=function(e,t){return D("getAllPersonalContacts",[e],t)},this.syncAllPersonalContacts=function(e,t,n){return D("syncAllPersonalContacts",[e,t],n)},this.exchangeCancelReqCallback=function(e){return D("exchangeCancelReqCallback",[e])},this.getAppointments=function(e,t,n,i,r){return D("getAppointments",[e,t,n,i],r)},this.supportsGetAppointments=function(){return!!(o.localUser&&o.localUser.msExchangeEnabled&&(g.isExtensionRunning()||o.browser&&o.browser.chrome))},this.supportsExchangeAutodiscover=function(){return g.isExtensionRunning()},this.supportsExchangeAutodiscoverSvc=function(){return g.isExtensionRunning()},this.supportsExchangeAutodiscoverGetServer=function(){return N===v||r.convertVersionToNumber(N)>=1023300},this.supportsOOO=function(){return N===v||r.convertVersionToNumber(N)>=1022800},this.getOooMsg=function(e,n,i,r){g.supportsOOO()||r&&r(null,{response:t.ExchangeConnResponse.UNSUPPORTED_METHOD}),D("getOooMsg",[e,n,i],r)},this.launchHeadsetIntegrationApp=function(e,t,n){return D("launchHeadsetIntegrationApp",[e,t],n)},this.getHeadsetIntegrationAppStatus=function(e,t){return D("getHeadsetIntegrationAppStatus",[e],t)},this.restartHeadsetApp=function(e,t){return D("restartHeadsetApp",[e],t)},this.supportsPolicySettings=function(){return N===v||r.convertVersionToNumber(N)>=1023300},this.setIPHandlingPolicy=function(t,n,i){e.isElectron?(h.send("set-ip-handling-policy",t),i&&i(null)):D("setIPHandlingPolicy",[t,n],i)},this.getIPHandlingPolicy=function(t){"function"==typeof t&&(e.isElectron?(h.send("get-ip-handling-policy"),h.once("get-ip-handling-policy-response",function(e,n){o.$apply(function(){t(null,{value:n||null})})})):D("getIPHandlingPolicy",[],t))},this.bringToFront=function(t){e.isElectron?h.send("focus-window"):D("bringToFront",[],t)},this.getFileFromExtension=function(e,t,n){return D("getFile",[e,t],n)},o.isChromeExtRunning=g.isExtensionRunning(),this},e}(e=function(e){"use strict";var t=e.BaseCall,n=e.Utils;return e.PubSubSvcImpl=function(e){e.debug("New Service: PubSubSvc");var i={},r={},o={},a=[];function s(t,n){try{null==n?n=[]:Array.isArray(n)||(n=[n]),t.apply(null,n)}catch(t){e.error(t)}}function c(e,t,n){e[t]&&e[t].slice(0).forEach(function(e){s(e,n)})}function l(e,t,n){e[t]?e[t].includes(n)||e[t].push(n):e[t]=[n]}function d(e,t,n){if(e[t]){var i=e[t].indexOf(n);i>=0&&e[t].splice(i,1)}}return this.publish=function(l,d){(i[l]||r[l]||o[l]||a.length)&&(e.debug("[PubSubSvc]: Publishing "+l+" event"),c(i,l,d),function(e,i){r[e]&&(null==i?i=[]:Array.isArray(i)||(i=[i]),i=i.map(function(e){if(e&&"object"==typeof e){if(e.isConversationObject)return n.trimConvForMobile(e);if(e instanceof t)return n.trimCallForMobile(e)}return e}),r[e].slice(0).forEach(function(e){s(e,i)}))}(l,d),c(o,l,d),function(e,t){(t=t?Array.prototype.slice.call(t):[]).unshift(e),a.slice(0).forEach(function(e){s(e,t)})}(l,d),delete o[l])},this.subscribe=function(e,t){l(i,e,t)},this.unsubscribe=function(e,t){d(i,e,t)},this.subscribeOnce=function(e,t){l(o,e,t)},this.unsubscribeOnce=function(e,t){d(o,e,t)},this.subscribeMobile=function(e,t){l(r,e,t)},this.unsubscribeMobile=function(e,t){d(r,e,t)},this.subscribeAll=function(e){!function(e){a.includes(e)||a.push(e)}(e)},this.unsubscribeAll=function(e){!function(e){var t=a.indexOf(e);t>=0&&a.splice(t,1)}(e)},this.resetSubscriptions=function(){i={},r={},o={},a=[]},this},e}(e=function(e){"use strict";var t=e.Utils,n={ACCESSIBILITY:"125328",AGC:"89415",DEVICE_ACCESS:"48742",JABRA:"112718",LOGIN:"37428",MODERATION:"93154",PLANTRONICS:"115017",SHORTCUTS:t.isMacOs?"144499":"144490",TELEPHONY:"103733"};return e.UtilSvcImpl=function(e,n,i,r){r.debug("New Service: UtilSvc");var o=this;return this.promisify=function(e,t){return function(){var i=Array.prototype.slice.call(arguments);return new n(function(n,r){i.push(function(e){if(e)r(e);else{var t=Array.prototype.slice.call(arguments);switch(t.shift(),t.length){case 0:n();break;case 1:n(t[0]);break;default:n(t)}}}),e.apply(t,i)})}},this.getFaqUrl=function(n){return e.localUser&&e.localUser.helpUrl&&t.DEFAULT_HELP_URL!==e.localUser.helpUrl?e.localUser.helpUrl:"HELP"===n?t.DEFAULT_HELP_URL:"https://www.circuit.com/unifyportalfaqdetail"+(n?"?articleId="+n:"")},this.isPartnerAdmin=function(t){return!(!e.localUser||!e.localUser.isPartnerAdmin)||(r.debug("[UtilSvc]: Cannot invoke request. Local user is not a partner admin."),t&&i(function(){t("Not partner admin")}),!1)},this.isTenantAdmin=function(t,n){return!!e.localUser&&(n&&n.tenantId!==e.localUser.tenantId?o.isPartnerAdmin(t):!!e.localUser.isTenantAdmin||(r.warn("[UtilSvc]: Cannot invoke request. Local user is not a tenant admin."),t&&i(function(){t("Not tenant admin")}),!1))},this},e.Enums=e.Enums||{},e.Enums.FaqArticle=n,e}(e=function(e){"use strict";var t=Object.freeze({Idle:"Idle",Active:"Active"});return e.Enums=e.Enums||{},e.Enums.IdleState=t,e.SdkHelperSvcImpl=function(i,r,o,a){var c,l=e.Enums.ConnectionState,d=e.Constants,u=e.Conversation,C=e.UserProfile,E=e.Utils,T=this,p={},S=null,I=e.ClientApiHandlerSingleton.getInstance(),f=[];function R(){return null}function v(){if(!i.localUser||!i.localUser.accounts||!i.localUser.accounts[0])return!1;var e=i.localUser,t=i.localUser.accounts[0],n=e.callerId;return t.telephonyConfiguration?(e.phoneNumber=t.telephonyConfiguration.phoneNumber||null,e.isATC?(e.callerId=t.telephonyConfiguration.phoneNumber,e.cstaNumber=E.cleanPhoneNumber(t.telephonyConfiguration.phoneNumber),e.registerNumber=e.cstaNumber,e.isRegisterTC=!0):e.isSTC&&i.circuitLabs.SUBSCRIBER_TELEPHONY_CONNECTOR?(e.callerId=t.telephonyConfiguration.phoneNumber,e.registerNumber=E.cleanPhoneNumber(t.telephonyConfiguration.phoneNumber),e.cstaNumber=null,e.isRegisterTC=!0):(e.callerId=t.telephonyConfiguration.callerId||e.phoneNumber||S,e.cstaNumber=null,e.registerNumber=null,e.isRegisterTC=!1)):(e.phoneNumber=null,e.callerId=S,e.cstaNumber=null,e.registerNumber=null,e.isRegisterTC=!1),n!==e.callerId}function A(){return new s(function(e,t){I.getTelephonyData(function(n,i){n?t(n):(S=i.defaultCallerId||null,e(i))})})}function g(){return new s(function(e,t){I.getTelephonyConversationId(function(n,i){n||!i?t("Telephony conversation not found"):T.getConversationById(i,null,function(n,i){n||!i?t(n||"Error retrieving telephony conversation"):(c=i,i.isTelephonyConv=!0,e(i))})})})}return a.subscribe("/telephony/data",function(e){var t=!1;S!==e.defaultCallerId&&(S=e.defaultCallerId,E.updateTelephonyNumbers(i.localUser,e.defaultCallerId)&&(t=!0)),i.localUser.telephonyAvailable!==e.telephonyAvailableForUser&&(i.localUser.telephonyAvailable=e.telephonyAvailableForUser,t=!0),t&&a.publish("/localUser/update",[i.localUser])}),I.on("Account.TELEPHONY_CONFIGURATION_UPDATED",function(e){if(e.configuration&&i.localUser){var t=i.localUser.accounts&&i.localUser.accounts[0];t&&(t.telephonyConfiguration=e.configuration,T.telephonyConfigChanged(),a.publish("/localUser/update",[i.localUser]))}}),this.addConversationToCache=function(e){e&&e.convId&&(p[e.convId]=u.extend(e))},this.setLocalUser=function(e){e&&(i.localUser=e,C.syncTelephonyConfig(e),v())},this.telephonyConfigChanged=function(){v(),C.syncTelephonyConfig(i.localUser)},this.getConversationPromise=function(e){return new s(function(t,n){if(e){var i=p[e];i?t(i):T.getConversationById(e,null,function(e,i){e||!i?n("Conversation not found"):t(i)})}else n()})},this.getConversationById=function(e,t,n){"function"==typeof n&&I.getConversationById(e,function(e,t){var i=u.extend(t);i&&(p[t.convId]=i),n(e,i)})},this.getConversationByRtcSession=function(e){for(var t in o.debug("[SdkHelperSvc]: getConversationByRtcSession - rtcSessionId = ",e),p)if(p.hasOwnProperty(t)&&p[t].rtcSessionId===e)return p[t];return null},this.getConversationFromCache=function(e){return o.debug("[SdkHelperSvc]: getConversationFromCache - convId = ",e),p[e]||null},this.getConversationAsGuestById=function(e){return f.find(function(t){return t.convId===e})},this.getTelephonyData=A,this.getTelephonyConversationPromise=function(){return c?s.resolve(c):g()},this.getTelephonyConversation=function(e){if("function"==typeof e){if(c)return void n.setTimeout(function(){e(null,c)});A().then(v).then(g).then(function(t){e(null,t)}).catch(e)}},this.getCachedTelephonyConversation=function(){return c},this.isConversationsLoadComplete=function(){return!!i.localUser},this.updateLastCallTime=function(){},this.createConversationAsGuest=function(e){var t=u.extend({convId:e.convId,type:e.type,topic:e.topic,rtcSessionId:e.rtcSessionId,creatorId:e.creatorId,participants:[{userId:i.localUser.userId}],creatorTenantId:e.creatorTenantId||i.localUser.tenantId,isTemporary:!0,creationTime:e.creationTime||Date.now()});return f.some(function(t,n){return t.convId===e.convId&&(f.splice(n,1),!0)}),f.push(t),o.debug("[SDK]: Created temporary (as guest) conversation for session:",t.rtcSessionId),setTimeout(function(){e.isExtended?(o.debug("[SDK]: Publish /conversation/navigate/reload event"),a.publish("/conversation/navigate/reload",[t])):(o.debug("[SDK]: Publish /conversation/new event"),a.publish("/conversation/new",[t]))}),t},this.createConversationAsGuestFromSummary=function(e){return new s(function(t,n){e?I.getConversationSummary(e,null,function(e,i){e?n("[SDK] getConversationSummary request failed"):t(T.createConversationAsGuest(i))}):n("convId is required")})},this.sendQOSData=function(e,t,n){o.debug("[SdkHelperSvc]: sendQOSData - call stats: ",n)},this.state=function(){switch(I.getConnState()){case l.Disconnected:return"Disconnected";case l.Connecting:return"Connecting";case l.Reconnecting:return"Reconnecting";case l.Connected:return"Registered";default:return""}},this.isRegistered=function(){return I.getConnState()===l.Connected},this.getSetting=function(){return null},this.getUserIdleState=function(){return t.Active},this.isAutoSnoozeOn=!1,this.setPresenceWithLocation=function(){},this.startAutoSnooze=function(){},this.cancelAutoSnooze=function(){},this.getUserFromCache=R,this.getUser=R,this.getUserById=function(e,t){t&&t(d.ReturnCode.NO_RESULT)},this.addUsersToCache=function(){},this.startReverseLookUp=function(e,t){t&&t(null)},this},e}(e=function(e){"use strict";return e.Enums.SystemPermission=e.Constants.SystemPermission,e.Enums.DeviceType=e.Constants.DeviceType,e.Enums.CallStateName={},Object.getOwnPropertyNames(e.Enums.CallState).forEach(function(t){e.Enums.CallStateName[t]=t}),e.Enums.ConversationItemType=e.Constants.ConversationItemType,e.Enums.ConversationType={DIRECT:"DIRECT",GROUP:"GROUP",LARGE:"LARGE",COMMUNITY:"COMMUNITY"},e.Enums.PresenceState=e.Constants.PresenceState,e.Enums.RTCItemType=e.Constants.RTCItemType,e.Enums.RTCParticipantType=e.Constants.RTCParticipantType,e.Enums.SystemItemType=e.Constants.SystemItemType,e.Enums.TextItemContentType=e.Constants.TextItemContentType,e.Enums.UserType=e.Constants.UserType,e.Enums.UserState=e.Constants.UserState,e.Enums.SearchDirection=e.Constants.SearchDirection,e.Enums.ParticipantCriteria=e.Constants.GetConversationParticipantCriteria,e.Enums.ConversationParticipantType=e.Constants.ConversationParticipantType,e.Enums.RetrieveAction=e.Constants.RetrieveAction,e.Enums.RecordingInfoState=e.Constants.RecordingInfoState,e.Enums.RecordingInfoState=e.Constants.RecordingInfoState,e.Enums.SearchScope=e.Constants.SearchScope,e.Enums.SearchStatusCode=e.Constants.SearchStatusCode,e.Enums.SessionClosedReason=e.Constants.SessionClosedReason,e.Enums.GetAccountsFilterCriteria=e.Constants.GetAccountsFilterCriteria,e.Enums.AccountStatus=e.Constants.AccountStatus,e.Enums.GetAccountsSorting=e.Constants.GetAccountsSorting,e.Enums.GetAccountsOrdering=e.Constants.GetAccountsOrdering,e.Enums.SearchContext=e.Constants.SearchContext,e.Enums.Locale=e.Constants.Locale,e.Enums.VideoResolution={VGA:"VGA",HD:"HD",FHD:"FHD",NONE:"NONE"},e.Enums.FormControlType=e.Constants.CPaaSFormMetaDataControlType,e.Enums.RecordingVideoLayoutName=e.Constants.RecordingVideoLayoutName,e}((e=function(e){"use strict";var t;return e.ExtensionConnHandlerSingleton={getInstance:function(){return t||(t=new e.ExtensionConnHandler),t}},e}(e=function(e){"use strict";var t=e.BaseEventTarget,i=e.ChromeExtension,o=e.logger,a=e.Utils;function s(){s.parent.constructor.call(this,o);var t,c,l=5e3,d=this,u={},C=0,E=!1,T=n.BgExchangeConnectorHandler;if(e.isElectron){if(T){c=T.getInstance();var p=function(e){e.data&&e.data.keysToOmitFromLogging&&(e.keysToOmitFromLogging=e.data.keysToOmitFromLogging.map(function(e){return"data."+e}),delete e.data.keysToOmitFromLogging),R(e)};t=Object.create(o,{sendResponse:{value:function(e,t,n){var r={type:i.BgMsgType.RESPONSE,reqId:e,suppressLog:!!n,data:t};p(r)}},sendInternalEvent:{value:function(e){o.error("[ExtensionConnHandler]: Unexpected internal event: ",e)}},sendExchangeConnEvent:{value:function(e,t){var n={type:i.BgMsgType.EVENT,target:i.BgTarget.EXCHANGE_CONNECTOR,suppressLog:!!t,data:e};p(n)}}});n.chrome={storage:{local:{set:function(e,t){n.localStorage.setItem("exchange",JSON.stringify(e,function(e,t){if("string"!=typeof e||"$"!==e.charAt(0))return t})),t&&t()},get:function(e,t){t&&t(JSON.parse(n.localStorage.getItem("exchange")))},clear:function(e){n.localStorage.removeItem("exchange"),e&&e()}}},runtime:{},windows:{create:function(){}},permissions:{contains:function(e,t){t(!0)}}}}setTimeout(function(){o.info("[ExtensionConnHandler]: Raise extensionInitialized"),E=!0;var e=d.createEvent("extensionInitialized");e.data={version:"electron"},d.dispatch(e)},1e3)}function S(e,t){o.info("[ExtensionConnHandler]: Dispatching event: ",e);var n=d.createEvent(e);n.data=t,d.dispatch(n)}function I(a,s,E,T){return a?d.isExtensionRunning()?function(a,s,d,E){a.type===i.BgMsgType.REQUEST&&(a.reqId=function(e,t){e=e||function(){};var r=++C,a=n.setTimeout(function(){u[r]&&(o.error("[ExtensionConnHandler]: Timeout waiting for response. reqId:",r),delete u[r],e(i.ResponseError.TIMEOUT))},t||l);return u[r]={cb:e,timer:a},r}(s,d));E||o.msgSend("[ExtensionConnHandler]: ",a);if(a.suppressLog=E,e.isElectron&&c&&a.type===i.BgMsgType.REQUEST&&a.target===i.BgTarget.EXCHANGE_CONNECTOR)return n.setTimeout(function(){c.onWebClientMsg(t,a,e.__server)},0),a.reqId;var T=new CustomEvent(i.DOMEvent.TO_EXTENSION,{detail:JSON.stringify(a)});try{r&&r.dispatchEvent(T)}catch(e){return o.warning("[ExtensionConnHandler]: Error sending message: "+T,e),!1}return a.reqId}(a,s,E,T):(o.info("[ExtensionConnHandler]: Chrome extension is not running"),s&&n.setTimeout(function(){s("Extension not running")},0),!1):(o.error("[ExtensionConnHandler]: Cannot send message. Invalid message."),s&&n.setTimeout(function(){s("Invalid message")},0),!1)}function f(){o.warning("[ExtensionConnHandler]: The content script has unregistered itself. Chrome extension is no longer running."),E=!1,o.info("[ExtensionConnHandler]: Dispatching event: extensionUnregistered");var e=d.createEvent("extensionUnregistered");d.dispatch(e)}function R(e){if(e.target!==i.BgTarget.LOG)switch(e.suppressLog||o.msgRcvd("[ExtensionConnHandler]: ",e),e.type){case i.BgMsgType.REQUEST:case i.BgMsgType.EVENT:!function(e){switch(e.target){case i.BgTarget.INTERNAL:switch(e.data.type){case i.BgInternalMsgType.INIT_MSG:o.info("[ExtensionConnHandler]: Received INIT_MSG. Send an INIT_MSG_ACK to the extension."),E=!0,I({target:i.BgTarget.INTERNAL,data:{type:i.BgInternalMsgType.INIT_MSG_ACK}}),S("extensionInitialized",e.data);break;case i.BgInternalMsgType.EXTENSION_DISCONNECTED:o.warning("[ExtensionConnHandler]: Received EXTENSION_DISCONNECTED from ansible-content"),f();break;default:o.warning("[ExtensionConnHandler]: Received unknown INTERNAL msg type:",e.data.type)}break;case i.BgTarget.HEADSET_APP:switch(e.data.type){case i.BgHeadsetAppMsgType.HEADSET_APP_LAUNCHED:S("headsetAppLaunched",e.data);break;case i.BgHeadsetAppMsgType.HEADSET_APP_UNINSTALLED:S("headsetAppUninstalled",e.data);break;default:o.warning("[ExtensionConnHandler]: Received unknown HEADSET_APP msg type:",e.data.type)}break;case i.BgTarget.PRIVACY_SETTINGS:e.data.type===i.BgPrivacySettingsMsgType.IP_HANDLING_POLICY_CHANGED?S("webRTCIPHandlingPolicyChanged",e.data):o.warning("[ExtensionConnHandler]: Received unknown PRIVACY_SETTINGS msg type:",e.data.type);break;default:e.suppressLog||o.info("[ExtensionConnHandler]: Dispatching event:",e.target);var t=d.createEvent(e.target);t.data=e.data,t.suppressLog=e.suppressLog,e.reqId&&e.type===i.BgMsgType.REQUEST&&(t.reqId=e.reqId),d.dispatch(t)}}(e);break;case i.BgMsgType.RESPONSE:!function(e){if(u[e.reqId]){var t=u[e.reqId];t.timer&&n.clearTimeout(t.timer),delete u[e.reqId],e.data&&e.data.error?(t.cb(e.data.error),e.data.error===i.ResponseError.UNREGISTERED&&f()):t.cb(null,e.data),e.suppressLog||o.debug("[ExtensionConnHandler]: Remaining callbacks pending:",Object.keys(u).length)}else o.info("[ExtensionConnHandler]: No registered callback for reqId =",e.reqId)}(e);break;default:o.msgRcvd("[ExtensionConnHandler]: Unexpected message type: ",e.type)}else o.logMsg(e.data.log.level,e.data.log.messages)}this.isExtensionRunning=function(){return E},this.getScreenShareUserMedia=function(e){I({target:i.BgTarget.SCREEN_SHARE,type:i.BgMsgType.REQUEST,data:{type:i.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA}},e)},this.exchangeConnect=function(e,t){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{method:i.BgExchangeMsgType.CONNECT,object:{settings:e}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},t,18e4)},this.exchangeDisconnect=function(e){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{method:i.BgExchangeMsgType.DISCONNECT,object:{}}},e,65e3)},this.exchangeGetConnectionStatus=function(e,t){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{key:e,method:i.BgExchangeMsgType.GET_CONNECTION_STATUS},keysToOmitFromLogging:["data.key"]},t,65e3)},this.exchangeGetCapabilities=function(e){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{method:i.BgExchangeMsgType.GET_CAPABILITIES}},e,65e3)},this.exchangeAutodiscoverGetServer=function(e,t){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{method:i.BgExchangeMsgType.AUTODISCOVER_GET_SERVER,object:{settings:e}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},t,65e3)},this.exchangeCancelReqCallback=function(e){return o.debug("[ExtensionConnHandler]: Unregistering callback for reqId:",e),function(e){return!(!e||!u[e]||(delete u[e],0))}(e)},this.exchangeSearchContacts=function(e,t,n,r){return I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{key:e,method:i.BgExchangeMsgType.SEARCH_CONTACTS,object:{searchString:t,resultCount:n}},keysToOmitFromLogging:["data.key"]},r,65e3)},this.exchangeResolveContact=function(e,t,n){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{key:e,method:i.BgExchangeMsgType.RESOLVE_CONTACT,object:t},keysToOmitFromLogging:["data.key"]},n,65e3)},this.exchangeGetContact=function(e,t,n){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{key:e,method:i.BgExchangeMsgType.GET_CONTACT,object:{email:t}},keysToOmitFromLogging:["data.key"]},n,65e3)},this.exchangeOnRenewedToken=function(e,t,n,r){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.RESPONSE,data:{key:e,method:i.BgExchangeMsgType.ON_RENEWED_TOKEN,object:{reqId:t,token:n}},keysToOmitFromLogging:["data.key","data.object.token"]},r,65e3)},this.exchangeStoreCredentials=function(e,t){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{method:i.BgExchangeMsgType.STORE_EXCH_CREDENTIALS,object:e},keysToOmitFromLogging:["data.object"]},t,65e3)},this.getAllPersonalContacts=function(e,t){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{key:e,method:i.BgExchangeMsgType.GET_ALL_PERSONAL_CONTACTS},keysToOmitFromLogging:["data.key"]},t,65e3)},this.getAppointments=function(e,t,n,r,o){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{key:e,method:i.BgExchangeMsgType.GET_APPOINTMENTS,startDate:t,endDate:n,resCount:r},keysToOmitFromLogging:["data.key"]},o,65e3)},this.syncAllPersonalContacts=function(e,t,n){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{key:e,method:i.BgExchangeMsgType.SYNC_ALL_PERSONAL_CONTACTS,syncState:t},keysToOmitFromLogging:["data.key","data.syncState"]},n,65e3)},this.getStoredCredentials=function(e,t){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{key:e,method:i.BgExchangeMsgType.GET_STORED_CREDENTIALS},keysToOmitFromLogging:["data.key"]},t,65e3)},this.getOooMsg=function(e,t,n,r){I({target:i.BgTarget.EXCHANGE_CONNECTOR,type:i.BgMsgType.REQUEST,data:{key:e,method:i.BgExchangeMsgType.GET_OOO_MSG,fromEmail:t,email:n},keysToOmitFromLogging:["data.key"]},r,65e3)},this.getHeadsetIntegrationAppStatus=function(t,r){"function"==typeof r&&(e.isElectron?n.setTimeout(function(){o.debug("[ExtensionConnHandler]: Return status INSTALLED for desktop app"),r(null,{status:i.HeadsetAppStatus.INSTALLED})},0):I({target:i.BgTarget.HEADSET_APP,type:i.BgMsgType.REQUEST,data:{type:i.BgHeadsetAppMsgType.GET_HEADSET_APP_STATUS,appId:t}},r))},this.launchHeadsetIntegrationApp=function(e,t,n){I({target:i.BgTarget.HEADSET_APP,type:i.BgMsgType.REQUEST,data:{type:i.BgHeadsetAppMsgType.LAUNCH_HEADSET_APP,appId:e,localizedStrings:t}},n,18e4)},this.restartHeadsetApp=function(e,t){I({target:i.BgTarget.HEADSET_APP,type:i.BgMsgType.REQUEST,data:{type:i.BgHeadsetAppMsgType.RESTART_HEADSET_APP,appId:e}},t)},this.setIPHandlingPolicy=function(e,t,n){I({target:i.BgTarget.PRIVACY_SETTINGS,type:i.BgMsgType.REQUEST,data:{type:i.BgPrivacySettingsMsgType.SET_IP_HANDLING_POLICY,policy:e,localizedStrings:t}},n,18e4)},this.getIPHandlingPolicy=function(e){I({target:i.BgTarget.PRIVACY_SETTINGS,type:i.BgMsgType.REQUEST,data:{type:i.BgPrivacySettingsMsgType.GET_IP_HANDLING_POLICY}},e)},this.bringToFront=function(e){I({target:i.BgTarget.INTERNAL,type:i.BgMsgType.REQUEST,data:{type:i.BgInternalMsgType.BRING_TO_FRONT}},e)},this.getFile=function(e,t,n){I({target:i.BgTarget.INTERNAL,type:i.BgMsgType.REQUEST,data:{type:i.BgInternalMsgType.GET_FILE,name:e,lang:t}},n)},a.getBrowserInfo().chrome&&r&&r.addEventListener(i.DOMEvent.FROM_EXTENSION,function(e){if(e&&e.detail)try{R(JSON.parse(e.detail))}catch(e){return void o.error("[ExtensionConnHandler]: Error parsing JSON object. ",e)}})}return a.inherit(s,t),s.prototype.name="ExtensionConnHandler",e.ExtensionConnHandler=s,e}(e=function(t){"use strict";var n=e.logger;return t.CstaParser=function(){function e(e){var t=null;return e&&e.extn&&e.extn.pDa&&e.extn.pDa.prvt&&(t=e.extn.pDa.prvt.zEpid),t}function t(e){e&&Object.keys(e).forEach(function(t){e[t]=""===e[t]||"true"===e[t]})}function i(e){if(!e)return{};var n={};return e.sP&&(n.rSP=e.sP,t(n.rSP.cCSs)),e.extn&&e.extn.pDa&&e.extn.pDa.prvt&&void 0!==e.extn.pDa.prvt.zxSP&&(n.eSP=e.extn.pDa.prvt.zxSP,t(n.eSP)),n}function r(e){return{forwardingType:e.fTe,forwardStatus:"true"===e.fS,forwardDN:e.fDNN}}function o(e){return{recordId:e.rID,callID:e.cID,recordType:e.rTp,createdTime:e.cTm,result:e.res,callDuration:e.cDr,callingDevice:e.clDv||"",calledDevice:e.cldDv||"",answeringDevice:e.aDv||""}}this.genCstaRequest=function(e){try{switch(e.request){case"AlternateCall":return function(e){return{ACl:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID,dID:e.activeCall.dID}}}}(e);case"ConferenceCall":return function(e){return{CoC:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID,dID:e.activeCall.dID}}}}(e);case"AnswerCall":return function(e){return{AnC:{cTBAd:{cID:e.callToBeAnswered.cID,dID:e.callToBeAnswered.dID}}}}(e);case"CallBackCallRelated":return function(e){return{CB:{cC:{cID:e.callBackConnection.cID,dID:e.callBackConnection.dID}}}}(e);case"CallBackNonCallRelated":return function(e){return{CBNC:{orD:e.orD,tD:e.tD}}}(e);case"CancelCallBack":return function(e){return{CCB:{orD:e.orD,tD:e.tD}}}(e);case"ClearConnection":return function(e){return{CCn:{coTBC:{cID:e.connectionToBeCleared.cID,dID:e.connectionToBeCleared.dID},rsn:e.reason}}}(e);case"ConsultationCall":return function(e){return{CnC:{cnD:e.consultedDevice||void 0,eCl:{cID:e.existingCall.cID,dID:e.existingCall.dID}}}}(e);case"DeflectCall":return function(e){var t={cTBD:{cID:e.callToBeDiverted.cID,dID:e.callToBeDiverted.dID},nD:e.newDestination};return e.autoAnswer&&(t.extn={pDa:{prvt:{zdT:"Auto-Answer"}}}),{DCl:t}}(e);case"GenerateDigits":return function(e){return{GD:{cTSD:{cID:e.connectionToSendDigits.cID,dID:e.connectionToSendDigits.dID},cTS:e.charactersToSend}}}(e);case"GetDoNotDisturb":return function(e){return{GDND:{dvc:e.device}}}(e);case"GetForwarding":return function(e){return{GF:{dvc:e.device}}}(e);case"GetMessageWaitingIndicator":return function(e){return{GMWI:{dvc:e.device}}}(e);case"HoldCall":return function(e){var t={cTBH:{cID:e.callToBeHeld.cID,dID:e.callToBeHeld.dID}};return e.holdOptions&&(t.extn={zhOs:e.holdOptions}),{HC:t}}(e);case"ReconnectCall":return function(e){return{RC:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID||void 0,dID:e.activeCall.dID||void 0}}}}(e);case"RetrieveCall":return function(e){return{RCl:{cTBRd:{cID:e.callToBeRetrieved.cID,dID:e.callToBeRetrieved.dID}}}}(e);case"SetBusy":return function(e){return{zSBN:{dvc:e.device,zbO:e.busyState}}}(e);case"SetDoNotDisturb":return function(e){return{SDND:{dvc:e.device,dNDO:e.doNotDisturbOn}}}(e);case"SetForwarding":return function(e){var t={SF:{dvc:e.device,aF:e.activateForward,fDNN:e.forwardDN,fTe:e.forwardingType,riC:e.ringCount}},n={};return void 0!==e.staticOndActive?n={zsOA:!0===e.staticOndActive?"true":"false",zsOD:e.staticOndDN||""}:void 0!==e.voicemailActive||void 0!==e.voicemailRingDuration?n={zvMA:"boolean"==typeof e.voicemailActive?e.voicemailActive.toString():void 0,zvMRD:e.voicemailRingDuration?e.voicemailRingDuration.toString():void 0}:(void 0!==e.mainRingDuration&&(n.zmRD=e.mainRingDuration.toString()||""),void 0!==e.clientRingDuration&&(n.zcRD=e.clientRingDuration.toString()||""),void 0!==e.cellRingDuration&&(n.zcpRD=e.cellRingDuration.toString()||""),void 0!==e.alternativeNumber&&(n.zcPN=e.alternativeNumber),void 0!==e.routeToCell&&(n.zrTCN=e.routeToCell?"true":"false")),Object.keys(n).length>0&&(t.SF.extn={pDa:{prvt:n}}),t}(e);case"SingleStepTransferCall":return function(e){var t={atC:{cID:e.activeCall.cID,dID:e.activeCall.dID},tTo:e.transferredTo};if(e.autoAnswer||e.seamlessHandover){var n={};e.autoAnswer&&(n.ztTgt="Auto-Answer"),e.seamlessHandover&&(n.zseHo="true"),t.extn={pDa:{prvt:n}}}return{SSTC:t}}(e);case"SnapshotCall":return function(e){return{SC:{sO:{cID:e.snapshotObject.cID,dID:e.snapshotObject.dID}}}}(e);case"SnapshotDevice":return function(e){var t={sO:e.snapshotObject};return e.osmo&&(t.extn={pDa:{prvt:{zxsm:e.osmo}}}),{SDe:t}}(e);case"TransferCall":return function(e){return{TC:{hC:{cID:e.heldCall.cID,dID:e.heldCall.dID},atC:{cID:e.activeCall.cID,dID:e.activeCall.dID}}}}(e);case"GenGetConfiguration":return{zGCD:{zcCA:"Internet",zdMO:"Chrome",zdOS:"WebRTC"}};case"SetMicrophoneMute":return function(e){return{SMM:{dvc:e.device,mMO:e.mute}}}(e);case"GetMicrophoneMute":return function(e){return{GMM:{dvc:e.device}}}(e);case"MakeCall":return function(e){return{MC:{caD:e.callingDevice,cDN:e.calledDirectoryNumber,aOe:e.autoOriginate}}}(e);case"CallLogSnapShot":return function(e){return{CLS:{sub:e.device}}}(e);case"AcceptCall":return function(e){return{AC:{cTBA:{cID:e.callToBeAccepted.cID,dID:e.callToBeAccepted.dID}}}}(e);case"GetAgentState":return function(e){return{GAS:{dvc:e.device}}}(e);case"SetAgentState":return function(e){return{SAS:{dvc:e.device,rAS:e.state}}}(e);case"GroupPickupCall":return function(e){return{GPC:{nD:e.newDestination}}}(e);case"GetLogicalDeviceInformation":return function(e){return{GLDI:{dvc:e.device}}}(e)}n.error("CSTA: Unsupported CSTA request: "+e.request)}catch(e){n.error(e)}return null},this.parseEvent=function(t){try{if(!t)return n.error("[CstaParser]: Invalid event"),null;var r=JSON.parse(t);if(!r||r.parsererror)return n.error("[CstaParser]: Error parsing CSTA event: ",t),r&&r.parsererror.div&&n.error("[CstaParser]: "+r.parsererror.div),null;var a=Object.keys(r)[0];switch(a){case"CBE":return function(e){var t=e.CBE;return{category:"LogicalDeviceFeature",name:"CallBackEvent",originatingDevice:t.orD.dIr,targetDevice:t.tD.dIr,callBackSetCanceled:t.cBSC}}(r);case"CIE":return function(t){var n=t.CIE,r={category:"CallAssociatedFeature",name:"CallInformationEvent",connection:n.cnncn,device:n.dvc.dIr||"",callingDevice:n.caD&&n.caD.dIr||"",servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r.pickupNotificationEarly=r.device&&r.device.includes("Pickup Group Number"),r}(r);case"CoE":return function(t){var n=t.CoE,r={category:"CallControl",name:"ConferencedEvent",primaryOldCall:n.pOC,secondaryOldCall:n.sOC,conferencingDevice:n.coD.dIr||"",addedParty:n.aPy.dIr||"",conferenceConnections:[],localConnectionInfo:n.lCI,cause:n.cs,servicesPermitted:{}};return n.cnC.cLI.forEach(function(e){var t={connection:e.nCn,endpoint:e.endp&&(e.endp.dID||e.endp.endp)};r.conferenceConnections.push(t)}),r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"CCEt":return function(t){var n=t.CCEt,r={category:"CallControl",name:"ConnectionClearedEvent",droppedConnection:n.drC,releasingDevice:n.rD.dIr||"",localConnectionInfo:n.lCI,cause:n.cs,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r.pickupNotificationTerminated=r.releasingDevice&&r.releasingDevice.includes("Pickup Group Number"),r}(r);case"DE":return function(t){var n=t.DE,r={category:"CallControl",name:"DeliveredEvent",connection:n.cnncn,alertingDevice:n.aDe.dIr||"",callingDevice:n.caD.dIr||"",calledDevice:n.cDe.dIr||"",localConnectionInfo:n.lCI,cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"DGE":return function(e){var t=e.DGE;return{category:"CallAssociatedFeature",name:"DigitsGeneratedEvent",connection:t.cnncn,digitGeneratedList:t.dGL}}(r);case"DEt":return function(t){var n=t.DEt,r={category:"CallControl",name:"DivertedEvent",connection:n.cnncn,divertingDevice:n.dvD.dIr||"",newDestination:n.nD.dIr||"",callingDevice:n.caD&&n.caD.dIr||"",lastRedirectionDevice:n.lRD&&n.lRD.nDd||"",localConnectionInfo:n.lCI,cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"DNDE":return function(e){var t=e.DNDE;return{category:"LogicalDeviceFeature",name:"DoNotDisturbEvent",device:t.dvc.dIr||"",doNotDisturbOn:"true"===t.dNDO}}(r);case"EEt":return function(t){var n=t.EEt,r={category:"CallControl",name:"EstablishedEvent",establishedConnection:n.eCn,answeringDevice:n.anD.dIr||"",callingDevice:n.caD.dIr||"",calledDevice:n.cDe.dIr||"",lastRedirectionDevice:n.lRD&&n.lRD.nDd||"",localConnectionInfo:n.lCI,cause:n.cs,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"FE":return function(t){var n=t.FE,r={category:"CallControl",name:"FailedEvent",failedConnection:n.fC,failingDevice:n.fD.dIr||"",callingDevice:n.caD.dIr||"",localConnectionInfo:n.lCI,calledDevice:n.cDe.dIr,cause:n.cs,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"FEt":return function(e){var t=e.FEt,n={category:"LogicalDeviceFeature",name:"ForwardingEvent",device:t.dvc.dIr||"",forwardingType:t.fTe,forwardStatus:"true"===t.fS,forwardTo:t.fTo};return t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(t.extn.pDa.prvt.zsOD&&(n.staticOndDN=t.extn.pDa.prvt.zsOD,n.staticOndActive="true"===t.extn.pDa.prvt.zsOA),t.extn.pDa.prvt.zvMA&&(n.voicemailActive="true"===t.extn.pDa.prvt.zvMA),t.extn.pDa.prvt.zoP&&(n.overrideProfile="true"===t.extn.pDa.prvt.zoP),t.extn.pDa.prvt.zvMRD&&(n.voicemailRingDuration=parseInt(t.extn.pDa.prvt.zvMRD,10)),t.extn.pDa.prvt.zmRD&&(n.mainRingDuration=parseInt(t.extn.pDa.prvt.zmRD,10)),t.extn.pDa.prvt.zcRD&&(n.clientRingDuration=parseInt(t.extn.pDa.prvt.zcRD,10)),t.extn.pDa.prvt.zcpRD&&(n.cellRingDuration=parseInt(t.extn.pDa.prvt.zcpRD,10)),t.extn.pDa.prvt.hasOwnProperty("zcPN")&&(n.alternativeNumber=t.extn.pDa.prvt.zcPN),t.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(n.routeToCell="true"===t.extn.pDa.prvt.zrTCN)),n}(r);case"HE":return function(t){var n=t.HE,r={category:"CallControl",name:"HeldEvent",heldConnection:n.hCn,holdingDevice:n.hD.dIr||"",localConnectionInfo:n.lCI,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"MWE":return function(e){var t=e.MWE;return{category:"PhysicalDeviceFeature",name:"MessageWaitingEvent",device:t.tD.dIr||"",messageWaitingOn:"true"===t.mWO}}(r);case"OE":return function(t){var n=t.OE,r={category:"CallControl",name:"OfferedEvent",offeredConnection:n.oCn,offeredDevice:n.oDe.dIr||"",callingDevice:n.caD.dIr||"",calledDevice:n.cDe.dIr||"",localConnectionInfo:n.lCI,lastRedirectionDevice:n.lRD&&n.lRD.nDd||"",cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"QE":return function(t){var n=t.QE,r={category:"CallControl",name:"QueuedEvent",queuedConnection:n.qC,queue:n.q.dIr||"",callingDevice:n.caD.dIr||"",localConnectionInfo:n.lCI,cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"ReE":return function(t){var n=t.ReE,r={category:"CallControl",name:"RetrievedEvent",retrievedConnection:n.rCn,retrievingDevice:n.reD.dIr||"",localConnectionInfo:n.lCI,servicesPermitted:{}};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"SCFE":return function(e){var t=e.SCFE,n={category:"CallAssociatedFeature",name:"ServiceCompletionFailureEvent",primaryCall:{connectionID:t.prC.cIDD,localConnectionState:t.prC.lCSe},cause:t.cs};return t.sC&&(n.secondaryCall={connectionID:t.sC.cIDD,localConnectionState:t.sC.lCSe}),n}(r);case"SIE":return function(t){var n=t.SIE,r={category:"CallControl",name:"ServiceInitiatedEvent",initiatedConnection:n.iCn,initiatingDevice:n.iD.dIr||"",cause:n.cs};return r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"TE":return function(t){var n=t.TE,r={category:"CallControl",name:"TransferredEvent",primaryOldCall:n.pOC,secondaryOldCall:n.sOC,transferringDevice:n.tDe.dIr||"",transferredToDevice:n.tTDe.dIr||"",transferredConnections:[],localConnectionInfo:n.lCI,cause:n.cs,servicesPermitted:{}},o=n.tCs.cLI;return Array.isArray(o)||(o=[o]),r.transferredConnections=o.map(function(e){return{connection:e.nCn,endpoint:e.endp&&(e.endp.dID||e.endp.endp)}}),r.servicesPermitted=i(n),r.epid=e(n),r}(r);case"CLE":return function(e){var t=e.CLE,n={category:"LogicalDeviceFeature",name:"CallLogEvent",callLogList:[]};return t.cLL&&t.cLL.cLE&&(t.cLL.cLE.rID?n.callLogList.push(o(t.cLL.cLE)):t.cLL.cLE.forEach(function(e){n.callLogList.push(o(e))})),n}(r);case"BISE":return function(e){return{category:"DeviceMaintenance",name:"BackInServiceEvent",backInService:!0,device:e.BISE.dvc.dIr||""}}(r);case"OOSE":return function(e){return{category:"DeviceMaintenance",name:"OutOfServiceEvent",outOfService:!0,device:e.OOSE.dvc.dIr||""}}(r);case"ARE":return{category:"LogicalDeviceFeature",name:"AgentReadyEvent",agentReady:!0};case"ANRE":return{category:"LogicalDeviceFeature",name:"AgentNotReadyEvent",agentReady:!1};case"ABE":return{category:"LogicalDeviceFeature",name:"AgentBusyEvent",agentReady:!1};case"DCCE":return function(e){var t=e.DCCE,n={category:"DeviceMaintenance"};return t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&t.extn.pDa.prvt.zdP&&(n.name="true"===t.extn.pDa.prvt.zdP?"BackInServiceEvent":"OutOfServiceEvent"),n}(r);case"ALOE":return{category:"LogicalDeviceFeature",name:"AgentLoggedOffEvent"};case"ALOEt":return{category:"LogicalDeviceFeature",name:"AgentLoggedOnEvent"}}n.info("[CstaParser]: Unsupported CSTA event: ",a)}catch(e){n.error("[CstaParser]: Error parsing CSTA event: ",e)}return null},this.parseResponse=function(t,o){try{if(!t||!o)return n.error("[CstaParser]: Invalid response"),null;var a=JSON.parse(o);if(!a||a.parsererror)return n.error("[CstaParser]: Error parsing CSTA response: ",o),a&&a.parsererror.div&&n.error("[CstaParser]: "+a.parsererror.div),null;if(a.CSTA&&(a.CSTAErrorCode=a.CSTA),a.CSTAErrorCode)return n.debug("[CstaParser]: Received error response for: ",t),function(e){if(!e.CSTAErrorCode)return n.error("[CstaParser]: The given response is not an error code: ",e),null;var t=null,i=Object.keys(e.CSTAErrorCode)[0];switch(i){case"oprt":case"operation":t="Operation Error";break;case"scrt":case"security":t="Security Error";break;case"sIy":case"stateIncompatibility":t="State Incompatibility Error";break;case"sRAy":case"systemResourceAvailability":t="System Resource Availability Error";break;case"sRA":case"subscribedResourceAvailability":t="Subscribed Resource Availability Error";break;case"pM":case"performanceManagement":t="Performance Management Error";break;case"pDa":case"privateDataInformation":t="Private Data Information Error"}return t?{error:!0,errorCategory:t,errorValue:e.CSTAErrorCode[i]}:(n.error("[CstaParser]: Unrecognized Error Category"),{error:!0,errorCategory:"Unknown",errorValue:"Unknown"})}(a);if(a.ISEC)return n.debug("[CstaParser]: Received internal service error response for: ",t),function(e){return e.ISEC?"code"!==Object.keys(e.ISEC)[0]?(n.error("[CstaParser]: Unrecognized Internal Service Error Category"),{error:!0,errorCategory:"Unknown",errorValue:"Unknown"}):{error:!0,errorCategory:"Code",errorValue:e.ISEC.code}:(n.error("[CstaParser]: The given response is not an internal service error code: ",e),null)}(a);switch(t){case"AlternateCall":return function(e){return n.debug("[CstaParser]: Received CSTA Alternate Call response: ",e),e.ACRe}(a);case"ConferenceCall":return function(e){return n.debug("[CstaParser]: Received CSTA Conference Call response: ",e),{conferenceCall:e.CoCR.coC}}(a);case"AnswerCall":return function(e){return n.debug("[CstaParser]: Received CSTA Answer Call response: ",e),e.AnCR}(a);case"CallBackCallRelated":return function(e){return n.debug("[CstaParser]: Received CSTA Call Back call related response: ",e),e.CBR}(a);case"CallBackNonCallRelated":return function(e){return n.debug("[CstaParser]: Received CSTA Call Back non call related response: ",e),e.CBNCe}(a);case"CancelCallBack":return function(e){return n.debug("[CstaParser]: Received CSTA Cancel Call Back response: ",e),e.CCBR}(a);case"ClearConnection":return function(e){return n.debug("[CstaParser]: Received CSTA Clear Connection response: ",e),e.ClCR}(a);case"ConsultationCall":return function(e){return n.debug("[CstaParser]: Received CSTA Consultation Call response: ",e),e.CnCR}(a);case"DeflectCall":return function(e){return n.debug("[CstaParser]: Received CSTA Deflect Call response: ",e),e.DCRe}(a);case"GenerateDigits":return function(e){return n.debug("[CstaParser]: Received CSTA Generate Digits response: ",e),e.GDR}(a);case"GetDoNotDisturb":return function(e){return n.debug("[CstaParser]: Received CSTA Get Do Not Disturb response: ",e),{doNotDisturbOn:"true"===e.GDNDe.dNDO}}(a);case"GetForwarding":return function(e){if(n.debug("[CstaParser]: Received CSTA Get Forwarding response: ",e),e.GetForwardingResponse)return function(e){var t={forwardList:[]};return e.forwardingList.forwardListItem.forwardStatus?(e.forwardingList.forwardListItem.forwardStatus="true"===e.forwardingList.forwardListItem.forwardStatus,t.forwardList.push(e.forwardingList.forwardListItem)):e.forwardingList.forwardListItem.forEach(function(e){e.forwardStatus="true"===e.forwardStatus,t.forwardList.push(e)}),e.extensions&&e.extensions.privateData&&e.extensions.privateData.private&&(t.staticOndDN=e.extensions.privateData.private.staticOndDN,t.staticOndActive="true"===e.extensions.privateData.private.staticOndActive),t}(e.GetForwardingResponse);var t=e.GFR,i={forwardList:[]};return t.fL.fLI.fS?i.forwardList.push(r(t.fL.fLI)):t.fL.fLI.forEach(function(e){i.forwardList.push(r(e))}),t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(i.staticOndDN=t.extn.pDa.prvt.zsOD,i.staticOndActive="true"===t.extn.pDa.prvt.zsOA,i.voicemailActive="true"===t.extn.pDa.prvt.zvMA,t.extn.pDa.prvt.zoP&&(i.overrideProfile="true"===t.extn.pDa.prvt.zoP),t.extn.pDa.prvt.zvMRD&&(i.voicemailRingDuration=parseInt(t.extn.pDa.prvt.zvMRD,10)),t.extn.pDa.prvt.zmRD&&(i.mainRingDuration=parseInt(t.extn.pDa.prvt.zmRD,10)),t.extn.pDa.prvt.zcRD&&(i.clientRingDuration=parseInt(t.extn.pDa.prvt.zcRD,10)),t.extn.pDa.prvt.zcpRD&&(i.cellRingDuration=parseInt(t.extn.pDa.prvt.zcpRD,10)),t.extn.pDa.prvt.hasOwnProperty("zcPN")&&(i.alternativeNumber=t.extn.pDa.prvt.zcPN),t.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(i.routeToCell="true"===t.extn.pDa.prvt.zrTCN)),i}(a);case"GetMessageWaitingIndicator":return function(e){return n.debug("[CstaParser]: Received CSTA Get Message Waiting response: ",e),{messageWaitingOn:"true"===e.GMWIe.mWO}}(a);case"HoldCall":return function(e){return n.debug("[CstaParser]: Received CSTA Hold Call response: ",e),e.HCR}(a);case"ReconnectCall":return function(e){return n.debug("[CstaParser]: Received CSTA Reconnect Call response: ",e),e.RCR}(a);case"RetrieveCall":return function(e){return n.debug("[CstaParser]: Received CSTA Retrieve Call response: ",e),e.RCRe}(a);case"SetBusy":return function(e){return n.debug("[CstaParser]: Received CSTA Set Busy response: ",e),e.zSBNe}(a);case"SetDoNotDisturb":return function(e){return n.debug("[CstaParser]: Received CSTA Set Do Not Disturb response: ",e),e.SDNDe}(a);case"SetForwarding":return function(e){return n.debug("[CstaParser]: Received CSTA Set Forwarding response: ",e),e.hasOwnProperty("SFR")?e.SFR:e.SetForwardingResponse}(a);case"SingleStepTransferCall":return function(e){n.debug("[CstaParser]: Received CSTA SST Call response: ",e);var t=e.SSTCe,i={transferredCall:t.trC};return t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(i.seamlessHandover="true"===t.extn.pDa.prvt.zseHo),i}(a);case"SnapshotCall":return function(t){n.debug("[CstaParser]: Received CSTA Snapshot Call response: ",t);var r=t.SCR,o={endpoints:[],callingDevice:r.caD&&r.caD.dIr||"",calledDevice:r.cDe&&r.cDe.dIr||"",servicesPermitted:{}},a=function(e){var t=function(e){return{deviceOnCall:e.dOC.dIr||"",callIdentifier:e.cI,localConnectionState:e.lCI,servicesPermitted:i(e)}}(e);o.endpoints.push(t),!o.callingDevice&&o.calledDevice&&t.deviceOnCall!==o.calledDevice&&(o.callingDevice=t.deviceOnCall)};return r.cRID.sDa.sCRIo&&(r.cRID.sDa.sCRIo.dOC?a(r.cRID.sDa.sCRIo):r.cRID.sDa.sCRIo.forEach(function(e){a(e)})),o.servicesPermitted=i(r),o.epid=e(r),o}(a);case"SnapshotDevice":return function(e){n.debug("[CstaParser]: Received CSTA Snapshot Device response: ",e);var t=e.SnDR,i={activeCalls:[]};function r(e){var t,n={connectionId:(t=e).cIr,localCallState:t.lCS&&t.lCS.cCSe&&t.lCS.cCSe.lCSe};n.connectionId&&n.connectionId.cID&&i.activeCalls.push(n)}return t.cRID.sDa.sDRI&&(t.cRID.sDa.sDRI.cIr?r(t.cRID.sDa.sDRI):t.cRID.sDa.sDRI.forEach(function(e){r(e)})),t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(i.deskPhoneRegistered="true"===t.extn.pDa.prvt.zdP),i}(a);case"TransferCall":return function(e){return n.debug("[CstaParser]: Received CSTA TransferCall response: ",e),{transferredCall:e.TCR.trC}}(a);case"SetMicrophoneMute":return function(e){return n.debug("[CstaParser]: Received CSTA SetMicrophoneMute response",e),{mute:"true"===e.SMMR.mML.mMI.mMO}}(a);case"GetMicrophoneMute":return function(e){return n.debug("[CstaParser]: Received CSTA GetMicrophoneMute response",e),{mute:"true"===e.GMMR.mML.mMI.mMO}}(a);case"MakeCall":return function(e){return n.debug("[CstaParser]: Received CSTA MakeCall response",e),e.MCR}(a);case"CallLogSnapShot":return function(e){return n.debug("[CstaParser]: Received CSTA Call Log Snap Shot response: ",e),e.CLSR}(a);case"AcceptCall":return function(e){return n.debug("[CstaParser]: Received CSTA Accept Call response: ",e),e.ACR}(a);case"GetAgentState":return function(e){n.debug("[CstaParser]: Received CSTA GetAgentState response",e);var t=e.GASR;return{loggedOnState:t.aSL&&t.aSL.aSE&&"true"===t.aSL.aSE.lOS,agentState:t.aSL&&t.aSL.aSE&&t.aSL.aSE.aIo&&"agentReady"===t.aSL.aSE.aIo.aII.aS?"ready":"notReady"}}(a);case"SetAgentState":return function(e){return n.debug("[CstaParser]: Received CSTA SetAgentState response",e),e.SASR}(a);case"GroupPickupCall":return function(e){return n.debug("[CstaParser]: Received CSTA GroupPickupCall response",e),e.GPCR}(a);case"GetLogicalDeviceInformation":return function(e){return n.debug("[CstaParser]: Received CSTA Get Logical Device Information response: ",e),{hasPhysicalDeviceInformation:"true"===e.GLDIe.hPE}}(a)}n.error("CSTA: Unsupported CSTA response for request: ",t)}catch(e){n.error(e)}return null}},t}(e=function(e){"use strict";var t;return e.UserToUserHandlerSingleton={getInstance:function(){return t||(t=new e.UserToUserHandler),t}},e}(e=function(e){"use strict";var t=e.ClientApiHandlerSingleton,i=e.Constants,r=e.logger,o=e.Utils,a=Object.freeze({CSTA:"CSTA",PRIMARYCLIENT:"PRIMARYCLIENT",INFO:"INFO",SETTINGS:"SETTINGS",ADVANCING:"ADVANCING"}),s=Object.freeze({GET_GTC_VERSION_REQUEST:"GET_GTC_VERSION_REQUEST",GET_GTC_VERSION_RESPONSE:"GET_GTC_VERSION_RESPONSE",SET_ROUTE_TO_DESK:"SET_ROUTE_TO_DESK",ENABLE_PBX_CALL_LOG:"ENABLE_PBX_CALL_LOG"}),c=Object.freeze({TRANSFER:"TRANSFER"}),l=Object.freeze({CLICK_TO_CALL_REQUEST:"CLICK_TO_CALL_REQUEST",CLICK_TO_CALL_RESPONSE:"CLICK_TO_CALL_RESPONSE",MUTE_DEVICE_REQUEST:"MUTE_DEVICE_REQUEST",MUTE_DEVICE_RESPONSE:"MUTE_DEVICE_RESPONSE",JOIN_CONFERENCE_REQUEST:"JOIN_CONFERENCE_REQUEST",JOIN_CONFERENCE_RESPONSE:"JOIN_CONFERENCE_RESPONSE",CONVERSATION_NAVIGATE_REQUEST:"CONVERSATION_NAVIGATE_REQUEST",CONVERSATION_NAVIGATE_RESPONSE:"CONVERSATION_NAVIGATE_RESPONSE",CLICK_TO_ANSWER_REQUEST:"CLICK_TO_ANSWER_REQUEST",CLICK_TO_ANSWER_RESPONSE:"CLICK_TO_ANSWER_RESPONSE"}),d=Object.freeze({OK:"OK",BUSY:"BUSY",TELEPHONY_NOT_AVAILABLE:"TELEPHONY_NOT_AVAILABLE",USER_NOT_FOUND:"USER_NOT_FOUND",CONVERSATION_NOT_FOUND:"CONVERSATION_NOT_FOUND",CALL_DECLINED:"CALL_DECLINED",CALL_FAILED:"CALL_FAILED",CALL_NOT_FOUND:"CALL_NOT_FOUND",MUTE_DEVICE_FAILED:"MUTE_DEVICE_FAILED",CONVERSATION_NAVIGATE_FAILED:"CONVERSATION_NAVIGATE_FAILED",JOIN_CONFERENCE_FAILED:"JOIN_CONFERENCE_FAILED"}),u=Object.freeze({INVITE_REQUEST:"INVITE_REQUEST",INVITE_RESPONSE:"INVITE_RESPONSE",MUTE_REQUEST:"MUTE_REQUEST",MUTE_RESPONSE:"MUTE_RESPONSE",UNMUTE_REQUEST:"UNMUTE_REQUEST",UNMUTE_RESPONSE:"UNMUTE_RESPONSE",GET_MEETINGPOINT_INVITER_REQUEST:"GET_MEETINGPOINT_INVITER_REQUEST",GET_MEETINGPOINT_INVITER_RESPONSE:"GET_MEETINGPOINT_INVITER_RESPONSE",TOGGLE_VIDEO_REQUEST:"TOGGLE_VIDEO_REQUEST",TOGGLE_VIDEO_RESPONSE:"TOGGLE_VIDEO_RESPONSE",START_HD_VIDEO_REQUEST:"START_HD_VIDEO_REQUEST",START_HD_VIDEO_RESPONSE:"START_HD_VIDEO_RESPONSE",CHANGE_LAYOUT_REQUEST:"CHANGE_LAYOUT_REQUEST",CHANGE_LAYOUT_RESPONSE:"CHANGE_LAYOUT_RESPONSE",TOGGLE_WHITEBOARD:"TOGGLE_WHITEBOARD",TOGGLE_SCREENSHARING:"TOGGLE_SCREENSHARING",TOGGLE_SHOW_VIDEO:"TOGGLE_SHOW_VIDEO",SWAP_DISPLAYS_REQUEST:"SWAP_DISPLAYS_REQUEST",SWAP_DISPLAYS_RESPONSE:"SWAP_DISPLAYS_RESPONSE"}),C=Object.freeze({OK:"OK",FAILED:"FAILED",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",NOT_FOUND:"NOT_FOUND",NOT_CMP_USER:"NOT_CMP_USER",NOT_SUPPORTED:"NOT_SUPPORTED",INVITE_FAILED:"INVITE_FAILED",MUTE_FAILED:"MUTE_FAILED",UNMUTE_FAILED:"UNMUTE_FAILED",INVALID_PIN:"INVALID_PIN",MEETINGPOINT_BUSY:"MEETINGPOINT_BUSY",TOGGLE_VIDEO_FAILED:"START_VIDEO_FAILED",TOGGLE_SCREENSHARING_FAILED:"TOGGLE_SCREENSHARING_FAILED",TOGGLE_WHITEBOARD_FAILED:"TOGGLE_WHITEBOARD_FAILED",TOGGLE_SHOW_VIDEO_FAILED:"TOGGLE_SHOW_VIDEO_FAILED",CHANGE_LAYOUT_FAILED:"CHANGE_LAYOUT_FAILED",SWAP_DISPLAYS_FAILED:"SWAP_DISPLAYS_FAILED"}),E=Object.freeze({DIAL:"DIAL"});function T(e){var a=2e4,s={},c={},l=e||t.getInstance();function d(e){e&&n.setTimeout(function(){e(i.ReturnCode.INVALID_MESSAGE)},0)}function u(e,t,c){return t&&t.content&&t.content.type?(r.debug("[UserToUserHandler]: Sending request "+e+"."+t.content.type),t.content.requestId=t.content.requestId||o.createTransactionId(),s[t.content.requestId]?(r.error("[UserToUserHandler]: UserToUser request has duplicate requestId"),void d(c)):void l.sendUserToUserRequest(e,t,function(o){if(o)return r.error("[UserToUserHandler]: Failed to send request: ",o),void(c&&c(o));e===i.UserRoutingMessageType.SDK?c&&c():function(e,t){if(t){var o=n.setTimeout(function(e){r.error("[UserToUserHandler]: Timeout waiting for response. RequestId:",e),s[e]&&(delete s[e],t(i.ReturnCode.REQUEST_TIMEOUT),r.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(s).length))},a,e);s[e]={cb:t,timer:o}}}(t.content.requestId,c)})):(r.error("[UserToUserHandler]: Invalid UserToUser request data - ",t),void d(c))}function C(e,t){try{if(t.routing&&t.routing.srcClientId===l.clientId)return void r.info("[UserToUserHandler]: Ignore own UserToUser event");var o;try{o=JSON.parse(t.data)}catch(e){return void r.error("[UserToUserHandler]: Event discarded (Cannot Parse)")}if(o.requestId){var a=s[o.requestId];if(a)return a.timer&&n.clearTimeout(a.timer),delete s[o.requestId],a.cb&&a.cb(null,o),void r.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(s).length)}var d=e+"."+o.type,u=c[d];u&&0!==u.length?(e===i.UserRoutingMessageType.SDK&&(o=o.message),u.forEach(function(e){e.cb(o,t.routing)})):r.info("[UserToUserHandler]: There is no registered event handler for ",d)}catch(e){r.error("[UserToUserHandler]: Exception handling UserToUser event. ",e)}}l.on("UserToUser.ATC",function(e){r.debug("[UserToUserHandler]: Received UserToUser.ATC event: ",e.data),C(i.UserRoutingMessageType.ATC,e)}),l.on("UserToUser.DESKTOP_APP",function(e){r.debug("[UserToUserHandler]: Received UserToUser.DESKTOP_APP event: ",e.data),C(i.UserRoutingMessageType.DESKTOP_APP,e)}),l.on("UserToUser.CONTACT_CARD",function(e){r.debug("[UserToUserHandler]: Received UserToUser.CONTACT_CARD event: ",e.data),C(i.UserRoutingMessageType.CONTACT_CARD,e)}),l.on("UserToUser.CMP",function(e){r.debug("[UserToUserHandler]: Received UserToUser.CMP event: ",e.data),C(i.UserRoutingMessageType.CMP,e)}),l.on("UserToUser.MOBILE_BREAKOUT",function(e){r.debug("[UserToUserHandler]: Received UserToUser.MOBILE_BREAKOUT event: ",e.data),C(i.UserRoutingMessageType.MOBILE_BREAKOUT,e)}),l.on("UserToUser.SDK",function(e){r.debug("[UserToUserHandler]: Received UserToUser.SDK event: ",e.data),C(i.UserRoutingMessageType.SDK,e)}),l.on("UserToUser.STC",function(e){r.debug("[UserToUserHandler]: Received UserToUser.STC event: ",e.data),C(i.UserRoutingMessageType.STC,e)}),this.cancelReqCallback=function(e){var t=s[e];t&&(t.cb=null)},this.sendAtcRequest=function(e,t){u(i.UserRoutingMessageType.ATC,e,t)},this.sendContactCardRequest=function(e,t){u(i.UserRoutingMessageType.CONTACT_CARD,e,t)},this.sendDesktopAppRequest=function(e,t){u(i.UserRoutingMessageType.DESKTOP_APP,e,t)},this.sendMeetingPointRequest=function(e,t){u(i.UserRoutingMessageType.CMP,e,t)},this.sendMobileBreakoutEvent=function(e,t){u(i.UserRoutingMessageType.MOBILE_BREAKOUT,e,t)},this.sendStcRequest=function(e,t){u(l.isStcMessageSupported()?i.UserRoutingMessageType.STC:i.UserRoutingMessageType.ATC,e,t)},this.sendSdkRequest=function(e,t){e&&e.content&&delete e.content.requestId,u(i.UserRoutingMessageType.SDK,e,t)},this.on=function(e,t){e&&"function"==typeof t&&(c[e]=c[e]||[],c[e].some(function(e){return e.cb===t})||c[e].push({cb:t}))},this.off=function(e,t){if(e||t)if(t){if(e&&"function"==typeof t){var n=c[e];n&&n.some(function(e,i){return e.cb===t&&(n.splice(i,1),!0)})}}else delete c[e];else c={}}}return T.prototype.constructor=T,T.prototype.name="UserToUserHandler",e.UserToUserHandler=T,e.Enums=e.Enums||{},e.Enums.AtcInfoMessage=s,e.Enums.AtcMessage=a,e.Enums.StcMessage=c,e.Enums.ContactCardMessage=l,e.Enums.ContactCardResponseCode=d,e.Enums.MeetingPointMessage=u,e.Enums.MeetingPointResponseCode=C,e.Enums.MobileBreakoutMessage=E,e}(e=function(e){"use strict";var t;return e.ClientApiHandlerSingleton={getInstance:function(){return t||(t=new e.ClientApiHandler),t}},e}(e=function(t){"use strict";var i=t.Constants,r=t.PrivateData,o=t.Proto,a=t.Utils;function s(s){var c,l,d,u,C=t.logger,E=function(){},T=15e4,p=new t.ConnectionHandler(s),S=!1,I=0;function f(e,t,n,i,r,a,s){var c=o.Request(e,t,a);S?r=null:i&&(c.keysToOmitFromLogging=i);var l=s?T:null;return p.sendMessage(c,function(e,t){try{n(e,t)}catch(e){C.error("[ClientApiHandler]: Exception: ",e)}},r||null,l),c.request.requestId}function R(t,n){e.Error&&(c=new e.Error(t),n&&(c.errObj=n,c.message=n.info))}function v(e,t,n,r){if(c=null,e)return R(e),n(e),!1;if(t.code===i.ReturnCode.NO_RESULT)return r?n(null,[]):(R(i.ReturnCode.NO_RESULT),n(i.ReturnCode.NO_RESULT)),!1;var o,a=t.code;switch(t.code){case i.ReturnCode.OK:case i.ReturnCode.ENTITY_ALREADY_EXISTS:return!0;case i.ReturnCode.CLOUD_TELEPHONY_EXCEPTION:case i.ReturnCode.SERVICE_EXCEPTION:t.errorInfo&&t.errorInfo.errorCode&&((a=t.errorInfo.errorCode)===i.ErrorCode.THIRDPARTY_ERROR&&t.errorInfo.thirdpartyError&&(a=t.errorInfo.thirdpartyError.type),o=t.errorInfo)}return R(a=a||i.ReturnCode.UNEXPECTED_RESPONSE,o),n(a),!1}function A(e,t,i){t&&R(t),e&&e!==E&&n.setTimeout(function(){e(t,i)},0)}function g(e){var t=[];return e?(e.audio&&t.push(i.RealtimeMediaType.AUDIO),e.video&&t.push(i.RealtimeMediaType.VIDEO),e.desktop&&t.push(i.RealtimeMediaType.DESKTOP_SHARING)):t.push(i.RealtimeMediaType.AUDIO),t}function _(e){return e&&{fileId:e.fileId,fileName:e.fileName,mimeType:e.mimeType,size:e.size,itemId:e.itemId}}function N(e){return e&&e.map(_)}function m(e){return e&&{attachment:_(e.attachment),type:e.type,downloadLocation:e.downloadLocation,previewLocation:e.previewLocation,shareLinkToken:e.shareLinkToken}}function h(e){return e&&e.map(m)}function O(e){return{convId:e.convId,rtcSessionId:e.rtcSessionId,ownerId:e.ownerId,sdp:e.sdp,mediaType:g(e.mediaType),callOut:!!e.callOut,handover:!!e.handover,sendInviteCancel:!!e.sendInviteCancel,peerUserId:e.peerUserId||void 0,replaces:e.replaces,from:e.fromDn||e.fromName?{phoneNumber:e.fromDn,displayName:e.fromName,resolvedUserId:e.fromUserId}:void 0,to:e.dialedDn?{phoneNumber:e.dialedDn,displayName:e.toName,resolvedUserId:e.toUserId}:void 0,isTelephonyConversation:!!e.isTelephonyConversation,displayName:e.displayName,transactionId:e.transactionId,screenSharePointerSupported:e.screenSharePointerSupported,asyncSupported:!0,noCallLog:e.noCallLog||void 0,guestToken:e.guestToken||void 0,rtcSupportedFeatures:e.rtcSupportedFeatures||void 0,pickUpSession:e.pickUpSession||void 0}}function D(e){e=e||E,C.debug("[ClientApiHandler]: getApiVersion...");var t={type:i.VersionActionType.GET_VERSION};f(i.ContentType.VERSION,t,function(t,n){if(t||n.code!==i.ReturnCode.OK)I=0;else{var r=n.version.getVersion.version;C.info("[ClientApiHandler]: Setting client API version to ",r),I=a.convertVersionToNumber(r)}e()})}function y(e){var t=e&&e.content||"";t=a.sanitize(t),t=a.sanitizeSymbols(t);return t=r.convertPrivateDataToContent(e,["conceptboards"])+t}Object.defineProperties(this,{clientId:{enumerable:!0,get:function(){return l},set:function(e){"simulatedDirect"===e&&(l=e)}},clientApiVersion:{enumerable:!0,get:function(){return I}}}),this.getLastError=function(){return c},this.connect=function(e,t,n){n&&p.setTarget(n),p.connect(e,t)},this.getConnState=p.getState.bind(p),this.disconnect=p.disconnect.bind(p),this.reconnect=p.reconnect.bind(p),this.pingServer=p.pingServer.bind(p),this.setPingInterval=p.setPingInterval.bind(p),this.setTarget=p.setTarget.bind(p),this.setClientInfo=p.setClientInfo.bind(p),this.setToken=p.setToken.bind(p),this.setRelativeUrl=p.setRelativeUrl.bind(p),this.addEventListener=p.addEventListener.bind(p),this.removeEventListener=p.removeEventListener.bind(p),this.onMessage=p.onMessage.bind(p),this.setDevelopmentMode=function(e){S=!!e,p.ommitKeysFromLog=!e},this.on=function(e,t){var n;switch(e){case"Account.TELEPHONY_CONFIGURATION_UPDATED":n=["event.account.telephonyConfigurationUpdated.configuration.onsSipAuthenticationHash","event.account.telephonyConfigurationUpdated.configuration.ondSipAuthenticationHash"];break;case"Conversation.ADD_ITEM":n=["event.conversation.addItem.item.text","event.conversation.addItem.item.system.renamedConversation"];break;case"Conversation.UPDATE_ITEM":n=["event.conversation.updateItem.item.text"];break;case"Conversation.CREATE":n=["event.conversation.create.conversation.topic","event.conversation.create.conversation.description"];break;case"Conversation.UPDATE":n=["event.conversation.update.conversation","event.conversation.update.topic","event.conversation.update.description"];break;case"RTCSession.QUESTION_EVENT":n=["event.rtcSession.questionEvent.question.questionText"];break;case"RTCSession.POLL_ENABLED":n=["event.rtcSession.pollEnabledEvent.poll.question","event.rtcSession.pollEnabledEvent.poll.choices.[].choiceText"];break;case"RTCSession.POLL_STARTED":n=["event.rtcSession.pollStartedEvent.poll.question","event.rtcSession.pollStartedEvent.poll.choices.[].choiceText"];break;case"RTCSession.POLL_STOPPED":n=["event.rtcSession.pollStoppedEvent.poll.question","event.rtcSession.pollStoppedEvent.poll.choices.[].choiceText"];break;case"RTCSession.POLL_UPDATED":n=["event.rtcSession.pollUpdatedEvent.poll.question","event.rtcSession.pollUpdatedEvent.poll.choices.[].choiceText"];break;case"Search.BASIC_SEARCH_RESULT":n=["event.search.basicSearchResult.searchResults"];break;case"System.BROADCAST":n=["event.system.systemNotificationEvent.broadcastText"];break;case"User.USER_PRESENCE_CHANGE":n="*";break;case"ThirdParty.CONNECTED_TO_THIRDPARTY":n=["event.thirdParty.oAuthData"]}p.on(e,t,n)},this.isApplicationFrameworkConfigurationSupported=function(){return I>2090117},this.isRecentCMRsSupported=function(){return I>2090117},this.isAllowedToAddCmrSupported=function(){return I>2090117},this.isJPLIntegrationSupported=function(){return I>2090117},this.isVideoLayoutSupported=function(){return I>2090117},this.isSiteRangesUpdateSupported=function(){return I>2090119},this.isDutchSupported=function(){return I>2090119},this.isCallLogFilteringSupported=function(){return I>2090119},this.isGoogleContactsSupported=function(){return I>2090119},this.isStcMessageSupported=function(){return I>2090119},this.isShareTCPoolsSupported=function(){return I>2090119},this.isAutomatedAttendantUpdateSupported=function(){return I>2090122},this.isGetConversationDetailsSupported=function(){return I>2090122},this.isSetConversationRetentionPolicySupported=function(){return I>2090122},this.isExecutiveAssistantSupported=function(){return I>2090123},this.isMLHGCustomMoHSupported=function(){return I>2090123},this.isConferencePollSupported=function(){return I>2090125},this.getApiVersion=D,this.logout=function(e){e=e||E,C.debug("[ClientApiHandler]: logout...");var t={type:i.UserActionType.LOGOUT,logoff:{invalidate:!0}};f(i.ContentType.USER,t,function(t,n){v(t,n,e)&&e(null)})},this.getUser=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getUser...");var n={type:i.UserActionType.GET_USER_BY_ID,getById:{userId:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null,n.user.getById.user)})},this.updateUser=function(e,t){t=t||E,C.debug("[ClientApiHandler]: updateUser...");var n={type:i.UserActionType.UPDATE,update:e};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null,n.user.updateResult.user)})},this.getLoggedOnUser=function(e){e=e||E,C.debug("[ClientApiHandler]: getLoggedOnUser...");var t={type:i.UserActionType.GET_LOGGED_ON};f(i.ContentType.USER,t,function(t,n){var i,r;v(t,n,e)&&(i=(r=n.user.getLoggedOn).user,r.userPresenceState=r.userPresenceState||i.userPresenceState,i.userPresenceState=r.userPresenceState,i.accounts=r.accounts||[],I=a.convertVersionToNumber(i.apiVersion),l=i.clientId,d=i.userId,e(null,r))},null,["response.user.getLoggedOn.user.userPresenceState.longitude","response.user.getLoggedOn.user.userPresenceState.latitude","response.user.getLoggedOn.user.userPresenceState.locationText","response.user.getLoggedOn.user.userPresenceState.statusMessage","response.user.getLoggedOn.userPresenceState.longitude","response.user.getLoggedOn.userPresenceState.latitude","response.user.getLoggedOn.userPresenceState.locationText","response.user.getLoggedOn.userPresenceState.statusMessage"])},this.getStuff=function(e,t){D(function(e,t){t=t||E,C.debug("[ClientApiHandler]: getStuff..."),e&&e.length||(e=[i.GetStuffType.USER,i.GetStuffType.ACCOUNTS,i.GetStuffType.FIRST_WEB_LOGIN,i.GetStuffType.PRESENCE_STATE,i.GetStuffType.RECENT_SEARCHES,i.GetStuffType.SETTINGS,i.GetStuffType.SUPPORT_CONVERSATION_ID,i.GetStuffType.TELEPHONY_CONVERSATION_ID,i.GetStuffType.GLOBAL_PROPERTIES,i.GetStuffType.TENANT,i.GetStuffType.NOTIFICATION_SUBSCRIPTIONS,i.GetStuffType.PENDING_SYSTEM_NOTIFICATIONS,i.GetStuffType.SUPPORT_INFO,i.GetStuffType.HAS_TENANT_MEETING_POINTS]);var n={type:i.UserActionType.GET_STUFF,getStuff:{types:e}};f(i.ContentType.USER,n,function(n,r){if(v(n,r,t)){var o=r.user.getStuff;e.includes(i.GetStuffType.USER)&&(o.user.userPresenceState=o.userPresenceState,o.user.accounts=o.accounts||[],I=a.convertVersionToNumber(o.user.apiVersion),l=o.user.clientId,d=o.user.userId),t(null,o)}},null,["response.user.getStuff.accounts.[].telephonyConfiguration.onsSipAuthenticationHash","response.user.getStuff.accounts.[].telephonyConfiguration.ondSipAuthenticationHash","response.user.getStuff.pendingSystemNotifications.[].systemNotificationEvent.broadcastText","response.user.getStuff.recentSearches","response.user.getStuff.userPresenceState.longitude","response.user.getStuff.userPresenceState.latitude","response.user.getStuff.userPresenceState.locationText","response.user.getStuff.userPresenceState.statusMessage"])}.bind(this,e,t))},this.setPresence=function(e,t){t=t||E,C.debug("[ClientApiHandler]: setPresence...");var n={type:i.UserActionType.SET_PRESENCE,presence:{state:e.state,inTransit:e.inTransit,longitude:e.longitude,latitude:e.latitude,locationText:e.locationText,isAccurate:e.isAccurate,timeZoneOffset:e.timeZoneOffset,mobile:e.mobile,dndUntil:e.dndUntil,statusMessage:e.statusMessage||""}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null,n.user.setPresence.state)},["request.user.presence.longitude","request.user.presence.latitude","request.user.presence.locationText","request.user.presence.statusMessage"],["response.user.setPresence.state.longitude","response.user.setPresence.state.latitude","response.user.setPresence.state.locationText","response.user.setPresence.state.statusMessage"])},this.getPresence=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: getPresence...");var r={type:i.UserActionType.GET_PRESENCE,getPresence:{userIds:e,full:!!t}};f(i.ContentType.USER,r,function(e,t){v(e,t,n)&&n(null,t.user.getPresence.states)},null,["response.user.getPresence.states"])},this.subscribePresence=function(e,t){t=t||E,C.debug("[ClientApiHandler]: subscribePresence...");var n={type:i.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:e}};f(i.ContentType.USER,n,function(e,n){if(v(e,n,t)){var i=n.user&&n.user.subscribePresence&&n.user.subscribePresence.states;t(null,i)}},null,["response.user.subscribePresence.states"])},this.unsubscribePresence=function(e,t){t=t||E,C.debug("[ClientApiHandler]: unsubscribePresence...");var n={type:i.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null)})},this.subscribeTenantPresence=function(e,t){t=t||E,C.debug("[ClientApiHandler]: subscribeTenantPresence...");var n={type:i.UserActionType.SUBSCRIBE_TENANT_PRESENCE,subscribeTenantPresence:{tenantId:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null)})},this.unsubscribeTenantPresence=function(e,t){t=t||E,C.debug("[ClientApiHandler]: unsubscribeTenantPresence...");var n={type:i.UserActionType.UNSUBSCRIBE_TENANT_PRESENCE,unsubscribeTenantPresence:{tenantId:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null)})},this.updateStatusSubscription=function(e,t,n){var r;n=n||E,C.debug("[ClientApiHandler]: updateStatusSubscription - subscribe = ",t),r=t?{type:i.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:e,notificationSubscriptionType:i.NotificationSubscriptionType.ONLINE_STATUS}}:{type:i.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:e,notificationSubscriptionType:i.NotificationSubscriptionType.ONLINE_STATUS}},f(i.ContentType.USER,r,function(e,t){v(e,t,n)&&n(null)})},this.changePassword=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: changePassword...");var r={type:i.UserActionType.CHANGE_PASSWORD,changePassword:{oldPassword:e,newPassword:t}};f(i.ContentType.USER,r,function(e,t){v(e,t,n)&&n(null,t.user.changePasswordResult.changeResult)},["request.user.changePassword.oldPassword","request.user.changePassword.newPassword"])},this.setPassword=function(e,t){t=t||E,C.debug("[ClientApiHandler]: setPassword...");var n={type:i.UserActionType.SET_PASSWORD,setPassword:{password:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null,n.user.setPasswordResult.resultSetPassword)},["request.user.setPassword.password"])},this.subscribeDevices=function(e){e=e||E,C.debug("[ClientApiHandler]: subscribeDevices...");var t={type:i.UserActionType.SUBSCRIBE_DEVICES};f(i.ContentType.USER,t,function(t,n){if(v(t,n,e)){var i=n.user&&n.user.subscribeDevices&&n.user.subscribeDevices.devices;e(null,i)}})},this.unsubscribeDevices=function(e){e=e||E,C.debug("[ClientApiHandler]: unsubscribeDevices...");var t={type:i.UserActionType.UNSUBSCRIBE_DEVICES};f(i.ContentType.USER,t,function(t,n){v(t,n,e)&&e(null)})},this.requestEmailChange=function(e,t,n){C.debug("[ClientApiHandler]: requestEmailChange");var r={type:i.UserActionType.GENERATE_EMAIL_UPDATE_TOKEN,generateEmailUpdateToken:{userId:e,emailAddress:t}};f(i.ContentType.USER,r,function(e,t){v(e,t,n)&&n(null)})},this.getUsersByIds=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getUsersByIds...");var n={type:i.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:e,complete:!0}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null,n.user.usersByIds.user)})},this.getPartialUsersByIds=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getPartialUsersByIds...");var n={type:i.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:e,complete:!1}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null,n.user.usersByIds.user)})},this.renewToken=function(e){e=e||function(e){e?C.error("[ClientApiHandler]: Error renewing token. This client will be automatically logged out",e):C.debug("[ClientApiHandler]: Successfully renewed token.")},C.debug("[ClientApiHandler]: renewToken");var t={type:i.UserActionType.RENEW_TOKEN};f(i.ContentType.USER,t,function(t,n){v(t,n,e)&&e(null)})},this.getUserSettings=function(e,t){t=t||E,e=e||i.UserSettingArea.ALL,C.debug("[ClientApiHandler]: getUserSettings...");var n={type:i.UserActionType.GET_USER_SETTINGS,getUserSettings:{areas:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null,n.user.getUserSettings.settings)})},this.setUserSettings=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: setUserSettings..."),!e||Array.isArray(e)&&!e.length)return C.warn("[ClientApiHandler]: No settings were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);Array.isArray(e)||(e=[e]);var n={type:i.UserActionType.SET_USER_SETTINGS,setUserSettings:{settings:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null)})},this.getUserByEmail=function(e,t){t=t||E;var n={type:i.UserActionType.GET_USER_BY_MAIL,getUserByMail:{emailAddress:e,excludeRoles:[i.UserRole.SUPPORT,i.UserRole.SYSTEM_ADMIN]}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null,n.user.getUserByMail.user)})},this.getUsersByEmails=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getUsersByEmails...");var n={type:i.UserActionType.GET_USERS_BY_MAILS,getUsersByMails:{emailAddresses:e.emailAddresses,xmppLookup:!!e.xmppLookup,excludeRoles:[i.UserRole.SUPPORT,i.UserRole.SYSTEM_ADMIN]}};f(i.ContentType.USER,n,function(e,n){v(e,n,t,!0)&&t(null,n.user.getUsersByMails.users)})},this.changeUserEmail=function(e,t,n,r){n=n||E;var o={type:i.UserActionType.EMAIL_UPDATE,emailUpdate:{userId:e,emailAddress:t}};f(i.ContentType.USER,o,function(e,t){v(e,t,n)&&n(null,t.user.emailUpdate)},null,null,r)},this.goToSleep=function(e,t){t=t||E,C.debug("[ClientApiHandler]: goToSleep...");var n={type:i.UserActionType.GO_TO_SLEEP,userId:e};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null)})},this.wakeUp=function(e){e=e||E,C.debug("[ClientApiHandler]: wakeUp...");var t={type:i.UserActionType.WAKE_UP};f(i.ContentType.USER,t,function(t,n){v(t,n,e)&&e(null)})},this.getDevices=function(e){e=e||E,C.debug("[ClientApiHandler]: getDevices...");var t={type:i.UserActionType.GET_DEVICES};f(i.ContentType.USER,t,function(t,n){v(t,n,e)&&e(null,n.user.getDevices.devices)})},this.getTelephonyData=function(e){e=e||E,C.debug("[ClientApiHandler]: getTelephonyData...");var t={type:i.UserActionType.GET_TELEPHONY_DATA};f(i.ContentType.USER,t,function(t,n){v(t,n,e)&&e(null,n.user.getTelephonyData.data)})},this.getConnectedApps=function(e){e=e||E,C.debug("[ClientApiHandler]: getConnectedApps...");var t={type:i.UserActionType.OAUTH_GET_GRANTED_ACCESS_TOKENS};f(i.ContentType.USER,t,function(t,n){v(t,n,e,!0)&&e(null,n.user.oAuthGetGrantedAccessTokens.oAuthGrantedAccess)})},this.revokeAccessToken=function(e,t){t=t||E,C.debug("[ClientApiHandler]: revokeAccessToken...");var n={type:i.UserActionType.OAUTH_REVOKE_ACCESS_TOKEN,oAuthRevokeGrantedAccessToken:{tokenId:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null)})},this.revokeAllManagedDevices=function(e){e=e||E,C.debug("[ClientApiHandler]: revokeAllManagedDevices...");var t={type:i.UserActionType.REVOKE_MANAGED_DEVICES};f(i.ContentType.USER,t,function(t,n){v(t,n,e)&&e(null)})},this.getSecurityTokenInfo=function(e){e=e||E,C.debug("[ClientApiHandler]: getSecurityTokenInfo...");var t={type:i.UserActionType.GET_SECURITY_TOKEN_INFO};f(i.ContentType.USER,t,function(t,n){v(t,n,e,!0)&&e(null,n.user.getSecurityTokenInfoResult.securityTokenInfo)})},this.revokeSecurityToken=function(e,t){t=t||E,C.debug("[ClientApiHandler]: revokeSecurityToken...");var n={type:i.UserActionType.REVOKE_SECURITY_TOKEN,revokeSecurityToken:{tokenIdHash:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null)})},this.getUserTenantSettings=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getUserTenantSettings...");var n={type:i.UserActionType.GET_TENANT_SETTINGS};f(i.ContentType.USER,n,function(t,n){v(t,n,e,!0)&&e(null,n.user.getTenantSettings.tenantSettings)},null,null,t)},this.resetOpenScapeDevicePins=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: resetOpenScapeDevicePins...");var r={type:i.UserActionType.RESET_OPENSCAPE_DEVICE_PINS,resetOpenScapeDevicePins:{circuitUserId:e,directoryNumber:t}};f(i.ContentType.USER,r,function(e,t){v(e,t,n)&&n(null,t.user.resetOpenScapeDevicePins.openScapeDevicePins)},null,["response.user.resetOpenScapeDevicePins.openScapeDevicePins"])},this.setClientCapabilities=function(e,t){t=t||E,C.debug("[ClientApiHandler]: setClientCapabilities...");var n={type:i.UserActionType.SET_CLIENT_CAPABILITIES,setClientCapabilities:{capabilities:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null)})},this.getTenantIdToNameMap=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getTenantIdToNameMap...");var r={type:i.UserActionType.GET_TENANT_ID_TO_NAME_MAP,getTenantIdToNameMap:{secIds:e}};f(i.ContentType.USER,r,function(e,n){v(e,n,t,!0)&&t(null,n.user.getTenantIdToNameMapResult.tenantIdToNameMap||[])},null,null,n)},this.getRecentUsedCMRs=function(e){if(e=e||E,C.debug("[ClientApiHandler]: getRecentUsedCMRs..."),!this.isRecentCMRsSupported())return C.warn("[ClientApiHandler]: getRecentUsedCMRs is not supported by the backend"),void A(e,i.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:i.UserActionType.GET_RECENT_USED_CMRS};f(i.ContentType.USER,t,function(t,n){v(t,n,e,!0)&&e(null,n.user.getRecentUsedCMRsResult.cmrUser||[])})},this.addRecentUsedCMR=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: addRecentUsedCMR..."),!this.isRecentCMRsSupported())return C.warn("[ClientApiHandler]: addRecentUsedCMR is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.UserActionType.ADD_RECENT_USED_CMR,addRecentUsedCMR:{cmrUserId:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null)})},this.isAllowedToAddCmr=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: isAllowedToAddCmr..."),!this.isAllowedToAddCmrSupported())return C.warn("[ClientApiHandler]: isAllowedToAddCmr is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.UserActionType.IS_ALLOWED_TO_ADD_CMR,isAllowedToAddCMR:{inviterUserId:e}};f(i.ContentType.USER,n,function(e,n){v(e,n,t)&&t(null,!!n.user.isAllowedToAddCmrResult.isAllowed)})},this.startBasicSearch=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: startBasicSearch...");var r={type:i.SearchActionType.START_BASIC_SEARCH,startBasicSearch:{searchTerm:e,priorizedConvs:t||void 0,newSearch:!0}};f(i.ContentType.SEARCH,r,function(e,t){v(e,t,n)&&n(null,t.search.startSearchResult.searchId)})},this.startDetailSearch=function(e,t,n,r,o){o=o||E,C.debug("[ClientApiHandler]: startDetailSearch...");var a={type:i.SearchActionType.START_DETAIL_SEARCH,startDetailSearch:{searchTerm:e,convId:t,searchId:n||void 0,resultSetLimit:r||0}};f(i.ContentType.SEARCH,a,function(e,t){v(e,t,o)&&o(null,t.search.startSearchResult.searchId)})},this.cancelSearch=function(e,t){t=t||E,C.debug("[ClientApiHandler]: cancelSearch...");var n={type:i.SearchActionType.CANCEL_SEARCH,cancelSearch:{searchId:e}};f(i.ContentType.SEARCH,n,function(e,n){v(e,n,t)&&t(null)})},this.getRecentSearches=function(e){e=e||E;var t={type:i.SearchActionType.GET_RECENT_SEARCHES};f(i.ContentType.SEARCH,t,function(t,n){v(t,n,e,!0)&&e(null,n.search.getRecentSearch.recentSearches)})},this.addRecentSearch=function(e,t){t=t||E;var n={type:i.SearchActionType.ADD_RECENT_SEARCH,addRecentSearch:{searchTerm:e}};f(i.ContentType.SEARCH,n,function(e,n){v(e,n,t)&&t(null)})},this.startUserSearch=function(e,t){t=t||E;var n={type:i.SearchActionType.START_USER_SEARCH,startUserSearch:{query:e.query,reversePhoneNumberLookup:!!e.reversePhoneNumberLookup}};f(i.ContentType.SEARCH,n,function(e,n){v(e,n,t)&&t(null,n.search.startSearchResult.searchId)})},this.startAdvancedUserSearch=function(e,t){t=t||E,C.debug("[ClientApiHandler]: startAdvancedUserSearch...");var n={type:i.SearchActionType.START_ADVANCED_USER_SEARCH,startAdvancedUserSearch:{searchContext:e.searchContext,query:e.query,searchExactAssignedPhoneNumber:e.searchExactAssignedPhoneNumber,resultSetLimit:e.resultSetLimit}};f(i.ContentType.SEARCH,n,function(e,n){v(e,n,t)&&t(null,n.search.startSearchResult.searchId)})},this.searchConversationParticipants=function(e,t,n){n=n||E;var r={type:i.SearchActionType.SEARCH_CONVERSATION_PARTICIPANTS,searchConversationParticipants:{displayName:e,convId:t}};f(i.ContentType.SEARCH,r,function(e,t){v(e,t,n,!0)&&n(null,t.search.searchConversationParticipantsResult.participants||[])})},this.createConversation=function(e,t){t=t||E,C.debug("[ClientApiHandler]: createConversation...");var n=e.type;n||(n=e.participants.length>2?i.ConversationType.GROUP:i.ConversationType.DIRECT);var r={type:i.ConversationActionType.CREATE,create:{type:n,topic:e.topic,description:e.description||void 0,participants:e.participants,invitations:e.emailAddresses,locale:e.locale}};f(i.ContentType.CONVERSATION,r,function(e,n){v(e,n,t)&&t(null,n.conversation.create.conversation,n.code===i.ReturnCode.ENTITY_ALREADY_EXISTS)},["request.conversation.create.topic","request.conversation.create.description"],["response.conversation.create.conversation.topic","response.conversation.create.conversation.description","response.conversation.create.conversation.topLevelItem"])},this.updateConversation=function(e,t){t=t||E,C.debug("[ClientApiHandler]: updateConversation...");var n={type:i.ConversationActionType.UPDATE,update:{convId:e.conversationId,topic:e.topic,description:e.description}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.update.conversation)},["request.conversation.update.topic","request.conversation.update.description"],["response.conversation.update.conversation.participants","response.conversation.update.conversation.topic","response.conversation.update.conversation.description","response.conversation.update.conversation.topLevelItem"])},this.addTextItem=function(e,t){t=t||E,C.error("[ClientApiHandler]: addTextItem...");var n=y(e),r={type:i.ConversationActionType.ADD_TEXT_ITEM,addTextItem:{convId:e.convId,parentId:e.parentId,contentType:e.contentType,subject:e.subject,content:n,attachmentMetaData:N(e.attachmentMetaData),externalAttachmentMetaData:h(e.externalAttachmentMetaData),preview:e.preview,formMetaData:e.form,mentionedUsers:e.mentionedUsers,conceptboards:e.conceptboards}};r.addTextItem.preview&&r.addTextItem.preview.description&&(r.addTextItem.preview.description=r.addTextItem.preview.description.substr(0,255));f(i.ContentType.CONVERSATION,r,function(e,n){v(e,n,t)&&t(null,n.conversation.addTextItem.item)},["request.conversation.addTextItem.subject","request.conversation.addTextItem.content"],["response.conversation.addTextItem.item.text"])},this.updateTextItem=function(e,t){t=t||E,C.debug("[ClientApiHandler]: updateTextItem...");var n=y(e),r={itemId:e.itemId,convId:e.convId,parentId:e.parentId,contentType:i.TextItemContentType.RICH,subject:e.subject,content:n,attachmentMetaData:N(e.attachmentMetaData),preview:e.preview||{},formMetaData:e.form,clustered:e.clustered,externalAttachmentMetaData:h(e.externalAttachmentMetaData),mentionedUsers:e.mentionedUsers,conceptboards:e.conceptboards};r.preview.description&&(r.preview.description=r.preview.description.substr(0,255)),r.externalAttachmentMetaData&&0!==r.externalAttachmentMetaData.length||(r.externalAttachmentMetaData=[{type:"BOX",downloadLocation:"",previewLocation:"",attachment:{}}]),r.attachmentMetaData&&0!==r.attachmentMetaData.length||(r.attachmentMetaData=[{}]);var o={type:i.ConversationActionType.UPDATE_TEXT_ITEM,updateTextItem:r};f(i.ContentType.CONVERSATION,o,function(e,n){v(e,n,t)&&t(null,n.conversation.updateTextItem.item)},["request.conversation.updateTextItem.subject","request.conversation.updateTextItem.content"],["response.conversation.updateTextItem.item.text"])},this.deleteTextItem=function(e,t){if(t=t||E,!e||!e.itemId)return C.warn("[ClientApiHandler]: No request parameters were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);C.debug("[ClientApiHandler]: deleteTextItem...");var n={type:i.ConversationActionType.DELETE_TEXT_ITEM,deleteTextItem:{itemId:e.itemId}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.deleteTextItem.item)})},this.deleteRecording=function(e,t){t=t||E,C.debug("[ClientApiHandler]: deleteRecording...");var n={type:i.ConversationActionType.DELETE_RECORDING,deleteRecording:{itemId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.deleteRecording.item)})},this.updateRtcItemAttachments=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: updateRtcItemAttachments...");var r={type:i.ConversationActionType.UPDATE_RTC_ITEM_ATTACHMENTS,updateRtcItemAttachments:{itemId:e,attachments:N(t)}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.updateRtcItemAttachmentsResult.item)})},this.getOpenConversations=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: getOpenConversations...");var r={type:i.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:e,numberOfItems:t}};f(i.ContentType.CONVERSATION,r,function(e,t){if(v(e,t,n,!0)){var i=t.conversation.getOpenConversations;n(null,i.conversations,i.lastItemIndex)}},null,["response.conversation.getOpenConversations.conversations"])},this.getAllOpenConversations=function(e,t,n,r){r=r||E,C.debug("[ClientApiHandler]: getAllOpenConversations...");var o={type:i.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:e,numberOfItems:t,ownIncluded:!0,sorting:n}};f(i.ContentType.CONVERSATION,o,function(e,t){if(v(e,t,r,!0)){var n=t.conversation.getOpenConversations;r(null,n.conversations,n.lastItemIndex)}},null,["response.conversation.getOpenConversations.conversations"])},this.joinOpenConversation=function(e,t){t=t||E,C.debug("[ClientApiHandler]: JoinOpenConversation...");var n={type:i.ConversationActionType.JOIN_OPEN_CONVERSATION,joinOpenConversation:{convId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.joinOpenConversation.conv)})},this.getConversationFeed=function(e,t,n,r,o,a,s){s=s||E,C.debug("[ClientApiHandler]: getConversationFeed...");var c={type:i.ConversationActionType.GET_CONVERSATION_FEED,getConversationFeed:{convId:e,timestamp:t||void 0,minTotalItems:n||void 0,maxTotalUnread:r||void 0,commentsPerThread:o||void 0,maxUnreadPerThread:a||void 0}};f(i.ContentType.CONVERSATION,c,function(e,t){if(v(e,t,s,!0)){var n=t.conversation.getConversationFeedResult;s(null,n.conversationThreads,n.hasOlderThreads)}},null,["response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.attachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.rtc","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.text","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.system","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].attachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].text"])},this.getConversationTopics=function(e,t,n,r){r=r||E,C.debug("[ClientApiHandler]: getConversationTopics...");var o={type:i.ConversationActionType.GET_CONVERSATION_TOPICS,getConversationTopics:{convId:e,timestamp:t||void 0,maxNumberOfTopics:n||void 0}};f(i.ContentType.CONVERSATION,o,function(e,t){if(v(e,t,r,!0)){var n=t.conversation.getConversationTopicsResult;r(null,n.conversationTopics,n.hasOlderTopics)}},null,["response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.attachments","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.externalAttachments","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.rtc","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.text","response.conversation.getConversationTopicsResult.conversationTopics.[].parentItem.system","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.attachments","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.externalAttachments","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.rtc","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.text","response.conversation.getConversationTopicsResult.conversationTopics.[].lastItem.system"])},this.pinTopic=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: pinTopic..."),!e||!e.convId||!e.topicId)return C.warn("[ClientApiHandler]: No request parameters were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var n={type:i.ConversationActionType.PIN_TOPIC,pinTopic:{convId:e.convId,topicId:e.topicId}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.pinTopicResult.conversation)},null,["response.conversation.pinTopicResult.conversation"])},this.unpinTopic=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: unpinTopic..."),!e||!e.convId||!e.topicId)return C.warn("[ClientApiHandler]: No request parameters were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var n={type:i.ConversationActionType.UNPIN_TOPIC,unpinTopic:{convId:e.convId,topicId:e.topicId}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.unpinTopicResult.conversation)},null,["response.conversation.unpinTopicResult.conversation"])},this.getThreadComments=function(e,t,n,r,o,a,s){s=s||E,C.debug("[ClientApiHandler]: getThreadComments...");var c={type:i.ConversationActionType.GET_THREAD_COMMENTS,getThreadComments:{convId:e,threadId:t,timestamp:n||void 0,timestampFilter:r||i.TimestampFilter.CREATION,direction:o||void 0,totalComments:a||void 0}};f(i.ContentType.CONVERSATION,c,function(e,t){if(v(e,t,s,!0)){var n=t.conversation.getThreadCommentsResult;s(null,n.comments,n.hasMoreComments)}},null,["response.conversation.getThreadCommentsResult.comments.[].attachments","response.conversation.getThreadCommentsResult.comments.[].externalAttachments","response.conversation.getThreadCommentsResult.comments.[].text"])},this.getThreadsByItemIds=function(e,t){if(C.debug("[ClientApiHandler]: getThreadsByItemIds..."),t=t||E,!e)return C.warn("[ClientApiHandler]: No request parameters were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);if(!e.convId)return C.warn("[ClientApiHandler]: No conversation id was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);if(!e.threadParams)return C.warn("[ClientApiHandler]: No thread parameters were provided (item ids were not provided)"),void A(t,i.ReturnCode.INVALID_MESSAGE);var n={type:i.ConversationActionType.GET_THREADS_BY_ITEM_IDS,getThreadsByItemIds:{convId:e.convId,threadParams:e.threadParams,timestampFilter:e.timestampFilter||void 0,orderBy:e.orderBy||void 0}};f(i.ContentType.CONVERSATION,n,function(e,n){if(v(e,n,t,!0)){var i=n.conversation.getThreadsByItemIdsResult;t(null,i&&i.conversationThreadContext)}},null,["response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.rtc","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.system","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].text"])},this.getThreadsByIds=function(e,t){if(C.debug("[ClientApiHandler]: getThreadsByIds..."),t=t||E,!e)return C.warn("[ClientApiHandler]: No request parameters were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);if(!e.convId)return C.warn("[ClientApiHandler]: No conversation id was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);if(!(e.threadIds instanceof Array&&e.threadIds.length>0))return C.warn("[ClientApiHandler]: No thread parameters were provided (thread ids were not provided)"),void A(t,i.ReturnCode.INVALID_MESSAGE);var n={type:i.ConversationActionType.GET_THREADS_BY_IDS,getThreadsByIds:{convId:e.convId,threadIds:e.threadIds,orderBy:e.orderBy||i.SortingType.TIMESTAMP_ASC,commentsPerThread:e.commentsPerThread||void 0}};f(i.ContentType.CONVERSATION,n,function(e,n){if(v(e,n,t,!0)){var i=n.conversation.getThreadsByIdsResult;t(null,i&&i.conversationThreads)}},null,["response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.rtc","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.text","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.system","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].text"])},this.getConversations=function(e,t,n,r,o,a){a=a||E,C.debug("[ClientApiHandler]: getConversations...");var s=n?i.SearchDirection.BEFORE:i.SearchDirection.AFTER,c={type:i.ConversationActionType.GET_CONVERSATIONS,getConversations:{userId:e,modificationDate:t||void 0,direction:s,number:r||void 0,filter:o||i.ConversationFilter.ALL,sortByLastItem:!!n}};f(i.ContentType.CONVERSATION,c,function(e,t){v(e,t,a,!0)&&a(null,t.conversation.getConversations.conversations)},null,["response.conversation.getConversations.conversations"])},this.getSupportConversation=function(e){e=e||E,C.debug("[ClientApiHandler]: getSupportConversation...");var t={type:i.ConversationActionType.GET_SUPPORT_CONVERSATION};f(i.ContentType.CONVERSATION,t,function(t,n){v(t,n,e)&&e(null,n.conversation.getSupportConversation.conversation)},null,["response.conversation.getSupportConversation.conversation.topLevelItem"])},this.getSupportConversationId=function(e){e=e||E,C.debug("[ClientApiHandler]: getSupportConversationId...");var t={type:i.ConversationActionType.GET_SUPPORT_CONVERSATION_ID};f(i.ContentType.CONVERSATION,t,function(t,n){v(t,n,e)&&e(null,n.conversation.getSupportConversationId.conversationId)})},this.getTelephonyConversationId=function(e){e=e||E,C.debug("[ClientApiHandler]: getTelephonyConversationId...");var t={type:i.ConversationActionType.GET_TELEPHONY_CONVERSATION_ID};f(i.ContentType.CONVERSATION,t,function(t,n){v(t,n,e)&&e(null,n.conversation.getTelephonyConversationId.conversationId)})},this.getMarkedConversationsList=function(e){e=e||E,C.debug("[ClientApiHandler]: getMarkedConversationsList...");var t={type:i.ConversationActionType.GET_MARKED_CONVERSATIONS_LIST};f(i.ContentType.CONVERSATION,t,function(t,n){v(t,n,e)&&e(null,n.conversation.getMarkedConversationsList)})},this.getFavoriteConversationIds=function(e){e=e||E,C.debug("[ClientApiHandler]: getFavoriteConversationIds...");var t={type:i.ConversationActionType.GET_FAVORITE_CONVERSATION_IDS};f(i.ContentType.CONVERSATION,t,function(t,n){v(t,n,e,!0)&&e(null,n.conversation.getFavoriteConversationIdResult.favoriteConversationIds)})},this.markConversation=function(e,t){t=t||E;var n={type:i.ConversationActionType.MARK_CONVERSATION,markConversation:{convId:e.convId,filter:e.markType}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null)})},this.unmarkConversation=function(e,t){t=t||E;var n={type:i.ConversationActionType.UNMARK_CONVERSATION,unmarkConversation:{convId:e.convId,filter:e.markType}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null)})},this.getConversationUserData=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: getConversationUserData..."),e instanceof Array||(e=[e]);var r={type:i.ConversationActionType.GET_CONVERSATION_USER_DATA,getConversationUserData:{conversationId:e,userDataToInclude:t||void 0}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.getConversationUserData.userData)})},this.getConversationItems=function(e,t,n,r,o,a){a=a||E,C.debug("[ClientApiHandler]: getConversationItems...");var s={type:i.ConversationActionType.GET_ITEMS_BY_CONVERSATION,getItemsByConversation:{convId:e,modificationDate:t||void 0,creationDate:n||void 0,direction:r||void 0,number:o||void 0}};f(i.ContentType.CONVERSATION,s,function(e,t){v(e,t,a,!0)&&a(null,t.conversation.getItemsByConversation.items)},null,["response.conversation.getItemsByConversation.items.[].attachments","response.conversation.getItemsByConversation.items.[].externalAttachments","response.conversation.getItemsByConversation.items.[].rtc","response.conversation.getItemsByConversation.items.[].text","response.conversation.getItemsByConversation.items.[].system"])},this.getConversationAttachments=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: getConversationAttachments...");var r={type:i.ConversationActionType.GET_ATTACHMENTS,getAttachments:{conversationId:e,startPage:t.page||void 0,pageSize:t.size||void 0,orderType:t.type||void 0,orderDirection:t.direction||void 0}};f(i.ContentType.CONVERSATION,r,function(e,t){if(v(e,t,n)){var i=t.conversation.getAttachments.attachments||[],r=t.conversation.getAttachments.nextPage.hasMoreAttachments?t.conversation.getAttachments.nextPage.lastIndex:null;n(null,i,r)}})},this.getItemsByConversationItemId=function(e,t,n,r,o,a){a=a||E,C.debug("[ClientApiHandler]: getItemsByConversationItemId...");var s={type:i.ConversationActionType.GET_ITEMS_BY_CONVERSATION_ITEM_ID,getItemsByConversationItemId:{convId:e,itemId:t,direction:n||void 0,number:r||void 0,orderType:o||void 0}};f(i.ContentType.CONVERSATION,s,function(e,t){v(e,t,a,!0)&&a(null,t.conversation.getItemsByConversationItemId.items)},null,["response.conversation.getItemsByConversationItemId.items.[].attachments","response.conversation.getItemsByConversationItemId.items.[].externalAttachments","response.conversation.getItemsByConversationItemId.items.[].rtc","response.conversation.getItemsByConversationItemId.items.[].text","response.conversation.getItemsByConversationItemId.items.[].system"])},this.getConversationById=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getConversationById...");var n={type:i.ConversationActionType.GET_CONVERSATION_BY_ID,getConversationById:{convId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){if(v(e,n,t)){var i=n.conversation.getConversationById.conversation;i&&i.participants&&C.info("[ClientApiHandler]: Retrieved conversation has "+i.participants.length+" participant(s)"),t(null,i)}},null,["response.conversation.getConversationById.conversation.participants","response.conversation.getConversationById.conversation.topic","response.conversation.getConversationById.conversation.description","response.conversation.getConversationById.conversation.topLevelItem"])},this.getConversationsByIds=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getConversationsByIds...");var n={type:i.ConversationActionType.GET_CONVERSATIONS_BY_IDS,getConversationsByIds:{conversationId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t,!0)&&t(null,n.conversation.getConversationsByIdsResult.conversations)},null,["response.conversation.getConversationsByIdsResult.conversations"])},this.getItemById=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getItemById...");var n={type:i.ConversationActionType.GET_ITEM_BY_ID,getItemById:{itemId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.getItemById.item)},null,["response.conversation.getItemById.item.attachments","response.conversation.getItemById.item.externalAttachments","response.conversation.getItemById.item.rtc","response.conversation.getItemById.item.text","response.conversation.getItemById.item.system"])},this.getItemsByIds=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getItemsByIds...");var n={type:i.ConversationActionType.GET_ITEMS_BY_IDS,getItemsByIds:{itemIds:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t,!0)&&t(null,n.conversation.getItemsByIds.items)},null,["response.conversation.getItemsByIds.items.[].attachments","response.conversation.getItemsByIds.items.[].externalAttachments","response.conversation.getItemsByIds.items.[].rtc","response.conversation.getItemsByIds.items.[].text","response.conversation.getItemsByIds.items.[].system"])},this.setReadPointer=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: setReadPointer...");var r={type:i.ConversationActionType.SET_READ_POINTER,setReadPointer:{convId:e,lastReadTimestamp:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null)})},this.getConversationByUser=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getConversationByUser...");var n={type:i.ConversationActionType.GET_CONVERSATION_BY_USER,getConversationByUser:{userId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.getConversationByUser.conversation)},null,["response.conversation.getConversationByUser.conversation.topic","response.conversation.getConversationByUser.conversation.description","response.conversation.getConversationByUser.conversation.topLevelItem"])},this.getConversationsByFilter=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getConversationsByFilter...");var n={type:i.ConversationActionType.GET_CONVERSATIONS_BY_FILTER,getConversationsByFilter:{conversationsFilter:e.filterConnector,timestamp:e.timestamp||void 0,number:e.number,numberOfParticipants:e.numberOfParticipants,retrieveAction:e.retrieveAction||void 0}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.getConversationsByFilterResult||{})},null,["response.conversation.getConversationsByFilterResult.conversations"])},this.subscribe=function(e,t){t=t||E,C.debug("[ClientApiHandler]: subscribe...");var n={type:i.ConversationActionType.SUBSCRIBE,subscribe:{conversationId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null)})},this.unsubscribe=function(e,t){t=t||E,C.debug("[ClientApiHandler]: unsubscribe...");var n={type:i.ConversationActionType.UNSUBSCRIBE,unsubscribe:{conversationId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null)})},this.typing=function(e,t,n,r){r=r||E,C.debug("[ClientApiHandler]: typing...");var o={type:i.ConversationActionType.TYPING,typing:{conversationId:e,isTyping:t,parentItemId:n}};f(i.ContentType.CONVERSATION,o,function(e,t){v(e,t,r)&&r(null)})},this.addParticipant=function(e,t){t=t||E,C.debug("[ClientApiHandler]: addParticipant...");var n={type:i.ConversationActionType.ADD_PARTICIPANT,addParticipant:{convId:e.convId,userId:e.userId,invitations:e.emailAddresses,locale:e.locale}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.addParticipant)})},this.removeParticipant=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: removeParticipant..."),!t||t instanceof Array||(t=[t]);var r={type:i.ConversationActionType.REMOVE_PARTICIPANT,removeParticipant:{convId:e,userId:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.removeParticipant.conversation)})},this.getConversationParticipants=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: getConversationParticipants..."),t=t||{};var r={type:i.ConversationActionType.GET_CONVERSATION_PARTICIPANTS,getConversationParticipants:{convId:e,searchCriterias:t.searchCriterias||void 0,searchPointer:t.searchPointer||void 0,pageSize:t.pageSize||25,includePresence:!!t.includePresence}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.getConversationParticipantsResult)})},this.getConversationDetails=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: getConversationDetails..."),!this.isGetConversationDetailsSupported())return C.warn("[ClientApiHandler]: getConversationDetails is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.ConversationActionType.GET_CONVERSATION_DETAILS,getConversationDetails:{conversationId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.conversationDetails)},null,["response.conversation.conversationDetails.joinDetails.link","response.conversation.conversationDetails.joinDetails.tenantPIN","response.conversation.conversationDetails.joinDetails.sessionPIN"])},this.getJoinDetails=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: getJoinDetails...");var r={type:i.ConversationActionType.GET_JOIN_DETAILS,getJoinDetails:{conversationId:e,recreate:!!t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.getJoinDetails)},null,["response.conversation.getJoinDetails.link","response.conversation.getJoinDetails.tenantPIN","response.conversation.getJoinDetails.sessionPIN"])},this.setFlagItem=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: setFlagItem..."),!e)return C.warn("[ClientApiHandler]: No request parameters were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var n={type:i.ConversationActionType.SET_FLAG_ITEM,setFlagItem:{conversationId:e.convId,conversationItemId:e.itemId,conversationItemCreationTime:e.creationTime,conversationParentId:e.parentId}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null)})},this.clearFlagItem=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: clearFlagItem...");var r={type:i.ConversationActionType.CLEAR_FLAG_ITEM,clearFlagItem:{conversationId:e,conversationItemId:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null)})},this.getFlaggedItems=function(e){e=e||E,C.debug("[ClientApiHandler]: getFlaggedItems...");var t={type:i.ConversationActionType.GET_FLAGGED_ITEMS};f(i.ContentType.CONVERSATION,t,function(t,n){v(t,n,e,!0)&&e(null,n.conversation.getFlaggedItem.flaggedItems)})},this.likeTextItem=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: likeTextItem...");var r={type:i.ConversationActionType.LIKE_TEXT_ITEM,likeTextItem:{conversationItemId:e,userId:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null)})},this.unlikeTextItem=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: unlikeTextItem...");var r={type:i.ConversationActionType.UNLIKE_TEXT_ITEM,unlikeTextItem:{conversationItemId:e,userId:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null)})},this.setConvAvatar=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: setConvAvatar...");var r={type:i.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:e,imageS:t.s,imageL:t.b}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.setConversationAvatar.conversation)})},this.deleteConvAvatar=function(e,t){t=t||E,C.debug("[ClientApiHandler]: deleteConvAvatar...");var n={type:i.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:e,imageS:"",imageL:""}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.setConversationAvatar.conversation)})},this.moderateConversation=function(e,t){t=t||E,C.debug("[ClientApiHandler]: moderateConversation...");var n={type:i.ConversationActionType.MODERATE_CONVERSATION,moderateConversation:{convId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.moderateResult)})},this.unmoderateConversation=function(e,t){t=t||E,C.debug("[ClientApiHandler]: unmoderateConversation...");var n={type:i.ConversationActionType.UNMODERATE_CONVERSATION,unmoderateConversation:{convId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.moderateResult)})},this.setConversationRetentionPolicy=function(e,t,n){if(n=n||E,C.debug("[ClientApiHandler]: setConversationRetentionPolicy..."),!this.isSetConversationRetentionPolicySupported())return C.warn("[ClientApiHandler]: setConversationRetentionPolicy is not supported by the backend"),void A(n,i.ReturnCode.OPERATION_NOT_SUPPORTED);var r={type:i.ConversationActionType.SET_CONVERSATION_RETENTION_POLICY,setConversationRetentionPolicy:{convId:e,disabled:!!t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null)})},this.updateGuestAccess=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: updateGuestAccess...");var r={type:i.ConversationActionType.UPDATE_GUEST_ACCESS,updateGuestAccess:{convId:e,guestAccessDisabled:!!t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.updateGuestAccessResult)})},this.getConversationSummary=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: getConversationSummary...");var r={type:i.ConversationActionType.GET_CONVERSATION_SUMMARY,getConversationSummary:{convId:e}};t&&(r.getConversationSummary.inviteToken={token:t}),f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.getConversationSummary.conversationSummary)})},this.grantModeratorRights=function(e,t,n){n=n||E,t instanceof Array||(t=[t]),C.debug("[ClientApiHandler]: grantModeratorRights...");var r={type:i.ConversationActionType.GRANT_MODERATOR_RIGHTS,grantModeratorRights:{convId:e,userId:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.grantModeratorRightsResult)})},this.dropModeratorRights=function(e,t,n){n=n||E,t instanceof Array||(t=[t]),C.debug("[ClientApiHandler]: dropModeratorRights...");var r={type:i.ConversationActionType.DROP_MODERATOR_RIGHTS,dropModeratorRights:{convId:e,userId:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.dropModeratorRightsResult)})},this.takeModerationRight=function(e,t){t=t||E,C.debug("[ClientApiHandler]: takeModerationRight...");var n={type:i.ConversationActionType.TAKE_MODERATION_RIGHT,takeModerationRight:{convId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.takeModerationRightResult.moderationTakenResult)})},this.addJournalEntry=function(e,t){t=t||E,C.debug("[ClientApiHandler]: addJournalEntry...");var n={type:i.ConversationActionType.ADD_JOURNAL_ENTRY,addJournalEntry:{convId:e.convId,starter:e.starter,source:e.source,destination:e.destination,startTime:e.startTime,duration:e.duration,type:e.type,participants:e.participants,missedReason:e.missedReason}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null)})},this.setFavoritePosition=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: setFavoritePosition...");var r={type:i.ConversationActionType.SET_FAVORITE_POSITION,setFavoritePosition:{convId:e,position:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t)})},this.addLabels=function(e,t){t=t||E,C.debug("[ClientApiHandler]: addLabels...");var n={type:i.ConversationActionType.ADD_LABELS,addLabels:{labels:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.addLabelsResult.labels)})},this.assignLabels=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: assignLabels...");var r={type:i.ConversationActionType.ASSIGN_LABELS,assignLabels:{convId:e,labelIds:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.assignLabelsResult.labelIds)})},this.unassignLabels=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: unassignLabels...");var r={type:i.ConversationActionType.UNASSIGN_LABELS,unassignLabels:{convId:e,labelIds:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n,!0)&&n(null,t.conversation.unassignLabelsResult.labelIds)})},this.getAllLabels=function(e){e=e||E,C.debug("[ClientApiHandler]: getAllLabels...");var t={type:i.ConversationActionType.GET_LABELS};f(i.ContentType.CONVERSATION,t,function(t,n){v(t,n,e,!0)&&e(null,n.conversation.getLabelsResult.labels)})},this.removeLabels=function(e,t){t=t||E,C.debug("[ClientApiHandler]: removeLabels...");var n={type:i.ConversationActionType.REMOVE_LABELS,removeLabels:{labelIds:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t,!0)&&t(null,n.conversation.removeLabelsResult.labelIds)})},this.editLabel=function(e,t){t=t||E,C.debug("[ClientApiHandler]: editLabel...");var n={type:i.ConversationActionType.EDIT_LABEL,editLabel:{label:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.editLabelResult.label)})},this.addFilter=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: addFilter...");var r={type:i.ConversationActionType.ADD_FILTER,addFilter:{filterName:e,root:t}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.addFilterResult)})},this.removeFilter=function(e,t){t=t||E,C.debug("[ClientApiHandler]: removeFilters...");var n={type:i.ConversationActionType.REMOVE_FILTERS,removeFilters:{filterIds:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t,!0)&&t(null,n.conversation.removeFiltersResult.filterIds)})},this.getAllFilters=function(e){e=e||E,C.debug("[ClientApiHandler]: getAllFilters...");var t={type:i.ConversationActionType.GET_FILTERS,getFilters:{}};f(i.ContentType.CONVERSATION,t,function(t,n){v(t,n,e,!0)&&e(null,n.conversation.getFiltersResult.filters)})},this.editFilter=function(e,t){t=t||E,C.debug("[ClientApiHandler]: editFilter...");var n={type:i.ConversationActionType.EDIT_FILTER,editFilter:{filter:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null,n.conversation.editFilterResult)})},this.getUserDataSince=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getUserDataSince...");var n={type:i.ConversationActionType.GET_USER_DATA_SINCE,getUserDataSince:{sinceTime:e}};f(i.ContentType.CONVERSATION,n,function(e,n){if(v(e,n,t,!0)){var i=n.conversation.getUserDataSinceResult&&n.conversation.getUserDataSinceResult.changedUserData||[];t(null,i)}})},this.getConferenceInvitationText=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: getConferenceInvitationText...");var r={type:i.ConversationActionType.GET_CONFERENCE_INVITATION_TEXT,getConferenceInvitationText:{conversationId:t,language:e}};f(i.ContentType.CONVERSATION,r,function(e,t){v(e,t,n)&&n(null,t.conversation.getConferenceInvitationResult.invitationMessage)},null,["response.conversation.getConferenceInvitationResult.invitationMessage"])},this.getConferenceInvitationExample=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getConferenceInvitationExample...");var r={type:i.ConversationActionType.GET_CONFERENCE_INVITATION_EXAMPLE,getConferenceInvitationExample:{language:e}};f(i.ContentType.CONVERSATION,r,function(e,n){v(e,n,t)&&t(null,n.conversation.getConferenceInvitationResult.invitationMessage)},null,null,n)},this.deleteCallLog=function(e,t){var n={type:i.ConversationActionType.DELETE_JOURNAL_ENTRY,deleteJournalEntry:{journalEntryId:e}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t)&&t(null)})},this.getJournalEntries=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: getJournalEntries..."),!this.isCallLogFilteringSupported())return C.warn("[ClientApiHandler]: The getJournalEntries operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.ConversationActionType.GET_JOURNAL_ENTRIES,getJournalEntries:{telephonyConversationId:e.convId,timestamp:e.timestamp||void 0,direction:e.direction||void 0,numberOfEntries:e.numberOfEntries||void 0,journalFilter:e.journalFilter||void 0}};f(i.ContentType.CONVERSATION,n,function(e,n){v(e,n,t,!0)&&t(null,n.conversation.getJournalEntriesResult.entries)},null,["response.conversation.getJournalEntriesResult.entries"])},this.joinRtcCall=function(e,t){t=t||E,C.debug("[ClientApiHandler]: joinRtcCall...");var n={type:i.RTCCallActionType.JOIN,join:O(e)};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null)})},this.answerRtcCall=function(e,t){t=t||E,C.debug("[ClientApiHandler]: answerRtcCall...");var n={type:i.RTCCallActionType.ANSWER,answer:O(e)};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null)})},this.sendIceCandidates=function(e,t){t=t||E,C.debug("[ClientApiHandler]: sendIceCandidates...");var n={type:i.RTCCallActionType.ICE_CANDIDATES,iceCandidates:{rtcSessionId:e.rtcSessionId,userId:e.userId,origin:e.origin,candidates:e.candidates}};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null)})},this.leaveRtcCall=function(e,t,n){t=t||{},n=n||E,C.debug("[ClientApiHandler]: leaveRtcCall...");var r={type:i.RTCCallActionType.LEAVE,leave:{rtcSessionId:e,disconnectCause:t.cause,disconnectReason:t.reason}};f(i.ContentType.RTC_CALL,r,function(e,t){v(e,t,n)&&n(null)})},this.terminateRtcCall=function(e,t,n,r){t=t||{},n=n||E,C.debug("[ClientApiHandler]: terminateRtcCall...");var o={type:i.RTCCallActionType.TERMINATE,terminate:{rtcSessionId:e,disconnectCause:t.cause,disconnectReason:t.reason,pickUpUser:r||void 0}};f(i.ContentType.RTC_CALL,o,function(e,t){v(e,t,n)&&n(null)})},this.declineRtcCall=function(e,t){t=t||E,C.debug("[ClientApiHandler]: declineRtcCall...");var n={type:i.RTCCallActionType.INVITE_REJECT,inviteReject:{convId:e.convId,rtcSessionId:e.rtcSessionId,cause:e.cause,transactionId:e.transactionId}};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null)})},this.changeMediaType=function(e,t){t=t||E,C.debug("[ClientApiHandler]: changeMediaType...");var n={type:i.RTCCallActionType.CHANGE_MEDIA_TYPE,changeMediaType:{rtcSessionId:e.rtcSessionId,sdp:e.sdp,mediaTypes:g(e.mediaType),transactionId:e.transactionId,screenSharePointerSupported:e.screenSharePointerSupported,hosted:e.hosted,replaces:e.replaces,rtcSupportedFeatures:e.rtcSupportedFeatures}};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null)})},this.changeMediaAccept=function(e,t){t=t||E,C.debug("[ClientApiHandler]: changeMediaAccept...");var n={type:i.RTCCallActionType.CHANGE_MEDIA_ACCEPT,changeMediaAccept:{rtcSessionId:e.rtcSessionId,sdp:e.sdp,transactionId:e.transactionId}};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null)})},this.changeMediaReject=function(e,t){t=t||E,C.debug("[ClientApiHandler]: changeMediaReject...");var n={type:i.RTCCallActionType.CHANGE_MEDIA_REJECT,changeMediaReject:{rtcSessionId:e.rtcSessionId,transactionId:e.transactionId}};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null)})},this.prepareSession=function(e,t){t=t||E,C.debug("[ClientApiHandler]: prepareSession... ");var n={type:i.RTCCallActionType.PREPARE,prepare:{convId:e.convId,rtcSessionId:e.rtcSessionId,ownerId:e.ownerId,mediaNode:e.mediaNode,desiredRegion:e.desiredRegion||"",isTelephonyConversation:e.isTelephonyConversation,replaces:e.replaces}};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null,n.rtcCall.prepare.servers,n.rtcCall.prepare.newRtcSessionId)},null,["response.rtcCall.prepare.servers.[].password"])},this.renewTurnCredentials=function(e,t){t=t||E,C.debug("[ClientApiHandler]: renewTurnCredentials... ");var n={type:i.RTCCallActionType.RENEW_TURN_CREDENTIALS,renewTurnCredentials:{rtcSessionId:e}};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null,n.rtcCall.renewTurnCredentials.servers)},null,["response.rtcCall.renewTurnCredentials.servers.[].password"])},this.sendProgress=function(e,t,n,r){r=r||E,C.debug("[ClientApiHandler]: sendProgress... ");var o={type:i.RTCCallActionType.SEND_PROGRESS,sendProgress:{rtcSessionId:e,userId:n,invitingUser:t||"",type:i.RTCProgressType.ALERTING}};f(i.ContentType.RTC_CALL,o,function(e,t){v(e,t,r)&&r(null)})},this.submitCallQualityRating=function(e,t){t=t||E,C.debug("[ClientApiHandler]: submitCallQualityRating...");var n={type:i.RTCCallActionType.SUBMIT_RTC_QUALITY_RATING,submitRtcQualityRating:{rating:e}};f(i.ContentType.RTC_CALL,n,function(e,n){v(e,n,t)&&t(null)})},this.requestScreenControl=function(e,t){t=t||E,C.debug("[ClientApiHandler]: requestScreenControl ...");var n={type:i.RTCSessionActionType.REQUEST_SCREEN_CONTROL,requestScreenControl:{rtcSessionId:e.rtcSessionId,ownerId:e.ownerId}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.offerScreenControl=function(e,t){t=t||E,C.debug("[ClientApiHandler]: offerScreenControl ...");var n={type:i.RTCSessionActionType.OFFER_SCREEN_CONTROL,offerScreenControl:{sdp:e.sdp,rtcSessionId:e.rtcSessionId,controllerId:e.controllerId||void 0}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.acceptScreenControl=function(e,t){t=t||E,C.debug("[ClientApiHandler]: acceptScreenControl ...");var n={type:i.RTCSessionActionType.ACCEPT_SCREEN_CONTROL,acceptScreenControl:{sdp:e.sdp,rtcSessionId:e.rtcSessionId}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.rejectScreenControl=function(e,t){t=t||E,C.debug("[ClientApiHandler]: rejectScreenControl ...");var n={type:i.RTCSessionActionType.REJECT_SCREEN_CONTROL,rejectScreenControl:{rtcSessionId:e.rtcSessionId}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.rejectScreenControlRequest=function(e,t){t=t||E,C.debug("[ClientApiHandler]: rejectScreenControlRequest ...");var n={type:i.RTCSessionActionType.REJECT_SCREEN_CONTROL_REQUEST,rejectScreenControlRequest:{rtcSessionId:e.rtcSessionId,controllerId:e.controllerId}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.stopScreenControl=function(e,t){t=t||E,C.debug("[ClientApiHandler]: stopScreenControl ...");var n={type:i.RTCSessionActionType.STOP_SCREEN_CONTROL,stopScreenControl:{rtcSessionId:e.rtcSessionId}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.lockRtcSession=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: lockRtcSession...");var r={type:i.RTCSessionActionType.LOCK,lock:{rtcSessionId:e,locked:!!t}};f(i.ContentType.RTC_SESSION,r,function(e,t){v(e,t,n)&&n(null)})},this.muteRtcSession=function(e,t){t=t||E,C.debug("[ClientApiHandler]: muteRtcSession...");var n={type:i.RTCSessionActionType.MUTE_SESSION,muteSession:{rtcSessionId:e.rtcSessionId,muted:!!e.muted,excludedUserIds:e.excludedUserIds||void 0}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.muteParticipant=function(e,t){t=t||E,C.debug("[ClientApiHandler]: muteParticipant...");var n={type:i.RTCSessionActionType.MUTE,mute:{rtcSessionId:e.rtcSessionId,muted:!!e.muted,userIds:e.usersIds||void 0}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.addParticipantToRtcSession=function(e,t){t=t||E,C.debug("[ClientApiHandler]: addParticipantToRtcCall...");var n={type:i.RTCSessionActionType.ADD_PARTICIPANT,addParticipant:{rtcSessionId:e.rtcSessionId,userId:e.userId,from:e.from,to:e.to,mediaType:g(e.mediaType)}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.removeSessionParticipant=function(e,t){t=t||E,C.debug("[ClientApiHandler]: removeSessionParticipant...");var n={type:i.RTCSessionActionType.REMOVE_PARTICIPANT,removeParticipant:{rtcSessionId:e.rtcSessionId,userId:e.userId}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.getActiveSessions=function(e){e=e||E,C.debug("[ClientApiHandler]: getActiveSessions...");var t={type:i.RTCSessionActionType.GET_ACTIVE_SESSIONS};f(i.ContentType.RTC_SESSION,t,function(t,n){v(t,n,e,!0)&&e(null,n.rtcSession.activeSessions.session)})},this.getSession=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getSession...");var n={type:i.RTCSessionActionType.GET_SESSION,getSession:{rtcSessionId:e}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null,n.rtcSession.getSession.session)})},this.moveRtcSession=function(e,t){t=t||E,C.debug("[ClientApiHandler]: moveRtcSession...");var n={type:i.RTCSessionActionType.MOVE,move:{oldRtcSessionId:e.sessionId,oldConversationId:e.conversationId,newConversationId:e.newConversationId,newRtcSessionId:e.newSessionId}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.startRecording=function(e,t){t=t||E,C.debug("[ClientApiHandler]: startRecording...");var n={type:i.RTCSessionActionType.START_RECORDING,startRecording:{convId:e.convId,rtcSessionId:e.rtcSessionId,mediaTypes:g(e.mediaTypes)}};this.isVideoLayoutSupported()&&e.videoLayout&&(n.startRecording.layout=e.videoLayout),f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.stopRecording=function(e,t){t=t||E,C.debug("[ClientApiHandler]: stopRecording...");var n={type:i.RTCSessionActionType.STOP_RECORDING,stopRecording:{convId:e.convId,rtcSessionId:e.rtcSessionId}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.switchRecordingLayout=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: switchRecordingLayout..."),!this.isVideoLayoutSupported())return C.warn("[ClientApiHandler]: The switchRecordingLayout operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.SWITCH_RECORDING_LAYOUT,switchRecordingLayout:{rtcSessionId:e.rtcSessionId,layout:e.videoLayout}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.raiseQuestion=function(e,t){t=t||E,C.debug("[ClientApiHandler]: raiseQuestion...");var n={type:i.RTCSessionActionType.RAISE_QUESTION,raiseQuestion:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null,n.rtcSession.raiseQuestion.questionNumber)},["request.rtcSession.raiseQuestion.question"])},this.inviteToStage=function(e,t){t=t||E,C.debug("[ClientApiHandler]: inviteToStage..."),e.allowedMediaTypes=e.allowedMediaTypes||g();var n={type:i.RTCSessionActionType.INVITE_TO_STAGE,inviteToStage:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.inviteToStageAnswer=function(e,t){t=t||E,C.debug("[ClientApiHandler]: inviteToStageAnswer...");var n={type:i.RTCSessionActionType.INVITE_TO_STAGE_ANSWER,inviteToStageAnswer:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.inviteToStageCancel=function(e,t){t=t||E,C.debug("[ClientApiHandler]: inviteToStageCancel...");var n={type:i.RTCSessionActionType.INVITE_TO_STAGE_CANCEL,inviteToStageCancel:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.removeFromStage=function(e,t){t=t||E,C.debug("[ClientApiHandler]: removeFromStage...");var n={type:i.RTCSessionActionType.REMOVE_FROM_STAGE,removeFromStage:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.getQuestions=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getQuestions...");var n={type:i.RTCSessionActionType.GET_QUESTIONS,getQuestions:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null,n.rtcSession.getQuestions.questions)})},this.updateQuestionState=function(e,t){t=t||E,C.debug("[ClientApiHandler]: updateQuestionState...");var n={type:i.RTCSessionActionType.UPDATE_QUESTION_STATE,updateQuestionState:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.openCurtain=function(e,t){t=t||E,C.debug("[ClientApiHandler]: openCurtain...");var n={type:i.RTCSessionActionType.OPEN_CURTAIN,openCurtain:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.closeCurtain=function(e,t){t=t||E,C.debug("[ClientApiHandler]: closeCurtain...");var n={type:i.RTCSessionActionType.CLOSE_CURTAIN,closeCurtain:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.getNodeState=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getNodeState...");var n={type:i.RTCSessionActionType.GET_NODE_STATE,getNodeState:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t,!0)&&t(null,n.rtcSession.getNodeState.nodeData)})},this.enableWhiteboard=function(e,t){t=t||E,C.debug("[ClientApiHandler]: enableWhiteboard...");var n={type:i.RTCSessionActionType.ENABLE_WHITEBOARD,enableWhiteboard:{rtcSessionId:e.rtcSessionId,viewbox:e.viewbox}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t,!0)&&t(null)})},this.disableWhiteboard=function(e,t){t=t||E,C.debug("[ClientApiHandler]: disableWhiteboard...");var n={type:i.RTCSessionActionType.DISABLE_WHITEBOARD,disableWhiteboard:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t,!0)&&t(null)})},this.addWhiteboardElement=function(e,t){t=t||E,C.debug("[ClientApiHandler]: addWhiteboardElement...");var n={type:i.RTCSessionActionType.ADD_WHITEBOARD_ELEMENT,addWhiteboardElement:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t,!0)&&t(null)})},this.removeWhiteboardElement=function(e,t){t=t||E,C.debug("[ClientApiHandler]: removeWhiteboardElement...");var n={type:i.RTCSessionActionType.REMOVE_WHITEBOARD_ELEMENT,removeWhiteboardElement:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t,!0)&&t(null)})},this.updateWhiteboardElement=function(e,t){t=t||E,C.debug("[ClientApiHandler]: updateWhiteboardElement...");var n={type:i.RTCSessionActionType.UPDATE_WHITEBOARD_ELEMENT,updateWhiteboardElement:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t,!0)&&t(null)})},this.clearWhiteboard=function(e,t){t=t||E,C.debug("[ClientApiHandler]: clearWhiteboard...");var n={type:i.RTCSessionActionType.CLEAR_WHITEBOARD,clearWhiteboard:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t,!0)&&t(null)})},this.getWhiteboard=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getWhiteboard...");var n={type:i.RTCSessionActionType.GET_WHITEBOARD,getWhiteboard:e};f(i.ContentType.RTC_SESSION,n,function(e,n){if(v(e,n,t)){var i=n.rtcSession.getWhiteboard.whiteboard;o.normalizeWhiteboard(i,I),t(null,i)}})},this.setWhiteboardBackground=function(e,t){t=t||E,C.debug("[ClientApiHandler]: setWhiteboardBackground...");var n={type:i.RTCSessionActionType.SET_WHITEBOARD_BACKGROUND,setWhiteboardBackground:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.clearWhiteboardBackground=function(e,t){t=t||E,C.debug("[ClientApiHandler]: clearWhiteboardBackground...");var n={type:i.RTCSessionActionType.CLEAR_WHITEBOARD_BACKGROUND,clearWhiteboardBackground:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.toggleWhiteboardOverlay=function(e,t){t=t||E,C.debug("[ClientApiHandler]: toggleWhiteboardOverlay...");var n={type:i.RTCSessionActionType.TOGGLE_WHITEBOARD_OVERLAY,toggleWhiteboardOverlay:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.undoWhiteboard=function(e,t){t=t||E,C.debug("[ClientApiHandler]: undoWhiteboard...");var n={type:i.RTCSessionActionType.UNDO_WHITEBOARD,undoWhiteboard:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.sendClientInfo=function(e,t){t=t||E,C.debug("[ClientApiHandler]: sendClientInfo...");var n={type:i.RTCSessionActionType.SEND_CLIENT_INFO,sendClientInfo:{clientInfo:e}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.enableConferencePoll=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: enableConferencePoll..."),!this.isConferencePollSupported())return C.warn("[ClientApiHandler]: The enableConferencePoll operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.ENABLE_POLL,enablePoll:{rtcSessionId:e}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.closeConferencePoll=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: closeConferencePoll..."),!this.isConferencePollSupported())return C.warn("[ClientApiHandler]: The closeConferencePoll operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.CLOSE_POLL,closePoll:{rtcSessionId:e}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.disableConferencePoll=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: disableConferencePoll..."),!this.isConferencePollSupported())return C.warn("[ClientApiHandler]: The disableConferencePoll operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.DISABLE_POLL,disablePoll:{rtcSessionId:e}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.getConferencePoll=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: getConferencePoll..."),!this.isConferencePollSupported())return C.warn("[ClientApiHandler]: The getConferencePoll operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.GET_POLL,getPoll:{rtcSessionId:e}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null,n.rtcSession.getPoll.poll)},null,["response.rtcSession.getPoll.poll.question","response.rtcSession.getPoll.poll.choices.[].choiceText"])},this.makePollResultsVisible=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: makePollResultsVisible..."),!this.isConferencePollSupported())return C.warn("[ClientApiHandler]: The makePollResultsVisible operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.MAKE_POLL_RESULTS_VISIBLE,makePollResultsVisible:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.startConferencePoll=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: startConferencePoll..."),!this.isConferencePollSupported())return C.warn("[ClientApiHandler]: The startConferencePoll operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.START_POLL,startPoll:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)},["request.rtcSession.startPoll.question","request.rtcSession.startPoll.choices"])},this.resumeConferencePoll=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: resumeConferencePoll..."),!this.isConferencePollSupported())return C.warn("[ClientApiHandler]: The resumeConferencePoll operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.RESUME_POLL,resumePoll:{rtcSessionId:e}};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.stopConferencePoll=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: stopConferencePoll..."),!this.isConferencePollSupported())return C.warn("[ClientApiHandler]: The stopConferencePoll operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.STOP_POLL,stopPoll:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null,n.rtcSession.stopPoll.poll)},null,["response.rtcSession.stopPoll.poll.question","response.rtcSession.stopPoll.poll.choices.[].choiceText"])},this.voteConferencePoll=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: voteConferencePoll..."),!this.isConferencePollSupported())return C.warn("[ClientApiHandler]: The voteConferencePoll operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.RTCSessionActionType.VOTE_POLL,votePoll:e};f(i.ContentType.RTC_SESSION,n,function(e,n){v(e,n,t)&&t(null)})},this.submitClientData=function(e,t){t=t||E,C.debug("[ClientApiHandler]: submitClientData...");var n={type:i.InstrumentationActionType.SUBMIT_CLIENT_DATA,submitClientData:{instrumentationData:e}};f(i.ContentType.INSTRUMENTATION,n,function(e,n){if(v(e,n,t)){var r=n.instrumentation&&n.instrumentation.submitClientData&&n.instrumentation.submitClientData.submitDataResult;t(null,r||i.SubmitDataResult.OK)}})},this.submitQOSData=function(e,t){t=t||E,C.debug("[ClientApiHandler]: submitQOSData...");var n={type:i.InstrumentationActionType.SUBMIT_QOS_DATA,submitQOSData:{clientTime:Date.now(),dataSets:e}};f(i.ContentType.INSTRUMENTATION,n,function(e,n){v(e,n,t)&&t(null)})},this.getNotifications=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: getNotifications...");var r={type:i.ActivityStreamActionType.GET_ACTIVITIES_BY_USER,getActivitiesByUser:{timestamp:e,numberOfItems:t}};f(i.ContentType.ACTIVITYSTREAM,r,function(e,t){if(v(e,t,n,!0)){var i=t.activityStream.getActivitiesByUserResult;n(null,i)}})},this.toggleReadUnread=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: toggleReadUnread...");var r={type:i.ActivityStreamActionType.UPDATE_ACTIVITY_READ,updateActivityReadState:{activityId:e,read:t}};f(i.ContentType.ACTIVITYSTREAM,r,function(e,t){if(v(e,t,n)){var i=t.activityStream.updateResult;n(null,i.updatedItem)}})},this.markAllNotificationsAsRead=function(e){e=e||E,C.debug("[ClientApiHandler]: markAllNotificationsAsRead...");var t={type:i.ActivityStreamActionType.MARK_ALL_READ};f(i.ContentType.ACTIVITYSTREAM,t,function(t,n){if(v(t,n,e)){var i=n.activityStream.markAllReadResult;e(null,i)}})},this.getTenant=function(e){e=e||E,C.debug("[ClientApiHandler]: getTenant...");var t={type:i.AdministrationActionType.GET_TENANT};f(i.ContentType.ADMINISTRATION,t,function(t,n){v(t,n,e)&&e(null,n.administration.getTenant.tenant)})},this.addUser=function(e,t){t=t||E,C.debug("[ClientApiHandler]: addUser...");var n={type:i.AdministrationActionType.ADD_USER,addUser:{userAttributes:{emailAddress:e.emailAddress,lastName:e.lastName,firstName:e.firstName,locale:e.locale},password:e.password,packageId:e.packageId,accountTemplateId:e.accountTemplateId}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null,n.administration.addUserResult.user)},["request.administration.addUser.password"])},this.addMeetingPointV2=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: addMeetingPointV2...");var r={type:i.AdministrationActionType.ADD_MEETING_POINT_V2,addMeetingPoint:{userAttributes:{emailAddress:e.emailAddress,lastName:e.lastName,firstName:e.firstName,locale:e.locale,location:e.location,registrationCodeTtl:e.timeout||void 0},packageId:e.packageId}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.addMeetingPointV2Result)},null,["response.administration.addMeetingPointV2Result.registrationCode"],n)},this.updateMeetingPointV2=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: updateMeetingPointV2...");var r={type:i.AdministrationActionType.UPDATE_MEETING_POINT_V2,updateMeetingPoint:{userId:e.id,registrationCodeTtl:e.timeout||void 0}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.updateMeetingPointV2Result.registrationCode)},null,["response.administration.updateMeetingPointV2Result.registrationCode"],n)},this.regenerateApiKey=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: regenerateApiKey...");var r={type:i.AdministrationActionType.REGENERATE_API_KEY,regenerateApiKey:{userId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.regenerateApiKey.apiKey)},null,["response.administration.regenerateApiKey.apiKey"],n)},this.deleteUser=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: deleteUser...");var r={type:i.AdministrationActionType.DELETE_USER,deleteUser:{userId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.inviteUser=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: inviteUser...");var r={type:i.AdministrationActionType.INVITE_USER,inviteUser:{userAttributes:{emailAddress:e.userAttributes.emailAddress,lastName:e.userAttributes.lastName,firstName:e.userAttributes.firstName},packageId:e.packageId,accountTemplateId:e.accountTemplateId}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.inviteUser.resultType)},null,null,n)},this.inviteMultipleUsers=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: inviteMultipleUsers...");var r={type:i.AdministrationActionType.INVITE_MULTIPLE_USERS,inviteMultipleUsers:e};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.invitePartnerUsers=function(e,t){t=t||E,C.debug("[ClientApiHandler]: invitePartnerUsers...");var n={type:i.AdministrationActionType.INVITE_MULTIPLE_PARTNER_USERS,inviteMultiplePartnerUsers:{userAttributes:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null)})},this.resendInvite=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: resendInvite...");var r={type:i.AdministrationActionType.RESEND_USER_INVITATION,resendUserInvitation:{userId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.resendUserInvitation.resultType)},null,null,n)},this.checkInvalidTenant=function(e,t){t=t||E,C.debug("[ClientApiHandler]: checkInvalidTenant...");var n={type:i.AdministrationActionType.CHECK_INVALID_TENANTS,checkInvalidTenants:{tenantIds:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t,!0)&&t(null,n.administration.checkInvalidTenants.tenantIds)})},this.setTelephonyTrunkData=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: setTelephonyTrunkData...");var r={type:i.AdministrationActionType.SET_TELEPHONY_TRUNK_DATA,setTelephonyTrunkData:{defaultCallerId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t()},null,null,n)},this.getTelephonyTrunkStatus=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getTelephonyTrunkStatus...");var n={type:i.AdministrationActionType.GET_TELEPHONY_TRUNK_STATUS};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e)&&e(null,n.administration.getTelephonyTrunkStatus)},null,null,t)},this.getTelephonyTrunkGroups=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getTelephonyTrunkGroups..."),!e)return C.warn("[ClientApiHandler]: No query data provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUPS,getTelephonyTrunkGroups:{pageSize:e.pageSize,pagePointer:e.pagePointer||void 0,includeSharedTrunkGroups:e.includeSharedTrunkGroups||void 0}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getTelephonyTrunkGroupsResult)},null,null,n)},this.getTelephonyTrunkGroup=function(e,t){if(t=t||E,C.debug("[ClientApiHandler]: getTelephonyTrunkGroup..."),!e)return C.warn("[ClientApiHandler]: No trunk group id provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var n={type:i.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUP,getTelephonyTrunkGroup:{telephonyTrunkGroupId:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null,n.administration.getTelephonyTrunkGroupResult)})},this.addTelephonyTrunkGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: addTelephonyTrunkGroup..."),!e)return C.warn("[ClientApiHandler]: No trunk group data provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.ADD_TELEPHONY_TRUNK_GROUP,addTelephonyTrunkGroup:{telephonyTrunkGroupName:e.telephonyTrunkGroupName,telephonyTrunkId:e.telephonyTrunkIds}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.addTelephonyTrunkGroupResult)},null,null,n)},this.removeTelephonyTrunkGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: removeTelephonyTrunkGroup..."),!e)return C.warn("[ClientApiHandler]: No trunk group id provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.REMOVE_TELEPHONY_TRUNK_GROUP,removeTelephonyTrunkGroup:{telephonyTrunkGroupId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.removeTelephonyTrunkGroupResult.responseCode)},null,null,n)},this.updateTelephonyTrunkGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: updateTelephonyTrunkGroup..."),!e)return C.warn("[ClientApiHandler]: No trunk group data provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.UPDATE_TELEPHONY_TRUNK_GROUP,updateTelephonyTrunkGroup:{telephonyTrunkGroupId:e.telephonyTrunkGroupId,telephonyTrunkGroupName:e.telephonyTrunkGroupName,telephonyTrunkId:e.telephonyTrunkIds}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.updateTelephonyTrunkGroupResult)},null,null,n)},this.getTenantBridgeNumbers=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getTenantBridgeNumbers...");var n={type:i.AdministrationActionType.GET_TENANT_BRIDGE_NUMBERS};f(i.ContentType.ADMINISTRATION,n,function(t,n){if(v(t,n,e)){var i=n.administration.getTenantBridgeNumbers;e(null,i&&i.bridgeNumbers||[])}},null,null,t)},this.setTenantBridgeNumbers=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: setTenantBridgeNumbers...");var r={type:i.AdministrationActionType.SET_TENANT_BRIDGE_NUMBERS,setTenantBridgeNumbers:{bridgeNumbers:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t()},null,null,n)},this.getTenantVoicemailNumbers=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getTenantVoicemailNumbers...");var n={type:i.AdministrationActionType.GET_TENANT_VOICEMAIL_NUMBERS};f(i.ContentType.ADMINISTRATION,n,function(t,n){if(v(t,n,e,!0)){var i=n.administration.getTenantVoicemailNumbersResult;e(null,i&&i.voicemailNumber||[])}},null,null,t)},this.setTenantVoicemailNumbers=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: setTenantVoicemailNumbers...");var r={type:i.AdministrationActionType.SET_TENANT_VOICEMAIL_NUMBERS,setTenantVoicemailNumbers:{voicemailNumber:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t()},null,null,n)},this.addAutoConfigurableTrunk=function(e,t){e=e||E,C.debug("[ClientApiHandler]: addAutoConfigurableTrunk...");var n={type:i.AdministrationActionType.ADD_TRUNK_WITHOUT_PARAMETERS};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e)&&e(null,n.administration.addTrunk.configuration)},null,null,t)},this.getTenantTelephonyConfiguration=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getTenantTelephonyConfiguration...");var n={type:i.AdministrationActionType.GET_TENANT_TELEPHONY_CONFIGURATION};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e)&&e(null,n.administration.getTenantTelephonyConfiguration.configuration)},null,["response.administration.getTenantTelephonyConfiguration.configuration.apiKey"],t)},this.getTelephonyRoutingRules=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getTelephonyRoutingRules...");var r={type:i.AdministrationActionType.GET_TELEPHONY_ROUTING_RULES,getTelephonyRoutingRules:{pageSize:e.pageSize,pagePointer:e.pagePointer}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getTelephonyRoutingRulesResult)},null,null,n)},this.addTelephonyRoutingRule=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: addTelephonyRoutingRule...");var r={type:i.AdministrationActionType.ADD_TELEPHONY_ROUTING_RULE,addTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:e.routePosition,condition1:e.condition1,gtcUserId:e.gtcUserId,gtcUserGroupId:e.gtcUserGroupId,operator:e.operator||void 0,condition2:e.condition2||void 0,application:e.application||void 0}}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.updateTelephonyRoutingRule=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: updateTelephonyRoutingRule...");var r={type:i.AdministrationActionType.UPDATE_TELEPHONY_ROUTING_RULE,updateTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:e.routePosition,condition1:e.condition1,gtcUserId:e.gtcUserId,gtcUserGroupId:e.gtcUserGroupId,routeId:e.routeId||void 0,operator:e.operator||void 0,condition2:e.condition2||void 0,application:e.application||void 0}}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.removeTelephonyRoutingRule=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: removeTelephonyRoutingRule...");var r={type:i.AdministrationActionType.REMOVE_TELEPHONY_ROUTING_RULE,removeTelephonyRoutingRule:{telephonyRoutingRuleId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.testTelephonyRoutingRules=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: testTelephonyRoutingRule...");var r={type:i.AdministrationActionType.TEST_TELEPHONY_ROUTING_RULES,testTelephonyRoutingRules:{destination:e.destination,origin:e.origin||void 0,application:e.application||void 0,considerTelephonyConnectorsStates:!!e.considerTelephonyConnectorsStates}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.testTelephonyRoutingRulesResult)},null,null,n)},this.updateTenantTelephonyConfiguration=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: updateTenantTelephonyConfiguration...");var r={type:i.AdministrationActionType.UPDATE_TENANT_TELEPHONY_CONFIGURATION,updateTenantTelephonyConfiguration:{defaultRouting:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.setTrunkPassword=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: setTrunkPassword...");var r={type:i.AdministrationActionType.SET_TRUNK_PASSWORD,setTrunkPassword:{trunkId:e,password:t}};f(i.ContentType.ADMINISTRATION,r,function(e,t){v(e,t,n)&&n(null)},["request.administration.setTrunkPassword.password"])},this.updateTrunk=function(e,t){t=t||E,C.debug("[ClientApiHandler]: updateTrunk...");var n={type:i.AdministrationActionType.UPDATE_TRUNK,updateTrunk:{trunkId:e.gtcUserId,displayName:e.gtcTrunkName,defaultCallerId:e.defaultCallerId}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null)})},this.startTrunkSoftSuspension=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: startTrunkSoftSuspension...");var r={type:i.AdministrationActionType.START_TRUNK_SOFT_SUSPENSION,startTrunkSoftSuspension:{trunkId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.cancelTrunkSoftSuspension=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: cancelTrunkSoftSuspension...");var r={type:i.AdministrationActionType.CANCEL_TRUNK_SOFT_SUSPENSION,cancelTrunkSoftSuspension:{trunkId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.getTrunkRemainingCalls=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getTrunkRemainingCalls...");var r={type:i.AdministrationActionType.GET_TRUNK_ACTIVE_CALLS,getTrunkActiveCalls:{trunkId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getTrunkActiveCallsResult.numberOfActiveCalls)},null,null,n)},this.shareTrunkGroup=function(e,t,n,r){n=n||E,C.debug("[ClientApiHandler]: shareTrunkGroup...");var o={type:i.AdministrationActionType.SHARE_TRUNK_GROUP,shareTrunkGroup:{trunkGroupId:e,secTenantId:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null)},null,null,r)},this.unshareTrunkGroup=function(e,t,n,r){n=n||E,C.debug("[ClientApiHandler]: unshareTrunkGroup...");var o={type:i.AdministrationActionType.UNSHARE_TRUNK_GROUP,unshareTrunkGroup:{trunkGroupId:e,secTenantId:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null)},null,null,r)},this.setTenantSettings=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: setTenantSettings...");var r={type:i.AdministrationActionType.SET_TENANT_SETTINGS,setTenantSettings:{tenantSettings:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.updateTenantName=function(e,t){t=t||E,C.debug("[ClientApiHandler]: updateTenantName...");var n={type:i.AdministrationActionType.UPDATE_TENANT,updateTenant:{companyName:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null)})},this.getTenantLoginProviders=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getTenantLoginProviders...");var n={type:i.AdministrationActionType.GET_ALL_TENANT_LOGIN_PROVIDERS,getAllTenantLoginProviders:{tenantId:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t,!0)&&t(null,n.administration.getAllTenantLoginProvidersResult.tenantLoginProvidersList||[])})},this.addTenantLoginProvider=function(e,t){t=t||E,C.debug("[ClientApiHandler]: addTenantLoginProvider...");var n={type:i.AdministrationActionType.SAVE_TENANT_LOGIN_PROVIDER,saveTenantLoginProvider:{loginProvider:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null,n.administration.saveTenantLoginProviderResult.storedProvider)})},this.updateTenantLoginProvider=function(e,t){t=t||E,C.debug("[ClientApiHandler]: updateTenantLoginProvider...");var n={type:i.AdministrationActionType.UPDATE_TENANT_LOGIN_PROVIDER,updateTenantLoginProvider:{loginProvider:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null,n.administration.updateTenantLoginProviderResult.updatedLoginProvider)})},this.deleteTenantLoginProvider=function(e,t){t=t||E,C.debug("[ClientApiHandler]: deleteTenantLoginProvider...");var n={type:i.AdministrationActionType.DELETE_TENANT_LOGIN_PROVIDER,deleteTenantLoginProvider:{providerId:e.providerId,tenantId:e.tenantId}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null,n.administration.deleteTenantLoginProviderResult)})},this.getOpenScapeUser=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getOpenScapeUser..."),!e)return C.warn("[ClientApiHandler]: No dn was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.GET_OPENSCAPE_USER,getOpenScapeUser:{directoryNumber:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getOpenScapeUserResult)},null,["response.administration.getOpenScapeUserResult.user.cloudPin","response.administration.getOpenScapeUserResult.user.securityPin"],n)},this.getOpenScapeUserV2=function(e,t,n,r){if(n=n||E,C.debug("[ClientApiHandler]: getOpenScapeUserV2..."),!e)return C.warn("[ClientApiHandler]: No dn was provided"),void A(n,i.ReturnCode.INVALID_MESSAGE);if(!t)return C.warn("[ClientApiHandler]: No circuitUserId was provided"),void A(n,i.ReturnCode.INVALID_MESSAGE);var o={type:i.AdministrationActionType.GET_OPENSCAPE_USER_V2,getV2OpenScapeUser:{directoryNumber:e,circuitUserId:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null,t.administration.getOpenScapeUserResult)},null,["response.administration.getOpenScapeUserResult.user.cloudPin","response.administration.getOpenScapeUserResult.user.securityPin"],r)},this.getThirdPartyDeviceData=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getThirdPartyDeviceData...");var r={type:i.AdministrationActionType.GET_THIRD_PARTY_DEVICE_INFO,getThirdPartyDeviceInfo:{directoryNumber:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getThirdPartyDeviceInfoResult.thirdPartyDeviceInfo)},null,["response.administration.getThirdPartyDeviceInfoResult.thirdPartyDeviceInfo.authenticationPassword","response.administration.getThirdPartyDeviceInfoResult.thirdPartyDeviceInfo.certContent"],n)},this.getVacantHomeDirectoryNumbers=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getVacantHomeDirectoryNumbers...");var n={type:i.AdministrationActionType.GET_VACANT_HOME_DIRECTORY_NUMBERS,getVacantHomeDirectoryNumbers:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e)&&e(null,n.administration.getVacantHomeDirectoryNumbersResult.directoryNumbers)},null,null,t)},this.getVacantHomeDirectoryNumbersOfSite=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getVacantHomeDirectoryNumbersOfSite..."),!e)return C.warn("[ClientApiHandler]: No siteId was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.GET_VACANT_HOME_DIRECTORY_NUMBERS_OF_SITE,getVacantHomeDirectoryNumbersOfSite:{siteId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getVacantHomeDirectoryNumbersOfSiteResult.directoryNumbers)},null,null,n)},this.createOpenScapeUser=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: createOpenScapeUser..."),!e)return C.warn("[ClientApiHandler]: No user data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.CREATE_OPENSCAPE_USER,createOpenScapeUser:e};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.createOpenScapeUserResult.user)},null,null,n)},this.updateOpenScapeUser=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: updateOpenScapeUser..."),!e)return C.warn("[ClientApiHandler]: No user data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.UPDATE_OPENSCAPE_USER,updateOpenScapeUser:e};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.updateOpenScapeUserResult.user)},null,null,n)},this.deleteOpenScapeUser=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: deleteOpenScapeUser..."),!e||!e.userId||!e.dn)return C.warn("[ClientApiHandler]: User id or dn was not provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.DELETE_OPENSCAPE_USER,deleteOpenScapeUser:{userId:e.userId,directoryNumber:e.dn}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.deleteOpenScapeUserResult)},null,null,n)},this.createOpenScapeSite=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: createOpenScapeSite..."),!e)return C.warn("[ClientApiHandler]: No site data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.CREATE_OPENSCAPE_SITE,createOpenScapeSite:{site:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.createOpenScapeSiteResult.site)},null,null,n)},this.getOpenScapeSite=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getOpenScapeSite..."),!e)return C.warn("[ClientApiHandler]: No siteId was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.GET_OPENSCAPE_SITE,getOpenScapeSite:{siteId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getOpenScapeSiteResult.site)},null,null,n)},this.updateOpenScapeSite=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: updateOpenScapeSite..."),!e)return C.warn("[ClientApiHandler]: No site data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.UPDATE_OPENSCAPE_SITE,updateOpenScapeSite:{site:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.updateOpenScapeSiteResult.site)},null,null,n,!0)},this.deleteOpenScapeSites=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: deleteOpenScapeSites...");var r={type:i.AdministrationActionType.DELETE_OPENSCAPE_SITES,deleteOpenScapeSites:{sites:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){if(v(e,n,t)){var i=n.administration&&n.administration.deleteOpenScapeSitesResult&&n.administration.deleteOpenScapeSitesResult.failedToBeDeleted||[];t(null,i)}},null,null,n)},this.deleteOpenScapePublicRange=function(e,t,n,r){n=n||E,C.debug("[ClientApiHandler]: deleteOpenScapePublicRange...");var o={type:i.AdministrationActionType.DELETE_PUBLIC_NUMBER_RANGE,deletePublicNumberRange:{siteId:e,rangeId:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null)},null,null,r)},this.deleteSinglePublicNumber=function(e,t,n,r){if(n=n||E,C.debug("[ClientApiHandler]: deleteSinglePublicNumber..."),!e)return C.warn("[ClientApiHandler]: No siteId was provided"),void A(n,i.ReturnCode.INVALID_MESSAGE);if(!t)return C.warn("[ClientApiHandler]: No msnId was provided"),void A(n,i.ReturnCode.INVALID_MESSAGE);var o={type:i.AdministrationActionType.DELETE_OPENSCAPE_MSN_NUMBER,deleteOpenScapeMSNnumber:{siteId:e,msnId:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null)},null,null,r)},this.deleteOpenScapePrivateRange=function(e,t,n,r){n=n||E,C.debug("[ClientApiHandler]: deleteOpenScapePrivateRange...");var o={type:i.AdministrationActionType.DELETE_PRIVATE_NUMBER_RANGE,deletePrivateNumberRange:{siteId:e,rangeId:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null)},null,null,r)},this.getOpenScapeTenant=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getOpenScapeTenant...");var n={type:i.AdministrationActionType.GET_OPENSCAPE_TENANT,getOpenScapeTenant:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e)&&e(null,n.administration.getOpenScapeTenantResult.tenant)},null,null,t)},this.getManageableTenants=function(e){e=e||E,C.debug("[ClientApiHandler]: getManageableTenants...");var t={type:i.AdministrationActionType.GET_PARTNER_MANAGEABLE_TENANTS};f(i.ContentType.ADMINISTRATION,t,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getPartnerManageableTenantResult.tenants)})},this.getCMRSettings=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getCMRSettings...");var n={type:i.AdministrationActionType.GET_CMR_SETTINGS,getCMRSettings:{userId:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t,!0)&&t(e,n.administration.getCMRSettingsResult.settings)})},this.setCMRSettings=function(e,t,n){if(n=n||E,C.debug("[ClientApiHandler]: setCMRSettings..."),t&&t.length){var r={type:i.AdministrationActionType.SET_CMR_SETTINGS,setCMRSettings:{userId:e,settings:t}};f(i.ContentType.ADMINISTRATION,r,function(e,t){v(e,t,n)&&n(null)})}else A(n,i.ReturnCode.OPERATION_NOT_SUPPORTED)},this.getCMRInfoById=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getCMRInfoById...");var n={type:i.AdministrationActionType.GET_CMR_INFO_BY_ID,getCMRInfoById:{userId:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(e,n.administration.getCMRInfoByIdResult.cmrInfo)})},this.getCMRInfoByIds=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getCMRInfoByIds...");var n={type:i.AdministrationActionType.GET_CMR_INFO_BY_IDS,getCMRInfoByIds:{userId:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t,!0)&&t(e,n.administration.getCMRInfoByIdsResult.cmrInfo)})},this.setAdminManagedCMRSettings=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: setAdminManagedCMRSettings...");var r={type:i.AdministrationActionType.SET_ADMIN_MANAGED_CMR_SETTINGS,setAdminManagedCMRSettings:{userId:e,setting:t}};f(i.ContentType.ADMINISTRATION,r,function(e,t){v(e,t,n)&&n(null)})},this.setAdminManagedCMRSettingsByIds=function(e,t){t=t||E,C.debug("[ClientApiHandler]: setAdminManagedCMRSettingsByIds...");var n={type:i.AdministrationActionType.SET_ADMIN_MANAGED_CMR_SETTINGS_BY_IDS,setAdminManagedCMRSettingsByIds:{settings:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null)})},this.shareCMR=function(e,t,n,r){n=n||E,C.debug("[ClientApiHandler]: shareCMR...");var o={type:i.AdministrationActionType.SHARE_CMR,shareCMR:{cmrUserId:e,secIds:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null)},null,null,r)},this.unshareCMR=function(e,t,n,r){n=n||E,C.debug("[ClientApiHandler]: unshareCMR...");var o={type:i.AdministrationActionType.UNSHARE_CMR,unshareCMR:{cmrUserId:e,secIds:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null)},null,null,r)},this.getCMRSharedTenantInfo=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getCMRSharedTenantInfo...");var r={type:i.AdministrationActionType.GET_CMR_SHARED_TENANT_INFO,getCMRSharedTenantInfo:{cmrUserId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t,!0)&&t(null,n.administration.getCMRSharedTenantInfoResult.tenantIdToName||[])},null,null,n)},this.getHuntGroups=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getHuntGroups...");var n={type:i.AdministrationActionType.GET_TENANT_HUNT_GROUPS,getTenantHuntGroups:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getTenantHuntGroupsResult.queryHuntGroupResponse||[])},null,null,t)},this.createHuntGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: createHuntGroup..."),!e)return C.warn("[ClientApiHandler]: No hunt group data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.CREATE_HUNT_GROUP,createHuntGroup:{huntGroup:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.createHuntGroupResult.huntGroup)},null,null,n)},this.deleteHuntGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: deleteHuntGroup..."),!e||!e.length)return C.warn("[ClientApiHandler]: No hunt group pilot DNs were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.DELETE_HUNT_GROUP,deleteHuntGroup:{huntGroupPilots:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.getHuntGroupPilotDNs=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getHuntGroupPilotDNs...");var n={type:i.AdministrationActionType.GET_HUNT_GROUP_PILOT_CANDIDATES,getHuntGroupPilotCandidates:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getHuntGroupPilotCandidatesResult.huntGroupUsers||[])},null,null,t)},this.getHuntGroupMemberDNs=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getHuntGroupMemberDNs...");var n={type:i.AdministrationActionType.GET_HUNT_GROUP_MEMBER_CANDIDATES,getHuntGroupMemberCandidates:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getHuntGroupMemberCandidatesResult.huntGroupUsers||[])},null,null,t)},this.getHuntGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getHuntGroup..."),!e)return C.warn("[ClientApiHandler]: Hunt group pilot DN was not provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.GET_HUNT_GROUP,getHuntGroup:{pilotDn:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getHuntGroupResult.huntGroup)},null,null,n)},this.updateHuntGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: updateHuntGroup..."),!e)return C.warn("[ClientApiHandler]: No hunt group data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.UPDATE_HUNT_GROUP,updateHuntGroup:{updatedHuntGroup:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.updateHuntGroupResult.huntGroup)},null,null,n)},this.updateHuntGroupList=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: updateHuntGroupList..."),!e)return C.warn("[ClientApiHandler]: No hunt group list data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.UPDATE_HUNT_GROUP_LIST,updateHuntGroupList:{pilotsDns:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.getITSPtemplates=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getITSPtemplates...");var n={type:i.AdministrationActionType.GET_OPENSCAPE_ITSP_TEMPLATES,getOpenscapeITSPTemplates:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){if(v(t,n,e)){var r,o=n.administration.getOpenscapeITSPTemplatesResult.itspTemplates;if(o)try{r=JSON.parse(o)}catch(t){return C.error("[ClientApiHandler]: Error while parsing response in getITSPtemplates"),void e(i.ReturnCode.SERVICE_EXCEPTION)}e(null,r&&r.content)}},null,null,t)},this.createITSP=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: createITSP..."),!e)return C.warn("[ClientApiHandler]: No ITSP data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.CREATE_OPENSCAPE_ITSP,createOpenscapeITSP:{itsp:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.createOpenscapeITSPResult.provider)},null,null,n,!0)},this.getITSP=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getITSP..."),!e)return C.warn("[ClientApiHandler]: No ITSP id was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.GET_OPENSCAPE_ITSP,getOpenscapeITSP:{id:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getOpenscapeITSPResult.provider)},null,null,n)},this.getITSPs=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getITSPs...");var n={type:i.AdministrationActionType.GET_OPENSCAPE_ITSPS,getOpenscapeITSPs:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getOpenscapeITSPsResult.providers)},null,null,t)},this.updateITSP=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: updateITSP..."),!e)return C.warn("[ClientApiHandler]: No ITSP data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.UPDATE_OPENSCAPE_ITSP,updateOpenscapeITSP:{itsp:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n,!0)},this.deleteITSPs=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: deleteITSP..."),!e)return C.warn("[ClientApiHandler]: No ITSP ids were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.DELETE_OPENSCAPE_ITSP,deleteOpenscapeITSP:{itspIds:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.deleteOpenscapeITSPResult.providers)},null,null,n,!0)},this.assignITSPToSite=function(e,t,n,r,o){if(r=r||E,C.debug("[ClientApiHandler]: assignITSPToSite..."),!e)return C.warn("[ClientApiHandler]: No ITSP id was provided"),void A(r,i.ReturnCode.INVALID_MESSAGE);if(!t)return C.warn("[ClientApiHandler]: No site id was provided"),void A(r,i.ReturnCode.INVALID_MESSAGE);var a={type:i.AdministrationActionType.ASSIGN_OPENSCAPE_ITSP_TO_SITE,assignOpenscapeITSPToSite:{itspid:e,siteid:t,defaultHomeDN:n}};f(i.ContentType.ADMINISTRATION,a,function(e,t){v(e,t,r)&&r(null)},null,null,o)},this.unassignITSPFromSite=function(e,t,n,r){if(n=n||E,C.debug("[ClientApiHandler]: unassignITSPFromSite..."),!e)return C.warn("[ClientApiHandler]: No ITSP id was provided"),void A(n,i.ReturnCode.INVALID_MESSAGE);if(!t)return C.warn("[ClientApiHandler]: No site id was provided"),void A(n,i.ReturnCode.INVALID_MESSAGE);var o={type:i.AdministrationActionType.UNASSIGN_OPENSCAPE_ITSP_TO_SITE,unassignOpenscapeITSPFromSite:{itspid:e,siteid:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null)},null,null,r)},this.getPickupGroupMemberDNs=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getPickupGroupMemberDNs...");var n={type:i.AdministrationActionType.GET_PICKUP_GROUP_MEMBER_CANDIDATES,getPickupGroupMemberCandidates:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getPickupGroupMemberCandidatesResult.pickupGroupUsers||[])},null,null,t)},this.createPickupGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: createPickupGroup..."),!e)return C.warn("[ClientApiHandler]: No pickup group data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.CREATE_PICKUP_GROUP,createPickupGroup:{pickupGroup:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.createPickupGroupResult.pickupGroupResponse)},null,null,n)},this.getPickupGroupList=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getPickupGroupList...");var n={type:i.AdministrationActionType.GET_TENANT_PICKUP_GROUPS,getTenantPickupGroups:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getTenantPickupGroupsResult.queryPickupGroupResponse||[])},null,null,t)},this.deletePickupGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: deletePickupGroup..."),!e||!e.length)return C.warn("[ClientApiHandler]: No pickup group ids were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.DELETE_PICKUP_GROUPS,deletePickupGroups:{pickupGroupId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.getPickupGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getPickupGroup..."),!e)return C.warn("[ClientApiHandler]: Pickup group id was not provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.GET_PICKUP_GROUP,getPickupGroup:{pickupGroupId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getPickupGroupResult.pickupGroup)},null,null,n)},this.updatePickupGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: updatePickupGroup..."),!e)return C.warn("[ClientApiHandler]: No pickup group data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.UPDATE_PICKUP_GROUP,updatePickupGroup:{pickupGroup:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration)},null,null,n)},this.getExecutiveAssistantGroupList=function(e,t){if(e=e||E,C.debug("[ClientApiHandler]: getExecutiveAssistantGroupList..."),!this.isExecutiveAssistantSupported())return C.warn("[ClientApiHandler]: The getExecutiveAssistantGroupList operation is not supported by the backend"),void A(e,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.AdministrationActionType.GET_TENANT_EXECUTIVE_ASSISTANT_GROUPS,getTenantExecutiveAssistantGroups:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getTenantExecutiveAssistantGroupsResult.queryExecutiveAssistantGroupResponse||[])},null,null,t)},this.getExecutiveAssistantGroupMemberCandidates=function(e,t){if(e=e||E,C.debug("[ClientApiHandler]: getExecutiveAssistantGroupMemberCandidates..."),!this.isExecutiveAssistantSupported())return C.warn("[ClientApiHandler]: The getExecutiveAssistantGroupMemberCandidates operation is not supported by the backend"),void A(e,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.AdministrationActionType.GET_EXECUTIVE_ASSISTANT_GROUP_MEMBER_CANDIDATES,getExecutiveAssistantGroupMemberCandidates:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getExecutiveAssistantGroupMemberCandidatesResult.executiveAssistantGroupUsers||[])},null,null,t)},this.createExecutiveAssistantGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: createExecutiveAssistantGroup..."),!this.isExecutiveAssistantSupported())return C.warn("[ClientApiHandler]: The createExecutiveAssistantGroup operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var r={type:i.AdministrationActionType.CREATE_EXECUTIVE_ASSISTANT_GROUP,createExecutiveAssistantGroup:{executiveAssistantGroup:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.getExecutiveAssistantGroup=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getExecutiveAssistantGroup..."),!this.isExecutiveAssistantSupported())return C.warn("[ClientApiHandler]: The getExecutiveAssistantGroupMemberCandidates operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);var r={type:i.AdministrationActionType.GET_EXECUTIVE_ASSISTANT_GROUP,getExecutiveAssistantGroup:{eaGroupName:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t,!0)&&t(null,n.administration.getExecutiveAssistantGroupResult.executiveAssistantGroup||{})},null,null,n)},this.deleteExecutiveAssistantGroups=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: deleteExecutiveAssistantGroup..."),!this.isExecutiveAssistantSupported())return C.warn("[ClientApiHandler]: The deleteExecutiveAssistantGroup operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);if(!e||!e.length)return C.warn("[ClientApiHandler]: No Executive-Assistant group names were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.DELETE_EXECUTIVE_ASSISTANT_GROUPS,deleteExecutiveAssistantGroups:{executiveAssistantGroupName:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.createAutomatedAttendantConfiguration=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: createAutomatedAttendantConfiguration..."),!e)return C.warn("[ClientApiHandler]: No Automated Attendant configuration was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.CREATE_AUTOMATED_ATTENDANT_CONFIGURATION,createAutomatedAttendantConfiguration:{automatedAttendantConfiguration:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.getAutomatedAttendantConfigurations=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getAutomatedAttendantConfigurations...");var n={type:i.AdministrationActionType.GET_AUTOMATED_ATTENDANT_CONFIGURATIONS,getAutomatedAttendantConfigurations:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getAutomatedAttendantConfigurationsResult.automatedAttendantConfigurations||[])},null,null,t)},this.getAutomatedAttendantConfiguration=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getAutomatedAttendantConfiguration..."),!e)return C.warn("[ClientApiHandler]: No Automated Attendant access number was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.GET_AUTOMATED_ATTENDANT_CONFIGURATION,getAutomatedAttendantConfiguration:{automatedAttendantNumber:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getAutomatedAttendantConfigurationResult.automatedAttendantConfiguration)},null,null,n)},this.updateAutomatedAttendantConfiguration=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: updateAutomatedAttendantConfiguration..."),!e)return C.warn("[ClientApiHandler]: No Automated Attendant configuration was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.UPDATE_AUTOMATED_ATTENDANT_CONFIGURATION,updateAutomatedAttendantConfiguration:{updatedAutoAttendant:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration)},null,null,n,!0)},this.deleteAutomatedAttendantConfigurations=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: deleteAutomatedAttendantConfigurations..."),!e)return C.warn("[ClientApiHandler]: No Automated Attendant access numbers were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.DELETE_AUTOMATED_ATTENDANT_CONFIGURATIONS,deleteAutomatedAttendantConfigurations:{autoAttendants:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.createApplicationFrameworkConfiguration=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: createApplicationFrameworkConfiguration..."),!this.isApplicationFrameworkConfigurationSupported())return C.warn("[ClientApiHandler]: Application Framework configuration is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);if(!e)return C.warn("[ClientApiHandler]: No Application Framework configuration was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.CREATE_APPLICATION_FRAMEWORK_CONFIGURATION,createApplicationFrameworkConfiguration:{applicationFrameworkConfiguration:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.createApplicationFrameworkConfigurationResult.applicationFrameworkConfiguration)},null,null,n)},this.getApplicationFrameworkConfigurations=function(e,t){if(e=e||E,C.debug("[ClientApiHandler]: getApplicationFrameworkConfigurations..."),!this.isApplicationFrameworkConfigurationSupported())return C.warn("[ClientApiHandler]: Application Framework configuration is not supported by the backend"),void A(e,i.ReturnCode.OPERATION_NOT_SUPPORTED);var n={type:i.AdministrationActionType.GET_APPLICATION_FRAMEWORK_CONFIGURATIONS,getApplicationFrameworkConfigurations:{}};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e,!0)&&e(null,n.administration.getApplicationFrameworkConfigurationsResult.applicationFrameworkConfigurations||[])},null,null,t)},this.getApplicationFrameworkConfiguration=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: getApplicationFrameworkConfiguration..."),!this.isApplicationFrameworkConfigurationSupported())return C.warn("[ClientApiHandler]: Application Framework configuration is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);if(!e)return C.warn("[ClientApiHandler]: No Application Framework access number was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.GET_APPLICATION_FRAMEWORK_CONFIGURATION,getApplicationFrameworkConfiguration:{accessNumber:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.getApplicationFrameworkConfigurationResult.applicationFrameworkConfiguration)},null,null,n)},this.updateApplicationFrameworkConfiguration=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: updateApplicationFrameworkConfiguration..."),!this.isApplicationFrameworkConfigurationSupported())return C.warn("[ClientApiHandler]: Application Framework configuration is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);if(!e)return C.warn("[ClientApiHandler]: No Application Framework configuration was provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.UPDATE_APPLICATION_FRAMEWORK_CONFIGURATION,updateApplicationFrameworkConfiguration:{applicationFrameworkConfiguration:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.updateApplicationFrameworkConfigurationResult.applicationFrameworkConfiguration)},null,null,n,!0)},this.deleteApplicationFrameworkConfigurations=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: deleteApplicationFrameworkConfigurations..."),!this.isApplicationFrameworkConfigurationSupported())return C.warn("[ClientApiHandler]: Application Framework configuration is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);if(!e)return C.warn("[ClientApiHandler]: No Application Framework access numbers were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.DELETE_APPLICATION_FRAMEWORK_CONFIGURATIONS,deleteApplicationFrameworkConfigurations:{ids:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.hasSomeSinglePublicNumberReserved=function(e,t,n){if(t=t||E,!(e&&e.msnNumbers&&e.customerId&&e.sitePrefix))return C.warn("[ClientApiHandler]: Missing mandatory data"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.IS_MSN_RESERVED,isMSNReserved:{msnNumbers:e.msnNumbers,customerId:e.customerId,sitePrefix:e.sitePrefix}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.isMSNReservedResult.isMSNReserved)},null,null,n)},this.hasReservedDNsInSiteRanges=function(e,t,n){if(t=t||E,!this.isSiteRangesUpdateSupported())return C.warn("[ClientApiHandler]: The hasReservedDNsInSiteRanges operation is not supported by the backend"),void A(t,i.ReturnCode.OPERATION_NOT_SUPPORTED);if(!(e&&e.siteId&&e.modifiedDidNumberRanges&&e.modifiedPrivateNumberRanges))return C.warn("[ClientApiHandler]: Missing mandatory data"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.AdministrationActionType.HAS_RESERVED_DNS_IN_SITE_RANGES,hasReservedDNsInSiteRanges:{siteId:e.siteId,publicRanges:e.modifiedDidNumberRanges,privateRanges:e.modifiedPrivateNumberRanges}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.hasReservedDNsInSiteRangesResult.hasReservedDNs)},null,null,n)},this.getSystemNotifications=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getSystemNotifications...");var r={type:i.AdministrationActionType.GET_SYSTEM_NOTIFICATIONS,getSystemNotifications:{systemNotificationType:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t,!0)&&t(null,n.administration.getSystemNotificationsResult.systemNotifications||[])},null,["response.administration.getSystemNotificationsResult.systemNotifications.[].broadcastText"],n)},this.addSystemNotification=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: addSystemNotification...");var r={type:i.AdministrationActionType.ADD_SYSTEM_NOTIFICATION,addSystemNotification:{type:e.type,startTime:e.startTime,endTime:e.endTime,broadcastText:e.broadcastText}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.addSystemNotificationResult.systemNotification)},["request.administration.addSystemNotification.broadcastText"],["response.administration.addSystemNotificationResult.systemNotification.broadcastText"],n)},this.removeSystemNotification=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: removeSystemNotification...");var r={type:i.AdministrationActionType.REMOVE_SYSTEM_NOTIFICATION,removeSystemNotification:{id:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.updateSystemNotification=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: updateSystemNotification...");var r={type:i.AdministrationActionType.UPDATE_SYSTEM_NOTIFICATION,updateSystemNotification:{id:e.id,startTime:e.startTime,endTime:e.endTime,broadcastText:e.broadcastText}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null,n.administration.updateSystemNotificationResult.systemNotification)},["request.administration.updateSystemNotification.broadcastText"],["response.administration.updateSystemNotificationResult.systemNotification.broadcastText"],n)},this.enablePartnerAdministration=function(e,t){e=e||E,C.debug("[ClientApiHandler]: enablePartnerAdministration...");var n={type:i.AdministrationActionType.ENABLE_PARTNER_ADMINISTRATION};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e)&&e(null)},null,null,t)},this.disablePartnerAdministration=function(e,t){e=e||E,C.debug("[ClientApiHandler]: disablePartnerAdministration...");var n={type:i.AdministrationActionType.DISABLE_PARTNER_ADMINISTRATION};f(i.ContentType.ADMINISTRATION,n,function(t,n){v(t,n,e)&&e(null)},null,null,t)},this.getResellerInfo=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getResellerInfo...");var n={type:i.AdministrationActionType.GET_RESELLER_INFO,getResellerInfo:{partnerId:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null,n.administration.getResellerInfoResult.resellerInfo)})},this.setSupportType=function(e,t){t=t||E,C.debug("[ClientApiHandler]: setSupportType...");var n={type:i.AdministrationActionType.SET_SUPPORT_TYPE,setSupportType:{supportType:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null)})},this.setSupportEmail=function(e,t){t=t||E,C.debug("[ClientApiHandler]: setSupportEmail...");var n={type:i.AdministrationActionType.SET_SUPPORT_EMAIL_ADDRESS,setSupportEmailaddress:{supportEmailaddress:e}};f(i.ContentType.ADMINISTRATION,n,function(e,n){v(e,n,t)&&t(null)})},this.exportUserData=function(e,t,n,r){n=n||E,C.debug("[ClientApiHandler]: exportUserData...");var o={type:i.AdministrationActionType.EXPORT_DATA_USER,exportDataUser:{data:e,userId:t}};f(i.ContentType.ADMINISTRATION,o,function(e,t){v(e,t,n)&&n(null)},null,null,r)},this.exportDomainData=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: exportDomainData...");var r={type:i.AdministrationActionType.EXPORT_DATA_TENANT,exportDataTenant:{data:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.getApplicationsList=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getApplicationsList...");var r={type:i.CPaaSActionType.GET_OAUTH_APPLICATIONS,getOauthApplications:{}};f(i.ContentType.CPAAS,r,function(e,n){e||n.code!==i.ReturnCode.NO_RESULT?v(e,n,t)&&t(null,n.cpaas.getOauthApplicationsResult):t(null,{applications:[]})},null,null,n)},this.getApplicationDetails=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getApplicationsDetails...");var r={type:i.CPaaSActionType.GET_OAUTH_APPLICATION,getOauthApplication:{clientId:e}};f(i.ContentType.CPAAS,r,function(e,n){v(e,n,t)&&t(null,n.cpaas.getOauthApplicationResult.application)},null,null,n)},this.suspendApplication=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: suspendApplication ...");var r={type:i.CPaaSActionType.SUSPEND_OAUTH_APPLICATION,suspendOAuthApplication:{clientId:e}};f(i.ContentType.CPAAS,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.unsuspendApplication=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: unsuspendApplication ...");var r={type:i.CPaaSActionType.UNSUSPEND_OAUTH_APPLICATION,unsuspendOAuthApplication:{clientId:e}};f(i.ContentType.CPAAS,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.recreateClientSecret=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: recreateClientSecret...");var r={type:i.CPaaSActionType.RECREATE_CLIENT_SECRET,recreateClientSecret:{clientId:e}};f(i.ContentType.CPAAS,r,function(e,n){v(e,n,t)&&t(null,n.cpaas.recreateClientSecretResult.clientSecret)},null,null,n)},this.deleteApplication=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: deleteApplication...");var r={type:i.CPaaSActionType.DELETE_OAUTH_APPLICATION,deleteOAuthApplication:{clientId:e}};f(i.ContentType.CPAAS,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.createOAuthApplication=function(e,t,n){if(t=t||E,C.debug("[ClientApiHandler]: createOAuthApplication..."),!e)return C.warn("[ClientApiHandler]: No application data were provided"),void A(t,i.ReturnCode.INVALID_MESSAGE);var r={type:i.CPaaSActionType.CREATE_OAUTH_APPLICATION,createOAuthApplication:e};f(i.ContentType.CPAAS,r,function(e,n){v(e,n,t)&&t(null,n.cpaas.createOAuthApplicationResult)},null,null,n)},this.updateApplication=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: updateApplication...");var r={type:i.CPaaSActionType.UPDATE_OAUTH_APPLICATION,updateOAuthApplication:e};f(i.ContentType.CPAAS,r,function(e,n){v(e,n,t)&&t(null,n.cpaas.updateOAuthApplicationResult.application)},null,null,n)},this.createIncomingWebhook=function(e,t){t=t||E,C.debug("[ClientApiHandler]: createIncomingWebhook...");var n={type:i.CPaaSActionType.CREATE_INCOMING_WEBHOOK,createIncomingWebhook:e};f(i.ContentType.CPAAS,n,function(e,n){v(e,n,t)&&t(null,n.cpaas.createIncomingWebhookResult.webhook)})},this.deleteIncomingWebhook=function(e,t){t=t||E,C.debug("[ClientApiHandler]: deleteIncomingWebhook...");var n={type:i.CPaaSActionType.DELETE_INCOMING_WEBHOOK,deleteIncomingWebhook:{webhookId:e}};f(i.ContentType.CPAAS,n,function(e,n){v(e,n,t)&&t(null)})},this.getIncomingWebhook=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getIncomingWebhook...");var n={type:i.CPaaSActionType.GET_INCOMING_WEBHOOK,getIncomingWebhook:{webhookId:e}};f(i.ContentType.CPAAS,n,function(e,n){v(e,n,t)&&t(null,n.cpaas.getIncomingWebhookResult.webhook)})},this.getIncomingWebhooks=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getIncomingWebhooks...");var n={type:i.CPaaSActionType.GET_INCOMING_WEBHOOKS,getIncomingWebhooks:e};f(i.ContentType.CPAAS,n,function(e,n){v(e,n,t)&&(n.cpaas.getIncomingWebhooksResult.webhook=n.cpaas.getIncomingWebhooksResult.webhook||[],t(null,n.cpaas.getIncomingWebhooksResult))})},this.suspendIncomingWebhook=function(e,t){t=t||E,C.debug("[ClientApiHandler]: suspendIncomingWebhook...");var n={type:i.CPaaSActionType.SUSPEND_INCOMING_WEBHOOK,suspendIncomingWebhook:{webhookId:e}};f(i.ContentType.CPAAS,n,function(e,n){v(e,n,t)&&t(null)})},this.unsuspendIncomingWebhook=function(e,t){t=t||E,C.debug("[ClientApiHandler]: unsuspendIncomingWebhook...");var n={type:i.CPaaSActionType.UNSUSPEND_INCOMING_WEBHOOK,unsuspendIncomingWebhook:{webhookId:e}};f(i.ContentType.CPAAS,n,function(e,n){v(e,n,t)&&t(null)})},this.updateIncomingWebhook=function(e,t){t=t||E,C.debug("[ClientApiHandler]: updateIncomingWebhook...");var n={type:i.CPaaSActionType.UPDATE_INCOMING_WEBHOOK,updateIncomingWebhook:e};f(i.ContentType.CPAAS,n,function(e,n){v(e,n,t)&&t(null,n.cpaas.updateIncomingWebhookResult.webhook)})},this.getExchangeSettings=function(e){e=e||E,C.debug("[ClientApiHandler]: getExchangeSettings...");var t={type:i.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:i.ThirdPartyConnectorType.EXCHANGE_CONNECTOR}};f(i.ContentType.THIRDPARTYCONNECTORS,t,function(t,n){v(t,n,e)&&e(null,n.thirdpartyconnectors.getSettings.exchange)},null,["response.thirdpartyconnectors.getSettings.exchange"])},this.saveExchangeSettings=function(e,t){t=t||E,C.debug("[ClientApiHandler]: saveExchangeSettings..."),S&&(e.encryptionKey=String(Date.now()));var n={type:i.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:i.ThirdPartyConnectorType.EXCHANGE_CONNECTOR,exchange:e}};f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&t(null,n.thirdpartyconnectors.saveSettings.exchange)},["request.thirdpartyconnectors.saveSettings.exchange"],["response.thirdpartyconnectors.saveSettings.exchange"])},this.saveOpenXchangeSettings=function(e,t){t=t||E,C.debug("[ClientApiHandler]: saveOpenXchangeSettings...");var n={type:i.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:i.ThirdPartyConnectorType.OPEN_XCHANGE,openXchange:e}};f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&t(null,n.thirdpartyconnectors.saveSettings.openXchange)},["request.thirdpartyconnectors.saveSettings.openXchange"],["response.thirdpartyconnectors.saveSettings.openXchange"])},this.getThirdpartyProviderSettings=function(e,t){if(t=t||E,e=e||{},C.debug("[ClientApiHandler]: getThirdpartyProviderSettings..."),S)A(t,null,{encryptionKey:e.emailAddress});else{var n={type:i.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:i.ThirdPartyConnectorType.CLIENT_THIRDPARTY}};f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&t(null,n.thirdpartyconnectors.getSettings.clientThirdparty)},null,["response.thirdpartyconnectors.getSettings.clientThirdparty"])}},this.saveThirdpartyProviderSettings=function(e,t){if(t=t||E,e=e||{},C.debug("[ClientApiHandler]: saveThirdpartyProviderSettings..."),S)A(t,null,{encryptionKey:e.emailAddress});else{var n={type:i.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:i.ThirdPartyConnectorType.CLIENT_THIRDPARTY,clientThirdparty:{encryptionKey:""}}};f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&t(null,n.thirdpartyconnectors.saveSettings.clientThirdparty)},["request.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"],["response.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"])}},this.connectToThirdParty=function(e,t){var n;switch(t=t||E,C.debug("[ClientApiHandler]: connectToThirdParty "+e+"..."),e){case i.ThirdPartyConnectorType.BOX:case i.ThirdPartyConnectorType.ZAPIER:case i.ThirdPartyConnectorType.SYNCPLICITY:case i.ThirdPartyConnectorType.GOOGLE_CONTACTS:case i.ThirdPartyConnectorType.GOOGLE_DRIVE:case i.ThirdPartyConnectorType.ONE_DRIVE:case i.ThirdPartyConnectorType.CONCEPTBOARD:n={type:i.ThirdPartyConnectorsActionType.CONNECT,connect:{type:e}};break;default:return void A(t,i.ThirdPartyError.UNSUPPORTED_PROVIDER)}f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&(n.thirdpartyconnectors.connect?t(null,n.thirdpartyconnectors.connect.authorizeUrl):t(i.ThirdPartyError.UNSUPPORTED_PROVIDER))},null,["response.thirdpartyconnectors.connect.authorizeUrl"])},this.refreshConnectionToThirdParty=function(e,t,n){var r;if(n=n||E,C.debug("[ClientApiHandler]: refreshConnectionToThirdParty "+e+"..."),e===i.ThirdPartyConnectorType.SYNCPLICITY){r={type:i.ThirdPartyConnectorsActionType.REFRESH_CONNECTION,refreshConnection:{type:e,refreshToken:t}};f(i.ContentType.THIRDPARTYCONNECTORS,r,function(e,t){v(e,t,n)&&(t.thirdpartyconnectors.refreshConnectionResult?n(null,t.thirdpartyconnectors.refreshConnectionResult):n(i.ThirdPartyError.UNSUPPORTED_PROVIDER))},["request.thirdpartyconnectors.refreshConnection.refreshToken"],["response.thirdpartyconnectors.refreshConnectionResult.accessToken","response.thirdpartyconnectors.refreshConnectionResult.refreshToken"])}else A(n,i.ThirdPartyError.UNSUPPORTED_PROVIDER)},this.getFolderItems=function(e,t){var n;switch(t=t||E,C.debug("[ClientApiHandler]: getFolderItems for ",e.provider),e.provider){case i.ThirdPartyConnectorType.BOX:case i.ThirdPartyConnectorType.OPEN_XCHANGE:n={type:i.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS,getFolderItems:{type:e.provider,id:e.folderId,index:e.indexCursor,pageSize:e.pageSize}};break;case i.ThirdPartyConnectorType.GOOGLE_DRIVE:case i.ThirdPartyConnectorType.ONE_DRIVE:case i.ThirdPartyConnectorType.SYNCPLICITY:n={type:i.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS_WITH_CURSOR,getFolderItemsWithCursor:{type:e.provider,syncpointId:e.syncpointId||void 0,id:e.folderId,cursor:e.indexCursor,pageSize:e.pageSize,accessToken:e.accessToken||void 0}};break;default:return void A(t,i.ThirdPartyError.UNSUPPORTED_PROVIDER)}f(i.ContentType.THIRDPARTYCONNECTORS,n,function(n,i){v(n,i,t)&&t(null,{folder:e.folderId,items:i.thirdpartyconnectors.getFolderItemsResult})},["request.thirdpartyconnectors.getFolderItemsWithCursor.accessToken"])},this.getConnectionStatus=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getConnectionStatus "+e+"...");var n={type:i.ThirdPartyConnectorsActionType.GET_CONNECTION_STATUS,getConnectionStatus:{type:e}};f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&t(null,n.thirdpartyconnectors.getConnectionStatus.connected)})},this.disconnectFromThirdParty=function(e,t,n){var r;switch(n=n||E,C.debug("[ClientApiHandler]: disconnectFromThirdParty "+e+"..."),e){case i.ThirdPartyConnectorType.BOX:case i.ThirdPartyConnectorType.ZAPIER:case i.ThirdPartyConnectorType.OPEN_XCHANGE:case i.ThirdPartyConnectorType.SYNCPLICITY:case i.ThirdPartyConnectorType.GOOGLE_CONTACTS:case i.ThirdPartyConnectorType.GOOGLE_DRIVE:case i.ThirdPartyConnectorType.ONE_DRIVE:r={type:i.ThirdPartyConnectorsActionType.DISCONNECT,disconnect:{type:e,accessToken:t||void 0}};break;default:return void A(n,i.ThirdPartyError.UNSUPPORTED_PROVIDER)}f(i.ContentType.THIRDPARTYCONNECTORS,r,function(e,t){v(e,t,n)&&n(null)},["request.thirdpartyconnectors.disconnect.accessToken"])},this.shareFolderItems=function(e,t){if(t=t||E,e){var n,r=e.provider,o=e.itemsData;switch(C.debug("[ClientApiHandler]: shareFolderItems "+r+"..."),r){case i.ThirdPartyConnectorType.BOX:case i.ThirdPartyConnectorType.ZAPIER:case i.ThirdPartyConnectorType.OPEN_XCHANGE:case i.ThirdPartyConnectorType.GOOGLE_DRIVE:case i.ThirdPartyConnectorType.ONE_DRIVE:case i.ThirdPartyConnectorType.SYNCPLICITY:n={type:i.ThirdPartyConnectorsActionType.SHARE_FOLDER_ITEMS,shareFolderItems:{type:r,shareItems:o,conversationId:e.convId,accessToken:e.accessToken||void 0}};break;default:return void A(t,i.ThirdPartyError.UNSUPPORTED_PROVIDER)}f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&t(null,n.thirdpartyconnectors.shareFolderItems)},["request.thirdpartyconnectors.shareFolderItems.accessToken"],["response.thirdpartyconnectors.shareFolderItems.items.[].shareLinkPassword","response.thirdpartyconnectors.shareFolderItems.items.[].downloadUrl","response.thirdpartyconnectors.shareFolderItems.items.[].previewUrl","response.thirdpartyconnectors.shareFolderItems.appKey","response.thirdpartyconnectors.shareFolderItems.accessToken"])}else A(t,i.ReturnCode.MISSING_REQUIRED_PARAMETER)},this.unshareItems=function(e,t){var n;switch(t=t||E,C.debug("[ClientApiHandler]: ushareItems "+e.provider+"..."),e.provider){case i.ThirdPartyConnectorType.OPEN_XCHANGE:case i.ThirdPartyConnectorType.SYNCPLICITY:n={type:i.ThirdPartyConnectorsActionType.UNSHARE_FOLDER_ITEMS,unshareFolderItems:{type:e.provider,fileId:e.itemIds,accessToken:e.accessToken||void 0}};break;default:return void A(t,i.ThirdPartyError.UNSUPPORTED_PROVIDER)}f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&t(null)},["request.thirdpartyconnectors.unshareFolderItems.accessToken"])},this.getEditUrl=function(e,t){var n;C.debug("[ClientApiHandler]: getEditUrl "+e.provider),e.provider===i.ThirdPartyConnectorType.OPEN_XCHANGE?(n={type:i.ThirdPartyConnectorsActionType.GET_EDIT_URL,getEditUrl:{externalAttachment:{type:e.provider,downloadLocation:e.uri,previewLocation:e.uri,attachment:{fileId:e.fileId,fileName:e.fileName,size:e.size,mimeType:e.mimeType}}}},f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&t(null,n.thirdpartyconnectors.getEditUrlResult.url)})):A(t,i.ThirdPartyError.UNSUPPORTED_PROVIDER)},this.getStorageAuthenticationData=function(e,t,n){if(n=n||E,C.debug("[ClientApiHandler]: getStorageAuthenticationData..."),e===i.ThirdPartyConnectorType.SYNCPLICITY){var r={type:i.ThirdPartyConnectorsActionType.CONNECT_STORAGE,connectStorage:{type:i.ThirdPartyConnectorType.SYNCPLICITY,endpointUrls:t}};f(i.ContentType.THIRDPARTYCONNECTORS,r,function(e,t){v(e,t,n)&&n(null,t.thirdpartyconnectors.connectStorageResult.storageAuthenticationData)})}else A(n,i.ThirdPartyError.UNSUPPORTED_PROVIDER)},this.getOAuthData=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getOAuthData...");var n={type:i.ThirdPartyConnectorsActionType.GET_OAUTH_DATA,getOAuthData:{provider:e}};f(i.ContentType.THIRDPARTYCONNECTORS,n,function(e,n){v(e,n,t)&&t(null,n.thirdpartyconnectors.getOauthDataResult.oAuthData)},null,["response.thirdpartyconnectors.getOauthDataResult.oAuthData"])},this.getGlobalProperty=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getGlobalProperty...");var n={type:i.SystemActionType.GET_GLOBAL_PROPERTY,getGlobalProperty:{globalPropertyName:e}};f(i.ContentType.SYSTEM,n,function(e,n){v(e,n,t)&&t(null,n.system.getGlobalPropertyResult.property)})},this.getGlobalProperties=function(e,t){t=t||E,e instanceof Array||(e=[e]),C.debug("[ClientApiHandler]: getGlobalProperties...");var n={type:i.SystemActionType.GET_GLOBAL_PROPERTIES,getGlobalProperties:{globalPropertyNames:e}};f(i.ContentType.SYSTEM,n,function(e,n){v(e,n,t)&&t(null,n.system.getGlobalPropertiesResult.property)})},this.validateSessionInvite=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: validateSessionInvite...");var r={type:i.GuestActionType.VALIDATE_SESSION_INVITE_TOKEN,validateSessionInviteToken:{token:{token:e},configurableTextsLanguage:t||void 0}};f(i.ContentType.GUEST,r,function(e,t){v(e,t,n)&&n(null,t.guest.validateSessionInviteToken)},null,["response.guest.validateSessionInviteToken.convTopic"])},this.getRegions=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getRegions ...");var n={type:i.GuestActionType.GET_REGIONS,getRegions:{token:{token:e}}};f(i.ContentType.GUEST,n,function(e,n){v(e,n,t)&&t(null,n.guest.getRegions)},null,["response.guest.getRegions.convTopic"])},this.registerSessionGuest=function(e,t){t=t||E,C.debug("[ClientApiHandler]: registerSessionGuest...");var n={type:i.GuestActionType.REGISTER_SESSION_GUEST,registerSessionGuest:{token:{token:e.token},firstName:e.firstName,lastName:e.lastName,forTestCall:e.testCall,locale:e.locale,userId:d||void 0,oldClientId:l||void 0,previousServer:u||void 0}};f(i.ContentType.GUEST,n,function(e,n){if(v(e,n,t)){var i=n.guest.registerSessionGuestResult;I=a.convertVersionToNumber(i.apiVersion),u=i.connectedBackend,l=i.clientId,d=i.userId,t(null,i)}},null,["response.guest.registerSessionGuestResult.guestContext"])},this.sendUserToUserRequest=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: sendUserToUserRequest, type: "+e+", data: ",t);var r={type:i.ContentType.USER_TO_USER,userToUser:{type:e,routing:{destUserId:t.destUserId,srcUserId:d,destClientId:t.destClientId,srcClientId:l},data:JSON.stringify(t.content)}};f(i.ContentType.USER_TO_USER,r,function(e,t){v(e,t,n)&&n(null,t.userToUser)},["request.userToUser.userToUser.data"])},this.getPackages=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getPackages...");var n={type:i.AccountActionType.GET_ASSIGNED_PACKAGES};f(i.ContentType.ACCOUNT,n,function(t,n){v(t,n,e)&&e(null,n.account.getAssignedPackages.packages||[])},null,null,t)},this.getAccounts=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: getAccounts...");var r={type:i.AccountActionType.GET_ACCOUNTS,getAccounts:{searchCriterias:e.searchCriterias,sorting:e.sorting,ordering:e.ordering,searchPointer:e.searchPointer,pageSize:e.pageSize,excludedTags:e.excludedTags}};f(i.ContentType.ACCOUNT,r,function(e,n){v(e,n,t)&&t(null,n.account.getAccounts)},null,["response.account.getAccounts.accounts"],n)},this.getAccountByUserId=function(e,t){t=t||E,C.debug("[ClientApiHandler]: getAccountByUserId...");var n={type:i.AccountActionType.GET_ACCOUNT_BY_USER_ID,getAccountByUserId:{userId:e}};f(i.ContentType.ACCOUNT,n,function(e,n){v(e,n,t)&&t(null,n.account.getAccountByUserId.account)})},this.migrateAccount=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: migrateAccount...");var r={type:i.AccountActionType.MIGRATE_ACCOUNT,migrateAccount:{accountId:e.accountId,accountTemplateId:e.accountTemplateId}};f(i.ContentType.ACCOUNT,r,function(e,n){v(e,n,t)&&t(null,n.account.migrateAccount)},null,null,n)},this.migrateMultipleUsers=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: migrateMultipleUsers...");var r={type:i.AccountActionType.MIGRATE_MULTIPLE_USERS,migrateMultipleUsers:{accountIds:e.accountIds,accountTemplateId:e.accountTemplateId}};f(i.ContentType.ACCOUNT,r,function(e,n){v(e,n,t)&&t(null,n)},null,null,n)},this.suspendAccount=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: suspendAccount...");var r={type:i.AccountActionType.SUSPEND_ACCOUNT,suspendAccount:{accountId:e}};f(i.ContentType.ACCOUNT,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.unsuspendAccount=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: unsuspendAccount...");var r={type:i.AccountActionType.UNSUSPEND_ACCOUNT,unsuspendAccount:{accountId:e}};f(i.ContentType.ACCOUNT,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.suspendUser=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: suspendUser...");var r={type:i.AdministrationActionType.SUSPEND_USER,suspendUser:{userId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.unsuspendUser=function(e,t,n){t=t||E,C.debug("[ClientApiHandler]: unsuspendUser...");var r={type:i.AdministrationActionType.UNSUSPEND_USER,unsuspendUser:{userId:e}};f(i.ContentType.ADMINISTRATION,r,function(e,n){v(e,n,t)&&t(null)},null,null,n)},this.assignTelephonyConfiguration=function(e,t,n,r){n=n||E,C.debug("[ClientApiHandler]: assignTelephonyConfiguration...");var o={type:i.AccountActionType.ASSIGN_TELEPHONY_CONFIGURATION,assignTelephonyConfiguration:{accountId:e,configuration:{phoneNumber:a.cleanPhoneNumber(t.phoneNumber),callerId:a.cleanPhoneNumber(t.callerId),reroutingPhoneNumber:a.cleanPhoneNumber(t.reroutingPhoneNumber),onsSipAuthenticationHash:t.onsSipAuthenticationHash||"",ondSipAuthenticationHash:t.ondSipAuthenticationHash||"",associatedTelephonyUserID:t.associatedTelephonyUserID||"",associatedTelephonyTrunkGroupId:t.associatedTelephonyTrunkGroupId||"",associatedTelephonyUserType:t.associatedTelephonyUserType||void 0}}};f(i.ContentType.ACCOUNT,o,function(e,t){v(e,t,n)&&n(null)},["request.account.assignTelephonyConfiguration.configuration.onsSipAuthenticationHash","request.account.assignTelephonyConfiguration.configuration.ondSipAuthenticationHash"],null,r)},this.renewAssociatedTelephonyUser=function(e,t){t=t||E,C.debug("[ClientApiHandler]: renewAssociatedTelephonyUser...");var n={type:i.AccountActionType.RENEW_ASSOCIATED_TELEPHONY_USER,renewAssociatedTelephonyUser:{currentAssociatedTelephonyUserId:e}};f(i.ContentType.ACCOUNT,n,function(e,n){v(e,n,t)&&t(null)})},this.getTechnicalAdminUserId=function(e,t){e=e||E,C.debug("[ClientApiHandler]: getTechnicalAdminUserId...");var n={type:i.AccountActionType.GET_TECHNICAL_ADMIN_USER_ID};f(i.ContentType.ACCOUNT,n,function(t,n){v(t,n,e)&&e(null,n.account.getTechnicalAdminUserIdResult.technicalAdminUserId)},null,null,t)},this.addAccountPermission=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: addAccountPermission...");var r={type:i.AccountActionType.ADD_ACCOUNT_PERMISSION,addAccountPermission:{accountId:e,permissionName:t}};f(i.ContentType.ACCOUNT,r,function(e,t){v(e,t,n)&&n(null)})},this.removeAccountPermission=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: removeAccountPermission...");var r={type:i.AccountActionType.REMOVE_ACCOUNT_PERMISSION,removeAccountPermission:{accountId:e,permissionName:t}};f(i.ContentType.ACCOUNT,r,function(e,t){v(e,t,n)&&n(null)})},this.submitFormData=function(e,t,n){n=n||E,C.debug("[ClientApiHandler]: submitFormData...");var r={type:i.CPaaSActionType.SUBMIT_FORM_DATA,submitFormData:{itemId:e,form:t}};f(i.ContentType.CPAAS,r,function(e,t){v(e,t,n)&&n(null)})},this.getUserData=function(e){e=e||E,C.debug("[ClientApiHandler]: getUserData...");var t={type:i.UserDataActionType.GET_USER_DATA};f(i.ContentType.USER_DATA,t,function(t,n){v(t,n,e)&&e(null,n.userData.getUserData)})}}return s.prototype.constructor=s,s.prototype.name="ClientApiHandler",t.ClientApiHandler=s,t}(e=function(e){"use strict";var t=e.BaseEventTarget,i=e.Enums.ConnectionState,r=e.Constants,o=e.Proto,a=e.Utils;function s(t){var c=e.logger;t=t||{},s.parent.constructor.call(this,c);var l=500,d=this,u={},C={},E=[],T="/api",p=n.location.host,S=null,I=null,f=Object.keys(r.DeviceType),R={deviceType:!0,deviceSubtype:!0,manufacturer:!0,osVersion:!0,clientVersion:!0,hardwareModel:!0,capabilities:!0},v=0,A=t.disablePing||a.isMobile()?-1:3e5,g=null,_=!1,N=new e.ConnectionController(t);function m(){var e={};return S&&(e.accessToken=S),I?Object.assign(e,I):"undefined"!=typeof __clientVersion&&(e.clientVersion=__clientVersion),"wss://"+p+T+(Object.keys(e).length?"?"+a.toQS(e):"")}function h(e){c.debug("[ConnectionHandler]: Raising event",e.name),e.cbList.forEach(function(t){try{t(e.data)}catch(e){c.error("[ConnectionHandler]: Error raising event. ",e)}})}function O(){E.length>0&&(c.debug("[ConnectionHandler]: Raise all delayed events"),E.forEach(function(e){n.clearTimeout(e.timeoutId),h(e)}),E=[])}function D(e){!v&&e.apiVersion&&(v=a.convertVersionToNumber(e.apiVersion));var t=function(e){var t;switch(e.msgType){case r.WSMessageType.RESPONSE:if(!e.response||!e.response.code)return null;var i;if(e.response.user&&("GET_STUFF"===e.response.user.type?i=e.response.user.getStuff.user:"GET_LOGGED_ON"===e.response.user.type&&(i=e.response.user.getLoggedOn.user),i&&(i.clientId=e.clientId,i.apiVersion=e.apiVersion)),C[e.response.requestId])return t=C[e.response.requestId],delete C[e.response.requestId],t.timer&&n.clearTimeout(t.timer),t.keysToOmitFromResponse&&(e.keysToOmitFromLogging=t.keysToOmitFromResponse),{type:"ack",cb:t.cb,data:e.response};c.debug("[ConnectionHandler]: No callback for response with requestId=",e.response.requestId);break;case r.WSMessageType.EVENT:var a=o.ParseEvent(e.event,e.apiVersion);if(a&&a.name){if(u[a.name])return t=u[a.name],c.debug("[ConnectionHandler]: Parsed event: ",a.name),d.ommitKeysFromLog&&t.keysToOmitFromEvent&&(e.keysToOmitFromLogging=t.keysToOmitFromEvent),{type:"evt",cbList:t.cbList,name:a.name,data:a.data,suppressLog:t.suppressLog};c.debug("[ConnectionHandler]: No registered callback for event ",a.name)}else c.error("[ConnectionHandler]: Failed to parse event: ",e.event);break;default:c.error("[ConnectionHandler]: Unexpected message type: ",e.msgType)}return null}(e);if(t)if(t.suppressLog||c.msgRcvd("[ConnectionHandler]: ",e),"evt"===t.type)Object.keys(C).length>0&&/^(?:User|Conversation|Search)\./.test(t.name)?(c.debug("[ConnectionHandler]: Delay event:",t.name),t.timeoutId=n.setTimeout(function(){h(t);var e=E.indexOf(t);-1!==e&&E.splice(e,1)},l),E.push(t)):h(t);else{var i=Object.keys(C).length;c.debug("[ConnectionHandler]: Remaining callbacks pending: ",i),t.cb(null,t.data),0===i&&O()}}N.onStateChange=function(e){if(c.debug("[ConnectionHandler]: WebSocket connection state changed to ",e.newState),c.debug("[ConnectionHandler]: Raising connectionStateChange event"),e.newState===i.Connected)v=0,!g&&A>0&&(g=n.setInterval(function(){d.pingServer()},A));else if(g&&(n.clearInterval(g),g=null),Object.keys(C).length){var t=C;C={},n.setTimeout(function(){Object.keys(t).forEach(function(e){var i=t[e];i.timer&&n.clearTimeout(i.timer),i.cb(r.ReturnCode.DISCONNECTED)}),O()},0)}var o=d.createEvent("connectionStateChange");o.newState=e.newState,o.oldState=e.oldState,d.dispatch(o)},N.onReconnectFailed=function(){c.debug("[ConnectionHandler]: WebSocket failed to reconnect. Raising reconnectFailed event");var e=d.createEvent("reconnectFailed");d.dispatch(e)},N.onMessage=D,this.ommitKeysFromLog=!0,this.onMessage=D,this.setRelativeUrl=function(e){T=e,c.debug("[ConnectionHandler]: Set relative URL to ",T)},this.setTarget=function(e){p=e||n.location.host,c.debug("[ConnectionHandler]: Set target to ",p)},this.setClientInfo=function(e){if(e){if(!e.deviceSubtype||-1===f.indexOf(e.deviceType))return void c.warn("[ConnectionHandler]: Attempted to set invalid clientInfo: ",e);I={},Object.keys(e).forEach(function(t){R[t]&&(I[t]=e[t])}),c.debug("[ConnectionHandler]: Set clientInfo to ",I)}else c.debug("[ConnectionHandler]: Clear clientInfo"),I=null},this.setToken=function(e){S=e},this.getUrl=m,this.getState=function(){return N.getState()},this.connect=function(e,t){c.debug("[ConnectionHandler]: Connect WebSocket to Access Server"),N.connect(m(),e,t)},this.disconnect=function(){c.debug("[ConnectionHandler]: Disconnect WebSocket from Access Server"),N.disconnect()},this.reconnect=function(e){c.debug("[ConnectionHandler]: Reconnect WebSocket to Access Server."),N.reconnect(m(),e)},this.sendMessage=function(e,t,i,o){return e&&e.request&&e.request.requestId?(c.debug("[ConnectionHandler]: Sending "+e.request.type+" request"),N.sendMessage(e)?(t&&function(e,t,i,o){if(t){var a=n.setTimeout(function(e){if(c.error("[ConnectionHandler]: Timeout waiting for response. RequestId:",e),C[e]){delete C[e],t(r.ReturnCode.REQUEST_TIMEOUT);var n=Object.keys(C).length;c.debug("[ConnectionHandler]: Remaining callbacks pending: ",n),0===n&&O(),d.pingServer()}},o,e);Array.isArray(i)||(i=null),C[e]={cb:t,timer:a,keysToOmitFromResponse:i}}}(e.request.requestId,t,i,o||6e4),!0):(c.error("[ConnectionHandler]: Failed to send message"),t&&n.setTimeout(function(){t(r.ReturnCode.FAILED_TO_SEND)},0),!1)):(c.error("[ConnectionHandler]: Cannot send message. Invalid message: ",e),t&&n.setTimeout(function(){t(r.ReturnCode.INVALID_MESSAGE)},0),!1)},this.pingServer=function(){if(N.isConnected()&&!_){var e,t="PING";if(a.isMobile()||(t+="|"+(e=++o.requestNr)),N.sendMessage(t),e){_=!0;var i=n.setTimeout(function(){_=!1,c.error("[ConnectionHandler]: Timed out waiting for ping response. RequestId:",e),delete C[e],N.reconnect(m())},1e4);C[e]={cb:function(){_=!1},timer:i}}}},this.setPingInterval=function(e){"number"==typeof e&&(e=e<0?-1:Math.max(Math.floor(e),3e4),A!==e&&(A=e,g&&(n.clearInterval(g),g=null),A<0?c.info("[ConnectionHandler]: Disable ping"):(c.info("[ConnectionHandler]: Set ping interval time to ",A),N.isConnected()&&(c.info("[ConnectionHandler]: Restart ping interval"),g=n.setInterval(function(){d.pingServer()},A)))))},this.on=function(e,t,n){if(e&&t){var i=u[e]||{cbList:[]};i.cbList.push(t),n&&(Array.isArray(n)?i.keysToOmitFromEvent=n:"*"===n&&(i.suppressLog=!0)),u[e]=i}}}return a.inherit(s,t),s.prototype.name="ConnectionHandler",e.ConnectionHandler=s,e}(e=function(e){"use strict";function t(e){var t={};this.dispatch=function(n){var i=n&&n.type;i?t[i]?t[i].forEach(function(t){try{t(n)}catch(t){e&&e.error(t)}}):e&&e.debug("[EventTarget]: There is no listener for "+i):e&&e.error("[EventTarget]: Attempted to dispatch a bad event")},this.addEventListener=function(n,i){n&&"function"==typeof i?(t[n]||(t[n]=[]),t[n].indexOf(i)>=0?e&&e.warning("[EventTarget]: Attempted to add duplicate event listener"):(t[n].push(i),e&&e.debug("[EventTarget]: Added event listener for "+this.name+", type = "+n+", count = "+t[n].length))):e&&e.error("[EventTarget]: addEventListener invoked with invalid arguments")},this.removeEventListener=function(n,i){if(t[n]){var r=t[n].indexOf(i);r>=0&&t[n].splice(r,1),e&&e.debug("[EventTarget]: Removed event listener for "+this.name+", type = "+n+", count = "+t[n].length)}},this.hasEventListener=function(e){return!!t[e]&&t[e].length>0},this.removeAllListeners=function(){t={}}}return t.prototype.constructor=t,t.prototype.createEvent=function(e){return{type:e}},t.prototype.dispatchEvent=function(e){var t=this.createEvent(e);this.dispatch(t)},e.BaseEventTarget=t,e}((e=function(e){"use strict";var t,n=e.Utils,i="#f0f0f0",o=10,c=312,l=484,d="tHuMbNaIl___";function u(e,t,n,o,a,s,c,l,d){var u=r.createElement("canvas"),C=u.getContext("2d");return u.width=l,u.height=d,C.fillStyle=i,C.fillRect(0,0,u.width,u.height),C.drawImage(e,t,n,o,a,s,c,l,d),u.toDataURL("image/jpeg")}function C(e){for(var t=atob(e.split(",")[1]),n=[],i=0;i<t.length;i++)n.push(t.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})}function E(e){return new t(function(t){var n=new FileReader;n.onload=function(n){var i=new Image;i.onload=function(){var n=C(function(e){var t,n;return(n=e.height)/(t=e.width)>c/l?e.height>c&&(t=t*c/n,n=c):t>l&&(n=n*l/t,t=l),u(e,0,0,e.width,e.height,0,0,t,n)}(this));n.name=d+(e.modifiedName||e.name),n.lastModified=Math.round(Date.now()/1e3),t(n)},i.src=n.target.result},n.readAsDataURL(e)})}function T(e){var i=e?e.domain:null,r=1,s={};function c(e,n,i,r,o){logger.error("[FileUpload] uploadFile()");var c=function(){s[e]&&(s[e].xhr=null)};return new t(function(t,r){var l=n.modifiedName||n.name,d=new a;d.withCredentials=!0,d.open("POST",i,!0),d.setRequestHeader("Content-Type",n.type),d.setRequestHeader("Content-Disposition",'attachment; filename="'+encodeURIComponent(l)+'"'),o&&(o.convId&&d.setRequestHeader("x-conversation",o.convId),o.rtcSessionId&&d.setRequestHeader("x-rtcsession",o.rtcSessionId),o.token&&d.setRequestHeader("authorization","SecToken "+o.token)),d.onprogress=function(e){e.lengthComputable?(logger.error("[FileUpload] loaded = "+e.loaded),logger.error("[FileUpload] total = "+e.total)):logger.error("[FileUpload] Error: Could not compute upload progress information!")},d.onload=function(){logger.error("[FileUpload] onLoad()"),c(),200===d.status?t(d.response):r({filename:l,status:d.status,statusText:d.statusText,response:d.response,responseText:d.responseText})},d.onerror=function(){logger.error("[FileUpload] onError()"),c(),r({filename:l,status:500,statusText:"Connection Failed"})},d.onabort=function(){logger.error("[FileUpload] onAbort()"),c(),r({filename:l,status:0,statusText:"abort"})},s[e].xhr=d,d.send(n)})}this.uploadFiles=function(e,a,l,d,u){if(!t)throw new Error("Promise support is required to use FileUpload");if(e.length>o)return t.reject("Exceeded maximum of 10 files per message");var C=(a=a||i)?"https://"+a:"",T=[],p=r;r++,s[p]={xhr:null,deleteUrls:[]};var S=[];!u&&e.forEach(function(e){n.isSupportedImage&&n.isSupportedImage(e.type)&&S.push(E(e))});var I=t.all(S).then(function(n){return Array.prototype.push.apply(e,n),l=l||null,e.reduce(function(e,t){return e.then(function(){return c(p,t,C+"/fileapi?itemid="+(l||"NULL")).then(function(e){var n=JSON.parse(e)[0];l=l||n.id;var i=n.fileid[n.fileid.length-1],r={fileId:i,fileName:t.modifiedName||t.name,itemId:l,mimeType:n.mimeType||t.type,size:t.size,url:C+"/fileapi?fileid="+i+"&itemid="+l,deleteUrl:C+"/fileapi?fileid="+i+"&itemid="+l};return T.push(r),s[p].deleteUrls.push(r.deleteUrl),T})})},t.resolve())}).then(function(e){return delete s[p],t.resolve(e)}).catch(function(e){return delete s[p],t.reject(e)});return I.__uploadId=p,I},this.uploadWhiteboardFile=function(e,n,o){if(!t)throw new Error("Promise support is required to use FileUpload");var a=(i?"https://"+i:"")+"/fileapi",l=r;r++,s[l]={xhr:null,deleteUrls:[]};var d=c(l,e,a,0,{rtcSessionId:n,token:o}).then(function(n){var i=JSON.parse(n)[0],r=i.fileId||i.id,o=a+"?fileid="+r,c={fileId:r,fileName:e.modifiedName||e.name,mimeType:i.mimeType||e.type,size:e.size,url:o,deleteUrl:o};return delete s[l],t.resolve(c)}).catch(function(e){return delete s[l],t.reject(e)});return d.__uploadId=l,d},this.abort=function(e){if(e&&e.__uploadId&&s[e.__uploadId]){var t=s[e.__uploadId];delete s[e.__uploadId],t.xhr&&t.xhr.abort(),(n=t.deleteUrls)&&n.forEach(function(e){var t=new a;t.withCredentials=!0,t.open("DELETE",e),t.send()})}var n}}return void 0!==s&&(t=s),T.COMPRESSED_IMG_PREFIX=d,T.dataURItoBlob=C,T.drawCanvasImage=u,T.overridePromise=function(e){t=e},e.FileUpload=T,e}((e=function(e){"use strict";var t=e.AtcCallInfo,n=e.BaseCall,i=e.Enums.CallState,r=e.Enums.CstaCallState,o=e.logger;function a(e){if(!e||!e.rtcSessionId)throw new Error("Cannot create AtcRemoteCall object without a valid conversation");a.parent.constructor.call(this,e,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return this.atcCallInfo.isHandoverAllowed()&&this.atcCallInfo.cstaState!==r.Ringing},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return this.checkState(i.ActiveRemote)&&this.checkCstaState(r.Active)},enumerable:!0,configurable:!1}}),this.isAtcRemote=!0,this.atcCallInfo=new t,e=null,o.info("[AtcRemoteCall]: Created new ATC remote call with callID = ",this.callId)}return e.Utils.inherit(a,n),a.prototype.isPresent=function(){return!this.checkState([i.Idle,i.Terminated])||!this.checkCstaState([r.Idle,r.Failed,r.TransferFailed,r.Terminated])},e.AtcRemoteCall=a,e}((e=function(e){"use strict";var t,i=e.Constants,r=e.IceCandidate,o=e.logger,a=e.ScreenSharingController,s=e.sdpParser,c=e.Utils,l=e.Enums.VideoCodecs,d=e.Enums.VideoResolutionLevel;void 0!==n.Promise&&(t=n.Promise);var u=Object.freeze({None:"None",AnswerPending:"Answer-Pending",AnswerSent:"Answer-Sent",AnswerApplied:"Answer-Applied",OfferPending:"Offer-Pending",OfferSent:"Offer-Sent",OfferReceived:"Offer-Received",Connected:"Connected",PrAnswerReceived:"PrAnswer-Received",AnswerReceived:"Answer-Received",Disconnected:"Disconnected"}),C=2e3,E=200,T="ConstraintNotSatisfiedError",p="OverconstrainedError",S="TrackStartError",I="NotReadableError",f=["PermissionDeniedError","SecurityError","NotAllowedError"],R=5e3,v=1e3,A=l.VP8,g=Object.freeze({audio:{maxplaybackrate:24e3,"sprop-maxcapturerate":24e3,maxaveragebitrate:16e3,usedtx:1},video:{maxBw:512},hdVideo:{"1080p":{maxBw:2e3},"720p":{maxBw:1536},"480p":{maxBw:512},maxBw:2e3},screenShare:{maxBw:300,maxFrameRate:5,minFrameRate:3},hdScreenShare:{maxBw:2e3,minFrameRate:3,maxFrameRate:7},receiveVideo:{maxBwMobile:512,maxBw:2e3},rtcpMuxPolicy:"negotiate",preferredVideoCodec:A}),_=Object.freeze({video:{minBitRate:60},hdVideo:{"1080p":{minBitRate:1200,maxBitRate:2e3},"720p":{minBitRate:750,maxBitRate:1500},"480p":{minBitRate:500,maxBitRate:512},startBitRate:500,minBitRate:1e3,maxBitRate:2e3,maxQuantization:56},screenShare:{},hdScreenShare:{minBitRate:1e3,maxBitRate:2e3,maxQuantization:40}}),N=Object.freeze({AUDIO_VIDEO:0,DESKTOP:1}),m=Object.values(d),h=2,O=2;function D(e){return!(e={audio:!!(e=e||{}).audio,video:!!e.video,hdVideo:!!e.hdVideo,videoResolution:e.videoResolution||null,desktop:!!e.desktop,hdDesktop:!!e.hdDesktop,screenControl:!!e.screenControl}).videoResolution||e.hdVideo&&m.includes(e.videoResolution)||(e.videoResolution=null),e}function y(){var e={};return{add:function(t,n){e[t]=n},get:function(t){return e[t]},remove:function(t){delete e[t]},getAll:function(){return e},removeAll:function(){e={}}}}function P(l){var d=e.WebRTCAdapter,g=12e4,_=15e3,N=1e3,b=3e4,U=0,L=1,M={audio:0,video:1,screen:2},w=this,G=(l=l||{}).callId||"",H=!!l.isDirectCall,k=!!l.isTelephonyCall,V=!!l.midMappingEnabled,F=0,B=[null,null],x=null,W=null,Y=null,K=[x,Y],q={main:{sdpStatus:u.None,trickleIceForOffer:!k&&!P.disableTrickleIce&&!l.disableTrickleIce,trickleIceForAnswer:!1,candidatesTimer:null,connectedTimer:null,localOrigin:null,sentIceCandidates:[],disabledRemoteOfferMLines:new y,nextPcLocalSdpSetAt:0},screenControl:{trickleIceForOffer:!P.disableTrickleIce&&!l.disableTrickleIce,trickleIceForAnswer:!1,sdpStatus:u.None,candidatesTimer:null,connectedTimer:null,localOrigin:null,sentIceCandidates:[]}},j=null,Q=[],z={},X=!1,J=!1,$=!1,Z=null,ee=null,te=null,ne=null,ie=null,re=null,oe=[],ae=null,se={audio:!1,video:!1},ce=null,le=!1,de=!1,ue=!1,Ce=!1,Ee=!1,Te=D(),pe=null,Se=null,Ie=!1,fe=null,Re=!1,ve=!1,Ae=[],ge=!1,_e=!1,Ne=!!l.isLargeConference,me=!!l.isSessionGuest,he=!!l.isAtcPullCall,Oe=null,De=null,ye=!1,Pe=null,be=!1,Ue=!!l.candidatesCollectionTest,Le=c.getBrowserInfo(),Me={},we=!1,Ge=!1,He="",ke=!1;function Ve(e,t){Re||x.getLocalStreams().indexOf(e)>=0&&(o.warn("[RtcSessionController]: Local "+(t?"Desktop":"Audio/Video")+" Media Stream has ended unexpectedly"),function(e){o.debug("[RtcSessionController]: send LocalStreamEnded event"),Xe(w.onLocalStreamEnded,{isDesktop:e})}(t))}function Fe(e,t,n){if((n=n||{}).mediaStream){var i=n.mediaStream;i.oninactive=Ve.bind(null,i,!0),Ot(i,L),e()}else n.streamId||n.screenType?xe(e,t,n):(n.isScreenControlSupported=Te.screenControl,Pe=a.getScreen(function(i){if(i)if(i.streamId)n.streamId=i.streamId;else if(i.mediaStream)return void e(i.mediaStream);xe(e,t,n)},t,n))}function Be(e,t,i){o.debug("[RtcSessionController]: Get User Media for ",Te),i=i||{},Te.audio||Te.video?function(e,t){o.debug("[RtcSessionController]: getUserMediaAudioVideo()");var i=null;try{var r,a=function(){if(B[U]){var e=B[U];return e.oninactive=Ve.bind(null,e,!1),B[U]=null,e}var t=!J||Le.msie||Le.firefox&&!Te.desktop&&pe.desktop;if(X&&t&&"android"!==d.browser&&Te.audio===pe.audio&&Te.video===pe.video&&Te.hdVideo===pe.hdVideo&&Te.videoResolution===pe.videoResolution)return ee[U];return null}();if(a)return o.debug("[RtcSessionController]: getUserMediaAudioVideo(): Reusing audio/video stream ID: ",d.getStreamId(a)),Ot(a,U),void e();var s={audio:!1,video:!1};d.getMediaSources(function(a,l){var u,C;if(o.debug("[RtcSessionController]: Retrieved media sources"),Te.audio){var E={};!(u=function(e,t){var n=c.selectMediaDevice(e,P.recordingDevices),i={enableAudioAGC:P.enableAudioAGC,sourceId:n&&n.id};if(!Ge&&X&&(Le.firefox||Le.chrome)&&Te.audio===pe.audio&&Me.enableAudioAGC===i.enableAudioAGC&&Me.sourceId===i.sourceId){var r=ee[U],a=r&&r.getAudioTracks()[0];if(a&&"ended"!==a.readyState)return t.oldAudioTrack=a,null}return o.debug("[RtcSessionController]: Input device selected: ",n),i}(a,E))&&E.oldAudioTrack?(o.debug("[RtcSessionController]: Reusing audio track"),r=E.oldAudioTrack.clone()):s.audio=d.getAudioOptions(u)}var R={},v=[];if(Te.video){if(Te.hdVideo){var A=Te.videoResolution?m.indexOf(Te.videoResolution):0;v=m.slice(A),R.videoResolution=v.shift()}C=c.selectMediaDevice(l,P.videoDevices),R.sourceId=C&&C.id,s.video=d.getVideoOptions(R)}if(X&&Te.video&&pe.video&&(Te.hdVideo!==pe.hdVideo||Te.videoResolution!==pe.videoResolution)&&d.stopLocalVideoTrack(ee[U]),r&&!s.audio&&!s.video){var _=new d.MediaStream([r]);return _.oninactive=Ve.bind(null,_,!1),Ot(_,U),void e()}i=n.setTimeout(function(){i=null,o.warn("[RtcSessionController]: Failed to access local media: device unresponsive"),t("res_MediaInputDevicesUnresponsive")},g);var N=function(){o.info("[RtcSessionController]: Calling getUserMedia - constraints = ",s),d.getUserMedia(s,function(a,s){if(u&&(Me=u),o.info("[RtcSessionController]: User has granted access to local media"),o.debug("[RtcSessionController]: Local MediaStream: ",d.getStreamId(a)),!i)return o.info("[RtcSessionController]: GUM time out already fired"),void Nt(a);if(n.clearTimeout(i),i=null,ye)return o.info("[RtcSessionController]: Session already terminated. Stop audio/video MediaStream: ",d.getStreamId(a)),void Nt(a);if(Te.video&&!a.getVideoTracks().length){if(X&&!pe.video)return void t("res_CameraAccessRestricted");Te.video=!1,o.info("[RtcSessionController]: Failed to get access to video stream. Fallback to audio-only."),c="res_AddVideoFailed","function"==typeof w.onRtcWarning&&n.setTimeout(function(){!function(e){o.debug("[RtcSessionController]: send Warning event"),Xe(w.onRtcWarning,{warning:e})}(c)},0),o.info("[RtcSessionController]: New getUserMedia - constraints = ",Te)}var c;r&&a.addTrack(r),Ot(a,U),a.oninactive=Ve.bind(null,a,!1),e(),s&&(o.warn("[RtcSessionController]: Get user media succeeded. But we had an exception: ",s.name||"<unknown>"),Xe(w.onGetUserMediaException,{info:s}))},function(e){var r,a=e&&e.name||"Unspecified";if(R.videoResolution&&(a===T||a===p))return o.warn("[RtcSessionController]: Failed to access local media with HD constraints: ",s.video),R.videoResolution=v.shift(),s.video=d.getVideoOptions(R),void N();o.warn("[RtcSessionController]: Failed to access local media: ",a),i&&(n.clearTimeout(i),i=null),r=f.includes(a)?Te.video?"res_AccessToMediaInputDevicesFailedPermissionDenied":"res_AccessToAudioInputDeviceFailedPermissionDenied":a===S||a===I?Te.video?"res_AccessToMediaInputDevicesFailedInUse":"res_AccessToAudioInputDeviceFailedInUse":Te.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed",t(r)})};N(),o.debug("[RtcSessionController]: Requested access to Local Media")})}catch(e){o.error("[RtcSessionController]: Exception while handling getUserMedia: ",e),i&&(n.clearTimeout(i),i=null),t(Te.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed")}}(function(){Te.desktop&&!P.disableDesktopPc?B[L]?(i.mediaStream=B[L],Fe(e,t,i)):X&&pe.desktop&&!$?(Ot(ee[L],L),e()):(Fe(e,t,i),$=!1):(Ot(null,L),e())},t):Te.desktop?(X&&pe.desktop&&!$&&(i.mediaStream=ee[L]),Fe(e,t,i)):n.setTimeout(e,0)}function xe(e,t,n){o.debug("[RtcSessionController]: getUserMediaDesktop()");try{var r={audio:!1},a=Te.hdDesktop?"hdScreenShare":"screenShare",s={frameRate:{min:P.sdpParameters[a].minFrameRate,max:P.sdpParameters[a].maxFrameRate}};r.video=d.getDesktopOptions(n.streamId||n.screenType,s),o.info("[RtcSessionController]: Calling getUserMedia - constraints = ",r),d.getUserMedia(r,function(t){if(o.info("[RtcSessionController]: User has granted access for screen capture. Stream Id:",d.getStreamId(t)),ye)return o.info("[RtcSessionController]: Session already terminated. Stop desktop MediaStream: ",d.getStreamId(t)),void Nt(t);var i;n&&(ge=n.isScreenControlled,_e=ge,i=n.pointer,o.debug("[RtcSessionController]: send ScreenSharePointerStatus event"),Xe(w.onScreenSharePointerStatus,{isSupported:!(!i||!i.isSupported),isEnabled:!(!i||!i.isEnabled)})),t.oninactive=Ve.bind(null,t,!0),Ot(t,L),e()},function(e){var n=e&&e.name||"Unspecified";o.warn("[RtcSessionController]: Failed to access local media: ",n),f.includes(n)?t(i.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED):t("res_AccessToDesktopFailed")}),o.debug("[RtcSessionController]: Requested access for screen capture")}catch(e){o.error("[RtcSessionController]: Exception while handling getUserMedia: ",e),t("res_AccessToDesktopFailed")}}function We(t){if(t){if(W)return!0}else if(x)return!0;var n={};Le.edge&&!ke&&(n.bundlePolicy="max-compat"),k&&(n.rtcpMuxPolicy=P.sdpParameters.rtcpMuxPolicy),Q.length&&!he?(Le.firefox&&(Q=Q.filter(function(e){return!/turns:\d{1,3}(\.\d{1,3}){3}/.test(e)})),n.iceServers=[{urls:Q,credential:z.password,username:z.username}],P.allowOnlyRelayCandidates&&(n.iceTransportPolicy="relay")):(he||o.warn("[RtcSessionController]: No TURN server(s) provided."),n.iceServers=[]);var i=!!he;he=!1,P.webRTCIPHandlingPolicy&&o.info("[RtcSessionController]: webRTCIPHandlingPolicy is set to ",P.webRTCIPHandlingPolicy),o.debug("[RtcSessionController]: Creating RtcPeerConnections. config: ",n);var r={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googDscp:!0}]};o.debug("[RtcSessionController]: Creating peer connections. constraints:",r);var a,s={extraVideoChannels:ve?0:F,createDesktopPc:!P.disableDesktopPc&&!H&&(!ve||Te.desktop)};o.debug("[RtcSessionController]: Creating peer connections. options:",s);try{t||(Ae=[]),(a=d.unifiedPlanEnabled?new e.RtcPeerConnectionsUnified(n,s):new e.RtcPeerConnections(n,r,s)).connectionBypassed=i,o.debug("[RtcSessionController]: Created audio/video peer connections. Connection bypassed: ",i)}catch(e){return o.error("[RtcSessionController]: Failed to create peer connections.",e),!1}return t?W=a:(K=[x=a,Y],j=qe([x]),Ye(x,j)),!0}function Ye(e,t){e&&(e.onicecandidate=function(e,t){if(!e||!K.includes(e))return void Et("Received icecandidate event for old PC");var i,a=ct(e,"sdpStatus");if(t.candidate){var s=new r(t.candidate.candidate);if("udp"!==s.transport)return void Ct("Ignore non UDP candidate");if(e===x&&"relay"===s.typ&&(e.hasRelayCandidates=!0),Ct("New ICE candidate: ",t.candidate),pt(e)){if(i=e.localDescription,!pt(e,i.type))return;var c={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};(function(e,t){var i=at(e=e||x);if(!i)return!1;if(P.allowAllIceCandidatesScreenShare||t.sdpMid!==x.getScreenShareMediaId()||i.hasRelayRtpCandidate||i.sendAllCandidates)return!0;var a=new r(t.candidate);if(a.isTcpTlsRelay())return a.isRtp()&&(o.info("[RtcSessionController]: Found local relay candidate for TURN over TCP/TLS. Remove queued candidates."),i.hasRelayRtpCandidate=!0,delete i.queuedCandidates,i.relayRtpCandidateTimeout&&(n.clearTimeout(i.relayRtpCandidateTimeout),delete i.relayRtpCandidateTimeout)),!0;"udp"===a.transport&&(i.queuedCandidates||(i.queuedCandidates=[],o.debug("[RtcSessionController]: Start timer to wait for relay candidate for TURN over TCP/TLS."),i.relayRtpCandidateTimeout=n.setTimeout(function(){o.info("[RtcSessionController]: Timer expired. Stop waiting for relay candidate for TURN over TCP/TLS and send all pending candidates."),delete i.relayRtpCandidateTimeout,i.queuedCandidates&&(Je(i.queuedCandidates,e),delete i.queuedCandidates),i.sendAllCandidates=!0},R)),i.queuedCandidates.push(t),o.debug("[RtcSessionController]: Queue candidate in case there is no TURN over TCP/TLS relay candidate"));return!1})(e,c)&&(a!==u.None&&a!==u.OfferPending&&a!==u.AnswerPending?function(e,t){var i=at(t);if(!i)return;i.pendingCandidates||(i.pendingCandidates=[],o.debug("[RtcSessionController]: Start timer to collect candidates before send."),i.collectCandidatesTimeout=n.setTimeout(function(){o.debug("[RtcSessionController]: Timer expired. Send all pending candidates."),delete i.collectCandidatesTimeout,i.pendingCandidates&&(Je(i.pendingCandidates,t),delete i.pendingCandidates)},E));i.pendingCandidates.push(e)}(c,e):Ct("Ignore ICE candidate in state ",a))}}else if(Ct("End of candidates. PC: ",je(e)),e.endOfCandidates=!0,e!==Y&&ft()){if(!(i=e.localDescription))return void Tt("End of candidates, but cannot access pc.localDescription");pt(e,i.type)&&a!==u.None&&a!==u.OfferPending&&a!==u.AnswerPending?function(e){var t=at(e);if(!t)return;var n=[];t.pendingCandidates&&(o.info("[RtcSessionController]: Send all pending candidates."),n=t.pendingCandidates);t.queuedCandidates&&(o.info("[RtcSessionController]: There was no relay candidate for TURN over TCP/TLS. Send all queued candidates."),Array.prototype.push.apply(n,t.queuedCandidates));n.push({candidate:"a=end-of-candidates\r\n"}),ut(e),Je(n,e)}(e):Ze(e,i)}ct(e,"candidatesTimer")&&pt(e)&&(a===u.OfferPending||a===u.AnswerPending)&&(i=e.localDescription,Ze(e,i))}.bind(null,e),e.oniceconnectionstatechange=Qe.bind(null,e),e.onaddstream=function(e,t){if(Ct("Added Remote Stream"),X)return void Ct("Renegotiation is in progress. Ignore AddStream event.");yt([t.stream]),tt()}.bind(null,e),e.onremovestream=function(e,t){Et("Removed Remote Stream"),function(e){if(!e)return;var t=!1,n=V?d.getVideoTrackId(e):d.getVideoStreamTrackId(e);n&&oe.some(function(e,i){return e.streamId===n&&(oe.splice(i,1),t=!0,!0)});var i=V?d.getAudioTrackId(e):d.getAudioStreamTrackId(e);ae&&ae.streamId===i&&(ae=null,t=!0);t&&ot()}(t.stream),tt()}.bind(null,e)),t&&(t.onThresholdExceeded=function(e){Xe(w.onStatsThresholdExceeded,{cleared:e})},t.onNoOutgoingPackets=function(){Xe(w.onStatsNoOutgoingPackets,{})},t.onNetworkQuality=function(e){Xe(w.onNetworkQuality,{quality:e})})}function Ke(e,t){e&&(e.onicecandidate=null,e.oniceconnectionstatechange=null,e.onaddstream=null,e.onremovestream=null),t&&(t.onThresholdExceeded=null,t.onNoOutgoingPackets=null,t.onNetworkQuality=null)}function qe(t){return d.unifiedPlanEnabled&&e.CallStatsHandlerUnified?new e.CallStatsHandlerUnified(t):new e.CallStatsHandler(t)}function je(e){return e===x?"audio/video":"screen control"}function Qe(e){if(e&&K.includes(e)){var t=je(e);switch(Ct("Connection state change ("+t+"): ",e.iceConnectionState),!Q.length||e!==x||e.connectionBypassed||"completed"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||e.hasRelayCandidates||Et("[RtcSessionController]: No relay candidates were collected, please check connectivity to the TURN servers"),ct(e,"sdpStatus")){case u.Connected:switch(e.iceConnectionState){case"connected":case"completed":$e(e,t);break;case"disconnected":e.connectionBypassed||function(e,t){if(e.iceDisconnectTimeout)return;e.iceDisconnectTimeout=n.setTimeout(function(){delete e.iceDisconnectTimeout,"disconnected"===e.iceConnectionState&&(o.debug("[RtcSessionController]: send IceDisconnected event pcType:",t),Xe(w.onIceDisconnected,{pcType:t}))},v)}(e,t);break;case"failed":e.connectionBypassed||(kt(u.Disconnected,e),Tt("[RtcSessionController]: ICE connection has failed"),e!==Y&&Gt("res_CallMediaDisconnected"))}break;case u.AnswerReceived:case u.PrAnswerReceived:case u.AnswerApplied:case u.AnswerSent:switch(e.iceConnectionState){case"connected":case"completed":e.connected=!0,It(e)&&(dt(e),kt(u.Connected,e),$e(e,t));break;case"failed":dt(e),wt(e)}}}else Et("Received iceconnectionstatechange event for old PC")}function ze(e,t){var n;Ct("RTCDTMFSender - ontonechange: tone =",t.tone),n=t.tone,o.debug("[RtcSessionController]: send DTMFToneChanged event"),Xe(w.onDTMFToneChange,{tone:n})}function Xe(e,t){if("function"==typeof e)try{e(t||{})}catch(e){o.error(e)}}function Je(e,t){var n=at(t);if(n&&e){var i=n.sentIceCandidates,a=!1;if((e=e.filter(function(e){if(e.candidate.startsWith("a=end-of-candidates"))return a=!0,!0;var t=e.candidate,n=i.some(function(e){return e.equals(t)});return n?Et("Ignore duplicate ICE candidate: ",e.candidate):i.push(new r(t)),!n})).length>0){o.debug("[RtcSessionController]: Send IceCandidate event");var c={origin:function(e){if(!e)return"";var t=ct(e,"localOrigin");if(!t){var n=e.localDescription;n&&(t=s.getOrigin(n.sdp),st(e,"localOrigin",t))}return t}(t),candidates:e,endOfCandidates:a,isAudioVideo:"audio/video"===je(t)};Xe(w.onIceCandidate,c),Rt(t)}}}function $e(e,t){e.iceDisconnectTimeout&&(n.clearTimeout(e.iceDisconnectTimeout),delete e.iceDisconnectTimeout),o.debug("[RtcSessionController]: send IceConnected event pcType:",t),Xe(w.onIceConnected,{pcType:t})}function Ze(e,t){if(e){lt(e);var n=ct(e,"sdpStatus");"offer"===t.type?n===u.OfferPending&&et(e,u.OfferSent):n===u.AnswerPending&&et(e,u.AnswerSent)}else Et("Cannot send local description for non existing pc.")}function et(e,t){if(e){var i;if(e===Y){var r=Y.localDescription;i={type:r.type,parsedSdp:s.parse(r.sdp)}}else{var a=e.localDescription,l=s.parse(a.sdp);if("answer"===a.type){var u=ct(x,"disabledRemoteOfferMLines");if(!x.desktopPeerConnection&&u.get(M.video)&&(l.m.splice(M.video,0,u.get(M.video)),u.remove(M.video)),Le.edge){var C=u.getAll(),E=Object.keys(C);E.sort(),E.forEach(function(e){l.m.splice(e,0,C[e])}),u.removeAll()}}if(e.desktopPeerConnection){var T=s.findMediaLineIndex(l,e.getScreenShareMediaId());if(T>=0){var p=l.m[T];if(p){p={m:[p]};var S=!H&&!P.allowAllIceCandidatesScreenShare;o.info("[RtcSessionController]: Remove UDP video candidates for screenshare: ",S);var I=pt(x,a.type)&&!x.endOfCandidates;s.validateIceCandidates(p,S,I)}}else o.warn("[RtcSessionController]: Could not find screenshare m-line: no ICE validation was made.")}i={type:a.type,parsedSdp:l}}var f=pt(e,i.type),R=i.parsedSdp;R=s.removeAudioLevelAttr(R),R=s.fixTrickleIceOption(R,f),f?ft()&&(R=s.addEndOfCandidatesLine(R)):R=s.removeEndOfCandidatesLine(R),x.restoreAudioConnectionMode&&s.setConnectionMode(R,"audio",x.restoreAudioConnectionMode);var v=c.isMobile()?"maxBwMobile":"maxBw";(v=P.sdpParameters.receiveVideo[v])&&s.setVideoBandwidth(R,v,!0);var A=be||Ue;if(0!==s.iceTotalCandidatesCount(R)||A)if(s.validateIceCandidates(R,!1,ke)||f&&!ft()||be){if(f&&!ft()){var g=at(e);g&&(g.sentIceCandidates=s.getIceCandidates(R))}var _={type:i.type,sdp:s.stringify(R)};if(e===x&&e.desktopPeerConnection&&(_.screen=x.getScreenShareMediaId(),B[U])){var N=function(e){var t,n=B[e];n&&n.getVideoTracks().length&&(t=d.getVideoStreamTrackId(n));return t}(U),m=null;V&&N&&(m=d.unifiedPlanEnabled?function(e){var t,n=B[e];if(n){var i=n.getVideoTracks()[0];i&&(t=x&&x.getMediaId(i))}return t}(U):s.getMediaIds(R)[N]),_.video=m||N}o.debug("[RtcSessionController]: send SessionDescription event"),be=!1,Xe(w.onSessionDescription,{sdp:_}),kt(t,e)}else o.error("[RtcSessionController]: Failure: SDP contains at least one m line without IceCandidates"),Gt();else if(f){var h=xt();o.debug("[RtcSessionController]: No ICE candidates collected yet. Waiting "+h+" more milliseconds.");var O=n.setTimeout(function(){st(e,"candidatesTimer",null),Gt("res_RestartBrowser")},h);st(e,"candidatesTimer",O)}else Gt("res_RestartBrowser")}else Et("Cannot send Session Description for non existing pc.")}function tt(){o.debug("[RtcSessionController]: send RemoteStreamUpdated event"),Xe(w.onRemoteStreamUpdated,{})}function nt(e){o.debug("[RtcSessionController]: send Error event"),Xe(w.onRtcError,{error:e})}function it(e){"function"==typeof w.onRtcError&&n.setTimeout(function(){nt(e)},0)}function rt(){o.debug("[RtcSessionController]: send MediaUpdate event"),Xe(w.onMediaUpdate,{})}function ot(){o.debug("[RtcSessionController]: send RemoteStreams event"),Xe(w.onRemoteStreams,{audio:ae,video:oe})}function at(e){return e?e===x?q.main:e===Y?q.screenControl:null:null}function st(e,t,n){e&&(e===x?q.main[t]=n:q.screenControl[t]=n)}function ct(e,t){return e?e===x?q.main[t]:q.screenControl[t]:null}function lt(e){var t=ct(e,"candidatesTimer");t&&(n.clearTimeout(t),st(e,"candidatesTimer",null))}function dt(e){var t=ct(e,"connectedTimer");t&&(n.clearTimeout(t),st(e,"connectedTimer",null))}function ut(e){var t=at(e);t&&(t.collectCandidatesTimeout&&(n.clearTimeout(t.collectCandidatesTimeout),delete t.collectCandidatesTimeout),t.relayRtpCandidateTimeout&&(n.clearTimeout(t.relayRtpCandidateTimeout),delete t.relayRtpCandidateTimeout),t.sentIceCandidates=[],t.pendingCandidates&&delete t.pendingCandidates,t.queuedCandidates&&delete t.queuedCandidates,t.hasRelayRtpCandidate=!1,t.sendAllCandidates=!1)}function Ct(e,t){o.debug("[RtcSessionController]["+G+"]: "+e,t)}function Et(e,t){o.warn("[RtcSessionController]["+G+"]: "+e,t)}function Tt(e,t){o.error("[RtcSessionController]["+G+"]: "+e,t)}function pt(e,t){return!!e&&(t?"offer"===t&&ct(e,"trickleIceForOffer")||"answer"===t&&ct(e,"trickleIceForAnswer"):ct(e,"trickleIceForOffer")||ct(e,"trickleIceForAnswer"))}function St(e,t){var n=t&&s.isTrickleIceOption(t);return n&&o.debug("[RtcSessionController]: SDP "+e+" indicates support for Trickle-ICE."),!!n}function It(e){return e&&e===Y?Y.connected:!x||x.connected}function ft(){return(!x||x.endOfCandidates)&&(!Y||Y.endOfCandidates)}function Rt(e){if(e=e||x)if(dt(e),It(e))kt(u.Connected,e);else{var t=Re?N:_;o.debug("[RtcSessionController]: Starting ICE CONNECTED timer");var i=n.setTimeout(function(){st(e,"connectedTimer",null);var t=ct(e,"sdpStatus");t!==u.AnswerSent&&t!==u.AnswerReceived&&t!==u.AnswerApplied||It(e)||(Re?kt(u.Connected,e):(o.warn("[RtcSessionController]: Timed out waiting for connected state."),wt(e)))},t);st(e,"connectedTimer",i)}else Et("Terminating waitConnectedState for non existing pc.")}function vt(){W&&(o.debug("[RtcSessionController]: Closing the pre-allocated peer connection"),st(x,"nextPcLocalSdpSetAt",0),At(W),W=null)}function At(e,t){e&&(e.iceDisconnectTimeout&&(n.clearTimeout(e.iceDisconnectTimeout),delete e.iceDisconnectTimeout),Ke(e,t),d.closePc(e))}function gt(e){if(!e)return!1;if(!e.getLocalStreams().isEmpty())return!0;o.debug("[RtcSessionController]: Add local streams to "+(e===x?"existing":"next")+" peer connection");try{B[U]&&e.addStream(B[U],qt()),o.debug("[RtcSessionController]: Added local audio/video stream"),B[L]&&(B[L].isScreen=!0,e.addStream(B[L],qt()),o.debug("[RtcSessionController]: Added local screenshare stream"))}catch(e){return o.error("[RtcSessionController]: Failed to add Local Streams ",e),!1}return!0}function _t(){o.debug("[RtcSessionController]: Remove local streams from existing PeerConnections");try{[x].forEach(function(e){e&&e.getLocalStreams().forEach(function(t,n){t&&(e.removeStream(t),o.debug("[RtcSessionController]: Removed PeerConnection Stream  #",n))})})}catch(e){return o.error("[RtcSessionController]: Failed to remove Local Streams ",e),!1}return!0}function Nt(e){e&&(e.oninactive=null,d.stopMediaStream(e))}function mt(e){var t=e===ee?B:ee;e&&e.forEach(function(e){t&&-1!==t.indexOf(e)||Nt(e)})}function ht(e){var t=[null,null];e&&e.forEach(function(e,n){e&&e.getVideoTracks().length>0&&(t[n]=e)}),ie===t[0]&&re===t[1]||(ie=t[0],o.debug("[RtcSessionController]: Set local video stream to ",d.getStreamId(ie)||"<null>"),re=t[1],o.debug("[RtcSessionController]: Set local desktop stream to ",d.getStreamId(re)||"<null>"),o.debug("[RtcSessionController]: send LocalVideoStream event"),Xe(w.onLocalVideoStream,{stream:re||ie,videoStream:ie,desktopStream:re}),rt())}function Ot(e,t){t===U||t===L?B[t]!==e&&(B[t]&&Nt(B[t]),B[t]=e,ht(B)):o.error("[RtcSessionController]: setLocalStream invoked with invalid index:",t)}function Dt(e){return!!e&&(d.unifiedPlanEnabled?function(e){var t=!1;return e.getVideoTracks().length?oe.some(function(n){return n.streamId===e.mid&&(o.debug("[RtcSessionController]: Updated remote video streamId="+e.mid),n.stream=e,t=!0,!0)})||(o.debug("[RtcSessionController]: New remote video streamId="+e.mid),oe.push({streamId:e.mid,stream:e}),t=!0):e.getAudioTracks().length&&((ae&&ae.streamId)===e.mid?ae.stream!==e&&(ae.stream=e,t=!0):(ae={streamId:e.mid,stream:e},t=!0)),t}(e):function(e){var t=!1;if(e.getVideoTracks().length>0){var n=V?d.getVideoTrackId(e):d.getVideoStreamTrackId(e);o.debug("[RtcSessionController]: Remote video trackId="+n),oe.some(function(i){return i.streamId===n&&(i.stream!==e&&(i.stream=e,t=!0),!0)})||(oe.push({streamId:n,stream:e}),t=!0),t&&o.debug("[RtcSessionController]: Updated Remote Video streams:",oe)}if(e.getAudioTracks().length>0){var i=V?d.getAudioTrackId(e):d.getAudioStreamTrackId(e);o.debug("[RtcSessionController]: Remote audio trackId="+i),ae&&ae.streamId===i?ae.stream!==e&&(ae.stream=e,t=!0):(ae={streamId:i,stream:e},t=!0),t&&o.debug("[RtcSessionController]: Updated Remote Audio stream:",ae.streamId)}return t}(e))}function yt(e,t){if(e){e instanceof Array||(e=[e]);var n=!1;t&&(ae||oe.length)&&(n=!0,ae=null,oe=[]),e.forEach(function(e){Ae.push(e),Dt(e)&&(n=!0)}),n&&ot()}}function Pt(e){var t=!1;return B[U]&&(t=d.toggleAudio(B[U],e)),Ee=!t||!e,ee&&ee[U]&&d.toggleAudio(ee[U],e),t}function bt(e,t){if(X){var i=q.main.sdpStatus;o.debug("[RtcSessionController]: There's a renegotiation in progress, fail or succeed it based on current SdpStatus:",i),i===u.AnswerReceived||i===u.AnswerApplied||i===u.AnswerSent?Lt():Mt("Renegotiation already in progress")}x&&x.iceDisconnectTimeout&&(o.info("[RtcSessionController]: Ignore previous ICE disconnection"),n.clearTimeout(x.iceDisconnectTimeout),delete x.iceDisconnectTimeout),X=!0,J=!!e,Z=t||null,ne=j,ut(te=x),Ke(te,ne),W?e&&x.localDescription?(o.debug("[RtcSessionController]: Using pre-allocated peer connection"),Ae=[],x=W,W=null,K=[x,Y],j=qe([x]),Ye(x,j)):(vt(),x=null):x=null,ee=B,B=[null,null],pe=c.shallowCopy(Te),ce=c.shallowCopy(se),Oe=null,De=null,q.main.sdpStatus=u.None,q.main.localOrigin=null}function Ut(e){if(Z){try{Z(e&&e!==i.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?"res_ChangeMediaFailed":e)}catch(e){o.error(e)}Z=null}}function Lt(){o.info("[RtcSessionController]: The media renegotiation was successful");var e=ne;ne=null;var t=te;te=null,ln(e,!0,!t.connectionBypassed).catch(function(){o.warn("[RtcSessionController]: Failed to stop stats for old RTCPeerConnection")}).then(function(){o.info("[RtcSessionController]: Closing the old RTCPeerConnection"),At(t,e)}),o.info("[RtcSessionController]: Stopping the old MediaStream"),ue?de=!0:Ce&&(de=!1),d.unifiedPlanEnabled||de||le||gt(x),mt(ee),ee=null,pe=null,ce=null,ht(B),yt(x.getRemoteStreams(),!0),Pt(!Ee),ue=!1,Ce=!1,X=!1,we=!1,Se=null,rt(),Ut()}function Mt(e){o.info("[RtcSessionController]: The media renegotiation has failed: ",e),ut(x),At(x,j),q.main.sdpStatus=u.Connected,x=te,j=ne,Ye(te),te=null,ne=null,mt(B),B=ee,ee=null,ht(B),Te=c.shallowCopy(pe),se=c.shallowCopy(ce),pe=null,ce=null,ue?de=!1:Ce&&(de=!0),ue=!1,Ce=!1,X=!1,we&&(H=!0,we=!1),rt(),Ut(e)}function wt(e){Gt(e&&e===Y?"res_RemoteControlSessionStopped":"res_CallMediaFailed")}function Gt(e,t){e===i.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?o.info("[RtcSessionController]: User cancelled the screen share request"):"res_RestartBrowser"===e?o.error("[RtcSessionController]: Failure: No ICE candidates collected. Browser needs to be restarted"):(e=e||"res_RTCError",o.warn("[RtcSessionController]: There was an internal failure. Send error event: ",e)),X?Mt(e):t?t(e):nt(e)}function Ht(){De?(o.info("[RtcSessionController]: Process the pending changeMedia"),Jt(De.mediaType,De.cb,De.options),De=null):Oe&&(o.info("[RtcSessionController]: Process the pending remote description"),w.setRemoteDescription(Oe.sdp,Oe.cb),Oe=null)}function kt(e,t){if(t=t||x){var n=ct(t,"sdpStatus");if(n!==u.PrAnswerReceived||e!==u.Connected){if(n!==e){if(o.debug("[RtcSessionController]: Changed SDP status from "+n+" to "+e),st(t,"sdpStatus",e),t===x)switch(e){case u.AnswerApplied:Ht();break;case u.Connected:X&&Lt(),o.debug("[RtcSessionController]: send SdpConnected event"),Xe(w.onSdpConnected,{}),Ht(),j.start();break;case u.AnswerSent:Rt(t)}Qe(t)}}else o.debug("[RtcSessionController]: Cannot change SDP status to "+e+" without final SDP answer.")}else Et("Could not set SDP status for non existing pc.")}function Vt(e,t){if(!e)return Et("Cannot update local description for non existing pc."),null;o.debug("[RtcSessionController]: updateLocalDescription with mediaConstraints=",Te);var n=!1,i=s.parse(t.sdp);if(ke?o.debug("[RtcSessionController]: Media multiplex enabled!"):s.disableMultiplex(i),k&&(s.removeAudioMediaProtocols(i,["UDP","TLS"]),e.connectionBypassed&&c.isMobile()&&(e.restoreAudioConnectionMode=s.getConnectionMode(i,{mediaType:"audio"}),s.setConnectionMode(i,"audio","inactive")),"offer"===t.type)){var r=i.m[0];r&&"audio"===r.media&&r.a.some(function(e){return"mid"===e.field&&(He=e.value,!0)})}de?d.unifiedPlanEnabled||(s.setConnectionMode(i,"both","inactive"),o.info("[RtcSessionController]: updateLocalDescription with Connection Mode Inactive")):Te.video||Te.desktop?n=s.hasVideo(i):"answer"===t.type&&(n=s.hasVideo(i))&&ve&&(s.removeVideo(i),n=!1),n&&(Te.video&&s.setXGoogle(i,Ft(Te.hdVideo?"hdVideo":"video",Te.videoResolution)),Te.desktop&&s.setXGoogle(i,Ft(Te.hdDesktop?"hdScreenShare":"screenShare"),i.m.length-1)),s.setOpusParameters(i,P.sdpParameters.audio),P.sdpParameters.preferredVideoCodec!==A&&"offer"===t.type&&s.setPreferredVideoCodec(i,P.sdpParameters.preferredVideoCodec),"answer"!==t.type&&(se={audio:!0,video:n});var a=new d.SessionDescription({type:t.type,sdp:s.stringify(i)});return o.debug("[RtcSessionController]: Modified local SDP: ",a),a}function Ft(e,t){var n=c.shallowCopy(P.xGoogle[e]);if(n&&"hdVideo"===e&&t){var i=P.xGoogle.hdVideo[t];i&&Object.assign(n,i)}return n}function Bt(e,t,n,i){if(!e)return Et("Cannot update remote description for non existing pc."),null;if(o.debug("[RtcSessionController]: updateRemoteDescription with mediaConstraints=",Te),"offer"===n&&e===x){var r=ct(e,"disabledRemoteOfferMLines");if(r.removeAll(),H&&!e.desktopPeerConnection&&i){var a=t.m[M.video];a.port=0,s.setConnectionMode({m:[a]},"video","inactive"),r.add(M.video,a),t.m[M.video]=i.sdp,o.debug("[RtcSessionController]: Disabled and replaced video m-line with screenshare m-line")}if(Le.edge)for(var c=t.m.length-1;c>=0;c--){var l=t.m[c];0!==l.port||l.a.some(function(e){return"bundle-only"===e.field})||(r.add(c,t.m[c]),t.m.splice(c,1))}}var d=!1,C=s.hasVideo(t);if(C){var E,T,p=s.getVideoConnectionModes(t);if(o.info("[RtcSessionController]: Remote description has video modes set to ",p),C=!(d=p.every(function(e){return"recvonly"===e})),Te.desktop&&!e.desktopPeerConnection)T=Te.hdDesktop?"hdScreenShare":"screenShare";else if(Te.hdVideo){if(Te.videoResolution){var S=P.sdpParameters.hdVideo[Te.videoResolution];E=S&&S.maxBw}T="hdVideo"}else T="video";E||(E=P.sdpParameters[T].maxBw),t=s.setVideoBandwidth(t,E,!0);var I=Ft(T,Te.videoResolution);if(s.setXGoogle(t,I),x.desktopPeerConnection){var f=Te.hdDesktop?"hdScreenShare":"screenShare";E=P.sdpParameters[f].maxBw,I=P.xGoogle[f];var R=i&&i.index;t=s.setVideoBandwidth(t,E,!0,R),s.setXGoogle(t,I,R)}}if(s.setOpusParameters(t,P.sdpParameters.audio),le!==(le=!!s.isHold(t)&&("offer"===n||!de&&Te.audio))&&(le?o.info("[RtcSessionController]: The client has been held"):o.info("[RtcSessionController]: The client has been retrieved")),k){var v=t.m[0];if(v&&"audio"===v.media)v.a.some(function(e){return"mid"===e.field})||(He=He||"audio",o.debug("[RtcSessionController]: Adding a=mid:"+He+" to SBC's answer SDP"),v.a.push({field:"mid",value:He}),He="")}var A=ct(e,"sdpStatus");return"offer"!==n||A!==u.Connected||de||le||(oe.length&&!C?(o.debug("[RtcSessionController]: send RemoteVideoRemoved event"),Xe(w.onRemoteVideoRemoved,{})):!oe.length&&C&&(o.debug("[RtcSessionController]: send RemoteVideoAdded event"),Xe(w.onRemoteVideoAdded,{}))),de||"answer"===n&&d||(se={audio:!0,video:C}),ke=H&&"offer"===n&&s.isMultiplexEnabled(t),t}function xt(){var e=P.candidatesTimeout||C;return F>0&&(e+=e*(d.iceTimeoutSafetyFactor||0)),o.debug("[RtcSessionController]: getCandidatesTimeout:",e),e}function Wt(e,t){if(e){var i,r,a,s,c=je(e);if(o.debug("[RtcSessionController]: Local SDP set for the "+c+" connection."),"offer"===t?(r=ct(e,"trickleIceForOffer"),a=u.OfferPending,s=u.OfferSent):(r=ct(e,"trickleIceForAnswer"),a=u.AnswerPending,s=u.AnswerSent),kt(a,e),r)(i=function(){var e=P.trickleIceTimeout||E;return o.debug("[RtcSessionController]: getTrickleIceTimeout:",e),e}())>0?(o.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending the "+c+" SDP Offer ("+i+"ms)."),n.setTimeout(function(){ct(e,"sdpStatus")===a&&(o.debug("[RtcSessionController]: Trickle ICE timer expired. Send the "+c+" SDP Offer."),et(e,s))},i)):(o.debug("[RtcSessionController]: Trickle ICE is enabled. Send the "+c+" SDP Offer."),et(e,s));else{i=xt();var l=ct(x,"nextPcLocalSdpSetAt");if(l){var d=Date.now()-l;d<i?i-=d:i=0,st(x,"nextPcLocalSdpSetAt",0)}o.debug("[RtcSessionController]: Waiting for "+c+" ICE candidates ("+i+"ms).");var C=n.setTimeout(function(){o.debug("[RtcSessionController]: Timed out waiting for "+c+" candidates."),st(e,"candidatesTimer",null),K.includes(e)?ct(e,"sdpStatus")===a&&(o.debug("[RtcSessionController]: Send the "+c+" session description."),et(e,s)):o.warn("[RtcSessionController]: RTCPeerConnection instance for "+c+" connection no longer exists.")},i);st(e,"candidatesTimer",C)}}else Et("Terminating localSdpSetAndSend for non existing pc.")}function Yt(e,t){o.debug("[RtcSessionController]: Successfully created local audio/video description:",e),t&&o.debug("[RtcSessionController]: Successfully created local screenshare description:",t),!d.unifiedPlanEnabled&&X&&_t(),lt(x);var n=function(n,i){if(i?(o.error("[RtcSessionController]: Failed to apply Local "+n+" description:",i.message||i),Gt()):o.debug("[RtcSessionController]: Local description was successfully applied. PC=",n),x&&be)return et(x,u.Connected),void(x&&(x.connectionBypassed=!0,Ke(x,j)));X||rt();var r=e&&e.type||t&&t.type;Wt(x,r)};try{if(x&&e){var i=n.bind(null,"audio/video");e=Vt(x,e),x.setLocalDescription(e,i,i),x.startTime=Date.now()}}catch(e){n("unknown",e||"error")}}function Kt(){ue||de&&!Ce?(x.oniceconnectionstatechange=null,o.debug("[RtcSessionController]: Call is already held or is being put on hold. Stop monitoring iceConnectionState changes"),kt(u.Connected,x)):ct(x,"sdpStatus")===u.AnswerReceived&&kt(u.AnswerApplied,x)}function qt(){return!ve&&!k}function jt(e,t,n){if(e)switch(t){case"offer":var i=!P.disableTrickleIce&&St(t,n);st(e,"trickleIceForAnswer",i),i?o.info("[RtcSessionController]: Enabled Trickle-ICE for answer."):o.info("[RtcSessionController]: Disabled Trickle-ICE for answer.");break;case"pranswer":case"answer":kt("pranswer"===t?u.PrAnswerReceived:u.AnswerReceived,e),ct(e,"trickleIceForOffer")&&(St(t,n)||(st(e,"trickleIceForOffer",!1),o.warn("[RtcSessionController]: Disabled Trickle-ICE for offer.")))}else Et("Terminating updateTrickleIceAndStatus for non existing pc.")}function Qt(e){o.debug("[RtcSessionController]: setRemoteDescription()");try{if(!We())return void Gt();var t,n,i=x.getLocalStreams(),r=s.parse(e.sdp);if(e.screen){var a=s.findMediaLineIndex(r,e.screen);-1!==a&&(t={sdp:r.m[a],index:a,mid:e.screen},n=s.getSsrcList(t.sdp))}jt(x,e.type,r);if(x){r=Bt(x,r,e.type,t);var c=new d.SessionDescription({type:e.type,sdp:s.stringify(r)});c.screen=t&&t.sdp,o.debug("[RtcSessionController]: Modified remote audio/video SDP:",c);var l=function(t,n){switch(n?(o.error("[RtcSessionController]: Failed to apply Remote "+t+" description:",n.message||n),Gt()):o.debug("[RtcSessionController]: Remote description was successfully applied. PC=",t),o.debug("[RtcSessionController]: Remote Descriptions were successfully applied."),X||rt(),e.type){case"offer":de||le?i.length>0?(_t(),o.debug("[RtcSessionController]: Removed Local Stream (hold)")):o.debug("[RtcSessionController]: Local Stream has not been set (hold)"):gt(x),o.debug("[RtcSessionController]: Creating Local Description Answer...");var r={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:qt()}};x.createAnswer(function(e){Yt(e)},function(e){e=e||"Unspecified",o.error("[RtcSessionController]: Failed to create Local Description: ",e.message||e),Gt()},r,{audioInactive:de});break;case"pranswer":o.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),Kt(),Rt(x);break;case"answer":Kt(),Rt(x);break;default:o.error("[RtcSessionController]: Invalid SDP Type = ",e.type),Gt()}}.bind(null,"audio/video");x.setRemoteDescription(c,l,l),x.desktopRemoteSsrc=n,x.remoteOrigin=s.getOrigin(r).trim(),x.startTime=Date.now()}}catch(e){o.error(e),Gt()}}function zt(){st(x,"nextPcLocalSdpSetAt",0),At(x),x=null}function Xt(){if(o.debug("[RtcSessionController]: renegotiateMedia()"),We()){de?o.debug("[RtcSessionController]: Local Stream has not been set (holding)"):gt(x),o.debug("[RtcSessionController]: Creating Local Descriptions...");var e={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:qt()}};try{ke=Le.edge&&H;var t=x.localDescription;if(t)if(de){if(d.unifiedPlanEnabled)return zt(),void Xt();t=Vt(x,t),x.setLocalDescription(t,function(){st(x,"nextPcLocalSdpSetAt",Date.now()),o.debug("[RtcSessionController]:[Pre-allocated PC]: Call on hold. Local description was successfully re-applied"),Wt(x,t.type)},function(e){o.warn("[RtcSessionController]:[Pre-allocated PC]: Call on hold. Error re-setting local description. Creating new peer connection: ",e),zt(),Xt()})}else Wt(x,t.type);else x.createOffer(function(e){Yt(e)},function(e){e=e||"Unspecified",o.error("[RtcSessionController]: Failed to create audio/video Local Description: ",e.message||e),Gt()},e,{audioInactive:de})}catch(e){o.error(e),Gt()}}else Gt()}function Jt(e,t,n){if(x&&ct(x,"sdpStatus")===u.AnswerReceived)return o.warn("[RtcSessionController]: Still processing the previous answer remote description. Queue the changeMedia"),void(De={mediaType:e,cb:t,options:n});if(nn()){$=!!(n=n||{}).changeDesktopMedia,n.isDirectUpgradingToConf&&(H=!1,we=!0);var i,r,a=c.shallowCopy(Te);"boolean"==typeof e.audio&&(a.audio=e.audio),"boolean"==typeof e.video&&(a.video=e.video),"boolean"==typeof e.hdVideo&&(a.hdVideo=e.hdVideo),e.videoResolution&&(a.videoResolution=e.videoResolution),"boolean"==typeof e.desktop&&(a.desktop=e.desktop),"boolean"==typeof e.hdDesktop&&(a.hdDesktop=e.hdDesktop),"boolean"==typeof e.screenControl&&(a.screenControl=e.screenControl),a=D(a),!W||!Ge&&(r=a,(i=Te)&&r&&Object.keys(i).every(function(e){return i[e]===r[e]}))||(o.info("[RtcSessionController]: Media constraints are changing. Discard pre-allocated connection."),vt()),bt(!0,t),Te=a,x?(B=ee,Xt()):Be(Xt,Gt,n.screenShareOptions)}else rn(t,"Connection not stable")}function $t(){te&&(o.debug("[RtcSessionController]: Closing the old audio/video RTCPeerConnection"),At(te,ne),te=null),x&&(o.debug("[RtcSessionController]: Closing the RTCPeerConnection"),At(x,j),x=null),Y&&(o.debug("[RtcSessionController]: Closing the screen control peer connection"),At(Y),Y=null),vt()}function Zt(){o.debug("[RtcSessionController]: Closing the RTC session controller"),se={audio:!1,video:!1},Pe&&a.unregEvtHandlers(Pe),K.forEach(function(e){kt(u.None,e),lt(e),dt(e),ut(e)});var e,t=ne||j;if(t){var n=te||x;ln(t,!1,!!n&&!n.connectionBypassed).catch(function(){o.warn("[RtcSessionController]: Failed to stop stats collection")}).then(function(){o.info("[RtcSessionController]: Closing all RTCPeerConnection instances"),$t()})}else $t();ee&&(o.debug("[RtcSessionController]: Stopping the old MediaStream"),mt(ee),ee=null),q.main.localOrigin=null,q.screenControl.localOrigin=null,X=!1,ue=!1,Ce=!1,de=!1,le=!1,Ee=!1,Se=null,ge=!1,_e=!1,Ot(null,U),Ot(null,L),(ae||oe.length)&&(ae=null,oe=[],ot()),o.debug("[RtcSessionController]: send Closed event"),Xe(w.onClosed,{}),ye=!0,e=(e=["onQosAvailable"])||[],dn.forEach(function(t){e.includes(t)||(w[t]=null)})}function en(){if(!x)return o.error("[RtcSessionController]: PeerConnection not setup"),!1;if(Se)return o.debug("[RtcSessionController]: DTMF Sender already enabled"),!0;var e=x.getLocalStreams();if(!(e.length>0))return o.error("[RtcSessionController]: No Local Stream to create DTMF Sender"),!1;var t=e[U].getAudioTracks();return t.length>0?!!(Se=x.createDTMFSender(t[0]))&&(Se.ontonechange=ze.bind(null,x),o.info("[RtcSessionController]: Created DTMF Sender using remote audio track: "+t[0].label),!0):(o.error("[RtcSessionController]: No Audio Track to create DTMF Sender"),!1)}function tn(e){if(o.debug("[RtcSessionController]: startConn()"),e)Qt(e);else{gt(x),o.debug("[RtcSessionController]: Creating Local Description...");var t={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:qt()}};ke=Le.edge&&H,x.createOffer(function(e){Yt(e)},function(e){e=e||"Unspecified",o.error("[RtcSessionController]: Failed to create Local Description: ",e.message||e),Gt()},t,{audioInactive:de})}}function nn(e){if(!(e=e||x))return o.debug("[RtcSessionController]: isConnStable: There is no connection"),!1;var t=ct(e,"sdpStatus");return t===u.AnswerReceived||t===u.AnswerApplied?(o.debug("[RtcSessionController]: isConnStable: Processing remote answer SDP, the connection is considered stable"),!0):t===u.AnswerSent?(o.debug("[RtcSessionController]: isConnStable: Answer SDP sent, the connection is considered stable"),!0):X?(o.warn("[RtcSessionController]: isConnStable: There is a pending media renegotiation"),!1):!("stable"!==e.signalingState&&!e.connectionBypassed&&(o.warn("[RtcSessionController]: isConnStable: The connection is not established. signalingState =",e.signalingState),!Re))}function rn(e,t){"function"==typeof e&&n.setTimeout(function(){e(t)},0)}function on(e){return c.isMobile()?(o.debug("[RtcSessionController]: Number of extra video channels for mobile clients is 0 (zero)"),!1):Ne&&me?(o.debug("[RtcSessionController]: Number of extra video channels for guests in large conference is 0"),F=0,!1):F!==e&&(o.info("[RtcSessionController]: Set number of extra video channels to ",e),F=e,!0)}function an(){Y&&(o.debug("[RtcSessionController]: Closing the old screen control peer connection"),At(Y),Y=null,q.screenControl.localOrigin=null);var e={};Q.length&&(e.iceServers=[{urls:Q,credential:z.password,username:z.username}]),o.debug("[RtcSessionController]: Creating RtcPeerConnection for the screen control session. config: ",e);var t={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googDscp:!0}]};o.debug("[RtcSessionController]: Creating peer connection for the screen control session. constraints:",t);var n={offerToReceiveAudio:0,offerToReceiveVideo:0,isScreenControlled:ge,isScreenOwner:_e,screenControlChannelName:"SCREEN_CONTROL"};o.debug("[RtcSessionController]: Creating peer connection for the screen control session. options:",n);try{Y=new d.PeerConnection(e,t,n),K=[x,Y],q.screenControl.sdpStatus=u.None,o.debug("[RtcSessionController]: Created a peer connection for the screen control session.")}catch(e){return Y=null,o.error("[RtcSessionController]: Failed to create a peer connection for the screen control session.",e),!1}return Ye(Y),!0}function sn(e,t){o.debug("[RtcSessionController]: Successfully created local screen control description:",e);try{if(Y&&e){var n=function(t,n){if(n)o.error("[RtcSessionController]: Failed to apply Local "+t+" description:",n.message||n);else{o.debug("[RtcSessionController]: Local description for the screen control session was successfully applied. PC=",t);var i=e&&e.type;Wt(Y,i)}}.bind(null,"screen control");Y.setLocalDescription(e,n,n),Y.startTime=Date.now()}}catch(e){t&&t(e)}}function cn(e,t){var n=s.parse(e.sdp);jt(Y,e.type,n);if(Y){var i=function(n,i){switch(i?o.error("[RtcSessionController]: Failed to apply Remote "+n+" description:",i.message||i):o.debug("[RtcSessionController]: Remote description was successfully applied. PC=",n),e.type){case"offer":o.debug("[RtcSessionController]: Creating Local Description Answer..."),Y.createAnswer(function(e){sn(e,t)},function(e){e=e||"Unspecified",o.error("[RtcSessionController]: Failed to create a Local Description for the screen control peer connection: ",e.message||e)},{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},{audioInactive:de});break;case"pranswer":o.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),q.screenControl.sdpStatus===u.AnswerReceived&&kt(u.AnswerApplied,Y),Rt(Y);break;case"answer":o.debug("[RtcSessionController]: Received answer, applying media SDP"),q.screenControl.sdpStatus===u.AnswerReceived&&kt(u.AnswerApplied,Y),Rt(Y);break;default:o.error("[RtcSessionController]: Invalid SDP Type = ",e.type)}}.bind(null,"screen control");Y.setRemoteDescription(e,i,i),Y.remoteOrigin=s.getOrigin(n).trim(),Y.startTime=Date.now()}}function ln(e,n,i){if(e){var r=function(e){var t=te||x,n=ct(t,"sdpStatus");return e||!!t&&(n===u.AnswerReceived||n===u.PrAnswerReceived||n===u.AnswerApplied||n===u.AnswerSent||n===u.Connected||n===u.None)}(n);return e.stop().then(function(t){i&&r&&t&&function(e,t,n){o.debug("[RtcSessionController]: send QosAvailable event"),Xe(w.onQosAvailable,{qos:e,renegotiationInProgress:t,lastSavedStats:n})}(t,n,e.getLastSavedStats()),n||(w.onQosAvailable=null)})}return n||(w.onQosAvailable=null),t.resolve()}var dn=["onIceCandidate","onSessionDescription","onSdpConnected","onIceConnected","onIceDisconnected","onRemoteVideoAdded","onRemoteVideoRemoved","onRemoteStreamUpdated","onDTMFToneChange","onClosed","onRtcError","onRtcWarning","onLocalStreamEnded","onScreenSharePointerStatus","onMediaUpdate","onLocalVideoStream","onRemoteStreams","onGetUserMediaException","onQosAvailable","onStatsNoOutgoingPackets","onStatsThresholdExceeded","onNetworkQuality"];dn.forEach(function(e){w[e]=null}),Object.defineProperty(this,"dontReuseAudioStream",{get:function(){return Ge},set:function(e){o.debug("[RtcSessionController]: Setting dontReuseAudioStream to:",!!e),Ge=!!e},enumerable:!0,configurable:!1}),this.setTurnCredentials=function(e){z=e||{}},this.setTurnUris=function(e){e&&e.length&&(P.customTurnServers.length?(o.debug("[RtcSessionController]: Adding custom TURN servers to this session:",P.customTurnServers),Q=P.customTurnServers.concat(e)):Q=e)},this.getLocalVideoStream=function(){return re||ie},this.getLocalDesktopStream=function(){return re},this.getRemoteAudioStream=function(){return ae},this.getRemoteVideoStreams=function(){return oe},this.getSdpStatus=function(){return q.main.sdpStatus},this.getWarmedUpSdp=function(){return fe},this.isHolding=function(){return de&&!ue||Ce},this.isHoldInProgress=function(){return ue},this.isRetrieveInProgress=function(){return Ce},this.isHeld=function(){return le},this.getActiveMediaType=function(){return c.shallowCopy(se)},this.getMediaConstraints=function(){return c.shallowCopy(Te)},this.getLocalMediaType=function(){return{audio:Te.audio&&se.audio,video:Te.video&&se.video,desktop:Te.desktop&&se.video}},this.hasScreenShare=function(){return!!re},this.isScreenControlled=function(){return!!ge},this.warmup=function(e,t,n,i,r){return n=n||function(){},i=i||function(){},ye?(o.error("[RtcSessionController]: Warmup Connection failed: Session already terminated"),void rn(i,"res_UnexpectedError")):(s.isNoOfferSdp(t)&&(t=null),e=D(e),o.info("[RtcSessionController]: Warming up the connection - mediaType = ",e),d.enabled?x&&q.main.sdpStatus!==u.None?(o.error("[RtcSessionController]: The connection has already been started"),void rn(i,"res_UnexpectedError")):((Te=e).audio||(Ee=!0),void Be(function(){t&&(fe=t),Ie=!0,We(),n()},function(e){Gt(e,i)},r)):(o.warn("[RtcSessionController]: WebRTC not supported by browser"),void rn(i,"res_NoWebRTC")))},this.start=function(e,t){if(ye)return o.error("[RtcSessionController]: Start Connection failed: Session already terminated"),!1;if(e=D(e),o.info("[RtcSessionController]: Start Connection - mediaType =",e),!d.enabled)return o.warn("[RtcSessionController]: WebRTC not supported by browser"),it("res_NoWebRTC"),!1;if(x&&q.main.sdpStatus!==u.None)return o.error("[RtcSessionController]: The connection has already been started"),it("res_UnexpectedError"),!1;if(o.debug("[RtcSessionController]: Creating Peer Connection..."),Ie){if(t=fe,fe=null,Ee=!e.audio,!We())return it("res_RTCError"),!1;if(e.audio===Te.audio&&e.video===Te.video&&e.hdVideo===Te.hdVideo&&e.desktop===Te.desktop)return tn(t),!0;Ot(null,U)}return We()?(Te=e,Be(function(){tn(t)},Gt),!0):(it("res_RTCError"),!1)},this.addIceCandidates=function(e,t){o.info("[RtcSessionController]: Add remote ICE candidates");var n=e?null:x;n?e!==n.remoteOrigin?n=null:(o.warn("[RtcSessionController]: Ignoring remote ICE candidate - origin does not match."),o.debug("[RtcSessionController]: ICE candidate origin: ",e),o.debug("[RtcSessionController]: SDP origin: ",n.remoteOrigin)):K.forEach(function(t){t&&e===t.remoteOrigin&&(n=t)}),n?(t.forEach(function(e){(e=JSON.parse(e)).candidate&&(e.candidate=e.candidate.replace(/(a=)*([^\r]+)(\r\n)*/i,"$2")),o.debug("[RtcSessionController]: Remote ICE candidate",e),e.candidate&&"end-of-candidates"!==e.candidate?n.addIceCandidate(e):o.debug("[RtcSessionController]: Ignoring end-of-remote-candidates indication.")}),Rt(n)):o.warn("[RtcSessionController]: Ignoring remote ICE candidate - no valid peer connection found.")},this.setRemoteDescription=function(e,t){if(o.info("[RtcSessionController]: Set Remote Description - type: ",e.type),fe=null,x&&q.main.sdpStatus===u.AnswerReceived)return o.warn("[RtcSessionController]: Still processing the previous answer remote description. Queue the new one"),void(Oe={sdp:e,cb:t});if(x&&q.main.sdpStatus===u.PrAnswerReceived)return"answer"===e.type&&(kt(u.AnswerReceived,x),Rt(x)),o.info("[RtcSessionController]: SDP already applied. Ignoring any later remote SDPs"),void rn(t);if("offer"===e.type){if(!nn())return void rn(t,"Connection not stable");bt(!1,t),Be(function(){Qt(e)},Gt)}else"sdp"===e.sdp?(kt(u.AnswerReceived,x),X&&Lt(),Rt(x)):Qt(e),rn(t)},this.renegotiateMedia=function(e){o.info("[RtcSessionController]: Start Media Renegotiation from client"),nn()||rn(e,"Connection not stable"),bt(!0,e),Be(Xt,Gt)},this.enableRemoteVideo=function(){ve&&(o.info("[RtcSessionController]: Enable receiving remote video"),ve=!1)},this.disableRemoteVideo=function(){ve||(o.info("[RtcSessionController]: Disable receiving remote video"),ve=!0)},this.addAudio=function(e){o.info("[RtcSessionController]: Add Audio"),Jt({audio:!0},e)},this.removeAudio=function(e){o.info("[RtcSessionController]: Remove Audio"),Jt({audio:!1},e)},this.addVideo=function(e){o.info("[RtcSessionController]: Add Video"),Jt({video:!0},e)},this.removeVideo=function(e){o.info("[RtcSessionController]: Remove Video"),Jt({video:!1},e)},this.addDesktop=function(e){o.info("[RtcSessionController]: Add Desktop (screen sharing)"),Jt({desktop:!0},e)},this.removeDesktop=function(e){o.info("[RtcSessionController]: Remove Desktop (screen sharing)"),Jt({desktop:!1},e)},this.changeMediaType=function(e,t,n){if(o.info("[RtcSessionController]: Change media type: ",e),t&&o.info("[RtcSessionController]: Change media options: ",t),!e)return o.warn("[RtcSessionController]: Invalid media type"),void rn(n,"Invalid media type");Jt(e,n,t)},this.holdCall=function(e){if(o.info("[RtcSessionController]: Hold Call"),nn()){if(de)return o.warn("[RtcSessionController]: The call is already held"),void rn(e);de=!0,ue=!0,bt(!0,e),Be(Xt,Gt)}else rn(e,"Connection not stable")},this.retrieveCall=function(e){if(o.info("[RtcSessionController]: Retrieve Call"),nn()){if(!de)return o.warn("[RtcSessionController]: The call is not held"),void rn(e);de=!1,Ce=!0,bt(!0,e),Be(Xt,Gt)}else rn(e,"Connection not stable")},this.getScreenControlData=function(){return{isScreenControlled:ge,isScreenOwner:_e,hasScreenControlPc:!!Y}},this.updateScreenControlData=function(e,t){ge=!!e,_e=!!t,t&&a.setControllingScreen()},this.offerScreenControl=function(e){if(ge){if(an()){lt(Y);try{Y.createOffer(function(t){sn(t,e)},function(t){t=t||"Unspecified",o.error("[RtcSessionController]: Failed to create the Local Description for the screen control peer connection: ",t.message||t),e&&e(t)},{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})}catch(t){o.error(t),e&&e(t)}}}else o.error("Local variables are out of date. The screen control session cannot be initiated.")},this.establishScreenControl=function(e,t){"offer"===e.type?an()&&cn(e,t):(cn(e,t),rn(t))},this.stopScreenControl=function(e){if(e=e||function(){},ge=!1,_e=!1,Y)try{o.debug("[RtcSessionController]: Closing the screen control peer connection."),q.screenControl.localOrigin=null,At(Y),Y=null,e()}catch(t){o.error(t),e(t)}else o.warn("[RtcSessionController]: There is no active screen control peer connection to close."),e()},this.renegotiationFailed=function(e){X&&(Z||nt("res_RTCError"),Mt(e))},this.mute=function(e){o.info("[RtcSessionController]: Mute Call"),Pt(!1),rn(e)},this.unmute=function(e){var t;o.info("[RtcSessionController]: Unmute Call"),Pt(!0)||(t="res_UnmuteFailedNoMic"),rn(e,t)},this.isMuted=function(){return Ee},this.isLocalMuteAllowed=function(){return Ee||B[U]&&B[U].getAudioTracks().length},this.setCallStatsOptions=function(e){j&&e&&(o.debug("[RtcSessionController]: Setting call stats options: ",e),j.setOptions(e))},this.terminate=function(){o.info("[RtcSessionController]: Terminate the RTC session controller"),Zt()},this.canSendDTMFDigits=function(){return!(Le.edge||!Se&&!en())&&(Se&&Se.canInsertDTMF)},this.sendDTMFDigits=function(e){return o.info("[RtcSessionController]: Send DTMF Digits - digits=",e),!!nn()&&(!(!Se&&!en())&&(Se.canInsertDTMF?(Se.insertDTMF(e,200,50),!0):(o.error("[RtcSessionController]: DTMF Sender cannot insert DTMF digits: "+e),!1)))},this.sendDataMessage=function(e){var t=!1;return Y&&Y.sendDataMessage&&(t=Y.sendDataMessage(e)),t},this.setMockedCall=function(){Re=!0},this.getCurrentPeerConnection=function(){return x.mainPeerConnection},this.setExtraVideoChannelsForParticipants=function(e){var t=0;return e&&e>2&&(t=e-2,t=Math.max(t,P.minVideoExtraChannels||h),t=Math.min(t,P.maxVideoExtraChannels||O)),on(t)},this.setExtraVideoChannels=function(e){return(e=e||0)>0&&(e=Math.max(e,P.minVideoExtraChannels||h),e=Math.min(e,P.maxVideoExtraChannels||O)),on(e)},this.useMaxNumberOfExtraVideoChannels=function(){return on(P.maxVideoExtraChannels||O)},this.getNumberOfExtraVideoChannels=function(){return F},this.hasMaxExtraVideoChannels=function(){return!!c.isMobile()||F===(P.maxVideoExtraChannels||O)},this.isConnStable=function(){return nn()},this.isConnected=function(){return q.main.sdpStatus===u.Connected||X},this.disableIncomingVideo=function(){Ae.forEach(function(e){e.getVideoTracks().length>0&&(e.getVideoTracks()[0].enabled=!1)})},this.enableIncomingVideo=function(){Ae.forEach(function(e){e.getVideoTracks().length>0&&(e.getVideoTracks()[0].enabled=!0)})},this.getLocalStream=function(e){return B[e]},this.setLocalStream=function(e,t){B[e]=t},this.getRemoteStreams=function(){return Ae},this.setIgnoreTurnOnNextPC=function(){o.debug("[RtcSessionController]: setIgnoreTurnOnNextPC..."),he=!0},this.setIgnoreNextConnection=function(){o.debug("[RtcSessionController]: setIgnoreNextConnection..."),be=!0},this.getLastSavedStats=function(){var e=ne||j;return e?e.getLastSavedStats():null},this.prepareForRenegotiation=function(){H&&!pt(x,"offer")&&function(){if(!W)if(o.debug("[RtcSessionController]: Pre-allocate the next peer connection"),We(!0)){var e=W;if(e.onicecandidate=function(e){o.debug("[RtcSessionController]:[Pre-allocated PC]: New ICE candidate: ",e.candidate)},gt(e)){var t={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:qt()}};e.createOffer(function(t){o.debug("[RtcSessionController]:[Pre-allocated PC]: Local description was successfully created"),t=Vt(e,t),e.setLocalDescription(t,function(){st(x,"nextPcLocalSdpSetAt",Date.now()),o.debug("[RtcSessionController]:[Pre-allocated PC]: Local description was successfully applied")},function(e){o.warn("[RtcSessionController]:[Pre-allocated PC]: Error setting local description: ",e),vt()}),o.debug("[RtcSessionController]:[Pre-allocated PC]: Created local offer")},function(e){o.warn("[RtcSessionController]:[Pre-allocated PC]: Error creating local offer: ",e),vt()},t),n.setTimeout(function(){e===W&&vt()},b)}else o.warn("[RtcSessionController]:[Pre-allocated PC]: Local streams could not be added. Closing peer connection."),vt()}else o.warn("[RtcSessionController]:[Pre-allocated PC]: Peer connection could not be created.")}()},o.debug("[RtcSessionController]: Created new RtcSessionController instance")}return P.DEFAULT_CANDIDATES_TIMEOUT=C,P.DEFAULT_TRICKLE_ICE_TIMEOUT=E,P.DEFAULT_ENABLE_AUDIO_AGC=!0,P.DEFAULT_UPSCALE_FACTOR=1.5,P.LOCAL_STREAMS=N,P.candidatesTimeout=C,P.trickleIceTimeout=E,P.enableAudioAGC=!0,P.screenshareUpscaleFactor=1.5,P.cmrScreenshareUpscaleFactor=1.5,P.allowAllIceCandidatesScreenShare=!0,P.disableTrickleIce=!1,P.allowOnlyRelayCandidates=!1,P.mediaNode=null,P.playbackDevices=[],P.recordingDevices=[],P.ringingDevices=[],P.videoDevices=[],P.sdpParameters=JSON.parse(JSON.stringify(g)),P.xGoogle=JSON.parse(JSON.stringify(_)),P.customTurnServers=[],P.minVideoExtraChannels=h,P.maxVideoExtraChannels=O,P.disableDesktopPc="iOS"===n.navigator.platform||"dotnet"===n.navigator.platform,P.webRTCIPHandlingPolicy=null,P.processClientSettings=function(e){try{e=e||{},P.allowAllIceCandidatesScreenShare=void 0===e.allowAllIceCandidatesScreenShare||!!e.allowAllIceCandidatesScreenShare,P.disableTrickleIce=void 0!==e.disableTrickleIce&&!!e.disableTrickleIce,P.screenshareUpscaleFactor=parseFloat(e.screenshareUpscaleFactor,10)||P.DEFAULT_UPSCALE_FACTOR,P.cmrScreenshareUpscaleFactor=parseFloat(e.cmrScreenshareUpscaleFactor,10)||P.DEFAULT_UPSCALE_FACTOR;var t=e.xGoogle||{};Object.keys(_).forEach(function(e){P.xGoogle[e]=void 0!==t[e]?t[e]:JSON.parse(JSON.stringify(_[e]))});var n=e.sdpParameters||{};Object.keys(g).forEach(function(e){P.sdpParameters[e]=void 0!==n[e]?n[e]:JSON.parse(JSON.stringify(g[e]))}),o.info("[RtcSessionController]: Updated RtcSessionController values: ",{allowAllIceCandidatesScreenShare:P.allowAllIceCandidatesScreenShare,disableTrickleIce:P.disableTrickleIce,screenshareUpscaleFactor:P.screenshareUpscaleFactor,cmrScreenshareUpscaleFactor:P.cmrScreenshareUpscaleFactor,xGoogle:P.xGoogle,sdpParameters:P.sdpParameters})}catch(e){o.error("[RtcSessionController]: Error processing client settings. ",e)}},P.overridePromise=function(e){t=e},e.RtcSessionController=P,e.Enums=e.Enums||{},e.Enums.SdpStatus=u,e}((e=function(t){"use strict";var i,r=e.logger,o=t.Utils,a=o.isMobile(),s=Object.freeze({GOOG_JITTER_RECEIVED:{StatName:"jr",StatText:"googJitterReceived",Threshold:50,RecurrenceThreshold:a?2:3,reportIssues:!0},GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:a?2:3,reportIssues:!0},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:a?2:3,reportIssues:!0},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:a?0:3,reportIssues:!0},NO_PACKETS_RECV:{StatName:"",StatText:"noPacketsReceived",Threshold:0,RecurrenceThreshold:a?2:3,reportIssues:!0},ECHO_LIKELIHOOD:{StatName:"ecmax",StatText:"googResidualEchoLikelihoodRecentMax",Threshold:.5,RecurrenceThreshold:a?2:3,reportIssues:!1}}),c=Object.freeze({GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:a?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:a?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:a?0:3}}),l={COLLECTION_INTERVAL:5e3,DELAY_UPON_ANSWER:a?0:5e3,DELAY_RTT_PROCESSING:3},d=Object.freeze({RTP_QUALITY_LOW:{levelName:"low",value:1,threshold:.1},RTP_QUALITY_MEDIUM:{levelName:"medium",value:2,threshold:.03},RTP_QUALITY_HIGH:{levelName:"high",value:3,threshold:0},getLevel:function(e){return e>this.RTP_QUALITY_LOW.threshold?this.RTP_QUALITY_LOW:e>this.RTP_QUALITY_MEDIUM.threshold?this.RTP_QUALITY_MEDIUM:this.RTP_QUALITY_HIGH}}),u=Object.freeze({audioOutputLevel:"aol",bytesReceived:"or",bytesSent:"os",googAvailableSendBandwidth:"abw",googResidualEchoLikelihoodRecentMax:"ecmax",googFrameHeightReceived:"fhr",googFrameHeightSent:"fhs",googFrameWidthReceived:"fwr",googFrameWidthSent:"fws",googFrameRateDecoded:"frd",googFrameRateSent:"frs",googJitterReceived:"jr",googRtt:"rtt",googTransmitBitrate:"tbr",packetsLost:"pl",packetsReceived:"pr",packetsSent:"ps"});void 0!==n.Promise&&(i=n.Promise);var C=o.getBrowserInfo();function E(e){if(!Array.isArray(e))throw new Error("peerConnections must be an array");var a=6,E=20,T=e.filter(function(e){return e});if(!e.length)throw new Error("Cannot create CallStatsHandler object without at least one peer connection");var p,S,I,f,R,v={},A=null,g=null,_=0,N={},m={},h={},O={},D={},y=!1,P=this;function b(e){switch(e){case"local":return"host";case"stun":case"serverreflexive":return"srflx";case"peerreflexive":return"prflx";case"relayed":return"relay";default:return e}}function U(e,n,i){var r;return e.a.some(function(e){if("candidate"===e.field&&e.value){var o=new t.IceCandidate(e.value);if(o.typ===i&&o["network-id"]===n["network-id"])return r=o.address,!0}return!1}),r}function L(e,t,n,i){var r=e.stat("googChannelId"),a={channelId:r,rtt:parseInt(e.stat("googRtt"),10)||-1};i&&(a.candidates={local:e.stat("localCandidateId"),remote:e.stat("remoteCandidateId")},C.firefox?n.remote=e.stat("remoteCandidateId"):function(e,t){var n=o.parseIpWithPort(t.stat("googLocalAddress"))||{},i=o.parseIpWithPort(t.stat("googRemoteAddress"))||{};e.ipl=n.ipAddress,e.ptl=n.port,e.ipr=i.ipAddress,e.ptr=i.port,e.lct=b(t.stat("googLocalCandidateType")),e.rct=b(t.stat("googRemoteCandidateType")),e.tt=t.stat("googTransportType")}(a,e)),t.channelInfo[r]=a}function M(e,n,i,r,o){if(!n||!i)return null;var a,s={startTime:e,pcType:r,audio:{transmit:{},receive:{}},video:{transmit:{},receive:{}},channelInfo:{}},c={audio:{},video:{}},l={},d=n.result?n.result():n;if(!Array.isArray(d))return null;(d.forEach(function(e){if(e){var t=null;switch(e.type){case"ssrc":t=function(e,t,n){var i=null,r=e.stat("ssrc"),o={id:e.id,ssrc:r,content:e.stat("googContentType"),channelId:e.stat("transportId"),trackId:e.stat("googTrackId")};return e.stat("audioInputLevel")?(t.audio.transmit[r]||(t.audio.transmit[r]=o),i=t.audio.transmit[r]):e.stat("audioOutputLevel")?(t.audio.receive[r]||(t.audio.receive[r]=o),i=t.audio.receive[r]):e.stat("googFrameHeightSent")?(t.video.transmit[r]||(t.video.transmit[r]=o),C.firefox&&e.stat("mid")===n.getScreenShareMediaId()&&(o.content="screen"),i=t.video.transmit[r]):e.stat("googFrameHeightReceived")&&(t.video.receive[r]||(t.video.receive[r]=o),n.desktopRemoteSsrc.includes(o.ssrc)&&(o.content="screen"),i=t.video.receive[r]),i}(e,s,i);break;case"VideoBwe":s.videoBwe||(s.videoBwe={id:e.id}),t=s.videoBwe;break;case"localcandidate":case"remotecandidate":l[e.id]=e}if(e.names&&t)(e.names()||[]).forEach(function(n){u[n]&&(t[u[n]]=parseFloat(e.stat(n)))}),t.en=e.stat("googCodecName")}}),d.forEach(function(e){e&&"googCandidatePair"===e.type&&"true"===e.stat("googActiveConnection")&&L(e,s,c,o)}),o)&&Object.keys(s.channelInfo).forEach(function(e){var n=s.channelInfo[e];if(n){var r=l[n.candidates.local];if(r){if(C.firefox)!function(e,t,n){e.ipl=t&&t.stat("ipAddress"),e.ptl=t&&t.stat("portNumber"),e.ipr=n&&n.stat("ipAddress"),e.ptr=n&&n.stat("portNumber"),e.lct=t&&b(t.stat("candidateType")),e.rct=n&&b(n.stat("candidateType")),e.tt=t&&t.stat("transport")}(n,r,l[n.candidates.remote]);n.ni=r.stat("networkType"),a=a||t.sdpParser.parse(i.localDescription&&i.localDescription.sdp),n.candidate=function(e,n){var i,r,o={};if(!e||!n)return o;var a=b(e.stat("candidateType"));return"prflx"===a?r=e.stat("ipAddress"):i=String(e.stat("portNumber")),("string"==typeof n?t.sdpParser.parse(n):n).m.some(function(n){return n.a.some(function(s){if("candidate"!==s.field)return!1;if(s.value){var c;if(i&&s.value.indexOf(i)>=0&&(c=new t.IceCandidate(s.value),String(c.port)===i&&a===c.typ))return o.value=s.value,"host"===a?(o.hAddr=e.stat("ipAddress"),o.sAddr=U(n,c,"srflx"),o.sAddr||(o.sAddr=o.hAddr)):(o.sAddr=c.raddr,o.hAddr=U(n,c,"host"),"relay"===a&&(o.tt=c.getRelayClientTransportType())),!0;if(r&&s.value.indexOf("srflx")>=0&&"srflx"===(c=c||new t.IceCandidate(s.value)).typ&&String(c.address)===r)return o.sAddr=r,o.hAddr=U(n,c,"host"),!0}return!1}),!1}),o}(r,a)}}});return s}function w(e){var t=!R;R=R||t;var n=T.find(function(t){return!!t&&(e||"completed"===t.iceConnectionState||"connected"===t.iceConnectionState?t.mainPeerConnection:(r.warn("[CallStatsHandlerUnified]: Do not collect stats. pc.iceConnectionState = ",t.iceConnectionState),!1))});return n?function(e,t,n,o){return new i(function(i){e.getStats?e.getStats(function(a){a?a=M(n,a,e,t,o):r.warn("[CallStatsHandlerUnified]: getStats["+t+"] did not return a response"),i(a)},function(e){r.warn("[CallStatsHandlerUnified]: getStats["+t+"] failed with err = ",e),i()}):i()})}(n,"AUDIO/VIDEO/SCREEN",n.startTime,t).then(function(e){return e&&["audio","video"].forEach(function(t){e[t]&&["transmit","receive"].forEach(function(n){Object.keys(e[t][n]).forEach(function(i){var r=e[t][n][i];r.channelInfo||(r.channelInfo=m[r.channelId]||e.channelInfo[r.channelId])})})}),e}):i.resolve()}function G(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.ps||0),(e.pl-n)/(e.ps-i||-1)}function H(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.pr||0),(e.pl-n)/(e.pr-i+e.pl-n||-1)}function k(e,t,n){var i=n+"Sum",r=n+"Count",o=n+"Max";t?(void 0!==t[i]?(e[i]=t[i]+(e[n]||0),++t[r],e[r]=t[r]):(e[i]=e[n]||0,e[r]=1),void 0!==t[o]?e[o]=Math.max(t[o],e[n]||0):e[o]=e[n]||0):(e[i]=e[o]=e[n]||0,e[r]=1)}function V(e,t,n,i,o,a){var s;t.reportIssues?s=e[t.StatText]||{}:s={counter:(e[t.StatText]||{}).counter};var c=t.StatText+"LastViStart",l=t.StatText+"Violations",d=t.StatText+"ViCounter";if(o[c]=a&&a[c],o[l]=a&&a[l],o[d]=a&&a[d]||0,-1===n){if(o[c]){var u=o[l];u=u?u+",":"",o[l]=u+"("+o[c]+","+parseInt((Date.now()-i)/1e3,10)+")",o[d]++,delete o[c],a&&delete a[c]}s.reported?s.counter++:s.counter&&(delete e[t.StatText],r.debug("[CallStatsHandlerUnified]: issueCounter cleared=",t.StatText))}else s.reported?(s.counter=0,s.value=n):s.counter?(s.counter++,s.value=n):(e[t.StatText]={statObj:t,counter:1,value:n},o[d]<E&&(o[c]=parseInt((Date.now()-i)/1e3,10)))}function F(e){e&&e.audio&&(function(e){Object.keys(e.audio.transmit).forEach(function(t){var n=N[t]||{},i=h[t]||{},r=e.audio.transmit[t],o=s.PACKET_LOSS_SEND;if(r&&r.pl&&r.ps){var a=G(r,n);V(i,o,a>=o.Threshold?a:-1,e.startTime,r,n)}if(o=s.ECHO_LIKELIHOOD,r){k(r,n,s.ECHO_LIKELIHOOD.StatName);var c=r[o.StatName];V(i,o,c&&c>=o.Threshold?c:-1,e.startTime,r,n)}N[t]=r,h[t]=i})}(e),function(e){Object.keys(e.audio.receive).forEach(function(t){var n,i=N[t]||{},r=h[t]||{},o=e.audio.receive[t],a=s.PACKET_LOSS_RECV;if(o&&o.pl&&o.pr){var c=H(o,i);V(r,a,c>=a.Threshold?c:-1,e.startTime,o,i)}o&&!v.sendOnlyStream&&V(r,s.NO_PACKETS_RECV,!(o.pr>i.pr)||-1,e.startTime,o,i),a=s.GOOG_JITTER_RECEIVED,o&&(k(o,i,s.GOOG_JITTER_RECEIVED.StatName),V(r,a,(n=o[a.StatName])&&n>=a.Threshold?n:-1,e.startTime,o,i)),N[t]=o,h[t]=r})}(e))}function B(e){e&&e.video&&(function(e){Object.keys(e.video.transmit).forEach(function(t){var n,i=N[t]||{},r=O[t]||{},o=e.video.transmit[t],a=c.PACKET_LOSS_SEND;o&&o.pl&&o.ps&&V(r,a,(n=G(o,i))>=a.Threshold?n:-1,e.startTime,o,i),N[t]=o,O[t]=r})}(e),function(e){Object.keys(e.video.receive).forEach(function(t){var n=N[t]||{},i=O[t]||{},r=e.video.receive[t],o=c.PACKET_LOSS_RECV;if(r&&r.pl&&r.pr){var a=H(r,n);V(i,o,a>=o.Threshold?a:-1,e.startTime,r,n)}N[t]=r,O[t]=i})}(e))}function x(e){if(e){var t,n,i,o,d,u,C,E=!1;F(e),B(e),function(e){_>l.DELAY_RTT_PROCESSING&&Object.keys(e.channelInfo).forEach(function(t){var n=m[t],i=e.channelInfo[t];k(i,n,c.GOOG_RTT.StatName);var r=s.GOOG_RTT,o=D[t]||{};V(o,r,i.rtt>=r.Threshold?i.rtt:-1,e.startTime,i,n),D[t]=o})}(e),t=!1,n=Y(h),i=Y(O),o=Y(D),(n||i||o)&&(t=!0,y||(i=i||"none",o=o||"none",y=!0,(n=n||"none").noPacketsReceived?r.warn("[CallStatsHandlerUnified]: processRTPStats - No packets received from remote peer"):(r.warn("[CallStatsHandlerUnified]: processRTPStats - Quality issues detected. ",[{audio:n},{video:i},{channel:o}]),P.onThresholdExceeded&&P.onThresholdExceeded()))),E=t,function(e){Object.keys(e.channelInfo).forEach(function(t){var n=m[t]||{};m[t]=Object.assign(n,e.channelInfo[t])})}(e),!E&&y&&(r.debug("[CallStatsHandlerUnified]: processRTPStats - No quality issues detected. Clear threshold exceeded error."),y=!1,P.onThresholdExceeded&&P.onThresholdExceeded(!0)),(y||_%a==0)&&(d=e,Object.keys(d.channelInfo).forEach(function(e){var t=d.channelInfo[e];u="[CallStatsHandlerUnified]: statsReport: channelRtt="+(t.rtt||"n/a"),Object.keys(d.audio.receive).forEach(function(t){var n=d.audio.receive[t];n.channelId===e&&(u+="\n audioReceive:  id="+n.id+" pl="+n.pl+" pr="+n.pr+" or="+n.or+" jr="+n.jr)}),Object.keys(d.audio.transmit).forEach(function(t){var n=d.audio.transmit[t];n.channelId===e&&(u+="\n audioTransmit: id="+n.id+" pl="+n.pl+" ps="+n.ps+" os="+n.os)}),Object.keys(d.video.receive).forEach(function(t){var n=d.video.receive[t];n.channelId===e&&(u+="\n videoReceive:  id="+n.id+" pl="+n.pl+" pr="+n.pr+" or="+n.or+" fwr="+n.fwr+" fhr="+n.fhr+" frd="+n.frd)}),Object.keys(d.video.transmit).forEach(function(t){var n=d.video.transmit[t];n.channelId===e&&(u+="\n videoTransmit: id="+n.id+" pl="+n.pl+" ps="+n.ps+" os="+n.os+" fws="+n.fws+" fhs="+n.fhs+" frs="+n.frs)}),r.debug(u)}),u="[CallStatsHandlerUnified]: statsReport:\n",[h,O,D].forEach(function(e,t){switch(t>0&&(u+="\n"),e){case h:u+=" Audio issues =";break;case O:u+=" Video issues =";break;case D:u+=" Channel issues =";break;default:u+=" Unknown ="}var n;Object.keys(e).forEach(function(t){var i=Object.keys(e[t]);i.length&&(C=!0,n=!0,i.forEach(function(n){u+=" "+n+"="+e[t][n].value+" count="+e[t][n].counter}))}),n||(u+=" none")}),C&&r.info(u)),_++}}function W(){t.isElectron&&r.debug("[CallStatsHandlerUnified]: Get RTP stats for local call(s)"),w().then(function(e){e?(t.isElectron&&r.debug("[CallStatsHandlerUnified]: Process RTP stats for local call(s)"),x(e),function(e){if(!e)return void r.debug("[CallStatsHandlerUnified]: processNetworkIndication - No stats for network indication.");I||(I={},S=d.RTP_QUALITY_HIGH,p={noPacketsSeq:0,qualityLevelSeq:0},f=!1);var t=0,n=0,i=!0,o=!0;Object.keys(e.audio.transmit).forEach(function(n){var o=e.audio.transmit[n],a=I[n]||{};!o||isNaN(o.pl)||isNaN(o.ps)||(t=G(o,a)||0,a.ps&&(i=o.ps>a.ps),i||r.warn("[CallStatsHandlerUnified]: processNetworkIndication - No packets sent to remote peer"),I[n]=o)}),Object.keys(e.audio.receive).forEach(function(t){var i=e.audio.receive[t],a=I[t]||{};!i||isNaN(i.pl)||isNaN(i.pr)||(n=H(i,a)||0,a.pr&&(o=i.pr>a.pr),o||v.sendOnlyStream||r.warn("[CallStatsHandlerUnified]: processNetworkIndication - No packets received from remote peer"),I[t]=i)});var a={currentPlSend:t,currentPlReceive:n};i?(p.noPacketsSeq=0,a.qualityLevel=d.getLevel(Math.max(t,n))):(p.noPacketsSeq++,p.noPacketsSeq>1?(a.qualityLevel=d.RTP_QUALITY_LOW,P.onNoOutgoingPackets&&P.onNoOutgoingPackets()):a.qualityLevel=d.RTP_QUALITY_HIGH);!function(e){var t=p;t.qualityLevel=e.qualityLevel,t.currentPlSend=e.currentPlSend,t.currentPlReceive=e.currentPlReceive;var n=S;n!==t.qualityLevel.value&&r.debug("[CallStatsHandlerUnified]: setQualityEstimation - estimation="+t.qualityLevel.value+" seq="+t.qualityLevelSeq+" current=",n);n<t.qualityLevel.value?(t.qualityLevelSeq++,t.qualityLevelSeq>1&&(S=t.qualityLevel.value,t.qualityLevelSeq=0)):(S=t.qualityLevel.value,t.qualityLevelSeq=0);if(n!==S){var i=1===n&&!f;i&&(t.firstTimeLowQuality=i,f=i),P.onNetworkQuality&&P.onNetworkQuality(t)}}(a)}(e)):t.isElectron&&r.debug("[CallStatsHandlerUnified]: No RTP stats collected")})}function Y(e){var t=null;return Object.keys(e).forEach(function(n){var i=Object.keys(e[n]),o=e[n]||{};i.forEach(function(e){var n=o[e];n.counter>=n.statObj.RecurrenceThreshold?n.reported?(delete o[e],r.debug("[CallStatsHandlerUnified]: issueCounter cleared=",e)):(n.reported=!0,n.counter=0,(t=t||{})[e]=!0):n.reported&&((t=t||{})[e]=!0)})}),t}this.start=function(){A||g?(r.debug("[CallStatsHandlerUnified]: Restart collecting RTPStats"),p=null,S=null,I=null,f=!1):(r.debug("[CallStatsHandlerUnified]: Waiting to start collecting RTPstats"),A=n.setTimeout(function(){r.info("[CallStatsHandlerUnified]: Start collecting RTPStats"),A=null,_=0,W(),g=n.setInterval(function(){W()},l.COLLECTION_INTERVAL)},l.DELAY_UPON_ANSWER))},this.stop=function(){return e=w(!0),A?(r.debug("[CallStatsHandlerUnified]: cancel collecting RTPStats "),n.clearTimeout(A),A=null):g&&(r.debug("[CallStatsHandlerUnified]: stop collecting RTPStats"),n.clearInterval(g),g=null,p=null,S=null,I=null,f=!1,N&&r.debug("[CallStatsHandlerUnified]: savedRTPStats =",N),P.onThresholdExceeded&&P.onThresholdExceeded(!0),y=!1),e;var e},this.onThresholdExceeded=null,this.onNoOutgoingPackets=null,this.onNetworkQuality=null,this.setOptions=function(e){e&&(v=e)},this.getLastSavedStats=function(){return N.channelInfo=m,N}}return E.overridePromise=function(e){i=e},t.CallStatsHandlerUnified=E,t}(e=function(t){"use strict";var i,r=e.logger,o=t.Utils,a=o.isMobile(),s=Object.freeze({GOOG_JITTER_RECEIVED:{StatName:"jr",StatText:"googJitterReceived",Threshold:50,RecurrenceThreshold:a?2:3,reportIssues:!0},GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:a?2:3,reportIssues:!0},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:a?2:3,reportIssues:!0},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:a?0:3,reportIssues:!0},NO_PACKETS_RECV:{StatName:"",StatText:"noPacketsReceived",Threshold:0,RecurrenceThreshold:a?2:3,reportIssues:!0},ECHO_LIKELIHOOD:{StatName:"ecmax",StatText:"googResidualEchoLikelihoodRecentMax",Threshold:.5,RecurrenceThreshold:a?2:3,reportIssues:!1}}),c=Object.freeze({GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:a?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:a?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:a?0:3}}),l={COLLECTION_INTERVAL:5e3,DELAY_UPON_ANSWER:a?0:5e3,DELAY_RTT_PROCESSING:3},d=Object.freeze({RTP_QUALITY_LOW:{levelName:"low",value:1,threshold:.1},RTP_QUALITY_MEDIUM:{levelName:"medium",value:2,threshold:.03},RTP_QUALITY_HIGH:{levelName:"high",value:3,threshold:0},getLevel:function(e){return e>this.RTP_QUALITY_LOW.threshold?this.RTP_QUALITY_LOW:e>this.RTP_QUALITY_MEDIUM.threshold?this.RTP_QUALITY_MEDIUM:this.RTP_QUALITY_HIGH}}),u=Object.freeze({audioOutputLevel:"aol",bytesReceived:"or",bytesSent:"os",googAvailableSendBandwidth:"abw",googResidualEchoLikelihoodRecentMax:"ecmax",googFrameHeightReceived:"fhr",googFrameHeightSent:"fhs",googFrameWidthReceived:"fwr",googFrameWidthSent:"fws",googFrameRateDecoded:"frd",googFrameRateSent:"frs",googJitterReceived:"jr",googRtt:"rtt",googTransmitBitrate:"tbr",packetsLost:"pl",packetsReceived:"pr",packetsSent:"ps"});void 0!==n.Promise&&(i=n.Promise);var C=o.getBrowserInfo();function E(e){switch(e){case"local":return"host";case"stun":case"serverreflexive":return"srflx";case"peerreflexive":return"prflx";case"relayed":return"relay";default:return e}}function T(e,n,i){var r;return e.a.some(function(e){if("candidate"===e.field&&e.value){var o=new t.IceCandidate(e.value);if(o.typ===i&&o["network-id"]===n["network-id"])return r=o.address,!0}return!1}),r}function p(e){var t=o.parseIpWithPort(e.stat("googLocalAddress"))||{},n=o.parseIpWithPort(e.stat("googRemoteAddress"))||{};return{ipl:t.ipAddress,ptl:t.port,ipr:n.ipAddress,ptr:n.port,lct:E(e.stat("googLocalCandidateType")),rct:E(e.stat("googRemoteCandidateType")),tt:e.stat("googTransportType")}}function S(e,n,i,r,o){if(!n||!i)return null;var a={startTime:e,pcType:r,audio:{},video:{}},s={audio:{},video:{}},c={},l=n.result?n.result():n;if(!Array.isArray(l))return null;if(l.forEach(function(e){if(e){var t=null;switch(e.type){case"googCandidatePair":"true"===e.stat("googActiveConnection")&&function(e,t,n,i){"Channel-audio-1"===e.stat("googChannelId")?(t.audio.rtt=parseInt(e.stat("googRtt"),10),i&&(n.audio.local=e.stat("localCandidateId"),C.firefox?n.audio.remote=e.stat("remoteCandidateId"):t.audio.channelInfo=p(e))):(t.video.rtt=parseInt(e.stat("googRtt"),10),i&&(n.video.local=e.stat("localCandidateId"),C.firefox?n.video.remote=e.stat("remoteCandidateId"):t.video.channelInfo=p(e)))}(e,a,s,o);break;case"ssrc":t=function(e,t){var n=null,i={id:e.id,ssrc:e.stat("ssrc"),timestamp:e.timestamp};return e.stat("audioInputLevel")?(t.audio.transmit||(t.audio.transmit=i),n=t.audio.transmit):e.stat("audioOutputLevel")?(t.audio.receive||(t.audio.receive=i),n=t.audio.receive):e.stat("googFrameHeightSent")?(t.video.transmit||(t.video.transmit=i),n=t.video.transmit):e.stat("googFrameHeightReceived")&&(t.video.receive||(t.video.receive=i),n=t.video.receive),n}(e,a);break;case"VideoBwe":a.video.bw||(a.video.bw={id:e.id}),t=a.video.bw;break;case"localcandidate":case"remotecandidate":c[e.id]=e}if(e.names&&t)(e.names()||[]).forEach(function(n){u[n]&&(t[u[n]]=parseFloat(e.stat(n)))}),t.en=e.stat("googCodecName")}}),o){var d;["audio","video"].forEach(function(e){var n=a[e]||{},r=c[s[e].local];if(r){if(!n.channelInfo){var o=c[s[e].remote];n.channelInfo=function(e,t){return{ipl:e&&e.stat("ipAddress"),ptl:e&&e.stat("portNumber"),ipr:t&&t.stat("ipAddress"),ptr:t&&t.stat("portNumber"),lct:e&&E(e.stat("candidateType")),rct:t&&E(t.stat("candidateType")),tt:e&&e.stat("transport")}}(r,o)}n.channelInfo.ni=r.stat("networkType"),d=d||t.sdpParser.parse(i.localDescription&&i.localDescription.sdp),n.channelInfo.candidate=function(e,n,i){var r,o,a={};if(!e||!n||!i)return a;var s=E(e.stat("candidateType"));return"prflx"===s?o=e.stat("ipAddress"):r=String(e.stat("portNumber")),("string"==typeof n?t.sdpParser.parse(n):n).m.some(function(n){return n.media===i&&(n.a.some(function(i){if("candidate"!==i.field)return!1;if(i.value){var c;if(r&&i.value.indexOf(r)>=0&&(c=new t.IceCandidate(i.value),String(c.port)===r&&s===c.typ))return a.value=i.value,"host"===s?(a.hAddr=e.stat("ipAddress"),a.sAddr=T(n,c,"srflx"),a.sAddr||(a.sAddr=a.hAddr)):(a.sAddr=c.raddr,a.hAddr=T(n,c,"host"),"relay"===s&&(a.tt=c.getRelayClientTransportType())),!0;if(o&&i.value.indexOf("srflx")>=0&&"srflx"===(c=c||new t.IceCandidate(i.value)).typ&&String(c.address)===o)return a.sAddr=o,a.hAddr=T(n,c,"host"),!0}return!1}),!0)}),a}(r,d,e)}})}return a}function I(e,t,n,o){return new i(function(i){e.getStats?e.getStats(function(a){a?a=S(n,a,e,t,o):r.warn("[CallStatsHandler]: getStats["+t+"] did not return a response"),i(a)},function(e){r.warn("[CallStatsHandler]: getStats["+t+"] failed with err = ",e),i()}):i()})}function f(e){if(!Array.isArray(e))throw new Error("peerConnections must be an array");var o=6,a=20,u=e.filter(function(e){return e});if(!e.length)throw new Error("Cannot create CallStatsHandler object without at least one peer connection");var C,E,T,p,S,f,R={},v=null,A=null,g=0,_=[],N=[],m=[],h=[],O=[],D=this;function y(e){var t=[],n=!f;return f=f||n,u.forEach(function(i){i&&(e||"completed"===i.iceConnectionState||"connected"===i.iceConnectionState?(i.mainPeerConnection&&(t.push(I(i.mainPeerConnection,"AUDIO/VIDEO",i.startTime,n)),i.groupPeerConnections.forEach(function(e){t.push(I(e,"AUX_VIDEO",i.startTime,n))})),i.desktopPeerConnection&&t.push(I(i.desktopPeerConnection,"SCREEN_SHARE",i.startTime,n))):r.warn("[CallStatsHandler]: Do not collect stats. pc.iceConnectionState = ",i.iceConnectionState))}),new i(function(e){i.all(t).then(function(t){(t=t&&t.filter(function(e,t){return e&&(e.audio&&!e.audio.channelInfo&&N[t]&&(e.audio.channelInfo=N[t]),e.video&&!e.video.channelInfo&&m[t]&&(e.video.channelInfo=m[t])),e}))&&t.length?e(t):e()})})}function P(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.ps||0),(e.pl-n)/(e.ps-i||-1)}function b(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.pr||0),(e.pl-n)/(e.pr-i+e.pl-n||-1)}function U(e,t,n){var i=n+"Sum",r=n+"Count",o=n+"Max";t?(void 0!==t[i]?(e[i]=t[i]+(e[n]||0),++t[r],e[r]=t[r]):(e[i]=e[n]||0,e[r]=1),void 0!==t[o]?e[o]=Math.max(t[o],e[n]||0):e[o]=e[n]||0):(e[i]=e[o]=e[n]||0,e[r]=1)}function L(e,t,n,i,o,s){var c;t.reportIssues?c=e[t.StatText]||{}:c={counter:(e[t.StatText]||{}).counter};var l=t.StatText+"LastViStart",d=t.StatText+"Violations",u=t.StatText+"ViCounter";if(o[l]=s&&s[l],o[d]=s&&s[d],o[u]=s&&s[u]||0,-1===n){if(o[l]){var C=o[d];C=C?C+",":"",o[d]=C+"("+o[l]+","+parseInt((Date.now()-i)/1e3,10)+")",o[u]++,delete o[l]}c.reported?c.counter++:c.counter&&(delete e[t.StatText],r.debug("[CallStatsHandler]: issueCounter cleared=",t.StatText))}else c.reported?(c.counter=0,c.value=n):c.counter?(c.counter++,c.value=n):(e[t.StatText]={statObj:t,counter:1,value:n},o[u]<a&&(o[l]=parseInt((Date.now()-i)/1e3,10)))}function M(e){if(e&&e.length){var t=!1;e.forEach(function(e,n){var i,o=e.audio&&e.audio.transmit,a=e.audio&&e.audio.receive,d=h[n]||{},u=O[n]||{},C=_[n]||{};a&&C.audio&&C.audio.receive&&!R.sendOnlyStream&&L(d,s.NO_PACKETS_RECV,!(a.pr>C.audio.receive.pr)||-1,e.startTime,e.audio,C.audio);var E,T=s.GOOG_JITTER_RECEIVED;a&&(U(a,C.audio&&C.audio.receive,s.GOOG_JITTER_RECEIVED.StatName),L(d,T,(E=a[T.StatName])&&E>=T.Threshold?E:-1,e.startTime,e.audio,C.audio)),T=s.PACKET_LOSS_SEND,o&&o.pl&&o.ps&&L(d,T,(i=P(o,C.audio&&C.audio.transmit))>=T.Threshold?i:-1,e.startTime,e.audio,C.audio),T=s.PACKET_LOSS_RECV,a&&a.pl&&a.pr&&L(d,T,(i=b(a,C.audio&&C.audio.receive))>=T.Threshold?i:-1,e.startTime,e.audio,C.audio),e.audio&&g>l.DELAY_RTT_PROCESSING&&(U(e.audio,C.audio,s.GOOG_RTT.StatName),L(d,T=s.GOOG_RTT,e.audio.rtt>=T.Threshold?e.audio.rtt:-1,e.startTime,e.audio,C.audio)),T=s.ECHO_LIKELIHOOD,o&&(U(o,C.audio&&C.audio.transmit,s.ECHO_LIKELIHOOD.StatName),L(d,T,(E=o[T.StatName])&&E>=T.Threshold?E:-1,e.startTime,e.audio,C.audio)),o=e.video&&e.video.transmit,a=e.video&&e.video.receive,T=c.PACKET_LOSS_SEND,o&&o.pl&&o.ps&&L(u,T,(i=P(o,C.video&&C.video.transmit))>=T.Threshold?i:-1,e.startTime,e.video,C.video),T=c.PACKET_LOSS_RECV,a&&a.pl&&a.pr&&L(u,T,(i=b(a,C.video&&C.video.receive))>=T.Threshold?i:-1,e.startTime,e.video,C.video),(o||a)&&g>l.DELAY_RTT_PROCESSING&&(U(e.video,C.video,c.GOOG_RTT.StatName),L(u,T=c.GOOG_RTT,e.video&&e.video.rtt>=T.Threshold?e.video.rtt:-1,e.startTime,e.video,C.video)),e.audio&&e.audio.channelInfo&&(N[n]=e.audio.channelInfo),e.video&&e.video.channelInfo&&(m[n]=e.video.channelInfo),_[n]=e,h[n]=d,O[n]=u;var p=G(d),I=G(u);(p||I)&&(t=!0,S||(I=I||"none",S=!0,(p=p||"none").noPacketsReceived?r.warn("[CallStatsHandler]: processRTPStats - No packets received from remote peer"):(r.warn("[CallStatsHandler]: processRTPStats - Quality issues detected",[{audio:p},{video:I}]),D.onThresholdExceeded&&D.onThresholdExceeded())))}),!t&&S&&(r.debug("[CallStatsHandler]: processRTPStats - No quality issues detected. Clear threshold exceeded error."),S=!1,D.onThresholdExceeded&&D.onThresholdExceeded(!0)),(S||g%o==0)&&_.forEach(function(e,t){var n,i,o,a,s;n=e,i=[h[t],O[t]],n&&(n.audio||n.video)&&(o="[CallStatsHandler]: statsReport: audioRtt="+(n.audio&&n.audio.rtt||"n/a")+" videoRtt="+((n.video.receive||n.video.transmit)&&n.video&&n.video.rtt||"n/a"),n.audio&&((a=n.audio.receive)&&(o+="\n audioReceive:  id="+a.id+" pl="+a.pl+" pr="+a.pr+" or="+a.or+" jr="+a.jr),(a=n.audio.transmit)&&(o+="\n audioTransmit: id="+a.id+" pl="+a.pl+" ps="+a.ps+" os="+a.os)),n.video&&((a=n.video.receive)&&(o+="\n videoReceive:  id="+a.id+" pl="+a.pl+" pr="+a.pr+" or="+a.or+" fwr="+a.fwr+" fhr="+a.fhr+" frd="+a.frd),(a=n.video.transmit)&&(o+="\n videoTransmit: id="+a.id+" pl="+a.pl+" ps="+a.ps+" os="+a.os+" fws="+a.fws+" fhs="+a.fhs+" frs="+a.frs)),r.debug(o)),i&&i.length&&(o="[CallStatsHandler]: statsReport:\n",i.forEach(function(e,t){o+=0===t?" Audio issues=":"\n Video issues=";var n=Object.keys(e);n.length?(s=!0,n.forEach(function(t){o+=" "+t+"="+e[t].value+" count="+e[t].counter})):o+=" none"}),s&&r.info(o))}),g++}}function w(){t.isElectron&&r.debug("[CallStatsHandler]: Get RTP stats for local call(s)"),y().then(function(e){e?(t.isElectron&&r.debug("[CallStatsHandler]: Process RTP stats for local call(s)"),M(e),function(e){if(!e||!e.length)return void r.debug("[CallStatsHandler]: processNetworkIndication - No stats for network indication.");T||(T=[],E=d.RTP_QUALITY_HIGH,C={noPacketsSeq:0,qualityLevelSeq:0},p=!1);e.forEach(function(e,t){var n=0,i=0,o=e.audio&&e.audio.transmit,a=e.audio&&e.audio.receive,s=!0,c=!0,l=T[t]||{};!o||isNaN(o.pl)||isNaN(o.ps)||(n=P(o,l.audio&&l.audio.transmit)||0,l.audio&&l.audio.transmit&&l.audio.transmit.ps&&(s=o.ps!==l.audio.transmit.ps),s||r.warn("[CallStatsHandler]: processNetworkIndication - No packets sent to remote peer")),!a||isNaN(a.pl)||isNaN(a.pr)||(i=b(a,l.audio&&l.audio.receive)||0,l.audio&&l.audio.receive&&l.audio.receive.pr&&(c=a.pr!==l.audio.receive.pr),c||R.sendOnlyStream||r.warn("[CallStatsHandler]: processNetworkIndication - No packets received from remote peer"));var u={currentPlSend:n,currentPlReceive:i};s?(C.noPacketsSeq=0,u.qualityLevel=d.getLevel(Math.max(n,i))):(C.noPacketsSeq++,C.noPacketsSeq>1?(u.qualityLevel=d.RTP_QUALITY_LOW,D.onNoOutgoingPackets&&D.onNoOutgoingPackets()):u.qualityLevel=d.RTP_QUALITY_HIGH),function(e){var t=C;t.qualityLevel=e.qualityLevel,t.currentPlSend=e.currentPlSend,t.currentPlReceive=e.currentPlReceive;var n=E;n!==t.qualityLevel.value&&r.debug("[CallStatsHandler]: setQualityEstimation - estimation="+t.qualityLevel.value+" seq="+t.qualityLevelSeq+" current="+n);n<t.qualityLevel.value?(t.qualityLevelSeq++,t.qualityLevelSeq>1&&(E=t.qualityLevel.value,t.qualityLevelSeq=0)):(E=t.qualityLevel.value,t.qualityLevelSeq=0);if(n!==E){var i=1===n&&!p;i&&(t.firstTimeLowQuality=i,p=i),D.onNetworkQuality&&D.onNetworkQuality(t)}}(u),T[t]=e})}(e)):t.isElectron&&r.debug("[CallStatsHandler]: No RTP stats collected")})}function G(e){var t=null;return Object.keys(e).forEach(function(n){var i=e[n];i.counter>=i.statObj.RecurrenceThreshold?i.reported?(delete e[n],r.debug("[CallStatsHandler]: issueCounter cleared=",n)):(i.reported=!0,i.counter=0,(t=t||{})[n]=!0):i.reported&&((t=t||{})[n]=!0)}),t}this.start=function(){v||A?(r.debug("[CallStatsHandler]: Restart collecting RTPStats"),C=null,E=null,T=null,p=!1):(r.debug("[CallStatsHandler]: Waiting to start collecting RTPstats"),v=n.setTimeout(function(){r.info("[CallStatsHandler]: Start collecting RTPStats"),v=null,g=0,w(),A=n.setInterval(function(){w()},l.COLLECTION_INTERVAL)},l.DELAY_UPON_ANSWER))},this.stop=function(){return new i(function(e){y(!0).then(function(t){e(t)}),v?(r.debug("[CallStatsHandler]: cancel collecting RTPStats "),n.clearTimeout(v),v=null):A&&(r.debug("[CallStatsHandler]: stop collecting RTPStats"),n.clearInterval(A),A=null,C=null,E=null,T=null,p=!1,_&&r.debug("[CallStatsHandler]: savedRTPStats =",_),D.onThresholdExceeded&&D.onThresholdExceeded(!0),S=!1)})},this.onThresholdExceeded=null,this.onNoOutgoingPackets=null,this.onNetworkQuality=null,this.setOptions=function(e){e&&(R=e)},this.getLastSavedStats=function(){return _}}return f.overridePromise=function(e){i=e},t.CallStats=u,t.CallStatsHandler=f,t.RtpStatsConfig=l,t}(e=function(e){"use strict";var t=e.AppMessagingHandlerSingleton,r=e.ChromeExtension,o=e.Constants,a=e.logger,s=e.Utils,c=e.TemasysAdapter,l=function(){var l=t?t.getInstance():null,d={getScreen:function(e,t){t&&t("NOT_SUPPORTED")},setControllingScreen:function(e,t){t&&t("NOT_SUPPORTED")},unregEvtHandlers:function(){},isScreensharingAvailable:function(){return!1},isFirefoxLegacy:function(){return!1},installExtension:function(){},injectExtensionSvc:function(){},injectTemasysSvc:function(){}},u=s.getBrowserInfo();function C(e,t){i.mediaDevices.getDisplayMedia({video:!0}).then(function(t){e({mediaStream:t})}).catch(function(e){"NotAllowedError"!==e.name?t(e):t(o.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)})}if(e.isElectron)d.getScreen=function(e,t,n){var i=require("electron").ipcRenderer;i.once("screenshare-chooser",function(n,i,r){"share"===i?(a.info("[ScreenSharingController]: Got screen share stream. Stream id: ",r.display.streamId),e&&e({screenIndex:r.display.screenIndex,streamId:r.display.streamId,pointer:r.pointer,screenControlSupported:r.screenControlSupported})):"cancel"===i&&(a.info("[ScreenSharingController]: User canceled screen share"),t&&t(o.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED))}),a.info("[ScreenSharingController]: Request screen in Electron"),i.send("screenshare-chooser","open",n)},d.isScreensharingAvailable=function(){return!0},d.setControllingScreen=function(){require("electron").ipcRenderer.send("screenshare-chooser","setControllingScreen")};else if(e.isVdiApp)d.getScreen=function(e,t){l.sendInternalMessage({method:"showwindow"}),n.setTimeout(function(){chrome.desktopCapture.chooseDesktopMedia(["screen"],null,function(n){l.sendInternalMessage({method:"minimizewindow"}),n?e&&e({streamId:n}):t&&t(o.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)})},0)},d.isScreensharingAvailable=function(){return!0};else if(u.chrome)if(i.mediaDevices.getDisplayMedia)d.getScreen=C,d.isScreensharingAvailable=function(){return!0};else{var E,T,p,S=function(e){e&&e===T&&E&&T&&(E.removeEventListener(r.BgTarget.SCREEN_SHARE,T),T=null)},I=function(e,t){return E?(S(T),T=function(e,t,n){var i=n.data;switch(n.suppressLog||a.info("[ScreenSharingController]: Received screenshare event from extension - ",i.type),i.type){case r.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_DONE:a.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA done. Stream Id:",i.streamId),S(T),e&&e({streamId:i.streamId});break;case r.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_CANCELLED:a.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA cancelled"),S(T),t(o.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)}}.bind(null,e,t),E.addEventListener(r.BgTarget.SCREEN_SHARE,T),T):null};d.getScreen=function(e,t){var n=null;return p&&p.isExtensionRunning()?(n=I(e,t),E.getScreenShareUserMedia(function(e){e&&(a.warn("[ScreenSharingController]: Error starting screen share using chrome extension: ",e),S(n),t("res_AccessToExtensionFailed"))})):t("res_AccessToExtensionFailed"),n},d.isScreensharingAvailable=function(){return!!p&&p.isExtensionRunning()},d.installExtension=function(){p&&(a.debug("[ScreenSharingController]: Install Chrome extension"),p.installExtension(!0).then(function(){a.info("[ScreenSharingController]: Chrome extension was successfully installed")}).catch(function(e){a.warn("[ScreenSharingController]: Failed to install Chrome extension. ",e)}))},d.injectExtensionSvc=function(e,t){p=e,E=t},d.unregEvtHandlers=S}else if(u.msie){var f;d.getScreen=function(e,t){c&&c.isScreensharingAvailable()?e&&e():t&&t("NOT_AVAILABLE")},d.isScreensharingAvailable=function(){return!!c&&c.isScreensharingAvailable()},d.installExtension=function(){f&&f.showPopup()},d.injectTemasysSvc=function(e){f=e}}else u.firefox?(i.mediaDevices.getDisplayMedia?d.getScreen=C:(d.getScreen=function(e){e&&e()},d.isFirefoxLegacy=function(){return!0}),d.isScreensharingAvailable=function(){return!0}):(u.edge||"Android"===n.navigator.platform||"iOS"===n.navigator.platform)&&(d.getScreen=function(e){e&&e()},d.isScreensharingAvailable=function(){return!0});return d}();return e.ScreenSharingController=l,e}((e=function(e){"use strict";var t=e.logger,i=e.BaseCall,r=e.Enums.CallState,o=e.Enums.CstaCallState,a=e.Enums.ParticipantState,s=e.Utils,c=e.Constants,l=Object.freeze({SERVER_ENDED_PRFX:"SERVER_ENDED:"}),d=Object.freeze({CLIENT_ENDED_PRFX:"CLIENT_ENDED:",ANOTHER_CLIENT_ANSWERED:"ANOTHER_CLIENT_ANSWERED",ANOTHER_CLIENT_REJECTED:"ANOTHER_CLIENT_REJECTED",ANOTHER_CLIENT_PULLED_CALL:"ANOTHER_CLIENT_PULLED_CALL",CALL_MOVED_TO_ANOTHER_CONV:"CALL_MOVED_TO_ANOTHER_CONV",CALLER_LEFT_CONFERENCE:"CALLER_LEFT_CONFERENCE",ENDED_BY_ANOTHER_USER:"ENDED_BY_ANOTHER_USER",LOST_WEBSOCKET_CONNECTION:"LOST_WEBSOCKET_CONNECTION",NO_USERS_LEFT:"NO_USERS_LEFT",REQUEST_TO_SERVER_FAILED:"REQUEST_TO_SERVER_FAILED",RTC_SESSION_START_FAILED:"RTC_SESSION_START_FAILED",SET_REMOTE_SDP_FAILED:"SET_REMOTE_SDP_FAILED",USER_ENDED:"USER_ENDED",LOST_MEDIA_STREAM:"LOST_MEDIA_STREAM",ICE_TIMED_OUT:"ICE_TIMED_OUT",USER_LOGGED_OUT:"USER_LOGGED_OUT",PAGE_UNLOADED:"PAGE_UNLOADED",DISCONNECTED:"WS_DISCONNECTED",FAILED_TO_SEND:"WS_FAILED_TO_SEND",REQUEST_TIMEOUT:"WS_REQUEST_TIMEOUT",MEDIA_RENEGOTIATION:"MEDIA_RENEGOTIATION"}),u=s.isMobile();function C(i,o){var a=e.WebRTCAdapter;o=o||{};var l=e.RtcSessionController;if(!i||!i.rtcSessionId)throw new Error("Cannot create LocalCall object without a valid conversation");C.parent.constructor.call(this,i,!1);var d=this,E=null,T=!1,p=null,S=!1,I=!1,f=!1,R=!1,v=!1,A=!1,g=null,_=null,N=null,m=null,h=!1,O=[],D=[],y=[],P="",b="",U=!1;function L(){E?(t.debug("[LocalCall]: RtcSessionController - onMediaUpdate: callId =",d.callId),d.activeMediaType=E.getActiveMediaType(),t.debug("[LocalCall]: Set active media type to ",d.activeMediaType),d.localMediaType=E.getMediaConstraints(),t.debug("[LocalCall]: Set local media type to ",d.localMediaType),d.updateMediaType(),d.updateCallState()):t.debug("[LocalCall]: session controller not available - onMediaUpdate: callId =",d.callId)}function M(e){t.debug("[LocalCall]: RtcSessionController - onLocalVideoStream: callId =",d.callId),d.localVideoStream=e.stream,d.localStreams.desktop=e.desktopStream,d.localStreams.video=e.videoStream,P="",t.debug("[LocalCall]: Set local video stream to ",e.videoStream&&e.videoStream.id||"<null>"),t.debug("[LocalCall]: Set local desktop stream to ",e.desktopStream&&e.desktopStream.id||"<null>")}function w(e){t.debug("[LocalCall]: RtcSessionController - onScreenSharePointerStatus",e),d.pointer={isSupported:e.isSupported,isEnabled:e.isEnabled}}function G(e){t.debug("[LocalCall]: RtcSessionController - onRemoteStreams: callId =",d.callId),d.remoteAudioStream=e.audio&&e.audio.stream||null,b="",t.debug("[LocalCall]: Set remote audio stream to",d.remoteAudioStream&&d.remoteAudioStream.id||"<empty>"),d.remoteVideoStreams=e.video||[],t.debug("[LocalCall]: Set remote video streams to",e.video||"<empty>"),d.participants.forEach(function(e){d.setParticipantRemoteVideoStream(e)}),d.checkForActiveRemoteVideo()}Object.defineProperties(this,{sessionCtrl:{get:function(){return E},enumerable:!0,configurable:!1},isVdi:{get:function(){return!(!E||!E.isRemoteController)},enumerable:!0,configurable:!1},locallyMuted:{get:function(){return!(!E||!E.isMuted())},enumerable:!0,configurable:!1},remoteVideoDisabled:{get:function(){return I},enumerable:!0,configurable:!1},remoteAudioDisabled:{get:function(){return f},enumerable:!0,configurable:!1},isMocked:{get:function(){return v},enumerable:!0,configurable:!1},isMeetingPointInvited:{get:function(){return A},enumerable:!0,configurable:!1},ringAllAllowed:{get:function(){return!!(this.peerUsers&&this.peerUsers.length>0&&this.peerUsers.length<=9)},enumerable:!0,configurable:!1},ringAllMaxNumber:{get:function(){return 9},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return U||this.state===r.Ringing},set:function(e){U=e},enumerable:!0,configurable:!1},curtain:{get:function(){return g||{}},set:function(e){var t;(t=e)&&t.curtainState&&(g&&(t.lastCurtainState=g.curtainState),(g=t).curtainClosed=t.curtainState!==c.CurtainState.OPEN)},enumerable:!0,configurable:!1},playbackDevice:{get:function(){return _},enumerable:!0,configurable:!1},recordingDevice:{get:function(){return N},enumerable:!0,configurable:!1},videoDevice:{get:function(){return m},enumerable:!0,configurable:!1},playbackDeviceList:{get:function(){return O},enumerable:!0,configurable:!1},recordingDeviceList:{get:function(){return D},enumerable:!0,configurable:!1},videoDeviceList:{get:function(){return y},enumerable:!0,configurable:!1},atcAdvancing:{get:function(){return h},set:function(e){h=!!e},enumerable:!0,configurable:!1},savedRTPStats:{get:function(){return this.sessionCtrl?this.sessionCtrl.getLastSavedStats():null},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return!(!this.checkState([r.Active,r.Delivered])&&!this.isOsBizFirstCall)&&(!(this.sessionCtrl&&!this.sessionCtrl.canSendDTMFDigits())||!!this.checkState(r.Active)&&!!this.atcCallInfo)},enumerable:!0,configurable:!1},localVideoUrl:{get:function(){return u||t.warn("[LocalCall]: localVideoUrl is deprecated and will eventually be removed. Use localVideoStream instead"),P=d.localVideoStream?P||a.createObjectURL(d.localVideoStream):""},enumerable:u,configurable:!1},remoteAudioUrl:{get:function(){return u||t.warn("[LocalCall]: remoteAudioUrl is deprecated and will eventually be removed. Use remoteAudioStream instead"),b=d.remoteAudioStream?b||a.createObjectURL(d.remoteAudioStream):""},enumerable:u,configurable:!1},remoteVideoUrlStreams:{get:function(){return u||t.warn("[LocalCall]: remoteVideoUrlStreams is deprecated and will eventually be removed. Use remoteVideoStreams instead"),d.remoteVideoStreams.map(function(e){return e.url||(e.url=a.createObjectURL(e.stream)),{streamId:e.streamId,url:e.url}})},enumerable:u,configurable:!1}}),this.localVideoStream=null,this.localStreams={},this.remoteAudioStream=null,this.remoteVideoStreams=[],this.activeMediaType={audio:!1,video:!1,desktop:!1},this.ringingTimeout=15e3,this.whiteboardEnabled=!1,this.whiteboard=null,this.screenEnabledFeature=null,this.pollEnabled=!1,this.poll=null,this.pointer={isSupported:!1,isEnabled:!1},this.screenControllerId=null,this.screenOwnerId=null,this.screenOwner=null,this.screenController=null,this.preventScreenControlRequestInConf=!1,this.badQualityNotification={detected:!1,acted:!1,dismissed:!1},this.clientId=o.clientId,this.isOsBizFirstCall=!1,this.isOsBizSecondCall=!1,this.raiseHandState={},this.holdInProgress=!1,this.retrieveInProgress=!1,this.isSTC=o.isSTC,this.stcTransferAllowed=o.stcTransferAllowed,this.terminate=function(){T||(t.debug("[LocalCall]: Terminating call with callId =",this.callId),this.isOsBizSecondCall?E=null:E&&(E&&(E.onMediaUpdate=null,E.onLocalVideo=null,E.onRemoteStreams=null,E.onScreenSharePointerStatus=null),E.terminate()),P="",b="",this.localVideoStream=null,this.localStreams={},this.remoteAudioStream=null,this.remoteVideoStreams=[],C.prototype.terminate.call(this),this.stopRingingTimer(),T=!0)},this.setMockedCall=function(){var e;(t.debug("[LocalCall]: Setting call as mocked"),v=!0,E&&E.setMockedCall(),E&&0===E.getNumberOfExtraVideoChannels())?(this.participants.forEach(function(t){t.streamId="",(t.mediaType.desktop||!e&&t.mediaType.video)&&(e=t)}),e&&(e.streamId="mock")):this.participants.forEach(function(e){e.streamId=e.mediaType.video||e.mediaType.desktop?"mock":""});n.setTimeout(function(){this.state!==r.Terminated&&(t.debug("[LocalCall]: Initialize remote mocked streams"),G({audio:null,video:[{streamId:"mock",stream:"content/images/mock/trailer.mp4"}]}),E&&(E.onRemoteStreams=null))},100)},this.startRingingTimer=function(e){"function"==typeof e&&(t.info("[LocalCall]: Starting ringing timer for callId =",d.callId),p=n.setTimeout(function(){t.info("[LocalCall]: Ringing timeout for callId =",d.callId),p=null,e()},this.ringingTimeout))},this.stopRingingTimer=function(){p&&(t.info("[LocalCall]: Cancelling ringing timer for callId =",d.callId),n.clearTimeout(p),p=null)},this.hasRemoteVideo=function(){return S},this.checkForActiveRemoteVideo=function(){S=!I&&this.participants.some(function(e){return!!e.videoStream}),t.debug("[LocalCall]: Set hasActiveRemoteVideo to ",S)},this.enableRemoteVideo=function(){I&&(I=!1,this.checkForActiveRemoteVideo(),this.sessionCtrl&&this.sessionCtrl.enableRemoteVideo(),t.debug("[LocalCall]: Enabled remote video"))},this.disableRemoteVideo=function(){I||(I=!0,S=!1,this.participants.forEach(function(e){e.videoStream=null,e.streams={},d.isDirect&&(e.streamId="")}),this.sessionCtrl&&this.sessionCtrl.disableRemoteVideo(),t.debug("[LocalCall]: Disabled remote video"))},this.enableRemoteAudio=function(){f&&(f=!1,t.debug("[LocalCall]: Enabled remote audio."))},this.disableRemoteAudio=function(){f||(f=!0,t.debug("[LocalCall]: Disabled remote audio."))},this.setMeetingPointInviteState=function(e){A=!!e,t.debug("[LocalCall]: Set Circuit Meeting Point state to ",e)},this.setHasUnmutedParticipants=function(){R=this.participants.some(function(e){return!e.muted})},this.hasUnmutedParticipants=function(){return R},this.getUnmutedParticipantIds=function(){var e=[];return this.participants.forEach(function(t){t.muted||e.push(t.userId)}),e},this.getMediaNode=function(){return this.isTestCall?l.mediaNode:null},this.updateMediaDevices=function(){var e=function(e){return e?e.filter(function(e){return"default"!==e.id&&"communications"!==e.id&&e.label}).map(function(e){return e.label}):[]};a.getMediaSources(function(n,i,r){if(a.getMediaSourcesSupported){var o=s.selectMediaDevice(r,l.playbackDevices);_=o&&o.label,O=e(r),o=s.selectMediaDevice(n,l.recordingDevices),N=o&&o.label,D=e(n),o=s.selectMediaDevice(i,l.videoDevices),m=o&&o.label,y=e(i)}else _=Audio.getPlaybackDevice&&Audio.getPlaybackDevice(),N=Audio.getRecordingDevice&&Audio.getRecordingDevice(),m=Audio.getVideoDevice&&Audio.getVideoDevice();t.debug("[LocalCall]: Updated media devices: recording="+N+" playback="+_+" video="+m+" callId="+d.callId)})},E||(o.reuseSessionCtrl?E=o.reuseSessionCtrl:((E=new l({callId:d.callId,isDirectCall:d.isDirect,isTelephonyCall:d.isTelephonyCall,isLargeConference:d.isLarge,isAtcPullCall:o.isAtcPullCall,reuseDesktopStreamFrom:o.reuseDesktopStreamFrom,isSessionGuest:o.isSessionGuest||d.isGuestInvite,midMappingEnabled:o.midMappingEnabled})).onMediaUpdate=L,E.onLocalVideoStream=M,E.onRemoteStreams=G,E.onScreenSharePointerStatus=w,d.isDirect||E.setExtraVideoChannelsForParticipants(d.numConvParticipants))),i=null,d.updateMediaDevices(),t.info("[LocalCall]: Created new WebRTC call with callID = ",this.callId)}function E(e,t){if(t.mediaType.video||t.mediaType.desktop)if(e.sessionCtrl&&0===e.sessionCtrl.getNumberOfExtraVideoChannels()){var n=e.participants.find(function(e){return e.streamId});t.streamId=n&&n.userId!==t.userId?"":"mock"}else t.streamId="mock";else t.streamId=""}return s.inherit(C,i),C.prototype.hasRemoteMedia=function(){return!(!this.remoteAudioStream&&!this.remoteVideoStreams.length)},C.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.remoteVideoDisabled&&(!this.localMediaType.desktop||this.isDirect&&this.participants[0].mediaType.desktop)},C.prototype.addParticipant=function(e){this.isMocked&&e&&e.mediaType&&E(this,e);var t=C.parent.addParticipant.apply(this,arguments);return t&&(this.setParticipantRemoteVideoStream(t),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),t},C.prototype.updateParticipant=function(e){this.isMocked&&e&&e.mediaType&&E(this,e);var t=C.parent.updateParticipant.apply(this,arguments);return t&&(this.setParticipantRemoteVideoStream(t),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),t},C.prototype.removeParticipant=function(){var e=C.parent.removeParticipant.apply(this,arguments);return e&&this.setHasUnmutedParticipants(),e},C.prototype.setParticipantRemoteVideoStream=function(e){if(e.videoStream=null,e.streams={},this.isDirect&&(e.streamId=""),!this.remoteVideoDisabled)if(!e.mediaType||e.mediaType.video||e.mediaType.desktop){if(this.isDirect){if(this.remoteVideoStreams&&this.remoteVideoStreams.length){var n=this.remoteVideoStreams[this.remoteVideoStreams.length-1];e.streamId=n.streamId,e.videoStream=n.stream}}else{if(!e.streamId&&!e.screenStreamId)return void t.info("[LocalCall]: The participant does not have a video streamId. userId = ",e.userId);this.remoteVideoStreams&&this.remoteVideoStreams.length&&(this.remoteVideoStreams.forEach(function(t){t.streamId===e.streamId?e.streams.video=t.stream:t.streamId===e.screenStreamId&&(e.streams.desktop=t.stream)}),e.videoStream=e.streams.desktop||e.streams.video||null)}e.videoStream?(e.pcState=e.muted?a.Muted:a.Active,t.debug("[LocalCall]: Set remote video stream for participant: ",e)):t.debug("[LocalCall]: We still do not have a video stream for the participant. ",e)}else t.debug("[LocalCall]: The participant does not have video or screen-share. Do not set video stream. userId = ",e.userId)},C.prototype.hasLocalScreenShare=function(){return this.sessionCtrl&&this.sessionCtrl.hasScreenShare()},C.prototype.isMuted=function(){return this.remotelyMuted||this.locallyMuted},C.prototype.mute=function(e){return this.checkState(r.Terminated)?(t.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(t.debug("[LocalCall]: Mute call with callId =",this.callId),this.sessionCtrl&&this.sessionCtrl.mute(e))},C.prototype.unmute=function(e){return this.checkState(r.Terminated)?(t.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(t.debug("[LocalCall]: Unmute call with callId =",this.callId),this.sessionCtrl&&this.sessionCtrl.unmute(e))},C.prototype.isLocalMuteAllowed=function(){return this.sessionCtrl&&this.sessionCtrl.isLocalMuteAllowed()},C.prototype.toggleMute=function(){return this.sessionCtrl&&this.sessionCtrl.isMuted()?this.unmute():this.mute()},C.prototype.setActiveSpeakers=function(e){if(!e)return!1;e instanceof Array||(e=[e]);var t=!1;return this.participants.forEach(function(n){var i=-1!==e.indexOf(n.userId);n.activeSpeaker!==i&&(n.activeSpeaker=i,t=!0)}),t},C.prototype.updateCallState=function(){var e;this.state.established&&this.sessionCtrl&&(e=!this.sessionCtrl.isConnected()||!this.isDirect&&!this.hasOtherParticipants()||this.isATCCall&&!this.getCstaState().established?r.Waiting:this.sessionCtrl.isHolding()||this.checkCstaState(o.Holding)?r.Holding:this.sessionCtrl.isHeld()?r.Held:r.Active,this.setState(e))},C.prototype.isHolding=function(){return this.atcCallInfo?C.parent.isHolding.apply(this,arguments):this.checkState([r.Holding,r.HoldOnHold])},C.prototype.isConsultAllowed=function(){return!this.atcCallInfo||this.atcCallInfo.isConsultAllowed()},C.prototype.isHoldInProgress=function(){return this.atcCallInfo?this.atcCallInfo.isHoldInProgress():this.holdInProgress},C.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress(),this.holdInProgress=!0},C.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress(),this.holdInProgress=!1},C.prototype.isRetrieveInProgress=function(){return this.atcCallInfo?this.atcCallInfo.isRetrieveInProgress():this.retrieveInProgress},C.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress(),this.retrieveInProgress=!0},C.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress(),this.retrieveInProgress=!1},C.prototype.isTransferCallAllowed=function(){return this.atcCallInfo?this.atcCallInfo.isTransferCallAllowed():this.stcTransferAllowed&&this.checkState([r.Active,r.Delivered])},C.prototype.isTransferAllowed=function(){return this.atcCallInfo?this.atcCallInfo.isTransferAllowed():this.stcTransferAllowed&&this.state.established},e.LocalCall=C,e.Enums.CallServerTerminatedReason=l,e.Enums.CallClientTerminatedReason=d,e}((e=function(e){"use strict";var t=Object.freeze({Disconnected:"Disconnected",Unregistered:"Unregistered",Registering:"Registering",Registered:"Registered",ForcedUnregistered:"ForcedUnregistered"});return e.Enums=e.Enums||{},e.Enums.AtcRegistrationState=t,e}((e=function(t){"use strict";var n=t.BaseCall,i=t.Enums.CallState,r=t.Proto;function o(t){var n=e.logger;if(!t||!t.rtcSessionId)throw new Error("Cannot create RemoteCall object without a valid conversation");o.parent.constructor.call(this,t,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return!this.pullNotAllowed&&this.state===i.ActiveRemote&&!this.pullBlocked},enumerable:!0,configurable:!1}}),this.activeClient=null,t=null,this.isTelephonyCall&&(this.peerUser.displayName=""),n.info("[RemoteCall]: Created new remote call with callID = ",this.callId)}return t.Utils.inherit(o,n),o.prototype.setActiveClient=function(e){e&&(e.userId?(this.activeClient={clientId:e.clientId,clientDisplayName:e.clientDisplayName,mediaType:r.getMediaType(e.mediaTypes)},this.pullNotAllowed=!1===e.pullCall):this.activeClient=e)},t.RemoteCall=o,t}((e=function(e){"use strict";var t=e.Constants,n=e.Enums.CstaCallState,i=e.DefaultAvatars,r=e.logger,o=e.Enums.ParticipantState,a=e.RtcParticipant,s=e.UserProfile,c=e.Utils,l=Object.freeze({INCOMING:"incoming",OUTGOING:"outgoing",NONE:""}),d=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",ui:"res_Calling",established:!1,css:"outgoing"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},Delivered:{name:"Delivered",ui:"res_Calling",established:!1,css:"outgoing"},Busy:{name:"Busy",ui:"res_BusyCall",established:!1,css:"busy"},Failed:{name:"Failed",ui:"res_FailedCall",established:!1,css:"failed"},Declined:{name:"Declined",ui:"res_CallDeclined",established:!1,css:"declined"},NotAnswered:{name:"NotAnswered",ui:"res_CallNotAnswered",established:!1,css:"not-answered"},Ringing:{name:"Ringing",ui:"res_IncomingCall",established:!1,css:"incoming"},Answering:{name:"Answering",ui:"res_IncomingCall",established:!1,css:"answering"},Active:{name:"Active",ui:"",established:!0,css:"active-call"},Held:{name:"Held",ui:"res_OnHold",established:!0,css:"active-call"},Holding:{name:"Holding",ui:"res_Holding",established:!0,css:"holding-call"},HoldOnHold:{name:"HoldOnHold",ui:"res_Holding",established:!0,css:"holding-call"},Waiting:{name:"Waiting",ui:"res_Waiting",established:!0,css:"waiting"},Started:{name:"Started",ui:"res_InProgress",established:!1,css:"started"},NotStarted:{name:"NotStarted",ui:"",established:!1,css:"not-started"},ActiveRemote:{name:"ActiveRemote",ui:"res_RemoteCall",established:!0,css:"active-call-remote"},Terminated:{name:"Terminated",ui:"res_Terminated",established:!1,css:"declined"}});function u(e,o){if(!e)throw new Error("Cannot create BaseCall object without a conversation");o=!!o;var a=this,u=null,C=null,E=null,T=null,p=null,S=null,I=null,f=null,R=!1,v=!1,A=!1,g=!1,_=d.Idle,N=null,m=!1;function h(e){u=e.rtcSessionId,E=e.convId,T=e.type,p=e.topic||e.participantFirstNames||null,S=e.topicEscaped||e.participantFirstNamesEscaped||null,I=e.creatorId,R=e.type===t.ConversationType.DIRECT,v=e.type===t.ConversationType.LARGE,A=e.isTelephonyConv,g=e.testCall,R?a.peerUser=e.peerUser:delete a.peerUser,a.peerUsers=e.peerUsers,a.numConvParticipants=e.participants.length,a.avatar=e.avatar,a.isGuestInvite=!!e.isTemporary}Object.defineProperties(this,{isRemote:{value:o,writable:!1,enumerable:!0,configurable:!1},callId:{get:function(){return u},enumerable:!0,configurable:!1},cstaCallId:{get:function(){return this.atcCallInfo?this.atcCallInfo.getCstaCallId():null},enumerable:!0,configurable:!1},instanceId:{get:function(){return C},enumerable:!0,configurable:!1},transactionId:{get:function(){return f},enumerable:!0,configurable:!1},state:{get:function(){return _},enumerable:!0,configurable:!1},convId:{get:function(){return E},enumerable:!0,configurable:!1},convType:{get:function(){return T},enumerable:!0,configurable:!1},convTitle:{get:function(){return p||(R?this.peerUser.displayName:"")},enumerable:!0,configurable:!1},convTitleEscaped:{get:function(){return S||(R?this.peerUser.displayNameEscaped:"")},enumerable:!0,configurable:!1},containsExternals:{get:function(){return this.participants.some(function(e){return e.participantType===t.RTCParticipantType.SESSION_GUEST||e.participantType===t.RTCParticipantType.EXTERNAL})},enumerable:!1,configurable:!1},ownerId:{get:function(){return I},enumerable:!0,configurable:!1},isDirect:{get:function(){return R&&!m},enumerable:!0,configurable:!1},isLarge:{get:function(){return v},enumerable:!0,configurable:!1},conferenceCall:{get:function(){return!R||m},enumerable:!0,configurable:!1},isGroupCallStarted:{get:function(){return!(this.isDirect||this.state!==d.Started)},enumerable:!0,configurable:!1},isGroupCallInitiated:{get:function(){return!(this.isDirect||this.state!==d.Initiated)},enumerable:!0,configurable:!1},isGroupCallActive:{get:function(){return!(this.isDirect||this.state!==d.Active)},enumerable:!0,configurable:!1},isTelephonyCall:{get:function(){return A},enumerable:!0,configurable:!1},isTestCall:{get:function(){return g},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return!0},enumerable:!0,configurable:!0},isPullAllowed:{value:!1,enumerable:!0,configurable:!0},isHandoverAllowed:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverAllowed()},enumerable:!0,configurable:!0},isHandoverInProgress:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverInProgress()},enumerable:!0,configurable:!0},redirectingUser:{get:function(){return this.getRedirectingUser()},enumerable:!0,configurable:!0},forwarded:{get:function(){return this.isForwarded()},enumerable:!0,configurable:!0},pickupNotification:{get:function(){return this.isPickupNotification()},enumerable:!0,configurable:!0},pickedUp:{get:function(){return this.isPickedUp()},enumerable:!0,configurable:!0},disconnectCause:{get:function(){return N},set:function(e){N=e},enumerable:!0,configurable:!1},transferCallFailedCause:{get:function(){return this.atcCallInfo?this.atcCallInfo.getTransferCallFailedCause():null},enumerable:!0,configurable:!1},isOutgoingCallCampedOn:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isOutgoingCallCampedOn()},enumerable:!0,configurable:!0},isATCCall:{get:function(){return!!this.atcCallInfo},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return!1},enumerable:!0,configurable:!0},isDirectUpgradedToConf:{get:function(){return m},enumerable:!0,configurable:!1}}),this.localMediaType={audio:!1,video:!1,desktop:!1},this.mediaType={audio:!1,video:!1,desktop:!1},this.lastMediaType=this.mediaType,this.direction=l.NONE,this.secureCall=!1,this.establishedTime=0,this.creationTime=Date.now(),this.peerUsers=null,this.peerUser=null,this.numConvParticipants=0,this.avatar=null,this.activeNotification=null,this.activeRTPStatsWarning=null,this.participants=[],this.participantsHashTable={},this.attendeeCount=0,this.remotelyMuted=!1,this.sessionMuted=!1,this.sessionLocked=!1,this.recording={state:t.RecordingInfoState.INITIAL,notifyByCurtain:!1,notifyByUser:!1,duration:0,starter:{userId:""},reason:t.RecordingInfoReason.NONE,resumeTime:0,wasStarted:function(){return this.state!==t.RecordingInfoState.INITIAL},isActive:function(){return this.state===t.RecordingInfoState.STARTED||this.state===t.RecordingInfoState.START_PENDING},isPaused:function(){return this.state===t.RecordingInfoState.START_PENDING},isFailed:function(){return this.reason!==t.RecordingInfoReason.NONE&&this.reason!==t.RecordingInfoReason.STOPPED_MANUALLY&&this.reason!==t.RecordingInfoReason.STOPPED_AUTOMATICALLY&&(this.state===t.RecordingInfoState.INITIAL||this.state===t.RecordingInfoState.STOPPED)}},this.upgradeToConfSupported=!1,this.screenControlSupported=!1,this.setState=function(e,t){!o&&e!==d.Terminated&&this.checkCstaState(n.Holding)&&(e=d.Holding),e&&e!==_&&(_!==d.Terminated?(r.debug("[BaseCall]: Changing call state from "+_.name+" to "+e.name),this.establishedTime||!e.established||this.atcCallInfo&&!this.atcCallInfo.cstaState.established||(this.establishedTime=Date.now()),_=e,this.isTelephonyCall&&(this.avatar=e===d.Holding?i.TELEPHONY_HOLD:i.TELEPHONY),_!==d.Terminated||t||this.terminate()):r.error("[BaseCall]: The call has already been terminated. Cannot set state to ",e.name))},this.checkState=function(e){return Array.isArray(e)?e.some(function(e){return e===_}):e===_},this.updateCall=function(e){return!!e&&(h(e),this.participants.forEach(function(t){t.isMeetingGuest&&!t.isSessionGuest&&(t.isMeetingGuest=e.participants.every(function(e){return e.userId!==t.userId}))}),!0)},this.setPeerUser=function(e,t,n){(this.peerUser.hasTelephonyRole||!this.peerUser.userId||n&&n!==this.peerUser.userId||c.cleanPhoneNumber(e)!==c.cleanPhoneNumber(this.peerUser.phoneNumber))&&(this.peerUser={userId:n||"",firstName:null,lastName:null,displayName:t,phoneNumber:e},s&&s.extend&&(this.peerUser=s.extend(this.peerUser)),S=(p=t||e||null)?c.textToHtmlEscaped(p):null)},this.setTransactionId=function(e){f=e||c.createTransactionId()},this.clearTransactionId=function(){f=null},this.setInstanceId=function(e){C=e},this.setCallIdForTelephony=function(e){a.isTelephonyCall&&e&&e!==u&&(r.debug("[BaseCall]: Changing callId from "+u+" to "+e),u=e)},this.setDirectUpgradedToConf=function(){R&&(m=!0)},this.clearDirectUpgradedToConf=function(){R&&(m=!1)},h(e),e=null}function C(e,n){var i=e.rtcSupportedFeatures||[];n.isDirect&&(i.includes(t.RtcSupportedFeatures.UPGRADE_TO_CONFERENCE)?(r.debug("[BaseCall]: Upgrade to conference is supported by peer client"),n.upgradeToConfSupported=!0):(r.debug("[BaseCall]: Upgrade to conference is not supported by peer client"),n.upgradeToConfSupported=!1)),e.mediaType&&e.mediaType.desktop&&(i.includes(t.RtcSupportedFeatures.SCREEN_CONTROL)?(r.debug("[BaseCall]: Screen control supported by presenter"),n.screenControlSupported=!0):(r.debug("[BaseCall]: Screen control not supported by presenter"),n.screenControlSupported=!1))}return u.prototype.sameAs=function(e){return!!e&&this.callId===e.callId&&this.isRemote===e.isRemote},u.prototype.terminate=function(){r.debug("[BaseCall]: Terminating call with callId = ",this.callId),this.lastMediaType=this.mediaType,this.mediaType={audio:!1,video:!1,desktop:!1},this.setState(d.Terminated,!0)},u.prototype.isEstablished=function(){return this.state.established},u.prototype.isOutgoingState=function(){return this.state===d.Initiated||this.state===d.Connecting||this.state===d.Delivered||this.state===d.Busy},u.prototype.isPresent=function(){return this.state!==d.Idle&&this.state!==d.Terminated},u.prototype.isHeld=function(){return this.state===d.Held},u.prototype.hasRemoteMedia=function(){return!1},u.prototype.isCallingOut=function(){return this.state===d.Waiting&&this.participants.length>0&&this.participants.every(function(e){return e.pcState===o.Initiated})},u.prototype.hasVideo=function(){return!(!this.mediaType.video&&!this.mediaType.desktop)},u.prototype.updateSecurityStatus=function(e){!0!==e&&!1!==e||(this.secureCall=e)},u.prototype.canToggleVideo=function(){return!this.isRemote&&this.checkState([d.Active,d.Waiting])},u.prototype.hasRemoteVideo=function(){return!1},u.prototype.hasLocalVideo=function(){return this.localMediaType.video||this.localMediaType.desktop},u.prototype.hasLocalScreenShare=function(){return this.localMediaType.desktop},u.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.localMediaType.desktop},u.prototype.isMuted=function(){return!1},u.prototype.mute=function(){return r.warning("[BaseCall]: Mute is not implemented in base object"),!1},u.prototype.unmute=function(){return r.warning("[BaseCall]: Unmute is not implemented in base object"),!1},u.prototype.toggleMute=function(){return r.warning("[BaseCall]: toggleMute is not implemented in base object"),!1},u.prototype.outgoingFailed=function(){return!this.isRemote&&this.direction===l.OUTGOING&&this.checkState([d.Declined,d.Busy,d.NotAnswered,d.Failed])},u.prototype.setPeerUsersAsParticipants=function(){if(this.direction===l.OUTGOING&&this.peerUsers){this.participants=this.peerUsers.map(function(e){return a.createFromUser(e,o.Initiated)});for(var e=0;e<this.participants.length;e++)this.participantsHashTable[this.participants[e].userId]=this.participants[e];r.debug("[BaseCall]: Initialized participants: ",this.participants)}},u.prototype.hasParticipant=function(e){return this.participants.some(function(t){return t.userId===e})},u.prototype.getParticipant=function(e){for(var t=0;t<this.participants.length;t++)if(this.participants[t].userId===e)return this.participants[t];return null},u.prototype.addParticipant=function(e,t,n){return e&&e.userId?(r.debug("[BaseCall]: Add participant with userId =",e.userId),this.hasParticipant(e.userId)?n?this.updateParticipant(e,t):(r.warning("[BaseCall]: addParticipant called with existing participant. userId =",e.userId),null):(t&&(e.pcState=t),this.participants.push(e),this.participantsHashTable[e.userId]=e,C(e,this),r.debug("[BaseCall]: Added participant to call: ",e.userId),e)):(r.warning("[BaseCall]: addParticipant called with invalid participant"),null)},u.prototype.updateParticipant=function(e,t){if(!e||!e.userId)return r.warning("[BaseCall]: updateParticipant called with invalid participant"),null;r.debug("[BaseCall]: Update participant with userId =",e.userId);var n=this.getParticipant(e.userId);return n?(t=t||e.pcState,n.isMeetingPointInvitee&&n.locallyMuted?(n.muted=!0,n.pcState=t!==o.Active?t:o.Muted):(n.muted=e.muted,n.pcState=t),n.mediaType.desktop&&!e.mediaType.desktop&&(this.screenControlSupported=!1),n.streamId=e.streamId,n.screenStreamId=e.screenStreamId,n.mediaType=e.mediaType,n.screenSharePointerSupported=e.screenSharePointerSupported,n.isModerator=e.isModerator,n.isMeetingGuest=e.isMeetingGuest,n.rtcSupportedFeatures=e.rtcSupportedFeatures,n.flags=e.flags,C(n,this),r.debug("[BaseCall]: Updated participant data for ",n.userId),n):(r.warning("[BaseCall]: The given participant is not part of the call"),null)},u.prototype.removeParticipant=function(e){delete this.participantsHashTable[e];for(var t=0;t<this.participants.length;t++)if(this.participants[t].userId===e){var n=this.participants.splice(t,1)[0];return n.videoStream=null,n.mediaType={audio:!1,video:!1,desktop:!1},r.debug("[BaseCall]: Removed participant from call: ",n.userId),n}return null},u.prototype.setParticipantState=function(e,t){t&&this.participants.some(function(n){return n.userId===e&&(n.pcState=t,r.debug("[BaseCall]: Set participant state to "+t.name+", userId =",n.userId),!0)})},u.prototype.hasOtherParticipants=function(){return this.participants.length>0||this.attendeeCount>0},u.prototype.updateMediaType=function(){var e={audio:this.localMediaType.audio,video:this.localMediaType.video,desktop:this.localMediaType.desktop};this.participants.forEach(function(t){t.mediaType&&(t.mediaType.audio&&(e.audio=!0),t.mediaType.video&&(e.video=!0),t.mediaType.desktop&&(e.desktop=!0))}),r.debug("[BaseCall]: Updating call media type to ",e),this.mediaType=e},u.prototype.callTypeCss=function(){if(this.isDirect)return this.hasVideo()?"webrtc-video":"webrtc-audio";if(this.isRemote)return"remote";switch(this.state.css){case"outgoing":return"ongoing";case"incoming":return"incoming";case"answering":return"answering";case"active-call":return"active";default:return""}},u.prototype.callHeaderType=function(){return this.isDirect?"Direct":this.isGuestInvite?"Guest":this.isLarge?"Large":"Group"},u.prototype.toString=function(){return JSON.stringify(this,null,3)},u.prototype.getCstaState=function(){return this.atcCallInfo?this.atcCallInfo.cstaState:null},u.prototype.setCstaState=function(e){this.atcCallInfo&&(this.atcCallInfo.cstaState=e,this.isAtcRemote&&(this.avatar=e===n.Holding?i.TELEPHONY_HOLD:i.TELEPHONY),this.consultation=this.consultation&&!this.isHolding())},u.prototype.checkCstaState=function(e){if(!this.atcCallInfo)return!1;if(!Array.isArray(e))return e===this.atcCallInfo.cstaState;var t=this;return e.some(function(e){return e===t.atcCallInfo.cstaState})},u.prototype.isHolding=function(){return this.checkCstaState([n.Holding,n.HoldOnHold,n.ConferenceHolding])},u.prototype.isHoldAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldAllowed()},u.prototype.isConsultAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConsultAllowed()},u.prototype.isReconnectAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isReconnectAllowed()},u.prototype.isConferenceCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCallAllowed()},u.prototype.isMakeCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isMakeCallAllowed()},u.prototype.isRetrieveAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveAllowed()},u.prototype.isTransferCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferCallAllowed()},u.prototype.isTransferAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferAllowed()},u.prototype.getPosition=function(){return this.atcCallInfo?this.atcCallInfo.getPosition():null},u.prototype.setAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHandoverInProgress()},u.prototype.clearAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHandoverInProgress()},u.prototype.isHoldInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldInProgress()},u.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress()},u.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress()},u.prototype.isRetrieveInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveInProgress()},u.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress()},u.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress()},u.prototype.isAtcConferenceCall=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCall()},u.prototype.setRedirectingUser=function(e,t,n,i,r){this.atcCallInfo&&this.atcCallInfo.setRedirectingUser(e,t,n,i,r)},u.prototype.getRedirectingUser=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectingUser():null},u.prototype.setRedirectionType=function(e){this.atcCallInfo&&this.atcCallInfo.setRedirectionType(e)},u.prototype.getRedirectionType=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectionType():null},u.prototype.isForwarded=function(){return!!this.atcCallInfo&&this.atcCallInfo.isForwarded()},u.prototype.isPickupNotification=function(){return!!this.atcCallInfo&&this.atcCallInfo.isPickupNotification()},u.prototype.isPickedUp=function(){return!!this.atcCallInfo&&this.atcCallInfo.isPickedUp()},u.prototype.setDisconnectCause=function(e,t){this._disconnectCause||(this.disconnectCause={cause:e,reason:t})},e.BaseCall=u,e.Enums=e.Enums||{},e.Enums.CallDirection=l,e.Enums.CallState=d,e.Enums.ScreenDisplayAction={ToggleWhiteboard:{name:"ToggleWhiteboard",type:"screenEnabledFeature",localize:"res_Whiteboard"},ToggleScreenShare:{name:"ToggleScreenShare",type:"screenEnabledFeature",localize:"res_Screenshare"},ToggleVideo:{name:"ToggleVideo",type:"screenEnabledFeature",localize:"res_Video"},SwapDisplays:{name:"SwapDisplays",type:"displays",icon:"",localize:"res_SwapDisplays"}},e.Enums.ScreenLayoutAction={ToggleFocusLayout:{name:"ToggleFocusLayout",type:"cmrLayout",localize:"res_FocusLayout"},ToggleSplitLayout:{name:"ToggleSplitLayout",type:"cmrLayout",localize:"res_SplitLayout"},ToggleLargeLayout:{name:"ToggleLargeLayout",type:"cmrLayout",localize:"res_LargeLayout"}},e}((e=function(e){"use strict";var t=e.logger,n=e.Utils,i={WebRTC:{name:"WebRTC",ui:"res_CircuitClient",css:"circuit"},Cell:{name:"Cell",ui:"res_BackupNumber",css:"mobile"},Desk:{name:"Desk",ui:"res_Deskphone",css:"desk"},VM:{name:"VM",ui:"res_Voicemail",css:"vm"},Other:{name:"Other",ui:"res_CallAtOther",css:""}},r=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",established:!1},Connecting:{name:"Connecting",established:!1},Delivered:{name:"Delivered",established:!1},Busy:{name:"Busy",established:!1},Offered:{name:"Offered",established:!1},Failed:{name:"Failed",established:!1},TransferFailed:{name:"TransferFailed",established:!1},Ringing:{name:"Ringing",established:!1},ExtendedRinging:{name:"ExtendedRinging",established:!1},Active:{name:"Active",established:!0},Held:{name:"Held",established:!0},Holding:{name:"Holding",established:!0},HoldOnHold:{name:"HoldOnHold",established:!0},Parked:{name:"Parked",established:!0},Conference:{name:"Conference",established:!0},ConferenceHolding:{name:"ConferenceHolding",established:!0},Terminated:{name:"Terminated",established:!1}}),o=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting"},BusySignal:{name:"BusySignal",ui:"res_BusyHandling_BusySignal"},SendToAlternativeNumber:{name:"SendToAlternativeNumber",ui:"res_BusyHandling_AlternativeNumber"},SendToVM:{name:"SendToVM",ui:"res_BusyHandling_Voicemail"}}),a=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting",desc:"res_DefaultRoutingDescription",newDesc:"res_DefaultRoutingDescriptionTimersPBXConfigurable"},DeskPhone:{name:"DeskPhone",ui:"res_Deskphone",desc:"res_DeskphoneRoutingDescription"},AlternativeNumber:{name:"AlternativeNumber",ui:"res_BusyHandling_AlternativeNumber",desc:"res_AlternativeNumberRoutingDescription"},VM:{name:"VoiceMail",ui:"res_Voicemail",desc:"res_VoicemailRoutingDescription"},Other:{name:"Other",ui:"res_Other",desc:""}}),s=Object.freeze({REGULAR:"REGULAR",MISSED:"MISSED"}),c=Object.freeze({DEFAULT:"DEFAULT",DEST_OUT_OF_ORDER:"DEST_OUT_OF_ORDER",REORDER_TONE:"REORDER_TONE",BUSY:"BUSY",CANCELLED:"CANCELLED",DECLINED:"DECLINED",TRANSFERRED:"TRANSFERRED"}),l=Object.freeze({Busy:{name:"Busy",ui:"res_TransferCallFailedCauseBusy"},Unreachable:{name:"Unreachable",ui:"res_TransferCallFailedCauseUnreachable"},DND:{name:"Dnd",ui:"res_TransferCallFailedCauseDND"}}),d=Object.freeze({CallForward:{name:"callForward",ui:"res_ForwardedFrom"},CallPickupNotification:{name:"callPickupNotification",ui:"res_CallPickupNotification"},CallPickedUp:{name:"callPickedUp",ui:"res_CallPickedUp"}}),u=Object.freeze({Ready:"ready",NotReady:"notReady"});return e.AtcCallInfo=function(){var e=null;this.cstaConn=null,this.cstaState=r.Idle,this.cstaReconnectId={},this.position=i.Other,this.servicesPermitted={},this.peerFQN="",this.peerDn="",this.peerName=null,this.missedReason="",this.ignoreCall=!1,this.originalPartnerDisplay={},this.handoverInProgress=!1,this.holdInProgress=!1,this.retrieveInProgress=!1,this.outgoingCallCampedOn=!1,this.redirectingUser={},this.masterParallelHgCall=!1,this.setPeerName=function(e){this.peerName=e||""},this.setPartnerDisplay=function(e){e&&(this.peerFQN=e.fqn||"",this.peerDn=e.dn||e.fqn||"",this.peerName=e.name||this.peerDn,!this.peerFQN&&this.peerDn.startsWith("+")&&(this.peerFQN=this.peerDn))},this.setOriginalPartnerDisplay=function(e){e&&n.isEmptyObject(this.originalPartnerDisplay)&&(this.originalPartnerDisplay=e)},this.setCstaConnection=function(e){this.cstaConn=e,this.isRemote&&(this.callId=e.cID)},this.getCstaConnection=function(){return this.cstaConn},this.getCstaCallId=function(){return this.cstaConn&&this.cstaConn.cID},this.getCstaDeviceId=function(){return this.cstaConn&&this.cstaConn.dID},this.setCstaReconnectId=function(e){this.cstaReconnectId=e},this.getCstaReconnectId=function(){return this.cstaReconnectId},this.setServicesPermitted=function(e){e&&!n.isEmptyObject(e)?(e.rSP&&void 0!==e.rSP.cCSs&&(this.servicesPermitted.rSP=e.rSP),void 0!==e.eSP&&(this.servicesPermitted.eSP=e.eSP),t.info("[AtcCallInfo]: Updated services permitted: ",this.servicesPermitted)):t.info("[AtcCallInfo]: Empty services permitted, keeping last values")},this.clearServicesPermitted=function(){this.servicesPermitted={}},this.getServicesPermitted=function(){return this.servicesPermitted},this.isHandoverAllowed=function(){return(this.isSilentHandoverAllowed()||this.isSeamlessHandoverAllowed())&&!this.isHandoverInProgress()},this.isSeamlessHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zseHo)||!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.zseHo)},this.isSilentHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zsiHo)},this.isTransferAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.sST||this.isHandoverInProgress())},this.isAlternateAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.alC)},this.isAnswerAllowed=function(){return this.servicesPermitted.rSP?!!this.servicesPermitted.rSP.cCSs.anC:this.cstaState===r.Ringing},this.isCallBackAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.cB)},this.isConsultAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.csC)},this.isDeflectAllowed=function(){return this.cstaState===r.Parked||this.cstaState===r.Ringing||!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.dCl)},this.isGenerateDigitsAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cAS.gD)},this.isHoldAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.hCl;switch(this.cstaState){case r.Active:case r.Conference:case r.Held:return!0;default:return!1}},this.isConferenceCall=function(){return this.cstaState===r.Conference||this.cstaState===r.ConferenceHolding},this.isMakeCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.mCl)},this.isReconnectAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.rC)},this.isRetrieveAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.reC;switch(this.cstaState){case r.ConferenceHolding:case r.Holding:case r.HoldOnHold:return!0;default:return!1}},this.isTransferCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.tCl||this.isHandoverInProgress())},this.isConferenceCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.coC)},this.getPosition=function(){return this.position},this.setPosition=function(e){e&&e!==this.position&&(this.position=e,t.debug("[AtcCallInfo]: Set call position to ",e.name))},this.getMissedReason=function(){return this.missedReason},this.setMissedReason=function(e){e&&e!==this.missedReason&&(this.missedReason=e,t.debug("[AtcCallInfo]: Set missedReason to ",e))},this.getIgnoreCall=function(){return this.ignoreCall||this.cstaState===r.Offered},this.setIgnoreCall=function(e){this.ignoreCall=e},this.isHandoverInProgress=function(){return this.handoverInProgress},this.setHandoverInProgress=function(){this.handoverInProgress=!0},this.clearHandoverInProgress=function(){this.handoverInProgress=!1},this.isHoldInProgress=function(){return this.holdInProgress},this.setHoldInProgress=function(){this.holdInProgress=!0},this.clearHoldInProgress=function(){this.holdInProgress=!1},this.isRetrieveInProgress=function(){return this.retrieveInProgress},this.setRetrieveInProgress=function(){this.retrieveInProgress=!0},this.clearRetrieveInProgress=function(){this.retrieveInProgress=!1},this.isOutgoingCallCampedOn=function(){return this.outgoingCallCampedOn},this.setOutgoingCallCampedOn=function(){this.outgoingCallCampedOn=!0},this.clearOutgoingCallCampedOn=function(){this.outgoingCallCampedOn=!1},this.setTransferCallFailedCause=function(t){if(this.cstaState===r.TransferFailed)switch(t){case"busy":e=l.Busy;break;case"doNotDisturb":e=l.DND;break;default:e=l.Unreachable}},this.getTransferCallFailedCause=function(){return this.cstaState===r.TransferFailed?e||l.Unreachable:null},this.setRedirectingUser=function(e,t,n,i,r){r=r||this.redirectingUser.redirectionType,this.redirectingUser&&this.redirectingUser.fqNumber&&this.redirectingUser.fqNumber!==t||(this.redirectingUser={userId:i||"",displayName:n,phoneNumber:e,fqNumber:t,redirectionType:r})},this.getRedirectingUser=function(){return this.redirectingUser},this.setRedirectionType=function(e){this.redirectingUser.redirectionType=e},this.getRedirectionType=function(){return this.redirectingUser&&this.redirectingUser.redirectionType},this.isForwarded=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallForward},this.isPickupNotification=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallPickupNotification},this.isPickedUp=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallPickedUp}},e.Enums=e.Enums||{},e.Enums.CstaCallState=r,e.Enums.Targets=i,e.Enums.JournalEntryTypes=s,e.Enums.MissedReasonTypes=c,e.BusyHandlingOptions=o,e.RoutingOptions=a,e.Enums.TransferCallFailedCauses=l,e.Enums.RedirectionTypes=d,e.Enums.AgentState=u,e}((e=function(e){"use strict";var t=e.Constants,n=e.logger,i=e.Utils,r={Active:{name:"Active",ui:"",established:!0,css:"active-call"},Busy:{name:"Busy",ui:"res_ParticipantState_busy",established:!1,css:"busy"},Calling:{name:"Calling",ui:"",established:!1,css:"calling"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},ConnectionLost:{name:"ConnectionLost",ui:"res_ParticipantState_connectionLost",established:!1,css:"connection-lost"},Declined:{name:"Declined",ui:"res_ParticipantState_declined",established:!1,css:"declined"},Delivered:{name:"Delivered",ui:"",established:!1,css:"outgoing"},Idle:{name:"Idle",ui:"",established:!1,css:"idle"},Inactive:{name:"Inactive",ui:"",established:!1,css:"inactive"},Initiated:{name:"Initiated",ui:"",established:!1,css:"outgoing"},Joined:{name:"Joined",ui:"res_ParticipantState_joined",established:!0,css:"joined-call"},Muted:{name:"Muted",ui:"res_ParticipantState_muted",established:!0,css:"muted"},Offline:{name:"Offline",ui:"res_ParticipantState_offline",established:!1,css:"offline"},OffStage:{name:"OffStage",ui:"res_ParticipantState_leftStage",established:!1,css:"declined"},OnStage:{name:"OnStage",ui:"res_ParticipantState_enteredStage",established:!0,css:"joined-call"},Removed:{name:"Removed",ui:"res_ParticipantState_removed",established:!1,css:"declined"},Ringing:{name:"Ringing",ui:"",established:!1,css:"incoming"},Terminated:{name:"Terminated",ui:"res_ParticipantState_left",established:!1,css:"declined"},Timeout:{name:"Timeout",ui:"res_ParticipantState_missed",established:!1,css:"busy"}},o={Drop:{name:"Drop",type:"hangup",icon:"",localize:"res_Hangup"},Mute:{name:"Mute",type:"microphone",icon:"unmuted",localize:"res_Mute"},Unmute:{name:"Unmute",type:"microphone",icon:"muted",localize:"res_Unmute"},StartVideo:{name:"StartVideo",type:"video",icon:"inactive",localize:"res_StartVideo"},StopVideo:{name:"StopVideo",type:"video",icon:"active",localize:"res_StopVideo"},RemoveFromStage:{name:"DropFromStage",type:"hangup",icon:"drop-from-stage",localize:""}},a={createFromUser:function(t,o){if(!t)return null;var s=Object.create(t);s.pcState=o||r.Idle,s.streamId=null,s.screenStreamId=null,s.videoStream=null,s.mediaType={audio:!1,video:!1,desktop:!1},s.muted=!1,s.activeSpeaker=!1,s.isActive=a.isActive.bind(null,s),s.actions=[],s.screenSharePointerSupported=!1,s.hasSameMediaType=a.hasSameMediaType.bind(null,s),s.hasVideoStream=a.hasVideoStream.bind(null,s),s.setActions=a.setActions.bind(null,s),s.rtcSupportedFeatures=[],s.flags=[],s.toJSON=function(){return this},s.userId=t.userId,s.firstName=t.firstName,s.lastName=t.lastName;var c=null,l="";return Object.defineProperties(s,{videoStream:{get:function(){return c},set:function(e){c=e,l=""},enumerable:!0,configurable:!1},videoUrl:{get:function(){return n.warn("[RtcParticipant]: videoUrl is deprecated and will eventually be removed"),l=c?l||e.WebRTCAdapter.createObjectURL(c):""},enumerable:i.isMobile(),configurable:!1}}),s.streams={},s},isActive:function(e){switch(e.pcState){case r.Active:case r.Joined:case r.Muted:case r.OnStage:return!0}return!1},hasSameMediaType:function(e,t){return!!(e&&t&&e.mediaType&&t.mediaType&&e.mediaType.audio===t.mediaType.audio&&e.mediaType.video===t.mediaType.video&&e.mediaType.desktop===t.mediaType.desktop)},hasVideoStream:function(e){return!(!e.videoStream||!e.streamId&&!e.screenStreamId||!e.mediaType.video&&!e.mediaType.desktop)},setActions:function(e,n,i){if(e.actions=[],!n||!n.isTemporary)if(e.pcState.established)if(e.isMeetingPointInvitee)e.actions.push(e.mediaType.video?o.StopVideo:o.StartVideo),e.actions.push(e.muted?o.Unmute:o.Mute),e.actions.push(o.Drop);else{var a=!n||n.isModerated,s=n&&n.userIsModerator(i),c=n&&n.userIsModerator(e);e.muted||a&&c&&!s||e.actions.push(o.Mute),a&&!s||(n.type===t.ConversationType.LARGE&&!c&&s?e.actions.push(o.RemoveFromStage):e.actions.push(o.Drop))}else e.pcState===r.Initiated&&e.actions.push(o.Drop)}};return e.RtcParticipant=a,e.Enums=e.Enums||{},e.Enums.ParticipantState=r,e.Enums.ParticipantAction=o,e}((e=function(e){"use strict";var t=e.logger,n=e.Utils;return e.RtcPeerConnectionsUnified=function(i,r){r=r||{};var o,a=e.WebRTCAdapter,s=this,c=n.shallowCopy(i),l=null,d=0,u={},C=[];function E(e){return!!e&&e===l}function T(e,t){return!(!e||!t)&&a.getTrackId(e)===a.getTrackId(t)}function p(e,n){if("function"==typeof e)try{e(n)}catch(e){t.error(e)}}this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(e,n,i,r){!function(e,n){(n=n||{}).audioInactive?l.addTransceiver("audio",{direction:"inactive"}):e.mandatory&&e.mandatory.OfferToReceiveAudio&&(l.getReceivers().some(function(e){return"audio"===(e.track&&e.track.kind)})||(t.debug("[RTCPeerConnectionsUnified]: create local SDP: Adding 1 audio receiver"),l.addTransceiver("audio",{direction:"recvonly"})));var i=e.mandatory&&e.mandatory.OfferToReceiveVideo,r=0,o=0;if(i)if(l.getReceivers().forEach(function(e){"video"===(e.track&&e.track.kind)&&r++}),o=d-r,u.track&&o>0?o=d-++r:i=!1,o>=0){t.debug("[RTCPeerConnectionsUnified]: create local SDP: Adding "+o+" video receivers");for(var a=0;a<o;a++)l.addTransceiver("video",{direction:"recvonly"})}else t.warn("[RTCPeerConnectionsUnified]: create local SDP: Could not calculate number of video receivers: ",o);t.debug("[RTCPeerConnectionsUnified]: Total number of video receivers: ",r+o),u.track&&l.addTransceiver(u.track,{direction:i?"sendrecv":"sendonly"})}(i,r),l.createOffer(function(n){t.debug("[RTCPeerConnectionsUnified]: createOffer succeeded"),e(n)},n)},this.createAnswer=function(e,n,i,r){!function(e,t){t=t||{};var n=e.mandatory&&e.mandatory.OfferToReceiveVideo;n&&!t.audioInactive||l.getTransceivers().forEach(function(e){var i=e.receiver&&e.receiver.track&&e.receiver.track.kind;n||"video"!==i?t.audioInactive&&"audio"===i&&(e.direction="inactive"):e.sender&&e.sender.track?e.direction="sendonly":e.direction="inactive"}),u.track&&l.addTrack(u.track,u.stream)}(i,r),l.createAnswer(function(n){t.debug("[RTCPeerConnectionsUnified]: createAnswer succeeded"),e(n)},n)},this.setMainMediaLines=function(){},this.setLocalDescription=function(e,t,n){l.setLocalDescription(e,t,n)},this.setRemoteDescription=function(e,t,n){var i;l.setRemoteDescription((i=e)&&"pranswer"===i.type?{type:"answer",sdp:i.sdp}:i,t,n)},this.removeStream=function(e){if(e){var n=l.getSenders();e.getTracks().forEach(function(e){t.debug("[RTCPeerConnectionsUnified]: Attempting to remove local track: ",e.label),n.some(function(n){return!!T(n.track,e)&&(t.debug("[RTCPeerConnectionsUnified]: Found sender, track removed"),T(u.track,e)&&(t.debug("[RTCPeerConnectionsUnified]: Set local desktop track to null"),u={}),l.removeTrack(n),!0)})})}},this.addStream=function(e,n){e&&(l.remoteDescription&&l.remoteDescription.type?e.getTracks().forEach(function(t){e.isScreen?(u.track=t,u.stream=e):l.addTrack(t,e)}):(e.getAudioTracks().forEach(function(e){l.addTransceiver(e,{direction:"sendrecv"})}),e.getVideoTracks().forEach(function(i){var r=n?"sendrecv":"sendonly";e.isScreen?(u.track=i,u.stream=e):l.addTransceiver(i,{direction:r}),t.debug("[RTCPeerConnectionsUnified]: Added local "+(e.isScreen?"screen":"video")+" track="+i.label+" direction="+r)})))},this.getLocalStreams=function(){var e=[];return l.getSenders().forEach(function(t){t.track&&e.push(new a.MediaStream([t.track]))}),e},this.getRemoteStreams=function(){var e=[];return l.getTransceivers().forEach(function(t){if(t.receiver&&t.receiver.track){var n=new a.MediaStream([t.receiver.track]);n.mid=t.mid,e.push(n)}}),e},this.addIceCandidate=function(e){e?l.addIceCandidate(new a.IceCandidate(e)):l.addIceCandidate()},this.close=function(){var e;l.close(),(e=l).onnegotiationneeded=null,e.onicecandidate=null,e.onsignalingstatechange=null,e.oniceconnectionstatechange=null,e.ontrack=null},this.createDTMFSender=function(e){return l.createDTMFSender(e)},this.sendDataMessage=function(){return!1},this.getMediaId=function(e){if(e){var t=l.getTransceivers();if(t.length){var n=t.find(function(t){return t.sender&&T(t.sender.track,e)});if(n)return n.mid}}return null},this.getScreenShareMediaId=function(){var e=l.getTransceivers();if(e.length){if(u.track){var n=e.find(function(e){return!(!e.sender||!e.sender.track)&&T(e.sender.track,u.track)});if(n)return n.mid;t.warn("[RTCPeerConnectionsUnified]: Could not find desktop sender obj. Last video connection will be selected for screen share")}for(var i=e.length-1;i>=0;i--){var r=e[i];if(r.receiver&&r.receiver.track&&"video"===r.receiver.track.kind)return r.mid}}return null},this.getStats=function(e,t){l.getStats(e,t)},Object.defineProperties(this,{localDescription:{get:function(){return l.localDescription},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return l.remoteDescription},enumerable:!0,configurable:!1},signalingState:{get:function(){return l.signalingState},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return l.iceConnectionState},enumerable:!0,configurable:!1},mainPeerConnection:{get:function(){return l},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return[]},enumerable:!0,configurable:!1},desktopPeerConnection:{get:function(){return r.createDesktopPc},enumerable:!0,configurable:!1},desktopRemoteSsrc:{get:function(){return C},set:function(e){C=e||[]},enumerable:!0,configurable:!1}}),c.sdpSemantics="unified-plan",c.bundlePolicy="max-compat",d=r.extraVideoChannels+(r.createDesktopPc?1:0)+1,c.iceCandidatePoolSize=1+d,t.debug("[RTCPeerConnectionsUnified]: Create RTCPeerConnection with config: ",c),l=new a.PeerConnection(c),(o=l).onnegotiationneeded=function(e,n){t.debug("[RTCPeerConnectionsUnified]: onnegotiationneeded"),E(e)?function(e){p(s.onnegotiationneeded,e)}(n):t.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection")}.bind(null,o),o.onicecandidate=function(e,n){t.debug("[RTCPeerConnectionsUnified]: onicecandidate: iceGatheringState = ",e.iceGatheringState),E(e)?(n.candidate||t.debug("[RTCPeerConnectionsUnified]: End of candidates"),function(e){p(s.onicecandidate,e)}(n)):t.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection")}.bind(null,o),o.onsignalingstatechange=function(e,n){t.debug("[RTCPeerConnectionsUnified]: onsignalingstatechange: signalingState = ",e.signalingState),E(e)?function(e){p(s.onsignalingstatechange,e)}(n):t.debug("[RTCPeerConnectionsUnified]:  Event is from old Peer Connection")}.bind(null,o),o.oniceconnectionstatechange=function(e,n){t.debug("[RTCPeerConnectionsUnified]: oniceconnectionstatechange: iceConnectionState = ",e.iceConnectionState),E(e)?function(e){p(s.oniceconnectionstatechange,e)}(n):t.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection.")}.bind(null,o),o.ontrack=function(e,n){if(t.debug("[RTCPeerConnectionsUnified]: ontrack:",n.track&&n.track.label),E(e)){if(n.track){var i=null,r=l.getTransceivers();if(r.some(function(e){return!(!e.receiver||!T(e.receiver.track,n.track)||(i=e.mid,0))}),i){var o=new a.MediaStream([n.track]);o.mid=i,t.debug("[RTCPeerConnectionsUnified]: ontrack: mid: ",i),function(e){p(s.onaddstream,e)}({stream:o})}else t.error("[RTCPeerConnectionsUnified]: ontrack: Could not find the mid attribute. This remote track won't be played: ",n.track.label)}}else t.debug("[RTCPeerConnectionsUnified]: Event is from old Peer Connection.")}.bind(null,o)},e}((e=function(t){"use strict";var n=t.logger,i=t.sdpParser,r=t.Utils;return t.RtcPeerConnections=function(o,a,s){var c=t.WebRTCAdapter,l="video_screen",d=this,u=r.shallowCopy(o),C=a,E={screenControlChannelName:"SCREEN_CONTROL",isScreenControlled:!!(s=s||{}).isScreenControlled,isScreenOwner:!!s.isScreenOwner},T=null,p=null,S=s.extraVideoChannels||0,I=[],f={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}},R=0,v="new";function A(e){e.onnegotiationneeded=function(e,t){n.debug("[RTCPeerConnections]: onnegotiationneeded"),_(e)?function(e){y(d.onnegotiationneeded,e)}(t):n.debug("[RTCPeerConnections]: Event is from old Peer Connection")}.bind(null,e),e.onicecandidate=function(e,t){if(n.debug("[RTCPeerConnections]: onicecandidate: iceGatheringState = ",e.iceGatheringState),_(e)){if(t.candidate){if(e===p){var i=new c.IceCandidate({sdpMLineIndex:O()-1,sdpMid:t.candidate.sdpMid,candidate:t.candidate.candidate});t={candidate:i}}else if(e!==T){var r=I.indexOf(e);if(r>=0){var o=new c.IceCandidate({sdpMLineIndex:t.candidate.sdpMLineIndex+r+2,sdpMid:t.candidate.sdpMid,candidate:t.candidate.candidate});t={candidate:o}}}}else{if(++R<O())return;n.debug("[RTCPeerConnections]: End of candidates - all peer connections"),R=0}!function(e){y(d.onicecandidate,e)}(t)}else n.debug("[RTCPeerConnections]: Event is from old Peer Connection")}.bind(null,e),e.onsignalingstatechange=function(e,t){n.debug("[RTCPeerConnections]: onsignalingstatechange: signalingState = ",e.signalingState),_(e)?function(e){y(d.onsignalingstatechange,e)}(t):n.debug("[RTCPeerConnections]: Event is from old Peer Connection")}.bind(null,e),e.onaddstream=function(e,t){n.debug("[RTCPeerConnections]: onaddstream"),_(e)?function(e){y(d.onaddstream,e)}(t):n.debug("[RTCPeerConnections]: Event is from old Peer Connection")}.bind(null,e),e.onremovestream=function(e,t){n.debug("[RTCPeerConnections]: onremovestream"),_(e)?function(e){y(d.onremovestream,e)}(t):n.debug("[RTCPeerConnections]: Event is from old Peer Connection")}.bind(null,e),e.oniceconnectionstatechange=function(e,t){if(_(e)){var i;i=e===T?"main":e===p?"desktop":"aux"+I.indexOf(e);var r=e.iceConnectionState;n.debug("[RTCPeerConnections]: oniceconnectionstatechange - "+i+": iceConnectionState = ",r),e===T&&v!==r&&(v=r,function(e){y(d.oniceconnectionstatechange,e)}(t))}else n.debug("[RTCPeerConnections]: oniceconnectionstatechange from old Peer Connection.")}.bind(null,e)}function g(e){e.onnegotiationneeded=null,e.onicecandidate=null,e.onsignalingstatechange=null,e.onaddstream=null,e.onremovestream=null,e.oniceconnectionstatechange=null,e.ondatachannel=null}function _(e){return!!e&&(e===T||e===p||I.includes(e))}function N(e){var t=T[e];if(!t||!t.type||!t.sdp)return null;if(0===S&&!p)return t;var n=i.parse(t.sdp);if(1===n.m.length&&"audio"===n.m[0].media&&"remoteDescription"!==e&&S>0&&i.addEmptyVideoLine(n),I.every(function(t){var r=t[e];if(!r||!r.type||!r.sdp)return!1;var o=i.parse(r.sdp);return(o=i.verifyFingerprintInMLines(o)).m.some(function(e){return"video"===e.media&&(n.m.push(e),!0)})}),p){var r=p[e];if(r&&r.type&&r.sdp){var o=i.parse(r.sdp);o.m&&o.m.length&&(o=i.verifyFingerprintInMLines(o),n.m.push(o.m[0]))}}return new c.SessionDescription({type:t.type,sdp:i.stringify(n)})}function m(){T.createdLocalSdp=null,I.forEach(function(e){e.createdLocalSdp=null})}function h(e){return"pranswer"===e.type&&(e.type="answer"),e}function O(){return(T?1:0)+I.length+(p?1:0)}function D(e){var t;return p&&e.some(function(n,i){return n.a.some(function(r){return"mid"===r.field&&r.value===l&&(t=n,e.splice(i,1),!0)})}),t}function y(e,t){if("function"==typeof e)try{e(t)}catch(e){n.error(e)}}this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(e,t,r){var o=0,a=O(),s=null;function d(r,d){if(o++,n.debug("[RTCPeerConnections]: createOffer, count: ",o),r.createdLocalSdp=function(e,t,n){var r=i.parse(e.sdp),o=n===p;if(o||p||n.getLocalStreams().some(function(e){return e&&e.isScreen})&&(o=!0),o||S){var a=o?l:"video_"+(t-1);r.m.forEach(function(e){if("video"===e.media)for(var t=0,n=e.a.length;t<n;t++)if("mid"===e.a[t].field){e.a[t].value=a;break}})}return new c.SessionDescription({type:e.type,sdp:i.stringify(r)})}(d,o,r),o>=a){if(s)t(s);else{var u=N("createdLocalSdp");e(u)}m()}}function u(e){s||(s=e),++o>=a&&t(s)}T.createOffer(d.bind(null,T),u,r),I.forEach(function(e){e.createOffer(d.bind(null,e),u,f)}),p&&p.createOffer(d.bind(null,p),u,f)},this.createAnswer=function(e,t,i){var r=0,o=O(),a=null;function s(i,s){if(r++,n.debug("[RTCPeerConnections]: createAnswer, count: ",r),i.createdLocalSdp=s,r>=o){if(a)t(a);else{var c=N("createdLocalSdp");e(c)}m()}}function c(e){a||(a=e),++r>=o&&t(a)}T.createAnswer(s.bind(null,T),c),I.forEach(function(e){e.remoteDescription?e.createAnswer(s.bind(null,e),c,i):r++}),p&&p.createAnswer(s.bind(null,p),c,i)},this.setMainMediaLines=function(e,t){t.m=e.splice(0,2),e.some(function(i,r){return"application"===i.media&&(n.info("[RTCPeerConnections]: Adding application media line to main SDP"),t.m.push(i),e.splice(r,1),!0)})},this.setLocalDescription=function(e,t,r){var o=0,a=O(),s=null;function l(){o++,n.debug("[RTCPeerConnections]: setLocalDescription onLocalSdpApplied, count: ",o),o>=a&&(s?r(s):t())}function d(e){o++,n.error("[RTCPeerConnections]: setLocalDescription error, count: "+o+"\n",e),s||(s=e),o>=a&&r(s)}var u=i.parse(e.sdp),C=u.m,E=D(C);this.setMainMediaLines(C,u),"answer"===e.type&&(i.parse(T.remoteDescription.sdp).m.some(function(e){return"video"===e.media})||(n.info("[RTCPeerConnections]: Remote sdp offer has no video"),u.m=u.m.filter(function(e){return"video"!==e.media})));var S=new c.SessionDescription({type:e.type,sdp:i.stringify(u)});T.setLocalDescription(S,l,d),I.forEach(function(t){if(!C.length)return o++,void n.warning("[RTCPeerConnections]: Missing sdp mline for peer connection: ",o);u.m=C.splice(0,1),S=new c.SessionDescription({type:e.type,sdp:i.stringify(u)}),t.setLocalDescription(S,l,d)}),p&&(u.m=E?[E]:C.splice(0,1),S=new c.SessionDescription({type:e.type,sdp:i.stringify(u)}),p.setLocalDescription(S,l,d))},this.setRemoteDescription=function(e,t,r){var o=0,a=O(),s=null;function l(){o++,n.debug("[RTCPeerConnections]: setRemoteDescription onRemoteSdpApplied, count: ",o),o>=a&&(s?r(s):t())}function d(e){s||(s=e),++o>=a&&r(s)}var u=i.parse(e.sdp),C=u.m,E=D(C);this.setMainMediaLines(C,u);var S=new c.SessionDescription({type:e.type,sdp:i.stringify(u)});S=h(S),T.setRemoteDescription(S,l.bind(null,T),d),I.forEach(function(t){if(!C.length)return o++,void n.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+o);u.m=C.splice(0,1),S=h(S=new c.SessionDescription({type:e.type,sdp:i.stringify(u)})),t.setRemoteDescription(S,l.bind(null,t),d)}),e.screen&&p?(u.m=E?[E]:[e.screen],S=new c.SessionDescription({type:e.type,sdp:i.stringify(u)}),p.setRemoteDescription(S,l,d)):(p=null,o++)},this.removeStream=function(e){T.removeStream(e),p&&p.removeStream(e)},this.addStream=function(e){return e&&e.isScreen&&p?p.addStream(e):T.addStream(e)},this.getLocalStreams=function(){var e=T.getLocalStreams();return p&&Array.prototype.push.apply(e,p.getLocalStreams()),e},this.getRemoteStreams=function(){var e=T.getRemoteStreams().slice(0);return I.forEach(function(t){e.push.apply(e,t.getRemoteStreams())}),p&&Array.prototype.push.apply(e,p.getRemoteStreams()),e},this.addIceCandidate=function(e){if(!e)return T.addIceCandidate(),p&&p.addIceCandidate(),void I.forEach(function(e){e.addIceCandidate()});if(e.sdpMid===l&&p)return p.addIceCandidate(new c.IceCandidate(e)),void(e.sdpMLineIndex=0);if(e.sdpMLineIndex<=1)T.addIceCandidate(new c.IceCandidate(e));else{var t=e.sdpMLineIndex-2;I[t]&&(e.sdpMLineIndex=0,I[t].addIceCandidate(new c.IceCandidate(e)))}},this.close=function(){T.close(),g(T),p&&(p.close(),g(p)),I.forEach(function(e){e.close(),g(e)})},this.createDTMFSender=function(e){return T.createDTMFSender(e)},this.sendDataMessage=function(e){return!!T.sendDataMessage&&T.sendDataMessage(e)},this.getScreenShareMediaId=function(){return l},Object.defineProperties(this,{localDescription:{get:function(){return N("localDescription")},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return N("remoteDescription")},enumerable:!0,configurable:!1},signalingState:{get:function(){return T.signalingState},enumerable:!0,configurable:!!e.isUnitTestRun},iceConnectionState:{get:function(){return S>0?v:T.iceConnectionState},enumerable:!0,configurable:!1},mainPeerConnection:{get:function(){return T},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return I},enumerable:!0,configurable:!1},desktopPeerConnection:{get:function(){return p},enumerable:!0,configurable:!1}}),u.sdpSemantics="plan-b",u.iceCandidatePoolSize=2,n.debug("[RTCPeerConnections]: Create RTCPeerConnection with config: ",u),A(T=new c.PeerConnection(u,C,E)),n.debug("[RTCPeerConnections]: Created main audio/video RTCPeerConnection"),c.groupPeerConnectionsSupported&&function(){for(var e=0;e<S;e++)try{u.iceCandidatePoolSize=1;var t=new c.PeerConnection(u,C);I.push(t),A(t),n.debug("[RTCPeerConnections]: Created aux video PeerConnection")}catch(e){n.error("[RTCPeerConnections]:  Failed to create aux video PeerConnection.",e)}}(),s.createDesktopPc&&(u.iceCandidatePoolSize=1,A(p=new c.PeerConnection(u,a)),n.debug("[RTCPeerConnections]: Created screenshare peer connection"))},t}((e=function(t){"use strict";var r,o=t.logger,a=e.isElectron&&require("electron").ipcRenderer,s={ordered:!1,maxRetransmitTime:1e3,negotiated:!1,id:0};void 0!==n.Promise&&(r=n.Promise);var c={VIDEO_1080:"1080p",VIDEO_720:"720p",VIDEO_480:"480p"},l=function(e){if(e)try{e.oninactive=null;var t=e.getAudioTracks().concat(e.getVideoTracks());t.length&&t[0].stop?t.forEach(function(e){e.stop()}):e.stop&&e.stop(),o.info("[WebRTCAdapter]: Media stream has been stopped. Stream ID:",e.id)}catch(e){o.error("[WebRTCAdapter]: Failed to stop media stream. ",e)}},d=function(e){if(e)try{var t=e.getVideoTracks();t?t.forEach(function(e){e.stop&&"video"===e.kind&&!e.remote&&e.stop()}):o.info("[WebRTCAdapter]: No video tracks to be changed")}catch(e){o.error("[WebRTCAdapter]: Failed to disable local video tracks. ",e)}},u=function(e){try{e.close(),o.debug("[WebRTCAdapter]: RTCPeerConnection has been closed")}catch(e){o.error(e)}},C=function(){return!!i.mediaDevices&&"function"==typeof i.mediaDevices.enumerateDevices&&"undefined"!=typeof HTMLMediaElement&&"function"==typeof HTMLMediaElement.prototype.setSinkId},E=[],T=null,p=null,S=function(){T&&(n.clearTimeout(T),T=null)},I=function(t){if("function"==typeof t){var r,a,s;if(o.debug("[WebRTCAdapter]: Get audio output, microphone and camera devices"),!i.mediaDevices||!i.mediaDevices.enumerateDevices)return r=[{kind:"audio",id:"default",label:"",facing:""}],s=[{kind:"video",id:"default",label:"",facing:""}],void n.setTimeout(function(){t(r,s,null)},0);if(E.length>0)return o.debug("[WebRTCAdapter]: There is a pending MediaDevices.enumerateDevices() request"),void E.push(t);if(p&&p.validTimestamp>Date.now())return o.debug("[WebRTCAdapter]: Return cached devices"),r=p.audioSources,a=p.audioOutputs,s=p.videoSources,void n.setTimeout(function(){t(r,s,a)},0);E.push(t),o.debug("[WebRTCAdapter]: Invoke MediaDevices.enumerateDevices()");var c=function(e,t,n){S();var i=E;E=[],i.forEach(function(i){try{i(e||[],t||[],n||null)}catch(e){}})};S(),T=n.setTimeout(function(){T=null,E.length&&(p?(o.error("[WebRTCAdapter]: MediaDevices.enumerateDevices timed out. Return cached devices."),r=p.audioSources,a=p.audioOutputs,s=p.videoSources):o.error("[WebRTCAdapter]: MediaDevices.enumerateDevices timed out. Device cache is empty, no devices available!"),c(r,s,a),c=null)},3e3),i.mediaDevices.enumerateDevices().then(function(t){t=t||[],r=[],a=[],s=[],o.info("[WebRTCAdapter]: MediaDevices.enumerateDevices returned "+t.length+" device(s)"),t.forEach(function(t){var n={id:t.deviceId,groupId:t.groupId,kind:t.kind,label:t.label};if(n.label){var i=n.label.match(/(.*)\s\(.*\:.*\)/);n.label=i&&i[1]||n.label}switch(e.isElectron&&("default"!==n.id||n.label||(n.label="res_DefaultDeviceLabel")),n.kind){case"audioinput":r.push(n);break;case"audiooutput":a.push(n);break;case"videoinput":s.push(n)}}),0!==a.length&&C()||(a=null),o.debug("[WebRTCAdapter]: Update DeviceInfos cache"),p={audioSources:r,audioOutputs:a,videoSources:s},r.length?!r.some(function(e){return e.label})||s.length&&!s.some(function(e){return e.label})?(o.debug("[WebRTCAdapter]: User hasn't authorized access to audio and/or video input devices yet"),p.validTimestamp=0):p.validTimestamp=Date.now()+6e4:p.validTimestamp=0,c&&c(r,s,a)}).catch(function(e){o.error("[WebRTCAdapter]: Failed to enumerate devices. ",e),c&&c()})}},f=function(){o.debug("[WebRTCAdapter]: Cleared device info cache"),p=null},R=function(e){if(e&&e.iceServers){var t=[];e.iceServers.forEach(function(e){e.url?t.push(e):e.urls&&e.urls.forEach(function(n){t.push({url:n,credential:e.credential,username:e.username})})}),e.iceServers=t}},v=function(e){return{optional:[{echoCancellation:!0},{googEchoCancellation:!0},{googEchoCancellation2:!0},{autoGainControl:!!(e=e||{}).enableAudioAGC},{googAutoGainControl:!!e.enableAudioAGC},{googAutoGainControl2:!!e.enableAudioAGC},{noiseSuppression:!0},{googNoiseSuppression:!0},{googNoiseSuppression2:!0},{googHighpassFilter:!0}]}},A=function(e){if(e&&e.videoResolution){var t={aspectRatio:{min:1.77,max:1.78},frameRate:{min:30,max:30}};switch(e.videoResolution){case c.VIDEO_1080:t.width={min:1920},t.height={min:1080};break;case c.VIDEO_720:t.width={min:1280},t.height={min:720}}return t}return{aspectRatio:{min:1.77,max:1.78}}},g=function(e){var t={mandatory:{minAspectRatio:1.77,maxAspectRatio:1.78},optional:[{googNoiseReduction:!0}]};if(e&&e.videoResolution)switch(t.mandatory.minFrameRate=30,t.mandatory.maxFrameRate=30,e.videoResolution){case c.VIDEO_1080:t.mandatory.minWidth=1920,t.mandatory.maxWidth=1920,t.mandatory.minHeight=1080,t.mandatory.maxHeight=1080;break;case c.VIDEO_720:t.mandatory.minWidth=1280,t.mandatory.maxWidth=1280,t.mandatory.minHeight=720,t.mandatory.maxHeight=720;break;case c.VIDEO_480:t.mandatory.minWidth=854,t.mandatory.maxWidth=854,t.mandatory.minHeight=480,t.mandatory.maxHeight=480}return t},_=function(e,t){var n=e&&e.getAudioTracks();return!(!n||!n[0])&&(n[0].enabled=!!t,!0)},N=function(e,i,r){if(r=r||function(){},o.debug("[WebRTCAdapter]: Attach sinkId to audio element"),e)return i&&i.length?void(void 0!==e.sinkId&&t.WebRTCAdapter?(o.debug("[WebRTCAdapter]: Get media sources to find available device"),t.WebRTCAdapter.getMediaSources(function(a,s,c){var l=t.Utils.selectMediaDevice(c,i),d=l&&l.id||"";if(o.debug("[WebRTCAdapter]: Found audio output device to attach as sinkId. deviceId = ",d||"NONE"),e.sinkId===d)return o.debug("[WebRTCAdapter]: Audio output device is already attached to element"),void r();d||o.warn("[WebRTCAdapter]: A previously selected output device could not be found. Fallback to browser's default. Device not found: ",e.sinkId);var u=n.setTimeout(function(){u=null,o.error("[WebRTCAdapter]: Timed out attaching audio output device: ",d||"<default>"),r("timed out")},3e3);e.setSinkId(d).then(function(){u&&(n.clearTimeout(u),o.debug("[WebRTCAdapter]: Success, audio output device attached: ",d||"<default>"),r())}).catch(function(e){if(u){n.clearTimeout(u);var t=(e=e||{}).message||"unknown error";"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device."),o.error("[WebRTCAdapter]: Failed to attach output device. Device Id:"+d+" - ",t),r(t)}}),o.debug("[WebRTCAdapter]: setSinkId has been invoked")})):r("setSinkId not available")):(o.debug("[WebRTCAdapter]: There is no audio output device selected"),void r());r("Invalid parameters")},m=function(e){var t={offerToReceiveAudio:1,offerToReceiveVideo:1};return e&&(e.mandatory&&(e.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(t.offerToReceiveAudio=e.mandatory.OfferToReceiveAudio?1:0),e.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(t.offerToReceiveVideo=e.mandatory.OfferToReceiveVideo?1:0)),e.optional&&e.optional.some(function(e){return!!e.hasOwnProperty("VoiceActivityDetection")&&(t.voiceActivityDetection=!!e.VoiceActivityDetection,!0)})),t},h=function(e,t,n,i,r){var a=function(a){var s=function(e,t,n,i){if(!e||!e[t])return e;var r=e[t];if(r.mandatory){var o=r.mandatory[n];if(o){var a=(e=Object.create(e))[t];a.optional=a.optional||[];var s={};s[n]=o,a.optional.push(s),delete a.mandatory}}else{var c=r[i];c&&c.exact&&((e=Object.create(e))[t][i]=c.exact)}return e}(n,"audio","sourceId","deviceId");if(s!==n){o.warn("[WebRTCAdapter]: First getUserMedia attempt with required audio sourceId/deviceId failed. Falling back to optional.");var c=function(e){i(e,a)},l=e.apply(t,[s,c,r]);l&&l.then&&l.then(c).catch(r)}else r&&r(a)},s=e.apply(t,[n,i,a]);s&&s.then&&s.then(i).catch(a)},O=function(t,i,r,a,s){var c=null,d=e.isElectron?1:3,u=0;function C(e){o.warn("[WebRTCAdapter]: Get user media failed: ",e&&e.name||e),c&&n.clearTimeout(c),c=null,s&&s(e),a=null,s=null}!function e(){o.info("[WebRTCAdapter]: Get user media attempt #:",u),c=null,u!==d?(++u,h(t,i,r,function(e,t){!function(e,t){o.info("[WebRTCAdapter]: Get user media succeeded"),a?a(e,t):l(e),a=null,s=null}(e,t),c&&n.clearTimeout(c),c=null},C),c=n.setTimeout(e,1e4)):C("Timeout")}()},D=function(e,t){var n;if(o.info("[WebRTCAdapter]: Destroying Data Channel (error: %s)",t&&t.message||t),e){n=e.label;try{e.close()}catch(t){o.info("[WebRTCAdapter]: Could not close the existing data channel")}e.onmessage=null,e.onopen=null,e.onclose=null,e.onerror=null}e=null,a&&a.send("remove-listeners",n)},y=function(e){if(a&&this&&"open"===this.readyState){var t=JSON.parse(e.data);this.label.startsWith("SCREEN_CONTROL")?(t.dataChannelName=this.label,t.keysToOmitFromLogging=["key","keyCode"],o.debug("[WebRTCAdapter]: Sending controlling data to main process: ",t),a.send("screen-control-data",t)):o.warn("[WebRTCAdapter]: Received message for data channel "+this.label+" that cannot be handled")}else o.error("[WebRTCAdapter]: Cannot handle the received message. Data Channel has not been opened yet.")},P=function(e,t){e?(e.binaryType="arraybuffer","number"==typeof e.bufferedAmountLowThreshold&&(e.bufferedAmountLowThreshold=65536),e.onopen=function(){"open"===e.readyState?(o.info("[WebRTCAdapter]: Data channel has been successfully opened."),t&&a&&a.send("register-listeners",e.label)):o.warn("[WebRTCAdapter]: Data channel has not been opened yet.")},t&&(e.onmessage=y),e.onclose=function(){D(e)},e.onerror=function(t){D(e,t)}):D(e,new Error("Data channel event is missing `channel` property"))},b=function(e,t){if(e&&t&&t.isScreenControlled)if(o.info("[WebRTCAdapter]: Data channel will be created for supporting screen control"),t.isScreenOwner){var n=(new Date).toISOString(),i=t.screenControlChannelName+"_"+n,r=e.createDataChannel(i,s);P(r,!0),e.ondatachannel=null}else e.ondatachannel=function(e){P(e.channel,!1),this.dataChannel=e.channel,this.sendDataMessage=function(e){var t;return this.dataChannel&&"open"===this.dataChannel.readyState?e&&"object"==typeof e?(t=JSON.stringify(e),this.dataChannel.bufferedAmount+t.length<this.dataChannel.bufferedAmountLowThreshold?(e.keysToOmitFromLogging=["key","keyCode"],o.debug("[WebRTCAdapter]: Sending data over data channel: ",e),this.dataChannel.send(t),!0):(o.error("[WebRTCAdapter]: Cannot send data - Data channel buffer is full"),!1)):(o.error("[WebRTCAdapter]: Cannot send data - Data to send has incorrect format: ",typeof e),!1):(o.error("[WebRTCAdapter]: Cannot send data - Data channel either not created or not ready"),!1)}}.bind(e)};return function a(){var s=t.TemasysAdapter,c=t.Utils.getBrowserInfo();try{if(c.chrome)return o.info("Setting WebRTC APIs for Chrome"),RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},void(t.WebRTCAdapter={enabled:!0,browser:"chrome",unifiedPlanEnabled:!1,useNewConstraintSyntax:!1,MediaStream:webkitMediaStream,PeerConnection:function(e,t,n){var i=new webkitRTCPeerConnection(e,t);return i.origCreateOffer=i.createOffer,i.createOffer=function(e,t,n){var r;n&&(r=m(n)),i.origCreateOffer(r).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},i.origCreateAnswer=i.createAnswer,i.createAnswer=function(e,t,n){var r=m(n);i.origCreateAnswer(r).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},b(i,n),i},SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,getUserMedia:function(e,t,n){O(i.mediaDevices.getUserMedia,i.mediaDevices,e,t,n)},createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:l,stopLocalVideoTrack:d,closePc:u,getMediaSources:function(e){e&&I(e)},clearMediaSourcesCache:function(){f()},getAudioOptions:function(e){var t=v(e);return e&&e.sourceId&&"default"!==e.sourceId&&(t.mandatory=t.mandatory||{},t.mandatory.sourceId=e.sourceId),t},getVideoOptions:function(t){var n;return e.WebRTCAdapter.useNewConstraintSyntax?(n=A(t),t&&t.sourceId&&(n.deviceId={exact:t.sourceId})):(n=g(t),t&&t.sourceId&&n.optional.push({sourceId:t.sourceId})),n},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},audioOutputSelectionSupported:C(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:N,toggleAudio:_});if(c.firefox){o.info("Setting WebRTC APIs for Firefox");var E=function(e,n,i){var r="0"===i||"1"===i;switch(this.stats=e,this.id=e.id,e.type){case"inboundrtp":case"inbound-rtp":e.isRemote||(this.type="ssrc",this.stats.mid=i,"audio"===n?(this.stats.audioOutputLevel=!0,this.stats.googJitterReceived=e.jitter):this.stats.googFrameHeightReceived=!0,r&&(this.stats.googTrackId="audio"===n?"audio_main":"video_main"));break;case"outboundrtp":case"outbound-rtp":e.isRemote||(this.type="ssrc",this.stats.mid=i,"audio"===n?this.stats.audioInputLevel=!0:this.stats.googFrameHeightSent=!0,r&&(this.stats.googTrackId="audio"===n?"audio_main":"video_main"));break;case"candidatepair":case"candidate-pair":this.type="googCandidatePair","boolean"==typeof e.selected&&e.selected?(this.stats.googActiveConnection="true",t.WebRTCAdapter.unifiedPlanEnabled?this.stats.googChannelId=e.transportId:"audio"===n&&(this.stats.googChannelId="Channel-audio-1")):this.discard=!0;break;case"local-candidate":this.type="localcandidate";break;case"remote-candidate":this.type="remotecandidate";break;default:this.type=e.type}};E.prototype.names=function(){return Object.keys(this.stats)},E.prototype.stat=function(e){return this.stats[e]};var T=function(e,t,n){var i,r=[];return e.forEach(function(e){var o=new E(e,t,n);o.discard||("googCandidatePair"===o.type&&(i=o.stats.transportId),r.push(o))}),i&&r.some(function(e){return"ssrc"===e.type&&(e.stats.transportId=i,!0)}),r},p=parseInt(c.version,10)>=63,S="undefined"==typeof RTCPeerConnection?mozRTCPeerConnection:RTCPeerConnection,D="undefined"==typeof RTCSessionDescription?mozRTCSessionDescription:RTCSessionDescription,y="undefined"==typeof RTCIceCandidate?mozRTCIceCandidate:RTCIceCandidate;return void(t.WebRTCAdapter={enabled:!0,browser:"firefox",unifiedPlanEnabled:p,MediaStream:MediaStream,PeerConnection:function(e,t,n){var i=new S(e);return i.origCreateOffer=i.createOffer,i.createOffer=function(e,t,n){var r;p||(r=m(n)),i.origCreateOffer(r).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},i.origCreateAnswer=i.createAnswer,i.createAnswer=function(e,t,n){p||m(n),i.origCreateAnswer(void 0).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},i.origGetStats=i.getStats,i.getStats=function(e,t){"function"==typeof e&&function(e,t,n){var i=[],a=e.getTransceivers(),s=[];a.forEach(function(e){e.receiver&&e.receiver.track?s.push(new r(function(t){e.receiver.getStats().then(function(n){var r=T(n,e.receiver.track.kind,e.mid);e.sender&&e.sender.track?e.sender.getStats().then(function(n){var o,a=T(n,e.sender.track.kind,e.mid);o=a,r.some(function(e){return"ssrc"===e.type&&(e.stats.transportId&&o.some(function(t){return"ssrc"===t.type&&(t.stats.transportId=e.stats.transportId,!0)}),!0)}),Array.prototype.push.apply(i,r),Array.prototype.push.apply(i,a),t()}).catch(function(n){o.debug("[WebRTCAdapter]: Error collecting stats for track: "+e.sender.track.label+" . Error: ",n),Array.prototype.push.apply(i,r),t()}):(Array.prototype.push.apply(i,r),t())}).catch(function(n){o.debug("[WebRTCAdapter]: Error collecting stats for track: "+e.sender.track.label+" . Error: ",n),t()})})):e.sender&&e.sender.track&&s.push(new r(function(t){e.sender.getStats().then(function(n){Array.prototype.push.apply(i,T(n,e.sender.track.kind,e.mid)),t()}).catch(function(n){o.debug("[WebRTCAdapter]: Error collecting stats for track: "+e.sender.track.label+" . Error: ",n),t()})}))}),r.all(s).then(function(){t(i)}).catch(function(e){o.error("[WebRTCAdapter]: Unexpected error collecting stats:",e),n&&n(e)})}(i,e,t)},i.removeStream=function(){},i.createDTMFSender=function(e){if("function"!=typeof i.getSenders)return null;var t=i.getSenders().find(function(t){return t.track===e}),n=t&&t.dtmf;return n?(n.canInsertDTMF=!0,n):null},i.addStream=function(e){var t=e.getAudioTracks()[0];t&&i.addTrack(t,e);var n=e.getVideoTracks()[0];n&&i.addTrack(n,e)},i.getRemoteStreams=function(){var e=[];return i.getReceivers().forEach(function(t){if(t.track&&t.track.mid){var n=new MediaStream([t.track]);e.push(n)}}),e},i.getLocalStreams=function(){var e=[];return i.getSenders().forEach(function(t){if(t.track){var n=new MediaStream([t.track]);e.push(n)}}),e},parseInt(c.version,10)>=46&&Object.defineProperty(i,"onaddstream",{enumerable:!0,get:function(){return i.onaddstreamCb},set:function(e){i.onaddstreamCb=e,i.ontrack=e?function(t){var n=t&&t.transceiver&&t.transceiver.mid;n&&t.track&&(t.track.mid=n),e({stream:t&&t.streams&&t.streams[0]})}:null}.bind(i)}),b(i,n),i},SessionDescription:D,IceCandidate:y,getUserMedia:function(e,t,n){O(i.mediaDevices.getUserMedia,i.mediaDevices,e,t,n)},createObjectURL:function(e){return URL.createObjectURL(e)},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+(t.mid||t.id):""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+(t.mid||t.id):""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.mid||t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.mid||t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:l,stopLocalVideoTrack:d,closePc:function(e){n.setTimeout(function(){u(e)},500)},getMediaSources:function(e){e&&I(e)},clearMediaSourcesCache:function(){f()},getAudioOptions:function(e){var t=v(e);return e&&e.sourceId&&(t.deviceId={exact:e.sourceId}),t.advanced=t.optional,delete t.optional,t},getVideoOptions:function(e){var t=g(e);return e&&e.sourceId&&(t.deviceId=e.sourceId),t.advanced=t.optional,delete t.optional,t},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return n.min=n.min||5,n.max=n.max||10,{mozMediaSource:e||"screen",mediaSource:e||"screen",width:{max:2560},height:{max:1600},advanced:[{frameRate:n}]}},audioOutputSelectionSupported:C(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:N,iceTimeoutSafetyFactor:.5,toggleAudio:_})}if(c.ios){o.info("Setting WebRTC APIs for iOS client");var P=function(e){this.id=e.id,this.type=e.type,this.timestamp=new Date(e.timestamp);var t={};Object.getOwnPropertyNames(e.values).forEach(function(n){t[n]=e.values[n]}),this.names=function(){return Object.getOwnPropertyNames(t)},this.stat=function(e){return t[e]},e=null},U=function(e){var t=e.map(function(e){return new P(e)});this.result=function(){return t},e=null};return void(t.WebRTCAdapter={enabled:!0,browser:"ios",unifiedPlanEnabled:!1,MediaStream:function(e){return i.createMediaStreamWithTracks(e)},PeerConnection:function(e,t){R(e);var n=RTCPeerConnection.createRTCPeerConnection(e,t);return n.origGetStats=n.getStats,n.getStats=function(e){"function"==typeof e&&n.origGetStats(function(t){e(new U(t))})},n.addIceCandidate=n.addIceCandidateJS,Object.defineProperties(n,{localDescription:{get:function(){return n.getLocalDescriptionJS()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return n.getRemoteDescriptionJS()},enumerable:!0,configurable:!1},signalingState:{get:function(){return n.getSignalingStateJS()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return n.getIceConnectionStateJS()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return n.getIceGatheringStateJS()},enumerable:!0,configurable:!1}}),n},SessionDescription:function(e){return RTCSessionDescription.createRTCSessionDescription(e)},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:i.getUserMedia.bind(i),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.streamId+" "+t.trackId:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.streamId+" "+t.trackId:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.trackId:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.trackId:""},getStreamId:function(e){return e&&e.streamId},getTrackId:function(e){return e&&e.trackId},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:l,stopLocalVideoTrack:d,closePc:u,getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:v,getVideoOptions:g,getDesktopOptions:function(){return{mandatory:{iOSMediaSource:"desktop"}}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:N,toggleAudio:_})}if(c.android){o.info("Setting WebRTC APIs for Android client");var L=function(e){this.id=e.id,this.type=e.type,this.timestamp=new Date(e.timestamp);var t={};Object.getOwnPropertyNames(e.values).forEach(function(n){var i=e.values[n];i.name&&(t[i.name]=i.value)}),this.names=function(){return Object.getOwnPropertyNames(t)},this.stat=function(e){return t[e]},e=null},M=function(e){var t=e.map(function(e){return new L(e)});this.result=function(){return t},e=null},w=RTCPeerConnection.bind(RTCPeerConnection);return void(t.WebRTCAdapter={enabled:!0,browser:"android",unifiedPlanEnabled:!1,PeerConnection:function(e,t){R(e);var n=w(e,t);return n.getStats=function(e){"function"==typeof e&&n.origGetStats(function(t){e(new M(t.data))})},n},SessionDescription:function(e){return{type:e.type,sdp:e.sdp}},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:i.getUserMedia.bind(i),createObjectURL:function(){return"dummy"},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:l,stopLocalVideoTrack:d,closePc:u,getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:v,getVideoOptions:g,getDesktopOptions:function(){return{mandatory:{androidMediaSource:"screen"}}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:N,toggleAudio:_})}if(c.dotnet)return o.info("Setting WebRTC APIs for .NET client"),void(t.WebRTCAdapter={enabled:!0,browser:"dotnet",unifiedPlanEnabled:!1,PeerConnection:function(e,t){R(e);var n=new RTCPeerConnection(e,t);return n.origGetStats=n.getStats,n.getStats=function(e){"function"==typeof e&&e()},Object.defineProperties(n,{localDescription:{get:function(){return n.getLocalDescription()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return n.getRemoteDescription()},enumerable:!0,configurable:!1},signalingState:{get:function(){return n.getSignalingState()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return n.getIceConnectionState()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return n.getIceGatheringState()},enumerable:!0,configurable:!1}}),n},SessionDescription:function(e){return{type:e.type,sdp:e.sdp}},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:function(e,t,n){var r={audioEnabled:!(!e||!e.audio),videoEnabled:!(!e||!e.video)};return i.getUserMedia(r,t,n)},createObjectURL:function(e){return e.id},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks();return t&&t.length?e.id+" "+t[0].id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks();return t&&t.length?e.id+" "+t[0].id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks();return t&&t.length?t[0].id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks();return t&&t.length?t[0].id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks();return t&&t.length?t[0].label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks();return t&&t.length?t[0].label:""},stopMediaStream:l,stopLocalVideoTrack:d,closePc:u,getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:function(e){var t=v(e);return e&&e.sourceId&&(t.mandatory=t.mandatory||{},t.mandatory.sourceId=e.sourceId),t},getVideoOptions:function(e){var t=g(e);return e&&e.sourceId&&t.optional.push({sourceId:e.sourceId}),t},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},audioOutputSelectionSupported:C(),groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:N,toggleAudio:_});if(c.cordovaios)return o.info("Setting WebRTC APIs for Cordova iOS"),cordova.plugins.iosrtc.RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},cordova.plugins.iosrtc.RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},void(t.WebRTCAdapter={enabled:!0,browser:"cordovaios",unifiedPlanEnabled:!1,MediaStream:cordova.plugins.iosrtc.MediaStream,PeerConnection:function(e,t){var n=new cordova.plugins.iosrtc.RTCPeerConnection(e,t);return n.origCreateOffer=n.createOffer,n.createOffer=function(e,t,i){var r=m(i);n.origCreateOffer(r).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},n.origCreateAnswer=n.createAnswer,n.createAnswer=function(e,t,i){var r=m(i);n.origCreateAnswer(r).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},n.origGetStats=n.getStats,n.getStats=function(e,t){"function"==typeof e&&n.origGetStats().then(e,t)},n},SessionDescription:cordova.plugins.iosrtc.RTCSessionDescription,IceCandidate:cordova.plugins.iosrtc.RTCIceCandidate,getUserMedia:cordova.plugins.iosrtc.getUserMedia.bind(cordova.plugins.iosrtc),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:l,stopLocalVideoTrack:d,closePc:u,getMediaSources:function(e){e&&I(e)},clearMediaSourcesCache:function(){f()},getAudioOptions:function(e){var t=v(e);return e&&e.sourceId&&t.optional.push({sourceId:e.sourceId}),t},getVideoOptions:function(e){var t=g(e);return e&&e.sourceId&&t.optional.push({sourceId:e.sourceId}),t},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},audioOutputSelectionSupported:C(),groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:N,toggleAudio:_});if(s)return o.info("Setting WebRTC APIs for IE with Temasys plugin"),void(t.WebRTCAdapter={enabled:!0,browser:"msie",unifiedPlanEnabled:!1,PeerConnection:function(e,t,n){R(e);var i=s.PeerConnection(e,t);return b(i,n),i},SessionDescription:s.SessionDescription,IceCandidate:s.IceCandidate,getUserMedia:function(e,t,n){h(s.getUserMedia,s,e,t,n)},createObjectURL:function(e,t,n){return s.createObjectURL(e,n)},attachMediaStream:s.attachMediaStream,getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.label+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.label+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:l,stopLocalVideoTrack:d,closePc:u,getMediaSources:function(e){"function"==typeof e&&s.getMediaSources(function(t){var n=[],i=[];t&&t.forEach(function(e){"audio"===e.kind?n.push(e):"video"===e.kind&&i.push(e)}),e(n,i,null)})},clearMediaSourcesCache:function(){},getAudioOptions:function(e){return!e||!e.sourceId||{mandatory:{sourceId:e.sourceId}}},getVideoOptions:function(e){return!e||!e.sourceId||{optional:[{sourceId:e.sourceId}]}},getDesktopOptions:function(){return{optional:[{sourceId:s.screensharingKey()}]}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:N,toggleAudio:_});if(c.edge){o.info("Setting WebRTC APIs for Edge");var G=t.sdpParser;return void(t.WebRTCAdapter={enabled:!1,browser:"edge",unifiedPlanEnabled:!1,PeerConnection:function(e){if((e=e||{}).iceServers){var n=(e=t.Utils.shallowCopy(e)).iceServers[0];n&&(e.iceServers[0]={urls:n.urls.filter(function(e){return!e.startsWith("turns:")}),username:n.username,credential:n.credential})}var i=new RTCPeerConnection(e);return i.originalSetRemoteDescription=i.setRemoteDescription,i.setRemoteDescription=function(e,t,n){var r=G.parse(e.sdp);(function(e){return e.m.some(function(e){return!e.a.some(function(e){return"fingerprint"===e.field})})})(r)&&(function(e){for(var t=[],n=e.a.length-1;n>=0;n--){var i=e.a[n];switch(i.field){case"ice-ufrag":case"ice-pwd":case"fingerprint":case"setup":t.push(i)}}e.m.forEach(function(e){Array.prototype.push.apply(e.a,t)})}(r),e=new RTCSessionDescription({type:e.type,sdp:G.stringify(r)})),i.originalSetRemoteDescription(e,t,n)},["createOffer","createAnswer"].forEach(function(e){var n="original"+e;i[n]=i[e],i[e]=function(e,r,o){return o&&o.mandatory&&(o=t.Utils.shallowCopy(o),Object.keys(o.mandatory).forEach(function(e){var t;switch(e){case"OfferToReceiveAudio":t="offerToReceiveAudio";break;case"OfferToReceiveVideo":t="offerToReceiveVideo";break;default:t=e}o[t]=o.mandatory[e]}),delete o.mandatory),i[n](e,r,o)}}),i},SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,attachMediaStream:function(e,t){e.autoplay=!0,e.srcObject=t},getUserMedia:function(e,t,n){e&&e.video&&"screen"===e.video.mediaSource?i.getDisplayMedia({video:!0}).then(t).catch(n):O(i.mediaDevices.getUserMedia,i.mediaDevices,e,t,n)},createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},getStreamId:function(e){return e&&e.id},getTrackId:function(e){return e&&e.id},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:l,stopLocalVideoTrack:d,closePc:u,getMediaSources:function(e){e&&I(e)},clearMediaSourcesCache:function(){f()},getAudioOptions:function(e){var t=v(e);return e&&e.sourceId&&(t.deviceId={exact:e.sourceId}),t.advanced=t.optional,delete t.optional,t},getVideoOptions:function(e){var t=g(e);return e&&e.sourceId&&(t.deviceId=e.sourceId),t.advanced=t.optional,delete t.optional,!0},getDesktopOptions:function(){return{mediaSource:"screen"}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:N,toggleAudio:_})}o.info("WebRTC is not supported")}catch(e){o.error("Failed to initialize WebRTCAdapter. ",e)}t.WebRTCAdapter={enabled:!1,browser:"",unifiedPlanEnabled:!1,PeerConnection:function(){},SessionDescription:function(){},IceCandidate:function(){},getUserMedia:function(e,t,n){n&&n("Not supported")},createObjectURL:function(){return""},getAudioStreamTrackId:function(){return""},getVideoStreamTrackId:function(){return""},getAudioTrackId:function(){return""},getVideoTrackId:function(){return""},getStreamId:function(){return""},getTrackId:function(){return""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(){return""},getVideoTrackLabel:function(){return""},stopMediaStream:function(){},stopLocalVideoTrack:function(){},closePc:function(){},getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:function(){return!1},getVideoOptions:function(){return!1},getDesktopOptions:function(){return!1},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:function(e,t,n){n&&n()},toggleAudio:function(){return!1},init:a}}(),t.WebRTCAdapter.overridePromise=function(e){r=e},t.Enums=t.Enums||{},t.Enums.VideoResolutionLevel=c,t}(e=function(e){"use strict";var t=e.Utils,i=Object.freeze({Disconnected:"Disconnected",Connecting:"Connecting",Reconnecting:"Reconnecting",Connected:"Connected"});return e.ConnectionController=function(r){var a,s,c,l,d,u=e.logger;t.isMobile()?(a=0,s=0,l=0,d=0,c=0):(a=1e3,s=8e3,l=64e3,d=1350,c=1);var C=4e3,E=20,T=2e3,p=200,S=200,I=5,f=this,R=null,v=null,A=null,g=i.Disconnected,_=null,N=0,m=null,h=null,O=null,D=r||{},y=null,P=null,b=[],U=[],L=null;function M(e,t){if("function"==typeof e)try{e(t)}catch(e){u.error(e)}}function w(){u.debug("[CONN]: online event received"),O&&(u.debug("[CONN]: Clear offline timeout"),n.clearTimeout(O),O=null),g===i.Reconnecting&&(_=s,f.reconnect(null,1e3))}function G(){u.debug("[CONN]: offline event received"),g===i.Connected&&(n.addEventListener("online",w),O||(O=n.setTimeout(function(){O=null,n.navigator.onLine||(u.debug("[CONN]: The client is offline. Change state to Reconnecting."),f.reconnect())},C)))}function H(){R&&(R.onopen=null,R.onclose=null,R.onmessage=null,R.onerror=null,R=null)}function k(e){if(e!==g){u.debug("[CONN]: Changed connection state from "+g+" to "+e),u.debug("[CONN]: Raising connectionStateChange event");var t=g;g=e,n.setTimeout(function(){!function(e,t){M(f.onStateChange,{newState:e,oldState:t})}(e,t)},0)}}function V(e){try{v&&v(e)}catch(e){u.error("[CONN]: Exception on errorCallback. ",e)}finally{v=null,A=null}}function F(){L&&(n.clearTimeout(L),L=null),U=[],b=[]}function B(e){if(m&&(n.clearTimeout(m),m=null),h&&(n.clearTimeout(h),h=null),F(),R){u.debug("[CONN]: Disconnecting from server");var t=R;H(),t.close()}e||(n.removeEventListener&&(n.removeEventListener("online",w),n.removeEventListener("offline",G)),k(i.Disconnected))}function x(e){e===R&&(u.info("[CONN]: WebSocket is opened"),_=a+t.randomNumber(0,s),N=0,g!==i.Disconnected&&(k(i.Connected),n.addEventListener&&(n.addEventListener("offline",G),n.removeEventListener("online",w)),function(){try{u.debug("[CONN]: Registered Successfully"),A&&A()}catch(e){u.error("[CONN]: Exception on successCallback. ",e)}finally{v=null,A=null}}()))}function W(e,r){if(e===R)switch(F(),r=r||{},u.info("[CONN]: WebSocket is closed. Code: "+r.code+". Reason:",r.reason),g){case i.Connected:case i.Reconnecting:g===i.Reconnecting&&M(f.onReconnectFailed),k(i.Reconnecting),function(){if(t.isMobile())u.warn("[CONN]: Mobile Client - Do not attempt to reconnect from JS");else{if(d>0&&N>=d)return u.warn("[CONN]: Reached max number of attempts reconnecting to WebSocket"),void B();!1===n.navigator.onLine&&(u.warn("[CONN]: Client is offline. Set retry timer to max value."),_=l),u.info("[CONN]: Retry to open socket in "+Math.floor(_/1e3)+" seconds"),m=n.setTimeout(function(){m=null,K()},_),_<l&&(_=++N>c?2*_:s,_=Math.min(_,l))}}();break;case i.Connecting:B(),u.error("[CONN]: Failed to open WebSocket connection"),V("Failed to open WebSocket connection")}}function Y(e,t){if(e===R)try{if(!t.data||"PING"===t.data)return;var n=t.data;if(!D.doNotParseMessages)try{n=JSON.parse(n)}catch(e){return void u.error("[CONN]: Message discarded (Cannot Parse): ",t.data)}!function(e){M(f.onMessage,e)}(n)}catch(e){u.error(e)}}function K(){if(g===i.Connecting||g===i.Reconnecting){u.info("[CONN]: Opening WebSocket to ",P);try{switch(n.navigator.platform){case"iOS":R=o.createWebSocket(y);break;case"node":R=new o(y,D.cookie);break;default:R=new o(y)}}catch(e){return u.error("[CONN]: Failed to connect WebSocket. ",e),void V(e)}R.onopen=x.bind(null,R),R.onclose=W.bind(null,R),R.onmessage=Y.bind(null,R),R.onerror=function(e,t){e===R&&(F(),g!==i.Reconnecting&&g!==i.Connected?(u.error("[CONN]: WebSocket Connection Error"),k(i.Disconnected),H(),V("Failed to open WebSocket connection")):"node"!==n.navigator.platform&&"iOS"!==n.navigator.platform&&"Android"!==n.navigator.platform||(u.error("[CONN]: WebSocket connection error. Force _socket.onclose. ",t),R.onclose()))}.bind(null,R)}}function q(){var e=Date.now(),t=b.findIndex(function(t){return e-t<T});-1===t?b=[]:b.splice(0,t)}function j(){if(!L){var e=p;b.length>=E&&(e+=T-(Date.now()-b[0])),u.info("[CONN]: Start throttle timeout with delay = ",e),L=n.setTimeout(function(){L=null,function(){u.info("[CONN]: Dequeue throttled messages. Number of queued messages = ",U.length),q();for(var e=0;U.length>0&&b.length<E&&e<I;)Q(U.shift()),e++;U.length>0?(u.warn("[CONN]: Number of remaining queued messages = ",U.length),j()):u.info("[CONN]: Dequeued all throttled messages")}()},e)}}function Q(e){try{var t=e.request&&e.request.requestId||"N/A";R.send(JSON.stringify(e)),b.push(Date.now()),u.debug("[CONN]: Sent message with requestId:",t)}catch(e){u.error("[CONN]: Failed to send message. ",e)}}this.onStateChange=null,this.onReconnectFailed=null,this.onMessage=null,this.getState=function(){return g},this.isConnected=function(){return g===i.Connected},this.setTarget=function(e){P=(y=e).split("?")[0]},this.connect=function(e,t,r){u.debug("[CONN]: Connect WebSocket to ",e),g!==i.Disconnected&&B(!0),f.setTarget(e),A=t||function(){},v=r||function(){},k(i.Connecting),n.setTimeout(K,0)},this.disconnect=function(){u.debug("[CONN]: Disconnect WebSocket from ",P),B()},this.reconnect=function(e,t){u.debug("[CONN]: Reconnect WebSocket to ",P),B(!0),e&&f.setTarget(e),k(i.Reconnecting),h=n.setTimeout(function(){h=null,K()},t||50)},this.sendMessage=function(e,n){return g!==i.Connected?(u.warn("[CONN]: WebSocket is not connected. Cannot send message. ",e),!1):e?(n||u.msgSend("[CONN]: ",e),"string"==typeof e?"PING"===e&&t.isMobile()?R.ping():R.send(e):(delete e.keysToOmitFromLogging,!L&&(b.length>=E&&q(),b.length<E)?Q(e):(function(e){u.warn("[CONN]: Throttling limit exceeded. Queue the message."),U.length>=S?u.error("[CONN]: Throttling queue is full. Drop the message."):(U.push(e),u.info("[CONN]: Queued message #",U.length))}(e),j())),!0):(u.error("[CONN]: Data is missing. Cannot send message."),!1)}},e.Enums=e.Enums||{},e.Enums.ConnectionState=i,e}(e=function(t){"use strict";var n=t.Utils,i=Object.freeze({TLS:{name:"tls",start:0,end:11e6},TCP:{name:"tcp",start:12e6,end:31e6},UDP:{name:"udp",start:35e6,end:6e7}}),r=Object.freeze({VP8:"VP8",VP9:"VP9",H264:"H264"});function o(e){if(e){var t=(e=e.replace(/(a=)*candidate:([^\r]+)(\r\n)*/i,"$2")).split(" ");if(t.length<7)throw new Error("Invalid candidate: "+e);this.foundation=parseInt(t[0],10),this.componentId=parseInt(t[1],10),this.transport=t[2].toLowerCase(),this.priority=parseInt(t[3],10),this.address=t[4],this.port=parseInt(t[5],10),this.typ=t[7],this.optional=[];for(var n=8;n<t.length;n+=2)this.optional.push(t[n]),this[t[n]]=t[n+1]}else this.foundation=1,this.componentId=1,this.transport="udp",this.priority=1,this.address="0.0.0.0",this.port=1,this.typ="host",this.generation=0,this.optional=[]}o.prototype.equals=function(e){return e=e&&"string"!=typeof e?e:new o(e),this.foundation===e.foundation&&this.componentId===e.componentId&&this.transport===e.transport&&this.priority===e.priority&&this.address===e.address&&this.port===e.port&&this.typ===e.typ},o.prototype.isRtp=function(){return 1===this.componentId},o.prototype.isRtcp=function(){return 2===this.componentId},o.prototype.isTcpTlsRelay=function(){return"relay"===this.typ&&this.priority<=i.TCP.end},o.prototype.getRelayClientTransportType=function(){var e="";if("relay"===this.typ){var t=this.priority;[i.TLS,i.TCP,i.UDP].some(function(n){return t>=n.start&&t<=n.end&&(e=n.name,!0)})}return e},o.prototype.getValue=function(){for(var e=this.foundation+" "+this.componentId+" "+this.transport+" "+this.priority+" "+this.address+" "+this.port+" typ "+this.typ,t=0;t<this.optional.length;t++){var n=this.optional[t];e+=" "+n+" "+this[n]}return e},o.prototype.getParsedAttribute=function(){return{field:"candidate",value:this.getValue()}},o.prototype.toString=function(){return"candidate:"+this.getValue()};var a=function(){var t=e.logger;function i(e){var t=e.split(/\s+/);return{nettype:t[0],addrtype:t[1],address:t[2]}}function r(e){var t=/^([^:]+)(?::(.*))?/.exec(e);return{field:t[1],value:t[2]}}var a=/^(\w+) +(\d+)(?:\/(\d))? +(\S+)(?: (\d+( +\d+)*))?/;function s(e){var t=a.exec(e);return{media:t[1],port:+t[2],portnum:+(t[3]||1),proto:t[4],fmt:t[5]?t[5].split(/\s+/).map(function(e){return+e}):[]}}function c(e,t,n){switch(t){case"v":case"o":case"s":case"i":case"u":case"e":case"p":case"c":e[t]=n;break;default:e[t]?e[t].push(n):e[t]=[n]}}var l={o:function(e){return[e.username||"-",e.id,e.version,e.nettype||"IN",e.addrtype||"IP4",e.address].join(" ")},c:function(e){return[e.nettype||"IN",e.addrtype||"IP4",e.address].join(" ")},m:function(e){return[e.media||"audio",e.port||"0",e.proto||"RTP/AVP",e.fmt.join(" ")].join(" ")},a:function(e){return e.value?[e.field,e.value].join(":"):e.field}};function d(e,t,n){if(void 0!==e[t]){var i=function(e){return t+"="+(l[t]&&l[t](e)||e)+"\r\n"};return Array.isArray(e[t])?e[t].map(i).join(""):i(e[t])}return n?t+"="+n+"\r\n":""}function u(e){return e.filter(function(e){switch(e.field){case"inactive":case"recvonly":case"sendonly":case"sendrecv":return!1}return!0})}function C(e){var t,n,o=e.split(/\r\n/),a={};for(t=0;t<o.length&&((n=/^(\w)=(.*)/.exec(o[t]))&&"m"!==n[1]);++t)"a"===n[1]&&n[2]?c(a,n[1],r(n[2])):c(a,n[1],n[2]);a.m=[];for(var l,d,u=null;t<o.length&&(n=/(\w)=(.*)/.exec(o[t]));++t)"m"===n[1]?(u=s(n[2]),a.m.push(u)):"a"===n[1]&&n[2]?c(u,n[1],r(n[2])):c(u,n[1],n[2]);return a.s&&""!==a.s.trim()||(a.s="-"),a.o&&(a.o=(l=a.o,{username:(d=l.split(/\s+/))[0],id:d[1],version:d[2],nettype:d[3],addrtype:d[4],address:d[5]})),a.c&&(a.c=i(a.c)),a.m.forEach(function(e){e.c&&(e.c=i(e.c))}),a}function E(e,t){var n="string"==typeof e?C(e):e,i="sendrecv";return void 0!==(t=t||{}).mLineIndex?(n.m[t.mLineIndex].a.forEach(function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":i=e.field}}),i):(t.mediaType&&"both"!==t.mediaType||(t.mediaType="audio"),n.a&&n.a.forEach(function(e){switch(e.field){case"sendonly":case"recvonly":case"inactive":i=e.field}}),n.m&&n.m.forEach(function(e){e.media===t.mediaType&&e.a.forEach(function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":i=e.field}})}),i)}function T(e){return!!Array.isArray(e)&&e.some(function(e){return e.includes("AS:")})}function p(e){return!!Array.isArray(e)&&e.some(function(e){return e.includes("TIAS:")})}return{parse:C,stringify:function(e){var t="";return t+=d(e,"v",0),t+=d(e,"o"),t+=d(e,"s","-"),t+=d(e,"i"),t+=d(e,"u"),t+=d(e,"e"),t+=d(e,"p"),t+=d(e,"c"),t+=d(e,"b"),t+=d(e,"t","0 0"),t+=d(e,"r"),t+=d(e,"z"),t+=d(e,"k"),t+=d(e,"a"),e.m.forEach(function(e){t+=d({m:e},"m"),t+=d(e,"i"),t+=d(e,"c"),t+=d(e,"b"),t+=d(e,"k"),t+=d(e,"a")}),t},getConnectionMode:E,getVideoConnectionModes:function(e){var t="string"==typeof e?C(e):e,n=[];return t.m&&t.m.forEach(function(e){"video"===e.media&&e.a.some(function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":return n.push(e.field),!0}return!1})}),n},setConnectionMode:function(e,t,n){var i="string"==typeof e?C(e):e,r=t&&"both"!==t?[t]:["audio","video"];return"both"===t&&i.a&&(i.a=u(i.a),i.a.push({field:n})),i.m&&i.m.forEach(function(e){r.includes(e.media)&&(e.a=u(e.a),e.a.push({field:n}))}),i},isHold:function(e){var t=E(e);return"inactive"===t||"sendonly"===t},disableMultiplex:function(e){var t="string"==typeof e?C(e):e;return t.a&&(t.a=t.a.filter(function(e){return"group"!==e.field})),t},isMultiplexEnabled:function(e){var t="string"==typeof e?C(e):e;return!!t.a&&t.a.some(function(e){return"group"===e.field&&e.value&&e.value.startsWith("BUNDLE")})},hasVideo:function(e){var t="string"==typeof e?C(e):e;return!!t.m&&t.m.some(function(e,n){return"video"===e.media&&0!==e.port&&0!==e.fmt.length&&("inactive"!==E(t,{mLineIndex:n})&&e.a.some(function(e){return"rtpmap"===e.field&&/VP[89]/.test(e.value)}))})},addEmptyVideoLine:function(e){var t="string"==typeof e?C(e):e;return t.m.push({media:"video",port:0,proto:"RTP/SAVPF",fmt:[100],c:{nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a:[{field:"inactive"}]}),t},removeVideo:function(e){var t="string"==typeof e?C(e):e;return t.m&&t.m.forEach(function(e){"video"===e.media&&(e.port=0,e.c={nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},e.a=e.a.filter(function(e){return"mid"===e.field}),e.a.push({field:"inactive"}))}),t},setOpusParameters:function(e,t){var i="string"==typeof e?C(e):e;return i.m&&t?(t=n.shallowCopy(t),i.m.forEach(function(e){var n;"audio"===e.media&&e.a&&(e.a.some(function(e){return!("rtpmap"!==e.field||!e.value.includes("opus"))&&(n=e.value.split(" ")[0],!0)}),n&&e.a.some(function(e){if("fmtp"===e.field&&e.value.includes(n)){e.value.substring(n.length+1).split(";").forEach(function(e){var n=e.split("="),i=n[0].trim(),r=n[1].trim();t.hasOwnProperty(i)||(t[i]=r)});var i=Object.keys(t).map(function(e){return e+"="+t[e]});return e.value=n+" "+i.join(";"),!0}return!1}))}),i):i},setVideoBandwidth:function(e,t,n,i){var r="string"==typeof e?C(e):e;return r.m&&r.m.forEach(function(e,r){if("video"===e.media){if(i>=0&&i!==r)return;n?t&&t.valueOf()>0?e.b=["AS:"+t,"TIAS:"+1e3*t]:(T(e.b)||p(e.b))&&delete e.b:(T(e.b)||c(e,"b","AS:"+t),p(e.b)||c(e,"b","TIAS:"+1e3*t))}}),r},setXGoogle:function(e,t,n){var i="string"==typeof e?C(e):e;return i.m&&t&&i.m.forEach(function(e,i){if("video"===e.media&&e.a&&!(n>=0&&n!==i)){var r=[];e.a=e.a.filter(function(e,t){return"rtpmap"===e.field&&/VP[89]/.test(e.value)&&r.push({idx:t+r.length,pt:e.value.split(" ")[0]}),("fmtp"!==e.field||e.value&&!e.value.includes("x-google"))&&"x-google-buffer-latency"!==e.field}),r.forEach(function(n){var i=[];t.minBitRate&&t.minBitRate.valueOf()>0&&i.push("x-google-min-bitrate="+t.minBitRate),t.maxBitRate&&t.maxBitRate.valueOf()>0&&i.push("x-google-max-bitrate="+t.maxBitRate),t.startBitRate&&t.startBitRate.valueOf()>0&&i.push("x-google-start-bitrate="+t.startBitRate),t.maxQuantization&&t.maxQuantization.valueOf()>0&&i.push("x-google-max-quantization="+t.maxQuantization),i.length>0&&(i=n.pt+" "+i.join("; "),e.a.splice(n.idx+1,0,{field:"fmtp",value:i}))})}}),i},setPreferredVideoCodec:function(e,n){var i="string"==typeof e?C(e):e;return i.m&&n&&i.m.forEach(function(e,i){if("video"===e.media){var r=e.a.find(function(e){return"rtpmap"===e.field&&e.value.includes(n)});if(r){var o=parseInt(r.value.split(" ")[0],10),a=e.fmt.indexOf(o);a>0&&(e.fmt.splice(a,1),e.fmt.unshift(o),t.debug("[SdpParser]: Prefer "+n+" format for video m-line #:",i))}}}),i},removeVideoBandwidth:function(e){var t="string"==typeof e?C(e):e;return t.m&&t.m.forEach(function(e){"video"===e.media&&(e.b=e.b&&e.b.filter(function(e){return!e.startsWith("AS:")&&!e.startsWith("TIAS:")}))}),t},removeAudioLevelAttr:function(e){var t="string"==typeof e?C(e):e;return t.m&&t.m.forEach(function(e){"audio"===e.media&&(e.a=e.a&&e.a.filter(function(e){return"extmap"!==e.field||!e.value||!e.value.includes("ssrc-audio-level")}))}),t},isTrickleIceOption:function(e){var t=function(e){return"ice-options"===e.field&&e.value&&e.value.includes("trickle")||"inactive"===e.field},n="string"==typeof e?C(e):e;return n.a=n.a||[],n.a.some(t)||n.m&&n.m.length>0&&n.m.every(function(e){return e.a&&e.a.some(t)})},fixTrickleIceOption:function(e,n){var i=function(e,n,i){return"ice-options"===e.field&&(e.value=e.value||"",e.value=e.value.replace(/trickle\s*/gi,"").trim(),e.value||(t.debug("[SdpParser]: There are no other ice-options - remove the attribute."),i.splice(n,1)),!0)},r="string"==typeof e?C(e):e;r.a=r.a||[];var o=this.isTrickleIceOption(r);n&&!o?(t.debug("[SdpParser]: Adding Trickle ICE indication"),r.a.some(function(e){return"ice-options"===e.field&&(e.value=(e.value||"")+" trickle",!0)})||r.a.push({field:"ice-options",value:"trickle"})):!n&&o&&(t.debug("[SdpParser]: Removing Trickle ICE indication"),r.a.some(i),r.m.forEach(function(e){e.a&&e.a.some(i)}));return r},addEndOfCandidatesLine:function(e){var t="string"==typeof e?C(e):e;return t.m&&t.m.forEach(function(e){e.a=e.a||[],e.a.some(function(e){return"end-of-candidates"===e.field})||e.a.push({field:"end-of-candidates"})}),t},removeEndOfCandidatesLine:function(e){var t="string"==typeof e?C(e):e;return t.m&&t.m.forEach(function(e){e.a&&e.a.some(function(t,n){return"end-of-candidates"===t.field&&(e.a.splice(n,1),!0)})}),t},validateIceCandidates:function(e,n,i){return!("string"==typeof e?C(e):e).m.some(function(e,r){return!function e(n,i,r,a){if(0===n.port)return!0;var s=0,c=!1,l=null,d=null,u=n.a.filter(function(e){if("candidate"!==e.field)return!0;var i=new o(e.value);if("udp"!==i.transport)return!1;if(r&&"video"===n.media){if("relay"!==i.typ)return c=!0,!1;if(!i.isTcpTlsRelay())return t.debug("[SdpParser]: Removed UDP relay candidate: ",e.value),c=!0,!1;!l&&i.isRtp()&&(l=i),!d&&i.isRtcp()&&(d=i)}return s++,!0});return l||!c||a?!(0===s&&!a||(n.a=u,d&&n.a.some(function(e){return"rtcp"===e.field&&(e.value=d.port+" IN IP4 "+d.address,!0)}),l&&(n.port=l.port,n.c&&(n.c.address=l.address)),0)):(t.info("[SdpParser]: Media description does not have TCP/TLS relay candidates. Do not filter UDP candidates!"),e(n,i,!1))}(e,r,n,i)})},isNoOfferSdp:function(e){return!!e&&""===e.sdp&&"nooffer"===e.type},iceTotalCandidatesCount:function(e){var t=0;return("string"==typeof e?C(e):e).m.forEach(function(e){e.a.forEach(function(e){"candidate"===e.field&&t++})}),t},getIceCandidates:function(e){var t=[];return("string"==typeof e?C(e):e).m.forEach(function(e){e.a.forEach(function(e){"candidate"===e.field&&t.push(new o(e.value))})}),t},removeAudioMediaProtocols:function(e,t){var n="string"==typeof e?C(e):e;return t&&t.length?(n.m.some(function(e){if("audio"===e.media&&e.proto){var n=e.proto.split("/");return n=n.filter(function(e){return!t.includes(e)}),e.proto=n.join("/"),!0}return!1}),n):n},verifyFingerprintInMLines:function(e){var n="string"==typeof e?C(e):e;return n.m&&n.m.forEach(function(e,i){e.a.some(function(e){return"fingerprint"===e.field})||n.a.some(function(t){return"fingerprint"===t.field&&(e.a.push(t),!0)})||t.debug("[SdpParser]: verifyFingerprintInMLines(): No session fingerprint found for video m-line #:",i)}),n},findMediaLineIndex:function(e,t){return t?function(e,t){return e.m.findIndex(function(e){return e.a.some(function(e){return"mid"===e.field&&e.value===t})})}("string"==typeof e?C(e):e,t):-1},setMediaIdAttribute:function(e,t,n,i){var r=("string"==typeof e?C(e):e).m[t];r&&(r.a.some(function(e){return"mid"===e.field&&(i&&(e.value=n),!0)})||r.a.push({field:"mid",value:n}))},getMediaIds:function(e){var t="string"==typeof e?C(e):e,n={};return t.m.forEach(function(e){var t,i;e.a&&e.a.some(function(e){return"mid"===e.field?t=e.value:"msid"===e.field&&(i=e.value),t&&i})&&(n[i]=t)}),n},getOrigin:function(e){if("string"==typeof e){var t=/(o=[^\r]+)\r\n/i.exec(e);return t&&t[1]||""}return d(e,"o")},getSsrcList:function(e){var t="string"==typeof e?C(e):e,n=[];return t.a.forEach(function(e){"ssrc"===e.field&&n.push(e.value.split(" ")[0])}),n}}}();return t.IceCandidate=o,t.sdpParser=a,t.Enums=t.Enums||{},t.Enums.VideoCodecs=r,t}((e=function(e){"use strict";var t=e.logger,n=e.Utils,i=Object.freeze({WSMessageType:{REQUEST:"REQUEST",RESPONSE:"RESPONSE",EVENT:"EVENT"},ContentType:{SYSTEM:"SYSTEM",NONE:"NONE",EXTENSION:"EXTENSION",CONVERSATION:"CONVERSATION",USER:"USER",RTC_SESSION:"RTC_SESSION",RTC_CALL:"RTC_CALL",SEARCH:"SEARCH",KEEPALIVE:"KEEPALIVE",INSTRUMENTATION:"INSTRUMENTATION",GUEST:"GUEST",ADMINISTRATION:"ADMINISTRATION",THIRDPARTYCONNECTORS:"THIRDPARTYCONNECTORS",USER_TO_USER:"USER_TO_USER",VERSION:"VERSION",SANITY_CHECK:"SANITY_CHECK",WEB_HOOK:"WEB_HOOK",ACCOUNT:"ACCOUNT",ACTIVITYSTREAM:"ACTIVITYSTREAM",PROVISIONING:"PROVISIONING",RTC_CONNECTION:"RTC_CONNECTION",CONVERSATION_USER_DATA:"CONVERSATION_USER_DATA",MS_CONNECTOR:"MS_CONNECTOR",SPACE:"SPACE",CPAAS:"CPAAS",TEAM:"TEAM",USER_DATA:"USER_DATA"},ReturnCode:{OK:"OK",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",AUTHORIZATION_REQUIRED:"AUTHORIZATION_REQUIRED",SERVICE_EXCEPTION:"SERVICE_EXCEPTION",PROTOBUF_CONVERSION_EXCEPTION:"PROTOBUF_CONVERSION_EXCEPTION",CONVERSION_EXCEPTION:"CONVERSION_EXCEPTION",NO_MESSAGE_HANDLER:"NO_MESSAGE_HANDLER",INVALID_CLIENT:"INVALID_CLIENT",NO_RESULT:"NO_RESULT",OPERATION_NOT_SUPPORTED:"OPERATION_NOT_SUPPORTED",ENTITY_ALREADY_EXISTS:"ENTITY_ALREADY_EXISTS",FRAME_SIZE_TO_LONG:"FRAME_SIZE_TO_LONG",BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",OVERLOADED:"OVERLOADED",OLD_VERSION:"OLD_VERSION",STORAGE_OVERLOADED:"STORAGE_OVERLOADED",USER_NOT_FOUND:"USER_NOT_FOUND",CLOUD_TELEPHONY_EXCEPTION:"CLOUD_TELEPHONY_EXCEPTION",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",DISCONNECTED:"DISCONNECTED",INVALID_MESSAGE:"INVALID_MESSAGE",FAILED_TO_SEND:"FAILED_TO_SEND",UNEXPECTED_RESPONSE:"UNEXPECTED_RESPONSE",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",CHOOSE_DESKTOP_MEDIA_CANCELLED:"CHOOSE_DESKTOP_MEDIA_CANCELLED",REQUEST_CANCELED:"REQUEST_CANCELED",SDK_ERROR:"SDK_ERROR"},ErrorCode:{UNEXPECTED_ERROR:"UNEXPECTED_ERROR",CONSTRAINT_VIOLATION:"CONSTRAINT_VIOLATION",MAX_NUM_CONV_PARTICIPANTS:"MAX_NUM_CONV_PARTICIPANTS",THIRDPARTY_ERROR:"THIRDPARTY_ERROR",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",PERMISSION_DENIED:"PERMISSION_DENIED",RTC_NO_MEDIA_NODES_AVAILABLE:"RTC_NO_MEDIA_NODES_AVAILABLE",RTC_CONCURRENT_INCOMING_CALL:"RTC_CONCURRENT_INCOMING_CALL",DUPLICATED_ENTITY_ERROR:"DUPLICATED_ENTITY_ERROR",RTC_MEDIA_NODE_UNREACHABLE:"RTC_MEDIA_NODE_UNREACHABLE",CLOUD_TELEPHONY_ERROR:"CLOUD_TELEPHONY_ERROR"},ThirdPartyError:{UNSUPPORTED_PROVIDER:"UNSUPPORTED_PROVIDER",BAD_REQUEST:"BAD_REQUEST",GENERAL_ERROR:"GENERAL_ERROR",INSUFFICIENT_PERMISSION:"INSUFFICIENT_PERMISSION",NOT_AUTHORIZED:"NOT_AUTHORIZED",RESOURCE_NOT_FOUND:"RESOURCE_NOT_FOUND",SERVER_DOWN:"SERVER_DOWN",SESSION_EXPIRED:"SESSION_EXPIRED",UNSUPPORTED_FILE_TYPE:"UNSUPPORTED_FILE_TYPE",WRONG_SERVER:"WRONG_SERVER",EMPTY_SETTINGS:"EMPTY_SETTINGS",EMPTY_USERNAME:"EMPTY_USERNAME",EMPTY_PASSWORD:"EMPTY_PASSWORD",EMPTY_SERVER_ADDRESS:"EMPTY_SERVER_ADDRESS",INVALID_SERVER_ADDRESS:"INVALID_SERVER_ADDRESS",NOT_CONNECTED:"NOT_CONNECTED",ALREADY_CONNECTED:"ALREADY_CONNECTED",INVALID_ITEMIDS:"INVALID_ITEMIDS",TOO_MANY_REQUESTS:"TOO_MANY_REQUESTS"},CloudTelephonyErrorType:{CMP_NEXT:"CMP_NEXT",VALIDATION:"VALIDATION",CMP_NEXT_VALIDATION:"CMP_NEXT_VALIDATION"},CloudTelephonyValidationError:{UNKNOWN:"UNKNOWN",DN_NOT_FOUND_IN_TENANT:"DN_NOT_FOUND_IN_TENANT",DUPLICATE_SITE_NAME:"DUPLICATE_SITE_NAME",OVERLAPPING_PUBLIC_RANGES_WITHIN_SITE:"OVERLAPPING_PUBLIC_RANGES_WITHIN_SITE",OVERLAPPING_PUBLIC_RANGES_ACROSS_DEPLOYMENT:"OVERLAPPING_PUBLIC_RANGES_ACROSS_DEPLOYMENT",OVERLAPPING_PRIVATE_RANGES_WITHIN_SITE:"OVERLAPPING_PRIVATE_RANGES_WITHIN_SITE",OVERLAPPING_PRIVATE_RANGES_ACROSS_TENANT:"OVERLAPPING_PRIVATE_RANGES_ACROSS_TENANT",EXISTING_USERS_IN_RANGE:"EXISTING_USERS_IN_RANGE",EXISTING_USERS_IN_PUBLIC_RANGE:"EXISTING_USERS_IN_PUBLIC_RANGE",EXISTING_USERS_IN_PRIVATE_RANGE:"EXISTING_USERS_IN_PRIVATE_RANGE",AREA_CODES_INCONSISTENT:"AREA_CODES_INCONSISTENT",DELETE_ITSP_ALREADY_ASSIGNED:"DELETE_ITSP_ALREADY_ASSIGNED",DN_NOT_FOUND_IN_SITE:"DN_NOT_FOUND_IN_SITE",CALLERID_NOT_FOUND_IN_PUBLIC_NUMBERS:"CALLERID_NOT_FOUND_IN_PUBLIC_NUMBERS",AA_OPERATOR_INVALID:"AA_OPERATOR_INVALID",MSN_AS_EXISTING_USER:"MSN_AS_EXISTING_USER",EA_INVALID_CREATE_UPDATE_CONFIGURATION:"EA_INVALID_CREATE_UPDATE_CONFIGURATION"},CloudTelephonyCmpNextError:{COUNTRY_DETAILS_NOT_FOUND:"COUNTRY_DETAILS_NOT_FOUND",OSV_OPERATION_FAILED:"OSV_OPERATION_FAILED",CALL_PICKUP_GROUP_DUPLICATE_NAME:"CALL_PICKUP_GROUP_DUPLICATE_NAME",OPENSCAPE_SITE_DID_AREA_CODES_INCONSISTENT:"OPENSCAPE_SITE_DID_AREA_CODES_INCONSISTENT",OPENSCAPE_SITE_DID_AREA_CODE_NOT_EMPTY:"OPENSCAPE_SITE_DID_AREA_CODE_NOT_EMPTY"},ClientCapability:{GUEST_EXPERIENCE:1,SYSTEM_MESSAGES:2,TC_START_REASSIGNMENT:4,MUTABLE_APN:8},ConversationActionType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",ADD_TEXT_ITEM:"ADD_TEXT_ITEM",UPDATE_TEXT_ITEM:"UPDATE_TEXT_ITEM",DELETE_TEXT_ITEM:"DELETE_TEXT_ITEM",GET_CONVERSATION_BY_ID:"GET_CONVERSATION_BY_ID",GET_CONVERSATIONS:"GET_CONVERSATIONS",GET_ITEM_BY_ID:"GET_ITEM_BY_ID",GET_ITEMS_BY_CONVERSATION:"GET_ITEMS_BY_CONVERSATION",GET_ITEMS_BY_CONVERSATION_ITEM_ID:"GET_ITEMS_BY_CONVERSATION_ITEM_ID",SET_READ_POINTER:"SET_READ_POINTER",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",TYPING:"TYPING",GET_CONVERSATION_USER_DATA:"GET_CONVERSATION_USER_DATA",SET_FLAG_ITEM:"SET_FLAG_ITEM",CLEAR_FLAG_ITEM:"CLEAR_FLAG_ITEM",GET_FLAGGED_ITEMS:"GET_FLAGGED_ITEMS",GET_JOIN_DETAILS:"GET_JOIN_DETAILS",GET_SUPPORT_CONVERSATION_ID:"GET_SUPPORT_CONVERSATION_ID",GET_SUPPORT_CONVERSATION:"GET_SUPPORT_CONVERSATION",GET_OPEN_CONVERSATIONS:"GET_OPEN_CONVERSATIONS",JOIN_OPEN_CONVERSATION:"JOIN_OPEN_CONVERSATION",MARK_CONVERSATION:"MARK_CONVERSATION",UNMARK_CONVERSATION:"UNMARK_CONVERSATION",GET_MARKED_CONVERSATIONS_LIST:"GET_MARKED_CONVERSATIONS_LIST",SET_CONVERSATION_AVATAR:"SET_CONVERSATION_AVATAR",GET_TELEPHONY_CONVERSATION_ID:"GET_TELEPHONY_CONVERSATION_ID",GET_ATTACHMENTS:"GET_ATTACHMENTS",GET_CONVERSATION_BY_USER:"GET_CONVERSATION_BY_USER",GET_CONVERSATION_SUMMARY:"GET_CONVERSATION_SUMMARY",LIKE_TEXT_ITEM:"LIKE_TEXT_ITEM",UNLIKE_TEXT_ITEM:"UNLIKE_TEXT_ITEM",DELETE_RECORDING:"DELETE_RECORDING",MODERATE_CONVERSATION:"MODERATE_CONVERSATION",UNMODERATE_CONVERSATION:"UNMODERATE_CONVERSATION",ADD_SCHEDULE_ITEM:"ADD_SCHEDULE_ITEM",UPDATE_SCHEDULE_ITEM:"UPDATE_SCHEDULE_ITEM",DELETE_SCHEDULE_ITEM:"DELETE_SCHEDULE_ITEM",GET_ALL_USER_SCHEDULE_ITEMS:"GET_ALL_USER_SCHEDULE_ITEMS",GRANT_MODERATOR_RIGHTS:"GRANT_MODERATOR_RIGHTS",DROP_MODERATOR_RIGHTS:"DROP_MODERATOR_RIGHTS",GET_CONVERSATION_THREADS:"GET_CONVERSATION_THREADS",GET_THREAD_COMMENTS:"GET_THREAD_COMMENTS",GET_THREADS_BY_IDS:"GET_THREADS_BY_IDS",ADD_JOURNAL_ENTRY:"ADD_JOURNAL_ENTRY",GET_THREADS_BY_ITEM_IDS:"GET_THREADS_BY_ITEM_IDS",DELETE_ATTACHMENTS:"DELETE_ATTACHMENTS",UPDATE_GUEST_ACCESS:"UPDATE_GUEST_ACCESS",GET_CONVERSATION_PARTICIPANTS:"GET_CONVERSATION_PARTICIPANTS",GET_CONVERSATION_FEED:"GET_CONVERSATION_FEED",SET_FAVORITE_POSITION:"SET_FAVORITE_POSITION",GET_ITEMS_BY_IDS:"GET_ITEMS_BY_IDS",ADD_LABELS:"ADD_LABELS",ASSIGN_LABELS:"ASSIGN_LABELS",UNASSIGN_LABELS:"UNASSIGN_LABELS",GET_LABELS:"GET_LABELS",GET_LABEL_PAGE:"GET_LABEL_PAGE",REMOVE_LABELS:"REMOVE_LABELS",EDIT_LABEL:"EDIT_LABEL",UPDATE_RTC_ITEM_ATTACHMENTS:"UPDATE_RTC_ITEM_ATTACHMENTS",GET_CONVERSATIONS_BY_FILTER:"GET_CONVERSATIONS_BY_FILTER",ADD_FILTER:"ADD_FILTER",REMOVE_FILTERS:"REMOVE_FILTERS",GET_FILTERS:"GET_FILTERS",EDIT_FILTER:"EDIT_FILTER",GET_FAVORITE_CONVERSATION_IDS:"GET_FAVORITE_CONVERSATION_IDS",GET_CONVERSATIONS_BY_IDS:"GET_CONVERSATIONS_BY_IDS",GET_USER_DATA_SINCE:"GET_USER_DATA_SINCE",GET_CONFERENCE_INVITATION_TEXT:"GET_CONFERENCE_INVITATION_TEXT",GET_CONFERENCE_INVITATION_EXAMPLE:"GET_CONFERENCE_INVITATION_EXAMPLE",GET_TEASER_MESSAGES:"GET_TEASER_MESSAGES",TAKE_MODERATION_RIGHT:"TAKE_MODERATION_RIGHT",GET_CONVERSATION_TOPICS:"GET_CONVERSATION_TOPICS",PIN_TOPIC:"PIN_TOPIC",UNPIN_TOPIC:"UNPIN_TOPIC",DELETE_JOURNAL_ENTRY:"DELETE_JOURNAL_ENTRY",SET_CONVERSATION_RETENTION_POLICY:"SET_CONVERSATION_RETENTION_POLICY",GET_JOURNAL_ENTRIES:"GET_JOURNAL_ENTRIES",GET_CONVERSATION_DETAILS:"GET_CONVERSATION_DETAILS"},ConversationEventType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_ITEM:"ADD_ITEM",UPDATE_ITEM:"UPDATE_ITEM",READ_ITEMS:"READ_ITEMS",TYPING:"TYPING",DRAFT_MESSAGE_SAVED:"DRAFT_MESSAGE_SAVED",DRAFT_MESSAGE_DISCARDED:"DRAFT_MESSAGE_DISCARDED",DRAFT_MESSAGE_PUBLISHED:"DRAFT_MESSAGE_PUBLISHED",FLAG_ITEM:"FLAG_ITEM",CLEAR_FLAGGED_ITEM:"CLEAR_FLAGGED_ITEM",CONVERSATION_MARKED:"CONVERSATION_MARKED",CONVERSATION_UNMARKED:"CONVERSATION_UNMARKED",FAVORITE_POSITION_CHANGED:"FAVORITE_POSITION_CHANGED",USER_DATA_CHANGED:"USER_DATA_CHANGED",JOURNAL_ENTRY_DELETED:"JOURNAL_ENTRY_DELETED"},UISettings:{INFO:"INFO",DETAILS:"DETAILS",PARTICIPANTS:"PARTICIPANTS",PINNED_TOPICS:"PINNED_TOPICS"},DefaultUISettingsValues:{INFO:!1,DETAILS:!0,PARTICIPANTS:!0,PINNED_TOPICS:!0},RetentionPolicyStatus:{ENABLED:"ENABLED",USER_DISABLED:"USER_DISABLED",LEGALHOLD_DISABLED:"LEGALHOLD_DISABLED",USER_LEGALHOLD_DISABLED:"USER_LEGALHOLD_DISABLED"},SearchDirection:{AFTER:"AFTER",BEFORE:"BEFORE",BOTH:"BOTH"},TimestampFilter:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},OrderBy:{TIMESTAMP_ASC:"TIMESTAMP_ASC",TIMESTAMP_DESC:"TIMESTAMP_DESC"},OrderType:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},ConversationType:{DIRECT:"DIRECT",GROUP:"GROUP",OPEN:"OPEN",LARGE:"LARGE"},ConversationItemType:{TEXT:"TEXT",RTC:"RTC",SYSTEM:"SYSTEM"},ConversationItemTypeMapping:{RTC:"phone",CALL_SUMMARY:"call-summary",TEXT:"text",SYSTEM:"notification",VOICEMAIL:"vm",MARKER:"marker",DIVIDER:"divider",GAP:"gap"},ConversationFilter:{ALL:"ALL",OPEN_MEMBER:"OPEN_MEMBER",MARKED:"MARKED",ARCHIVED:"ARCHIVED",UNARCHIVED:"UNARCHIVED"},ConversationMarkFilter:{MUTE:"MUTE",FAVORITE:"FAVORITE"},GetConversationParticipantCriteria:{DISPLAY_NAME:"DISPLAY_NAME",TYPE:"TYPE"},ConversationParticipantType:{ACTIVE:"ACTIVE",REGULAR:"REGULAR",FORMER:"FORMER",MODERATOR:"MODERATOR",GUEST:"GUEST"},DataRetentionState:{UNTOUCHED:"UNTOUCHED",OUTDATED:"OUTDATED",DELETED:"DELETED"},RetrieveAction:{CONVERSATIONS:"CONVERSATIONS",CONVERSATION_IDS:"CONVERSATION_IDS",CONVERSATIONS_AND_IDS:"CONVERSATIONS_AND_IDS"},RTCItemType:{STARTED:"STARTED",ENDED:"ENDED",MISSED:"MISSED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",MOVED:"MOVED"},RTCItemMissed:{UNREACHABLE:"UNREACHABLE",TIMEOUT:"TIMEOUT",USER_BUSY:"USER_BUSY",DECLINED:"DECLINED",CANCELED:"CANCELED",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"},RTCItemMoved:{MOVED_FROM:"MOVED_FROM",MOVED_TO:"MOVED_TO"},ExternalUnshareProviderType:{SYNCPLICITY:"SYNCPLICITY"},SortingType:{RECENT_ACTIVITY_ASC:"RECENT_ACTIVITY_ASC",RECENT_ACTIVITY_DESC:"RECENT_ACTIVITY_DESC",ALPHABETICALLY_ASC:"ALPHABETICALLY_ASC",ALPHABETICALLY_DESC:"ALPHABETICALLY_DESC",POPULARITY_ASC:"POPULARITY_ASC",POPULARITY_DESC:"POPULARITY_DESC",TIMESTAMP_ASC:"TIMESTAMP_ASC"},TextItemContentType:{PLAIN:"PLAIN",RICH:"RICH"},TextItemState:{CREATED:"CREATED",EDITED:"EDITED",DELETED:"DELETED",CLUSTERED:"CLUSTERED"},SystemItemType:{CONVERSATION_CREATED:"CONVERSATION_CREATED",PARTICIPANT_ADDED:"PARTICIPANT_ADDED",PARTICIPANT_REMOVED:"PARTICIPANT_REMOVED",CONVERSATION_RENAMED:"CONVERSATION_RENAMED",GUEST_INVITED:"GUEST_INVITED",GUEST_JOINED:"GUEST_JOINED",GUEST_INVITE_RESENT:"GUEST_INVITE_RESENT",CONFERENCE_DETAILS_CHANGED:"CONFERENCE_DETAILS_CHANGED",CONVERSATION_MODERATED:"CONVERSATION_MODERATED",MODERATOR_RIGHTS_GRANTED:"MODERATOR_RIGHTS_GRANTED",MODERATOR_RIGHTS_DROPPED:"MODERATOR_RIGHTS_DROPPED",GUEST_ACCESS_ENABLED:"GUEST_ACCESS_ENABLED",GUEST_ACCESS_DISABLED:"GUEST_ACCESS_DISABLED",AVATAR_CHANGED:"AVATAR_CHANGED",RETENTION_POLICY_CHANGED:"RETENTION_POLICY_CHANGED",RETENTION_ITEMS_REMOVED:"RETENTION_ITEMS_REMOVED"},AttachmentOrderType:{CREATION:"CREATION",FILENAME:"FILENAME",SIZE:"SIZE",MIMETYPE:"MIMETYPE",FILEEXTENSION:"FILEEXTENSION"},AttachmentOrderDirection:{ASC:"ASC",DSC:"DSC"},BridgeLocale:{EN_US:"EN_US",EN_GB:"EN_GB",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN",PT_BR:"PT_BR",NL_NL:"NL_NL"},BridgeNumberType:{TOLL:"TOLL",TOLL_FREE:"TOLL_FREE",LOCAL:"LOCAL"},FilterTarget:{CONVERSATION_TYPE:"CONVERSATION_TYPE",LABEL_ID:"LABEL_ID"},FilterTargetComparator:{EQ:"EQ",NOT:"NOT"},FilterBoolConnector:{AND:"AND",OR:"OR"},SystemLabel:{ARCHIVED:"ARCHIVED"},IncludedUserData:{LAST_READ_TS:"LASTREADTS",UNREAD_COUNT:"UNREADCOUNT",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},ChangedUserData:{LAST_READ_TS:"LASTREADTS",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},ModerationTakenResult:{OK:"OK",ALREADY_HAS_MODERATOR:"ALREADY_HAS_MODERATOR",NO_MODERATED_CONVERTION:"NO_MODERATED_CONVERTION",NO_FULL_CONVERSATION_MEMBER:"NO_FULL_CONVERSATION_MEMBER",TAKE_MODERATION_FORBIDDEN:"TAKE_MODERATION_FORBIDDEN"},JournalFilter:{ALL:"ALL",MISSED:"MISSED",DIALED:"DIALED",RECEIVED:"RECEIVED",DIVERTED:"DIVERTED",VOICEMAILS:"VOICEMAILS"},InstrumentationActionType:{SUBMIT_CLIENT_DATA:"SUBMIT_CLIENT_DATA",SUBMIT_QOS_DATA:"SUBMIT_QOS_DATA"},SubmitDataResult:{UNKNOWN:"UNKNOWN",OK:"OK",NO_USERID:"NO_USERID",NO_CLIENTID:"NO_CLIENTID",NO_DATA:"NO_DATA",PROCESSING_ERROR:"PROCESSING_ERROR"},QOSMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",SCREEN_SHARE:"SCREEN_SHARE"},RTCCallActionType:{JOIN:"JOIN",ANSWER:"ANSWER",ICE_CANDIDATES:"ICE_CANDIDATES",LEAVE:"LEAVE",TERMINATE:"TERMINATE",CHANGE_MEDIA_TYPE:"CHANGE_MEDIA_TYPE",INVITE_REJECT:"INVITE_REJECT",CHANGE_MEDIA_ACCEPT:"CHANGE_MEDIA_ACCEPT",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",PREPARE:"PREPARE",RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",SEND_PROGRESS:"SEND_PROGRESS",SUBMIT_RTC_QUALITY_RATING:"SUBMIT_RTC_QUALITY_RATING"},RTCCallEventType:{SDP_ANSWER:"SDP_ANSWER",SDP_FAILED:"SDP_FAILED",INVITE:"INVITE",INVITE_CANCEL:"INVITE_CANCEL",INVITE_FAILED:"INVITE_FAILED",CHANGE_MEDIA_TYPE_REQUESTED:"CHANGE_MEDIA_TYPE_REQUESTED",PROGRESS:"PROGRESS",CHANGE_MEDIA_TYPE_FORCED:"CHANGE_MEDIA_TYPE_FORCED",ICE_CANDIDATES:"ICE_CANDIDATES",RTC_QUALITY_RATING_EVENT:"RTC_QUALITY_RATING_EVENT",IFRAME_STATISTICS:"IFRAME_STATISTICS"},SdpFailedCause:{SESSION_STARTED_FAILED:"SESSION_STARTED_FAILED",CONNECTION_LOST:"CONNECTION_LOST",SERVICE_ERROR:"SERVICE_ERROR",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",JOIN_FORBIDDEN:"JOIN_FORBIDDEN",SESSION_TERMINATED:"SESSION_TERMINATED",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED"},InviteCancelCause:{ACCEPT:"ACCEPT",BUSY:"BUSY",DECLINE:"DECLINE",REVOKED:"REVOKED"},InviteFailedCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT",NOT_REACHABLE:"NOT_REACHABLE",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE",REVOKED:"REVOKED"},InviteRejectCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT"},RTCProgressType:{ALERTING:"ALERTING",PROGRESS:"PROGRESS",EARLY_CONNECT:"EARLY_CONNECT"},DisconnectCause:{HANGUP:"HANGUP",CONNECTION_LOST:"CONNECTION_LOST",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED",STREAM_LOST:"STREAM_LOST",CALL_SETUP_FAILED:"CALL_SETUP_FAILED"},DisconnectReason:{PAGE_UNLOADED:"PAGE_UNLOADED",CALL_LOST:"CALL_LOST",LOGOUT:"LOGOUT"},RTCSessionActionType:{LOCK:"LOCK",MUTE_SESSION:"MUTE_SESSION",MUTE:"MUTE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",GET_ACTIVE_SESSIONS:"GET_ACTIVE_SESSIONS",GET_SESSION:"GET_SESSION",MOVE:"MOVE",START_RECORDING:"START_RECORDING",STOP_RECORDING:"STOP_RECORDING",GET_SESSIONID_BY_PIN:"GET_SESSIONID_BY_PIN",RAISE_QUESTION:"RAISE_QUESTION",INVITE_TO_STAGE:"INVITE_TO_STAGE",INVITE_TO_STAGE_ANSWER:"INVITE_TO_STAGE_ANSWER",UPDATE_QUESTION_STATE:"UPDATE_QUESTION_STATE",INVITE_TO_STAGE_CANCEL:"INVITE_TO_STAGE_CANCEL",REMOVE_FROM_STAGE:"REMOVE_FROM_STAGE",GET_QUESTIONS:"GET_QUESTIONS",OPEN_CURTAIN:"OPEN_CURTAIN",CLOSE_CURTAIN:"CLOSE_CURTAIN",GET_NODE_STATE:"GET_NODE_STATE",ENABLE_WHITEBOARD:"ENABLE_WHITEBOARD",DISABLE_WHITEBOARD:"DISABLE_WHITEBOARD",ADD_WHITEBOARD_ELEMENT:"ADD_WHITEBOARD_ELEMENT",REMOVE_WHITEBOARD_ELEMENT:"REMOVE_WHITEBOARD_ELEMENT",UPDATE_WHITEBOARD_ELEMENT:"UPDATE_WHITEBOARD_ELEMENT",CLEAR_WHITEBOARD:"CLEAR_WHITEBOARD",GET_WHITEBOARD:"GET_WHITEBOARD",SET_WHITEBOARD_BACKGROUND:"SET_WHITEBOARD_BACKGROUND",CLEAR_WHITEBOARD_BACKGROUND:"CLEAR_WHITEBOARD_BACKGROUND",TOGGLE_WHITEBOARD_OVERLAY:"TOGGLE_WHITEBOARD_OVERLAY",UNDO_WHITEBOARD:"UNDO_WHITEBOARD",SEND_CLIENT_INFO:"SEND_CLIENT_INFO",REQUEST_SCREEN_CONTROL:"REQUEST_SCREEN_CONTROL",REJECT_SCREEN_CONTROL_REQUEST:"REJECT_SCREEN_CONTROL_REQUEST",OFFER_SCREEN_CONTROL:"OFFER_SCREEN_CONTROL",ACCEPT_SCREEN_CONTROL:"ACCEPT_SCREEN_CONTROL",REJECT_SCREEN_CONTROL:"REJECT_SCREEN_CONTROL",STOP_SCREEN_CONTROL:"STOP_SCREEN_CONTROL",START_POLL:"START_POLL",GET_POLL:"GET_POLL",EDIT_POLL:"EDIT_POLL",VOTE_POLL:"VOTE_POLL",CLOSE_POLL:"CLOSE_POLL",RESUME_POLL:"RESUME_POLL",MAKE_POLL_RESULTS_VISIBLE:"MAKE_POLL_RESULTS_VISIBLE",STOP_POLL:"STOP_POLL",ENABLE_POLL:"ENABLE_POLL",DISABLE_POLL:"DISABLE_POLL",SWITCH_RECORDING_LAYOUT:"SWITCH_RECORDING_LAYOUT"},RTCSessionEventType:{SESSION_STARTED:"SESSION_STARTED",SESSION_TERMINATED:"SESSION_TERMINATED",SESSION_UPDATED:"SESSION_UPDATED",SESSION_MOVED:"SESSION_MOVED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",PARTICIPANT_UPDATED:"PARTICIPANT_UPDATED",ACTIVE_SPEAKER:"ACTIVE_SPEAKER",VIDEO_ACTIVE_SPEAKER:"VIDEO_ACTIVE_SPEAKER",SESSION_RECORDING_INFO:"SESSION_RECORDING_INFO",SESSION_RECORDING_STARTED:"SESSION_RECORDING_STARTED",SESSION_RECORDING_STOPPED:"SESSION_RECORDING_STOPPED",SESSION_RECORDING_FAILED:"SESSION_RECORDING_FAILED",SESSION_TERMINATION_TIMER_STARTED:"SESSION_TERMINATION_TIMER_STARTED",SESSION_TERMINATION_TIMER_CANCELLED:"SESSION_TERMINATION_TIMER_CANCELLED",SESSION_ATTRIBUTES_CHANGED_EVENT:"SESSION_ATTRIBUTES_CHANGED_EVENT",QUESTION_EVENT:"QUESTION_EVENT",INVITE_TO_STAGE_EVENT:"INVITE_TO_STAGE_EVENT",INVITE_TO_STAGE_CANCEL_EVENT:"INVITE_TO_STAGE_CANCEL_EVENT",CURTAIN_EVENT:"CURTAIN_EVENT",WHITEBOARD_ENABLED:"WHITEBOARD_ENABLED",WHITEBOARD_DISABLED:"WHITEBOARD_DISABLED",WHITEBOARD_ELEMENT_ADDED:"WHITEBOARD_ELEMENT_ADDED",WHITEBOARD_ELEMENT_REMOVED:"WHITEBOARD_ELEMENT_REMOVED",WHITEBOARD_ELEMENT_UPDATED:"WHITEBOARD_ELEMENT_UPDATED",WHITEBOARD_CLEARED:"WHITEBOARD_CLEARED",WHITEBOARD_BACKGROUND_SET:"WHITEBOARD_BACKGROUND_SET",WHITEBOARD_BACKGROUND_CLEARED:"WHITEBOARD_BACKGROUND_CLEARED",WHITEBOARD_OVERLAY_TOGGLED:"WHITEBOARD_OVERLAY_TOGGLED",WHITEBOARD_SYNC:"WHITEBOARD_SYNC",WHITEBOARD_CONVERSION_FAILED:"WHITEBOARD_CONVERSION_FAILED",SCREEN_CONTROL_REQUESTED:"SCREEN_CONTROL_REQUESTED",SCREEN_CONTROL_REQUEST_REJECTED:"SCREEN_CONTROL_REQUEST_REJECTED",SCREEN_CONTROL_OFFERED:"SCREEN_CONTROL_OFFERED",SCREEN_CONTROL_ACCEPTED:"SCREEN_CONTROL_ACCEPTED",SCREEN_CONTROL_REJECTED:"SCREEN_CONTROL_REJECTED",HANDOVER_SCREEN_CONTROL:"HANDOVER_SCREEN_CONTROL",SCREEN_CONTROL_TERMINATED:"SCREEN_CONTROL_TERMINATED",SCREEN_CONTROL_FAILED:"SCREEN_CONTROL_FAILED",POLL_STARTED:"POLL_STARTED",POLL_UPDATED:"POLL_UPDATED",POLL_CLOSED:"POLL_CLOSED",POLL_RESUMED:"POLL_RESUMED",POLL_STOPPED:"POLL_STOPPED",POLL_ENABLED:"POLL_ENABLED",POLL_DISABLED:"POLL_DISABLED"},RTCSessionTerminatedCause:{FORCED:"FORCED",NO_USERS_LEFT:"NO_USERS_LEFT",CONDITIONAL:"CONDITIONAL"},RTCSessionParticipantLeftCause:{LEFT:"LEFT",CONNECTION_LOST:"CONNECTION_LOST",REMOVED:"REMOVED",CONDITIONAL_TERMINATE:"CONDITIONAL_TERMINATE",FORCED_TERMINATE:"FORCED_TERMINATE",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED",USER_LEFT_STAGE:"USER_LEFT_STAGE",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",OFFER_NOT_ACCEPTED:"OFFER_NOT_ACCEPTED",STREAM_LOST:"STREAM_LOST",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",CALL_SETUP_FAILED:"CALL_SETUP_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED"},RTCSessionParticipantFlag:{CPU_LOAD:"CPU_LOAD",CPU_LOAD_TRANSCODE:"CPU_LOAD_TRANSCODE",NO_LICENSE:"NO_LICENSE",MAX_COUNT:"MAX_COUNT"},RtcSupportedFeatures:{UPGRADE_TO_CONFERENCE:"UPGRADE_TO_CONFERENCE",SCREEN_CONTROL:"SCREEN_CONTROL",SCREEN_CONTROLLER:"SCREEN_CONTROLLER",SCREEN_SHARE_AND_ACTIVE_SPEAKER_VIDEO:"SCREEN_SHARE_AND_ACTIVE_SPEAKER_VIDEO",MID_STREAM_MAPPING:"MID_STREAM_MAPPING",CALL_PICKUP:"CALL_PICKUP"},RealtimeMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",DESKTOP_SHARING:"DESKTOP_SHARING"},RTCParticipantType:{USER:"USER",EXTERNAL:"EXTERNAL",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",VOICE_MAIL:"VOICE_MAIL",TEST_CALL:"TEST_CALL"},QuestionState:{RAISED:"RAISED",ANSWERED:"ANSWERED",DISCARDED:"DISCARDED",ANSWER_LATER:"ANSWER_LATER"},StageState:{INITIAL:"INITIAL",INVITED:"INVITED",REJECTED:"REJECTED",ACCEPTED:"ACCEPTED",WAS_ON_STAGE:"WAS_ON_STAGE",TIMEOUT:"TIMEOUT",LEFT_CONFERENCE:"LEFT_CONFERENCE"},QuestionEventType:{CREATED:"CREATED",UPDATED:"UPDATED",REVOKED:"REVOKED"},StageAction:{USER_ENTERED_STAGE:"USER_ENTERED_STAGE",USER_LEFT_STAGE:"USER_LEFT_STAGE"},CurtainState:{OPEN:"OPEN",INITIAL:"INITIAL",FINAL:"FINAL",PAUSED:"PAUSED"},NodeType:{MEDIA_ACCESS:"MEDIA_ACCESS",APPLICATION:"APPLICATION",STORAGE:"STORAGE",ACCESS:"ACCESS",LOAD_BALANCER:"LOAD_BALANCER",ZOOKEEPER:"ZOOKEEPER",MANAGEMENT:"MANAGEMENT",OPERATIONS:"OPERATIONS"},NodeState:{UP:"UP",DOWN:"DOWN",OVERLOAD:"OVERLOAD",MAINTENANCE:"MAINTENANCE"},RecordingInfoState:{INITIAL:"INITIAL",START_PENDING:"START_PENDING",STARTED:"STARTED",STOPPED:"STOPPED",FINISHED:"FINISHED"},RecordingInfoReason:{NONE:"NONE",STOPPED_MANUALLY:"STOPPED_MANUALLY",STOPPED_AUTOMATICALLY:"STOPPED_AUTOMATICALLY",NO_INPUT_TIMEOUT:"NO_INPUT_TIMEOUT",MAX_INPUT_TIMEOUT:"MAX_INPUT_TIMEOUT",NO_STREAMING_DATA:"NO_STREAMING_DATA",LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_MORE_DISK_SPACE_LEFT:"NO_MORE_DISK_SPACE_LEFT",UNKNOWN_ERROR:"UNKNOWN_ERROR"},RecordingTriggerReason:{USER:"USER",CURTAIN:"CURTAIN"},RecordingVideoLayoutName:{SINGLE:"SINGLE",VIDEO_SCREEN_50_50:"VIDEO_SCREEN_50_50",VIDEO_SCREEN_75_25:"VIDEO_SCREEN_75_25",VIDEO_SCREEN_25_75:"VIDEO_SCREEN_25_75"},RtcClientInfoType:{OFFLINE_JOIN_FAILURE:"OFFLINE_JOIN_FAILURE",DEVICE_DIAGNOSTICS:"DEVICE_DIAGNOSTICS",CALL_CONNECTED:"CALL_CONNECTED"},RtcClientInfoReason:{NO_NETWORK_CONNECTION:"NO_NETWORK_CONNECTION",DISCONNECTED:"DISCONNECTED",FAILED_TO_SEND:"FAILED_TO_SEND",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",JOIN_DELAY:"JOIN_DELAY",CALL_CONNECTED:"CALL_CONNECTED"},RtcActionInfoType:{REQUEST_RESPONSE:"REQUEST_RESPONSE",EVENT:"EVENT"},RtcDiagnosticsAction:{RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",PREPARE:"PREPARE",JOIN:"JOIN",ICE_CANDIDATES:"ICE_CANDIDATES",SDP_CONNECTED:"SDP_CONNECTED",SDP_ANSWER:"SDP_ANSWER",REMOTE_ICE_CANDIDATES:"REMOTE_ICE_CANDIDATES"},SessionAttributesChangedEventType:{EVENT_ATTENDEE_COUNT_CHANGED:"EVENT_ATTENDEE_COUNT_CHANGED",SCREEN_CONTROL_REQUESTED:"SCREEN_CONTROL_REQUESTED",SCREEN_CONTROL_REQUEST_CLEARED:"SCREEN_CONTROL_REQUEST_CLEARED",SCREEN_CONTROL_ESTABLISHED:"SCREEN_CONTROL_ESTABLISHED",SCREEN_CONTROL_ENDED:"SCREEN_CONTROL_ENDED"},SearchActionType:{START_ADVANCED_USER_SEARCH:"START_ADVANCED_USER_SEARCH",START_BASIC_SEARCH:"START_BASIC_SEARCH",START_DETAIL_SEARCH:"START_DETAIL_SEARCH",START_USER_SEARCH:"START_USER_SEARCH",CANCEL_SEARCH:"CANCEL_SEARCH",ADD_RECENT_SEARCH:"ADD_RECENT_SEARCH",GET_RECENT_SEARCHES:"GET_RECENT_SEARCHES",SEARCH_CONVERSATION_PARTICIPANTS:"SEARCH_CONVERSATION_PARTICIPANTS"},SearchEventType:{BASIC_SEARCH_RESULT:"BASIC_SEARCH_RESULT",DETAILED_SEARCH_RESULT:"DETAILED_SEARCH_RESULT",SEARCH_STATUS:"SEARCH_STATUS",RECENT_SEARCH_ADDED:"RECENT_SEARCH_ADDED"},SystemActionType:{GET_GLOBAL_PROPERTY:"GET_GLOBAL_PROPERTY",GET_GLOBAL_PROPERTIES:"GET_GLOBAL_PROPERTIES"},SystemEventType:{BROADCAST:"BROADCAST",BROADCAST_REMOVED:"BROADCAST_REMOVED",MAINTENANCE:"MAINTENANCE",MAINTENANCE_REMOVED:"MAINTENANCE_REMOVED",MAINTENANCE_ADDED:"MAINTENANCE_ADDED"},GlobalPropertyName:{ATTACHMENT_UPLOAD_MAX_SIZE:"ATTACHMENT_UPLOAD_MAX_SIZE",CONV_PARTICIPANTS_MAX_SIZE:"CONV_PARTICIPANTS_MAX_SIZE",CONV_PARTICIPANTS_ADD_LIMIT:"CONV_PARTICIPANTS_ADD_LIMIT",XMPP_FEDERATION_ENABLED:"XMPP_FEDERATION_ENABLED",CLIENT_AUTOUPDATE_MAX_TIME:"CLIENT_AUTOUPDATE_MAX_TIME",ADD_TELEPHONY_CONNECTOR_DISABLED:"ADD_TELEPHONY_CONNECTOR_DISABLED",CHROME_EXTENSION_ID:"CHROME_EXTENSION_ID"},SearchTypes:{CONVERSATION:"CONVERSATION",USER:"USER"},SearchStatusCode:{ERROR:"ERROR",CANCELED:"CANCELED",FINISHED:"FINISHED",TIMEOUT:"TIMEOUT",NO_RESULT:"NO_RESULT",MORE_RESULT:"MORE_RESULT"},SearchResultType:{TOPIC_MATCH:"TOPIC_MATCH",USER_MATCH:"USER_MATCH",ATTACHMENT_MATCH:"ATTACHMENT_MATCH",ITEM_MATCH:"ITEM_MATCH"},SearchScope:{ALL:"ALL",PEOPLE:"PEOPLE",MEMBERS:"MEMBERS",MESSAGES:"MESSAGES",CONVERSATIONS:"CONVERSATIONS",FILES:"FILES",SENT_BY:"SENT_BY",DATE:"DATE",LABEL:"LABEL",FILTER:"FILTER"},SearchContext:{USER:"USER",MEETING_POINT:"MEETING_POINT"},UserActionType:{LOGON:"LOGON",LOGOUT:"LOGOUT",RENEW_TOKEN:"RENEW_TOKEN",GET_USER_BY_ID:"GET_USER_BY_ID",UPDATE:"UPDATE",GET_LOGGED_ON:"GET_LOGGED_ON",GET_STUFF:"GET_STUFF",SET_PRESENCE:"SET_PRESENCE",GET_PRESENCE:"GET_PRESENCE",SUBSCRIBE_PRESENCE:"SUBSCRIBE_PRESENCE",UNSUBSCRIBE_PRESENCE:"UNSUBSCRIBE_PRESENCE",CHANGE_PASSWORD:"CHANGE_PASSWORD",GET_USERS_BY_IDS:"GET_USERS_BY_IDS",GET_DEVICES:"GET_DEVICES",GET_USER_SETTINGS:"GET_USER_SETTINGS",SET_USER_SETTINGS:"SET_USER_SETTINGS",GET_USER_BY_MAIL:"GET_USER_BY_MAIL",GET_USERS_BY_MAILS:"GET_USERS_BY_MAILS",EMAIL_UPDATE:"EMAIL_UPDATE",GENERATE_EMAIL_UPDATE_TOKEN:"GENERATE_EMAIL_UPDATE_TOKEN",GET_TELEPHONY_DATA:"GET_TELEPHONY_DATA",GET_USER_EXTENSIONS:"GET_USER_EXTENSIONS",SET_USER_EXTENSION_STATE:"SET_USER_EXTENSION_STATE",GET_LDAP_TECHNICAL_USER_PRESENCE:"GET_LDAP_TECHNICAL_USER_PRESENCE",GET_ATTACHMENTS:"GET_ATTACHMENTS",SET_PASSWORD:"SET_PASSWORD",GET_TENANT_SETTINGS:"GET_TENANT_SETTINGS",SUBSCRIBE_DEVICES:"SUBSCRIBE_DEVICES",UNSUBSCRIBE_DEVICES:"UNSUBSCRIBE_DEVICES",OAUTH_GET_GRANTED_ACCESS_TOKENS:"OAUTH_GET_GRANTED_ACCESS_TOKENS",OAUTH_REVOKE_ACCESS_TOKEN:"OAUTH_REVOKE_ACCESS_TOKEN",REVOKE_MANAGED_DEVICES:"REVOKE_MANAGED_DEVICES",GET_SECURITY_TOKEN_INFO:"GET_SECURITY_TOKEN_INFO",REVOKE_SECURITY_TOKEN:"REVOKE_SECURITY_TOKEN",RESET_OPENSCAPE_DEVICE_PINS:"RESET_OPENSCAPE_DEVICE_PINS",SUBSCRIBE_TENANT_PRESENCE:"SUBSCRIBE_TENANT_PRESENCE",UNSUBSCRIBE_TENANT_PRESENCE:"UNSUBSCRIBE_TENANT_PRESENCE",GET_TENANT_ID_TO_NAME_MAP:"GET_TENANT_ID_TO_NAME_MAP",ADD_RECENT_USED_CMR:"ADD_RECENT_USED_CMR",GET_RECENT_USED_CMRS:"GET_RECENT_USED_CMRS",IS_ALLOWED_TO_ADD_CMR:"IS_ALLOWED_TO_ADD_CMR",WAKE_UP:"WAKE_UP",GO_TO_SLEEP:"GO_TO_SLEEP",SET_CLIENT_CAPABILITIES:"SET_CLIENT_CAPABILITIES"},UserEventType:{ATC_REFRESH_FAILED:"ATC_REFRESH_FAILED",USER_PRESENCE_CHANGE:"USER_PRESENCE_CHANGE",USER_UPDATED:"USER_UPDATED",SESSION_EXPIRES:"SESSION_EXPIRES",SESSION_EXPIRING:"SESSION_EXPIRING",SESSION_CLOSED:"SESSION_CLOSED",PASSWORD_CHANGED:"PASSWORD_CHANGED",USER_SETTING_UPDATED:"USER_SETTING_UPDATED",TELEPHONY_DATA:"TELEPHONY_DATA",DEVICE_LIST_CHANGED:"DEVICE_LIST_CHANGED",NOTIFICATION_SUBSCRIPTION_CHANGE:"NOTIFICATION_SUBSCRIPTION_CHANGE",TENANT_CONFIGURATION_UPDATED:"TENANT_CONFIGURATION_UPDATED",UCAAS_DEVICE_UPDATED:"UCAAS_DEVICE_UPDATED",TENANT_PRESENCE_CHANGE:"TENANT_PRESENCE_CHANGE",CMR_SETTINGS_UPDATED:"CMR_SETTINGS_UPDATED",CMR_COMMAND:"CMR_COMMAND",TELEPHONY_CHANGED:"TELEPHONY_CHANGED"},GetStuffType:{USER:"USER",ACCOUNTS:"ACCOUNTS",FIRST_WEB_LOGIN:"FIRST_WEB_LOGIN",PRESENCE_STATE:"PRESENCE_STATE",RECENT_SEARCHES:"RECENT_SEARCHES",SETTINGS:"SETTINGS",TENANT_DATA:"TENANT_DATA",SUPPORT_CONVERSATION_ID:"SUPPORT_CONVERSATION_ID",TELEPHONY_CONVERSATION_ID:"TELEPHONY_CONVERSATION_ID",GLOBAL_PROPERTIES:"GLOBAL_PROPERTIES",TENANT:"TENANT",NOTIFICATION_SUBSCRIPTIONS:"NOTIFICATION_SUBSCRIPTIONS",PENDING_SYSTEM_NOTIFICATIONS:"PENDING_SYSTEM_NOTIFICATIONS",SUPPORT_INFO:"SUPPORT_INFO",HAS_TENANT_MEETING_POINTS:"HAS_TENANT_MEETING_POINTS"},NotificationSubscriptionType:{ONLINE_STATUS:"ONLINE_STATUS"},NotificationSubscriptionAction:{SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},DeviceType:{PHONE:"PHONE",WEB:"WEB",APPLICATION:"APPLICATION",MOBILE:"MOBILE",SDK:"SDK",UNKNOWN:"UNKNOWN",SESSION_GUEST:"SESSION_GUEST"},PresenceState:{AVAILABLE:"AVAILABLE",OFFLINE:"OFFLINE",AWAY:"AWAY",BUSY:"BUSY",DND:"DND"},ChangePasswordResult:{OK:"OK",NEW_INVALID:"NEW_INVALID",OLD_INVALID:"OLD_INVALID",ALREADY_CHANGED:"ALREADY_CHANGED",OPERATION_ERROR:"OPERATION_ERROR"},SetPasswordResult:{OK:"OK",NOT_OK:"NOT_OK"},SessionClosedReason:{NEW_CONNECTION_DETECTED:"NEW_CONNECTION_DETECTED",UPGRADE_REQUIRED:"UPGRADE_REQUIRED",SUSPENDED:"SUSPENDED",DELETED:"DELETED",TENANT_DELETED:"TENANT_DELETED",TENANT_SUSPENDED:"TENANT_SUSPENDED"},RecordingStoppedReason:{LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_INPUT:"NO_INPUT"},RecordingUploadState:{IN_PROGRESS:"IN_PROGRESS",RETRYING:"RETRYING",FINISHED:"FINISHED",FAILED:"FAILED",DELETED:"DELETED"},UserRole:{GUEST:"GUEST",USER:"USER",TENANT_ADMIN:"TENANT_ADMIN",SUPPORT:"SUPPORT",SYSTEM_ADMIN:"SYSTEM_ADMIN",TELEPHONY_CONNECTOR:"TELEPHONY_CONNECTOR",VIRTUAL_TELEPHONY_CONNECTOR:"VIRTUAL_TELEPHONY_CONNECTOR",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",BOT:"BOT"},UserType:{REGULAR:"REGULAR",GUEST:"GUEST",SUPPORT:"SUPPORT",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",TECHNICAL:"TECHNICAL",BOT:"BOT",XMPP:"XMPP"},UserState:{INACTIVE:"INACTIVE",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED",PURGED:"PURGED"},Locale:{EN_US:"EN_US",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN",PT_BR:"PT_BR",NL_NL:"NL_NL"},PhoneNumberType:{WORK:"WORK",MOBILE:"MOBILE",HOME:"HOME",FAX:"FAX",OTHER:"OTHER",UCAAS:"UCAAS"},PhoneNumberNpi:{PUBLIC:"PUBLIC",PRIVATE:"PRIVATE"},EmailAddressType:{WORK:"WORK",HOME:"HOME",OTHER:"OTHER"},UserSettingArea:{ALL:"ALL",EMAIL:"EMAIL",DESKTOP:"DESKTOP",PRIVACY:"PRIVACY",CLIENT:"CLIENT"},UserSettingDataType:{BOOLEAN:"BOOLEAN",NUMBER:"NUMBER",STRING:"STRING",TIMESTAMP:"TIMESTAMP"},UserSettingKey:{EMAIL_INVITES:"EMAIL_INVITES",EMAIL_MISSED_RTC:"EMAIL_MISSED_RTC",EMAIL_SUMMARY:"EMAIL_SUMMARY",EMAIL_UPDATE:"EMAIL_UPDATE",DESKTOP_RTC:"DESKTOP_RTC",DESKTOP_MISSED_MESSAGE:"DESKTOP_MISSED_MESSAGE",DESKTOP_CONVERSATION_CHANGE:"DESKTOP_CONVERSATION_CHANGE",DESKTOP_SYSINFO:"DESKTOP_SYSINFO",SHARE_LOCATION:"SHARE_LOCATION",RELEASE_NOTES_WEB_VERSION:"RELEASE_NOTES_WEB_VERSION",RELEASE_NOTES_MOBILE_VERSION:"RELEASE_NOTES_MOBILE_VERSION",TM_WEB_START_CONV_WITH:"TM_WEB_START_CONV_WITH",TM_WEB_ENTER_NAME:"TM_WEB_ENTER_NAME",TM_WEB_CALL_ACTION_BUTTONS:"TM_WEB_CALL_ACTION_BUTTONS",TM_WEB_SUPPORT_FEEDBACK:"TM_WEB_SUPPORT_FEEDBACK",TM_WEB_SUPPORT_ISSUE:"TM_WEB_SUPPORT_ISSUE",TM_WEB_SCREEN_SHARING_ENABLED:"TM_WEB_SCREEN_SHARING_ENABLED",TM_WEB_SEARCH_FILTER:"TM_WEB_SEARCH_FILTER",AUDIO_WEB_SOUNDS:"AUDIO_WEB_SOUNDS",TM_WEB_OPEN_CONVERSATION:"TM_WEB_OPEN_CONVERSATION",TM_WEB_ADD_CONVERSATION_TITLE:"TM_WEB_ADD_CONVERSATION_TITLE",TM_WEB_RICH_TEXT_EDITING:"TM_WEB_RICH_TEXT_EDITING",TM_WEB_MUTE_CONVERSATION:"TM_WEB_MUTE_CONVERSATION",TM_WEB_VIEW_MUTED_CONVERSATIONS:"TM_WEB_VIEW_MUTED_CONVERSATIONS",TM_WEB_LEAVING_CONVERSATION:"TM_WEB_LEAVING_CONVERSATION",TM_WEB_FOCUS_MODE:"TM_WEB_FOCUS_MODE",TM_WEB_CONFERENCE_DIAL_IN:"TM_WEB_CONFERENCE_DIAL_IN",TM_WEB_REMOVING_PARTICIPANTS:"TM_WEB_REMOVING_PARTICIPANTS",TM_WEB_FULL_SCREEN_MODES:"TM_WEB_FULL_SCREEN_MODES",TM_WEB_ADD_MULTIPLE_USERS:"TM_WEB_ADD_MULTIPLE_USERS",TM_WEB_THIRD_COLUMN:"TM_WEB_THIRD_COLUMN",TM_WEB_RESERVE_1:"TM_WEB_RESERVE_1",TM_WEB_RESERVE_2:"TM_WEB_RESERVE_2",TM_IOS_SEARCH:"TM_IOS_SEARCH",MOBILE_ENABLE_VIDEO_WIFI_ONLY:"MOBILE_ENABLE_VIDEO_WIFI_ONLY",TM_WEB_ADMIN_TELEPHONY_ENABLED:"TM_WEB_ADMIN_TELEPHONY_ENABLED",TM_WEB_TELPHONY_NUMBER_ASSIGNED:"TM_WEB_TELPHONY_NUMBER_ASSIGNED",TM_WEB_ACTIVE_SPEAKER_VIDEO:"TM_WEB_ACTIVE_SPEAKER_VIDEO",TM_WEB_FIRST_DIRECT_CONVERSATION:"TM_WEB_FIRST_DIRECT_CONVERSATION",TM_WEB_FIRST_GROUP_CONVERSATION:"TM_WEB_FIRST_GROUP_CONVERSATION",TM_WEB_FIRST_CONV_ADD_PARTCPNTS:"TM_WEB_FIRST_CONV_ADD_PARTCPNTS",TM_WEB_FIRST_CONV_SET_NAME:"TM_WEB_FIRST_CONV_SET_NAME",TM_WEB_FIRST_CONV_START_CONV:"TM_WEB_FIRST_CONV_START_CONV",TM_WEB_INVITE_USERS:"TM_WEB_INVITE_USERS",TM_WEB_EMERGENCY_CALL_DISCLAIMER:"TM_WEB_EMERGENCY_CALL_DISCLAIMER",TM_WEB_FIRST_DIRECT_PRIVATE_CONV:"TM_WEB_FIRST_DIRECT_PRIVATE_CONV",TM_WEB_FIRST_DIRECT_CONV_SAY_HI:"TM_WEB_FIRST_DIRECT_CONV_SAY_HI",TM_WEB_FIRST_DIRECT_CONV_ADD:"TM_WEB_FIRST_DIRECT_CONV_ADD",TM_WEB_GUEST_ACCESS:"TM_WEB_GUEST_ACCESS",TM_WEB_SHARE_CONFERENCE_DETAILS:"TM_WEB_SHARE_CONFERENCE_DETAILS",TM_WEB_START_RECORDING:"TM_WEB_START_RECORDING",TM_WEB_STOP_RECORDING_INIT:"TM_WEB_STOP_RECORDING_INIT",TM_WEB_STOP_RECORDING_PART:"TM_WEB_STOP_RECORDING_PART",TM_WEB_FIRST_CONF_RING_ALL:"TM_WEB_FIRST_CONF_RING_ALL",TM_WEB_FIRST_CALL_ACTIONS:"TM_WEB_FIRST_CALL_ACTIONS",TM_WEB_FIRST_CALL_GO_TO_FEED:"TM_WEB_FIRST_CALL_GO_TO_FEED",TM_WEB_FIRST_CALL_FULLSCREEN:"TM_WEB_FIRST_CALL_FULLSCREEN",FIRST_WEB_LOGIN_TIMESTAMP:"FIRST_WEB_LOGIN_TIMESTAMP",VOICEMAIL_ENABLED:"VOICEMAIL_ENABLED",VOICEMAIL_TIMEOUT:"VOICEMAIL_TIMEOUT",STATUS_MESSAGE_TEXT:"STATUS_MESSAGE_TEXT",OPT_OUT_PRESENCE:"OPT_OUT_PRESENCE",SECOND_TELEPHONY_CALL_ROUTING:"SECOND_TELEPHONY_CALL_ROUTING",ATC_ROUTING:"ATC_ROUTING",VOICEMAIL_CUSTOMGREETING_ENABLED:"VOICEMAIL_CUSTOMGREETING_ENABLED",VOICEMAIL_CUSTOMGREETING_URI:"VOICEMAIL_CUSTOMGREETING_URI",DESKTOP_MESSAGE_NOTIFICATIONS_SETTING:"DESKTOP_MESSAGE_NOTIFICATIONS_SETTING",MOBILE_MESSAGE_NOTIFICATIONS_SETTING:"MOBILE_MESSAGE_NOTIFICATIONS_SETTING",PLAY_SOUND_MESSAGE_NOTIFICATIONS:"PLAY_SOUND_MESSAGE_NOTIFICATIONS",PLAY_SOUND_RTC:"PLAY_SOUND_RTC",PLAY_SYSTEM_SOUNDS:"PLAY_SYSTEM_SOUNDS",ENHANCED_DESKTOP_MESSAGE_NOTIFICATION:"ENHANCED_DESKTOP_MESSAGE_NOTIFICATION",ENHANCED_MOBILE_MESSAGE_NOTIFICATION:"ENHANCED_MOBILE_MESSAGE_NOTIFICATION",HIDE_PROFILE_EXTERNAL_ENABLED:"HIDE_PROFILE_EXTERNAL_ENABLED",PLAY_PICKUP_SOUND:"PLAY_PICKUP_SOUND",KEYBOARD_SHORTCUTS_ENABLED:"KEYBOARD_SHORTCUTS_ENABLED"},OAuthScope:{ALL:"ALL",CALLS:"CALLS",MENTION_EVENT:"MENTION_EVENT",READ_CONVERSATIONS:"READ_CONVERSATIONS",READ_USER:"READ_USER",READ_USER_PROFILE:"READ_USER_PROFILE",USER_MANAGEMENT:"USER_MANAGEMENT",WRITE_CONVERSATIONS:"WRITE_CONVERSATIONS",WRITE_USER_PROFILE:"WRITE_USER_PROFILE"},OAuthGrantTypes:{AUTHORIZATION_CODE:"AUTHORIZATION_CODE",IMPLICIT:"IMPLICIT",CLIENT_CREDENTIALS:"CLIENT_CREDENTIALS",RESOURCE_OWNER_CREDENTIALS:"RESOURCE_OWNER_CREDENTIALS",RESOURCE_OWNER:"RESOURCE_OWNER"},MessageNotificationsSetting:{ALL:0,DIRECT_AND_MENTIONS:1,NONE:2},EnhancedMessageNotificationsSetting:{ALL:-1,NONE:0,DIRECT:1,MENTION:2,FAVORITE:4},TelephonyChangeType:{ADDED:"ADDED",UPDATED:"UPDATED",REMOVED:"REMOVED"},AdministrationActionType:{INVITE_USER:"INVITE_USER",ADD_USER:"ADD_USER",INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",UPDATE_USER:"UPDATE_USER",DELETE_USER:"DELETE_USER",VALIDATE_USER_INVITATION_TOKEN:"VALIDATE_USER_INVITATION_TOKEN",ACTIVATE_INVITED_USER:"ACTIVATE_INVITED_USER",RESEND_USER_INVITATION:"RESEND_USER_INVITATION",CHECK_INVALID_TENANTS:"CHECK_INVALID_TENANTS",GET_TENANT:"GET_TENANT",GET_SHARED_KEY:"GET_SHARED_KEY",GET_TENANT_SETTINGS:"GET_TENANT_SETTINGS",SET_TENANT_SETTINGS:"SET_TENANT_SETTINGS",FIND_TENANT_SETTING:"FIND_TENANT_SETTING",SAVE_TENANT_LOGIN_PROVIDER:"SAVE_TENANT_LOGIN_PROVIDER",UPDATE_TENANT_LOGIN_PROVIDER:"UPDATE_TENANT_LOGIN_PROVIDER",DELETE_TENANT_LOGIN_PROVIDER:"DELETE_TENANT_LOGIN_PROVIDER",GET_ALL_TENANT_LOGIN_PROVIDERS:"GET_ALL_TENANT_LOGIN_PROVIDERS",GET_TENANT_LOGIN_PROVIDER_BY_PROVIDERID_AND_TENANTID:"GET_TENANT_LOGIN_PROVIDER_BY_PROVIDERID_AND_TENANTID",GET_TENANT_LOGIN_PROVIDER_CONFIGURATION_BY_PROVIDERID:"GET_TENANT_LOGIN_PROVIDER_CONFIGURATION_BY_PROVIDERID",SEND_TENANT_LOGIN_PROVIDER_EMAIL_NOTIFICATIONS:"SEND_TENANT_LOGIN_PROVIDER_EMAIL_NOTIFICATIONS",UPDATE_TENANT:"UPDATE_TENANT",ENABLE_PARTNER_ADMINISTRATION:"ENABLE_PARTNER_ADMINISTRATION",DISABLE_PARTNER_ADMINISTRATION:"DISABLE_PARTNER_ADMINISTRATION",GET_RESELLER_INFO:"GET_RESELLER_INFO",SET_SUPPORT_TYPE:"SET_SUPPORT_TYPE",SET_SUPPORT_EMAIL_ADDRESS:"SET_SUPPORT_EMAIL_ADDRESS",EXPORT_DATA_USER:"EXPORT_DATA_USER",EXPORT_DATA_TENANT:"EXPORT_DATA_TENANT",UPLOAD_EXTENSION_CONFIGURATION:"UPLOAD_EXTENSION_CONFIGURATION",GET_TENANT_EXTENSIONS:"GET_TENANT_EXTENSIONS",SET_EXTENSION_STATE:"SET_EXTENSION_STATE",DELETE_EXTENSION:"DELETE_EXTENSION",REGENERATE_API_KEY:"REGENERATE_API_KEY",ADD_API_TECHNICAL_USER:"ADD_API_TECHNICAL_USER",GET_CUSTOM_APPS:"GET_CUSTOM_APPS",ADD_CUSTOM_APP:"ADD_CUSTOM_APP",GET_PROVISIONED_TENANT_USERS:"GET_PROVISIONED_TENANT_USERS",CREATE_PROVISIONED_USER:"CREATE_PROVISIONED_USER",REMOVE_PROVISIONED_USER:"REMOVE_PROVISIONED_USER",UPDATE_PROVISIONED_USER:"UPDATE_PROVISIONED_USER",SET_TELEPHONY_STATUS:"SET_TELEPHONY_STATUS",SET_TELEPHONY_TRUNK_DATA:"SET_TELEPHONY_TRUNK_DATA",GET_TELEPHONY_TRUNK_STATUS:"GET_TELEPHONY_TRUNK_STATUS",GET_TENANT_BRIDGE_NUMBERS:"GET_TENANT_BRIDGE_NUMBERS",SET_TENANT_BRIDGE_NUMBERS:"SET_TENANT_BRIDGE_NUMBERS",GET_TECHNICAL_CREDENTIALS:"GET_TECHNICAL_CREDENTIALS",ADD_TRUNK:"ADD_TRUNK",GET_TENANT_TELEPHONY_CONFIGURATION:"GET_TENANT_TELEPHONY_CONFIGURATION",ADD_TRUNK_WITHOUT_PARAMETERS:"ADD_TRUNK_WITHOUT_PARAMETERS",SET_TRUNK_PASSWORD:"SET_TRUNK_PASSWORD",GET_TELEPHONY_ROUTING_RULES:"GET_TELEPHONY_ROUTING_RULES",ADD_TELEPHONY_ROUTING_RULE:"ADD_TELEPHONY_ROUTING_RULE",UPDATE_TELEPHONY_ROUTING_RULE:"UPDATE_TELEPHONY_ROUTING_RULE",REMOVE_TELEPHONY_ROUTING_RULE:"REMOVE_TELEPHONY_ROUTING_RULE",TEST_TELEPHONY_ROUTING_RULES:"TEST_TELEPHONY_ROUTING_RULES",UPDATE_TENANT_TELEPHONY_CONFIGURATION:"UPDATE_TENANT_TELEPHONY_CONFIGURATION",GET_TELEPHONY_TRUNK_GROUPS:"GET_TELEPHONY_TRUNK_GROUPS",GET_TELEPHONY_TRUNK_GROUP:"GET_TELEPHONY_TRUNK_GROUP",ADD_TELEPHONY_TRUNK_GROUP:"ADD_TELEPHONY_TRUNK_GROUP",REMOVE_TELEPHONY_TRUNK_GROUP:"REMOVE_TELEPHONY_TRUNK_GROUP",UPDATE_TELEPHONY_TRUNK_GROUP:"UPDATE_TELEPHONY_TRUNK_GROUP",ADD_TELEPHONY_TRUNK_TO_GROUP:"ADD_TELEPHONY_TRUNK_TO_GROUP",REMOVE_TELEPHONY_TRUNK_FROM_GROUP:"REMOVE_TELEPHONY_TRUNK_FROM_GROUP",GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCKS:"GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCKS",GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",ADD_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"ADD_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",UPDATE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"UPDATE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",REMOVE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"REMOVE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",SET_TENANT_VOICEMAIL_NUMBERS:"SET_TENANT_VOICEMAIL_NUMBERS",GET_TENANT_VOICEMAIL_NUMBERS:"GET_TENANT_VOICEMAIL_NUMBERS",UPDATE_TRUNK:"UPDATE_TRUNK",START_TRUNK_SOFT_SUSPENSION:"START_TRUNK_SOFT_SUSPENSION",CANCEL_TRUNK_SOFT_SUSPENSION:"CANCEL_TRUNK_SOFT_SUSPENSION",GET_TRUNK_ACTIVE_CALLS:"GET_TRUNK_ACTIVE_CALLS",SHARE_TRUNK_GROUP:"SHARE_TRUNK_GROUP",UNSHARE_TRUNK_GROUP:"UNSHARE_TRUNK_GROUP",GET_VACANT_HOME_DIRECTORY_NUMBERS:"GET_VACANT_HOME_DIRECTORY_NUMBERS",GET_VACANT_HOME_DIRECTORY_NUMBERS_OF_SITE:"GET_VACANT_HOME_DIRECTORY_NUMBERS_OF_SITE",CREATE_OPENSCAPE_USER:"CREATE_OPENSCAPE_USER",UPDATE_OPENSCAPE_USER:"UPDATE_OPENSCAPE_USER",DELETE_OPENSCAPE_USER:"DELETE_OPENSCAPE_USER",GET_OPENSCAPE_USER:"GET_OPENSCAPE_USER",GET_OPENSCAPE_USER_V2:"GET_OPENSCAPE_USER_V2",GET_OPENSCAPE_TENANT:"GET_OPENSCAPE_TENANT",DELETE_OPENSCAPE_SITES:"DELETE_OPENSCAPE_SITES",CREATE_OPENSCAPE_SITE:"CREATE_OPENSCAPE_SITE",UPDATE_OPENSCAPE_SITE:"UPDATE_OPENSCAPE_SITE",GET_OPENSCAPE_SITE:"GET_OPENSCAPE_SITE",DELETE_PUBLIC_NUMBER_RANGE:"DELETE_PUBLIC_NUMBER_RANGE",DELETE_OPENSCAPE_MSN_NUMBER:"DELETE_OPENSCAPE_MSN_NUMBER",DELETE_PRIVATE_NUMBER_RANGE:"DELETE_PRIVATE_NUMBER_RANGE",CREATE_HUNT_GROUP:"CREATE_HUNT_GROUP",GET_HUNT_GROUP:"GET_HUNT_GROUP",GET_TENANT_HUNT_GROUPS:"GET_TENANT_HUNT_GROUPS",GET_HUNT_GROUP_PILOT_CANDIDATES:"GET_HUNT_GROUP_PILOT_CANDIDATES",GET_HUNT_GROUP_MEMBER_CANDIDATES:"GET_HUNT_GROUP_MEMBER_CANDIDATES",UPDATE_HUNT_GROUP:"UPDATE_HUNT_GROUP",DELETE_HUNT_GROUP:"DELETE_HUNT_GROUP",UPDATE_HUNT_GROUP_LIST:"UPDATE_HUNT_GROUP_LIST",GET_OPENSCAPE_ITSP_TEMPLATES:"GET_OPENSCAPE_ITSP_TEMPLATES",CREATE_OPENSCAPE_ITSP:"CREATE_OPENSCAPE_ITSP",GET_OPENSCAPE_ITSP:"GET_OPENSCAPE_ITSP",GET_OPENSCAPE_ITSPS:"GET_OPENSCAPE_ITSPS",UPDATE_OPENSCAPE_ITSP:"UPDATE_OPENSCAPE_ITSP",DELETE_OPENSCAPE_ITSP:"DELETE_OPENSCAPE_ITSP",ASSIGN_OPENSCAPE_ITSP_TO_SITE:"ASSIGN_OPENSCAPE_ITSP_TO_SITE",UNASSIGN_OPENSCAPE_ITSP_TO_SITE:"UNASSIGN_OPENSCAPE_ITSP_TO_SITE",FIND_OPENSCAPE_SITES_BY_ITSP:"FIND_OPENSCAPE_SITES_BY_ITSP",GET_PICKUP_GROUP_MEMBER_CANDIDATES:"GET_PICKUP_GROUP_MEMBER_CANDIDATES",CREATE_PICKUP_GROUP:"CREATE_PICKUP_GROUP",GET_TENANT_PICKUP_GROUPS:"GET_TENANT_PICKUP_GROUPS",DELETE_PICKUP_GROUPS:"DELETE_PICKUP_GROUPS",GET_PICKUP_GROUP:"GET_PICKUP_GROUP",UPDATE_PICKUP_GROUP:"UPDATE_PICKUP_GROUP",CREATE_AUTOMATED_ATTENDANT_CONFIGURATION:"CREATE_AUTOMATED_ATTENDANT_CONFIGURATION",GET_AUTOMATED_ATTENDANT_CONFIGURATIONS:"GET_AUTOMATED_ATTENDANT_CONFIGURATIONS",GET_AUTOMATED_ATTENDANT_CONFIGURATION:"GET_AUTOMATED_ATTENDANT_CONFIGURATION",UPDATE_AUTOMATED_ATTENDANT_CONFIGURATION:"UPDATE_AUTOMATED_ATTENDANT_CONFIGURATION",DELETE_AUTOMATED_ATTENDANT_CONFIGURATIONS:"DELETE_AUTOMATED_ATTENDANT_CONFIGURATIONS",GET_THIRD_PARTY_DEVICE_INFO:"GET_THIRD_PARTY_DEVICE_INFO",IS_MSN_RESERVED:"IS_MSN_RESERVED",HAS_RESERVED_DNS_IN_SITE_RANGES:"HAS_RESERVED_DNS_IN_SITE_RANGES",GET_TENANT_EXECUTIVE_ASSISTANT_GROUPS:"GET_TENANT_EXECUTIVE_ASSISTANT_GROUPS",CREATE_EXECUTIVE_ASSISTANT_GROUP:"CREATE_EXECUTIVE_ASSISTANT_GROUP",GET_EXECUTIVE_ASSISTANT_GROUP_MEMBER_CANDIDATES:"GET_EXECUTIVE_ASSISTANT_GROUP_MEMBER_CANDIDATES",GET_EXECUTIVE_ASSISTANT_GROUP:"GET_EXECUTIVE_ASSISTANT_GROUP",GET_COMPOSER_CONNECTION_DETAILS:"GET_COMPOSER_CONNECTION_DETAILS",DELETE_EXECUTIVE_ASSISTANT_GROUPS:"DELETE_EXECUTIVE_ASSISTANT_GROUPS",CREATE_APPLICATION_FRAMEWORK_CONFIGURATION:"CREATE_APPLICATION_FRAMEWORK_CONFIGURATION",GET_APPLICATION_FRAMEWORK_CONFIGURATIONS:"GET_APPLICATION_FRAMEWORK_CONFIGURATIONS",GET_APPLICATION_FRAMEWORK_CONFIGURATION:"GET_APPLICATION_FRAMEWORK_CONFIGURATION",UPDATE_APPLICATION_FRAMEWORK_CONFIGURATION:"UPDATE_APPLICATION_FRAMEWORK_CONFIGURATION",DELETE_APPLICATION_FRAMEWORK_CONFIGURATIONS:"DELETE_APPLICATION_FRAMEWORK_CONFIGURATIONS",SUSPEND_USER:"SUSPEND_USER",UNSUSPEND_USER:"UNSUSPEND_USER",INVITE_PARTNER_USER:"INVITE_PARTNER_USER",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS",ADD_MEETING_POINT:"ADD_MEETING_POINT",ADD_MEETING_POINT_V2:"ADD_MEETING_POINT_V2",UPDATE_MEETING_POINT_V2:"UPDATE_MEETING_POINT_V2",SET_CMR_SETTINGS:"SET_CMR_SETTINGS",GET_CMR_SETTINGS:"GET_CMR_SETTINGS",GET_CMR_INFO_BY_ID:"GET_CMR_INFO_BY_ID",GET_CMR_INFO_BY_IDS:"GET_CMR_INFO_BY_IDS",SET_ADMIN_MANAGED_CMR_SETTINGS:"SET_ADMIN_MANAGED_CMR_SETTINGS",SET_ADMIN_MANAGED_CMR_SETTINGS_BY_IDS:"SET_ADMIN_MANAGED_CMR_SETTINGS_BY_IDS",SHARE_CMR:"SHARE_CMR",UNSHARE_CMR:"UNSHARE_CMR",GET_CMR_SHARED_TENANT_INFO:"GET_CMR_SHARED_TENANT_INFO",SEND_CMR_COMMAND:"SEND_CMR_COMMAND",GET_PARTNER_MANAGEABLE_TENANTS:"GET_PARTNER_MANAGEABLE_TENANTS",GET_SYSTEM_NOTIFICATIONS:"GET_SYSTEM_NOTIFICATIONS",ADD_SYSTEM_NOTIFICATION:"ADD_SYSTEM_NOTIFICATION",REMOVE_SYSTEM_NOTIFICATION:"REMOVE_SYSTEM_NOTIFICATION",UPDATE_SYSTEM_NOTIFICATION:"UPDATE_SYSTEM_NOTIFICATION"},InvitationResponseCode:{INVITATION_SEND:"INVITATION_SEND",INVITATION_NOT_SEND:"INVITATION_NOT_SEND",INVALID_USER_STATE:"INVALID_USER_STATE",EMAIL_ALREADY_EXISTS:"EMAIL_ALREADY_EXISTS",ACCOUNT_ASSIGNMENT_FAILED:"ACCOUNT_ASSIGNMENT_FAILED",ERROR:"ERROR",SYSTEM_OVERLOADED:"SYSTEM_OVERLOADED",EMAIL_ALREADY_EXISTS_ON_SAME_TENANT:"EMAIL_ALREADY_EXISTS_ON_SAME_TENANT",UNTRUSTED_PARTNER_TENANT:"UNTRUSTED_PARTNER_TENANT",XMPP_FEDERATED_USER_NOT_FOUND:"XMPP_FEDERATED_USER_NOT_FOUND",LICENSE_LIMIT_EXCEEDED:"LICENSE_LIMIT_EXCEEDED",LICENSE_ERROR:"LICENSE_ERROR"},InvitationStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},GetUsersOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetUsersSorting:{USER_NAME:"USER_NAME",DATA_USAGE:"DATA_USAGE",LAST_ACCESS:"LAST_ACCESS",ROLE:"ROLE",STATUS:"STATUS",PHONE_NUMBER_ASSIGNED:"PHONE_NUMBER_ASSIGNED",EMAIL:"EMAIL"},GetUsersSearchFor:{ROLE:"ROLE",STATUS:"STATUS",NAME:"NAME",PRIMARY_EMAIL:"PRIMARY_EMAIL"},SetRoleRole:{ADMIN:"ADMIN",USER:"USER"},AdministrationEventType:{INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS"},SupportType:{CONVERSATION:"CONVERSATION",NO_SUPPORT:"NO_SUPPORT",EMAIL:"EMAIL",PARTNER_ADMIN_EMAIL:"PARTNER_ADMIN_EMAIL"},SystemNotificationType:{MAINTENANCE:"MAINTENANCE",BROADCAST:"BROADCAST"},HuntType:{INIT:"INIT",LINEAR:"LINEAR",CIRCULAR_WITH_HUNT:"CIRCULAR_WITH_HUNT",UCD:"UCD",MANUAL:"MANUAL",PARALLEL:"PARALLEL",PARALLEL_SA:"PARALLEL_SA"},TenantSettingsType:{CREDENTIALS_LOGIN_ENABLED:"CREDENTIALS_LOGIN_ENABLED",TELEPHONY_CONFIG_CONVERSATION:"TELEPHONY_CONFIG_CONVERSATION",CLIENT_AUTO_UPDATE:"CLIENT_AUTO_UPDATE",HELP_URL:"HELP_URL",SDK_USAGE_ENABLED:"SDK_USAGE_ENABLED",OAUTH_ACCESS_ENABLED:"OAUTH_ACCESS_ENABLED",LOGIN_METHODS_AVAILABLE:"LOGIN_METHODS_AVAILABLE",DATA_RETENTION_PERIOD:"DATA_RETENTION_PERIOD",PLUGIN_SELF_MANAGED_ENABLED:"PLUGIN_SELF_MANAGED_ENABLED",PLUGIN_DESKTOP_APP_ENABLED:"PLUGIN_DESKTOP_APP_ENABLED",PLUGIN_IE_PLUGIN_ENABLED:"PLUGIN_IE_PLUGIN_ENABLED",PLUGIN_MICROSOFT_OUTLOOK_INTEGRATION_ENABLED:"PLUGIN_MICROSOFT_OUTLOOK_INTEGRATION_ENABLED",PLUGIN_CHROME_EXTENSION_ENABLED:"PLUGIN_CHROME_EXTENSION_ENABLED",EXTENSION_MICROSOFT_EXCHANGE_ENABLED:"EXTENSION_MICROSOFT_EXCHANGE_ENABLED",EXTENSION_BOX_ENABLED:"EXTENSION_BOX_ENABLED",EXTENSION_GOOGLE_DRIVE_ENABLED:"EXTENSION_GOOGLE_DRIVE_ENABLED",EXTENSION_SYNCPLICITY_ENABLED:"EXTENSION_SYNCPLICITY_ENABLED",EXTENSION_JABRA_ENABLED:"EXTENSION_JABRA_ENABLED",EXTENSION_OPEN_XCHANGE_ENABLED:"EXTENSION_OPEN_XCHANGE_ENABLED",EXTENSION_PLANTRONICS_ENABLED:"EXTENSION_PLANTRONICS_ENABLED",EXTENSION_VDI_ENABLED:"EXTENSION_VDI_ENABLED",LOOKUP_API_BLACKLISTED_DOMAINS:"LOOKUP_API_BLACKLISTED_DOMAINS",ROOT_DEVICES_ALLOWED:"ROOT_DEVICES_ALLOWED",DT_LEGAL_INFORMATION:"DT_LEGAL_INFORMATION",SSO_REDIRECT_URL:"SSO_REDIRECT_URL",EXTENSION_ONE_DRIVE_ENABLED:"EXTENSION_ONE_DRIVE_ENABLED",EXTENSION_SKYPE_FOR_BUSINESS_ENABLED:"EXTENSION_SKYPE_FOR_BUSINESS_ENABLED",PHONE_DIALOUT_CALLER_ID_PREFIX:"PHONE_DIALOUT_CALLER_ID_PREFIX",PHONE_DIALOUT_MODE:"PHONE_DIALOUT_MODE",PHONE_DIALOUT_ENABLED:"PHONE_DIALOUT_ENABLED",SKYPE4B_CLIENT_ID:"SKYPE4B_CLIENT_ID",SKYPE4B_ROOT_URL:"SKYPE4B_ROOT_URL",C4O_AUTO_UPDATE:"C4O_AUTO_UPDATE",DA_AUTO_UPDATE:"DA_AUTO_UPDATE",EXTENSION_SENNHEISER_ENABLED:"EXTENSION_SENNHEISER_ENABLED",MUTE_ON_ENTRY:"MUTE_ON_ENTRY",MUTE_ON_ENTRY_CMR:"MUTE_ON_ENTRY_CMR",MUTE_ON_ENTRY_OUTCALL:"MUTE_ON_ENTRY_OUTCALL",C4O_PRESENCE_SETTINGS:"C4O_PRESENCE_SETTINGS",EXTENSION_ZAPIER_ENABLED:"EXTENSION_ZAPIER_ENABLED",CLOUD_ISTP_DRAFT_NUMBER_LIMIT_ENABLED:"CLOUD_ISTP_DRAFT_NUMBER_LIMIT_ENABLED",REMOTE_CONTROL_ENABLED:"REMOTE_CONTROL_ENABLED",REMOTE_CONTROL_EXTERNAL_ENABLED:"REMOTE_CONTROL_EXTERNAL_ENABLED",EXTENSION_EMBRAVA_ENABLED:"EXTENSION_EMBRAVA_ENABLED",EXTENSION_CONCEPTBOARD_ENABLED:"EXTENSION_CONCEPTBOARD_ENABLED",DATA_RETENTION_STRATEGY:"DATA_RETENTION_STRATEGY",PLANTRONICS_HUB_DOWNLOAD_URL:"PLANTRONICS_HUB_DOWNLOAD_URL",INCOMING_WEBHOOKS_ENABLED:"INCOMING_WEBHOOKS_ENABLED",CONVERSATION_RETENTION_POLICY_CHANGEABLE:"CONVERSATION_RETENTION_POLICY_CHANGEABLE",EXTENSION_GOOGLE_CONTACTS_ENABLED:"EXTENSION_GOOGLE_CONTACTS_ENABLED",EXTENSION_JPL_ENABLED:"EXTENSION_JPL_ENABLED",SCREENSHARE_DISABLED:"SCREENSHARE_DISABLED",FILESHARE_DISABLED:"FILESHARE_DISABLED",SUPPRESS_JOIN_INDICATION_THRESHOLD:"SUPPRESS_JOIN_INDICATION_THRESHOLD"},TenantConfigurableTextType:{GUEST_ACCESS_ACCEPTANCE_TEXT:"GUEST_ACCESS_ACCEPTANCE_TEXT",USER_INVITE_ACCEPTANCE_TEXT:"USER_INVITE_ACCEPTANCE_TEXT"},TrunkState:{UP:"UP",DOWN:"DOWN",NOT_REQUESTED:"NOT_REQUESTED",REQUESTED:"REQUESTED",SUSPENDING:"SUSPENDING"},GtcTrunkType:{GTC_TRUNK_TYPE:"GTC_TRUNK_TYPE",ETC_TRUNK_TYPE:"ETC_TRUNK_TYPE",ATC_TRUNK_TYPE:"ATC_TRUNK_TYPE",EMBEDDED_TC_TRUNK_TYPE:"EMBEDDED_TC_TRUNK_TYPE",OSBIZ_TRUNK_TYPE:"OSBIZ_TRUNK_TYPE",SUB_TRUNK_TYPE:"SUB_TRUNK_TYPE"},TelephonyRoutingRuleCriteria:{ORIGIN:"ORIGIN",DESTINATION:"DESTINATION"},TelephonyRoutingRuleOperator:{AND:"AND",OR:"OR"},TelephonyRoutingRuleApplication:{TELEPHONY:"TELEPHONY",CONF_DIAL_OUT:"CONF_DIAL_OUT",BOTH:"BOTH"},TelephonyConfigurationDefaultRouting:{ANY:"ANY",NONE:"NONE"},TelephonyRoutingRuleResult:{NO_MATCH:"NO_MATCH",MATCH:"MATCH",SELECTED:"SELECTED"},ProviderType:{CREDENTIALS:"CREDENTIALS",SAML:"SAML",OPENID:"OPENID"},PhoneDialoutMode:{PHONE_USERS_ONLY:"PHONE_USERS_ONLY",ALL_USERS:"ALL_USERS"},RemoveTrunkGroupResult:{SUCCESS:"SUCCESS",REFERENCES_EXIST:"REFERENCES_EXIST",UNKNOWN_ERROR:"UNKNOWN_ERROR"},CMRSettingKey:{CMR_ADDRESS:"CMR_ADDRESS",CMR_PLATFORM_VERSION:"CMR_PLATFORM_VERSION",CMR_OS_VERSION:"CMR_OS_VERSION",CMR_APP_VERSION:"CMR_APP_VERSION",CMR_MAC_ADDRESS:"CMR_MAC_ADDRESS",VIDEO_DEVICE:"VIDEO_DEVICE",AUDIO_DEVICE:"AUDIO_DEVICE",PRIMARY_DISPLAY:"PRIMARY_DISPLAY",SECONDARY_DISPLAY:"SECONDARY_DISPLAY",UPDATE_SERVER_STATUS:"UPDATE_SERVER_STATUS",PLAYBACK_DEVICE:"PLAYBACK_DEVICE",RECORDING_DEVICE:"RECORDING_DEVICE"},AdminManagedCMRSettingKey:{CMR_UDP_QOS:"CMR_UDP_QOS",CMR_UDP_AUDIO_DSCP:"CMR_UDP_AUDIO_DSCP",CMR_UDP_VIDEO_DSCP:"CMR_UDP_VIDEO_DSCP",CMR_TCP_QOS:"CMR_TCP_QOS",CMR_TCP_AUDIO_DSCP:"CMR_TCP_AUDIO_DSCP",CMR_TCP_VIDEO_DSCP:"CMR_TCP_VIDEO_DSCP",MANUAL_TIME:"MANUAL_TIME",TIMEZONE:"TIMEZONE",DATE:"DATE",TIME:"TIME",NTP_SERVER:"NTP_SERVER",REMOTE_ACCESS:"REMOTE_ACCESS",ENERGY_SAVING:"ENERGY_SAVING",SUSPEND_AFTER:"SUSPEND_AFTER",DASHBOARD_PASSWORD:"DASHBOARD_PASSWORD",SW_UPDATE_INFO:"SW_UPDATE_INFO",CMR_MANUAL_QOS_PORTS:"CMR_MANUAL_QOS_PORTS",CMR_UDP_AUDIO_START_PORT:"CMR_UDP_AUDIO_START_PORT",CMR_UDP_AUDIO_END_PORT:"CMR_UDP_AUDIO_END_PORT",CMR_UDP_VIDEO_START_PORT:"CMR_UDP_VIDEO_START_PORT",CMR_UDP_VIDEO_END_PORT:"CMR_UDP_VIDEO_END_PORT",CMR_TCP_AUDIO_START_PORT:"CMR_TCP_AUDIO_START_PORT",CMR_TCP_AUDIO_END_PORT:"CMR_TCP_AUDIO_END_PORT",CMR_TCP_VIDEO_START_PORT:"CMR_TCP_VIDEO_START_PORT",CMR_TCP_VIDEO_END_PORT:"CMR_TCP_VIDEO_END_PORT",SW_UPDATE_PENDING:"SW_UPDATE_PENDING",RESTART_PENDING:"RESTART_PENDING",TRAPS_ENABLED:"TRAPS_ENABLED",SNMP_USERNAME:"SNMP_USERNAME",AUTHENTICATION_PASSWORD:"AUTHENTICATION_PASSWORD",ENCRYPTION_PASSWORD:"ENCRYPTION_PASSWORD",TRAP_DESTINATION_1:"TRAP_DESTINATION_1",TRAP_DESTINATION_2:"TRAP_DESTINATION_2",NO_AUDIO_CONNECTED_ENABLED:"NO_AUDIO_CONNECTED_ENABLED",NO_VIDEO_CONNECTED_ENABLED:"NO_VIDEO_CONNECTED_ENABLED"},UcaasDeviceStatus:{NO_DEVICE:"NO_DEVICE",NOT_CONFIGURED:"NOT_CONFIGURED",CONFIGURED:"CONFIGURED"},DeviceTypeAssigned:{NONE:"NONE",UNIFY:"UNIFY",THIRD_PARTY:"THIRD_PARTY"},OpenscapeDirectoryNumberUsage:{MLHG_MEMBER:"MLHG_MEMBER",MLHG_PILOT:"MLHG_PILOT",PICKUP_MEMBER:"PICKUP_MEMBER",AA_MEMBER:"AA_MEMBER"},StatisticsTypes:{ACCOUNT_FLUX:"account-flux",ACCOUNT_STATUS:"account-status",CDR_STATS:"cdr-stats",DAILY_LOGINS_BY_DEVICE_SUB_TYPE:"daily-logins-by-device-sub-type",DAILY_LOGINS_BY_DEVICE_TYPE_VERSION:"daily-logins-by-device-type-version",DISCONNECT_CAUSE_BY_DEV_TYPE:"disconnect-cause-by-dev-type",DOCUMENTATION:"documentation",ITEM_ACTIVITY:"item-activity",USER_ADOPTION:"user-adoption",MINUTES_BY_MEDIA_STACKED:"minutes-by-media-stacked",QOS_METRIC_HISTOGRAM:"qos-metric-histogram",RATINGS_INTERVAL_STATS:"ratings-interval-stats",RATINGS_PIE_STATS:"ratings-pie-stats"},StatisticsTimePeriod:{TODAY:"TODAY",ONE_WEEK:"ONE_WEEK",TWO_WEEKS:"TWO_WEEKS",THREE_WEEKS:"THREE_WEEKS",FOUR_WEEKS:"FOUR_WEEKS"},StatisticsQosMetric:{MOS:"MOS",LA:"LA",JI:"JI",PLL:"PLL",PLR:"PLR"},ThirdPartyConnectorsActionType:{GET_SETTINGS:"GET_SETTINGS",SAVE_SETTINGS:"SAVE_SETTINGS",CONNECT:"CONNECT",DISCONNECT:"DISCONNECT",SEND_AUTH_CODE:"SEND_AUTH_CODE",GET_CONNECTION_STATUS:"GET_CONNECTION_STATUS",GET_FOLDER_ITEMS:"GET_FOLDER_ITEMS",SHARE_FOLDER_ITEMS:"SHARE_FOLDER_ITEMS",UNSHARE_FOLDER_ITEMS:"UNSHARE_FOLDER_ITEMS",GET_EDIT_URL:"GET_EDIT_URL",GET_FOLDER_ITEMS_WITH_CURSOR:"GET_FOLDER_ITEMS_WITH_CURSOR",CONNECT_STORAGE:"CONNECT_STORAGE",REFRESH_CONNECTION:"REFRESH_CONNECTION",GET_OAUTH_DATA:"GET_OAUTH_DATA"},ThirdPartyConnectorType:{EXCHANGE_CONNECTOR:"EXCHANGE_CONNECTOR",BOX:"BOX",OPEN_XCHANGE:"OPEN_XCHANGE",GOOGLE_CONTACTS:"GOOGLE_CONTACTS",GOOGLE_DRIVE:"GOOGLE_DRIVE",SYNCPLICITY:"SYNCPLICITY",ONE_DRIVE:"ONE_DRIVE",CLIENT_THIRDPARTY:"CLIENT_THIRDPARTY",ZAPIER:"ZAPIER",CONCEPTBOARD:"CONCEPTBOARD"},ThirdPartyEventType:{CONNECTED_TO_THIRDPARTY:"CONNECTED_TO_THIRDPARTY",DISCONNECTED_FROM_THIRDPARTY:"DISCONNECTED_FROM_THIRDPARTY"},ThirdPartyContentType:{SKYPE4B:"SKYPE4B"},Skype4BAuthentication:{BASIC:"BASIC",AZUREAD:"AZUREAD"},GuestActionType:{VALIDATE_SESSION_INVITE_TOKEN:"VALIDATE_SESSION_INVITE_TOKEN",REGISTER_SESSION_GUEST:"REGISTER_SESSION_GUEST",GET_REGIONS:"GET_REGIONS"},SessionInviteInfoResult:{INVALID:"INVALID",VALID_NOSESSION:"VALID_NOSESSION",VALID_SESSION:"VALID_SESSION",VALID_NO_GUEST_ACCESS:"VALID_NO_GUEST_ACCESS"},UserRoutingMessageType:{ATC:"ATC",CMP:"CMP",CONTACT_CARD:"CONTACT_CARD",DESKTOP_APP:"DESKTOP_APP",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",SDK:"SDK",STC:"STC"},VersionActionType:{GET_VERSION:"GET_VERSION"},AccountActionType:{GET_PACKAGE_TEMPLATES:"GET_PACKAGE_TEMPLATES",GET_ASSIGNED_PACKAGES:"GET_ASSIGNED_PACKAGES",VALIDATE_ASSIGN_ACCOUNT_TEMPLATE:"VALIDATE_ASSIGN_ACCOUNT_TEMPLATE",ASSIGN_ACCOUNT_TEMPLATE:"ASSIGN_ACCOUNT_TEMPLATE",VALIDATE_MIGRATE_ACCOUNT:"VALIDATE_MIGRATE_ACCOUNT",MIGRATE_ACCOUNT:"MIGRATE_ACCOUNT",MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",GET_ACCOUNTS:"GET_ACCOUNTS",GET_SEARCH_TAGS:"GET_SEARCH_TAGS",SUSPEND_ACCOUNT:"SUSPEND_ACCOUNT",UNSUSPEND_ACCOUNT:"UNSUSPEND_ACCOUNT",ASSIGN_TELEPHONY_CONFIGURATION:"ASSIGN_TELEPHONY_CONFIGURATION",DELETE_TELEPHONY_CONFIGURATION:"DELETE_TELEPHONY_CONFIGURATION",GET_ACCOUNT_BY_ID:"GET_ACCOUNT_BY_ID",GET_ACCOUNT_BY_USER_ID:"GET_ACCOUNT_BY_USER_ID",GET_TECHNICAL_ADMIN_USER_ID:"GET_TECHNICAL_ADMIN_USER_ID",RENEW_ASSOCIATED_TELEPHONY_USER:"RENEW_ASSOCIATED_TELEPHONY_USER",ADD_ACCOUNT_PERMISSION:"ADD_ACCOUNT_PERMISSION",REMOVE_ACCOUNT_PERMISSION:"REMOVE_ACCOUNT_PERMISSION"},UserDataActionType:{GET_USER_DATA:"GET_USER_DATA"},AccountEventType:{MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",TELEPHONY_CONFIGURATION_UPDATED:"TELEPHONY_CONFIGURATION_UPDATED",TC_BALANCING_NEEDED:"TC_BALANCING_NEEDED",TC_START_REASSIGNMENT:"TC_START_REASSIGNMENT"},AccountTemplateName:{USER:"USER",ADMIN:"ADMIN",MEETING_POINT:"MEETING_POINT",XMPP_FEDERATED_USER:"XMPP_FEDERATED_USER"},AccountStatus:{NONE:"NONE",CREATED:"CREATED",INITIAL:"INITIAL",INVITED:"INVITED",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED"},GetAccountsOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetAccountsSorting:{BY_FIRST_NAME:"BY_FIRST_NAME",BY_LAST_NAME:"BY_LAST_NAME",BY_NAME:"BY_NAME",BY_PRIMARY_EMAIL:"BY_PRIMARY_EMAIL",BY_PHONE_NUMBER:"BY_PHONE_NUMBER",BY_LAST_LOGIN:"BY_LAST_LOGIN",BY_LOCATION:"BY_LOCATION"},GetAccountsFilterCriteria:{PRIMARY_EMAIL:"PRIMARY_EMAIL",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",STATUS:"STATUS",TAG:"TAG",TELEPHONY_USER_ID:"TELEPHONY_USER_ID",TELEPHONY_TRUNK_GROUP_ID:"TELEPHONY_TRUNK_GROUP_ID"},SystemPermission:{IGNORE:"IGNORE",CLIENT_LOGON:"CLIENT_LOGON",INVITE_USER:"INVITE_USER",ROLE_TELEPHONY_CONNECTOR:"ROLE_TELEPHONY_CONNECTOR",ROLE_VIRTUAL_TELEPHONY_CONNECTOR:"ROLE_VIRTUAL_TELEPHONY_CONNECTOR",ROLE_TECHNICAL:"ROLE_TECHNICAL",ROLE_SESSION_GUEST:"ROLE_SESSION_GUEST",ROLE_USER:"ROLE_USER",ROLE_TENANT_ADMIN:"ROLE_TENANT_ADMIN",ROLE_SUPPORT:"ROLE_SUPPORT",ROLE_SYSTEM_ADMIN:"ROLE_SYSTEM_ADMIN",MANAGE_TENANT:"MANAGE_TENANT",TELEPHONY:"TELEPHONY",RECORDING:"RECORDING",MODERATION:"MODERATION",GUEST_ACCESS:"GUEST_ACCESS",MAX_PACKAGE_ACCOUNTS:"MAX_PACKAGE_ACCOUNTS",FREE_TRIAL:"FREE_TRIAL",USER_STORAGE:"USER_STORAGE",INTEGRATIONS:"INTEGRATIONS",RTC_PARTICIPANTS:"RTC_PARTICIPANTS",ACCOUNTS:"ACCOUNTS",IE_PLUGIN_SUPPORT:"IE_PLUGIN_SUPPORT",SUPPORT_CONVERSATION:"SUPPORT_CONVERSATION",SUPPORT_FORUM:"SUPPORT_FORUM",OUTLOOK_PLUGIN:"OUTLOOK_PLUGIN",TENANT_STORAGE:"TENANT_STORAGE",PSTN_DIAL_IN:"PSTN_DIAL_IN",LDAP_AGENT:"LDAP_AGENT",INVITE_PARTNER:"INVITE_PARTNER",LARGE_CONFERENCE:"LARGE_CONFERENCE",CREATE_COMMUNITY:"CREATE_COMMUNITY",CONTENT_MODERATOR:"CONTENT_MODERATOR",ANALYTICS:"ANALYTICS",VIEW_OPEN_CONVERSATION:"VIEW_OPEN_CONVERSATION",SSO:"SSO",IE_PLUGIN_SUPPORT_LIMITATION:"IE_PLUGIN_SUPPORT_LIMITATION",ROLE_MEETING_POINT:"ROLE_MEETING_POINT",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",UCAAS:"UCAAS",UCAAS_MLHG_QUEUING:"UCAAS_MLHG_QUEUING",PARTNER_ADMIN:"PARTNER_ADMIN",DEVELOPER_CONSOLE_ACCESS:"DEVELOPER_CONSOLE_ACCESS",S4B_INTEGRATION:"S4B_INTEGRATION",RTC_WHITE_BOARD:"RTC_WHITE_BOARD",SCREEN_CONTROL:"SCREEN_CONTROL",TENANT_ANALYTICS:"TENANT_ANALYTICS",HD_VIDEO:"HD_VIDEO",HD_SCREENSHARE:"HD_SCREENSHARE"},PermissionType:{TENANT_QUOTA:"TENANT_QUOTA",USER_QUOTA:"USER_QUOTA",FEATURE:"FEATURE",OVERALL_PACKAGE_QUOTA:"OVERALL_PACKAGE_QUOTA",OVERALL_PACKAGE_FEATURE:"OVERALL_PACKAGE_FEATURE",RESTRICTION:"RESTRICTION"},MigrateMultipleStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},MigrateResponseCode:{NULL_PARAMETER:"NULL_PARAMETER",ACCOUNT_DOES_NOT_EXIST:"ACCOUNT_DOES_NOT_EXIST",TECHNICAL_ACCOUNT_NOT_ALLOWED:"TECHNICAL_ACCOUNT_NOT_ALLOWED",ACCOUNT_TEMPLATE_DOES_NOT_EXIST:"ACCOUNT_TEMPLATE_DOES_NOT_EXIST",ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT:"ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT",MAXIMUM_ACCOUNTS_REACHED:"MAXIMUM_ACCOUNTS_REACHED",ERROR:"ERROR",OK:"OK",OK_NO_CHANGES:"OK_NO_CHANGES"},ActivityStreamActionType:{CREATE_MENTION:"CREATE_MENTION",GET_MENTIONS_BY_USER:"GET_MENTIONS_BY_USER",GET_ACTIVITIES_BY_USER:"GET_ACTIVITIES_BY_USER",UPDATE_ACTIVITY_READ:"UPDATE_ACTIVITY_READ",MARK_ALL_READ:"MARK_ALL_READ"},ActivityStreamEventType:{ACTIVITY_CREATED:"ACTIVITY_CREATED",ACTIVITY_MARKED_READ:"ACTIVITY_MARKED_READ",ACTIVITY_MARKED_UNREAD:"ACTIVITY_MARKED_UNREAD",ACTIVITY_DELETED:"ACTIVITY_DELETED",ACTIVITY_MARK_ALL_READ:"ACTIVITY_MARK_ALL_READ"},ConversationUserDataEventType:{LABELS_ADDED:"LABELS_ADDED",LABELS_REMOVED:"LABELS_REMOVED",LABEL_EDITED:"LABEL_EDITED",FILTERS_REMOVED:"FILTERS_REMOVED",FILTER_ADDED:"FILTER_ADDED",FILTER_EDITED:"FILTER_EDITED"},SpaceActionType:{CREATE:"CREATE",GET_ACTION:"GET_ACTION"},CPaaSActionType:{SUBMIT_FORM_DATA:"SUBMIT_FORM_DATA",GET_OAUTH_APPLICATIONS:"GET_OAUTH_APPLICATIONS",CREATE_OAUTH_APPLICATION:"CREATE_OAUTH_APPLICATION",GET_OAUTH_APPLICATION:"GET_OAUTH_APPLICATION",DELETE_OAUTH_APPLICATION:"DELETE_OAUTH_APPLICATION",SUSPEND_OAUTH_APPLICATION:"SUSPEND_OAUTH_APPLICATION",UNSUSPEND_OAUTH_APPLICATION:"UNSUSPEND_OAUTH_APPLICATION",UPDATE_OAUTH_APPLICATION:"UPDATE_OAUTH_APPLICATION",RECREATE_CLIENT_SECRET:"RECREATE_CLIENT_SECRET",DELETE_USER_FROM_OAUTH_APPLICATION:"DELETE_USER_FROM_OAUTH_APPLICATION",ADD_USER_TO_OAUTH_APPLICATION:"ADD_USER_TO_OAUTH_APPLICATION",CREATE_INCOMING_WEBHOOK:"CREATE_INCOMING_WEBHOOK",GET_INCOMING_WEBHOOK:"GET_INCOMING_WEBHOOK",GET_INCOMING_WEBHOOKS:"GET_INCOMING_WEBHOOKS",UPDATE_INCOMING_WEBHOOK:"UPDATE_INCOMING_WEBHOOK",DELETE_INCOMING_WEBHOOK:"DELETE_INCOMING_WEBHOOK",SUSPEND_INCOMING_WEBHOOK:"SUSPEND_INCOMING_WEBHOOK",UNSUSPEND_INCOMING_WEBHOOK:"UNSUSPEND_INCOMING_WEBHOOK"},CPaaSEventType:{SUBMIT_FORM_DATA:"SUBMIT_FORM_DATA"},CPaaSFormMetaDataControlType:{LABEL:"LABEL",BUTTON:"BUTTON",RADIO:"RADIO",CHECKBOX:"CHECKBOX",DROPDOWN:"DROPDOWN",INPUT:"INPUT",SPACER:"SPACER"},CPasSIncomingWebhookFilter:{TENANT:"TENANT",USER:"USER",CONVERSATION:"CONVERSATION"},TeamEventType:{NOTIFY:"NOTIFY",NOTIFY_CANCEL:"NOTIFY_CANCEL"},LabFeatureName:{ACTIVE_WHITEBOARD:"ACTIVE_WHITEBOARD",ADD_CMR_NEW_FLOW:"ADD_CMR_NEW_FLOW",ADD_CMR_VIA_QR_CODE:"ADD_CMR_VIA_QR_CODE",ANR_WATCHDOG:"ANR_WATCHDOG",ANSWER_CALL_SCREEN:"ANSWER_CALL_SCREEN",AUTHENTICATION_SETTINGS:"AUTHENTICATION_SETTINGS",BROADCAST_MESSAGES:"BROADCAST_MESSAGES",CONFERENCE_POLL:"CONFERENCE_POLL",DARK_MODE:"DARK_MODE",DIRECT_TO_CONF_UPGRADE:"DIRECT_TO_CONF_UPGRADE",DISABLE_CALL_KIT:"DISABLE_CALL_KIT",DUTCH_LANGUAGE:"DUTCH_LANGUAGE",DYNAMIC_RESOLUTION:"DYNAMIC_RESOLUTION",EDGE_WEBRTC:"EDGE_WEBRTC",EXPORT_LEGAL_DATA:"EXPORT_LEGAL_DATA",FLOATING_ONGOING_CALL_CONTROL:"FLOATING_ONGOING_CALL_CONTROL",GOOGLE_CONTACTS:"GOOGLE_CONTACTS",GUEST_ON_BOARDING:"GUEST_ON_BOARDING",HASHTAGS:"HASHTAGS",HEADER_STATUS_NOTIFICATION:"HEADER_STATUS_NOTIFICATION",IN_CALL_SIDEBAR:"IN_CALL_SIDEBAR",IN_CONTEXT_SIDEBAR_PARTICIPANTS:"IN_CONTEXT_SIDEBAR_PARTICIPANTS",INCOMING_WEBHOOKS:"INCOMING_WEBHOOKS",IP_HANDLING_POLICY:"IP_HANDLING_POLICY",JABRA_NODE_MODULE_SDK:"JABRA_NODE_MODULE_SDK",JPL_HEADSET_INTEGRATION:"JPL_HEADSET_INTEGRATION",LANDSCAPE_MODE:"LANDSCAPE_MODE",LEAK_CANARY:"LEAK_CANARY",LOCK_SCREEN_CALL_CONTROL:"LOCK_SCREEN_CALL_CONTROL",MUTABLE_APN:"MUTABLE_APN",NEW_LOGIN_VIEW:"NEW_LOGIN_VIEW",NEW_PHONE_CALLS_VIEW:"NEW_PHONE_CALLS_VIEW",OPEN_XCHANGE:"OPEN_XCHANGE",ORGANISE_CONTENT:"ORGANISE_CONTENT",OSBIZ_EXTENDED_TELEPHONY:"OSBIZ_EXTENDED_TELEPHONY",PARTICIPANT_DRAWING:"PARTICIPANT_DRAWING",POPOUT_CONVERSATION:"POPOUT_CONVERSATION",QUEUE_ANNOUNCEMENT_FOR_HUNT_GROUP:"QUEUE_ANNOUNCEMENT_FOR_HUNT_GROUP",SCOPE_SEARCHES:"SCOPE_SEARCHES",SCREEN_SHARE:"SCREEN_SHARE",SECOND_LOCAL_CALL:"SECOND_LOCAL_CALL",SHARE_TC_POOL_WITH_TENANT:"SHARE_TC_POOL_WITH_TENANT",SHORT_LINKS:"SHORT_LINKS",SINGLE_PUBLIC_NUMBERS:"SINGLE_PUBLIC_NUMBERS",SPACES:"SPACES",STARTED_MEETING_SUMMARY:"STARTED_MEETING_SUMMARY",STATISTICS:"STATISTICS",SUBSCRIBER_TELEPHONY_CONNECTOR:"SUBSCRIBER_TELEPHONY_CONNECTOR",TEAMS:"TEAMS",TENANT_ADMIN_USER_TABLE_ENHANCEMENT:"TENANT_ADMIN_USER_TABLE_ENHANCEMENT",TRANSCRIPTION_AND_TRANSLATION:"TRANSCRIPTION_AND_TRANSLATION",UCAAS_EXECUTIVE_ASSISTANT_GROUPS:"UCAAS_EXECUTIVE_ASSISTANT_GROUPS",UNIFIED_PLAN_SDP:"UNIFIED_PLAN_SDP",VIDEO_PLAYER:"VIDEO_PLAYER"},MeetingRoomFeatureName:{DISPLAY_MULTIPLE_VIDEO_STREAMS:"DISPLAY_MULTIPLE_VIDEO_STREAMS"},DraftType:{PRIVATE:"PRIVATE",OPEN:"OPEN",BRIDGE:"BRIDGE",LARGE:"LARGE"},AvatarBadgeType:{COMMUNITY:"COMMUNITY",EVENT:"EVENT",SKYPE:"SKYPE"},AudioVideoDeviceCategories:{AUDIO_OUTPUT:"AUDIO_OUTPUT",RINGING_OUTPUT:"RINGING_OUTPUT",AUDIO_INPUT:"AUDIO_INPUT",VIDEO_INPUT:"VIDEO_INPUT"},RecordingState:{IDLE:"IDLE",LISTENING:"LISTENING",PROCESSING:"PROCESSING"},TranscriptionError:{RECORDING_NOT_SUPPORTED:"RECORDING_NOT_SUPPORTED",RECORDING_NOT_STARTED:"RECORDING_NOT_STARTED",RECORDING_IN_PROGRESS:"RECORDING_IN_PROGRESS",RECORDING_ABORTED:"RECORDING_ABORTED",INVALID_CALL:"INVALID_CALL",INVALID_PROVIDER:"INVALID_PROVIDER"},AtcCapabilities:{EXTENDED_ALERTING:"EXTENDED_ALERTING",CLEAR_CONNECTION_BUSY:"CLEAR_CONNECTION_BUSY",PBX_CALL_LOG:"PBX_CALL_LOG"},StcCapabilities:{STC_TRANSFER:"STC_TRANSFER"}}),r=function(){var e=["conceptboards","rtcInstanceId"],i="||::$$privateData=%%1::||",r=/^\|\|::\$\$privateData=({.*})::\|\|/;return{SUPPORTED_PRIVATE_DATA_FIELDS:e,convertPrivateDataToContent:function(t,r){if(!t)return"";r=r||[];var o={};if(e.forEach(function(e){void 0===t[e]||null===t[e]||r.includes(e)||(o[e]=t[e])}),n.isEmptyObject(o))return"";var a=JSON.stringify(o);return a=n.textToHtmlEscaped(a),i.replace("%%1",a)},retrievePrivateDataFromContent:function(i){if(i&&i.text)try{if(e.forEach(function(e){void 0===i[e]&&(i[e]=null)}),!i.text.content)return;var o=r.exec(i.text.content);if(o&&o[0]){i.text.content=i.text.content.slice(o[0].length);var a=o[1];if(a){a=n.escapedHtmlToText(a);var s=JSON.parse(a);e.forEach(function(e){void 0!==s[e]&&(i[e]=s[e])})}}}catch(e){t.error("[Proto]: Failed to retrieve private data. ",e)}}}}(),o={requestNr:0,normalizeWhiteboard:function(t){e.isSDK&&t&&("boolean"==typeof t.backround?t.background=t.backround:"boolean"==typeof t.background?t.backround=t.background:(t.background=!1,t.backround=!1))},Request:function(e,t,n){o.requestNr++;var r={msgType:i.WSMessageType.REQUEST,request:{requestId:o.requestNr,type:e}};switch(n&&(r.request.tenantContext=n),e){case i.ContentType.CONVERSATION:r.request.conversation=t;break;case i.ContentType.USER:r.request.user=t;break;case i.ContentType.RTC_CALL:r.request.rtcCall=t;break;case i.ContentType.RTC_SESSION:r.request.rtcSession=t;break;case i.ContentType.SEARCH:r.request.search=t;break;case i.ContentType.INSTRUMENTATION:r.request.instrumentation=t;break;case i.ContentType.ADMINISTRATION:r.request.administration=t;break;case i.ContentType.SYSTEM:r.request.system=t;break;case i.ContentType.THIRDPARTYCONNECTORS:r.request.thirdpartyconnectors=t;break;case i.ContentType.GUEST:r.request.guest=t;break;case i.ContentType.USER_TO_USER:r.request.userToUser=t;break;case i.ContentType.VERSION:r.request.version=t;break;case i.ContentType.ACCOUNT:r.request.account=t;break;case i.ContentType.ACTIVITYSTREAM:r.request.activityStream=t;break;case i.ContentType.SPACE:r.request.space=t;break;case i.ContentType.CPAAS:r.request.cpaas=t;break;case i.ContentType.USER_DATA:r.request.userData=t}return r},ParseEvent:function(e,t){var n,r={};switch(e.type){case i.ContentType.CONVERSATION:switch(n="Conversation."+e.conversation.type,e.conversation.type){case i.ConversationEventType.CREATE:r=e.conversation.create;break;case i.ConversationEventType.UPDATE:r=e.conversation.update;break;case i.ConversationEventType.ADD_ITEM:r=e.conversation.addItem;break;case i.ConversationEventType.ADD_PARTICIPANT:r=e.conversation.addParticipant;break;case i.ConversationEventType.UPDATE_ITEM:r=e.conversation.updateItem;break;case i.ConversationEventType.READ_ITEMS:r=e.conversation.readItems;break;case i.ConversationEventType.TYPING:r=e.conversation.typing;break;case i.ConversationEventType.DRAFT_MESSAGE_SAVED:case i.ConversationEventType.DRAFT_MESSAGE_DISCARDED:case i.ConversationEventType.DRAFT_MESSAGE_PUBLISHED:r=e.conversation.draftMessage;break;case i.ConversationEventType.FLAG_ITEM:r=e.conversation.setFlagItem;break;case i.ConversationEventType.CLEAR_FLAGGED_ITEM:r=e.conversation.clearFlaggedItem;break;case i.ConversationEventType.CONVERSATION_MARKED:r=e.conversation.conversationMarked;break;case i.ConversationEventType.CONVERSATION_UNMARKED:r=e.conversation.conversationUnmarked;break;case i.ConversationEventType.FAVORITE_POSITION_CHANGED:r=e.conversation.favoritePositionChangedEvent;break;case i.ConversationEventType.USER_DATA_CHANGED:r=e.conversation.userDataChangedEvent;break;case i.ConversationEventType.JOURNAL_ENTRY_DELETED:r=e.conversation.journalEntryDeletedEvent}r.convId=e.conversation.convId;break;case i.ContentType.USER:switch(n="User."+e.user.type,e.user.type){case i.UserEventType.USER_PRESENCE_CHANGE:r=e.user.presenceChanged;break;case i.UserEventType.USER_UPDATED:r=e.user.userUpdated;break;case i.UserEventType.SESSION_CLOSED:r=e.user.sessionClosed;break;case i.UserEventType.PASSWORD_CHANGED:r=e.user.passwordChanged;break;case i.UserEventType.USER_SETTING_UPDATED:r=e.user.userSettingUpdated;break;case i.UserEventType.TELEPHONY_DATA:r=e.user.telephonyData;break;case i.UserEventType.DEVICE_LIST_CHANGED:r=e.user.deviceListChangedEvent;break;case i.UserEventType.NOTIFICATION_SUBSCRIPTION_CHANGE:r=e.user.notificationSubscriptionChange;break;case i.UserEventType.TENANT_CONFIGURATION_UPDATED:r=e.user.tenantConfigurationUpdatedEvent;break;case i.UserEventType.TENANT_PRESENCE_CHANGE:r=e.user.tenantPresenceChanged;break;case i.UserEventType.CMR_SETTINGS_UPDATED:r=e.user.cmrSettingsUpdatedEvent;break;case i.UserEventType.CMR_COMMAND:r=e.user.cmrCommandEvent;break;case i.UserEventType.TELEPHONY_CHANGED:r=e.user.telephonyChangedEvent}r.userId=e.user.userId;break;case i.ContentType.RTC_CALL:switch(n="RTCCall."+e.rtcCall.type,e.rtcCall.type){case i.RTCCallEventType.SDP_ANSWER:r=e.rtcCall.sdpAnswer;break;case i.RTCCallEventType.SDP_FAILED:r=e.rtcCall.sdpFailed;break;case i.RTCCallEventType.INVITE:r=e.rtcCall.invite;break;case i.RTCCallEventType.INVITE_CANCEL:r=e.rtcCall.inviteCancel;break;case i.RTCCallEventType.INVITE_FAILED:r=e.rtcCall.inviteFailed;break;case i.RTCCallEventType.CHANGE_MEDIA_TYPE_REQUESTED:r=e.rtcCall.changeMediaRequested;break;case i.RTCCallEventType.PROGRESS:r=e.rtcCall.participantProgress;break;case i.RTCCallEventType.CHANGE_MEDIA_TYPE_FORCED:r=e.rtcCall.changeMediaTypeForcedEvent;break;case i.RTCCallEventType.ICE_CANDIDATES:r=e.rtcCall.iceCandidates;break;case i.RTCCallEventType.RTC_QUALITY_RATING_EVENT:r=e.rtcCall.ratingEvent;break;case i.RTCCallEventType.IFRAME_STATISTICS:r=e.rtcCall.iFrameStatisticsEvent}r.sessionId=e.rtcCall.sessionId,r.instanceId=e.rtcCall.instanceId;break;case i.ContentType.RTC_SESSION:switch(n="RTCSession."+e.rtcSession.type,e.rtcSession.type){case i.RTCSessionEventType.SESSION_STARTED:r=e.rtcSession.sessionStarted;break;case i.RTCSessionEventType.SESSION_TERMINATED:r=e.rtcSession.sessionTerminated;break;case i.RTCSessionEventType.SESSION_UPDATED:void 0!==(r=e.rtcSession.sessionUpdated).session.whiteBoardEnabled&&(r.session.whiteboardEnabled=r.session.whiteBoardEnabled,delete r.session.whiteBoardEnabled);break;case i.RTCSessionEventType.SESSION_MOVED:r=e.rtcSession.sessionMoved;break;case i.RTCSessionEventType.PARTICIPANT_JOINED:r=e.rtcSession.participantJoined;break;case i.RTCSessionEventType.PARTICIPANT_LEFT:r=e.rtcSession.participantLeft;break;case i.RTCSessionEventType.PARTICIPANT_UPDATED:r=e.rtcSession.participantUpdated;break;case i.RTCSessionEventType.ACTIVE_SPEAKER:r=e.rtcSession.speaker;break;case i.RTCSessionEventType.VIDEO_ACTIVE_SPEAKER:r=e.rtcSession.videoSpeaker;break;case i.RTCSessionEventType.SESSION_RECORDING_INFO:r=e.rtcSession.sessionRecordingInfo;break;case i.RTCSessionEventType.SESSION_RECORDING_STARTED:r=e.rtcSession.sessionRecordingStarted;break;case i.RTCSessionEventType.SESSION_RECORDING_STOPPED:r=e.rtcSession.sessionRecordingStopped;break;case i.RTCSessionEventType.SESSION_RECORDING_FAILED:r=e.rtcSession.sessionRecordingFailed;break;case i.RTCSessionEventType.SESSION_TERMINATION_TIMER_STARTED:r=e.rtcSession.sessionTerminationTimerStarted;break;case i.RTCSessionEventType.SESSION_TERMINATION_TIMER_CANCELLED:r=e.rtcSession.sessionTerminationTimerCancelled;break;case i.RTCSessionEventType.SESSION_ATTRIBUTES_CHANGED_EVENT:r=e.rtcSession.sessionAttributesChangedEvent;break;case i.RTCSessionEventType.QUESTION_EVENT:r=e.rtcSession.questionEvent;break;case i.RTCSessionEventType.INVITE_TO_STAGE_EVENT:r=e.rtcSession.inviteToStageEvent;break;case i.RTCSessionEventType.INVITE_TO_STAGE_CANCEL_EVENT:r=e.rtcSession.inviteToStageCancelEvent;break;case i.RTCSessionEventType.CURTAIN_EVENT:r=e.rtcSession.curtainEvent;break;case i.RTCSessionEventType.WHITEBOARD_ENABLED:r=e.rtcSession.whiteboardEnabled,o.normalizeWhiteboard(r.whiteboard,t);break;case i.RTCSessionEventType.WHITEBOARD_ELEMENT_ADDED:r=e.rtcSession.whiteboardElementAdded;break;case i.RTCSessionEventType.WHITEBOARD_ELEMENT_REMOVED:r=e.rtcSession.whiteboardElementRemoved;break;case i.RTCSessionEventType.WHITEBOARD_ELEMENT_UPDATED:r=e.rtcSession.whiteboardElementUpdated;break;case i.RTCSessionEventType.WHITEBOARD_CLEARED:r=e.rtcSession.whiteboardCleared;break;case i.RTCSessionEventType.WHITEBOARD_BACKGROUND_SET:r=e.rtcSession.whiteboardBackgroundSet;break;case i.RTCSessionEventType.WHITEBOARD_SYNC:r=e.rtcSession.whiteboardSync,o.normalizeWhiteboard(r.whiteboard,t);break;case i.RTCSessionEventType.WHITEBOARD_CONVERSION_FAILED:r=e.rtcSession.whiteboardConversionFailed;break;case i.RTCSessionEventType.WHITEBOARD_DISABLED:case i.RTCSessionEventType.WHITEBOARD_BACKGROUND_CLEARED:case i.RTCSessionEventType.WHITEBOARD_OVERLAY_TOGGLED:break;case i.RTCSessionEventType.SCREEN_CONTROL_REQUESTED:r=e.rtcSession.screenControlRequested;break;case i.RTCSessionEventType.SCREEN_CONTROL_OFFERED:r=e.rtcSession.screenControlOffered;break;case i.RTCSessionEventType.SCREEN_CONTROL_ACCEPTED:r=e.rtcSession.screenControlAccepted;break;case i.RTCSessionEventType.HANDOVER_SCREEN_CONTROL:r=e.rtcSession.handoverScreenControl;break;case i.RTCSessionEventType.POLL_ENABLED:r=e.rtcSession.pollEnabledEvent;break;case i.RTCSessionEventType.POLL_STARTED:r=e.rtcSession.pollStartedEvent;break;case i.RTCSessionEventType.POLL_STOPPED:r=e.rtcSession.pollStoppedEvent;break;case i.RTCSessionEventType.POLL_UPDATED:r=e.rtcSession.pollUpdatedEvent;break;case i.RTCSessionEventType.POLL_DISABLED:case i.RTCSessionEventType.POLL_RESUMED:break;case i.RTCSessionEventType.SCREEN_CONTROL_REQUEST_REJECTED:case i.RTCSessionEventType.SCREEN_CONTROL_REJECTED:case i.RTCSessionEventType.SCREEN_CONTROL_TERMINATED:case i.RTCSessionEventType.SCREEN_CONTROL_FAILED:}r.sessionId=e.rtcSession.sessionId;break;case i.ContentType.SEARCH:switch(n="Search."+e.search.type,e.search.type){case i.SearchEventType.BASIC_SEARCH_RESULT:r=e.search.basicSearchResult;break;case i.SearchEventType.DETAILED_SEARCH_RESULT:r=e.search.detailSearchResult;break;case i.SearchEventType.SEARCH_STATUS:r=e.search.searchStatus;break;case i.SearchEventType.RECENT_SEARCH_ADDED:r=e.search.recentSearchAdded}r.searchId=e.search.searchId;break;case i.ContentType.SYSTEM:switch(n="System."+e.system.type,e.system.type){case i.SystemEventType.BROADCAST:(r=e.system.systemNotificationEvent).eventId=e.system.eventId;break;case i.SystemEventType.MAINTENANCE:case i.SystemEventType.MAINTENANCE_ADDED:(r=e.system.maintenance).eventId=e.system.eventId;break;case i.SystemEventType.BROADCAST_REMOVED:case i.SystemEventType.MAINTENANCE_REMOVED:r=e.system.eventId}break;case i.ContentType.ADMINISTRATION:switch(n="Administration."+e.administration.type,e.administration.type){case i.AdministrationEventType.INVITE_MULTIPLE_USERS:r=e.administration.inviteMultipleUsers;break;case i.AdministrationEventType.INVITE_MULTIPLE_PARTNER_USERS:r=e.administration.inviteMultiplePartnerUsers}break;case i.ContentType.THIRDPARTYCONNECTORS:switch(n="ThirdParty."+e.thirdParty.type,e.thirdParty.type){case i.ThirdPartyEventType.CONNECTED_TO_THIRDPARTY:r=e.thirdParty;break;case i.ThirdPartyEventType.DISCONNECTED_FROM_THIRDPARTY:r=e.thirdParty.provider}break;case i.ContentType.USER_TO_USER:n="UserToUser."+e.userToUser.userToUser.type,(r=e.userToUser.userToUser).routing=e.userToUser.routing;break;case i.ContentType.ACTIVITYSTREAM:switch(n="ActivityStream."+e.activity.type,e.activity.type){case i.ActivityStreamEventType.ACTIVITY_CREATED:r=e.activity.create.item;break;case i.ActivityStreamEventType.ACTIVITY_DELETED:r=e.activity.delete.item;break;case i.ActivityStreamEventType.ACTIVITY_MARKED_READ:r=e.activity.markRead.itemId;break;case i.ActivityStreamEventType.ACTIVITY_MARKED_UNREAD:r=e.activity.markUnread.itemId;break;case i.ActivityStreamEventType.ACTIVITY_MARK_ALL_READ:r=e.activity.markAllRead.status}break;case i.ContentType.ACCOUNT:switch(n="Account."+e.account.type,e.account.type){case i.AccountEventType.MIGRATE_MULTIPLE_USERS:r=e.account.migrateMultipleUsers;break;case i.AccountEventType.TELEPHONY_CONFIGURATION_UPDATED:r=e.account.telephonyConfigurationUpdated;break;case i.AccountEventType.TC_START_REASSIGNMENT:r=e.account.tcStartReassignment}break;case i.ContentType.CONVERSATION_USER_DATA:switch(n="ConversationUserData."+e.conversationUserData.type,e.conversationUserData.type){case i.ConversationUserDataEventType.LABELS_ADDED:r=e.conversationUserData.labelsAdded;break;case i.ConversationUserDataEventType.LABELS_REMOVED:r=e.conversationUserData.labelsRemoved;break;case i.ConversationUserDataEventType.LABEL_EDITED:r=e.conversationUserData.labelEdited;break;case i.ConversationUserDataEventType.FILTERS_REMOVED:r=e.conversationUserData.filtersRemoved;break;case i.ConversationUserDataEventType.FILTER_ADDED:r=e.conversationUserData.filterAdded;break;case i.ConversationUserDataEventType.FILTER_EDITED:r=e.conversationUserData.filterEdited}break;case i.ContentType.CPAAS:n="CPAAS."+e.cpaas.type,e.cpaas.type===i.CPaaSEventType.SUBMIT_FORM_DATA&&(r=e.cpaas.submitFormData);break;case i.ContentType.TEAM:switch(n="Team."+e.team.type,e.team.type){case i.TeamEventType.NOTIFY:r=e.team.notifyEvent;break;case i.TeamEventType.NOTIFY_CANCEL:r=e.team.notifyCancelEvent}break;default:return null}return{name:n,data:r}},getMediaType:function(e){if(!e)return{audio:!1,video:!1,desktop:!1};var t={audio:!1,video:!1,desktop:!1};return e.forEach(function(e){switch(e){case i.RealtimeMediaType.AUDIO:t.audio=!0;break;case i.RealtimeMediaType.VIDEO:t.video=!0;break;case i.RealtimeMediaType.DESKTOP_SHARING:t.desktop=!0}}),t},isOfflineFailure:function(e){return e===i.ReturnCode.DISCONNECTED||e===i.ReturnCode.FAILED_TO_SEND||e===i.ReturnCode.REQUEST_TIMEOUT}};return e.Constants=i,e.PrivateData=r,e.Proto=o,e}(e=function(e){"use strict";var t=e.Utils||{};t.EMOTICON_MAPPING={":)":128515,":D":128516,":(":128542,":heart":128525,";)":128521,":awesome":128516,":angry":128544,":zzz":128554,":O":128562,";(":128546};var n=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^\/?>]*\/?)>/gi;function i(e,n,i){var r=t.EMOTICON_MAPPING[i];return r?String.fromCodePoint(r):""}return t.standardizeEmoticon=function(e){return e?e.replace(n,i):""},t.removeMentionHtml=function(e){var t=0;return e.replace(/(<span.*?>)|(<\/span>)/gi,function(e,n,i){return n?n.match(/class="mention"/i)?"":(t++,n):i&&t?(t--,i):""})},e}((e=function(t){"use strict";t.__server="",t.__domain="",t.isElectron=!(t.isSDK||"undefined"==typeof process||!process.versions||!process.versions.electron);var o,a=t.logger,s=t.Emoticons,c=t.Emoji;if(t.isElectron){var l=(o=require("electron").remote).getCurrentWindow();t.__server=l._domain||"",t.__sotelUser=!!l._sotelUser,t.productName=l._productName||"Circuit",t.productBrand=l._productBrand||""}else t.productName="string"==typeof __productName?__productName:"Circuit",t.productBrand="string"==typeof __productBrand?__productBrand:"";"undefined"!=typeof Skype&&(t.SkypeSDK=Skype,Skype=null);var d="https://",u=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^\/?>]*\/?)>/gi,C=t.Utils||{};var E,T,p="((?:["+(T=(E="\\w@'^=$%&amp;\\/~+!\\(\\)\\{\\}\\-\\|")+".,?:\\[\\]")+"]*?#["+T+"]*?\\?(?!["+E+"#]))|(?:["+T+"#]*["+E+"#]))?",S=["items","parents","peerUsers","previousMembers"];C.trimCallForMobile=function(e){var t;return e&&(t=C.flattenObj(e)),t},C.trimConvForMobile=function(e){var t;return e&&(t=C.flattenObj(e),S.forEach(function(e){delete t[e]}),t.call=C.trimCallForMobile(e.call)),t},C.isPromise=function(e){return!(!e||"function"!=typeof e.then)},C.convertVersionToNumber=function(e){if("string"!=typeof e)return 0;var t=e.split("."),n=parseInt(t[0],10)||0,i=parseInt(t[1],10)||0;i=Math.min(i,99);var r=parseInt(t[2],10)||0;return(r=Math.min(r,9999))+1e4*i+1e6*n},C.trimTextWithEmoticonsBeforeMatch=function(e,t,n){for(var i=e.indexOf(t),r=e.slice(i),o=e.slice(0,i),a=String.fromCharCode(17),s=String.fromCharCode(18),c=o.replace(u,function(e,t){return a+t+s}),l=!0,d=c.length-1,C=c.length-1,E=C;o.length-1-d<=n&&C>=0;)18===c.charCodeAt(C)?(c=c.replaceAt(C,">"),l=!1):17===c.charCodeAt(C)&&(c=c.replaceAt(C,"<"),l=!0),E=C,C--,l&&d--;return(o=E>0?"..."+c.slice(E):c)+r},C.enhanceEncodeURI=function(e){var t={"!":"%21","(":"%28",")":"%29","#":"%23","{":"%7B","}":"%7D"};return encodeURIComponent(e).replace(/[!\(\)#\{\}]/gi,function(e){return t[e]})},C.normalizeDn=function(e){return e?e.replace("+",""):""},C.cleanPhoneNumber=function(e){return e?e.replace(/[^\*\#\d\+]/g,""):""},C.cleanPhoneNumberDigitsWithPin=function(e){return e?e.replace(/[^\*\#\d\+\,]/g,""):""},C.isMSDoc=function(e){return e.search(/<\S*?WordDocument>/i)>=0||e.search(/<[^>]*?style=[^>]*?mso-[^<]+?>/i)>=0||e.search(/<meta[^>]*?Microsoft/i)>=0},C.isXCodeDoc=function(e){return e.search(/<meta[^>]*?Cocoa[^<]+?>/)>=0},C.isYourCircuitDomain=function(){var e=t.isElectron?t.__server:n.location.host;return-1!==["eu.yourcircuit.com","na.yourcircuit.com"].indexOf(e)},C.sanitizer=null,C.sanitize=function(e){if(!e||!C.sanitizer)return e||"";try{e=(e=(e=(e=e.replace(/style="background-color: rgb\(212, 239, 181\);"/gi,'class="rich-text-highlight"')).replace(/<[^>]+background-color: rgb\(212, 239, 181\);.*?>/gi,function(e){return e.indexOf("class=")>0?e.replace(/class=".*?"/gi,function(e){return e.indexOf("rich-text-highlight")>0?e:e.replace(/[^=]\s*(.*)/gi,function(e){return e.slice(0,-1)+" rich-text-highlight"})}):e.replace(">",function(e){return' class="rich-text-highlight" '+e})})).replace(/<img(?![^>]*class="(emoticon-icon|emojione-icon))[^>]*>/gi,"")).replace(/<title[^>]*>([\s\S]*?)<\/title>/gi,""),e=(e=(e=(e=(e=s?s.normalizeEmoticonHtml(e):e).replace(/<font[^>]*>|<\/font>/gi,"")).replace(/(<\s*hr\s*><\s*\/hr\s*>|<\s*hr\s*>)/gi,"<hr/>")).replace(/(\r|\n)+(?=[^<]*?>)/gi," ")).replace(/\r\n|\r|\n/g,"<br>"),"function"==typeof C.sanitizer&&(e=C.sanitizer(e));var t=e.split(/<\/?div.*?>|<\/?p.*?>/g).filter(function(e){return!!e}),n=t.length,i="";if(n>1)for(var r,o,c=new RegExp("<br>(?![\\s\\S]*<br>)(?=(<[^/][^>]*></[^>]*>)*$|(</[^>]*>)*$|$)","i"),l=0;l<n;l++)r=t[l].replace(/((<span( class="[\S]*")*>)|(<b( class="[\S]*")*>)|(<i( class="[\S]*")*>))*(<br>|<br\/>)(<\/span>|<\/b>|<\/i>)*/g,"<br>"),!o||o.endsWith("</ul>")||o.endsWith("</ol>")||c.test(o)||(i+="<br>"),i+=r,o=r;else i=t[0];e=i}catch(t){return a.error("[Utils]: Error sanitizing content. ",t),a.error("[Utils]: Unexpected content: ",e),""}return e||""},C.sanitizeSymbols=function(e){return C.isMobile()&&"undefined"!=typeof he?e&&he.encode(e,{allowUnsafeSymbols:!0,decimal:!0}):e},C.convertSymbolCodes=function(e){return C.isMobile()?e&&e.replace(c.HTML_ENTITY_REGEX,function(e){return function(e){var t=e.replace(/[&#;]/g,"");if(!/^[0-9]+$/.test(t)||t>=55296&&t<=57343||t>1114111)return e;var n="";return t>65535&&(t-=65536,n+=String.fromCharCode(t>>>10&1023|55296),t=56320|1023&t),n+=String.fromCharCode(t)}(e)}):e},C.retrieveTextOnly=function(t,n){if(!t||"PLAIN"===n)return t;t=(t=(t=(t=(t=t.replace(e.Emoticons.HTML_REGEX,"")).replace(/&#\d+;/g,"")).replace(/<span.*?class=["']mention["'].*?>.*?>/g,"")).replace(C.URL_PATTERN,"")).replace(C.PSEUDO_URL_PATTERN,"");var i=r.createElement("div");return i.innerHTML=t.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;"),i.textContent.trim()},C.toPlainText=function(e,t){if(e&&(!t||"RICH"===t)){s&&(e=e.replace(s.HTML_REGEX,function(e,t){return s.isEmoticonContent(e)?t:e}));var n=r.createElement("div");return n.innerHTML=e.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;"),n.textContent}return e},C.toPlainTextWithEmoticonHtml=function(e,t){if(e&&(!t||"RICH"===t)){var n=String.fromCharCode(17),i=String.fromCharCode(18);e=e.replace(s.HTML_REGEX,function(e,t){return s.isEmoticonContent(e)?n+t+i:e}),e=c.convertEmojis(e);var o=String.fromCharCode(19),a=String.fromCharCode(20);e=e.replace(c.HTML_REGEX,function(e,t){return c.isEmojiContent(e)?o+t+a:e});var l=r.createElement("div");l.innerHTML=e.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;");var d=C.textToHtmlEscaped(l.textContent,!0);return(d=d.replace(/\x11([^\x11\x12]*)\x12/gim,function(e,t){return s.getHtmlFromShortcut(t,!1,!0,!0)})).replace(/\x13([^\x13\x14]*)\x14/gim,function(e,t){return c.convertEmojis(t.replace(/&amp;/g,"&"))})}return e},C.truncateFileName=function(e){return!e||e.length<=22?e:e.substring(0,10)+" ..."+e.substring(e.length-8,e.length)},C.convertItemText=function(e,t,n){return e?n?C.toPlainTextWithEmoticonHtml(e,t):C.toPlainText(e,t):""},C.createMentionedUsersArray=function(e,t){for(var n=[],i=/<span.*?class=["']mention["'].*?>/g,r=/abbr=["'](.*?)["']/,o=i.exec(e);null!==o;){var a=r.exec(o[0]);a=a&&a[1],-1===n.indexOf(a)&&n.push(a),o=i.exec(e)}return t&&(n=n.filter(function(e){return t.some(function(t){return t.userId===e})})),n},C.DEFAULT_HELP_URL="https://www.circuit.com/support",C.SEPARATORS_PATTERN="!-/:-@[-^{-~\\s",C.NUMERIC_PATTERN="^[0-9]*$",C.NUMERIC_SIGN_PATTERN="^[*+]?[0-9]*$",C.ALPHANUMERIC_PATTERN="^[a-zA-Z0-9_]*$",C.URL_SEPARATORS_PATTERN=/(?=[.,;!]?\s+|[.,;!]$)/,C.URL_PATTERN=new RegExp("(http|ftp|https|circuit):\\/\\/[\\w-]+?((\\.|:)[\\w-]+?)*?"+p,"gim"),C.EXACT_URL_PATTERN=new RegExp("^"+C.URL_PATTERN.source+"$","i"),C.PSEUDO_URL_PATTERN=new RegExp("www\\.+[\\w-]+?(\\.[\\w-]+?)+?"+p,"gim"),C.PROTOCOL_PATTERN=/^(?:http|https|ftp):\/\//,C.TABBABLE_ELEMENTS_PATTERN="a[href], area[href], input:not([disabled]):not([tabindex='-1']), button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']), textarea:not([disabled]):not([tabindex='-1']), iframe, object, embed, *[tabindex]:not([tabindex='-1']), *[contenteditable=true]",C.RICH_TEXT_LINK_CLASS="text-linkDarkGreen",C.EMAIL_ADDRESS_INCLUDED_PATTERN=/[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?(?:\.[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?)*?@[a-z\d-]+?(?:\.[a-z\d-]{2,})+/gim,C.EMAIL_ADDRESS_PATTERN=new RegExp("^"+C.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","i"),t.isElectron&&o&&(C.SSO_EMAIL_DOMAINS_MAPPING=o.getGlobal("constants").SSO_EMAIL_DOMAINS_MAPPING||[],C.SSO_PATTERN="[_a-z0-9-]+?@(("+C.SSO_EMAIL_DOMAINS_MAPPING.join(")|(")+"))",C.SSO_EMAIL_ADDRESS_PATTERN=new RegExp(C.SSO_PATTERN,"i")),C.CIRCUIT_CONVERSATION_HASH_PATTERN=/\#\/(conversation|open|muted)\/[0-9\-a-z]+?(\?((user=(\d)+?)|(item=([0-9\-a-z])+?(\&user=(\d)+?)?)))?$/gim,C.CIRCUIT_LINKS_HASH_PATTERN=/\#\/(profile|phone|user|search)\/[0-9\-a-z]+?$/gim,C.CIRCUIT_EMAIL_HASH_PATTERN=new RegExp("#/email/"+C.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","gim"),C.PHONE_PATTERN=/^(\+\s*)?\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)$/,C.GNF_PHONE_PATTERN=/^((\+)|(\+\s*\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)))$/,C.PHONE_PAC=/^([#\*]+[#\*\(\)\-\s\+\d]*)$/,C.PHONE_DIAL_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d]*)$/,C.PHONE_DIAL_WITH_PIN_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d\,]*)$/,C.PHONE_WITH_EXTENSION_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d]*)(\s*(x|X|ext\.)\s*\d+)$/,C.IPV4_ADDRESS_PATTERN=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/,C.TCP_PORT_NUMBERS_PATTERN=/^(0|([1-9]\d{0,3}|[1-5]\d{4}|[6][0-5][0-5]([0-2]\d|[3][0-5])))$/,C.FQDN_PATTERN=/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/,C.ELECTRON_FULLSCREEN_SHORTCUT=C.isMacOs?"Commandd+Shift+F":"F11",C.matchPhonePattern=function(e){return e&&"string"==typeof e?e.match(C.PHONE_PATTERN):null},C.matchUrlPattern=function(e){return e&&"string"==typeof e?e.match(C.URL_PATTERN)||e.match(C.PSEUDO_URL_PATTERN):null},C.matchEmailPattern=function(e){return e&&"string"==typeof e?e.match(C.EMAIL_ADDRESS_INCLUDED_PATTERN):null},C.getEmails=function(e){var t=e&&e.split(/[;,]\s*|\s+/i);return(t=t&&t.map(function(e){var t=e.match(C.EMAIL_ADDRESS_INCLUDED_PATTERN);return t&&t[0]}).filter(function(e){return!!e}))||[]},C.matchNames=function(e,t,n){if(!e||"string"!=typeof e||!t)return!1;var i=new RegExp("^"+RegExp.escape(t),n||"i");return i.test(e)||e.split(" ").some(function(e){return i.test(e)})},C.compareStrings=function(e,t){return"string"==typeof e&&"string"==typeof t&&new RegExp("^"+RegExp.escape(e)+"$","i").test(t)},C.rstring=function(){return Math.floor(1e9*Math.random()).toString()},C.randomNumber=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},C.randomBoolean=function(){return.5>Math.random()},C.generateCallId=function(){return"WRTC-"+C.rstring()+"-"+C.rstring()},C.createTransactionId=function(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(e[19]?3:8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},C.getLegalRegion=function(e){switch(e){case"europe":return"de"===(i.language||i.browserLanguage).split("-").last().toLowerCase()?"de":"uk";case"americas":case"apac":default:return"us"}},C.getBrowserInfo=function(){if("iOS"===n.navigator.platform)return{ios:!0,type:"ios"};if("Android"===n.navigator.platform)return{android:!0,type:"android"};if("node"===n.navigator.platform)return{node:!0,type:"node"};if(e.isElectron)return{chrome:!0,type:"chrome"};if("dotnet"===n.navigator.platform)return{dotnet:!0,type:"dotnet"};if(n.cordova&&"ios"===n.cordova.platformId)return{cordovaios:!0,type:"cordovaios"};var t={},r=i.userAgent.toLowerCase(),o=/(msie|trident)(?: |.*rv:)([\d.]+)/.exec(r)||/(opera|opr)\/(?:.*version\/|)([\d.]+)/.exec(r)||/(firefox)\/([\d.]+)/.exec(r)||/(edge)\/([\d.]+)/.exec(r)||/(chrome)\/([\d.]+)/.exec(r)||/version\/([\d.]+).*(safari)/.exec(r)||/(phantomjs)\/([\d.]+)/.exec(r)||[],a=o[1]||"",s=o[2]||0;return"safari"===s?(a=o[2],s=o[1]):"trident"===a?a="msie":"opr"===a?a="opera":"phantomjs"===a&&(a="phantomjs"),t[a]=!0,t.type=a,t.version=s,t};var I=[{s:"Windows 10",r:/(Windows.* 10|Windows 10.0|Windows[ _]NT.* 10.0)/},{s:"Windows 8.1",r:/(Windows.* 8.1|Windows[ _]NT.* 6.3)/},{s:"Windows 8",r:/(Windows.* 8|Windows[ _]NT.* 6.2)/},{s:"Windows 7",r:/(Windows.* 7|Windows[ _]NT.* 6.1)/},{s:"Windows Vista",r:/(Windows.* Vista|Windows[ _]NT.* 6.0)/},{s:"Windows Server 2003",r:/(Windows Server 2003|Windows[ _]NT.* 5.2)/},{s:"Windows XP",r:/(Windows[ _]NT.* 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows[ _]NT.* 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Windows 3.11|Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/Open BSD|OpenBSD/},{s:"Sun OS",r:/Sun OS|SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iOS|iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh|Darwin)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(Search Bot|nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];function f(e){if(!e)return"";var i=r.createElement("div"),o=r.createElement("div");e=e.replace(/\$/gm,"$$$$");var a=0;return e=e.replace(/(<span.*?>)|(<\/span>)/gi,function(e,t,n){return t?t.match(/class="mention"/i)?e.replace(/.*abbr="(.*?)".*?>/gi,'<span class="mention" abbr="$1"><a href="#/profile/$1">'):t.match(/class="hashtag"/i)?e.replace(/.*abbr="(.*?)".*?>/gi,'<span class="hashtag" abbr="$1"><a href="#/search/$1">'):(a++,t):n?a?(a--,n):"</a></span>":""}),e=c.convertEmojis(e),i.innerHTML=e,function e(i,r){if(!i||!i.childNodes||!i.childNodes.length)return i;var o;for(var a=0,s=i.childNodes.length;a<s;a++)switch((o=i.childNodes[a]).nodeType){case 1:if("A"===o.nodeName){var c=t.isElectron?t.__server:n.location&&n.location.origin;C.isCircuitLink(c,o.href)||(o.target="_blank",o.rel="noopener noreferrer")}e(o,r);break;case 3:for(r.innerHTML=C.linkifyText(o.textContent),a+=r.childNodes.length-1;r.childNodes.length;)i.insertBefore(r.childNodes[0],o);i.removeChild(o),s=i.childNodes.length}return i}(i,o).innerHTML.replace(/&nbsp;/gi," ")}function R(){return t.isElectron?d+t.__server:n.location&&n.location.origin}C.getOSInfo=function(e){var t=e=e||n.navigator.userAgent,i="",r="";if(I.some(function(n){return!!n.r.test(e)&&(t=n.s,!0)})&&/Windows/.test(t))r=/Windows (.*)/.exec(t)[1],i="Windows";else{i=t;try{switch(t){case"Mac OS X":r=/Mac OS X (10[\.\_\d]+)/.exec(e)[1];break;case"Android":r=/Android ([\.\_\d]+)/.exec(e)[1]}}catch(t){a.debug("[Utils]: osVersion does not contain version on it. ",e)}}return{type:i,version:r,info:t}},C.checkUserDomain=function(e,i){var r=t.isElectron?t.__server.split(":")[0]:n.location.hostname;return i?r.startsWith(e):r.endsWith(e)},C.parseIpWithPort=function(e){if(!e&&"string"!=typeof e)return null;if("["===e[0]){var t=/\[(.*)\]:(\d*)/.exec(e);if(t&&3===t.length)return{ipAddress:t[1],port:t[2]}}else if(e.indexOf(":")>0){var n=e.split(":");if(2===n.length)return{ipAddress:n[0],port:n[1]}}return null},C.isEmptyObject=function(e){return 0===Object.keys(e).length},C.getBaseObject=function(e,t){if(!e||"object"!=typeof e)return null;if(Array.isArray(e))return e;var n=Object.getPrototypeOf(e);return C.isEmptyObject(n)?e:(!1!==t&&Object.getOwnPropertyNames(n).forEach(function(t){"function"!=typeof n[t]&&e.hasOwnProperty(t)&&(n[t]=e[t])}),n)},C.syncBaseObject=function(e){var t=C.getBaseObject(e,!0);t&&t!==e&&Object.getOwnPropertyNames(t).forEach(function(t){e.hasOwnProperty(t)&&delete e[t]})},C.flattenObj=function(e){if(!e||"object"!=typeof e||Array.isArray(e))return e;var t=Object.getPrototypeOf(e);if(C.isEmptyObject(t))return e;var n={};for(var i in e)"function"!=typeof e[i]&&(n[i]=e[i]);return n},C.getNormalizedFileExtension=function(e){var t=e&&(e.fileName||e.name);if(!t)return null;if(/audio/i.test(e.mimeType))return"audio";if(/video/i.test(e.mimeType))return"video";var n=t.split(".").pop();if(n)switch(n.toLowerCase()){case"doc":case"docx":return"doc";case"ppt":case"pptx":return"ppt";case"pdf":return"pdf";case"xls":case"xlsx":return"xls";case"gz":case"zip":return"zip";case"html":return"html";case"csv":return"csv";case"png":return"png";case"jpg":case"jpeg":return"jpg";case"log":return"log";case"flv":case"mp4":case"ogv":case"webm":return"video";case"wav":case"mp3":case"ogg":return"audio"}return"def"},C.getImageFileExtension=function(e){if(e.type)switch(e.type.toLowerCase()){case"image/png":return"png";case"image/jpeg":return"jpg";case"image/gif":return"gif";case"image/bmp":return"bmp";case"image/svg+xml":return"svg"}return null},C.getMimeTypes=function(e){if(!e)return null;var t=e.split(".").pop();if(t)switch(t.toLowerCase()){case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xltx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.template";case"potx":return"application/vnd.openxmlformats-officedocument.presentationml.template";case"ppsx":return"application/vnd.openxmlformats-officedocument.presentationml.slideshow";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"sldx":return"application/vnd.openxmlformats-officedocument.presentationml.slide";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"dotx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.template";case"xlam":return"application/vnd.ms-excel.addin.macroEnabled.12";case"xlsb":return"application/vnd.ms-excel.sheet.binary.macroEnabled.12"}return"application/octet-stream"},C.textToHtmlEscaped=function(e,t){if(!e)return"";var n=t?"&nbsp;":"<br>";return e.replace(/&/g,"&amp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n|\r|\n/gm,n)},C.escapedHtmlToText=function(e){return e?e.replace(/&amp;/g,"&").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/<br\/?>/g,"\r\n"):""},C.stripParenthesis=function(e){for(var t=(e=e.trim()).match(/\(/g)||[],n=e.match(/\)/g)||[],i=0;"("===e[i];)i++;return e.slice(i,e.length-Math.abs(t.length-i-n.length))},C.linkifyText=function(e){e=e.replace(/\xA0|&#160;|\x0A|\x0D/gim," ");for(var t=String.fromCharCode(17),n=String.fromCharCode(18),i=String.fromCharCode(19),r=function(e){var r="",o="",a=R(),s=C.isCircuitLink(a,e);if(!s){var c=!0;if(s=e,e.startsWith("circuit://"))new RegExp(a.replace(d,"")+"\\/guest\\?token=","i").exec(e)?s=e.replace("circuit://",d):c=!1;else C.PROTOCOL_PATTERN.exec(e)||(s="http://"+s);r=c?" target="+i+"_blank"+i:"",o=" rel="+i+"noopener noreferrer"+i}return t+"a href="+i+s+i+r+o+n+e+t+"/a"+n},o=e.split(C.URL_SEPARATORS_PATTERN),a=0;a<o.length;a++){var s=o[a],c=C.stripParenthesis(s),l=c;l.search(/http|ftp|https|circuit/gim)>=0&&l.search(C.URL_PATTERN)>=0?l=l.replace(C.URL_PATTERN,r):l.search(/www\./gim)>=0&&l.search(C.PSEUDO_URL_PATTERN)>=0?l=l.replace(C.PSEUDO_URL_PATTERN,r):l.search(/\S@\S/gim)>=0&&l.search(C.EMAIL_ADDRESS_INCLUDED_PATTERN)>=0&&(l=l.replace(C.EMAIL_ADDRESS_INCLUDED_PATTERN,t+"a href="+i+"mailto:$&"+i+" target="+i+"_blank"+i+" rel="+i+"noopener noreferrer"+i+n+"$&"+t+"/a"+n)),s=s.replace(c,l),o[a]=s}return e=o.join(""),C.textToHtmlEscaped(e).replace(/\x11/gi,"<").replace(/\x12/gi,">").replace(/\x13/gi,"'")},C.linkifyContent=function(e,t){if(C.isMobile())return"";switch(e=s.addEmoticonsAltAttr(e),t){case"RICH":return f(e);case"PLAIN":return C.linkifyText(e)}return e},C.invalidFileTypes=["ade","adp","app","asp","bas","bat","cer","chm","cmd","cnt","com","cpl","crt","csh","der","exe","fxp","gadget","hlp","hpj","hta","inf","ins","isp","its","js","jse","ksh","lnk","mad","maf","mag","mam","maq","mar","mas","mat","mau","mav","maw","mda","mdb","mde","mdt","mdw","mdz","msc","msh","msh1","msh1xml","msh2","msh2xml","mshxml","msi","msp","mst","ops","osd","pcd","pif","plg","prf","prg","ps1","ps1xml","ps2","ps2xml","psc1","psc2","pst","reg","scf","scr","sct","shb","shs","tmp","url","vb","vbe","vbp","vbs","vsmacros","vsw","ws","wsc","wsf","wsh","xnk"],C.hasScrollbar=function(e){if(e&&e.length>0){var t=e[0];return!!t&&t.scrollHeight>t.clientHeight}return!1},C.isDescendantOrEqual=function(e,t){if(e===t)return!0;for(var n=e;n;)if((n=n.parentElement)===t)return!0;return!1},C.isSupportedImage=function(e){return/^image\/(jpeg|gif|bmp|png)$/i.test(e)},C.isVideoSupportedByBrowser=function(e){return/^video\/(quicktime|mp4|webm)$/i.test(e)},C.shallowCopy=function(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.slice();var t=C.flattenObj(e),n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},C.normalizeLocaleProto=function(e){var t;return e&&e.length>=5&&(t=e.replace(/-/g,"_").toUpperCase()),t},C.normalizeLocale=function(e){var t;return e&&e.length>=5&&(t=e.substr(0,2).toLowerCase()+e.substr(2,e.length-2).replace(/_/g,"-")),t},C.getLocalTime=function(e){var t=new Date;return null==e?t.getTime():(t.setTime(t.getTime()+60*(t.getTimezoneOffset()-e)*1e3),t.getTime())},C.delayOrTimestamp=function(e,t){return e>0?Date.now()+e:t},C.buildAttachmentMetaData=function(e){var t=function(e){return{fileId:e.fileId,fileName:e.fileName,itemId:e.itemId,mimeType:e.mimeType,size:e.size}},n=[],i=[];return e&&e.forEach(function(e){if(e.isThirdParty){var r=t(e);i.push({type:e.provider,attachment:r,downloadLocation:e.url,previewLocation:e.url,shareLinkToken:e.shareLinkToken})}else n.push(t(e)),e.thumbnail&&n.push(t(e.thumbnail))}),{attachments:n,externalAttachments:i}},C.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.parent=t.prototype},C.bytesToSize=function(e,t){if(!(e=parseInt(e,10)))return"0 Bytes";var n=Math.floor(Math.log(e)/Math.log(1024));return Number((e/Math.pow(1024,n)).toPrecision(t||3))+" "+["Bytes","KB","MB","GB","TB","PB"][n]},C.isMacOs=!(!n.navigator||!n.navigator.userAgent)&&(-1!==n.navigator.userAgent.indexOf("Mac")||-1!==n.navigator.userAgent.indexOf("Darwin")),C.isWindowsOs=!(!n.navigator||!n.navigator.platform)&&"win"===n.navigator.platform.substring(0,3).toLowerCase(),C.isMobile=function(){const e=i.userAgent.toLowerCase();return e.indexOf("mobile")>-1&&(e.indexOf("android")>-1||e.indexOf("iphone")>-1)},C.formatPIN=function(e,t,n){if(!t)return"";if(n)return(e||"")+t+"#";for(var i,r=[],o=e?3:4,a=0;a<t.length;a+=o)a>0&&(o=3),(i=t.substr(a,o)).length>=2||0===r.length?r.push(i):r[r.length-1]+=i;return e&&r.unshift(e),r.push("#"),r.join(" ")},C.CountriesArray=[{name:"res_countryName_Andorra",code:"AD"},{name:"res_countryName_United_Arab_Emirates",code:"AE"},{name:"res_countryName_Afghanistan",code:"AF"},{name:"res_countryName_Antigua_and_Barbuda",code:"AG"},{name:"res_countryName_Anguilla",code:"AI"},{name:"res_countryName_Albania",code:"AL"},{name:"res_countryName_Armenia",code:"AM"},{name:"res_countryName_Netherland_Antilles",code:"AN"},{name:"res_countryName_Angola",code:"AO"},{name:"res_countryName_Antarctic",code:"AQ"},{name:"res_countryName_Argentina",code:"AR"},{name:"res_countryName_American_Samoa",code:"AS"},{name:"res_countryName_Austria",code:"AT"},{name:"res_countryName_Australia",code:"AU"},{name:"res_countryName_Aruba",code:"AW"},{name:"res_countryName_Azerbaijan",code:"AZ"},{name:"res_countryName_Bosnia_and_Herzegovina",code:"BA"},{name:"res_countryName_Barbados",code:"BB"},{name:"res_countryName_Bangladesh",code:"BD"},{name:"res_countryName_Belgium",code:"BE"},{name:"res_countryName_Burkina_Faso",code:"BF"},{name:"res_countryName_Bulgaria",code:"BG"},{name:"res_countryName_Bahrain",code:"BH"},{name:"res_countryName_Burundi",code:"BI"},{name:"res_countryName_Benin",code:"BJ"},{name:"res_countryName_Bermuda",code:"BM"},{name:"res_countryName_Brunei_Darussalam",code:"BN"},{name:"res_countryName_Bolivia",code:"BO"},{name:"res_countryName_Brazil",code:"BR"},{name:"res_countryName_Bahamas",code:"BS"},{name:"res_countryName_Bhutan",code:"BT"},{name:"res_countryName_Botswana",code:"BW"},{name:"res_countryName_Belarus",code:"BY"},{name:"res_countryName_Belize",code:"BZ"},{name:"res_countryName_Canada",code:"CA"},{name:"res_countryName_Dem_Republic_Congo",code:"CD"},{name:"res_countryName_Central_African_Republik",code:"CF"},{name:"res_countryName_Congo",code:"CG"},{name:"res_countryName_Switzerland",code:"CH"},{name:"res_countryName_Cote_d_Ivoire",code:"CI"},{name:"res_countryName_Chile",code:"CL"},{name:"res_countryName_Cameroon",code:"CM"},{name:"res_countryName_China_Peoples_Republic",code:"CN"},{name:"res_countryName_Colombia",code:"CO"},{name:"res_countryName_Costa_Rica",code:"CR"},{name:"res_countryName_Cuba",code:"CU"},{name:"res_countryName_Cap_Verde",code:"CV"},{name:"res_countryName_Cyprus",code:"CY"},{name:"res_countryName_Czech_Republik",code:"CZ"},{name:"res_countryName_Germany",code:"DE"},{name:"res_countryName_Djibouti",code:"DJ"},{name:"res_countryName_Denmark",code:"DK"},{name:"res_countryName_Dominica",code:"DM"},{name:"res_countryName_Dominican_Republik",code:"DO"},{name:"res_countryName_Algeria",code:"DZ"},{name:"res_countryName_Ecuador",code:"EC"},{name:"res_countryName_Estonia",code:"EE"},{name:"res_countryName_Egypt",code:"EG"},{name:"res_countryName_Westsahara",code:"EH"},{name:"res_countryName_Eritrea",code:"ER"},{name:"res_countryName_Spain",code:"ES"},{name:"res_countryName_Ethiopia",code:"ET"},{name:"res_countryName_Finland",code:"FI"},{name:"res_countryName_Fiji",code:"FJ"},{name:"res_countryName_Falkland_Islands",code:"FK"},{name:"res_countryName_Micronesia_Fed_States",code:"FM"},{name:"res_countryName_Faroer",code:"FO"},{name:"res_countryName_France",code:"FR"},{name:"res_countryName_Gaboon",code:"GA"},{name:"res_countryName_United_Kingdom",code:"GB"},{name:"res_countryName_United_Kingdom",code:"UK"},{name:"res_countryName_Grenada",code:"GD"},{name:"res_countryName_Georgia",code:"GE"},{name:"res_countryName_French_Guayana",code:"GF"},{name:"res_countryName_Ghana",code:"GH"},{name:"res_countryName_Gibraltar",code:"GI"},{name:"res_countryName_Greenland",code:"GL"},{name:"res_countryName_Gambia",code:"GM"},{name:"res_countryName_Guinea",code:"GN"},{name:"res_countryName_Guadeloupe",code:"GP"},{name:"res_countryName_Equatorial_Guinea",code:"GQ"},{name:"res_countryName_Greece",code:"GR"},{name:"res_countryName_South_Georgia_South_Sandwichisland",code:"GS"},{name:"res_countryName_Guatemala",code:"GT"},{name:"res_countryName_Guam",code:"GU"},{name:"res_countryName_Guinea_Bissau",code:"GW"},{name:"res_countryName_Guyana",code:"GY"},{name:"res_countryName_Hong_Kong",code:"HK"},{name:"res_countryName_Honduras",code:"HN"},{name:"res_countryName_Croatia",code:"HR"},{name:"res_countryName_Haiti",code:"HT"},{name:"res_countryName_Hungary",code:"HU"},{name:"res_countryName_Canary_Island",code:"IC"},{name:"res_countryName_Indonesia",code:"ID"},{name:"res_countryName_Ireland",code:"IE"},{name:"res_countryName_Israel",code:"IL"},{name:"res_countryName_India",code:"IN"},{name:"res_countryName_British_Indian_Ocean_Territory",code:"IO"},{name:"res_countryName_Iraq",code:"IQ"},{name:"res_countryName_Iran_Islamic_Republic",code:"IR"},{name:"res_countryName_Iceland",code:"IS"},{name:"res_countryName_Italy",code:"IT"},{name:"res_countryName_Jamaica",code:"JM"},{name:"res_countryName_Jordan",code:"JO"},{name:"res_countryName_Japan",code:"JP"},{name:"res_countryName_Kenya",code:"KE"},{name:"res_countryName_Kyrgyzstan",code:"KG"},{name:"res_countryName_Cambodia",code:"KH"},{name:"res_countryName_Kiribati",code:"KI"},{name:"res_countryName_Comoros",code:"KM"},{name:"res_countryName_St_Kitts_and_Nevis",code:"KN"},{name:"res_countryName_Korea_Dem_Peoples_Rep_North_Korea",code:"KP"},{name:"res_countryName_Korea_South",code:"KR"},{name:"res_countryName_Kuwait",code:"KW"},{name:"res_countryName_Cayman_Islands",code:"KY"},{name:"res_countryName_Kazakhstan",code:"KZ"},{name:"res_countryName_Laos_Democratic_Peoples_Republic",code:"LA"},{name:"res_countryName_Lebanon",code:"LB"},{name:"res_countryName_Saint_Lucia",code:"LC"},{name:"res_countryName_Liechtenstein",code:"LI"},{name:"res_countryName_Sri_Lanka",code:"LK"},{name:"res_countryName_Liberia",code:"LR"},{name:"res_countryName_Lesotho",code:"LS"},{name:"res_countryName_Lithuania",code:"LT"},{name:"res_countryName_Luxembourg",code:"LU"},{name:"res_countryName_Latvia",code:"LV"},{name:"res_countryName_Libya_Libyan_Arabian_Dschamahirija",code:"LY"},{name:"res_countryName_Morocco",code:"MA"},{name:"res_countryName_Monaco",code:"MC"},{name:"res_countryName_Moldova_Republic",code:"MD"},{name:"res_countryName_Montenegro",code:"ME"},{name:"res_countryName_Madagascar",code:"MG"},{name:"res_countryName_Marshall_Islands",code:"MH"},{name:"res_countryName_Mazedonia_former_Rep_of_Yugoslavia",code:"MK"},{name:"res_countryName_Mali",code:"ML"},{name:"res_countryName_Myanmar_Burma",code:"MM"},{name:"res_countryName_Mongolia",code:"MN"},{name:"res_countryName_Macau",code:"MO"},{name:"res_countryName_Northern_Marians",code:"MP"},{name:"res_countryName_Martinique",code:"MQ"},{name:"res_countryName_Mauretania",code:"MR"},{name:"res_countryName_Montserrat",code:"MS"},{name:"res_countryName_Malta",code:"MT"},{name:"res_countryName_Mauritius",code:"MU"},{name:"res_countryName_Maledives",code:"MV"},{name:"res_countryName_Malawi",code:"MW"},{name:"res_countryName_Mexico",code:"MX"},{name:"res_countryName_Malaysia",code:"MY"},{name:"res_countryName_Mozambique",code:"MZ"},{name:"res_countryName_Namibia",code:"NA"},{name:"res_countryName_New_Caledonia",code:"NC"},{name:"res_countryName_Niger",code:"NE"},{name:"res_countryName_Norfolk_Islands",code:"NF"},{name:"res_countryName_Nigeria",code:"NG"},{name:"res_countryName_Nicaragua",code:"NI"},{name:"res_countryName_Netherlands",code:"NL"},{name:"res_countryName_Norway",code:"NO"},{name:"res_countryName_Nepal",code:"NP"},{name:"res_countryName_Nauru",code:"NR"},{name:"res_countryName_New_Zealand",code:"NZ"},{name:"res_countryName_Oman",code:"OM"},{name:"res_countryName_Panama",code:"PA"},{name:"res_countryName_Peru",code:"PE"},{name:"res_countryName_French_Polynesia",code:"PF"},{name:"res_countryName_Papua_New_Guinea",code:"PG"},{name:"res_countryName_Philippines",code:"PH"},{name:"res_countryName_Pakistan",code:"PK"},{name:"res_countryName_Poland",code:"PL"},{name:"res_countryName_Saint_Pierre_and_Miquelon",code:"PM"},{name:"res_countryName_Pitcairn_Island",code:"PN"},{name:"res_countryName_Puerto_Rico",code:"PR"},{name:"res_countryName_Palestine_regions_occupied",code:"PS"},{name:"res_countryName_Portugal",code:"PT"},{name:"res_countryName_Palau",code:"PW"},{name:"res_countryName_Paraguay",code:"PY"},{name:"res_countryName_Quatar",code:"QA"},{name:"res_countryName_Reunion",code:"RE"},{name:"res_countryName_Romania",code:"RO"},{name:"res_countryName_Russian_Federation",code:"RU"},{name:"res_countryName_Rwanda",code:"RW"},{name:"res_countryName_Saudi_Arabia",code:"SA"},{name:"res_countryName_Solomonen",code:"SB"},{name:"res_countryName_Seychelles",code:"SC"},{name:"res_countryName_Sudan",code:"SD"},{name:"res_countryName_Sweden",code:"SE"},{name:"res_countryName_Singapore",code:"SG"},{name:"res_countryName_Saint_Helena",code:"SH"},{name:"res_countryName_Slovenia",code:"SI"},{name:"res_countryName_Spitzbergen",code:"SJ"},{name:"res_countryName_Slovakia",code:"SK"},{name:"res_countryName_Sierra_Leone",code:"SL"},{name:"res_countryName_San_Marino",code:"SM"},{name:"res_countryName_Senegal",code:"SN"},{name:"res_countryName_Somalia",code:"SO"},{name:"res_countryName_Suriname",code:"SR"},{name:"res_countryName_South_Sudan_Republic_of",code:"SS"},{name:"res_countryName_Sao_Tome_and_Principe",code:"ST"},{name:"res_countryName_El_Salvador",code:"SV"},{name:"res_countryName_Syria_Arabian_Republic",code:"SY"},{name:"res_countryName_Swaziland",code:"SZ"},{name:"res_countryName_Turks_and_Caicos_Islands",code:"TC"},{name:"res_countryName_Chad",code:"TD"},{name:"res_countryName_Togo",code:"TG"},{name:"res_countryName_Thailand",code:"TH"},{name:"res_countryName_Tajikstan",code:"TJ"},{name:"res_countryName_Tokelau",code:"TK"},{name:"res_countryName_Timor_Leste",code:"TL"},{name:"res_countryName_Turkmenistan",code:"TM"},{name:"res_countryName_Tunisia",code:"TN"},{name:"res_countryName_Tonga",code:"TO"},{name:"res_countryName_Turkey",code:"TR"},{name:"res_countryName_Trinidad_and_Tobago",code:"TT"},{name:"res_countryName_Tuvalu",code:"TV"},{name:"res_countryName_Taiwan",code:"TW"},{name:"res_countryName_Tanzania_United_Republic",code:"TZ"},{name:"res_countryName_Ukraine",code:"UA"},{name:"res_countryName_Uganda",code:"UG"},{name:"res_countryName_Minor_American_Oversea_Islands",code:"UM"},{name:"res_countryName_United_States_of_America",code:"US"},{name:"res_countryName_Uruguay",code:"UY"},{name:"res_countryName_Uzbekistan",code:"UZ"},{name:"res_countryName_Vatican_City",code:"VA"},{name:"res_countryName_Saint_Vincent_and_Grenadines",code:"VC"},{name:"res_countryName_Venezuela",code:"VE"},{name:"res_countryName_British_Virgin_Islands",code:"VG"},{name:"res_countryName_American_Virgin_Islands",code:"VI"},{name:"res_countryName_Vietnam",code:"VN"},{name:"res_countryName_Vanuatu",code:"VU"},{name:"res_countryName_Wallis_and_Futuna",code:"WF"},{name:"res_countryName_Samoa",code:"WS"},{name:"res_countryName_Kosovo",code:"XK"},{name:"res_countryName_Serbia",code:"XS"},{name:"res_countryName_Yemen",code:"YE"},{name:"res_countryName_Mayotte",code:"YT"},{name:"res_countryName_South_Africa",code:"ZA"},{name:"res_countryName_Zambia",code:"ZM"},{name:"res_countryName_Zimbabwe",code:"ZW"}],C.CountryCodeToCountryNameResourceMap={},C.CountriesArray.forEach(function(e){C.CountryCodeToCountryNameResourceMap[e.code]=e.name}),C.isCircuitLink=function(e,n){if(!e||!n)return!1;if(t.isElectron&&0===n.search(/^file:\/\/\S+?\.html#\/\S+?$/i))return!0;if(n.startsWith("#/"))return!0;if(C.PROTOCOL_PATTERN.exec(e)||(e=d+e),e.endsWith("/")||(e+="/"),C.PROTOCOL_PATTERN.exec(n)||(n=n.startsWith("circuit://")?n.replace("circuit://",d):d+n),!n.startsWith(e)){var i=d+"partner.",r=e.startsWith(i)?e.replace(i,d):e.replace(d,i);n.startsWith(r)&&(n=n.replace(r,e))}if(n.length>e.length&&n.startsWith(e)){var o=n.slice(e.length),a=o.match(C.CIRCUIT_CONVERSATION_HASH_PATTERN);return a?a[0].replace(/\/(muted|open)/gim,"/conversation"):(a=o.match(C.CIRCUIT_LINKS_HASH_PATTERN)||o.match(C.CIRCUIT_EMAIL_HASH_PATTERN))&&a[0]}return!1},C.throttle=function(e,t,i){var r,o,a,s=null,c=0;i=i||{};var l=function(){c=!1===i.leading?0:Date.now(),s=null,a=e.apply(r,o),r=o=null};return function(){var d=Date.now();c||!1!==i.leading||(c=d);var u=t-(d-c);return r=this,o=arguments,u<=0?(s&&(n.clearTimeout(s),s=null),c=d,a=e.apply(r,o),r=o=null):s||!1===i.trailing||(s=n.setTimeout(l,u)),a}},C.hasEmptyPrototype=function(e){return!(!e||"object"!=typeof e)&&C.isEmptyObject(Object.getPrototypeOf(e))},C.compareElements=function(e,t){if(e===t)return!0;if(!e||!t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;if(e instanceof Array&&t instanceof Array)return function(e,t){var n=e.length,i=[];if(e===t)return!0;if(e.length!==t.length)return!1;for(var r=0;r<n;++r)for(var o=0;o<n;++o)if(-1===i.indexOf(t[o])&&C.compareElements(e[r],t[o])){i.push(t[o]);break}return i.length===n}(e,t);if(!C.hasEmptyPrototype(e)||!C.hasEmptyPrototype(t))return!1;for(var n in e)if(e.hasOwnProperty(n)&&0!==n.indexOf("$$")&&!C.compareElements(e[n],t[n]))return!1;return!0},C.copyToClipboard=function(e,t,i){var o,s,c,l,d;if(e)try{s=r.createRange(),o=n.getSelection(),l=r.body.style.overflow,d=this.getBrowserInfo().msie,c=r.createElement("div"),i||(e=e.replace(/\r\n/gi,"<br>")),c.style.backgroundColor="#fff",c.style.font="normal normal 15px Calibri, sans-serif",c.style["white-space"]="pre-wrap",i?c.innerText=e:c.innerHTML=e,r.body.appendChild(c),s.selectNode(c),o.removeAllRanges(),o.addRange(s),d&&(r.body.style.overflow="hidden"),r.execCommand("copy")?t&&t():t&&t("Failed to copy")}catch(e){a.error("[Utils]: Copy to clipboard failed"),t&&t("Internal error")}finally{o&&("function"==typeof o.removeRange?o.removeRange(s):o.removeAllRanges()),d&&(r.body.style.overflow=l),c&&r.body.removeChild(c)}},C.sslProxify=function(e){return e&&e.startsWith("http:")?"https://embed-proxy.circuitsandbox.net/?target="+encodeURIComponent(e):e},C.appIsFocused=function(){if(t.isElectron){var e=o.getCurrentWindow();return e.isFocused()&&e.isVisible()&&!e.isMinimized()}return!0!==r.hidden},C.validatePreviewProtocol=function(e){return e?e.match(/https:/)?e:e.replace('src="//','src="https://'):""},C.TabSelector=function(e){if(Array.isArray(e)&&0!==e.length){var t=this,n={},i="";e.forEach(function(e,r){0===r?(n[e]=!0,i=e):n[e]=!1,Object.defineProperty(t,e,{get:function(){return n[e]},set:function(t){t&&(Object.keys(n).forEach(function(e){n[e]=!1}),n[e]=!0,i=e)},enumerable:!0,configurable:!1})}),Object.defineProperty(this,"selected",{get:function(){return i},enumerable:!0,configurable:!1}),Object.defineProperty(this,"selectedIdx",{get:function(){return e.indexOf(i)},enumerable:!0,configurable:!1})}},C.getOrigin=R,C.parseQS=function(e){var t={};e=e.substring(1);for(var n=/([^&=]+)=([^&]*)/g,i=n.exec(e);i;)t[decodeURIComponent(i[1])]=decodeURIComponent(i[2]),i=n.exec(e);return t},C.toQS=function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)&&void 0!==e[n]){var i=e[n];Array.isArray(i)?i.forEach(function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}return t.join("&")},C.extractConfigurableText=function(e,t,n){var i=e&&e.find(function(e){return e.type===t});if(!i||!i.texts)return"";var r,o=function(e){return i.texts.find(function(t){return t.language===e})};return n&&((r=o(n))||(r=o(n=n.split("-",1)[0]))),r||(r=o("default")),r&&r.translation},C.selectMediaDevice=function(e,t,n){return e&&t?(t.some(function(t){return!!(i=void 0===t.id?t:e.find(function(e){return t.id===e.id}))}),!i&&n&&t.some(function(t){return!!(i=e.find(function(e){return t.label===e.label}))}),i):null;var i},C.removeArrayElement=function(e,t){if(Array.isArray(e)&&void 0!==t&&t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}},C.binaryInsert=function(e,t,n,i){return function e(t,n,i,r,o,a){if(!n||!Array.isArray(t))return-1;if(0===t.length)return t.push(n),0;if(o=o||0,(a=a||t.length-1)-o<=1)return i(n,t[o])<0?(t.splice(o,0,n),o):i(n,t[a])>0?(t.splice(a+1,0,n),a+1):n[r]===t[o][r]?(t[o]=n,o):n[r]===t[a][r]?(t[a]=n,a):(t.splice(a,0,n),a);var s=Math.floor((a-o)/2)+o;return i(n,t[s])<0?e(t,n,i,r,o,s):e(t,n,i,r,s,a)}(e,t,n,i||"id")},C.mapKeypadCodeToDtmf=function(e,t){var n;return e=e||{},n=(t=t||{}).firefox?e.key:String.fromCharCode(e.keyCode),/[A-Za-z0-9#\*]/.exec(n)?(/[0-9#\*]/.exec(n)||(/[A-Ca-c]/.exec(n)?n="2":/[D-Fd-f]/.exec(n)?n="3":/[G-Ig-i]/.exec(n)?n="4":/[J-Lj-l]/.exec(n)?n="5":/[M-Om-o]/.exec(n)?n="6":/[P-Sp-s]/.exec(n)?n="7":/[T-Vt-v]/.exec(n)?n="8":/[W-Zw-z]/.exec(n)&&(n="9")),n):n},"function"!=typeof Object.values&&(Object.values=function(e){return Object.keys(e).map(function(t){return e[t]})}),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return null!=e&&(e=e.toString(),t=Math.floor(t)||0,this.substr(t,e.length)===e)}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){return null!=e&&(t=void 0===t?this.length:Math.min(Math.floor(t)||0,this.length),!((t-=(e=e.toString()).length)<0)&&this.substr(t,e.length)===e)}}),String.prototype.includes||Object.defineProperty(String.prototype,"includes",{value:function(e){return-1!==this.indexOf(e)}}),String.prototype.repeat||Object.defineProperty(String.prototype,"repeat",{value:function(e){if(null===this)throw new TypeError("can't convert "+this+" to object");var t=""+this;if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0===t.length||0===e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var n="",i=0;i<e;i++)n+=t;return n}}),Object.defineProperty(String.prototype,"format",{value:function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return e[n]||t})}}),Object.defineProperty(String.prototype,"replaceAt",{value:function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)}}),Object.defineProperty(String.prototype,"randomCharacter",{value:function(){return this[Math.floor(this.length*Math.random())]}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e){return-1!==this.indexOf(e)}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return t}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return o;return-1}}),Object.defineProperty(Array.prototype,"isEmpty",{value:function(){return 0===this.length}}),Object.defineProperty(Array.prototype,"last",{value:function(){if(this.length>0)return this[this.length-1]}}),Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(var e=this.length,t=0;t<e;t++){var n=Math.floor(Math.random()*e),i=this[n];this[n]=this[t],this[t]=i}return this}}),Object.defineProperty(Array.prototype,"randomCopy",{value:function(e){var t=this.slice(0);return t.shuffle(),t.splice(0,e)}}),Object.defineProperty(Array.prototype,"move",{value:function(e,t){if(!("number"!=typeof e||"number"!=typeof t||e<0||e>=this.length||t<0)){for(var n=this.length;n<=t;n++)this.push(void 0);this.splice(t,0,this.splice(e,1)[0])}}}),Object.defineProperty(Array.prototype,"binaryInsert",{value:function(e,t){if("function"!=typeof t)return!1;for(var n,i,r=0,o=this.length-1,a=!1;r<=o;)if(t(i=this[n=Math.floor((r+o)/2)],e)<0)r=n+1;else{if(!(t(i,e)>0)){a=!0;break}o=n-1}var s=a?n+1:r;return s>=0&&(this.splice(s,0,e),!0)}}),Array.prototype.empty||Object.defineProperty(Array.prototype,"empty",{value:function(){for(;this.length>0;)this.pop()}}),Array.prototype.diff||Object.defineProperty(Array.prototype,"diff",{value:function(e){return this.filter(function(t){return!e.includes(t)})}}),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},RegExp.escape=function(e){return e?e.replace(/[.*+?|()\[\]{}\\$^]/g,"\\$&"):""},Date.prototype.moveToEndOfDay=function(){return this.set({hour:23,minute:59,second:59})},Date.prototype.moveToFirstDayOfYear=function(){return this.set({day:1,month:0})},Date.prototype.moveToLastDayOfYear=function(){return this.set({month:11}).moveToLastDayOfMonth()};var v={format:function(e){if("undefined"!=typeof PhoneNumberUtil&&e&&"+"===e.charAt(0))try{var t=PhoneNumberUtil.parseAndKeepRawInput(e,null);e=PhoneNumberUtil.formatInternational(t)}catch(e){}return e}};return t.Utils=C,t.PhoneNumberFormatter=v,t}((e=function(e){"use strict";var t={SIGNATURE:"ansibleChromeExtensionSignature"};return t.DOMEvent=Object.freeze({TO_EXTENSION:"toExtension",FROM_EXTENSION:"fromExtension"}),t.BgMsgType=Object.freeze({REQUEST:"request",RESPONSE:"response",EVENT:"event"}),t.BgTarget=Object.freeze({INTERNAL:"internal",LOG:"log",SCREEN_SHARE:"screenShare",EXCHANGE_CONNECTOR:"exchange_connector",HEADSET_APP:"headsetAppManager",PRIVACY_SETTINGS:"privacySettings"}),t.ResponseError=Object.freeze({UNREGISTERED:"unregistered",TIMEOUT:"timeout",UNSUPPORTED_REQUEST:"unsupportedRequest",INTERNAL_ERROR:"internalError"}),t.BgLogMsgType=Object.freeze({LOG:"log"}),t.BgInternalMsgType=Object.freeze({INIT_MSG:"initMsg",INIT_MSG_ACK:"initMsgAck",INJECT_SIGNATURE:"injectChromeAppSignature",IS_ALIVE:"isAlive",GET_WINDOW_SIZE:"getWindowSize",EXTENSION_DISCONNECTED:"extensionDisconnected",BRING_TO_FRONT:"bringToFront",GET_FILE:"getFile"}),t.BgScreenShareMsgType=Object.freeze({CHOOSE_DESKTOP_MEDIA:"cdm",CHOOSE_DESKTOP_MEDIA_DONE:"cdmDone",CHOOSE_DESKTOP_MEDIA_CANCELLED:"cdmCancelled"}),t.BgPrivacySettingsMsgType=Object.freeze({SET_IP_HANDLING_POLICY:"setWebRTCIPHandlingPolicy",GET_IP_HANDLING_POLICY:"getWebRTCIPHandlingPolicy",IP_HANDLING_POLICY_CHANGED:"webRTCIPHandlingPolicyChanged"}),t.BgPrivacySettingsError=Object.freeze({NOT_AUTHORIZED:"notAuthorized",NOT_CONTROLLABLE:"notControllable",CONTROLLED_BY_OTHER_EXTENSIONS:"controlledByOtherExtensions"}),t.BgExchangeMsgType=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",SEARCH_CONTACTS:"searchContacts",AUTODISCOVER_GET_SERVER:"autodiscoverGetServer",GET_CONNECTION_STATUS:"getConnectionStatus",GET_CAPABILITIES:"getCapabilities",GET_CONTACT:"getContact",STORE_EXCH_CREDENTIALS:"storeCredentials",CONNECTION_STATUS:"connectionStatus",GET_ALL_PERSONAL_CONTACTS:"getAllPersonalContacts",CONTACT_FOLDERS_SYNC_STATE:"contactFoldersSyncState",SYNC_ALL_PERSONAL_CONTACTS:"syncAllPersonalContacts",GET_APPOINTMENTS:"getAppointments",GET_STORED_CREDENTIALS:"getStoredCredentials",GET_RENEWED_TOKEN:"getRenewedToken",ON_RENEWED_TOKEN:"onRenewedToken",GET_OOO_MSG:"getOooMsg"}),t.BgHeadsetAppMsgType=Object.freeze({GET_HEADSET_APP_STATUS:"getHeadsetAppStatus",LAUNCH_HEADSET_APP:"launchHeadsetApp",HEADSET_APP_LAUNCHED:"headsetAppLaunched",HEADSET_APP_UNINSTALLED:"headsetAppUninstalled",RESTART_HEADSET_APP:"restartHeadsetApp"}),t.ExchangeConnResponse=Object.freeze({OK:"ok",NO_RESULT:"noResult",FAILED:"failed",COULD_NOT_CONNECT:"couldNotConnect",UNAUTHORIZED:"unauthorized",UNSUPPORTED_METHOD:"unsupportedMethod",TIMED_OUT:"timedOut",MAILBOX_NOT_FOUND:"mailboxNotFound",NTLM_NOT_SUPPORTED:"ntlmNotSupported"}),t.HeadsetAppStatus=Object.freeze({NO_MANAGEMENT_PERMISSION:"noManagementPermission",NOT_INSTALLED:"notInstalled",INSTALLED:"installed",DISABLED:"disabled",UNKNOWN:"unknown"}),t.Exchange=Object.freeze({CONFIGURED_PASSWORD_MASKED:"$$$$"}),t.PortMsg=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",MSG:"msg"}),e.ChromeExtension=t,"undefined"!=typeof module&&module.exports&&(module.exports=t),e}((e=function(e){"use strict";var t=null;try{t=n.localStorage||t}catch(e){t=n.sessionStorage||t}function i(e,n){try{return t?t[e].apply(t,n):null}catch(e){return null}}var r={getItem:function(e){return i("getItem",[e])},setItem:function(e,t){return i("setItem",[e,t])},removeItem:function(e){return i("removeItem",[e])}};return e.storeManager=r,e}((e=function(e){"use strict";return e.Error=function(e,t){this.code=e||"UNEXPECTED_ERROR","string"==typeof t?this.message=t:"object"==typeof t&&(this.errObj=t,t.info&&!t.message&&(t.message=t.info)),this.stack=Error().stack},e.Error.prototype=Object.create(Error.prototype),e.Error.prototype.name="Error",e}((e=function(e){"use strict";var t=Object.freeze({Debug:1,Info:2,Warning:3,Error:4,Off:5}),n=t.Warning,i="undefined"!=typeof _circuitLogger?_circuitLogger:{setLevel:function(e){n=e},getLevel:function(){return n},debug:function(){n<=t.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},info:function(){n<=t.Info&&console.info.apply(console,Array.prototype.slice.apply(arguments))},warning:function(){n<=t.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},warn:function(){n<=t.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},error:function(e,i){n<=t.Error&&(e=e&&e.stack||e,(i=i&&i.stack||i)?console.error(e,i):console.error(e))},msgSend:function(){n<=t.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},msgRcvd:function(){n<=t.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},logMsg:function(e,t,n){switch(e.name){case"DEBUG":this.debug(t,n);break;case"INFO":this.info(t,n);break;case"WARN":case"WARNING":case"ERROR":this.info(t,n);break;default:this.debug(t,n)}},setExtensionVersion:function(e){console.log("ExtensionVersion = "+e)}};return e.logger=i,e.Enums=e.Enums||{},e.Enums.LogLevel=t,e}((e=function(e){"use strict";e.isSDK=!0;var t={name:"unknown"};return"undefined"!=typeof process?process.versions&&process.versions.node?t={name:"node",version:process.versions.node,hostname:require("os").hostname()}:process.argv&&process.argv[0]&&(t={name:process.argv[0]}):t={name:"browser"},n.setTimeout=n.setTimeout||setTimeout,n.clearTimeout=n.clearTimeout||clearTimeout,n.setInterval=n.setInterval||setInterval,n.clearInterval=n.clearInterval||clearInterval,n.location||(n.location={host:t.hostname}),i.platform||(i.platform=t.name),i.userAgent||(i.userAgent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36"),n.navigator||(n.navigator=i),n.btoa||(n.btoa=function(e){return new Buffer(e).toString("base64")}),e._runtime=t,e.DefaultAvatars={},e}(e||{}))||{}))||{}))||{}))||{}))||{}))||{})))||{}))))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))))||{}))||{}))||{}))||{}))))))))))||{}))))))))))))||{}))});
